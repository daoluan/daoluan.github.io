<!DOCTYPE html><!--[if IE]>  <html class="ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="main.pdf_files/style.css" />
	</head>
	<body>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 20.8469em; left:16.4475em;"><span class="stl_05 stl_06 stl_07" style="word-spacing:0.0515em;">redis source note &nbsp;</span></div>
					<div class="stl_01" style="top: 24.9914em; left:19.5792em;"><span class="stl_08 stl_09 stl_07">daoluan &nbsp;</span></div>
					<div class="stl_01" style="top: 27.3989em; left:17.0858em;"><span class="stl_08 stl_09 stl_07" style="word-spacing:0.076em;">September 10, 2017 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">2</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9606em; left:5.9058em;"><span class="stl_12 stl_13 stl_14">Contents &nbsp;</span></div>
					<div class="stl_01" style="top: 17.5418em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 17.769em; left:7.1508em;"><span class="stl_17 stl_18 stl_07">剖析心得 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.5418em; left:36.1367em;"><span class="stl_15 stl_16 stl_07">5</span></div>
					<div class="stl_01" style="top: 18.5585em; left:36.1992em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 19.5701em; left:36.1992em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 20.5818em; left:36.1992em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 18.5585em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 19.5701em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 20.5818em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 18.5585em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">源码日志</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7585em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7585em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 19.5701em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">从哪里开始读起</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0922em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0922em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5818em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">不在浮沙筑高台</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0922em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0922em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 23.2748em; left:5.9058em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.749em;">I redis</span><span class="stl_19 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.1259em;">服务框架 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.2748em; left:36.0533em;"><span class="stl_19 stl_13 stl_07">7</span></div>
					<div class="stl_01" style="top: 25.3185em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">2</span></div>
					<div class="stl_01" style="top: 25.3185em; left:7.1508em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1328em;">初探 </span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1328em;">redis &nbsp;</span></div>
					<div class="stl_01" style="top: 25.3185em; left:36.1367em;"><span class="stl_15 stl_16 stl_07">9</span></div>
					<div class="stl_01" style="top: 26.3351em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 27.3468em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 28.3585em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 26.3351em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.772em;">.1 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">在缓存系统所处的位置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1404em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.1404em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 26.3351em; left:36.1992em;"><span class="stl_10 stl_11 stl_07">9</span></div>
					<div class="stl_01" style="top: 27.3468em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">从主函数开始</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3143em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3143em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9788em;">&nbsp;11 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.3585em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.772em;">.3 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">如何运作</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6953em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6953em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9789em;">&nbsp;11 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.3702em; left:9.06em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 30.3818em; left:9.06em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 31.3935em; left:9.06em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 32.4051em; left:9.06em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 33.4168em; left:9.06em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 29.3702em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.3.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">详细的过程</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4481em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4481em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9792em;">&nbsp;11 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.3818em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.3.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">新连接的处理流程</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5596em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5596em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9786em;">&nbsp;15 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.3935em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.3.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">请求的处理流程</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0038em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0038em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9794em;">&nbsp;17 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4051em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.3.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">执行命令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6702em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6702em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.979em;">&nbsp;19 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4168em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.3.5</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">在哪里回复客户端</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5596em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5596em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9786em;">&nbsp;20 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4285em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 34.4285em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.772em;">.4 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">事件驱动模型</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.25em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9792em;">&nbsp;21 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4401em; left:9.06em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 36.4518em; left:9.06em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 35.4401em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.4.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">概述</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3366em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3366em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9787em;">&nbsp;21 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4518em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.4.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">其他模型</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6702em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6702em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.979em;">&nbsp;21 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.2985em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">3</span></div>
					<div class="stl_01" style="top: 38.2985em; left:7.1504em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1339em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1339em;">事件驱动详解 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.2985em; left:35.6592em;"><span class="stl_15 stl_16 stl_07">23 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.3151em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 39.3151em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">概述</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9792em;">&nbsp;23 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.3268em; left:9.06em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 41.3385em; left:9.06em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 40.3268em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.1.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">事件驱动数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5596em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5596em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9786em;">&nbsp;23 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.3385em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.1.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">事件循环中心</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2491em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2491em;">. . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9793em;">&nbsp;25 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.3502em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 42.3502em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.772em;">.2 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">事件驱动原理</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.25em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9792em;">&nbsp;27 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.3618em; left:9.06em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 44.3735em; left:9.06em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 45.3852em; left:9.06em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 46.3968em; left:9.06em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 47.4085em; left:9.06em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 43.3618em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.2.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">事件注册详解</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2491em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2491em;">. . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9793em;">&nbsp;27 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.3735em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.2.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">准备监听工作</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2491em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2491em;">. . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9793em;">&nbsp;28 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.3852em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.2.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">为监听套接字注册事件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1154em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.1154em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9789em;">&nbsp;28 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.3968em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.2.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">事件循环</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6702em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6702em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.979em;">&nbsp;30 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">.2.5</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.8938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.8938em;">事件触发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6702em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6702em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.979em;">&nbsp;31 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0525em;"><span class="stl_10 stl_11 stl_07">3</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 3.3893em; left:31.8975em;"><span class="stl_21 stl_11 stl_07">CONTENTS &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 6.7268em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.566em;"><span class="stl_10 stl_11 stl_22" style="word-spacing:0.7748em;">.3 redis</span><span class="stl_10 stl_11 stl_22" style="word-spacing:0.0852em;">&nbsp;</span><span class="stl_17 stl_18 stl_22" style="word-spacing:0.0852em;">与</span><span class="stl_17 stl_18 stl_22" style="word-spacing:0.0858em;">&nbsp;</span><span class="stl_10 stl_11 stl_22" style="word-spacing:0.0858em;">memcache</span><span class="stl_10 stl_11 stl_22" style="word-spacing:0.0856em;">&nbsp;</span><span class="stl_17 stl_18 stl_22" style="word-spacing:0.0856em;">的事件驱动比较</span><span class="stl_17 stl_18 stl_22" style="word-spacing:0.1191em;">&nbsp;</span><span class="stl_10 stl_11 stl_22" style="word-spacing:0.1191em;">.</span><span class="stl_10 stl_11 stl_22" style="word-spacing:0.2528em;">&nbsp;. . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_22" style="word-spacing:0.9821em;">&nbsp;32 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7268em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">总结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9792em;">&nbsp;32 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.4131em; left:5.9058em;"><span class="stl_19 stl_13 stl_23" style="word-spacing:0.744em;">II redis</span><span class="stl_19 stl_13 stl_23" style="word-spacing:0.1199em;">&nbsp;</span><span class="stl_20 stl_18 stl_23" style="word-spacing:0.1199em;">基础数据结构 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.4131em; left:35.4925em;"><span class="stl_19 stl_13 stl_07">35 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.4502em; left:35.6592em;"><span class="stl_15 stl_16 stl_07">37 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.296em; left:35.6592em;"><span class="stl_15 stl_16 stl_07">41 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.141em; left:35.6592em;"><span class="stl_15 stl_16 stl_07">43 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.9868em; left:35.6592em;"><span class="stl_15 stl_16 stl_07">47 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.4502em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">4</span></div>
					<div class="stl_01" style="top: 13.296em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">5</span></div>
					<div class="stl_01" style="top: 15.141em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">6</span></div>
					<div class="stl_01" style="top: 16.9868em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">7</span></div>
					<div class="stl_01" style="top: 11.4502em; left:7.1504em;"><span class="stl_15 stl_16 stl_24" style="word-spacing:0.1293em;">redis </span><span class="stl_17 stl_18 stl_24" style="word-spacing:0.1293em;">数据结构 </span><span class="stl_15 stl_16 stl_24" style="word-spacing:0.1293em;">redisObject &nbsp;</span></div>
					<div class="stl_01" style="top: 13.296em; left:7.1504em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1331em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1331em;">数据结构 </span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1331em;">adlist &nbsp;</span></div>
					<div class="stl_01" style="top: 15.141em; left:7.1504em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1331em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1331em;">数据结构 </span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1331em;">sds &nbsp;</span></div>
					<div class="stl_01" style="top: 16.9868em; left:7.1504em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1331em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1331em;">数据结构 </span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1331em;">dict &nbsp;</span></div>
					<div class="stl_01" style="top: 17.9993em; left:7.1508em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.772em;">7.1 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">的键值对存储在哪里</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3626em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3626em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9787em;">&nbsp;47 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.0068em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">7.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">哈希表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0833em;">dict</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.535em;">&nbsp;.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9787em;">&nbsp;48 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.0143em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">7.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">扩展哈希表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5364em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5364em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9787em;">&nbsp;50 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.0218em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">7.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">重置哈希表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5364em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5364em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9787em;">&nbsp;50 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.0293em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">7.5</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">低效率的哈希表添加替换</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7594em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7594em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9786em;">&nbsp;52 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.0376em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">7.6</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">哈希表的迭代</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3143em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3143em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9788em;">&nbsp;54 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.8777em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">8</span></div>
					<div class="stl_01" style="top: 28.7385em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">9</span></div>
					<div class="stl_01" style="top: 24.8777em; left:7.1504em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1331em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1331em;">数据结构 </span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1331em;">ziplist &nbsp;</span></div>
					<div class="stl_01" style="top: 24.8777em; left:35.6592em;"><span class="stl_15 stl_16 stl_07">57 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.8901em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">概述</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9792em;">&nbsp;57 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.8976em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">压缩双链表的具体实现</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2037em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2037em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9794em;">&nbsp;57 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.8901em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">8</span></div>
					<div class="stl_01" style="top: 26.8976em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">8</span></div>
					<div class="stl_01" style="top: 28.7385em; left:7.1504em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1331em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1331em;">数据结构 </span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1331em;">skiplist &nbsp;</span></div>
					<div class="stl_01" style="top: 28.7385em; left:35.6592em;"><span class="stl_15 stl_16 stl_07">61 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.751em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">9</span></div>
					<div class="stl_01" style="top: 30.7585em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">9</span></div>
					<div class="stl_01" style="top: 31.766em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">9</span></div>
					<div class="stl_01" style="top: 32.7735em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">9</span></div>
					<div class="stl_01" style="top: 33.7818em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">9</span></div>
					<div class="stl_01" style="top: 34.7893em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">9</span></div>
					<div class="stl_01" style="top: 29.751em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">概述</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9792em;">&nbsp;61 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.7585em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">跳表的数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0922em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0922em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9789em;">&nbsp;62 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.766em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">跳表的插入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5364em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5364em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9787em;">&nbsp;63 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.7735em; left:7.566em;"><span class="stl_10 stl_11 stl_07">.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7715em;">跳表的删除</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5364em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5364em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9787em;">&nbsp;66 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.7818em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.772em;">.5 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">中的跳表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6953em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6953em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9789em;">&nbsp;67 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.7893em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.772em;">.6 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">选用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0836em;">skiplist</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">场景</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0455em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0455em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9794em;">&nbsp;68 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6293em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 36.6293em; left:6.3832em;"><span class="stl_15 stl_16 stl_25" style="word-spacing:0.1042em;">0 redis</span><span class="stl_15 stl_16 stl_25" style="word-spacing:0.1391em;">&nbsp;</span><span class="stl_17 stl_18 stl_25" style="word-spacing:0.1391em;">数据结构</span><span class="stl_17 stl_18 stl_25" style="word-spacing:0.1374em;">&nbsp;</span><span class="stl_15 stl_16 stl_25" style="word-spacing:0.1374em;">intset &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6293em; left:35.6592em;"><span class="stl_15 stl_16 stl_07">69 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.6418em; left:7.566em;"><span class="stl_10 stl_11 stl_26" style="word-spacing:0.2774em;">0.1 intset</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0871em;">&nbsp;</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0871em;">结构体</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.5645em;">&nbsp;</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.5645em;">.</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.2554em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.9842em;">&nbsp;69 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.6493em; left:7.566em;"><span class="stl_10 stl_11 stl_27" style="word-spacing:0.278em;">0.2 intset</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.0877em;">&nbsp;</span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0877em;">搜索</span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0093em;">&nbsp;</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.0093em;">.</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.256em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.9845em;">&nbsp;70 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.6576em; left:7.566em;"><span class="stl_10 stl_11 stl_27" style="word-spacing:0.278em;">0.3 intset</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.0877em;">&nbsp;</span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0877em;">插入</span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0093em;">&nbsp;</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.0093em;">.</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.256em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.9845em;">&nbsp;71 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.6418em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 38.6493em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 39.6576em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 42.3431em; left:5.9058em;"><span class="stl_19 stl_13 stl_28" style="word-spacing:0.7364em;">III redis</span><span class="stl_19 stl_13 stl_28" style="word-spacing:0.1124em;">&nbsp;</span><span class="stl_20 stl_18 stl_28" style="word-spacing:0.1124em;">内功心法 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.3431em; left:35.4925em;"><span class="stl_19 stl_13 stl_07">75 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.381em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 44.381em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.099em;">1 redis</span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1339em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1339em;">数据淘汰机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.381em; left:35.6592em;"><span class="stl_15 stl_16 stl_07">77 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.3935em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 46.401em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 45.3935em; left:7.566em;"><span class="stl_10 stl_11 stl_07">1.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">概述</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9792em;">&nbsp;77 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.401em; left:7.566em;"><span class="stl_10 stl_11 stl_26" style="word-spacing:0.2774em;">1.2 LRU</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0868em;">&nbsp;</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0868em;">数据淘汰机制</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.2547em;">&nbsp;</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.2547em;">. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.9846em;">&nbsp;78 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">1.3 TTL</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">数据淘汰机制</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2498em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2498em;">. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9792em;">&nbsp;79 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07">CONTENTS &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:36.1992em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">11.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">总结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9792em;">&nbsp;80 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.576em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 13.5068em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 7.576em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.099em;">2 RDB</span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1334em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1334em;">持久化策略</span><span class="stl_17 stl_18 stl_07" style="word-spacing:26.1412em;">&nbsp;</span><span class="stl_15 stl_16 stl_07" style="word-spacing:26.1412em;">87 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.5985em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 9.6151em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 10.6326em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 11.6501em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 8.5985em; left:7.566em;"><span class="stl_10 stl_11 stl_29">2.1</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.2749em;">&nbsp;</span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.2749em;">简介</span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.087em;">&nbsp;</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.087em;">redis</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.0863em;">&nbsp;</span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0863em;">持久化</span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0857em;">&nbsp;</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.0857em;">RDB</span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0857em;">、</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.0857em;">AOF</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.6724em;">&nbsp;.</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.2533em;">&nbsp;. . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.9828em;">&nbsp;87 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6151em; left:7.566em;"><span class="stl_10 stl_11 stl_07">2.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">rio</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.033em;">&nbsp;.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.979em;">&nbsp;87 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6326em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">2.3 RDB</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">持久化的运作机制</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4402em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4402em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9795em;">&nbsp;90 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6501em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">2.4 RDB</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">数据的组织方式</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6623em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6623em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.9794em;">&nbsp;95 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.5068em; left:6.3832em;"><span class="stl_15 stl_16 stl_30" style="word-spacing:0.1093em;">3 AOF</span><span class="stl_15 stl_16 stl_30" style="word-spacing:0.1433em;">&nbsp;</span><span class="stl_17 stl_18 stl_30" style="word-spacing:0.1433em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.5068em; left:35.6592em;"><span class="stl_15 stl_16 stl_07">97 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.5293em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 15.546em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 16.5635em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 17.581em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 18.5985em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 19.616em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 14.5293em; left:7.566em;"><span class="stl_10 stl_11 stl_07">3.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">rio</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.033em;">&nbsp;.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.979em;">&nbsp;97 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.546em; left:7.566em;"><span class="stl_10 stl_11 stl_26" style="word-spacing:0.2774em;">3.2 AOF</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0871em;">&nbsp;</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0871em;">数据组织方式</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.1671em;">&nbsp;</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.1671em;">.</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.2554em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.9846em;">&nbsp;97 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.5635em; left:7.566em;"><span class="stl_10 stl_11 stl_31" style="word-spacing:0.2769em;">3.3 AOF</span><span class="stl_10 stl_11 stl_31" style="word-spacing:0.0866em;">&nbsp;</span><span class="stl_17 stl_18 stl_31" style="word-spacing:0.0866em;">持久化运作机制</span><span class="stl_17 stl_18 stl_31" style="word-spacing:0.7224em;">&nbsp;</span><span class="stl_10 stl_11 stl_31" style="word-spacing:0.7224em;">.</span><span class="stl_10 stl_11 stl_31" style="word-spacing:0.2549em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_31" style="word-spacing:0.9843em;">&nbsp;98 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.581em; left:7.566em;"><span class="stl_10 stl_11 stl_07">3.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">细说更新缓存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3143em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3143em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4789em;">&nbsp;111 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5985em; left:7.566em;"><span class="stl_10 stl_11 stl_27" style="word-spacing:0.278em;">3.5 AOF</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.0877em;">&nbsp;</span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0877em;">恢复过程</span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.612em;">&nbsp;</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.612em;">.</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.256em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.4851em;">&nbsp;116 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.616em; left:7.566em;"><span class="stl_10 stl_11 stl_26" style="word-spacing:0.2774em;">3.6 AOF</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0871em;">&nbsp;</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0871em;">的适用场景</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.3892em;">&nbsp;</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.3892em;">.</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.2554em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.4846em;">&nbsp;120 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.4727em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 28.4202em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 35.3685em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 21.4727em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.0995em;">4 </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0995em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.4727em; left:35.1817em;"><span class="stl_15 stl_16 stl_07">121 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.4943em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 23.5118em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 24.5293em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 25.5468em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 26.5643em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 22.4943em; left:7.566em;"><span class="stl_10 stl_11 stl_07">4.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">积压空间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7585em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7585em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4787em;">&nbsp;122 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.5118em; left:7.566em;"><span class="stl_10 stl_11 stl_07">4.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">主从数据同步机制概述</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2037em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2037em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4796em;">&nbsp;129 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.5293em; left:7.566em;"><span class="stl_10 stl_11 stl_07">4.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">全同步</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2018em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2018em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4795em;">&nbsp;133 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.5468em; left:7.566em;"><span class="stl_10 stl_11 stl_07">4.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">部分同步</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7585em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7585em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4787em;">&nbsp;141 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.5643em; left:7.566em;"><span class="stl_10 stl_11 stl_07">4.5</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">总结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4793em;">&nbsp;152 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4202em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.099em;">5 redis</span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1339em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1339em;">事务机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4202em; left:35.1817em;"><span class="stl_15 stl_16 stl_07">153 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4426em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 30.4601em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 31.4776em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 32.4951em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 33.5118em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 29.4426em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">5.1 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">事务简述</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6953em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6953em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4791em;">&nbsp;153 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4601em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">5.2 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">命令队列</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6953em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6953em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4791em;">&nbsp;153 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4776em; left:7.566em;"><span class="stl_10 stl_11 stl_07">5.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">键值的监视</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5364em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5364em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4788em;">&nbsp;157 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4951em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">5.4 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">事务的执行与取消</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5847em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5847em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4797em;">&nbsp;162 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.5118em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">5.5 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">事务番外篇</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4732em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4732em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4792em;">&nbsp;165 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.3685em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.099em;">6 redis</span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1339em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1339em;">与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1321em;">&nbsp;</span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1321em;">lua</span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.133em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.133em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.3685em; left:35.1817em;"><span class="stl_15 stl_16 stl_07">167 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.391em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 37.4085em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 38.426em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 39.4435em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 40.4601em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 41.4776em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 42.4951em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 36.391em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">6.1 lua</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.311em;">&nbsp;.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4787em;">&nbsp;167 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4085em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">6.2 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">为什么添加</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0837em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0837em;">lua</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">支持</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3627em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3627em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4788em;">&nbsp;169 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.426em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">6.3 lua</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">环境的初始化</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2029em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2029em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4792em;">&nbsp;170 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4435em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">6.4 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">脚本的执行过程</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6954em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6954em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4788em;">&nbsp;172 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4601em; left:7.566em;"><span class="stl_10 stl_11 stl_07">6.5</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">脏命令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2018em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2018em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4795em;">&nbsp;178 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4776em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">6.6 lua</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">脚本的传播</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.425em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.425em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4791em;">&nbsp;181 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4951em; left:7.566em;"><span class="stl_10 stl_11 stl_07">6.7</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">总结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4793em;">&nbsp;182 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.3518em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 44.3518em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.099em;">7 redis</span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1339em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1339em;">监视机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.3518em; left:35.1817em;"><span class="stl_15 stl_16 stl_07">183 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.3743em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">7.1 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">哨兵的服务框架</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0289em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0289em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4794em;">&nbsp;183 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.391em; left:7.566em;"><span class="stl_10 stl_11 stl_07">7.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">定时程序</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7585em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7585em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4787em;">&nbsp;186 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.566em;"><span class="stl_10 stl_11 stl_07">7.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">哨兵与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0833em;">redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">服务器的互联</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0292em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0292em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4788em;">&nbsp;186 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.3743em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 46.391em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">6</span></div>
					<div class="stl_01" style="top: 3.3893em; left:31.8975em;"><span class="stl_21 stl_11 stl_07">CONTENTS &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.1508em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">17.4 HELLO</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">命令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5223em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5223em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4789em;">&nbsp;190 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.5452em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 7.5452em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.099em;">8 redis</span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.1339em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1339em;">集群 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.5452em; left:35.1817em;"><span class="stl_15 stl_16 stl_07">195 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.5485em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 9.5476em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 8.5485em; left:7.566em;"><span class="stl_10 stl_11 stl_07">8.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">前奏</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4793em;">&nbsp;195 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.5476em; left:7.566em;"><span class="stl_10 stl_11 stl_32">8.2</span><span class="stl_10 stl_11 stl_32" style="word-spacing:0.2733em;">&nbsp;</span><span class="stl_17 stl_18 stl_32" style="word-spacing:0.2733em;">也谈一致性哈希算法（</span><span class="stl_10 stl_11 stl_32" style="word-spacing:0.2733em;">consistent</span><span class="stl_10 stl_11 stl_32" style="word-spacing:0.0838em;">&nbsp;hashing</span><span class="stl_17 stl_18 stl_32" style="word-spacing:0.0838em;">）</span><span class="stl_17 stl_18 stl_32" style="word-spacing:0.5525em;">&nbsp;</span><span class="stl_10 stl_11 stl_32" style="word-spacing:0.5525em;">.</span><span class="stl_10 stl_11 stl_32" style="word-spacing:0.2518em;">&nbsp;. . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_32" style="word-spacing:0.4818em;">&nbsp;196 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.546em; left:9.06em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 11.5451em; left:9.06em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 12.5435em; left:9.06em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 10.546em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">8.2.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3938em;">背景</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3366em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3366em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4788em;">&nbsp;196 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.5451em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">8.2.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3938em;">一致性哈希算法</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0038em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0038em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4796em;">&nbsp;197 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.5435em; left:9.4751em;"><span class="stl_10 stl_11 stl_07">8.2.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3938em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3938em;">虚拟节点</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6702em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6702em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4792em;">&nbsp;199 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.5426em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 14.541em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 15.5401em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 16.5385em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 13.5426em; left:7.566em;"><span class="stl_10 stl_11 stl_07">8.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">一致性哈希解决的问题</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2037em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2037em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4796em;">&nbsp;200 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.541em; left:7.566em;"><span class="stl_10 stl_11 stl_07">8.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">怎么实现？</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5364em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5364em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4788em;">&nbsp;201 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.5401em; left:7.566em;"><span class="stl_10 stl_11 stl_33" style="word-spacing:0.2799em;">8.5 twemproxy</span><span class="stl_10 stl_11 stl_33" style="word-spacing:0.0904em;">&nbsp;- redis</span><span class="stl_10 stl_11 stl_33" style="word-spacing:0.0908em;">&nbsp;</span><span class="stl_17 stl_18 stl_33" style="word-spacing:0.0908em;">集群管理方案</span><span class="stl_17 stl_18 stl_33" style="word-spacing:0.6755em;">&nbsp;</span><span class="stl_10 stl_11 stl_33" style="word-spacing:0.6755em;">.</span><span class="stl_10 stl_11 stl_33" style="word-spacing:0.2579em;">&nbsp;. . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_33" style="word-spacing:0.4872em;">&nbsp;201 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.5385em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">8.6 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">官方版本支持的集群</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3626em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3626em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4788em;">&nbsp;202 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.2098em; left:5.9058em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.749em;">IV redis</span><span class="stl_19 stl_13 stl_07" style="word-spacing:0.1257em;">&nbsp;</span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.1257em;">操练 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.2098em; left:34.9317em;"><span class="stl_19 stl_13 stl_07">203 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.2327em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">1</span></div>
					<div class="stl_01" style="top: 21.2327em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.0995em;">9 </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0995em;">积分排行榜 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.2327em; left:35.1817em;"><span class="stl_15 stl_16 stl_07">205 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2368em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 23.2352em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 24.2343em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 25.2326em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 22.2368em; left:7.566em;"><span class="stl_10 stl_11 stl_07">9.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">需求</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4793em;">&nbsp;205 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.2352em; left:7.566em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">9.2 ZSET</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">命令简介</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.1884em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.1884em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4791em;">&nbsp;205 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.2343em; left:7.566em;"><span class="stl_10 stl_11 stl_07">9.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">实现</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4793em;">&nbsp;206 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.2326em; left:7.566em;"><span class="stl_10 stl_11 stl_07">9.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">性能</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4793em;">&nbsp;206 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.0585em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">2</span></div>
					<div class="stl_01" style="top: 29.8877em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">2</span></div>
					<div class="stl_01" style="top: 27.0585em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.0995em;">0 </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0995em;">分布式锁 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.0585em; left:35.1817em;"><span class="stl_15 stl_16 stl_07">207 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.0618em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 28.0618em; left:7.566em;"><span class="stl_10 stl_11 stl_07">0.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">死锁的问题</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5364em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5364em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4788em;">&nbsp;208 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.8877em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.0995em;">1 </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0995em;">消息中间件 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.8877em; left:35.1817em;"><span class="stl_15 stl_16 stl_07">211 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.8918em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">21.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">以分布式的消息队列</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4258em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4258em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4794em;">&nbsp;212 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.5631em; left:5.9058em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7494em;">V </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7494em;">其他 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.5631em; left:34.9317em;"><span class="stl_19 stl_13 stl_07">219 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.5852em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">2</span></div>
					<div class="stl_01" style="top: 35.5852em; left:6.3832em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:0.0995em;">2 </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0995em;">内存数据管理 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.5852em; left:35.1817em;"><span class="stl_15 stl_16 stl_07">221 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5893em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">22.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">共享对象</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7585em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7585em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4787em;">&nbsp;221 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5876em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">22.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">两种内存分配策略</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6479em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6479em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4793em;">&nbsp;221 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5868em; left:7.1508em;"><span class="stl_10 stl_11 stl_34" style="word-spacing:0.2793em;">22.3 memory</span><span class="stl_10 stl_11 stl_34" style="word-spacing:0.0903em;">&nbsp;aware</span><span class="stl_10 stl_11 stl_34" style="word-spacing:0.0886em;">&nbsp;</span><span class="stl_17 stl_18 stl_34" style="word-spacing:0.0886em;">支持</span><span class="stl_17 stl_18 stl_34" style="word-spacing:0.7354em;">&nbsp;</span><span class="stl_10 stl_11 stl_34" style="word-spacing:0.7354em;">.</span><span class="stl_10 stl_11 stl_34" style="word-spacing:0.2573em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_34" style="word-spacing:0.4868em;">&nbsp;222 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5851em; left:7.1508em;"><span class="stl_10 stl_11 stl_29" style="word-spacing:0.2754em;">22.4 zmalloc_get_private_dirty()</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.0846em;">&nbsp;</span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0846em;">函数</span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.5086em;">&nbsp;</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.5086em;">.</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.2534em;">&nbsp;. . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.4828em;">&nbsp;224 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5843em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">22.5</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">总结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4793em;">&nbsp;226 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5827em; left:7.1508em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">22.6 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">日志和断言</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4732em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4732em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4792em;">&nbsp;227 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5818em; left:7.1508em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.272em;">22.7 redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">断言</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3617em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3617em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4787em;">&nbsp;228 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4077em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">2</span></div>
					<div class="stl_01" style="top: 44.4077em; left:6.3832em;"><span class="stl_15 stl_16 stl_35" style="word-spacing:0.1046em;">3 redis</span><span class="stl_15 stl_16 stl_35" style="word-spacing:0.1395em;">&nbsp;</span><span class="stl_17 stl_18 stl_35" style="word-spacing:0.1395em;">与</span><span class="stl_17 stl_18 stl_35" style="word-spacing:0.1378em;">&nbsp;</span><span class="stl_15 stl_16 stl_35" style="word-spacing:0.1378em;">memcache &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4077em; left:35.1817em;"><span class="stl_15 stl_16 stl_07">231 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:7.566em;"><span class="stl_10 stl_11 stl_07">3.1</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">单进程单线程与单进程多线程</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3152em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3152em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.479em;">&nbsp;231 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4101em; left:7.566em;"><span class="stl_10 stl_11 stl_07">3.2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">丰富与简单的数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2037em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2037em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4796em;">&nbsp;231 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.566em;"><span class="stl_10 stl_11 stl_07">3.3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">其他</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4239em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4793em;">&nbsp;231 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 46.4101em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">2</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07">CONTENTS &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:36.1992em;"><span class="stl_10 stl_11 stl_07">7</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.1508em;"><span class="stl_10 stl_11 stl_07">23.4</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2715em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2715em;">性能测试</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.7585em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7585em;">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.25em;">&nbsp;. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4787em;">&nbsp;232 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">8</span></div>
					<div class="stl_01" style="top: 3.3893em; left:31.8975em;"><span class="stl_21 stl_11 stl_07">CONTENTS &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9239em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 1 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.2574em; left:5.9058em;"><span class="stl_37 stl_18 stl_07">剖析心得 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6365em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">我的心得 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.7332em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 26.0507em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 28.3682em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 23.7332em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">源码日志 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.0507em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.2 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">从哪里开始读起 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.3682em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.3 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">不在浮沙筑高台 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0525em;"><span class="stl_10 stl_11 stl_07">9</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">10 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.54em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 1.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5276em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5276em;">剖析心得 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 18.5239em; left:18.6967em;"><span class="stl_36 stl_13 stl_40" style="word-spacing:0.144em;">Part I &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2839em; left:14.3092em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1251em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1251em;">服务框架 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">1</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02" />
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 12.8347em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 2 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5064em; left:5.9058em;"><span class="stl_37 stl_18 stl_07" style="word-spacing:0.125em;">初探 </span><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">redis &nbsp;</span></div>
					<div class="stl_01" style="top: 26.1476em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">这一篇带大家大概浏览 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0833em;">redis</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.6182em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 38.6182em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">.1 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1257em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1257em;">在缓存系统所处的位置 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.6423em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">通常，在系统中，我们会把数据交由数据库来存储，但传统的数据库增删查改的 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_42" style="word-spacing:0.0814em;">性能优先，且比较复杂。根据 </span><span class="stl_10 stl_11 stl_42" style="word-spacing:0.0814em;">80/20 </span><span class="stl_17 stl_18 stl_42" style="word-spacing:0.0814em;">法则，百分之八十的业务访问集中在百分之二十 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_43">的数据上。是否可以有一个存在于物理内存中的数据中间层，来缓存一些常用的数据， &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_40">解决传统数据库数据读写性能问题。常用的数据都存储在内存中，读写性能非常可观。 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">3</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_03.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_03.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">14 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.3517em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">初探</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0836em;">REDIS &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4123em; left:7.5658em;"><span class="stl_17 stl_18 stl_46">这种思维在计算机中很常见，之前学习计算机系统的时候就有见过这张图：越 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.1868em; left:5.9058em;"><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0895em;">往上的存储设备，存储的速度就会更快。诸如，</span><span class="stl_10 stl_11 stl_47" style="word-spacing:0.0895em;">redis, memcache </span><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0895em;">属于 </span><span class="stl_10 stl_11 stl_47" style="word-spacing:0.0895em;">nosql</span><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0895em;">，即 </span><span class="stl_10 stl_11 stl_47" style="word-spacing:0.0895em;">not &nbsp;</span></div>
					<div class="stl_01" style="top: 28.1827em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.082em;">only sql</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.082em;">，可见它们是为了弥补传统数据库的不足。 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.5658em;"><span class="stl_17 stl_18 stl_48" style="word-spacing:0.106em;">包括 </span><span class="stl_10 stl_11 stl_48" style="word-spacing:0.106em;">redis/memcache </span><span class="stl_17 stl_18 stl_48" style="word-spacing:0.106em;">这样的 </span><span class="stl_10 stl_11 stl_48" style="word-spacing:0.106em;">key-value </span><span class="stl_17 stl_18 stl_48" style="word-spacing:0.106em;">内存存储系统，非常适合于读多写少的 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;"><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0791em;">业务场景，而 </span><span class="stl_10 stl_11 stl_49" style="word-spacing:0.0791em;">redis </span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0791em;">是一个基于多种数据结构的内存存储系统，让缓存系统更加好玩。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">2.2. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">从主函数开始 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">15 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4457em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 5.4457em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.2 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">从主函数开始 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7193em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">»</span></div>
					<div class="stl_01" style="top: 7.7193em; left:8.0275em;"><span class="stl_10 stl_11 stl_07">»»»»&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.1291em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 10.1291em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">.3 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1257em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1257em;">如何运作 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.4026em; left:7.5658em;"><span class="stl_17 stl_18 stl_50" style="word-spacing:0.1003em;">在刚刚接触 </span><span class="stl_10 stl_11 stl_50" style="word-spacing:0.1003em;">redis </span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.1003em;">的时候，最想要知道的是一个</span><span class="stl_10 stl_11 stl_50" style="word-spacing:0.1003em;">’set name Jhon’ </span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.1003em;">命令到达 </span><span class="stl_10 stl_11 stl_50" style="word-spacing:0.1003em;">redis &nbsp;</span></div>
					<div class="stl_01" style="top: 13.3985em; left:5.9058em;"><span class="stl_17 stl_18 stl_51" style="word-spacing:0.0829em;">服务器的时候，它是如何返回</span><span class="stl_10 stl_11 stl_51" style="word-spacing:0.0829em;">’OK’ </span><span class="stl_17 stl_18 stl_51" style="word-spacing:0.0829em;">的？里面命令处理的流程如何，具体细节怎么样？ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6173em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">阅读别人的代码是很枯燥的，但带着好奇心阅读代码，是一件很兴奋的事情，接着翻 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.391em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">到了 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">源码的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">main </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">函数。 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9285em; left:7.5658em;"><span class="stl_10 stl_11 stl_52" style="word-spacing:0.0812em;">redis </span><span class="stl_17 stl_18 stl_52" style="word-spacing:0.0812em;">在启动做了一些初始化逻辑，比如配置文件读取，数据中心初始化，网络通 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.1465em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">信模块初始化等，待所有初始化任务完毕后，便开始等待请求。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.9335em; left:7.5658em;"><span class="stl_17 stl_18 stl_53">当请求到来时，</span><span class="stl_10 stl_11 stl_53">redis</span><span class="stl_10 stl_11 stl_53" style="word-spacing:0.0742em;">&nbsp;</span><span class="stl_17 stl_18 stl_53" style="word-spacing:0.0742em;">进程会被唤醒，原理是</span><span class="stl_17 stl_18 stl_53" style="word-spacing:0.0743em;">&nbsp;</span><span class="stl_10 stl_11 stl_53" style="word-spacing:0.0743em;">epoll.</span><span class="stl_10 stl_11 stl_53" style="word-spacing:0.1954em;">&nbsp;select,</span><span class="stl_10 stl_11 stl_53" style="word-spacing:0.0774em;">&nbsp;kqueue</span><span class="stl_10 stl_11 stl_53" style="word-spacing:0.0753em;">&nbsp;</span><span class="stl_17 stl_18 stl_53" style="word-spacing:0.0753em;">等一些</span><span class="stl_17 stl_18 stl_53" style="word-spacing:0.0747em;">&nbsp;</span><span class="stl_10 stl_11 stl_53" style="word-spacing:0.0747em;">I/O</span><span class="stl_10 stl_11 stl_53" style="word-spacing:0.0757em;">&nbsp;</span><span class="stl_17 stl_18 stl_53" style="word-spacing:0.0747em;">多 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.1515em; left:5.9058em;"><span class="stl_17 stl_18 stl_54">路复用的系统调用。接着读取来来自客户端的数据，解析命令，查找命令，并执行命令。 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.9385em; left:7.5658em;"><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0921em;">执行命令</span><span class="stl_10 stl_11 stl_28" style="word-spacing:0.0921em;">’set name Jhon’ </span><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0921em;">的时候，</span><span class="stl_10 stl_11 stl_28" style="word-spacing:0.0921em;">redis </span><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0921em;">会在预先初始化好的哈希表里头，查找 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.9351em; left:5.9058em;"><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0854em;">key=’name’ </span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0854em;">对应的位置，并存入。 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.9435em; left:7.5658em;z-index:425; "><span class="stl_17 stl_18 stl_56">最后，把回复的内容准备好回送给客户端，客户端于是收到了</span><span class="stl_10 stl_11 stl_56">’OK’. &nbsp;</span></div>
					<div class="stl_01" style="top: 35.1548em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 35.1548em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.3.1 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">详细的过程 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.1373em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">带着命令是如何被处理的这个问题去读代码。刚开始的时候，会有一堆的变量和 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.9118em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">函数等着读者，但只要抓住主干就好了，下面就是 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0822em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">的主干部分。 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:5.9875em;"><span class="stl_15 stl_16 stl_57">int</span><span class="stl_15 stl_16 stl_57" style="word-spacing:0.3427em;">&nbsp;</span><span class="stl_10 stl_11 stl_57" style="word-spacing:0.3427em;">main</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.2499em;">&nbsp;(</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.1986em;">&nbsp;</span><span class="stl_15 stl_16 stl_57" style="word-spacing:-0.1986em;">int</span><span class="stl_15 stl_16 stl_57" style="word-spacing:0.3899em;">&nbsp;</span><span class="stl_10 stl_11 stl_57" style="word-spacing:0.3899em;">argc</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.0539em;">&nbsp;,</span><span class="stl_10 stl_11 stl_57" style="word-spacing:0.4012em;">&nbsp;</span><span class="stl_15 stl_16 stl_57" style="word-spacing:0.4012em;">char</span><span class="stl_15 stl_16 stl_57" style="word-spacing:0.3072em;">&nbsp;</span><span class="stl_10 stl_11 stl_57" style="word-spacing:0.3072em;">**</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.2409em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.2009em;">&nbsp;)</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.2009em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 42.4277em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.4218em; left:8.4207em;"><span class="stl_58 stl_59 stl_60">/</span><span class="stl_58 stl_59 stl_60" style="word-spacing:-0.1059em;">&nbsp;</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.1059em;">初 始</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;化</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;服</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;务</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;器</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;配</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.2984em;">&nbsp;置，</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.2994em;">&nbsp;主</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;要</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;是</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;填</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;充</span><span class="stl_17 stl_18 stl_60" style="word-spacing:0.3102em;">&nbsp;</span><span class="stl_58 stl_59 stl_60" style="word-spacing:0.3102em;">redisServer</span><span class="stl_58 stl_59 stl_60" style="word-spacing:-0.0232em;">&nbsp;</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.0232em;">结 构</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;体</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;中</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;的</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;各 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.6382em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">种 参 数 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:8.0192em;"><span class="stl_10 stl_11 stl_61" style="word-spacing:-0.2473em;">initServerConfig () ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">16 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.3517em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">初探</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0836em;">REDIS &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 5.7193em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">初</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;始</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;化</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;服</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;务</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;器 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:8.03em;"><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.3478em;">i n i t S e r v e r () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 10.7001em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;循</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;环 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:7.9458em;"><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2044em;">aeMain ( server . e l ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 16.6357em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">分别来看看它们主要做了什么？ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.981em; left:5.9058em;"><span class="stl_15 stl_16 stl_49">initServerConﬁg &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6643em; left:7.5658em;z-index:150; "><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0728em;">initServerConﬁg </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0728em;">主要是填充 </span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0728em;">struct redisServer </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0728em;">这个结构体，</span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0728em;">redis </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0728em;">所有相关的配 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.8823em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">置都在里面。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.2243em; left:5.9058em;"><span class="stl_15 stl_16 stl_65">initServer &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4743em; left:5.9483em;"><span class="stl_15 stl_16 stl_66">void</span><span class="stl_15 stl_16 stl_66" style="word-spacing:0.412em;">&nbsp;</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.412em;">i</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2405em;">&nbsp;n</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2395em;">&nbsp;i</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2405em;">&nbsp;t</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2395em;">&nbsp;S</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2405em;">&nbsp;e</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2395em;">&nbsp;r</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2405em;">&nbsp;v</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2405em;">&nbsp;e</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2395em;">&nbsp;r</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0995em;">&nbsp;()</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0995em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4776em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.4776em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">创</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;建</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;循</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;环</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;体 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4718em; left:8.0175em;"><span class="stl_10 stl_11 stl_67" style="word-spacing:-0.1667em;">server .</span><span class="stl_10 stl_11 stl_67" style="word-spacing:-0.1517em;">&nbsp;e</span><span class="stl_10 stl_11 stl_67" style="word-spacing:-0.3127em;">&nbsp;l</span><span class="stl_10 stl_11 stl_67" style="word-spacing:0.1993em;">&nbsp;=</span><span class="stl_10 stl_11 stl_67" style="word-spacing:-0.1513em;">&nbsp;aeCreateEventLoop (</span><span class="stl_10 stl_11 stl_67" style="word-spacing:-0.2217em;">&nbsp;server</span><span class="stl_10 stl_11 stl_67" style="word-spacing:-0.1667em;">&nbsp;.</span><span class="stl_10 stl_11 stl_67" style="word-spacing:-0.1877em;">&nbsp;maxclients+ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4685em; left:9.4925em;"><span class="stl_10 stl_11 stl_68" style="word-spacing:0.1663em;">REDIS_EVENTLOOP_FDSET_INCR) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.4626em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;配</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;集</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4527em; left:8.0175em;"><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.1537em;">server .</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2687em;">&nbsp;db</span><span class="stl_10 stl_11 stl_69" style="word-spacing:0.0823em;">&nbsp;=</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.0705em;">&nbsp;zmalloc (</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2294em;">&nbsp;</span><span class="stl_15 stl_16 stl_69" style="word-spacing:-0.2294em;">sizeof</span><span class="stl_15 stl_16 stl_69" style="word-spacing:-0.2295em;">&nbsp;</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2295em;">(</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2517em;">&nbsp;redisDb</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2517em;">&nbsp;)</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.3027em;">&nbsp;*</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2657em;">&nbsp;server</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.1537em;">&nbsp;.</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.3077em;">&nbsp;dbnum)</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.3077em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4518em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.4443em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.4518em; left:8.4207em;"><span class="stl_58 stl_59 stl_70" style="word-spacing:0.2848em;">* Open</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.3498em;">&nbsp;the</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.2528em;">&nbsp;TCP</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.3018em;">&nbsp;l</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2202em;">&nbsp;i</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2192em;">&nbsp;s</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2202em;">&nbsp;t</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2192em;">&nbsp;e</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2202em;">&nbsp;n</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2192em;">&nbsp;i</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2202em;">&nbsp;n</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2192em;">&nbsp;g</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.4905em;">&nbsp;socket for the</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.4448em;">&nbsp;user</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.3428em;">&nbsp;commands</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.3428em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:9.6075em;"><span class="stl_58 stl_59 stl_71">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4443em; left:8.4207em;"><span class="stl_58 stl_59 stl_72" style="word-spacing:0.2789em;">/ listenToPort</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.2531em;">&nbsp;()</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.316em;">&nbsp;</span><span class="stl_17 stl_18 stl_72" style="word-spacing:0.316em;">中</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.3111em;">&nbsp;有</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.3111em;">&nbsp;调</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.3111em;">&nbsp;用</span><span class="stl_17 stl_18 stl_72" style="word-spacing:0.3712em;">&nbsp;</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.3712em;">l</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.3301em;">&nbsp;i</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.3291em;">&nbsp;s</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.3291em;">&nbsp;t</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.3291em;">&nbsp;e</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.3291em;">&nbsp;n</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.2011em;">&nbsp;() &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4335em; left:8.045em;"><span class="stl_15 stl_16 stl_73" style="word-spacing:-0.2712em;">i f</span><span class="stl_15 stl_16 stl_73" style="word-spacing:0.4352em;">&nbsp;</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.4352em;">(</span><span class="stl_10 stl_11 stl_73" style="word-spacing:-0.1982em;">&nbsp;server</span><span class="stl_10 stl_11 stl_73" style="word-spacing:-0.1422em;">&nbsp;.</span><span class="stl_10 stl_11 stl_73" style="word-spacing:-0.1732em;">&nbsp;port</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.3128em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.2508em;">&nbsp;0</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.0848em;">&nbsp;&amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4352em; left:9.9975em;"><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.2295em;">listenToPort ( server . port , server . ipfd ,&amp; server . &nbsp;</span></div>
					<div class="stl_01" style="top: 41.431em; left:11.635em;"><span class="stl_10 stl_11 stl_75" style="word-spacing:-0.0813em;">ipfd_count )</span><span class="stl_10 stl_11 stl_75" style="word-spacing:0.2997em;">&nbsp;==</span><span class="stl_10 stl_11 stl_75" style="word-spacing:0.1327em;">&nbsp;REDIS_ERR) &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:10.0167em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.3048em;">e x i t (1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 43.4235em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4207em;"><span class="stl_58 stl_59 stl_76">/</span><span class="stl_58 stl_59 stl_76" style="word-spacing:-0.1352em;">&nbsp;</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.1352em;">初 始</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.347em;">&nbsp;化</span><span class="stl_17 stl_18 stl_76" style="word-spacing:0.3017em;">&nbsp;</span><span class="stl_58 stl_59 stl_76" style="word-spacing:0.3017em;">redis</span><span class="stl_58 stl_59 stl_76" style="word-spacing:-0.0459em;">&nbsp;</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.0459em;">数 据</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.0459em;">&nbsp;集 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:8.4207em;"><span class="stl_58 stl_59 stl_77" style="word-spacing:0.2938em;">* Create</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.3545em;">&nbsp;the Redis databases</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.0842em;">&nbsp;,</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.3348em;">&nbsp;and</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.3928em;">&nbsp;i</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;n</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;i</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;t</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2622em;">&nbsp;i</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;a</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;l</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;i</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;z</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2622em;">&nbsp;e</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.4668em;">&nbsp;other &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:9.6867em;"><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">i n</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">&nbsp;e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">&nbsp;r</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.213em;">&nbsp;n</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">&nbsp;a</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">&nbsp;l</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.546em;">&nbsp;s</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;a</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.062em;">&nbsp;.</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.438em;">&nbsp;*/ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">2.3. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">如何运作 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">17 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:7.9808em;"><span class="stl_15 stl_16 stl_78">for</span><span class="stl_15 stl_16 stl_78" style="word-spacing:0.5905em;">&nbsp;</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.5905em;">(</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.0366em;">&nbsp;j</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.4396em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.6726em;">&nbsp;j</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.4126em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.4696em;">&nbsp;server</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.0896em;">&nbsp;.REDIS_DEFAULT_DBNUM;</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.6926em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.3976em;">&nbsp;{</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.4938em;">&nbsp;</span><span class="stl_58 stl_59 stl_78" style="word-spacing:0.4938em;">//</span><span class="stl_58 stl_59 stl_78" style="word-spacing:0.5444em;">&nbsp;</span><span class="stl_17 stl_18 stl_78" style="word-spacing:0.4938em;">初 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.9373em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">始 化 多 个 数 据 库 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">哈 希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;表，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;于</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;储</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;键</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;值</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;对 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:10.01em;"><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1212em;">server .</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.2362em;">&nbsp;db</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.2352em;">&nbsp;[</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1182em;">&nbsp;j</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.0652em;">&nbsp;]</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.2112em;">&nbsp;.</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.0652em;">&nbsp;dict</span><span class="stl_10 stl_11 stl_80" style="word-spacing:0.2238em;">&nbsp;= dictCreate(&amp;dbDictType</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1382em;">&nbsp;,NULL)</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1382em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">哈 希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;表，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;于</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;储</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;每</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;键</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;过</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;期</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:10.01em;"><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.1732em;">server .</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.2882em;">&nbsp;db</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.2872em;">&nbsp;[</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.1702em;">&nbsp;j</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.1172em;">&nbsp;]</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.2632em;">&nbsp;.</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.1182em;">&nbsp;expires</span><span class="stl_10 stl_11 stl_81" style="word-spacing:0.1713em;">&nbsp;= dictCreate(&amp;keyptrDictType</span><span class="stl_10 stl_11 stl_81" style="word-spacing:0.1713em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:11.4933em;"><span class="stl_10 stl_11 stl_82" style="word-spacing:0.1035em;">NULL) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:10.01em;"><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1781em;">server .</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2931em;">&nbsp;db</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2921em;">&nbsp;[</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1751em;">&nbsp;j</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1221em;">&nbsp;]</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2681em;">&nbsp;.</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1601em;">&nbsp;blocking_keys</span><span class="stl_10 stl_11 stl_83" style="word-spacing:0.1359em;">&nbsp;=</span><span class="stl_10 stl_11 stl_83" style="word-spacing:0.1589em;">&nbsp;dictCreate(&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:11.6508em;"><span class="stl_10 stl_11 stl_84" style="word-spacing:-0.0847em;">keylistDictType ,NULL) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:10.01em;"><span class="stl_10 stl_11 stl_85" style="word-spacing:-0.1565em;">server .</span><span class="stl_10 stl_11 stl_85" style="word-spacing:-0.2715em;">&nbsp;db</span><span class="stl_10 stl_11 stl_85" style="word-spacing:-0.2705em;">&nbsp;[</span><span class="stl_10 stl_11 stl_85" style="word-spacing:-0.1535em;">&nbsp;j</span><span class="stl_10 stl_11 stl_85" style="word-spacing:-0.1005em;">&nbsp;]</span><span class="stl_10 stl_11 stl_85" style="word-spacing:-0.2465em;">&nbsp;.</span><span class="stl_10 stl_11 stl_85" style="word-spacing:-0.1615em;">&nbsp;ready_keys</span><span class="stl_10 stl_11 stl_85" style="word-spacing:0.1345em;">&nbsp;=</span><span class="stl_10 stl_11 stl_85" style="word-spacing:0.1805em;">&nbsp;dictCreate(&amp;setDictType</span><span class="stl_10 stl_11 stl_85" style="word-spacing:0.1805em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.4933em;"><span class="stl_10 stl_11 stl_82" style="word-spacing:0.1035em;">NULL) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:10.01em;"><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.1507em;">server .</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2657em;">&nbsp;db</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2647em;">&nbsp;[</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.1477em;">&nbsp;j</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.0947em;">&nbsp;]</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2407em;">&nbsp;.</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.1687em;">&nbsp;watched_keys</span><span class="stl_10 stl_11 stl_86" style="word-spacing:0.1283em;">&nbsp;=</span><span class="stl_10 stl_11 stl_86" style="word-spacing:0.1863em;">&nbsp;dictCreate(&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:11.6508em;"><span class="stl_10 stl_11 stl_84" style="word-spacing:-0.0847em;">keylistDictType ,NULL) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:10.01em;"><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.1933em;">server .</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.3083em;">&nbsp;db</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.3073em;">&nbsp;[</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.1903em;">&nbsp;j</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.1373em;">&nbsp;]</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.2833em;">&nbsp;.</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.1613em;">&nbsp;id</span><span class="stl_10 stl_11 stl_87" style="word-spacing:0.1347em;">&nbsp;=</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.0153em;">&nbsp;j</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.0153em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:10.01em;"><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.1815em;">server .</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.2965em;">&nbsp;db</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.2955em;">&nbsp;[</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.1785em;">&nbsp;j</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.1255em;">&nbsp;]</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.2715em;">&nbsp;.</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.1635em;">&nbsp;avg_ttl</span><span class="stl_10 stl_11 stl_88" style="word-spacing:0.1325em;">&nbsp;=</span><span class="stl_10 stl_11 stl_88" style="word-spacing:0.1655em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 21.6593em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 21.6593em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_89">/</span><span class="stl_58 stl_59 stl_89" style="word-spacing:0.6234em;">&nbsp;</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.6234em;">创</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.0633em;">&nbsp;建 接 收</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.4869em;">&nbsp;</span><span class="stl_58 stl_59 stl_89" style="word-spacing:0.4869em;">TCP</span><span class="stl_58 stl_59 stl_89" style="word-spacing:0.4861em;">&nbsp;</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.4861em;">或</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.0626em;">&nbsp;者</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.5212em;">&nbsp;</span><span class="stl_58 stl_59 stl_89" style="word-spacing:0.5212em;">UNIX</span><span class="stl_58 stl_59 stl_89" style="word-spacing:0.5202em;">&nbsp;</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.5202em;">域</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.0636em;">&nbsp;套 接 字 的 事 件 处</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.0636em;">&nbsp;理 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4207em;"><span class="stl_58 stl_59 stl_90" style="word-spacing:0.485em;">/ TCP &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_91" style="word-spacing:0.2742em;">* Create an event</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.3786em;">&nbsp;handler for accepting</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.2756em;">&nbsp;new</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.2756em;">&nbsp;connections &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:9.65em;"><span class="stl_58 stl_59 stl_92" style="word-spacing:0.3182em;">in TCP</span><span class="stl_58 stl_59 stl_92" style="word-spacing:0.2603em;">&nbsp;and</span><span class="stl_58 stl_59 stl_92" style="word-spacing:0.4042em;">&nbsp;Unix &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 26.6426em; left:9.4371em;"><span class="stl_58 stl_59 stl_93" style="word-spacing:0.3488em;">domain sockets</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.1592em;">&nbsp;.</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.3558em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:7.9808em;"><span class="stl_15 stl_16 stl_94">for</span><span class="stl_15 stl_16 stl_94" style="word-spacing:0.3555em;">&nbsp;</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.3555em;">(</span><span class="stl_10 stl_11 stl_94" style="word-spacing:-0.1984em;">&nbsp;j</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.2046em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.4376em;">&nbsp;j</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.1776em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.2346em;">&nbsp;server</span><span class="stl_10 stl_11 stl_94" style="word-spacing:-0.1454em;">&nbsp;.</span><span class="stl_10 stl_11 stl_94" style="word-spacing:-0.1884em;">&nbsp;ipfd_count</span><span class="stl_10 stl_11 stl_94" style="word-spacing:-0.1884em;">&nbsp;;</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.4576em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.4576em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:10.4132em;"><span class="stl_58 stl_59 stl_95" style="word-spacing:0.3001em;">/ acceptTcpHandler</span><span class="stl_58 stl_59 stl_95" style="word-spacing:-0.2319em;">&nbsp;()</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.3911em;">&nbsp;tcp</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.364em;">&nbsp;</span><span class="stl_17 stl_18 stl_95" style="word-spacing:0.364em;">连</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;接</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;接</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;受</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;处</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;理</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;函</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:10.0375em;"><span class="stl_15 stl_16 stl_96" style="word-spacing:-0.3313em;">i f</span><span class="stl_15 stl_16 stl_96" style="word-spacing:0.3751em;">&nbsp;</span><span class="stl_10 stl_11 stl_96" style="word-spacing:0.3751em;">(</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2843em;">&nbsp;aeCreateFileEvent</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2843em;">&nbsp;(</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2583em;">&nbsp;server</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2033em;">&nbsp;.</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2263em;">&nbsp;el</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.1073em;">&nbsp;,</span><span class="stl_10 stl_11 stl_96" style="word-spacing:0.3977em;">&nbsp;server</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2033em;">&nbsp;.</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2053em;">&nbsp;ipfd</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2063em;">&nbsp;[</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.1993em;">&nbsp;j</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.1993em;">&nbsp;]</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.1993em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:11.4692em;"><span class="stl_10 stl_11 stl_97">AE_READABLE, &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:11.9583em;"><span class="stl_10 stl_11 stl_98" style="word-spacing:0.0443em;">acceptTcpHandler ,NULL)</span><span class="stl_10 stl_11 stl_98" style="word-spacing:0.2893em;">&nbsp;==</span><span class="stl_10 stl_11 stl_98" style="word-spacing:0.0783em;">&nbsp;AE_ERR) &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:11.925em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 34.611em; left:13.9875em;"><span class="stl_10 stl_11 stl_99" style="word-spacing:-0.2794em;">redisPanic ( &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:15.9217em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 35.6068em; left:16.4588em;"><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.2957em;">Unrecoverable ␣ error ␣ creating ␣ server . ipfd &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:17.57em;"><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.2351em;">␣ f i l e ␣ event . ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.596em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 39.5918em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 39.5918em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 42.341em; left:7.5658em;"><span class="stl_17 stl_18 stl_102" style="word-spacing:0.0902em;">在这里，创建了事件中心，是 </span><span class="stl_10 stl_11 stl_102" style="word-spacing:0.0902em;">redis </span><span class="stl_17 stl_18 stl_102" style="word-spacing:0.0902em;">的网络模块，如果你有学过 </span><span class="stl_10 stl_11 stl_102" style="word-spacing:0.0902em;">linux </span><span class="stl_17 stl_18 stl_102" style="word-spacing:0.0902em;">下的网络 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.3377em; left:5.9058em;"><span class="stl_17 stl_18 stl_103" style="word-spacing:0.081em;">编程，那么知道这里一定和 </span><span class="stl_10 stl_11 stl_103" style="word-spacing:0.081em;">select/epoll/kqueue </span><span class="stl_17 stl_18 stl_103" style="word-spacing:0.081em;">相关。 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:7.5658em;"><span class="stl_17 stl_18 stl_31" style="word-spacing:0.0817em;">接着，是初始化数据中心，我们平时使用 </span><span class="stl_10 stl_11 stl_31" style="word-spacing:0.0817em;">redis </span><span class="stl_17 stl_18 stl_31" style="word-spacing:0.0817em;">设置的键值对，就是存储在里面。 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">这里不急着深入它是怎么做到存储我们的键值对的，接着往下看好了，因为我们主要 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">是想把大致的脉络弄清楚。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">18 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.3517em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">初探</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0836em;">REDIS &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7576em; left:7.5658em;"><span class="stl_17 stl_18 stl_104" style="word-spacing:0.0941em;">在最后一段的代码中，</span><span class="stl_10 stl_11 stl_104" style="word-spacing:0.0941em;">redis </span><span class="stl_17 stl_18 stl_104" style="word-spacing:0.0941em;">给 </span><span class="stl_10 stl_11 stl_104" style="word-spacing:0.0941em;">listen fd </span><span class="stl_17 stl_18 stl_104" style="word-spacing:0.0941em;">注册了回调函数 </span><span class="stl_10 stl_11 stl_104" style="word-spacing:0.0941em;">acceptTcpHandler</span><span class="stl_17 stl_18 stl_104" style="word-spacing:0.0941em;">，也 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.9757em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">就是说当新的客户端连接的时候，这个函数会被调用，详情接下来再展开。 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.1277em; left:5.9058em;"><span class="stl_15 stl_16 stl_07">aeMain &nbsp;</span></div>
					<div class="stl_01" style="top: 12.9657em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">接着就开始等待请求的到来。 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.3093em; left:5.9483em;"><span class="stl_15 stl_16 stl_105">void</span><span class="stl_15 stl_16 stl_105" style="word-spacing:0.3121em;">&nbsp;</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.3121em;">aeMain</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.235em;">&nbsp;(</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.219em;">&nbsp;aeEventLoop</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.325em;">&nbsp;*eventLoop</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.207em;">&nbsp;)</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.207em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.311em; left:7.9625em;z-index:163; "><span class="stl_10 stl_11 stl_106" style="word-spacing:0.2377em;">eventLoop</span><span class="stl_107 stl_108 stl_106" style="word-spacing:0.2377em;">−</span><span class="stl_10 stl_11 stl_106" style="word-spacing:0.2377em;">&gt;stop =</span><span class="stl_10 stl_11 stl_106" style="word-spacing:0.2667em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.3018em; left:7.9483em;z-index:188; "><span class="stl_15 stl_16 stl_109">while</span><span class="stl_15 stl_16 stl_109" style="word-spacing:0.4647em;">&nbsp;</span><span class="stl_10 stl_11 stl_109" style="word-spacing:0.4647em;">(</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.1971em;">&nbsp;!</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.1181em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_109" style="word-spacing:-0.1181em;">−</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.1181em;">&gt;stop</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.1561em;">&nbsp;)</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.1561em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.301em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.301em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">进 入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;事</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;件</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;循</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;环</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;能</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;睡</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;眠</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;状</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;态。</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;在</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;睡</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;眠</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;之</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;前，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;执</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;预 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.2976em; left:11.6342em;"><span class="stl_17 stl_18 stl_110" style="word-spacing:-0.2891em;">设 置</span><span class="stl_17 stl_18 stl_110" style="word-spacing:-0.2881em;">&nbsp;的</span><span class="stl_17 stl_18 stl_110" style="word-spacing:-0.2881em;">&nbsp;函</span><span class="stl_17 stl_18 stl_110" style="word-spacing:-0.2881em;">&nbsp;数</span><span class="stl_17 stl_18 stl_110" style="word-spacing:0.3314em;">&nbsp;</span><span class="stl_58 stl_59 stl_110" style="word-spacing:0.3314em;">aeSetBeforeSleepProc</span><span class="stl_58 stl_59 stl_110" style="word-spacing:-0.2421em;">&nbsp;()</span><span class="stl_58 stl_59 stl_110" style="word-spacing:-0.2613em;">&nbsp;</span><span class="stl_17 stl_18 stl_110" style="word-spacing:-0.2421em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2868em; left:10.0375em;z-index:263; "><span class="stl_15 stl_16 stl_111" style="word-spacing:-0.1306em;">i f</span><span class="stl_15 stl_16 stl_111" style="word-spacing:0.5758em;">&nbsp;</span><span class="stl_10 stl_11 stl_111" style="word-spacing:0.5758em;">(</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1236em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_111" style="word-spacing:-0.1236em;">−</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1236em;">&gt;b</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1536em;">&nbsp;e</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1526em;">&nbsp;f</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1536em;">&nbsp;o</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1526em;">&nbsp;r</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1536em;">&nbsp;e</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1526em;">&nbsp;s</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1536em;">&nbsp;l</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1526em;">&nbsp;e</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1536em;">&nbsp;e</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1526em;">&nbsp;p</span><span class="stl_10 stl_11 stl_111" style="word-spacing:0.4944em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_111" style="word-spacing:0.2714em;">&nbsp;NULL) &nbsp;</span></div>
					<div class="stl_01" style="top: 23.2885em; left:11.9475em;z-index:292; "><span class="stl_10 stl_11 stl_112" style="word-spacing:-0.2088em;">eventLoop</span><span class="stl_107 stl_108 stl_112" style="word-spacing:-0.2088em;">−</span><span class="stl_10 stl_11 stl_112" style="word-spacing:-0.2088em;">&gt;b e f o r e s l e e p ( eventLoop ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.2826em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.2826em; left:10.4132em;"><span class="stl_58 stl_59 stl_113" style="word-spacing:0.4967em;">/ AE_ALL_EVENTS</span><span class="stl_58 stl_59 stl_113" style="word-spacing:0.5356em;">&nbsp;</span><span class="stl_17 stl_18 stl_113" style="word-spacing:0.5356em;">表</span><span class="stl_17 stl_18 stl_113" style="word-spacing:0.1247em;">&nbsp;示 处 理 所 有 的 事</span><span class="stl_17 stl_18 stl_113" style="word-spacing:0.1247em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.2768em; left:9.985em;"><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.096em;">aeProcessEvents (</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.131em;">&nbsp;eventLoop</span><span class="stl_10 stl_11 stl_114" style="word-spacing:0.002em;">&nbsp;,</span><span class="stl_10 stl_11 stl_114" style="word-spacing:0.355em;">&nbsp;AE_ALL_EVENTS)</span><span class="stl_10 stl_11 stl_114" style="word-spacing:0.355em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.2735em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.2693em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.8901em; left:7.5658em;"><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0852em;">前面的两个函数都属于是初始化的工作，到这里的时候，</span><span class="stl_10 stl_11 stl_115" style="word-spacing:0.0852em;">redis </span><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0852em;">正式进入等待接 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.886em; left:5.9058em;"><span class="stl_17 stl_18 stl_116" style="word-spacing:0.0807em;">收请求的状态。具体的实现，和 </span><span class="stl_10 stl_11 stl_116" style="word-spacing:0.0807em;">select/epoll/kqueue </span><span class="stl_17 stl_18 stl_116" style="word-spacing:0.0807em;">这些 </span><span class="stl_10 stl_11 stl_116" style="word-spacing:0.0807em;">IO </span><span class="stl_17 stl_18 stl_116" style="word-spacing:0.0807em;">多路复用的系统调用相 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.1048em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">关，而这也是网络编程的基础部分了。继续跟踪调用链： &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4485em; left:5.9875em;"><span class="stl_15 stl_16 stl_117">int</span><span class="stl_15 stl_16 stl_117" style="word-spacing:0.3757em;">&nbsp;</span><span class="stl_10 stl_11 stl_117" style="word-spacing:0.3757em;">aeProcessEvents</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2182em;">&nbsp;(</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2582em;">&nbsp;aeEventLoop</span><span class="stl_10 stl_11 stl_117" style="word-spacing:0.2858em;">&nbsp;*eventLoop</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.1202em;">&nbsp;,</span><span class="stl_10 stl_11 stl_117" style="word-spacing:0.4225em;">&nbsp;</span><span class="stl_15 stl_16 stl_117" style="word-spacing:0.4225em;">int</span><span class="stl_15 stl_16 stl_117" style="word-spacing:0.4319em;">&nbsp;</span><span class="stl_10 stl_11 stl_117" style="word-spacing:0.4319em;">f</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2672em;">&nbsp;l</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2672em;">&nbsp;a</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2662em;">&nbsp;g</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2672em;">&nbsp;s</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2672em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4502em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 37.446em; left:10.12em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 37.446em; left:10.5791em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4443em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.4443em; left:10.4132em;"><span class="stl_58 stl_59 stl_118">/</span><span class="stl_58 stl_59 stl_118" style="word-spacing:0.4778em;">&nbsp;</span><span class="stl_17 stl_18 stl_118" style="word-spacing:0.4778em;">调</span><span class="stl_17 stl_18 stl_118" style="word-spacing:-0.083em;">&nbsp;用</span><span class="stl_17 stl_18 stl_118" style="word-spacing:0.4338em;">&nbsp;</span><span class="stl_58 stl_59 stl_118" style="word-spacing:0.4338em;">IO</span><span class="stl_58 stl_59 stl_118" style="word-spacing:0.434em;">&nbsp;</span><span class="stl_17 stl_18 stl_118" style="word-spacing:0.434em;">多</span><span class="stl_17 stl_18 stl_118" style="word-spacing:-0.083em;">&nbsp;路</span><span class="stl_17 stl_18 stl_118" style="word-spacing:-0.082em;">&nbsp;复</span><span class="stl_17 stl_18 stl_118" style="word-spacing:-0.082em;">&nbsp;用</span><span class="stl_17 stl_18 stl_118" style="word-spacing:-0.082em;">&nbsp;函</span><span class="stl_17 stl_18 stl_118" style="word-spacing:-0.082em;">&nbsp;数</span><span class="stl_17 stl_18 stl_118" style="word-spacing:-0.082em;">&nbsp;阻</span><span class="stl_17 stl_18 stl_118" style="word-spacing:-0.082em;">&nbsp;塞</span><span class="stl_17 stl_18 stl_118" style="word-spacing:-0.082em;">&nbsp;监</span><span class="stl_17 stl_18 stl_118" style="word-spacing:-0.082em;">&nbsp;听 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4385em; left:9.9483em;"><span class="stl_10 stl_11 stl_119" style="word-spacing:0.1575em;">numevents =</span><span class="stl_10 stl_11 stl_119" style="word-spacing:-0.0029em;">&nbsp;aeApiPoll (</span><span class="stl_10 stl_11 stl_119" style="word-spacing:-0.2405em;">&nbsp;eventLoop</span><span class="stl_10 stl_11 stl_119" style="word-spacing:-0.1065em;">&nbsp;,</span><span class="stl_10 stl_11 stl_119" style="word-spacing:0.4195em;">&nbsp;tvp</span><span class="stl_10 stl_11 stl_119" style="word-spacing:-0.2355em;">&nbsp;)</span><span class="stl_10 stl_11 stl_119" style="word-spacing:-0.2355em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.4326em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">处</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;理</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;已</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;经</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;触</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:9.9733em;"><span class="stl_15 stl_16 stl_120">for</span><span class="stl_15 stl_16 stl_120" style="word-spacing:0.4218em;">&nbsp;</span><span class="stl_10 stl_11 stl_120" style="word-spacing:0.4218em;">(</span><span class="stl_10 stl_11 stl_120" style="word-spacing:-0.1321em;">&nbsp;j</span><span class="stl_10 stl_11 stl_120" style="word-spacing:0.2709em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_120" style="word-spacing:0.5039em;">&nbsp;j</span><span class="stl_10 stl_11 stl_120" style="word-spacing:0.2354em;">&nbsp;&lt; numevents</span><span class="stl_10 stl_11 stl_120" style="word-spacing:-0.1531em;">&nbsp;;</span><span class="stl_10 stl_11 stl_120" style="word-spacing:0.5239em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_120" style="word-spacing:0.5239em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.4251em; left:12.4057em;"><span class="stl_58 stl_59 stl_121">/</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.5858em;">&nbsp;</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.5858em;">找</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.025em;">&nbsp;到</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.6341em;">&nbsp;</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.6341em;">I</span><span class="stl_58 stl_59 stl_121" style="word-spacing:-0.023em;">&nbsp;/O</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.4419em;">&nbsp;</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.4419em;">事</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.0259em;">&nbsp;件 表 中 存 储 的 数</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.0259em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:11.98em;z-index:697; "><span class="stl_10 stl_11 stl_122" style="word-spacing:0.3605em;">aeFileEvent *</span><span class="stl_10 stl_11 stl_122" style="word-spacing:-0.2065em;">&nbsp;fe</span><span class="stl_10 stl_11 stl_122" style="word-spacing:0.2545em;">&nbsp;=</span><span class="stl_10 stl_11 stl_122" style="word-spacing:-0.1089em;">&nbsp;&amp;eventLoop</span><span class="stl_107 stl_108 stl_122" style="word-spacing:-0.1089em;">−</span><span class="stl_10 stl_11 stl_122" style="word-spacing:-0.1089em;">&gt;events [</span><span class="stl_10 stl_11 stl_122" style="word-spacing:-0.1675em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_122" style="word-spacing:-0.1675em;">−</span><span class="stl_10 stl_11 stl_122" style="word-spacing:-0.1675em;">&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:13.685em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2244em;">f i r e d [ j ] . fd ] ; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4077em; left:11.965em;z-index:728; "><span class="stl_15 stl_16 stl_124">int</span><span class="stl_15 stl_16 stl_124" style="word-spacing:0.377em;">&nbsp;</span><span class="stl_10 stl_11 stl_124" style="word-spacing:0.377em;">mask</span><span class="stl_10 stl_11 stl_124" style="word-spacing:0.1884em;">&nbsp;=</span><span class="stl_10 stl_11 stl_124" style="word-spacing:0.2374em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_124" style="word-spacing:0.2374em;">−</span><span class="stl_10 stl_11 stl_124" style="word-spacing:0.2374em;">&gt;f</span><span class="stl_10 stl_11 stl_124" style="word-spacing:-0.1806em;">&nbsp;i</span><span class="stl_10 stl_11 stl_124" style="word-spacing:-0.1806em;">&nbsp;r</span><span class="stl_10 stl_11 stl_124" style="word-spacing:-0.1816em;">&nbsp;e</span><span class="stl_10 stl_11 stl_124" style="word-spacing:-0.1806em;">&nbsp;d</span><span class="stl_10 stl_11 stl_124" style="word-spacing:-0.0196em;">&nbsp;[</span><span class="stl_10 stl_11 stl_124" style="word-spacing:-0.0436em;">&nbsp;j</span><span class="stl_10 stl_11 stl_124" style="word-spacing:-0.1272em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_124" style="word-spacing:-0.1076em;">&nbsp;mask</span><span class="stl_10 stl_11 stl_124" style="word-spacing:-0.1076em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:11.965em;z-index:759; "><span class="stl_15 stl_16 stl_125">int</span><span class="stl_15 stl_16 stl_125" style="word-spacing:0.4263em;">&nbsp;</span><span class="stl_10 stl_11 stl_125" style="word-spacing:0.4263em;">fd</span><span class="stl_10 stl_11 stl_125" style="word-spacing:0.2383em;">&nbsp;=</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.0113em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_125" style="word-spacing:-0.0113em;">−</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.0113em;">&gt;f i</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2157em;">&nbsp;r</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2147em;">&nbsp;e</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2147em;">&nbsp;d</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.0547em;">&nbsp;[</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.0777em;">&nbsp;j</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.0237em;">&nbsp;]</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.1707em;">&nbsp;.</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.0587em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.0587em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">2.3. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">如何运作 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">19 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:11.965em;"><span class="stl_15 stl_16 stl_126">int</span><span class="stl_15 stl_16 stl_126" style="word-spacing:0.3998em;">&nbsp;</span><span class="stl_10 stl_11 stl_126" style="word-spacing:0.3998em;">r</span><span class="stl_10 stl_11 stl_126" style="word-spacing:-0.2993em;">&nbsp;f</span><span class="stl_10 stl_11 stl_126" style="word-spacing:-0.2993em;">&nbsp;i</span><span class="stl_10 stl_11 stl_126" style="word-spacing:-0.2993em;">&nbsp;r</span><span class="stl_10 stl_11 stl_126" style="word-spacing:-0.2993em;">&nbsp;e</span><span class="stl_10 stl_11 stl_126" style="word-spacing:-0.2993em;">&nbsp;d</span><span class="stl_10 stl_11 stl_126" style="word-spacing:0.2117em;">&nbsp;=</span><span class="stl_10 stl_11 stl_126" style="word-spacing:0.1757em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.4383em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.9108em;z-index:39; "><span class="stl_58 stl_59 stl_127" style="word-spacing:0.4026em;">* note</span><span class="stl_58 stl_59 stl_127" style="word-spacing:0.4671em;">&nbsp;the fe</span><span class="stl_107 stl_108 stl_127" style="word-spacing:0.4671em;">−</span><span class="stl_58 stl_59 stl_127" style="word-spacing:0.4671em;">&gt;mask</span><span class="stl_58 stl_59 stl_127" style="word-spacing:0.1926em;">&nbsp;&amp; mask &amp;</span><span class="stl_58 stl_59 stl_127" style="word-spacing:0.3726em;">&nbsp;.</span><span class="stl_58 stl_59 stl_127" style="word-spacing:-0.1454em;">&nbsp;.</span><span class="stl_58 stl_59 stl_127" style="word-spacing:-0.1444em;">&nbsp;.</span><span class="stl_58 stl_59 stl_127" style="word-spacing:0.5476em;">&nbsp;code</span><span class="stl_58 stl_59 stl_127" style="word-spacing:-0.1264em;">&nbsp;:</span><span class="stl_58 stl_59 stl_127" style="word-spacing:0.4266em;">&nbsp;maybe</span><span class="stl_58 stl_59 stl_127" style="word-spacing:0.3216em;">&nbsp;an &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:12.1575em;"><span class="stl_58 stl_59 stl_128" style="word-spacing:0.3509em;">already processed &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 9.706em; left:13.4777em;"><span class="stl_58 stl_59 stl_129" style="word-spacing:0.3545em;">event removed</span><span class="stl_58 stl_59 stl_129" style="word-spacing:0.2755em;">&nbsp;an</span><span class="stl_58 stl_59 stl_129" style="word-spacing:0.3125em;">&nbsp;element</span><span class="stl_58 stl_59 stl_129" style="word-spacing:0.4125em;">&nbsp;that</span><span class="stl_58 stl_59 stl_129" style="word-spacing:0.4725em;">&nbsp;f</span><span class="stl_58 stl_59 stl_129" style="word-spacing:-0.2715em;">&nbsp;i</span><span class="stl_58 stl_59 stl_129" style="word-spacing:-0.2705em;">&nbsp;r</span><span class="stl_58 stl_59 stl_129" style="word-spacing:-0.2715em;">&nbsp;e</span><span class="stl_58 stl_59 stl_129" style="word-spacing:-0.2705em;">&nbsp;d</span><span class="stl_58 stl_59 stl_129" style="word-spacing:0.3825em;">&nbsp;and</span><span class="stl_58 stl_59 stl_129" style="word-spacing:0.2435em;">&nbsp;we &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:14.2408em;"><span class="stl_58 stl_59 stl_130" style="word-spacing:-0.2133em;">s t</span><span class="stl_58 stl_59 stl_130" style="word-spacing:-0.2133em;">&nbsp;i</span><span class="stl_58 stl_59 stl_130" style="word-spacing:-0.2133em;">&nbsp;l</span><span class="stl_58 stl_59 stl_130" style="word-spacing:-0.2133em;">&nbsp;l</span><span class="stl_58 stl_59 stl_130" style="word-spacing:0.4887em;">&nbsp;didn</span><span class="stl_58 stl_59 stl_130" style="word-spacing:-0.1563em;">&nbsp;’</span><span class="stl_58 stl_59 stl_130" style="word-spacing:-0.1563em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 11.6985em; left:13.4711em;"><span class="stl_58 stl_59 stl_131" style="word-spacing:-0.0963em;">processed ,</span><span class="stl_58 stl_59 stl_131" style="word-spacing:0.3707em;">&nbsp;so</span><span class="stl_58 stl_59 stl_131" style="word-spacing:0.2562em;">&nbsp;we check</span><span class="stl_58 stl_59 stl_131" style="word-spacing:0.4337em;">&nbsp;i</span><span class="stl_58 stl_59 stl_131" style="word-spacing:-0.2733em;">&nbsp;f</span><span class="stl_58 stl_59 stl_131" style="word-spacing:0.4497em;">&nbsp;the</span><span class="stl_58 stl_59 stl_131" style="word-spacing:0.3947em;">&nbsp;event i</span><span class="stl_58 stl_59 stl_131" style="word-spacing:-0.3083em;">&nbsp;s</span><span class="stl_58 stl_59 stl_131" style="word-spacing:0.5317em;">&nbsp;s</span><span class="stl_58 stl_59 stl_131" style="word-spacing:-0.2293em;">&nbsp;t</span><span class="stl_58 stl_59 stl_131" style="word-spacing:-0.2293em;">&nbsp;i</span><span class="stl_58 stl_59 stl_131" style="word-spacing:-0.2293em;">&nbsp;l</span><span class="stl_58 stl_59 stl_131" style="word-spacing:-0.2293em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:14.1742em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.212em;">v a</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.21em;">&nbsp;l</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.211em;">&nbsp;i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.211em;">&nbsp;d</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.064em;">&nbsp;.</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.435em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">读</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:12.03em;z-index:184; "><span class="stl_15 stl_16 stl_133" style="word-spacing:0.0096em;">i f</span><span class="stl_15 stl_16 stl_133" style="word-spacing:0.716em;">&nbsp;</span><span class="stl_10 stl_11 stl_133" style="word-spacing:0.716em;">(</span><span class="stl_10 stl_11 stl_133" style="word-spacing:0.0516em;">&nbsp;fe</span><span class="stl_107 stl_108 stl_133" style="word-spacing:0.0516em;">−</span><span class="stl_10 stl_11 stl_133" style="word-spacing:0.0516em;">&gt;mask</span><span class="stl_10 stl_11 stl_133" style="word-spacing:0.3736em;">&nbsp;&amp; mask &amp;</span><span class="stl_10 stl_11 stl_133" style="word-spacing:0.2386em;">&nbsp;AE_READABLE)</span><span class="stl_10 stl_11 stl_133" style="word-spacing:0.2386em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:14.0217em;z-index:212; "><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.356em;">r f</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.356em;">&nbsp;i</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.356em;">&nbsp;r</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.356em;">&nbsp;e</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.356em;">&nbsp;d</span><span class="stl_10 stl_11 stl_62" style="word-spacing:0.155em;">&nbsp;=</span><span class="stl_10 stl_11 stl_62" style="word-spacing:0.119em;">&nbsp;1; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:13.9692em;z-index:247; "><span class="stl_10 stl_11 stl_134" style="word-spacing:-0.1829em;">fe</span><span class="stl_107 stl_108 stl_134" style="word-spacing:-0.1829em;">−</span><span class="stl_10 stl_11 stl_134" style="word-spacing:-0.1829em;">&gt;r f i l e P r o c ( eventLoop , fd , fe</span><span class="stl_107 stl_108 stl_134" style="word-spacing:-0.1829em;">−</span><span class="stl_10 stl_11 stl_134" style="word-spacing:-0.1829em;">&gt;clientData , &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:15.56em;"><span class="stl_10 stl_11 stl_135" style="word-spacing:-0.0935em;">mask) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 19.6685em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:12.03em;z-index:277; "><span class="stl_15 stl_16 stl_136" style="word-spacing:0.0024em;">i f</span><span class="stl_15 stl_16 stl_136" style="word-spacing:0.7088em;">&nbsp;</span><span class="stl_10 stl_11 stl_136" style="word-spacing:0.7088em;">(</span><span class="stl_10 stl_11 stl_136" style="word-spacing:0.0444em;">&nbsp;fe</span><span class="stl_107 stl_108 stl_136" style="word-spacing:0.0444em;">−</span><span class="stl_10 stl_11 stl_136" style="word-spacing:0.0444em;">&gt;mask</span><span class="stl_10 stl_11 stl_136" style="word-spacing:0.3664em;">&nbsp;&amp; mask &amp;</span><span class="stl_10 stl_11 stl_136" style="word-spacing:0.2384em;">&nbsp;AE_WRITABLE)</span><span class="stl_10 stl_11 stl_136" style="word-spacing:0.2384em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:14.0225em;z-index:331; "><span class="stl_15 stl_16 stl_137" style="word-spacing:-0.2387em;">i f</span><span class="stl_15 stl_16 stl_137" style="word-spacing:0.54em;">&nbsp;</span><span class="stl_10 stl_11 stl_137" style="word-spacing:0.54em;">(</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2377em;">&nbsp;!</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.0607em;">&nbsp;r</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2387em;">&nbsp;f</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2387em;">&nbsp;i</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2387em;">&nbsp;r</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2387em;">&nbsp;e</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2387em;">&nbsp;d</span><span class="stl_10 stl_11 stl_137" style="word-spacing:0.5763em;">&nbsp;|</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2007em;">&nbsp;|</span><span class="stl_10 stl_11 stl_137" style="word-spacing:0.5133em;">&nbsp;fe</span><span class="stl_107 stl_108 stl_137" style="word-spacing:0.5133em;">−</span><span class="stl_10 stl_11 stl_137" style="word-spacing:0.5133em;">&gt;wfileProc</span><span class="stl_10 stl_11 stl_137" style="word-spacing:0.3573em;">&nbsp;!= fe</span><span class="stl_107 stl_108 stl_137" style="word-spacing:0.3573em;">−</span><span class="stl_10 stl_11 stl_137" style="word-spacing:0.3573em;">&gt;r</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2467em;">&nbsp;f</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2457em;">&nbsp;i</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2467em;">&nbsp;l</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2457em;">&nbsp;e</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2467em;">&nbsp;P</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2457em;">&nbsp;r</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2467em;">&nbsp;o</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2467em;">&nbsp;c &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:15.6233em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 23.6518em; left:15.9617em;z-index:372; "><span class="stl_10 stl_11 stl_138" style="word-spacing:-0.1676em;">fe</span><span class="stl_107 stl_108 stl_138" style="word-spacing:-0.1676em;">−</span><span class="stl_10 stl_11 stl_138" style="word-spacing:-0.1676em;">&gt;wfileProc ( eventLoop , fd , fe</span><span class="stl_107 stl_108 stl_138" style="word-spacing:-0.1676em;">−</span><span class="stl_10 stl_11 stl_138" style="word-spacing:-0.1676em;">&gt;clientData &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:17.6625em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 24.6485em; left:18.0502em;"><span class="stl_10 stl_11 stl_139" style="word-spacing:-0.095em;">mask) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 26.641em; left:11.9892em;"><span class="stl_10 stl_11 stl_140">processed++; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.6335em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 30.6276em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.6276em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">处</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;理</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;定</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4207em;"><span class="stl_58 stl_59 stl_141" style="word-spacing:0.2791em;">* Check</span><span class="stl_58 stl_59 stl_141" style="word-spacing:0.3171em;">&nbsp;time</span><span class="stl_58 stl_59 stl_141" style="word-spacing:0.3831em;">&nbsp;events</span><span class="stl_58 stl_59 stl_141" style="word-spacing:0.3451em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6135em; left:8.045em;"><span class="stl_15 stl_16 stl_142" style="word-spacing:0.0911em;">i f</span><span class="stl_15 stl_16 stl_142" style="word-spacing:0.7975em;">&nbsp;</span><span class="stl_10 stl_11 stl_142" style="word-spacing:0.7975em;">(</span><span class="stl_10 stl_11 stl_142" style="word-spacing:0.1901em;">&nbsp;f</span><span class="stl_10 stl_11 stl_142" style="word-spacing:0.0856em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_142" style="word-spacing:0.5961em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_142" style="word-spacing:0.3361em;">&nbsp;AE_TIME_EVENTS) &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:9.9967em;"><span class="stl_10 stl_11 stl_143" style="word-spacing:0.1653em;">processed +=</span><span class="stl_10 stl_11 stl_143" style="word-spacing:-0.1024em;">&nbsp;processTimeEvents (</span><span class="stl_10 stl_11 stl_143" style="word-spacing:-0.2517em;">&nbsp;eventLoop</span><span class="stl_10 stl_11 stl_143" style="word-spacing:-0.2517em;">&nbsp;)</span><span class="stl_10 stl_11 stl_143" style="word-spacing:-0.2517em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:7.9458em;"><span class="stl_15 stl_16 stl_144">return</span><span class="stl_15 stl_16 stl_144" style="word-spacing:0.3291em;">&nbsp;</span><span class="stl_10 stl_11 stl_144" style="word-spacing:0.3291em;">processed</span><span class="stl_10 stl_11 stl_144" style="word-spacing:-0.1677em;">&nbsp;;</span><span class="stl_10 stl_11 stl_144" style="word-spacing:0.3655em;">&nbsp;</span><span class="stl_58 stl_59 stl_144" style="word-spacing:0.3655em;">/*</span><span class="stl_58 stl_59 stl_144" style="word-spacing:0.3273em;">&nbsp;return</span><span class="stl_58 stl_59 stl_144" style="word-spacing:0.3923em;">&nbsp;the</span><span class="stl_58 stl_59 stl_144" style="word-spacing:0.3188em;">&nbsp;number of</span><span class="stl_58 stl_59 stl_144" style="word-spacing:0.3963em;">&nbsp;processed</span><span class="stl_58 stl_59 stl_144" style="word-spacing:0.4833em;">&nbsp;f</span><span class="stl_58 stl_59 stl_144" style="word-spacing:-0.2417em;">&nbsp;i</span><span class="stl_58 stl_59 stl_144" style="word-spacing:-0.2417em;">&nbsp;l</span><span class="stl_58 stl_59 stl_144" style="word-spacing:-0.2417em;">&nbsp;e</span><span class="stl_58 stl_59 stl_144" style="word-spacing:-0.2417em;">&nbsp;/ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:9.6383em;"><span class="stl_58 stl_59 stl_145" style="word-spacing:0.3539em;">time events</span><span class="stl_58 stl_59 stl_145" style="word-spacing:0.3179em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 39.2335em; left:7.5658em;z-index:563; "><span class="stl_17 stl_18 stl_146" style="word-spacing:0.0822em;">可以看到，</span><span class="stl_10 stl_11 stl_146" style="word-spacing:0.0822em;">aeApiPoll </span><span class="stl_17 stl_18 stl_146" style="word-spacing:0.0822em;">即是 </span><span class="stl_10 stl_11 stl_146" style="word-spacing:0.0822em;">IO </span><span class="stl_17 stl_18 stl_146" style="word-spacing:0.0822em;">多路复用调用的地方，当有请求到来的时候，进程 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4515em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">会觉醒以处理到来的请求。 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.6039em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 42.6039em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.3.2 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">新连接的处理流程 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:7.5658em;"><span class="stl_17 stl_18 stl_147" style="word-spacing:0.113em;">在 </span><span class="stl_10 stl_11 stl_147" style="word-spacing:0.113em;">initServer </span><span class="stl_17 stl_18 stl_147" style="word-spacing:0.113em;">的讲解中，</span><span class="stl_10 stl_11 stl_147" style="word-spacing:0.113em;">redis </span><span class="stl_17 stl_18 stl_147" style="word-spacing:0.113em;">注册了回调函数 </span><span class="stl_10 stl_11 stl_147" style="word-spacing:0.113em;">acceptTcpHandler</span><span class="stl_17 stl_18 stl_147" style="word-spacing:0.113em;">，当有新的连 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_148" style="word-spacing:0.104em;">接到来时，这个函数会被回调，上面的函数指针 </span><span class="stl_10 stl_11 stl_148" style="word-spacing:0.104em;">rﬁleProc </span><span class="stl_17 stl_18 stl_148" style="word-spacing:0.104em;">实际上就是指向了 </span><span class="stl_10 stl_11 stl_148" style="word-spacing:0.104em;">ac- &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_10 stl_11 stl_56" style="word-spacing:0.0912em;">ceptTcpHandler</span><span class="stl_17 stl_18 stl_56" style="word-spacing:0.0912em;">。下面是 </span><span class="stl_10 stl_11 stl_56" style="word-spacing:0.0912em;">acceptTcpHandler </span><span class="stl_17 stl_18 stl_56" style="word-spacing:0.0912em;">的核心代码： &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">20 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.3517em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">初探</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0836em;">REDIS &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:6.4282em;"><span class="stl_58 stl_59 stl_149">/</span><span class="stl_58 stl_59 stl_149" style="word-spacing:0.6648em;">&nbsp;</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.6648em;">用</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.104em;">&nbsp;于</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.5284em;">&nbsp;</span><span class="stl_58 stl_59 stl_149" style="word-spacing:0.5284em;">TCP</span><span class="stl_58 stl_59 stl_149" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.5265em;">接</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.105em;">&nbsp;收 请 求 的 处 理 函</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.105em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:5.9483em;"><span class="stl_15 stl_16 stl_150">void</span><span class="stl_15 stl_16 stl_150" style="word-spacing:0.3246em;">&nbsp;</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.3246em;">acceptTcpHandler</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.2227em;">&nbsp;(</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.2447em;">&nbsp;aeEventLoop</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.2993em;">&nbsp;*</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.2547em;">&nbsp;el</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.0237em;">&nbsp;,</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.4358em;">&nbsp;</span><span class="stl_15 stl_16 stl_150" style="word-spacing:0.4358em;">int</span><span class="stl_15 stl_16 stl_150" style="word-spacing:0.3601em;">&nbsp;</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.3601em;">fd</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.0937em;">&nbsp;,</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.389em;">&nbsp;</span><span class="stl_15 stl_16 stl_150" style="word-spacing:0.389em;">void</span><span class="stl_15 stl_16 stl_150" style="word-spacing:0.2784em;">&nbsp;</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.2784em;">*</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.2637em;">&nbsp;privdata &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:7.7em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 8.7027em; left:8.6442em;"><span class="stl_15 stl_16 stl_151" style="word-spacing:0.3525em;">int </span><span class="stl_10 stl_11 stl_151" style="word-spacing:0.3525em;">mask) { &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:7.98em;"><span class="stl_15 stl_16 stl_152">int</span><span class="stl_15 stl_16 stl_152" style="word-spacing:0.3384em;">&nbsp;</span><span class="stl_10 stl_11 stl_152" style="word-spacing:0.3384em;">cport</span><span class="stl_10 stl_11 stl_152" style="word-spacing:-0.0965em;">&nbsp;,</span><span class="stl_10 stl_11 stl_152" style="word-spacing:0.4205em;">&nbsp;cfd</span><span class="stl_10 stl_11 stl_152" style="word-spacing:0.4205em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:7.9342em;"><span class="stl_15 stl_16 stl_153">char</span><span class="stl_15 stl_16 stl_153" style="word-spacing:0.549em;">&nbsp;</span><span class="stl_10 stl_11 stl_153" style="word-spacing:0.549em;">cip</span><span class="stl_10 stl_11 stl_153" style="word-spacing:0.0666em;">&nbsp;[REDIS_IP_STR_LEN</span><span class="stl_10 stl_11 stl_153" style="word-spacing:-0.0624em;">&nbsp;]</span><span class="stl_10 stl_11 stl_153" style="word-spacing:-0.0624em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:7.8358em;"><span class="stl_10 stl_11 stl_154" style="word-spacing:0.1487em;">REDIS_NOTUSED( e</span><span class="stl_10 stl_11 stl_154" style="word-spacing:0.0427em;">&nbsp;l</span><span class="stl_10 stl_11 stl_154" style="word-spacing:0.1497em;">&nbsp;)</span><span class="stl_10 stl_11 stl_154" style="word-spacing:0.1497em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.8358em;"><span class="stl_10 stl_11 stl_155" style="word-spacing:0.074em;">REDIS_NOTUSED(mask) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:7.8358em;"><span class="stl_10 stl_11 stl_156" style="word-spacing:-0.0077em;">REDIS_NOTUSED( privdata ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;收</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;客</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;户</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;端</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;请</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;求 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:8.0008em;"><span class="stl_10 stl_11 stl_157" style="word-spacing:0.1647em;">cfd =</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.1586em;">&nbsp;anetTcpAccept (</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.2203em;">&nbsp;server</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.1653em;">&nbsp;.</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.1863em;">&nbsp;neterr</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.0633em;">&nbsp;,</span><span class="stl_10 stl_11 stl_157" style="word-spacing:0.3747em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.1403em;">&nbsp;,</span><span class="stl_10 stl_11 stl_157" style="word-spacing:0.3947em;">&nbsp;cip</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.1003em;">&nbsp;,</span><span class="stl_10 stl_11 stl_157" style="word-spacing:0.4134em;">&nbsp;</span><span class="stl_15 stl_16 stl_157" style="word-spacing:0.4134em;">sizeof</span><span class="stl_15 stl_16 stl_157" style="word-spacing:-0.241em;">&nbsp;</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.241em;">(</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.2343em;">&nbsp;cip</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.2343em;">&nbsp;)</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.2343em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:10.1558em;"><span class="stl_10 stl_11 stl_158" style="word-spacing:-0.2435em;">cport ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:9.485em;"><span class="stl_10 stl_11 stl_07">&amp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">出</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;错 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:8.045em;"><span class="stl_15 stl_16 stl_159" style="word-spacing:0.0133em;">i f</span><span class="stl_15 stl_16 stl_159" style="word-spacing:0.7197em;">&nbsp;</span><span class="stl_10 stl_11 stl_159" style="word-spacing:0.7197em;">(</span><span class="stl_10 stl_11 stl_159" style="word-spacing:0.0663em;">&nbsp;cfd</span><span class="stl_10 stl_11 stl_159" style="word-spacing:0.4413em;">&nbsp;==</span><span class="stl_10 stl_11 stl_159" style="word-spacing:0.2123em;">&nbsp;AE_ERR)</span><span class="stl_10 stl_11 stl_159" style="word-spacing:0.2123em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:9.9933em;"><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.1507em;">redisLog (REDIS_WARNING, ” Accepting ␣ c l i e n t ␣ connection : ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:11.4542em;"><span class="stl_10 stl_11 stl_07">%</span></div>
					<div class="stl_01" style="top: 22.656em; left:12.135em;"><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.3682em;">s ”</span><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.2552em;">&nbsp;,</span><span class="stl_10 stl_11 stl_161" style="word-spacing:0.3168em;">&nbsp;server</span><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.2302em;">&nbsp;.</span><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.2322em;">&nbsp;neterr</span><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.2882em;">&nbsp;)</span><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.2882em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:9.9383em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 26.6426em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;录 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:8.0008em;"><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1106em;">redisLog (REDIS_VERBOSE,</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1146em;">&nbsp;”</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1896em;">&nbsp;Accepted␣%s:%d”</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.0606em;">&nbsp;,</span><span class="stl_10 stl_11 stl_163" style="word-spacing:0.4714em;">&nbsp;cip</span><span class="stl_10 stl_11 stl_163" style="word-spacing:0.0304em;">&nbsp;,</span><span class="stl_10 stl_11 stl_163" style="word-spacing:0.5414em;">&nbsp;cport</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1136em;">&nbsp;)</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1136em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">真</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;正</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;意</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;思</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;地</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;方 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:7.9483em;"><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.1512em;">acceptCommonHandler ( cfd , 0 ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 33.6143em; left:5.9742em;"><span class="stl_10 stl_11 stl_165">anetTcpAccept</span><span class="stl_10 stl_11 stl_165" style="word-spacing:0.3557em;">&nbsp;</span><span class="stl_17 stl_18 stl_165" style="word-spacing:0.3557em;">是</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2284em;">&nbsp;接</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;收</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;一</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2264em;">&nbsp;个</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;请</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;求</span><span class="stl_17 stl_18 stl_165" style="word-spacing:0.396em;">&nbsp;</span><span class="stl_10 stl_11 stl_165" style="word-spacing:0.396em;">cfd</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2029em;">&nbsp;</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2029em;">，</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2284em;">&nbsp;真</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;正</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;有</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;意</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;思</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;的</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;地</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;方</span><span class="stl_17 stl_18 stl_165" style="word-spacing:-0.2274em;">&nbsp;是 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:7.6158em;"><span class="stl_10 stl_11 stl_166">acceptCommonHandler</span><span class="stl_10 stl_11 stl_166" style="word-spacing:-0.21em;">&nbsp;</span><span class="stl_17 stl_18 stl_166" style="word-spacing:-0.21em;">，</span><span class="stl_17 stl_18 stl_166" style="word-spacing:-0.1703em;">&nbsp;而</span><span class="stl_17 stl_18 stl_166" style="word-spacing:0.3897em;">&nbsp;</span><span class="stl_10 stl_11 stl_166" style="word-spacing:0.3897em;">acceptCommonHandler</span><span class="stl_10 stl_11 stl_166" style="word-spacing:0.3893em;">&nbsp;</span><span class="stl_17 stl_18 stl_166" style="word-spacing:0.3893em;">最</span><span class="stl_17 stl_18 stl_166" style="word-spacing:-0.1703em;">&nbsp;核</span><span class="stl_17 stl_18 stl_166" style="word-spacing:-0.1703em;">&nbsp;心</span><span class="stl_17 stl_18 stl_166" style="word-spacing:-0.1703em;">&nbsp;的</span><span class="stl_17 stl_18 stl_166" style="word-spacing:-0.1703em;">&nbsp;调</span><span class="stl_17 stl_18 stl_166" style="word-spacing:-0.1703em;">&nbsp;用</span><span class="stl_17 stl_18 stl_166" style="word-spacing:-0.1703em;">&nbsp;是 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:8.1867em;"><span class="stl_10 stl_11 stl_167">createClient</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.2944em;">&nbsp;</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.2944em;">。</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.2872em;">&nbsp;</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.2872em;">r</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.3868em;">&nbsp;e</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.3868em;">&nbsp;d</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.3868em;">&nbsp;i</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.3868em;">&nbsp;s</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.0306em;">&nbsp;</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.0306em;">对 于</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;每</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;一</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;个</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;客</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;户</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;端</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;的</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;连</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3088em;">&nbsp;接，</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3098em;">&nbsp;都</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;会</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3418em;">&nbsp;对</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;应</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;一</span><span class="stl_17 stl_18 stl_167" style="word-spacing:-0.3428em;">&nbsp;个 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:7.6492em;"><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.31em;">结 构</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;体</span><span class="stl_17 stl_18 stl_168" style="word-spacing:0.2815em;">&nbsp;</span><span class="stl_15 stl_16 stl_168" style="word-spacing:0.2815em;">struct</span><span class="stl_15 stl_16 stl_168" style="word-spacing:-0.0172em;">&nbsp;</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.0172em;">r e</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.353em;">&nbsp;d</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.353em;">&nbsp;i</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.353em;">&nbsp;s</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.354em;">&nbsp;C</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.353em;">&nbsp;l</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.353em;">&nbsp;i</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.353em;">&nbsp;e</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.354em;">&nbsp;n</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.353em;">&nbsp;t</span><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.2528em;">&nbsp;</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.2528em;">。</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.31em;">&nbsp;下</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;面</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;是</span><span class="stl_17 stl_18 stl_168" style="word-spacing:0.3392em;">&nbsp;</span><span class="stl_10 stl_11 stl_168" style="word-spacing:0.3392em;">createClient</span><span class="stl_10 stl_11 stl_168" style="word-spacing:0.3397em;">&nbsp;</span><span class="stl_17 stl_18 stl_168" style="word-spacing:0.3397em;">的</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.31em;">&nbsp;核</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;心</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;代 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.8215em; left:7.6767em;"><span class="stl_17 stl_18 stl_79">码： &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5868em; left:6.035em;"><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3713em;">r e</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3703em;">&nbsp;d</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3703em;">&nbsp;i</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3713em;">&nbsp;s</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3703em;">&nbsp;C</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3703em;">&nbsp;l</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3703em;">&nbsp;i</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3713em;">&nbsp;e</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3703em;">&nbsp;n</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3703em;">&nbsp;t</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.0496em;">&nbsp;* createClient</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.2733em;">&nbsp;(</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.3218em;">&nbsp;</span><span class="stl_15 stl_16 stl_169" style="word-spacing:-0.3218em;">int</span><span class="stl_15 stl_16 stl_169" style="word-spacing:-0.0113em;">&nbsp;</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.0113em;">fd )</span><span class="stl_10 stl_11 stl_169" style="word-spacing:-0.0113em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5835em; left:8.0275em;"><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3343em;">r e</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;d</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;i</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3343em;">&nbsp;s</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;C</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;l</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;i</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3343em;">&nbsp;e</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;n</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;t</span><span class="stl_10 stl_11 stl_170" style="word-spacing:0.3167em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_170" style="word-spacing:0.0997em;">&nbsp;=</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.1317em;">&nbsp;zmalloc (</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.26em;">&nbsp;</span><span class="stl_15 stl_16 stl_170" style="word-spacing:-0.26em;">sizeof</span><span class="stl_15 stl_16 stl_170" style="word-spacing:-0.2611em;">&nbsp;</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.2611em;">(</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.2283em;">&nbsp;r</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;e</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;d</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;i</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3343em;">&nbsp;s</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;C</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;l</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;i</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3343em;">&nbsp;e</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;n</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.3333em;">&nbsp;t</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.2283em;">&nbsp;)</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.2783em;">&nbsp;)</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.2783em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:8.4207em;z-index:704; "><span class="stl_58 stl_59 stl_171" style="word-spacing:0.3194em;">* passing</span><span class="stl_58 stl_59 stl_171" style="word-spacing:0.209em;">&nbsp;</span><span class="stl_107 stl_108 stl_171" style="word-spacing:0.3194em;">−</span><span class="stl_58 stl_59 stl_171" style="word-spacing:0.209em;">1 as</span><span class="stl_58 stl_59 stl_171" style="word-spacing:0.3514em;">&nbsp;fd</span><span class="stl_58 stl_59 stl_171" style="word-spacing:0.4454em;">&nbsp;i</span><span class="stl_58 stl_59 stl_171" style="word-spacing:-0.2816em;">&nbsp;t</span><span class="stl_58 stl_59 stl_171" style="word-spacing:0.4794em;">&nbsp;i</span><span class="stl_58 stl_59 stl_171" style="word-spacing:-0.3066em;">&nbsp;s</span><span class="stl_58 stl_59 stl_171" style="word-spacing:0.4564em;">&nbsp;p</span><span class="stl_58 stl_59 stl_171" style="word-spacing:-0.3046em;">&nbsp;o</span><span class="stl_58 stl_59 stl_171" style="word-spacing:-0.3046em;">&nbsp;s</span><span class="stl_58 stl_59 stl_171" style="word-spacing:-0.3046em;">&nbsp;s</span><span class="stl_58 stl_59 stl_171" style="word-spacing:-0.3036em;">&nbsp;i</span><span class="stl_58 stl_59 stl_171" style="word-spacing:-0.3046em;">&nbsp;b</span><span class="stl_58 stl_59 stl_171" style="word-spacing:-0.3046em;">&nbsp;l</span><span class="stl_58 stl_59 stl_171" style="word-spacing:-0.3046em;">&nbsp;e</span><span class="stl_58 stl_59 stl_171" style="word-spacing:0.4009em;">&nbsp;to create</span><span class="stl_58 stl_59 stl_171" style="word-spacing:0.3124em;">&nbsp;a</span><span class="stl_58 stl_59 stl_171" style="word-spacing:0.2164em;">&nbsp;non &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:9.6483em;"><span class="stl_58 stl_59 stl_172" style="word-spacing:0.4167em;">connected c</span><span class="stl_58 stl_59 stl_172" style="word-spacing:-0.2912em;">&nbsp;l</span><span class="stl_58 stl_59 stl_172" style="word-spacing:-0.2913em;">&nbsp;i</span><span class="stl_58 stl_59 stl_172" style="word-spacing:-0.2922em;">&nbsp;e</span><span class="stl_58 stl_59 stl_172" style="word-spacing:-0.2912em;">&nbsp;n</span><span class="stl_58 stl_59 stl_172" style="word-spacing:-0.2913em;">&nbsp;t</span><span class="stl_58 stl_59 stl_172" style="word-spacing:-0.2913em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 46.5676em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 44.5752em; left:9.4678em;"><span class="stl_58 stl_59 stl_173" style="word-spacing:0.4334em;">This i</span><span class="stl_58 stl_59 stl_173" style="word-spacing:-0.2586em;">&nbsp;s</span><span class="stl_58 stl_59 stl_173" style="word-spacing:0.4984em;">&nbsp;u</span><span class="stl_58 stl_59 stl_173" style="word-spacing:-0.2636em;">&nbsp;s</span><span class="stl_58 stl_59 stl_173" style="word-spacing:-0.2626em;">&nbsp;e</span><span class="stl_58 stl_59 stl_173" style="word-spacing:-0.2636em;">&nbsp;f</span><span class="stl_58 stl_59 stl_173" style="word-spacing:-0.2636em;">&nbsp;u</span><span class="stl_58 stl_59 stl_173" style="word-spacing:-0.2626em;">&nbsp;l</span><span class="stl_58 stl_59 stl_173" style="word-spacing:0.4894em;">&nbsp;since a</span><span class="stl_58 stl_59 stl_173" style="word-spacing:-0.2256em;">&nbsp;l</span><span class="stl_58 stl_59 stl_173" style="word-spacing:-0.2246em;">&nbsp;l</span><span class="stl_58 stl_59 stl_173" style="word-spacing:0.4984em;">&nbsp;the</span><span class="stl_58 stl_59 stl_173" style="word-spacing:0.4014em;">&nbsp;Redis</span><span class="stl_58 stl_59 stl_173" style="word-spacing:0.3009em;">&nbsp;commands needs</span><span class="stl_58 stl_59 stl_173" style="word-spacing:0.3994em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:10.1342em;"><span class="stl_58 stl_59 stl_174" style="word-spacing:0.3267em;">be executed &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:9.4836em;"><span class="stl_58 stl_59 stl_175" style="word-spacing:0.4334em;">in the context of</span><span class="stl_58 stl_59 stl_175" style="word-spacing:0.3524em;">&nbsp;a</span><span class="stl_58 stl_59 stl_175" style="word-spacing:0.4014em;">&nbsp;c</span><span class="stl_58 stl_59 stl_175" style="word-spacing:-0.2446em;">&nbsp;l</span><span class="stl_58 stl_59 stl_175" style="word-spacing:-0.2436em;">&nbsp;i</span><span class="stl_58 stl_59 stl_175" style="word-spacing:-0.2436em;">&nbsp;e</span><span class="stl_58 stl_59 stl_175" style="word-spacing:-0.2436em;">&nbsp;n</span><span class="stl_58 stl_59 stl_175" style="word-spacing:-0.2446em;">&nbsp;t</span><span class="stl_58 stl_59 stl_175" style="word-spacing:-0.0976em;">&nbsp;.</span><span class="stl_58 stl_59 stl_175" style="word-spacing:0.3024em;">&nbsp;When</span><span class="stl_58 stl_59 stl_175" style="word-spacing:0.1764em;">&nbsp;commands</span><span class="stl_58 stl_59 stl_175" style="word-spacing:0.3054em;">&nbsp;are</span><span class="stl_58 stl_59 stl_175" style="word-spacing:0.4074em;">&nbsp;executed &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">2.3. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">如何运作 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">21 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:10.6467em;"><span class="stl_58 stl_59 stl_176" style="word-spacing:0.3404em;">in other &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:9.5093em;"><span class="stl_58 stl_59 stl_177" style="word-spacing:0.368em;">contexts (</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.232em;">&nbsp;for</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.405em;">&nbsp;instance</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.309em;">&nbsp;a</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.208em;">&nbsp;Lua</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.329em;">&nbsp;s</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.303em;">&nbsp;c</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.302em;">&nbsp;r</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.303em;">&nbsp;i</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.302em;">&nbsp;p</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.303em;">&nbsp;t</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.206em;">&nbsp;)</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.2493em;">&nbsp;we need a</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.217em;">&nbsp;non &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.1467em;"><span class="stl_58 stl_59 stl_178" style="word-spacing:0.4277em;">connected c</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2803em;">&nbsp;l</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2813em;">&nbsp;i</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2803em;">&nbsp;e</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2803em;">&nbsp;n</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2813em;">&nbsp;t</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.1333em;">&nbsp;.</span><span class="stl_58 stl_59 stl_178" style="word-spacing:0.3507em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:8.045em;z-index:90; "><span class="stl_15 stl_16 stl_179" style="word-spacing:-0.181em;">i f</span><span class="stl_15 stl_16 stl_179" style="word-spacing:0.5254em;">&nbsp;</span><span class="stl_10 stl_11 stl_179" style="word-spacing:0.5254em;">(</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.139em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_179" style="word-spacing:0.404em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_179" style="word-spacing:0.3322em;">&nbsp;</span><span class="stl_107 stl_108 stl_179" style="word-spacing:0.404em;">−</span><span class="stl_10 stl_11 stl_179" style="word-spacing:0.3322em;">1)</span><span class="stl_10 stl_11 stl_179" style="word-spacing:0.3322em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:9.9575em;"><span class="stl_10 stl_11 stl_180" style="word-spacing:-0.1209em;">anetNonBlock (NULL, fd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:9.9542em;"><span class="stl_10 stl_11 stl_181" style="word-spacing:-0.1332em;">anetEnableTcpNoDelay (NULL, fd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:10.0375em;"><span class="stl_15 stl_16 stl_182" style="word-spacing:-0.3552em;">i f</span><span class="stl_15 stl_16 stl_182" style="word-spacing:0.3511em;">&nbsp;</span><span class="stl_10 stl_11 stl_182" style="word-spacing:0.3511em;">(</span><span class="stl_10 stl_11 stl_182" style="word-spacing:-0.2823em;">&nbsp;server</span><span class="stl_10 stl_11 stl_182" style="word-spacing:-0.2262em;">&nbsp;.</span><span class="stl_10 stl_11 stl_182" style="word-spacing:-0.2302em;">&nbsp;tcpkeepalive</span><span class="stl_10 stl_11 stl_182" style="word-spacing:-0.2302em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:11.9667em;"><span class="stl_10 stl_11 stl_183" style="word-spacing:-0.178em;">anetKeepAlive (NULL, fd , server . tcpkeepalive ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;收</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;套</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;字</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;注</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;册</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;监</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;听</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.4132em;"><span class="stl_58 stl_59 stl_138" style="word-spacing:0.3153em;">/ readQueryFromClient</span><span class="stl_58 stl_59 stl_138" style="word-spacing:-0.2157em;">&nbsp;()</span><span class="stl_58 stl_59 stl_138" style="word-spacing:0.3939em;">&nbsp;</span><span class="stl_17 stl_18 stl_138" style="word-spacing:0.3939em;">应</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;该</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;为</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;处</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;理</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;客</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;户</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;端</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;请</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;求</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;的</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;函</span><span class="stl_17 stl_18 stl_138" style="word-spacing:-0.2327em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:10.0375em;"><span class="stl_15 stl_16 stl_184" style="word-spacing:-0.1796em;">i f</span><span class="stl_15 stl_16 stl_184" style="word-spacing:0.5268em;">&nbsp;</span><span class="stl_10 stl_11 stl_184" style="word-spacing:0.5268em;">(</span><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.1326em;">&nbsp;aeCreateFileEvent</span><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.1326em;">&nbsp;(</span><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.1066em;">&nbsp;server</span><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.0516em;">&nbsp;.</span><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.0746em;">&nbsp;el</span><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.0652em;">&nbsp;, fd</span><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.0256em;">&nbsp;,AE_READABLE, &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:11.9533em;"><span class="stl_10 stl_11 stl_185" style="word-spacing:0.0092em;">readQueryFromClient ,</span><span class="stl_10 stl_11 stl_185" style="word-spacing:0.5192em;">&nbsp;c</span><span class="stl_10 stl_11 stl_185" style="word-spacing:-0.1358em;">&nbsp;)</span><span class="stl_10 stl_11 stl_185" style="word-spacing:0.2662em;">&nbsp;==</span><span class="stl_10 stl_11 stl_185" style="word-spacing:0.0552em;">&nbsp;AE_ERR) &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 19.6668em; left:12.0133em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2771em;">c l o s e ( fd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:12.0175em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0566em;">z f r e e ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:11.9308em;"><span class="stl_15 stl_16 stl_186" style="word-spacing:0.3002em;">return </span><span class="stl_10 stl_11 stl_186" style="word-spacing:0.3002em;">NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6518em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 25.6443em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 25.6443em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 26.636em; left:7.9458em;"><span class="stl_15 stl_16 stl_162">return</span><span class="stl_15 stl_16 stl_162" style="word-spacing:0.3716em;">&nbsp;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3716em;">c</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3716em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.1202em; left:7.5658em;"><span class="stl_17 stl_18 stl_187" style="word-spacing:0.1566em;">可以看到，</span><span class="stl_10 stl_11 stl_187" style="word-spacing:0.1566em;">createClient </span><span class="stl_17 stl_18 stl_187" style="word-spacing:0.1566em;">在事件中心为与客户端连接的套接字注册了 </span><span class="stl_10 stl_11 stl_187" style="word-spacing:0.1566em;">read- &nbsp;</span></div>
					<div class="stl_01" style="top: 30.1168em; left:5.9058em;"><span class="stl_10 stl_11 stl_188" style="word-spacing:0.1329em;">QueryFromClient </span><span class="stl_17 stl_18 stl_188" style="word-spacing:0.1329em;">回调函数，而这也就是说当客户端有请求数据过来的时候，</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.1329em;">ac- &nbsp;</span></div>
					<div class="stl_01" style="top: 31.1127em; left:5.9058em;"><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0865em;">ceptTcpHandler </span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">会被调用。于是，我们找到了</span><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0865em;">’set name Jhon’ </span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">开始处理的地方。 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.2323em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 34.2323em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.3.3 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">请求的处理流程 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.9626em; left:7.5658em;"><span class="stl_10 stl_11 stl_190" style="word-spacing:0.1032em;">readQueryFromClient </span><span class="stl_17 stl_18 stl_190" style="word-spacing:0.1032em;">则是获取来自客户端的数据，接下来它会调用 </span><span class="stl_10 stl_11 stl_190" style="word-spacing:0.1032em;">processIn- &nbsp;</span></div>
					<div class="stl_01" style="top: 36.9593em; left:5.9058em;"><span class="stl_10 stl_11 stl_191" style="word-spacing:0.086em;">putBuﬀer </span><span class="stl_17 stl_18 stl_191" style="word-spacing:0.086em;">解析命令和执行命令，对于命令的执行，调用的是函数 </span><span class="stl_10 stl_11 stl_191" style="word-spacing:0.086em;">processCommand</span><span class="stl_17 stl_18 stl_191" style="word-spacing:0.086em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.9551em; left:5.9058em;"><span class="stl_17 stl_18 stl_192" style="word-spacing:0.0795em;">下面是 </span><span class="stl_10 stl_11 stl_192" style="word-spacing:0.0795em;">processCommand </span><span class="stl_17 stl_18 stl_192" style="word-spacing:0.0795em;">核心代码： &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4302em; left:5.9875em;"><span class="stl_15 stl_16 stl_193">int</span><span class="stl_15 stl_16 stl_193" style="word-spacing:0.3761em;">&nbsp;</span><span class="stl_10 stl_11 stl_193" style="word-spacing:0.3761em;">processCommand</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2166em;">&nbsp;(</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.1136em;">&nbsp;r</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;e</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2196em;">&nbsp;d</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;i</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;s</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;C</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2196em;">&nbsp;l</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;i</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;e</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;n</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2196em;">&nbsp;t</span><span class="stl_10 stl_11 stl_193" style="word-spacing:0.4314em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.1906em;">&nbsp;)</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.1906em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.431em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 42.4293em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.4251em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.431em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:8.4207em;"><span class="stl_58 stl_59 stl_148">/</span><span class="stl_58 stl_59 stl_148" style="word-spacing:0.4165em;">&nbsp;</span><span class="stl_17 stl_18 stl_148" style="word-spacing:0.4165em;">查</span><span class="stl_17 stl_18 stl_148" style="word-spacing:-0.1443em;">&nbsp;找</span><span class="stl_17 stl_18 stl_148" style="word-spacing:-0.1433em;">&nbsp;命</span><span class="stl_17 stl_18 stl_148" style="word-spacing:-0.1103em;">&nbsp;令，</span><span class="stl_17 stl_18 stl_148" style="word-spacing:-0.0549em;">&nbsp;</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.0549em;">r</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1893em;">&nbsp;e</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1883em;">&nbsp;d</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1883em;">&nbsp;i</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1883em;">&nbsp;s</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1883em;">&nbsp;C</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1893em;">&nbsp;l</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1883em;">&nbsp;i</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1883em;">&nbsp;e</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1883em;">&nbsp;n</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1883em;">&nbsp;t</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.0423em;">&nbsp;.</span><span class="stl_58 stl_59 stl_148" style="word-spacing:-0.1943em;">&nbsp;cmd</span><span class="stl_58 stl_59 stl_148" style="word-spacing:0.359em;">&nbsp;</span><span class="stl_17 stl_18 stl_148" style="word-spacing:0.359em;">在</span><span class="stl_17 stl_18 stl_148" style="word-spacing:-0.1433em;">&nbsp;此</span><span class="stl_17 stl_18 stl_148" style="word-spacing:-0.1433em;">&nbsp;时</span><span class="stl_17 stl_18 stl_148" style="word-spacing:-0.1433em;">&nbsp;赋</span><span class="stl_17 stl_18 stl_148" style="word-spacing:-0.1433em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:8.4207em;"><span class="stl_58 stl_59 stl_194" style="word-spacing:0.2676em;">* Now</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.3246em;">&nbsp;lookup</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.4786em;">&nbsp;the</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.3636em;">&nbsp;command</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.2936em;">&nbsp;and</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.4006em;">&nbsp;check</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.2811em;">&nbsp;ASAP about</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.5476em;">&nbsp;t</span><span class="stl_58 stl_59 stl_194" style="word-spacing:-0.1604em;">&nbsp;r</span><span class="stl_58 stl_59 stl_194" style="word-spacing:-0.1614em;">&nbsp;i</span><span class="stl_58 stl_59 stl_194" style="word-spacing:-0.1604em;">&nbsp;v</span><span class="stl_58 stl_59 stl_194" style="word-spacing:-0.1614em;">&nbsp;i</span><span class="stl_58 stl_59 stl_194" style="word-spacing:-0.1604em;">&nbsp;a</span><span class="stl_58 stl_59 stl_194" style="word-spacing:-0.1604em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:9.6642em;"><span class="stl_58 stl_59 stl_195" style="word-spacing:0.3455em;">error conditions &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 45.4176em; left:9.472em;"><span class="stl_58 stl_59 stl_196" style="word-spacing:0.4104em;">such as wrong arity</span><span class="stl_58 stl_59 stl_196" style="word-spacing:0.044em;">&nbsp;,</span><span class="stl_58 stl_59 stl_196" style="word-spacing:0.455em;">&nbsp;bad</span><span class="stl_58 stl_59 stl_196" style="word-spacing:0.31em;">&nbsp;command</span><span class="stl_58 stl_59 stl_196" style="word-spacing:0.24em;">&nbsp;name</span><span class="stl_58 stl_59 stl_196" style="word-spacing:0.293em;">&nbsp;and</span><span class="stl_58 stl_59 stl_196" style="word-spacing:0.376em;">&nbsp;so</span><span class="stl_58 stl_59 stl_196" style="word-spacing:0.475em;">&nbsp;f</span><span class="stl_58 stl_59 stl_196" style="word-spacing:-0.218em;">&nbsp;o</span><span class="stl_58 stl_59 stl_196" style="word-spacing:-0.218em;">&nbsp;r</span><span class="stl_58 stl_59 stl_196" style="word-spacing:-0.219em;">&nbsp;t</span><span class="stl_58 stl_59 stl_196" style="word-spacing:-0.218em;">&nbsp;h</span><span class="stl_58 stl_59 stl_196" style="word-spacing:-0.071em;">&nbsp;.</span><span class="stl_58 stl_59 stl_196" style="word-spacing:0.435em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.9408em;z-index:856; "><span class="stl_10 stl_11 stl_188" style="word-spacing:0.18em;">c</span><span class="stl_107 stl_108 stl_188" style="word-spacing:0.18em;">−</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.18em;">&gt;cmd =</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.18em;">&nbsp;c</span><span class="stl_107 stl_108 stl_188" style="word-spacing:0.18em;">−</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.241em;">&gt;lastcmd</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.29em;">&nbsp;=</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.216em;">&nbsp;lookupCommand(</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.216em;">&nbsp;c</span><span class="stl_107 stl_108 stl_188" style="word-spacing:0.216em;">−</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.165em;">&gt;argv[0]</span><span class="stl_107 stl_108 stl_188" style="word-spacing:-0.165em;">−</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.165em;">&gt;</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.158em;">&nbsp;ptr</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.101em;">&nbsp;)</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.101em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">22 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.3517em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">初探</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0836em;">REDIS &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">没</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;找</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:8.045em;z-index:32; "><span class="stl_15 stl_16 stl_197" style="word-spacing:-0.0143em;">i f</span><span class="stl_15 stl_16 stl_197" style="word-spacing:0.7644em;">&nbsp;</span><span class="stl_10 stl_11 stl_197" style="word-spacing:0.7644em;">(</span><span class="stl_10 stl_11 stl_197" style="word-spacing:-0.0133em;">&nbsp;!</span><span class="stl_10 stl_11 stl_197" style="word-spacing:-0.0133em;">&nbsp;c</span><span class="stl_107 stl_108 stl_197" style="word-spacing:-0.0133em;">−</span><span class="stl_10 stl_11 stl_197" style="word-spacing:0.0397em;">&gt;cmd)</span><span class="stl_10 stl_11 stl_197" style="word-spacing:0.0397em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:10.0042em;"><span class="stl_10 stl_11 stl_198" style="word-spacing:-0.304em;">flagTransaction ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:9.9583em;"><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.1357em;">addReplyErrorFormat ( c , ”unknown␣command␣’%s ’ ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:11.9708em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 9.6993em; left:12.4175em;z-index:111; "><span class="stl_15 stl_16 stl_200" style="word-spacing:-0.1792em;">char</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.1792em;">*) c</span><span class="stl_107 stl_108 stl_200" style="word-spacing:-0.1792em;">−</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.1792em;">&gt;argv[0]</span><span class="stl_107 stl_108 stl_200" style="word-spacing:-0.1792em;">−</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.1792em;">&gt; ptr ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:9.9383em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;不</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;符</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;合 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.6843em; left:8.9892em;z-index:193; "><span class="stl_15 stl_16 stl_202" style="word-spacing:0.6666em;">else i</span><span class="stl_15 stl_16 stl_202" style="word-spacing:-0.0474em;">&nbsp;f</span><span class="stl_15 stl_16 stl_202" style="word-spacing:0.6925em;">&nbsp;</span><span class="stl_10 stl_11 stl_202" style="word-spacing:0.6925em;">((</span><span class="stl_10 stl_11 stl_202" style="word-spacing:0.6925em;">&nbsp;c</span><span class="stl_107 stl_108 stl_202" style="word-spacing:0.6925em;">−</span><span class="stl_10 stl_11 stl_202" style="word-spacing:-0.0324em;">&gt;cmd</span><span class="stl_107 stl_108 stl_202" style="word-spacing:-0.0324em;">−</span><span class="stl_10 stl_11 stl_202" style="word-spacing:-0.0324em;">&gt;a</span><span class="stl_10 stl_11 stl_202" style="word-spacing:-0.0724em;">&nbsp;r</span><span class="stl_10 stl_11 stl_202" style="word-spacing:-0.0714em;">&nbsp;i</span><span class="stl_10 stl_11 stl_202" style="word-spacing:-0.0724em;">&nbsp;t</span><span class="stl_10 stl_11 stl_202" style="word-spacing:-0.0724em;">&nbsp;y</span><span class="stl_10 stl_11 stl_202" style="word-spacing:0.4086em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_202" style="word-spacing:0.3666em;">&nbsp;0</span><span class="stl_10 stl_11 stl_202" style="word-spacing:0.3071em;">&nbsp;&amp;&amp; c</span><span class="stl_107 stl_108 stl_202" style="word-spacing:0.3071em;">−</span><span class="stl_10 stl_11 stl_202" style="word-spacing:0.3071em;">&gt;cmd</span><span class="stl_107 stl_108 stl_202" style="word-spacing:0.3071em;">−</span><span class="stl_10 stl_11 stl_202" style="word-spacing:0.3071em;">&gt;a</span><span class="stl_10 stl_11 stl_202" style="word-spacing:-0.0724em;">&nbsp;r</span><span class="stl_10 stl_11 stl_202" style="word-spacing:-0.0714em;">&nbsp;i</span><span class="stl_10 stl_11 stl_202" style="word-spacing:-0.0724em;">&nbsp;t</span><span class="stl_10 stl_11 stl_202" style="word-spacing:-0.0724em;">&nbsp;y</span><span class="stl_10 stl_11 stl_202" style="word-spacing:0.5756em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_202" style="word-spacing:0.5756em;">&nbsp;c</span><span class="stl_107 stl_108 stl_202" style="word-spacing:0.5756em;">−</span><span class="stl_10 stl_11 stl_202" style="word-spacing:0.4756em;">&gt;argc &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:9.6458em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 14.686em; left:10.7326em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">| | &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:13.465em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 15.6818em; left:13.9183em;z-index:217; "><span class="stl_10 stl_11 stl_203" style="word-spacing:0.3845em;">c</span><span class="stl_107 stl_108 stl_203" style="word-spacing:0.3845em;">−</span><span class="stl_10 stl_11 stl_203" style="word-spacing:0.3845em;">&gt;argc &lt; c</span><span class="stl_107 stl_108 stl_203" style="word-spacing:0.3845em;">−</span><span class="stl_10 stl_11 stl_203" style="word-spacing:0.3845em;">&gt;cmd</span><span class="stl_107 stl_108 stl_203" style="word-spacing:0.3845em;">−</span><span class="stl_10 stl_11 stl_203" style="word-spacing:0.3845em;">&gt;a</span><span class="stl_10 stl_11 stl_203" style="word-spacing:-0.057em;">&nbsp;r</span><span class="stl_10 stl_11 stl_203" style="word-spacing:-0.057em;">&nbsp;i</span><span class="stl_10 stl_11 stl_203" style="word-spacing:-0.057em;">&nbsp;t</span><span class="stl_10 stl_11 stl_203" style="word-spacing:-0.056em;">&nbsp;y</span><span class="stl_10 stl_11 stl_203" style="word-spacing:0.048em;">&nbsp;)</span><span class="stl_10 stl_11 stl_203" style="word-spacing:0.002em;">&nbsp;)</span><span class="stl_10 stl_11 stl_203" style="word-spacing:0.002em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:10.0042em;"><span class="stl_10 stl_11 stl_198" style="word-spacing:-0.304em;">flagTransaction ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:9.9583em;"><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.2177em;">addReplyErrorFormat ( c , ”wrong␣number␣ of ␣arguments␣ fo r ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:11.5883em;"><span class="stl_10 stl_11 stl_07">’</span></div>
					<div class="stl_01" style="top: 18.671em; left:11.8366em;"><span class="stl_10 stl_11 stl_205" style="word-spacing:-0.0474em;">%s ’ ␣command” , &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:11.9267em;z-index:319; "><span class="stl_10 stl_11 stl_206" style="word-spacing:0.0938em;">c</span><span class="stl_107 stl_108 stl_206" style="word-spacing:0.0938em;">−</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.0938em;">&gt;cmd</span><span class="stl_107 stl_108 stl_206" style="word-spacing:0.0938em;">−</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.0938em;">&gt;name) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:9.9383em;z-index:332; "><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 22.656em; left:8.1208em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 22.656em; left:8.5742em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0183em;">. . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.6393em; left:8.045em;z-index:381; "><span class="stl_15 stl_16 stl_207" style="word-spacing:0.0284em;">i f</span><span class="stl_15 stl_16 stl_207" style="word-spacing:0.7348em;">&nbsp;</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.7348em;">(</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.7348em;">&nbsp;c</span><span class="stl_107 stl_108 stl_207" style="word-spacing:0.7348em;">−</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.0094em;">&gt;f</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.0229em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.5334em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.3114em;">&nbsp;REDIS_MULTI</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.2814em;">&nbsp;&amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.9342em;z-index:435; "><span class="stl_10 stl_11 stl_208" style="word-spacing:0.5165em;">c</span><span class="stl_107 stl_108 stl_208" style="word-spacing:0.5165em;">−</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.5165em;">&gt;cmd</span><span class="stl_107 stl_108 stl_208" style="word-spacing:0.5165em;">−</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.5165em;">&gt;proc !=</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.4345em;">&nbsp;execCommand</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.2675em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.2675em;">&nbsp;c</span><span class="stl_107 stl_108 stl_208" style="word-spacing:0.2675em;">−</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.2985em;">&gt;cmd</span><span class="stl_107 stl_108 stl_208" style="word-spacing:0.2985em;">−</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.2985em;">&gt;proc</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.5165em;">&nbsp;!= &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:11.5942em;"><span class="stl_10 stl_11 stl_209" style="word-spacing:0.2033em;">discardCommand &amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">加</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;情</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;况 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_210" style="word-spacing:0.3907em;">* Exec</span><span class="stl_58 stl_59 stl_210" style="word-spacing:0.4557em;">&nbsp;the</span><span class="stl_58 stl_59 stl_210" style="word-spacing:0.3887em;">&nbsp;command</span><span class="stl_58 stl_59 stl_210" style="word-spacing:0.3237em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:9.9342em;z-index:493; "><span class="stl_10 stl_11 stl_211" style="word-spacing:0.5099em;">c</span><span class="stl_107 stl_108 stl_211" style="word-spacing:0.5099em;">−</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.5099em;">&gt;cmd</span><span class="stl_107 stl_108 stl_211" style="word-spacing:0.5099em;">−</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.5099em;">&gt;proc !=</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.4359em;">&nbsp;multiCommand</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.2804em;">&nbsp;&amp;&amp; c</span><span class="stl_107 stl_108 stl_211" style="word-spacing:0.2804em;">−</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.2804em;">&gt;cmd</span><span class="stl_107 stl_108 stl_211" style="word-spacing:0.2804em;">−</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.2804em;">&gt;proc</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.5089em;">&nbsp;!= &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:11.5567em;"><span class="stl_10 stl_11 stl_212">watchCommand) &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 31.6235em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:9.925em;"><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.1352em;">queueMultiCommand( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:9.95em;"><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1887em;">addReply ( c , shared . queued ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">真 正</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;执</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;行</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;命</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;令。 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:8.4207em;"><span class="stl_58 stl_59 stl_216">/</span><span class="stl_58 stl_59 stl_216" style="word-spacing:-0.0415em;">&nbsp;</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.0415em;">注 意，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2837em;">&nbsp;如</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;果</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;是</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;设</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;置</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;了</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;多</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;命</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;令</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;模</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2827em;">&nbsp;式，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2837em;">&nbsp;那</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;么</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;不</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;是</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;直</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;接</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;执</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;行</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;命</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2827em;">&nbsp;令，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2827em;">&nbsp;而 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.8215em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">是 让 命 令 入 队 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.591em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:10.04em;"><span class="stl_10 stl_11 stl_218" style="word-spacing:0.0184em;">c a l l</span><span class="stl_10 stl_11 stl_218" style="word-spacing:0.1234em;">&nbsp;(</span><span class="stl_10 stl_11 stl_218" style="word-spacing:-0.0036em;">&nbsp;c</span><span class="stl_10 stl_11 stl_218" style="word-spacing:0.1044em;">&nbsp;,REDIS_CALL_FULL)</span><span class="stl_10 stl_11 stl_218" style="word-spacing:0.1044em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5835em; left:10.0375em;"><span class="stl_15 stl_16 stl_219" style="word-spacing:-0.3163em;">i f</span><span class="stl_15 stl_16 stl_219" style="word-spacing:0.39em;">&nbsp;</span><span class="stl_10 stl_11 stl_219" style="word-spacing:0.39em;">(</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.2423em;">&nbsp;listLength</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.2423em;">&nbsp;(</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.2433em;">&nbsp;server</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.1883em;">&nbsp;.</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.2463em;">&nbsp;ready_keys</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3013em;">&nbsp;)</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3013em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:11.9833em;"><span class="stl_10 stl_11 stl_220" style="word-spacing:-0.2106em;">handleClientsBlockedOnLists () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.5727em; left:7.9458em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.5658em;"><span class="stl_17 stl_18 stl_221" style="word-spacing:0.0897em;">如上可以看到，</span><span class="stl_10 stl_11 stl_221" style="word-spacing:0.0897em;">redis </span><span class="stl_17 stl_18 stl_221" style="word-spacing:0.0897em;">首先根据客户端给出的命令字在命令表中查找对应的 </span><span class="stl_10 stl_11 stl_221" style="word-spacing:0.0897em;">c- &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:6.5518em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">cmd, </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">即 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">struct redisCommand. &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">&gt;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">2.3. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">如何运作 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">23 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.2668em; left:5.9483em;z-index:49; "><span class="stl_10 stl_11 stl_188" style="word-spacing:0.18em;">c</span><span class="stl_107 stl_108 stl_188" style="word-spacing:0.18em;">−</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.18em;">&gt;cmd =</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.18em;">&nbsp;c</span><span class="stl_107 stl_108 stl_188" style="word-spacing:0.18em;">−</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.241em;">&gt;lastcmd</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.29em;">&nbsp;=</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.216em;">&nbsp;lookupCommand(</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.216em;">&nbsp;c</span><span class="stl_107 stl_108 stl_188" style="word-spacing:0.216em;">−</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.165em;">&gt;argv[0]</span><span class="stl_107 stl_108 stl_188" style="word-spacing:-0.165em;">−</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.165em;">&gt;</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.158em;">&nbsp;ptr</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.101em;">&nbsp;)</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.101em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.846em; left:7.5658em;"><span class="stl_10 stl_11 stl_115" style="word-spacing:0.0841em;">redis </span><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0841em;">在初始化的时候准备了一个大数组，初始化了所有的命令，即初始化多个 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.8426em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">struct redisCommand</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">，在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">struct redisCommand </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">中就有该命令对应的回调函数指针。 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.8635em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">找到命令结构体后，则开始执行命令，核心调用是 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">call(). &nbsp;</span></div>
					<div class="stl_01" style="top: 16.1389em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 16.1389em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.3.4 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">执行命令 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.9218em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0832em;">call() </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">做的事情有很多，但这里只关注这一句话：</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0832em;">call() </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">调用了命令的回调函数。 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.4676em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.4635em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.4676em; left:6.4282em;"><span class="stl_58 stl_59 stl_72" style="word-spacing:0.331em;">/ c</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.327em;">&nbsp;a</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.328em;">&nbsp;l</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.327em;">&nbsp;l</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.201em;">&nbsp;()</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.3163em;">&nbsp;</span><span class="stl_17 stl_18 stl_72" style="word-spacing:0.3163em;">函</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.312em;">&nbsp;数</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;是</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;执</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;行</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;命</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;令</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;的</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;核</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.31em;">&nbsp;心</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;函</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.278em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.277em;">&nbsp;真</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;正</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;执</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;行</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;命</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;令</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;的</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;地</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;方 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.4635em; left:6.4282em;"><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3504em;">* Call</span><span class="stl_58 stl_59 stl_222" style="word-spacing:-0.1816em;">&nbsp;()</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.4474em;">&nbsp;i</span><span class="stl_58 stl_59 stl_222" style="word-spacing:-0.2786em;">&nbsp;s</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.4444em;">&nbsp;the</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3896em;">&nbsp;core of Redis execution</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.4184em;">&nbsp;of</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3314em;">&nbsp;a</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.2124em;">&nbsp;command</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.2124em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.4535em; left:5.9483em;"><span class="stl_15 stl_16 stl_223">void</span><span class="stl_15 stl_16 stl_223" style="word-spacing:0.4309em;">&nbsp;</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.4309em;">c</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2227em;">&nbsp;a</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2217em;">&nbsp;l</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2217em;">&nbsp;l</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1157em;">&nbsp;(</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1407em;">&nbsp;r</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;d</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2467em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;s</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;C</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;l</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2467em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;n</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;t</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.4033em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1367em;">&nbsp;,</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.4587em;">&nbsp;</span><span class="stl_15 stl_16 stl_223" style="word-spacing:0.4587em;">int</span><span class="stl_15 stl_16 stl_223" style="word-spacing:0.4675em;">&nbsp;</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.4675em;">f</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2317em;">&nbsp;l</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2317em;">&nbsp;a</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2307em;">&nbsp;g</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2317em;">&nbsp;s</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1257em;">&nbsp;)</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1257em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.4543em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 24.4543em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 25.4526em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.4526em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;对</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;应</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;处</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;理</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4468em; left:7.9408em;z-index:369; "><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0006em;">c</span><span class="stl_107 stl_108 stl_224" style="word-spacing:-0.0006em;">−</span><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0006em;">&gt;cmd</span><span class="stl_107 stl_108 stl_224" style="word-spacing:-0.0006em;">−</span><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0006em;">&gt;proc (</span><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0236em;">&nbsp;c</span><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0246em;">&nbsp;)</span><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0246em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4435em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 27.4435em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4393em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 42.8685em; left:7.5658em;z-index:426; "><span class="stl_17 stl_18 stl_225" style="word-spacing:0.0401em;">对于</span><span class="stl_10 stl_11 stl_225" style="word-spacing:0.0401em;">’set name Jhon’ </span><span class="stl_17 stl_18 stl_225" style="word-spacing:0.0401em;">命令，对应的回调函数是 </span><span class="stl_10 stl_11 stl_225" style="word-spacing:0.0401em;">setCommand() </span><span class="stl_17 stl_18 stl_225" style="word-spacing:0.0401em;">函数。</span><span class="stl_10 stl_11 stl_225" style="word-spacing:0.0401em;">setCommand &nbsp;</span></div>
					<div class="stl_01" style="top: 43.8651em; left:5.9058em;"><span class="stl_17 stl_18 stl_226" style="word-spacing:0.0825em;">对 </span><span class="stl_10 stl_11 stl_226" style="word-spacing:0.0825em;">set </span><span class="stl_17 stl_18 stl_226" style="word-spacing:0.0825em;">命令的参数做了检测，因为还提供设置一个键值对的过期时间等功能，这里只 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.0832em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">关注最简单的情况。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">24 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.3517em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">初探</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0836em;">REDIS &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:5.9483em;"><span class="stl_15 stl_16 stl_227">void</span><span class="stl_15 stl_16 stl_227" style="word-spacing:0.336em;">&nbsp;</span><span class="stl_10 stl_11 stl_227" style="word-spacing:0.336em;">setCommand(</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.079em;">&nbsp;r</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.186em;">&nbsp;e</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.185em;">&nbsp;d</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.185em;">&nbsp;i</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.185em;">&nbsp;s</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.186em;">&nbsp;C</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.185em;">&nbsp;l</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.185em;">&nbsp;i</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.185em;">&nbsp;e</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.186em;">&nbsp;n</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.185em;">&nbsp;t</span><span class="stl_10 stl_11 stl_227" style="word-spacing:0.465em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.157em;">&nbsp;)</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.157em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 6.7151em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:7.95em;z-index:93; "><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.2135em;">setGenericCommand (</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.2255em;">&nbsp;c</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.1175em;">&nbsp;,</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.0755em;">&nbsp;flags</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.0991em;">&nbsp;, c</span><span class="stl_107 stl_108 stl_228" style="word-spacing:-0.0991em;">−</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.0991em;">&gt;argv</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.1085em;">&nbsp;[</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.2055em;">&nbsp;1</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.2045em;">&nbsp;]</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.0275em;">&nbsp;,</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.0275em;">&nbsp;c</span><span class="stl_107 stl_108 stl_228" style="word-spacing:-0.0275em;">−</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.1525em;">&gt;argv</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.1085em;">&nbsp;[</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.2045em;">&nbsp;2</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.2055em;">&nbsp;]</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.0265em;">&nbsp;,</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.0855em;">&nbsp;expire</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.0855em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:9.6442em;"><span class="stl_10 stl_11 stl_229" style="word-spacing:0.0874em;">unit ,NULL,NULL)</span><span class="stl_10 stl_11 stl_229" style="word-spacing:0.0874em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 11.6918em; left:5.9483em;"><span class="stl_15 stl_16 stl_214">void</span><span class="stl_15 stl_16 stl_214" style="word-spacing:0.299em;">&nbsp;</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.299em;">setGenericCommand</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2482em;">&nbsp;(</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1542em;">&nbsp;r</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2612em;">&nbsp;e</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2602em;">&nbsp;d</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2602em;">&nbsp;i</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2602em;">&nbsp;s</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2612em;">&nbsp;C</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2602em;">&nbsp;l</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2602em;">&nbsp;i</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2602em;">&nbsp;e</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2612em;">&nbsp;n</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2602em;">&nbsp;t</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.3898em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1512em;">&nbsp;,</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.4434em;">&nbsp;</span><span class="stl_15 stl_16 stl_214" style="word-spacing:0.4434em;">int</span><span class="stl_15 stl_16 stl_214" style="word-spacing:0.4289em;">&nbsp;</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.4289em;">flags</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.0368em;">&nbsp;,</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.4748em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.3638em;">&nbsp;*key</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.3638em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:7.6733em;"><span class="stl_10 stl_11 stl_230" style="word-spacing:0.3041em;">robj *val</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.1169em;">&nbsp;,</span><span class="stl_10 stl_11 stl_230" style="word-spacing:0.4151em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.0008em;">&nbsp;* expire</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.0749em;">&nbsp;,</span><span class="stl_10 stl_11 stl_230" style="word-spacing:0.3855em;">&nbsp;</span><span class="stl_15 stl_16 stl_230" style="word-spacing:0.3855em;">int</span><span class="stl_15 stl_16 stl_230" style="word-spacing:0.327em;">&nbsp;</span><span class="stl_10 stl_11 stl_230" style="word-spacing:0.327em;">unit</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.1069em;">&nbsp;,</span><span class="stl_10 stl_11 stl_230" style="word-spacing:0.4161em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_230" style="word-spacing:0.3051em;">&nbsp;*ok_reply</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.1489em;">&nbsp;,</span><span class="stl_10 stl_11 stl_230" style="word-spacing:0.4151em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_230" style="word-spacing:0.4151em;">&nbsp;* &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:7.6567em;"><span class="stl_10 stl_11 stl_131" style="word-spacing:-0.2542em;">abort_reply )</span><span class="stl_10 stl_11 stl_131" style="word-spacing:-0.2542em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:7.9717em;z-index:256; "><span class="stl_10 stl_11 stl_231" style="word-spacing:-0.1131em;">setKey ( c</span><span class="stl_107 stl_108 stl_231" style="word-spacing:-0.1131em;">−</span><span class="stl_10 stl_11 stl_231" style="word-spacing:-0.1131em;">&gt;db , key , val ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:7.9575em;"><span class="stl_10 stl_11 stl_232" style="word-spacing:-0.2494em;">addReply (</span><span class="stl_10 stl_11 stl_232" style="word-spacing:-0.2684em;">&nbsp;c</span><span class="stl_10 stl_11 stl_232" style="word-spacing:-0.1614em;">&nbsp;,</span><span class="stl_10 stl_11 stl_232" style="word-spacing:0.4266em;">&nbsp;ok_reply</span><span class="stl_10 stl_11 stl_232" style="word-spacing:0.3296em;">&nbsp;? ok_reply</span><span class="stl_10 stl_11 stl_232" style="word-spacing:0.4341em;">&nbsp;: shared</span><span class="stl_10 stl_11 stl_232" style="word-spacing:-0.1574em;">&nbsp;.</span><span class="stl_10 stl_11 stl_232" style="word-spacing:-0.2074em;">&nbsp;ok</span><span class="stl_10 stl_11 stl_232" style="word-spacing:-0.2634em;">&nbsp;)</span><span class="stl_10 stl_11 stl_232" style="word-spacing:-0.2634em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 18.671em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 20.6585em; left:5.9483em;"><span class="stl_15 stl_16 stl_233">void</span><span class="stl_15 stl_16 stl_233" style="word-spacing:0.3016em;">&nbsp;</span><span class="stl_10 stl_11 stl_233" style="word-spacing:0.3016em;">setKey</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2456em;">&nbsp;(</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2316em;">&nbsp;redisDb</span><span class="stl_10 stl_11 stl_233" style="word-spacing:0.3124em;">&nbsp;*db</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2346em;">&nbsp;,</span><span class="stl_10 stl_11 stl_233" style="word-spacing:0.4504em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_233" style="word-spacing:0.3394em;">&nbsp;*key</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.1586em;">&nbsp;,</span><span class="stl_10 stl_11 stl_233" style="word-spacing:0.4504em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_233" style="word-spacing:0.3394em;">&nbsp;*</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2666em;">&nbsp;val</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2106em;">&nbsp;)</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2106em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:8.045em;"><span class="stl_15 stl_16 stl_234" style="word-spacing:-0.1693em;">i f</span><span class="stl_15 stl_16 stl_234" style="word-spacing:0.5371em;">&nbsp;</span><span class="stl_10 stl_11 stl_234" style="word-spacing:0.5371em;">(</span><span class="stl_10 stl_11 stl_234" style="word-spacing:-0.1603em;">&nbsp;lookupKeyWrite</span><span class="stl_10 stl_11 stl_234" style="word-spacing:-0.1593em;">&nbsp;(db</span><span class="stl_10 stl_11 stl_234" style="word-spacing:-0.1403em;">&nbsp;,</span><span class="stl_10 stl_11 stl_234" style="word-spacing:-0.1093em;">&nbsp;key</span><span class="stl_10 stl_11 stl_234" style="word-spacing:-0.1643em;">&nbsp;)</span><span class="stl_10 stl_11 stl_234" style="word-spacing:0.2417em;">&nbsp;==</span><span class="stl_10 stl_11 stl_234" style="word-spacing:0.0647em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_234" style="word-spacing:0.0647em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:9.8942em;"><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.1191em;">dbAdd(db , key , val ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6468em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:9.9683em;"><span class="stl_10 stl_11 stl_236" style="word-spacing:-0.1907em;">dbOverwrite (db , key , val ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 26.641em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 26.641em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.2243em; left:7.5658em;"><span class="stl_10 stl_11 stl_237" style="word-spacing:0.0778em;">setKey() </span><span class="stl_17 stl_18 stl_237" style="word-spacing:0.0778em;">首先查看 </span><span class="stl_10 stl_11 stl_237" style="word-spacing:0.0778em;">key </span><span class="stl_17 stl_18 stl_237" style="word-spacing:0.0778em;">是否存在于数据集中，如果存在则覆盖写；如果不存在则 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.221em; left:5.9058em;"><span class="stl_17 stl_18 stl_238" style="word-spacing:0.0856em;">添加到数据集中。这里关注 </span><span class="stl_10 stl_11 stl_238" style="word-spacing:0.0856em;">key </span><span class="stl_17 stl_18 stl_238" style="word-spacing:0.0856em;">不存在的情况： &nbsp;</span></div>
					<div class="stl_01" style="top: 33.7652em; left:5.9483em;"><span class="stl_15 stl_16 stl_239">void</span><span class="stl_15 stl_16 stl_239" style="word-spacing:0.2409em;">&nbsp;</span><span class="stl_10 stl_11 stl_239" style="word-spacing:0.2409em;">dbAdd(</span><span class="stl_10 stl_11 stl_239" style="word-spacing:-0.208em;">&nbsp;redisDb</span><span class="stl_10 stl_11 stl_239" style="word-spacing:0.336em;">&nbsp;*db</span><span class="stl_10 stl_11 stl_239" style="word-spacing:-0.211em;">&nbsp;,</span><span class="stl_10 stl_11 stl_239" style="word-spacing:0.474em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_239" style="word-spacing:0.363em;">&nbsp;*key</span><span class="stl_10 stl_11 stl_239" style="word-spacing:-0.135em;">&nbsp;,</span><span class="stl_10 stl_11 stl_239" style="word-spacing:0.474em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_239" style="word-spacing:0.363em;">&nbsp;*</span><span class="stl_10 stl_11 stl_239" style="word-spacing:-0.242em;">&nbsp;val</span><span class="stl_10 stl_11 stl_239" style="word-spacing:-0.187em;">&nbsp;)</span><span class="stl_10 stl_11 stl_239" style="word-spacing:-0.187em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.766em; left:7.9925em;z-index:567; "><span class="stl_10 stl_11 stl_240" style="word-spacing:0.4082em;">sds copy</span><span class="stl_10 stl_11 stl_240" style="word-spacing:0.2107em;">&nbsp;= sdsdup</span><span class="stl_10 stl_11 stl_240" style="word-spacing:-0.1908em;">&nbsp;(</span><span class="stl_10 stl_11 stl_240" style="word-spacing:-0.2138em;">&nbsp;key</span><span class="stl_107 stl_108 stl_240" style="word-spacing:-0.2138em;">−</span><span class="stl_10 stl_11 stl_240" style="word-spacing:-0.2138em;">&gt;ptr</span><span class="stl_10 stl_11 stl_240" style="word-spacing:-0.1588em;">&nbsp;)</span><span class="stl_10 stl_11 stl_240" style="word-spacing:-0.1588em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.7577em; left:7.98em;z-index:594; "><span class="stl_15 stl_16 stl_241">int</span><span class="stl_15 stl_16 stl_241" style="word-spacing:0.463em;">&nbsp;</span><span class="stl_10 stl_11 stl_241" style="word-spacing:0.463em;">r</span><span class="stl_10 stl_11 stl_241" style="word-spacing:-0.2371em;">&nbsp;e</span><span class="stl_10 stl_11 stl_241" style="word-spacing:-0.2361em;">&nbsp;t</span><span class="stl_10 stl_11 stl_241" style="word-spacing:-0.2361em;">&nbsp;v</span><span class="stl_10 stl_11 stl_241" style="word-spacing:-0.2371em;">&nbsp;a</span><span class="stl_10 stl_11 stl_241" style="word-spacing:-0.2361em;">&nbsp;l</span><span class="stl_10 stl_11 stl_241" style="word-spacing:0.2749em;">&nbsp;=</span><span class="stl_10 stl_11 stl_241" style="word-spacing:0.2059em;">&nbsp;dictAdd</span><span class="stl_10 stl_11 stl_241" style="word-spacing:-0.2001em;">&nbsp;(db</span><span class="stl_107 stl_108 stl_241" style="word-spacing:-0.2001em;">−</span><span class="stl_10 stl_11 stl_241" style="word-spacing:-0.2001em;">&gt;dict</span><span class="stl_10 stl_11 stl_241" style="word-spacing:0.0159em;">&nbsp;,</span><span class="stl_10 stl_11 stl_241" style="word-spacing:0.4339em;">&nbsp;copy</span><span class="stl_10 stl_11 stl_241" style="word-spacing:-0.1041em;">&nbsp;,</span><span class="stl_10 stl_11 stl_241" style="word-spacing:0.4949em;">&nbsp;val</span><span class="stl_10 stl_11 stl_241" style="word-spacing:-0.1601em;">&nbsp;)</span><span class="stl_10 stl_11 stl_241" style="word-spacing:-0.1601em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.7552em; left:8.0058em;"><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.1225em;">redisAssertWithInfo (NULL,</span><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.1365em;">&nbsp;key</span><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.0765em;">&nbsp;,</span><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.0435em;">&nbsp;r</span><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.2055em;">&nbsp;e</span><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.2045em;">&nbsp;t</span><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.2045em;">&nbsp;v</span><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.2055em;">&nbsp;a</span><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.2045em;">&nbsp;l</span><span class="stl_10 stl_11 stl_242" style="word-spacing:0.2765em;">&nbsp;==</span><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.018em;">&nbsp;REDIS_OK)</span><span class="stl_10 stl_11 stl_242" style="word-spacing:-0.018em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.751em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 40.3385em; left:7.5658em;"><span class="stl_10 stl_11 stl_243" style="word-spacing:0.086em;">dictAdd() </span><span class="stl_17 stl_18 stl_243" style="word-spacing:0.086em;">就是把 </span><span class="stl_10 stl_11 stl_243" style="word-spacing:0.086em;">key </span><span class="stl_17 stl_18 stl_243" style="word-spacing:0.086em;">存到字典中，实际上即是存到一个哈希表。 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.6281em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 43.6281em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.3.5 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">在哪里回复客户端 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:7.5658em;z-index:744; "><span class="stl_17 stl_18 stl_211" style="word-spacing:0.0697em;">最后，回到 </span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.0697em;">setGenericCommand(), </span><span class="stl_17 stl_18 stl_211" style="word-spacing:0.0697em;">会调用 </span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.0697em;">addReply()</span><span class="stl_17 stl_18 stl_211" style="word-spacing:0.0697em;">。</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.0697em;">addReply() </span><span class="stl_17 stl_18 stl_211" style="word-spacing:0.0697em;">会为与客户 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_17 stl_18 stl_244" style="word-spacing:0.0836em;">端连接的套接字注册可写事件，把</span><span class="stl_10 stl_11 stl_244" style="word-spacing:0.0836em;">’ok’ </span><span class="stl_17 stl_18 stl_244" style="word-spacing:0.0836em;">添加到客户端的回复缓存中。待再一次回到事 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">件循环的时候，如果这个套接字可写，相应的回调函数就可以被回调了。回复缓存中 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">2.4. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">事件驱动模型 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">25 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.9415em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">的数据会被发送到客户端。 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">由此</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">’set name Jhon’ </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">命令执行完毕。 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.9265em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">在把这个流程捋顺的过程，我省去了很多的细节，只关注场景最简单情况最单一 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.9223em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">的时候，其他的代码都没有去看。这对我们快速了解一个系统的原理是很关键的。同 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.919em; left:5.9058em;"><span class="stl_17 stl_18 stl_245">样，在面对其他系统代码的时候，也可以带着这三个最简单的问题去阅读：它是谁， &nbsp;</span></div>
					<div class="stl_01" style="top: 12.9148em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">它从哪里来，又到哪里去。 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.0124em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 16.0124em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">.4 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1257em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1257em;">事件驱动模型 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.2248em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 18.2248em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.4.1 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">概述 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.9543em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">»</span></div>
					<div class="stl_01" style="top: 19.9543em; left:8.0275em;"><span class="stl_10 stl_11 stl_07">»»»»&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.0823em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 22.0823em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.4.2 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">其他模型 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.8126em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">»</span></div>
					<div class="stl_01" style="top: 23.8126em; left:8.0275em;"><span class="stl_10 stl_11 stl_07">»»»»&gt; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">26 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.3517em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">初探</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0836em;">REDIS &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.948em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 3 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.7331em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1247em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1247em;">事件驱动详解 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5624em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 20.5624em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">概述 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.8518em; left:7.5658em;"><span class="stl_10 stl_11 stl_246" style="word-spacing:0.0918em;">redis </span><span class="stl_17 stl_18 stl_246" style="word-spacing:0.0918em;">内部有一个小型的事件驱动，它和 </span><span class="stl_10 stl_11 stl_246" style="word-spacing:0.0918em;">libevent </span><span class="stl_17 stl_18 stl_246" style="word-spacing:0.0918em;">网络库的事件驱动一样，都是 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.8476em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">依托 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">I/O </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">多路复用技术支撑起来的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.8685em; left:7.5658em;"><span class="stl_17 stl_18 stl_247" style="word-spacing:0.0839em;">利用 </span><span class="stl_10 stl_11 stl_247" style="word-spacing:0.0839em;">I/O </span><span class="stl_17 stl_18 stl_247" style="word-spacing:0.0839em;">多路复用技术，监听感兴趣的文件 </span><span class="stl_10 stl_11 stl_247" style="word-spacing:0.0839em;">I/O </span><span class="stl_17 stl_18 stl_247" style="word-spacing:0.0839em;">事件，例如读事件，写事件等， &nbsp;</span></div>
					<div class="stl_01" style="top: 26.0873em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">同时也要维护一个以文件描述符为主键，数据为某个预设函数的事件表，这里其实就 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.0832em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">是一个数组或者链表。当事件触发时，比如某个文件描述符可读，系统会返回文件描 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.0798em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">述符值，用这个值在事件表中找到相应的数据项，从而实现回调。同样的，定时事件 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.8535em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">也是可以实现的，因为系统提供的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">I/O </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">多路复用技术中的函数允许我们设定时间值。 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.8743em; left:7.5658em;"><span class="stl_17 stl_18 stl_248" style="word-spacing:0.0845em;">上面一段话比较综合，可能需要一些 </span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.0845em;">linux </span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.0845em;">系统编程和网络编程的基础，但你会 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.0932em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">看到多数事件驱动程序都是这么实现的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.1298em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 33.1298em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.1.1 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">事件驱动数据结构 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.906em; left:7.5658em;"><span class="stl_10 stl_11 stl_52" style="word-spacing:0.0812em;">redis </span><span class="stl_17 stl_18 stl_52" style="word-spacing:0.0812em;">事件驱动内部有四个主要的数据结构，分别是：事件循环结构体，文件事件 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.1248em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">结构体，时间事件结构体和触发事件结构体。 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4443em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.4401em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.4443em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">文</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;体 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:6.4282em;"><span class="stl_58 stl_59 stl_249" style="word-spacing:0.2829em;">* File</span><span class="stl_58 stl_59 stl_249" style="word-spacing:0.3469em;">&nbsp;event structure</span><span class="stl_58 stl_59 stl_249" style="word-spacing:0.2869em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4302em; left:5.9533em;"><span class="stl_15 stl_16 stl_117" style="word-spacing:0.3109em;">typedef struct</span><span class="stl_15 stl_16 stl_117" style="word-spacing:0.3704em;">&nbsp;</span><span class="stl_10 stl_11 stl_117" style="word-spacing:0.3704em;">aeFileEvent</span><span class="stl_10 stl_11 stl_117" style="word-spacing:0.3704em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:7.98em;"><span class="stl_15 stl_16 stl_250">int</span><span class="stl_15 stl_16 stl_250" style="word-spacing:0.52em;">&nbsp;</span><span class="stl_10 stl_11 stl_250" style="word-spacing:0.52em;">mask</span><span class="stl_10 stl_11 stl_250" style="word-spacing:-0.0186em;">&nbsp;;</span><span class="stl_10 stl_11 stl_250" style="word-spacing:0.6118em;">&nbsp;</span><span class="stl_58 stl_59 stl_250" style="word-spacing:0.6118em;">/*</span><span class="stl_58 stl_59 stl_250" style="word-spacing:0.5174em;">&nbsp;one</span><span class="stl_58 stl_59 stl_250" style="word-spacing:0.5854em;">&nbsp;of</span><span class="stl_58 stl_59 stl_250" style="word-spacing:0.4284em;">&nbsp;AE_(READABLE|WRITABLE)</span><span class="stl_58 stl_59 stl_250" style="word-spacing:0.5464em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.4251em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">回</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:8.0025em;"><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.01em;">aeFileProc * r</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.333em;">&nbsp;f</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.334em;">&nbsp;i</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.333em;">&nbsp;l</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.334em;">&nbsp;e</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.333em;">&nbsp;P</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.334em;">&nbsp;r</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.333em;">&nbsp;o</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.334em;">&nbsp;c</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.334em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:8.0025em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.0609em;">aeFileProc * wfileProc</span><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.0609em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 47.4101em; left:8.4207em;"><span class="stl_58 stl_59 stl_252" style="word-spacing:0.2719em;">/ clientData</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.012em;">&nbsp;</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.012em;">参 数</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3251em;">&nbsp;一</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3251em;">&nbsp;般</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3251em;">&nbsp;是</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3251em;">&nbsp;指</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3251em;">&nbsp;向</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.0417em;">&nbsp;</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.0417em;">r e</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;d</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;i</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;s</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;C</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;l</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3711em;">&nbsp;i</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;e</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;n</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;t</span><span class="stl_58 stl_59 stl_252" style="word-spacing:0.3303em;">&nbsp;</span><span class="stl_17 stl_18 stl_252" style="word-spacing:0.3303em;">的</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3261em;">&nbsp;指</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3261em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">7</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">28 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:23.0308em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 3.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0823em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">事件驱动详解 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:7.9408em;"><span class="stl_15 stl_16 stl_253">void</span><span class="stl_15 stl_16 stl_253" style="word-spacing:-0.0656em;">&nbsp;</span><span class="stl_10 stl_11 stl_253" style="word-spacing:-0.0656em;">* clientData</span><span class="stl_10 stl_11 stl_253" style="word-spacing:-0.0656em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:6.9986em;"><span class="stl_10 stl_11 stl_254" style="word-spacing:-0.2062em;">aeFileEvent ; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7093em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;体 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:6.4282em;"><span class="stl_58 stl_59 stl_255" style="word-spacing:0.2048em;">* Time</span><span class="stl_58 stl_59 stl_255" style="word-spacing:0.2667em;">&nbsp;event</span><span class="stl_58 stl_59 stl_255" style="word-spacing:0.3958em;">&nbsp;structure</span><span class="stl_58 stl_59 stl_255" style="word-spacing:0.3338em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:5.9533em;"><span class="stl_15 stl_16 stl_256" style="word-spacing:0.3604em;">typedef struct</span><span class="stl_15 stl_16 stl_256" style="word-spacing:0.3677em;">&nbsp;</span><span class="stl_10 stl_11 stl_256" style="word-spacing:0.3677em;">aeTimeEvent</span><span class="stl_10 stl_11 stl_256" style="word-spacing:0.3677em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:7.9467em;"><span class="stl_15 stl_16 stl_257" style="word-spacing:0.2954em;">long long</span><span class="stl_15 stl_16 stl_257" style="word-spacing:0.3598em;">&nbsp;</span><span class="stl_10 stl_11 stl_257" style="word-spacing:0.3598em;">id</span><span class="stl_10 stl_11 stl_257" style="word-spacing:-0.1376em;">&nbsp;;</span><span class="stl_10 stl_11 stl_257" style="word-spacing:0.4em;">&nbsp;</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.4em;">/*</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.3354em;">&nbsp;time</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.3974em;">&nbsp;event</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.4844em;">&nbsp;i</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2366em;">&nbsp;d</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2366em;">&nbsp;e</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2366em;">&nbsp;n</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2366em;">&nbsp;t</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2366em;">&nbsp;i</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2366em;">&nbsp;f</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2356em;">&nbsp;i</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2366em;">&nbsp;e</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2366em;">&nbsp;r</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.0906em;">&nbsp;.</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.3854em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:7.9467em;"><span class="stl_15 stl_16 stl_105">long</span><span class="stl_15 stl_16 stl_105" style="word-spacing:0.3151em;">&nbsp;</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.3151em;">when_sec</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.182em;">&nbsp;;</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.4222em;">&nbsp;</span><span class="stl_58 stl_59 stl_105" style="word-spacing:0.4222em;">/*</span><span class="stl_58 stl_59 stl_105" style="word-spacing:0.371em;">&nbsp;seconds</span><span class="stl_58 stl_59 stl_105" style="word-spacing:0.371em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:7.9467em;"><span class="stl_15 stl_16 stl_258">long</span><span class="stl_15 stl_16 stl_258" style="word-spacing:-0.0193em;">&nbsp;</span><span class="stl_10 stl_11 stl_258" style="word-spacing:-0.0193em;">when_ms ;</span><span class="stl_10 stl_11 stl_258" style="word-spacing:0.3903em;">&nbsp;</span><span class="stl_58 stl_59 stl_258" style="word-spacing:0.3903em;">/* milliseconds</span><span class="stl_58 stl_59 stl_258" style="word-spacing:0.3903em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">定</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;回</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:7.9558em;"><span class="stl_10 stl_11 stl_259" style="word-spacing:0.3021em;">aeTimeProc *timeProc</span><span class="stl_10 stl_11 stl_259" style="word-spacing:0.3021em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">定 时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;事</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;件</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;清</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;理</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;函</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;当</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;删</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;除</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;定</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;事</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;件</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;候</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;被</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;调</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:8.0017em;"><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.0085em;">aeEventFinalizerProc * f</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3353em;">&nbsp;i</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3343em;">&nbsp;n</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3343em;">&nbsp;a</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3343em;">&nbsp;l</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3343em;">&nbsp;i</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3353em;">&nbsp;z</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3343em;">&nbsp;e</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3343em;">&nbsp;r</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3343em;">&nbsp;P</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3343em;">&nbsp;r</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3353em;">&nbsp;o</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3343em;">&nbsp;c</span><span class="stl_10 stl_11 stl_260" style="word-spacing:-0.3343em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.661em; left:8.4207em;"><span class="stl_58 stl_59 stl_252" style="word-spacing:0.2719em;">/ clientData</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.012em;">&nbsp;</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.012em;">参 数</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3251em;">&nbsp;一</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3251em;">&nbsp;般</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3251em;">&nbsp;是</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3251em;">&nbsp;指</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3251em;">&nbsp;向</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.0417em;">&nbsp;</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.0417em;">r e</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;d</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;i</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;s</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;C</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;l</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3711em;">&nbsp;i</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;e</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;n</span><span class="stl_58 stl_59 stl_252" style="word-spacing:-0.3701em;">&nbsp;t</span><span class="stl_58 stl_59 stl_252" style="word-spacing:0.3303em;">&nbsp;</span><span class="stl_17 stl_18 stl_252" style="word-spacing:0.3303em;">的</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3261em;">&nbsp;指</span><span class="stl_17 stl_18 stl_252" style="word-spacing:-0.3261em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:7.9408em;"><span class="stl_15 stl_16 stl_253">void</span><span class="stl_15 stl_16 stl_253" style="word-spacing:-0.0656em;">&nbsp;</span><span class="stl_10 stl_11 stl_253" style="word-spacing:-0.0656em;">* clientData</span><span class="stl_10 stl_11 stl_253" style="word-spacing:-0.0656em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">定</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;采</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;链</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;来</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;维</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;护 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6393em; left:7.9725em;"><span class="stl_15 stl_16 stl_261">struct</span><span class="stl_15 stl_16 stl_261" style="word-spacing:0.3439em;">&nbsp;</span><span class="stl_10 stl_11 stl_261" style="word-spacing:0.3439em;">aeTimeEvent</span><span class="stl_10 stl_11 stl_261" style="word-spacing:0.3034em;">&nbsp;*next</span><span class="stl_10 stl_11 stl_261" style="word-spacing:0.3034em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 26.641em; left:6.9554em;"><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.1542em;">aeTimeEvent ; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">触</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:6.4282em;"><span class="stl_58 stl_59 stl_263" style="word-spacing:0.1194em;">* A</span><span class="stl_58 stl_59 stl_263" style="word-spacing:-0.0752em;">&nbsp;f i</span><span class="stl_58 stl_59 stl_263" style="word-spacing:-0.3026em;">&nbsp;r</span><span class="stl_58 stl_59 stl_263" style="word-spacing:-0.3016em;">&nbsp;e</span><span class="stl_58 stl_59 stl_263" style="word-spacing:-0.3026em;">&nbsp;d</span><span class="stl_58 stl_59 stl_263" style="word-spacing:0.4194em;">&nbsp;event</span><span class="stl_58 stl_59 stl_263" style="word-spacing:0.3124em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:5.9533em;"><span class="stl_15 stl_16 stl_264" style="word-spacing:0.323em;">typedef struct</span><span class="stl_15 stl_16 stl_264" style="word-spacing:0.3675em;">&nbsp;</span><span class="stl_10 stl_11 stl_264" style="word-spacing:0.3675em;">aeFiredEvent</span><span class="stl_10 stl_11 stl_264" style="word-spacing:0.3675em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6168em; left:7.98em;"><span class="stl_15 stl_16 stl_265">int</span><span class="stl_15 stl_16 stl_265" style="word-spacing:0.3559em;">&nbsp;</span><span class="stl_10 stl_11 stl_265" style="word-spacing:0.3559em;">fd</span><span class="stl_10 stl_11 stl_265" style="word-spacing:0.3559em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6135em; left:7.98em;"><span class="stl_15 stl_16 stl_266">int</span><span class="stl_15 stl_16 stl_266" style="word-spacing:0.3654em;">&nbsp;</span><span class="stl_10 stl_11 stl_266" style="word-spacing:0.3654em;">mask</span><span class="stl_10 stl_11 stl_266" style="word-spacing:0.3654em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 33.6143em; left:6.987em;"><span class="stl_10 stl_11 stl_267" style="word-spacing:-0.1913em;">aeFiredEvent ; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;循</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;环</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;体 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:6.4282em;"><span class="stl_58 stl_59 stl_268" style="word-spacing:0.3438em;">* State</span><span class="stl_58 stl_59 stl_268" style="word-spacing:0.4118em;">&nbsp;of</span><span class="stl_58 stl_59 stl_268" style="word-spacing:0.3168em;">&nbsp;an event</span><span class="stl_58 stl_59 stl_268" style="word-spacing:0.3798em;">&nbsp;based</span><span class="stl_58 stl_59 stl_268" style="word-spacing:0.3268em;">&nbsp;program</span><span class="stl_58 stl_59 stl_268" style="word-spacing:0.2778em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:5.9533em;"><span class="stl_15 stl_16 stl_269" style="word-spacing:0.3528em;">typedef struct</span><span class="stl_15 stl_16 stl_269" style="word-spacing:0.3681em;">&nbsp;</span><span class="stl_10 stl_11 stl_269" style="word-spacing:0.3681em;">aeEventLoop</span><span class="stl_10 stl_11 stl_269" style="word-spacing:0.3681em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:7.98em;"><span class="stl_15 stl_16 stl_187">int</span><span class="stl_15 stl_16 stl_187" style="word-spacing:0.3687em;">&nbsp;</span><span class="stl_10 stl_11 stl_187" style="word-spacing:0.3687em;">maxfd</span><span class="stl_10 stl_11 stl_187" style="word-spacing:0.3687em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.6908em;"><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">r e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;g</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;i</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;s</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;r</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;d</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.452em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5835em; left:7.98em;"><span class="stl_15 stl_16 stl_270">int</span><span class="stl_15 stl_16 stl_270" style="word-spacing:0.4626em;">&nbsp;</span><span class="stl_10 stl_11 stl_270" style="word-spacing:0.4626em;">s</span><span class="stl_10 stl_11 stl_270" style="word-spacing:-0.2376em;">&nbsp;e</span><span class="stl_10 stl_11 stl_270" style="word-spacing:-0.2376em;">&nbsp;t</span><span class="stl_10 stl_11 stl_270" style="word-spacing:-0.2366em;">&nbsp;s</span><span class="stl_10 stl_11 stl_270" style="word-spacing:-0.2366em;">&nbsp;i</span><span class="stl_10 stl_11 stl_270" style="word-spacing:-0.2376em;">&nbsp;z</span><span class="stl_10 stl_11 stl_270" style="word-spacing:-0.2366em;">&nbsp;e</span><span class="stl_10 stl_11 stl_270" style="word-spacing:-0.0756em;">&nbsp;;</span><span class="stl_10 stl_11 stl_270" style="word-spacing:0.407em;">&nbsp;</span><span class="stl_58 stl_59 stl_270" style="word-spacing:0.407em;">/*</span><span class="stl_58 stl_59 stl_270" style="word-spacing:0.2424em;">&nbsp;max number</span><span class="stl_58 stl_59 stl_270" style="word-spacing:0.3624em;">&nbsp;of</span><span class="stl_58 stl_59 stl_270" style="word-spacing:0.5274em;">&nbsp;f</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.1996em;">&nbsp;i</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.1996em;">&nbsp;l</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.1996em;">&nbsp;e</span><span class="stl_58 stl_59 stl_270" style="word-spacing:0.5544em;">&nbsp;d</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.2596em;">&nbsp;e</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.2596em;">&nbsp;s</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.2606em;">&nbsp;c</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.2596em;">&nbsp;r</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.2596em;">&nbsp;i</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.2596em;">&nbsp;p</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.2596em;">&nbsp;t</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.2596em;">&nbsp;o</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.2606em;">&nbsp;r</span><span class="stl_58 stl_59 stl_270" style="word-spacing:-0.2596em;">&nbsp;s</span><span class="stl_58 stl_59 stl_270" style="word-spacing:0.4714em;">&nbsp;tracked</span><span class="stl_58 stl_59 stl_270" style="word-spacing:0.3764em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:14.4233em;"><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.099em;">/* h i</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.378em;">&nbsp;g</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.379em;">&nbsp;h</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.379em;">&nbsp;e</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.379em;">&nbsp;s</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.378em;">&nbsp;t</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.435em;">&nbsp;f</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.316em;">&nbsp;i</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.316em;">&nbsp;l</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.316em;">&nbsp;e</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.434em;">&nbsp;d</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.379em;">&nbsp;es</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.379em;">&nbsp;cr</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.379em;">&nbsp;ip</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.379em;">&nbsp;t</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.38em;">&nbsp;o</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.379em;">&nbsp;r</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.366em;">&nbsp;currently &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:8.4207em;"><span class="stl_58 stl_59 stl_272">/</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.0492em;">&nbsp;</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.0492em;">记 录</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;最</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;大</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;的</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;定</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;时</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;事</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;件</span><span class="stl_17 stl_18 stl_272" style="word-spacing:0.3233em;">&nbsp;</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.3233em;">id</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.14em;">&nbsp;+</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.14em;">&nbsp;1 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5727em; left:7.9467em;"><span class="stl_15 stl_16 stl_273" style="word-spacing:0.3058em;">long long</span><span class="stl_15 stl_16 stl_273" style="word-spacing:0.3371em;">&nbsp;</span><span class="stl_10 stl_11 stl_273" style="word-spacing:0.3371em;">timeEventNextId</span><span class="stl_10 stl_11 stl_273" style="word-spacing:0.3371em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5718em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;于</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;系</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;统</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;矫</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;正 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:7.9592em;"><span class="stl_10 stl_11 stl_274" style="word-spacing:0.3448em;">time_t lastTime</span><span class="stl_10 stl_11 stl_274" style="word-spacing:0.3448em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:18.4083em;"><span class="stl_58 stl_59 stl_275" style="word-spacing:0.2502em;">/* Used</span><span class="stl_58 stl_59 stl_275" style="word-spacing:0.3102em;">&nbsp;to</span><span class="stl_58 stl_59 stl_275" style="word-spacing:0.4042em;">&nbsp;d</span><span class="stl_58 stl_59 stl_275" style="word-spacing:-0.3138em;">&nbsp;etect</span><span class="stl_58 stl_59 stl_275" style="word-spacing:0.3732em;">&nbsp;system clock</span><span class="stl_58 stl_59 stl_275" style="word-spacing:0.3732em;">&nbsp;skew &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">3.1. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">概述 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">29 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.6075em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:10.0807em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4207em;"><span class="stl_58 stl_59 stl_121" style="word-spacing:0.592em;">/ I</span><span class="stl_58 stl_59 stl_121" style="word-spacing:-0.023em;">&nbsp;/O</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.4427em;">&nbsp;</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.4427em;">事</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.0255em;">&nbsp;件</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.0255em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:7.995em;"><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.0438em;">aeFileEvent * events</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.2089em;">&nbsp;;</span><span class="stl_10 stl_11 stl_276" style="word-spacing:0.3148em;">&nbsp;</span><span class="stl_58 stl_59 stl_276" style="word-spacing:0.3148em;">/* Registered</span><span class="stl_58 stl_59 stl_276" style="word-spacing:0.3721em;">&nbsp;events</span><span class="stl_58 stl_59 stl_276" style="word-spacing:0.2991em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">被</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;触</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:7.9833em;"><span class="stl_10 stl_11 stl_277" style="word-spacing:0.2908em;">aeFiredEvent *</span><span class="stl_10 stl_11 stl_277" style="word-spacing:-0.2412em;">&nbsp;f</span><span class="stl_10 stl_11 stl_277" style="word-spacing:-0.2922em;">&nbsp;i</span><span class="stl_10 stl_11 stl_277" style="word-spacing:-0.2912em;">&nbsp;r</span><span class="stl_10 stl_11 stl_277" style="word-spacing:-0.2912em;">&nbsp;e</span><span class="stl_10 stl_11 stl_277" style="word-spacing:-0.2922em;">&nbsp;d</span><span class="stl_10 stl_11 stl_277" style="word-spacing:-0.1302em;">&nbsp;;</span><span class="stl_10 stl_11 stl_277" style="word-spacing:0.3583em;">&nbsp;</span><span class="stl_58 stl_59 stl_277" style="word-spacing:0.3583em;">/*</span><span class="stl_58 stl_59 stl_277" style="word-spacing:0.3048em;">&nbsp;Fired</span><span class="stl_58 stl_59 stl_277" style="word-spacing:0.3768em;">&nbsp;events</span><span class="stl_58 stl_59 stl_277" style="word-spacing:0.3278em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">定</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:7.9525em;"><span class="stl_10 stl_11 stl_278" style="word-spacing:0.3227em;">aeTimeEvent *timeEventHead</span><span class="stl_10 stl_11 stl_278" style="word-spacing:0.3227em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;循</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;环</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;束</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;标</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;识 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:7.98em;"><span class="stl_15 stl_16 stl_279">int</span><span class="stl_15 stl_16 stl_279" style="word-spacing:0.3487em;">&nbsp;</span><span class="stl_10 stl_11 stl_279" style="word-spacing:0.3487em;">stop</span><span class="stl_10 stl_11 stl_279" style="word-spacing:0.3487em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4207em;"><span class="stl_58 stl_59 stl_280">/</span><span class="stl_58 stl_59 stl_280" style="word-spacing:0.3578em;">&nbsp;</span><span class="stl_17 stl_18 stl_280" style="word-spacing:0.3578em;">对</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.203em;">&nbsp;于</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;不</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;同</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;的</span><span class="stl_17 stl_18 stl_280" style="word-spacing:0.4054em;">&nbsp;</span><span class="stl_58 stl_59 stl_280" style="word-spacing:0.4054em;">I</span><span class="stl_58 stl_59 stl_280" style="word-spacing:-0.251em;">&nbsp;/O</span><span class="stl_58 stl_59 stl_280" style="word-spacing:0.2139em;">&nbsp;</span><span class="stl_17 stl_18 stl_280" style="word-spacing:0.2139em;">多</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;路</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;复</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;用</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;技</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.169em;">&nbsp;术，</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.168em;">&nbsp;有</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;不</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;同</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;的</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;数</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.169em;">&nbsp;据，</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.168em;">&nbsp;详</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;见</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;各</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;自</span><span class="stl_17 stl_18 stl_280" style="word-spacing:-0.202em;">&nbsp;实 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.8857em; left:9.6417em;"><span class="stl_17 stl_18 stl_07">现</span></div>
					<div class="stl_01" style="top: 21.6543em; left:7.9408em;"><span class="stl_15 stl_16 stl_281">void</span><span class="stl_15 stl_16 stl_281" style="word-spacing:0.2774em;">&nbsp;</span><span class="stl_10 stl_11 stl_281" style="word-spacing:0.2774em;">*</span><span class="stl_10 stl_11 stl_281" style="word-spacing:-0.2597em;">&nbsp;apidata</span><span class="stl_10 stl_11 stl_281" style="word-spacing:-0.1487em;">&nbsp;;</span><span class="stl_10 stl_11 stl_281" style="word-spacing:0.3955em;">&nbsp;</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.3955em;">/*</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.3263em;">&nbsp;This</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.4283em;">&nbsp;i</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2637em;">&nbsp;s</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.4228em;">&nbsp;used for</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.4823em;">&nbsp;p</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2577em;">&nbsp;o</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2577em;">&nbsp;l</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2577em;">&nbsp;l</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2577em;">&nbsp;i</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2577em;">&nbsp;n</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2577em;">&nbsp;g</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.3448em;">&nbsp;API s</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2487em;">&nbsp;p</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2497em;">&nbsp;e</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2497em;">&nbsp;c</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2487em;">&nbsp;i</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2497em;">&nbsp;f</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2487em;">&nbsp;i</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2487em;">&nbsp;c &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:9.6475em;"><span class="stl_58 stl_59 stl_282" style="word-spacing:0.3275em;">data */ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">新</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;循</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;环</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;前</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;需</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;要</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;操</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;作 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9983em;"><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.0072em;">aeBeforeSleepProc * b</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3366em;">&nbsp;e</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3376em;">&nbsp;f</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3366em;">&nbsp;o</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3376em;">&nbsp;r</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3366em;">&nbsp;e</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3376em;">&nbsp;s</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3366em;">&nbsp;l</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3376em;">&nbsp;e</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3366em;">&nbsp;e</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3376em;">&nbsp;p</span><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.3376em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:6.9621em;"><span class="stl_10 stl_11 stl_284" style="word-spacing:-0.1622em;">aeEventLoop ; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.1243em; left:7.5658em;"><span class="stl_17 stl_18 stl_285" style="word-spacing:0.0736em;">上面的数据结构能给我们很好的提示：事件循环结构体维护 </span><span class="stl_10 stl_11 stl_285" style="word-spacing:0.0736em;">I/O </span><span class="stl_17 stl_18 stl_285" style="word-spacing:0.0736em;">事件表，定时事 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.3423em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">件表和触发事件表。 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.2439em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 31.2439em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.1.2 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">事件循环中心 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.9735em; left:7.5658em;z-index:394; "><span class="stl_10 stl_11 stl_286" style="word-spacing:0.1215em;">redis </span><span class="stl_17 stl_18 stl_286" style="word-spacing:0.1215em;">的主函数中调用 </span><span class="stl_10 stl_11 stl_286" style="word-spacing:0.1215em;">initServer() </span><span class="stl_17 stl_18 stl_286" style="word-spacing:0.1215em;">函数从而初始化事件循环中心（</span><span class="stl_10 stl_11 stl_286" style="word-spacing:0.1215em;">EventLoop</span><span class="stl_17 stl_18 stl_286" style="word-spacing:0.1215em;">）， &nbsp;</span></div>
					<div class="stl_01" style="top: 33.9701em; left:5.9058em;"><span class="stl_17 stl_18 stl_287" style="word-spacing:0.0843em;">它的主要工作是在 </span><span class="stl_10 stl_11 stl_287" style="word-spacing:0.0843em;">aeCreateEventLoop() </span><span class="stl_17 stl_18 stl_287" style="word-spacing:0.0843em;">中完成的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4452em; left:5.9658em;"><span class="stl_10 stl_11 stl_288" style="word-spacing:0.3022em;">aeEventLoop *aeCreateEventLoop</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2268em;">&nbsp;(</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2168em;">&nbsp;</span><span class="stl_15 stl_16 stl_288" style="word-spacing:-0.2168em;">int</span><span class="stl_15 stl_16 stl_288" style="word-spacing:0.4544em;">&nbsp;</span><span class="stl_10 stl_11 stl_288" style="word-spacing:0.4544em;">s</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2448em;">&nbsp;e</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2438em;">&nbsp;t</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2438em;">&nbsp;s</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2448em;">&nbsp;i</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2438em;">&nbsp;z</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2438em;">&nbsp;e</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.1388em;">&nbsp;)</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.1388em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.446em; left:7.9583em;"><span class="stl_10 stl_11 stl_289" style="word-spacing:0.3095em;">aeEventLoop *eventLoop</span><span class="stl_10 stl_11 stl_289" style="word-spacing:0.3095em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4377em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.4131em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4131em;">i</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4131em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;配</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:8.045em;"><span class="stl_15 stl_16 stl_291" style="word-spacing:-0.2288em;">i f</span><span class="stl_15 stl_16 stl_291" style="word-spacing:0.5127em;">&nbsp;</span><span class="stl_10 stl_11 stl_291" style="word-spacing:0.5127em;">((</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.1778em;">&nbsp;eventLoop</span><span class="stl_10 stl_11 stl_291" style="word-spacing:0.1922em;">&nbsp;=</span><span class="stl_10 stl_11 stl_291" style="word-spacing:0.2212em;">&nbsp;zmalloc</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.1838em;">&nbsp;(</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.1761em;">&nbsp;</span><span class="stl_15 stl_16 stl_291" style="word-spacing:-0.1761em;">sizeof</span><span class="stl_15 stl_16 stl_291" style="word-spacing:-0.1776em;">&nbsp;</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.1776em;">(*</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.2158em;">&nbsp;eventLoop</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.2138em;">&nbsp;)</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.1938em;">&nbsp;)</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.1938em;">&nbsp;)</span><span class="stl_10 stl_11 stl_291" style="word-spacing:0.1822em;">&nbsp;==</span><span class="stl_10 stl_11 stl_291" style="word-spacing:0.0062em;">&nbsp;NULL) &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:9.5967em;"><span class="stl_15 stl_16 stl_292">goto</span><span class="stl_15 stl_16 stl_292" style="word-spacing:0.3697em;">&nbsp;</span><span class="stl_10 stl_11 stl_292" style="word-spacing:0.3697em;">err</span><span class="stl_10 stl_11 stl_292" style="word-spacing:0.3697em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.4218em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;配</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;文</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;体</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:7.9625em;z-index:581; "><span class="stl_10 stl_11 stl_293" style="word-spacing:0.1834em;">eventLoop</span><span class="stl_107 stl_108 stl_293" style="word-spacing:0.1834em;">−</span><span class="stl_10 stl_11 stl_293" style="word-spacing:0.1834em;">&gt;events = zmalloc</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2251em;">&nbsp;(</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2173em;">&nbsp;</span><span class="stl_15 stl_16 stl_293" style="word-spacing:-0.2173em;">sizeof</span><span class="stl_15 stl_16 stl_293" style="word-spacing:-0.2168em;">&nbsp;</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2168em;">(</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2241em;">&nbsp;aeFileEvent</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2241em;">&nbsp;)</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2901em;">&nbsp;*</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2201em;">&nbsp;s</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2691em;">&nbsp;e</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2691em;">&nbsp;t</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2701em;">&nbsp;s</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2691em;">&nbsp;i</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2691em;">&nbsp;z</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.2701em;">&nbsp;e</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.1641em;">&nbsp;)</span><span class="stl_10 stl_11 stl_293" style="word-spacing:-0.1641em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 47.4101em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;配</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;已</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;触</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;体</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">30 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:23.0308em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 3.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0823em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">事件驱动详解 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:7.9625em;z-index:32; "><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2638em;">eventLoop</span><span class="stl_107 stl_108 stl_294" style="word-spacing:-0.2638em;">−</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2638em;">&gt;f i</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2628em;">&nbsp;r</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2628em;">&nbsp;e</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2628em;">&nbsp;d</span><span class="stl_10 stl_11 stl_294" style="word-spacing:0.2472em;">&nbsp;=</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.0196em;">&nbsp;zmalloc (</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2053em;">&nbsp;</span><span class="stl_15 stl_16 stl_294" style="word-spacing:-0.2053em;">sizeof</span><span class="stl_15 stl_16 stl_294" style="word-spacing:-0.2045em;">&nbsp;</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2045em;">(</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2258em;">&nbsp;aeFiredEvent</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2248em;">&nbsp;)</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2788em;">&nbsp;*</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2068em;">&nbsp;s</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2578em;">&nbsp;e</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2568em;">&nbsp;t</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2568em;">&nbsp;s</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2578em;">&nbsp;i</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2568em;">&nbsp;z</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.2568em;">&nbsp;e</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.1518em;">&nbsp;)</span><span class="stl_10 stl_11 stl_294" style="word-spacing:-0.1518em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:8.045em;z-index:115; "><span class="stl_15 stl_16 stl_295" style="word-spacing:-0.1363em;">i f</span><span class="stl_15 stl_16 stl_295" style="word-spacing:0.57em;">&nbsp;</span><span class="stl_10 stl_11 stl_295" style="word-spacing:0.57em;">(</span><span class="stl_10 stl_11 stl_295" style="word-spacing:-0.1293em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_295" style="word-spacing:-0.1293em;">−</span><span class="stl_10 stl_11 stl_295" style="word-spacing:-0.1293em;">&gt;events</span><span class="stl_10 stl_11 stl_295" style="word-spacing:0.2897em;">&nbsp;==</span><span class="stl_10 stl_11 stl_295" style="word-spacing:0.0977em;">&nbsp;NULL</span><span class="stl_10 stl_11 stl_295" style="word-spacing:0.4317em;">&nbsp;|</span><span class="stl_10 stl_11 stl_295" style="word-spacing:-0.0973em;">&nbsp;|</span><span class="stl_10 stl_11 stl_295" style="word-spacing:0.5797em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_295" style="word-spacing:0.5797em;">−</span><span class="stl_10 stl_11 stl_295" style="word-spacing:0.5797em;">&gt;f</span><span class="stl_10 stl_11 stl_295" style="word-spacing:-0.1413em;">&nbsp;i</span><span class="stl_10 stl_11 stl_295" style="word-spacing:-0.1423em;">&nbsp;r</span><span class="stl_10 stl_11 stl_295" style="word-spacing:-0.1413em;">&nbsp;e</span><span class="stl_10 stl_11 stl_295" style="word-spacing:-0.1413em;">&nbsp;d</span><span class="stl_10 stl_11 stl_295" style="word-spacing:0.3397em;">&nbsp;==</span><span class="stl_10 stl_11 stl_295" style="word-spacing:0.0977em;">&nbsp;NULL &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.6458em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 7.7068em; left:10.5925em;z-index:136; "><span class="stl_15 stl_16 stl_292">goto</span><span class="stl_15 stl_16 stl_292" style="word-spacing:0.3707em;">&nbsp;</span><span class="stl_10 stl_11 stl_292" style="word-spacing:0.3707em;">err</span><span class="stl_10 stl_11 stl_292" style="word-spacing:0.3707em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.9625em;z-index:146; "><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1834em;">eventLoop</span><span class="stl_107 stl_108 stl_296" style="word-spacing:-0.1834em;">−</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1834em;">&gt;s e</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1824em;">&nbsp;t</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1824em;">&nbsp;s</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1834em;">&nbsp;i</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1824em;">&nbsp;z</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1824em;">&nbsp;e</span><span class="stl_10 stl_11 stl_296" style="word-spacing:0.3281em;">&nbsp;= s</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1834em;">&nbsp;e</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1824em;">&nbsp;t</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1824em;">&nbsp;s</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1834em;">&nbsp;i</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1824em;">&nbsp;z</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1824em;">&nbsp;e</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1824em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:7.9625em;z-index:173; "><span class="stl_10 stl_11 stl_297" style="word-spacing:0.2512em;">eventLoop</span><span class="stl_107 stl_108 stl_297" style="word-spacing:0.2512em;">−</span><span class="stl_10 stl_11 stl_297" style="word-spacing:0.2512em;">&gt;lastTime = time</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1618em;">&nbsp;(NULL)</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1618em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;链</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;头 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:7.9625em;z-index:213; "><span class="stl_10 stl_11 stl_298" style="word-spacing:0.241em;">eventLoop</span><span class="stl_107 stl_108 stl_298" style="word-spacing:0.241em;">−</span><span class="stl_10 stl_11 stl_298" style="word-spacing:0.241em;">&gt;timeEventHead =</span><span class="stl_10 stl_11 stl_298" style="word-spacing:0.099em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">后</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;续</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;提</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:7.9625em;z-index:249; "><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2033em;">eventLoop</span><span class="stl_107 stl_108 stl_299" style="word-spacing:0.2033em;">−</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2033em;">&gt;timeEventNextId =</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2553em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:7.9625em;z-index:278; "><span class="stl_10 stl_11 stl_106" style="word-spacing:0.2377em;">eventLoop</span><span class="stl_107 stl_108 stl_106" style="word-spacing:0.2377em;">−</span><span class="stl_10 stl_11 stl_106" style="word-spacing:0.2377em;">&gt;stop =</span><span class="stl_10 stl_11 stl_106" style="word-spacing:0.2667em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:7.9625em;z-index:296; "><span class="stl_10 stl_11 stl_300" style="word-spacing:0.2185em;">eventLoop</span><span class="stl_107 stl_108 stl_300" style="word-spacing:0.2185em;">−</span><span class="stl_10 stl_11 stl_300" style="word-spacing:0.2185em;">&gt;maxfd =</span><span class="stl_10 stl_11 stl_300" style="word-spacing:0.2711em;">&nbsp;</span><span class="stl_107 stl_108 stl_300" style="word-spacing:0.2185em;">−</span><span class="stl_10 stl_11 stl_300" style="word-spacing:0.2711em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:8.4207em;"><span class="stl_58 stl_59 stl_301">/</span><span class="stl_58 stl_59 stl_301" style="word-spacing:0.2934em;">&nbsp;</span><span class="stl_17 stl_18 stl_301" style="word-spacing:0.2934em;">进</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2674em;">&nbsp;入</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;事</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;件</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;循</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;环</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;前</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;需</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;要</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;执</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;行</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;的</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;操</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2324em;">&nbsp;作，</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2334em;">&nbsp;此</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;项</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;会</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2664em;">&nbsp;在</span><span class="stl_17 stl_18 stl_301" style="word-spacing:0.3823em;">&nbsp;</span><span class="stl_58 stl_59 stl_301" style="word-spacing:0.3823em;">redis</span><span class="stl_58 stl_59 stl_301" style="word-spacing:0.3226em;">&nbsp;main</span><span class="stl_58 stl_59 stl_301" style="word-spacing:-0.2984em;">&nbsp;()</span><span class="stl_58 stl_59 stl_301" style="word-spacing:0.3612em;">&nbsp;</span><span class="stl_17 stl_18 stl_301" style="word-spacing:-0.2984em;">函 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.8815em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0503em;">数 中 设 置 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:7.9625em;z-index:353; "><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1583em;">eventLoop</span><span class="stl_107 stl_108 stl_302" style="word-spacing:-0.1583em;">−</span><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1583em;">&gt;b e</span><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1573em;">&nbsp;f</span><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1583em;">&nbsp;o</span><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1573em;">&nbsp;r</span><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1583em;">&nbsp;e</span><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1573em;">&nbsp;s</span><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1583em;">&nbsp;l</span><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1573em;">&nbsp;e</span><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1583em;">&nbsp;e</span><span class="stl_10 stl_11 stl_302" style="word-spacing:-0.1573em;">&nbsp;p</span><span class="stl_10 stl_11 stl_302" style="word-spacing:0.3527em;">&nbsp;=</span><span class="stl_10 stl_11 stl_302" style="word-spacing:0.1297em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_303">/</span><span class="stl_58 stl_59 stl_303" style="word-spacing:0.3177em;">&nbsp;</span><span class="stl_17 stl_18 stl_303" style="word-spacing:0.3177em;">在</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2432em;">&nbsp;这</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2092em;">&nbsp;里，</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2114em;">&nbsp;</span><span class="stl_58 stl_59 stl_303" style="word-spacing:-0.2114em;">aeApiCreate</span><span class="stl_58 stl_59 stl_303" style="word-spacing:-0.2172em;">&nbsp;()</span><span class="stl_58 stl_59 stl_303" style="word-spacing:0.3849em;">&nbsp;</span><span class="stl_17 stl_18 stl_303" style="word-spacing:0.3849em;">函</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;数</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;对</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;于</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;每</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;个</span><span class="stl_17 stl_18 stl_303" style="word-spacing:0.2734em;">&nbsp;</span><span class="stl_58 stl_59 stl_303" style="word-spacing:0.2734em;">IO</span><span class="stl_58 stl_59 stl_303" style="word-spacing:0.2738em;">&nbsp;</span><span class="stl_17 stl_18 stl_303" style="word-spacing:0.2738em;">多</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2432em;">&nbsp;路</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;复</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;用</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;模</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;型</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;的</span><span class="stl_17 stl_18 stl_303" style="word-spacing:-0.2422em;">&nbsp;实 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:9.6417em;"><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2383em;">现 都</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;有</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;不</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2033em;">&nbsp;同，</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2043em;">&nbsp;具</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;体</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;参</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;见</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;源</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;代</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2033em;">&nbsp;码，</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2033em;">&nbsp;因</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;为</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;每</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;种</span><span class="stl_17 stl_18 stl_304" style="word-spacing:0.2775em;">&nbsp;</span><span class="stl_58 stl_59 stl_304" style="word-spacing:0.2775em;">IO</span><span class="stl_58 stl_59 stl_304" style="word-spacing:0.2786em;">&nbsp;</span><span class="stl_17 stl_18 stl_304" style="word-spacing:0.2786em;">多</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;路</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;复</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;用</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;模</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;型</span><span class="stl_17 stl_18 stl_304" style="word-spacing:-0.2373em;">&nbsp;的 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.8632em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">初 始 化 都 不 同 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:8.045em;"><span class="stl_15 stl_16 stl_305" style="word-spacing:-0.2298em;">i f</span><span class="stl_15 stl_16 stl_305" style="word-spacing:0.4766em;">&nbsp;</span><span class="stl_10 stl_11 stl_305" style="word-spacing:0.4766em;">(</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.2018em;">&nbsp;aeApiCreate</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.2018em;">&nbsp;(</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.2148em;">&nbsp;eventLoop</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.2138em;">&nbsp;)</span><span class="stl_10 stl_11 stl_305" style="word-spacing:0.1812em;">&nbsp;==</span><span class="stl_10 stl_11 stl_305" style="word-spacing:0.1279em;">&nbsp;</span><span class="stl_107 stl_108 stl_305" style="word-spacing:0.1812em;">−</span><span class="stl_10 stl_11 stl_305" style="word-spacing:0.1279em;">1)</span><span class="stl_10 stl_11 stl_305" style="word-spacing:0.267em;">&nbsp;</span><span class="stl_15 stl_16 stl_305" style="word-spacing:0.267em;">goto</span><span class="stl_15 stl_16 stl_305" style="word-spacing:0.3836em;">&nbsp;</span><span class="stl_10 stl_11 stl_305" style="word-spacing:0.3836em;">err</span><span class="stl_10 stl_11 stl_305" style="word-spacing:0.3836em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_306" style="word-spacing:0.4344em;">* Events</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.4924em;">&nbsp;with</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.4324em;">&nbsp;mask</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.2044em;">&nbsp;==</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.0514em;">&nbsp;AE_NONE</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.2644em;">&nbsp;are</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.5004em;">&nbsp;not set</span><span class="stl_58 stl_59 stl_306" style="word-spacing:-0.0276em;">&nbsp;.</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.4849em;">&nbsp;So l</span><span class="stl_58 stl_59 stl_306" style="word-spacing:-0.1366em;">&nbsp;e</span><span class="stl_58 stl_59 stl_306" style="word-spacing:-0.1366em;">&nbsp;t</span><span class="stl_58 stl_59 stl_306" style="word-spacing:-0.0361em;">&nbsp;’</span><span class="stl_58 stl_59 stl_306" style="word-spacing:-0.0361em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:9.7275em;"><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.295em;">i n</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.296em;">&nbsp;i</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.295em;">&nbsp;t</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.295em;">&nbsp;i</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.295em;">&nbsp;a</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.295em;">&nbsp;l</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.295em;">&nbsp;i</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.296em;">&nbsp;z</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.295em;">&nbsp;e</span><span class="stl_58 stl_59 stl_307" style="word-spacing:0.429em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 31.6235em; left:9.5052em;"><span class="stl_58 stl_59 stl_308" style="word-spacing:0.3609em;">vector with</span><span class="stl_58 stl_59 stl_308" style="word-spacing:0.4109em;">&nbsp;i</span><span class="stl_58 stl_59 stl_308" style="word-spacing:-0.3061em;">&nbsp;t</span><span class="stl_58 stl_59 stl_308" style="word-spacing:-0.1601em;">&nbsp;.</span><span class="stl_58 stl_59 stl_308" style="word-spacing:0.3129em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">初</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;始</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;化</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;类</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;型</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;掩</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;码</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;无</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;状</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;态 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:7.9808em;"><span class="stl_15 stl_16 stl_309">for</span><span class="stl_15 stl_16 stl_309" style="word-spacing:0.4249em;">&nbsp;</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.4249em;">(</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.115em;">&nbsp;i</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.281em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.521em;">&nbsp;i</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.261em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.337em;">&nbsp;s</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.205em;">&nbsp;e</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.204em;">&nbsp;t</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.205em;">&nbsp;s</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.204em;">&nbsp;i</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.204em;">&nbsp;z</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.205em;">&nbsp;e</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.043em;">&nbsp;;</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.541em;">&nbsp;i++) &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:9.955em;z-index:597; "><span class="stl_10 stl_11 stl_310" style="word-spacing:-0.0132em;">eventLoop</span><span class="stl_107 stl_108 stl_310" style="word-spacing:-0.0132em;">−</span><span class="stl_10 stl_11 stl_310" style="word-spacing:-0.0132em;">&gt;events [</span><span class="stl_10 stl_11 stl_310" style="word-spacing:0.0278em;">&nbsp;i</span><span class="stl_10 stl_11 stl_310" style="word-spacing:0.0818em;">&nbsp;]</span><span class="stl_10 stl_11 stl_310" style="word-spacing:-0.0792em;">&nbsp;.</span><span class="stl_10 stl_11 stl_310" style="word-spacing:-0.0512em;">&nbsp;mask</span><span class="stl_10 stl_11 stl_310" style="word-spacing:0.2458em;">&nbsp;=</span><span class="stl_10 stl_11 stl_310" style="word-spacing:0.0998em;">&nbsp;AE_NONE; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:7.9458em;"><span class="stl_15 stl_16 stl_311">return</span><span class="stl_15 stl_16 stl_311" style="word-spacing:0.3444em;">&nbsp;</span><span class="stl_10 stl_11 stl_311" style="word-spacing:0.3444em;">eventLoop</span><span class="stl_10 stl_11 stl_311" style="word-spacing:0.3444em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:6.0242em;"><span class="stl_10 stl_11 stl_312" style="word-spacing:-0.232em;">err : &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:8.045em;"><span class="stl_15 stl_16 stl_313" style="word-spacing:-0.2455em;">i f</span><span class="stl_15 stl_16 stl_313" style="word-spacing:0.4609em;">&nbsp;</span><span class="stl_10 stl_11 stl_313" style="word-spacing:0.4609em;">(</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2305em;">&nbsp;eventLoop</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2295em;">&nbsp;)</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2295em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:10.025em;z-index:671; "><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.1948em;">z f r e e ( eventLoop</span><span class="stl_107 stl_108 stl_314" style="word-spacing:-0.1948em;">−</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.1948em;">&gt;events ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:10.025em;z-index:696; "><span class="stl_10 stl_11 stl_315" style="word-spacing:-0.1645em;">z f r e e ( eventLoop</span><span class="stl_107 stl_108 stl_315" style="word-spacing:-0.1645em;">−</span><span class="stl_10 stl_11 stl_315" style="word-spacing:-0.1645em;">&gt;f i r e d ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:10.025em;"><span class="stl_10 stl_11 stl_258" style="word-spacing:-0.2265em;">z f r e e ( eventLoop ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.5727em; left:7.9458em;"><span class="stl_15 stl_16 stl_186" style="word-spacing:0.3002em;">return </span><span class="stl_10 stl_11 stl_186" style="word-spacing:0.3002em;">NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.6348em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">有上面初始化工作只是完成了一个空空的事件中心而已。要想驱动事件循环，还 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">需要下面的工作。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_05.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_05.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">3.2. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">事件驱动原理 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">31 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4457em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 5.4457em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">.2 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1257em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1257em;">事件驱动原理 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.1823em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 8.1823em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.2.1 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">事件注册详解 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.4368em; left:7.5658em;z-index:79; "><span class="stl_17 stl_18 stl_316" style="word-spacing:0.0297em;">文件 </span><span class="stl_10 stl_11 stl_316" style="word-spacing:0.0297em;">I/O </span><span class="stl_17 stl_18 stl_316" style="word-spacing:0.0297em;">事件注册主要操作在 </span><span class="stl_10 stl_11 stl_316" style="word-spacing:0.0297em;">aeCreateFileEvent() </span><span class="stl_17 stl_18 stl_316" style="word-spacing:0.0297em;">中完成。</span><span class="stl_10 stl_11 stl_316" style="word-spacing:0.0297em;">aeCreateFileEvent() &nbsp;</span></div>
					<div class="stl_01" style="top: 11.4326em; left:5.9058em;z-index:136; "><span class="stl_17 stl_18 stl_317" style="word-spacing:0.053em;">会根据文件描述符的数值大小在事件循环结构体的 </span><span class="stl_10 stl_11 stl_317" style="word-spacing:0.053em;">I/O </span><span class="stl_17 stl_18 stl_317" style="word-spacing:0.053em;">事件表中取一个数据空间，利 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.4293em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">用系统提供的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">I/O </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">多路复用技术监听感兴趣的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">I/O </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">事件，并设置回调函数。 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.1618em; left:5.9875em;"><span class="stl_15 stl_16 stl_303">int</span><span class="stl_15 stl_16 stl_303" style="word-spacing:0.3748em;">&nbsp;</span><span class="stl_10 stl_11 stl_303" style="word-spacing:0.3748em;">aeCreateFileEvent</span><span class="stl_10 stl_11 stl_303" style="word-spacing:-0.2192em;">&nbsp;(</span><span class="stl_10 stl_11 stl_303" style="word-spacing:-0.2632em;">&nbsp;aeEventLoop</span><span class="stl_10 stl_11 stl_303" style="word-spacing:0.2808em;">&nbsp;*eventLoop</span><span class="stl_10 stl_11 stl_303" style="word-spacing:-0.1252em;">&nbsp;,</span><span class="stl_10 stl_11 stl_303" style="word-spacing:0.417em;">&nbsp;</span><span class="stl_15 stl_16 stl_303" style="word-spacing:0.417em;">int</span><span class="stl_15 stl_16 stl_303" style="word-spacing:0.3416em;">&nbsp;</span><span class="stl_10 stl_11 stl_303" style="word-spacing:0.3416em;">fd</span><span class="stl_10 stl_11 stl_303" style="word-spacing:-0.1122em;">&nbsp;,</span><span class="stl_10 stl_11 stl_303" style="word-spacing:0.4177em;">&nbsp;</span><span class="stl_15 stl_16 stl_303" style="word-spacing:0.4177em;">int &nbsp;</span></div>
					<div class="stl_01" style="top: 20.1626em; left:7.5858em;"><span class="stl_10 stl_11 stl_318" style="word-spacing:-0.088em;">mask , &nbsp;</span></div>
					<div class="stl_01" style="top: 21.1543em; left:9.995em;"><span class="stl_10 stl_11 stl_319" style="word-spacing:0.2962em;">aeFileProc *proc</span><span class="stl_10 stl_11 stl_319" style="word-spacing:-0.1498em;">&nbsp;,</span><span class="stl_10 stl_11 stl_319" style="word-spacing:0.3329em;">&nbsp;</span><span class="stl_15 stl_16 stl_319" style="word-spacing:0.3329em;">void</span><span class="stl_15 stl_16 stl_319" style="word-spacing:-0.0754em;">&nbsp;</span><span class="stl_10 stl_11 stl_319" style="word-spacing:-0.0754em;">* clientData</span><span class="stl_10 stl_11 stl_319" style="word-spacing:-0.0754em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 22.1551em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 23.1468em; left:8.045em;z-index:279; "><span class="stl_15 stl_16 stl_213" style="word-spacing:-0.1702em;">i f</span><span class="stl_15 stl_16 stl_213" style="word-spacing:0.5362em;">&nbsp;</span><span class="stl_10 stl_11 stl_213" style="word-spacing:0.5362em;">(</span><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.1282em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_213" style="word-spacing:0.1888em;">&nbsp;&gt;=</span><span class="stl_10 stl_11 stl_213" style="word-spacing:0.2418em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_213" style="word-spacing:0.2418em;">−</span><span class="stl_10 stl_11 stl_213" style="word-spacing:0.2418em;">&gt;s</span><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.1692em;">&nbsp;e</span><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.1692em;">&nbsp;t</span><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.1702em;">&nbsp;s</span><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.1692em;">&nbsp;i</span><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.1692em;">&nbsp;z</span><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.1702em;">&nbsp;e</span><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.0642em;">&nbsp;)</span><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.0642em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.1476em; left:9.99em;"><span class="stl_10 stl_11 stl_320" style="word-spacing:0.3878em;">errno =</span><span class="stl_10 stl_11 stl_320" style="word-spacing:0.1558em;">&nbsp;ERANGE; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.1393em; left:9.9383em;"><span class="stl_15 stl_16 stl_321" style="word-spacing:0.3364em;">return </span><span class="stl_10 stl_11 stl_321" style="word-spacing:0.3364em;">AE_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.1401em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 27.1385em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.1385em; left:8.4207em;"><span class="stl_58 stl_59 stl_121">/</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.5858em;">&nbsp;</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.5858em;">在</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.6327em;">&nbsp;</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.6327em;">I</span><span class="stl_58 stl_59 stl_121" style="word-spacing:-0.023em;">&nbsp;/O</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.4419em;">&nbsp;</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.4419em;">事</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.026em;">&nbsp;件 表 中 选 择 一 个 空</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.026em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.1335em; left:7.995em;z-index:358; "><span class="stl_10 stl_11 stl_322" style="word-spacing:0.344em;">aeFileEvent *</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.223em;">&nbsp;f</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.273em;">&nbsp;e</span><span class="stl_10 stl_11 stl_322" style="word-spacing:0.238em;">&nbsp;=</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.001em;">&nbsp;&amp;eventLoop</span><span class="stl_107 stl_108 stl_322" style="word-spacing:-0.001em;">−</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.001em;">&gt;events</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.141em;">&nbsp;[</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.15em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.096em;">&nbsp;]</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.096em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.1276em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.1276em; left:8.4207em;"><span class="stl_58 stl_59 stl_323" style="word-spacing:0.3285em;">/ aeApiAddEvent</span><span class="stl_58 stl_59 stl_323" style="word-spacing:-0.2035em;">&nbsp;()</span><span class="stl_58 stl_59 stl_323" style="word-spacing:0.4248em;">&nbsp;</span><span class="stl_17 stl_18 stl_323" style="word-spacing:0.4248em;">只</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2035em;">&nbsp;在</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2025em;">&nbsp;此</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2025em;">&nbsp;函</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2025em;">&nbsp;数</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2025em;">&nbsp;中</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2025em;">&nbsp;调</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.1685em;">&nbsp;用，</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.1695em;">&nbsp;对</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2025em;">&nbsp;于</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2025em;">&nbsp;不</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2025em;">&nbsp;同</span><span class="stl_17 stl_18 stl_323" style="word-spacing:0.3131em;">&nbsp;</span><span class="stl_58 stl_59 stl_323" style="word-spacing:0.3131em;">IO</span><span class="stl_58 stl_59 stl_323" style="word-spacing:0.3134em;">&nbsp;</span><span class="stl_17 stl_18 stl_323" style="word-spacing:0.3134em;">多</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2035em;">&nbsp;路</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2025em;">&nbsp;复</span><span class="stl_17 stl_18 stl_323" style="word-spacing:-0.2025em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.344em; left:9.6417em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.305em;">实 现， 会 有 所 不 同 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.1135em; left:8.045em;"><span class="stl_15 stl_16 stl_194" style="word-spacing:-0.1855em;">i f</span><span class="stl_15 stl_16 stl_194" style="word-spacing:0.5209em;">&nbsp;</span><span class="stl_10 stl_11 stl_194" style="word-spacing:0.5209em;">(</span><span class="stl_10 stl_11 stl_194" style="word-spacing:-0.1985em;">&nbsp;aeApiAddEvent</span><span class="stl_10 stl_11 stl_194" style="word-spacing:-0.1975em;">&nbsp;(</span><span class="stl_10 stl_11 stl_194" style="word-spacing:-0.1785em;">&nbsp;eventLoop</span><span class="stl_10 stl_11 stl_194" style="word-spacing:-0.0445em;">&nbsp;,</span><span class="stl_10 stl_11 stl_194" style="word-spacing:0.4845em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_194" style="word-spacing:-0.0315em;">&nbsp;,</span><span class="stl_10 stl_11 stl_194" style="word-spacing:0.4285em;">&nbsp;mask)</span><span class="stl_10 stl_11 stl_194" style="word-spacing:0.2255em;">&nbsp;==</span><span class="stl_10 stl_11 stl_194" style="word-spacing:0.1719em;">&nbsp;</span><span class="stl_107 stl_108 stl_194" style="word-spacing:0.2255em;">−</span><span class="stl_10 stl_11 stl_194" style="word-spacing:0.1719em;">1) &nbsp;</span></div>
					<div class="stl_01" style="top: 33.1093em; left:9.9383em;"><span class="stl_15 stl_16 stl_321" style="word-spacing:0.3364em;">return </span><span class="stl_10 stl_11 stl_321" style="word-spacing:0.3364em;">AE_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.1068em; left:7.9917em;z-index:470; "><span class="stl_10 stl_11 stl_324" style="word-spacing:0.3847em;">fe</span><span class="stl_107 stl_108 stl_324" style="word-spacing:0.3847em;">−</span><span class="stl_10 stl_11 stl_324" style="word-spacing:0.3847em;">&gt;mask |= mask</span><span class="stl_10 stl_11 stl_324" style="word-spacing:0.3847em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.101em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.101em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">设</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;回</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.091em; left:8.045em;z-index:513; "><span class="stl_15 stl_16 stl_325" style="word-spacing:-0.0389em;">i f</span><span class="stl_15 stl_16 stl_325" style="word-spacing:0.6675em;">&nbsp;</span><span class="stl_10 stl_11 stl_325" style="word-spacing:0.6675em;">(mask</span><span class="stl_10 stl_11 stl_325" style="word-spacing:0.3251em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_325" style="word-spacing:0.1901em;">&nbsp;AE_READABLE)</span><span class="stl_10 stl_11 stl_325" style="word-spacing:0.6021em;">&nbsp;fe</span><span class="stl_107 stl_108 stl_325" style="word-spacing:0.6021em;">−</span><span class="stl_10 stl_11 stl_325" style="word-spacing:0.6021em;">&gt;r</span><span class="stl_10 stl_11 stl_325" style="word-spacing:-0.0469em;">&nbsp;f</span><span class="stl_10 stl_11 stl_325" style="word-spacing:-0.0459em;">&nbsp;i</span><span class="stl_10 stl_11 stl_325" style="word-spacing:-0.0469em;">&nbsp;l</span><span class="stl_10 stl_11 stl_325" style="word-spacing:-0.0459em;">&nbsp;e</span><span class="stl_10 stl_11 stl_325" style="word-spacing:-0.0469em;">&nbsp;P</span><span class="stl_10 stl_11 stl_325" style="word-spacing:-0.0459em;">&nbsp;r</span><span class="stl_10 stl_11 stl_325" style="word-spacing:-0.0469em;">&nbsp;o</span><span class="stl_10 stl_11 stl_325" style="word-spacing:-0.0459em;">&nbsp;c</span><span class="stl_10 stl_11 stl_325" style="word-spacing:0.4641em;">&nbsp;=</span><span class="stl_10 stl_11 stl_325" style="word-spacing:0.3981em;">&nbsp;proc</span><span class="stl_10 stl_11 stl_325" style="word-spacing:0.3981em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.0868em; left:8.045em;z-index:552; "><span class="stl_15 stl_16 stl_326" style="word-spacing:-0.1234em;">i f</span><span class="stl_15 stl_16 stl_326" style="word-spacing:0.583em;">&nbsp;</span><span class="stl_10 stl_11 stl_326" style="word-spacing:0.583em;">(mask</span><span class="stl_10 stl_11 stl_326" style="word-spacing:0.2406em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_326" style="word-spacing:0.1126em;">&nbsp;AE_WRITABLE)</span><span class="stl_10 stl_11 stl_326" style="word-spacing:0.5186em;">&nbsp;fe</span><span class="stl_107 stl_108 stl_326" style="word-spacing:0.5186em;">−</span><span class="stl_10 stl_11 stl_326" style="word-spacing:0.5186em;">&gt;wfileProc</span><span class="stl_10 stl_11 stl_326" style="word-spacing:0.3301em;">&nbsp;= proc</span><span class="stl_10 stl_11 stl_326" style="word-spacing:0.3301em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.0885em; left:7.9917em;z-index:593; "><span class="stl_10 stl_11 stl_327" style="word-spacing:0.1662em;">fe</span><span class="stl_107 stl_108 stl_327" style="word-spacing:0.1662em;">−</span><span class="stl_10 stl_11 stl_327" style="word-spacing:0.1662em;">&gt;clientData = clientData</span><span class="stl_10 stl_11 stl_327" style="word-spacing:0.1662em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.0793em; left:8.045em;z-index:610; "><span class="stl_15 stl_16 stl_328" style="word-spacing:-0.17em;">i f</span><span class="stl_15 stl_16 stl_328" style="word-spacing:0.5364em;">&nbsp;</span><span class="stl_10 stl_11 stl_328" style="word-spacing:0.5364em;">(</span><span class="stl_10 stl_11 stl_328" style="word-spacing:-0.128em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_328" style="word-spacing:0.2605em;">&nbsp;&gt; eventLoop</span><span class="stl_107 stl_108 stl_328" style="word-spacing:0.2605em;">−</span><span class="stl_10 stl_11 stl_328" style="word-spacing:0.2605em;">&gt;maxfd</span><span class="stl_10 stl_11 stl_328" style="word-spacing:0.2605em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 42.081em; left:9.955em;z-index:627; "><span class="stl_10 stl_11 stl_328" style="word-spacing:0.2109em;">eventLoop</span><span class="stl_107 stl_108 stl_328" style="word-spacing:0.2109em;">−</span><span class="stl_10 stl_11 stl_328" style="word-spacing:0.2109em;">&gt;maxfd =</span><span class="stl_10 stl_11 stl_328" style="word-spacing:0.2779em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_328" style="word-spacing:0.2779em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.0718em; left:7.9458em;"><span class="stl_15 stl_16 stl_329" style="word-spacing:0.3187em;">return </span><span class="stl_10 stl_11 stl_329" style="word-spacing:0.3187em;">AE_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.0735em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.5658em;"><span class="stl_17 stl_18 stl_330" style="word-spacing:0.0855em;">对于不同版本的 </span><span class="stl_10 stl_11 stl_330" style="word-spacing:0.0855em;">I/O </span><span class="stl_17 stl_18 stl_330" style="word-spacing:0.0855em;">多路复用，比如 </span><span class="stl_10 stl_11 stl_330" style="word-spacing:0.0855em;">epoll</span><span class="stl_17 stl_18 stl_330" style="word-spacing:0.0855em;">，</span><span class="stl_10 stl_11 stl_330" style="word-spacing:0.0855em;">select</span><span class="stl_17 stl_18 stl_330" style="word-spacing:0.0855em;">，</span><span class="stl_10 stl_11 stl_330" style="word-spacing:0.0855em;">kqueue </span><span class="stl_17 stl_18 stl_330" style="word-spacing:0.0855em;">等，</span><span class="stl_10 stl_11 stl_330" style="word-spacing:0.0855em;">redis </span><span class="stl_17 stl_18 stl_330" style="word-spacing:0.0855em;">有各自的 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;"><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0886em;">版本，但接口统一，譬如 </span><span class="stl_10 stl_11 stl_331" style="word-spacing:0.0886em;">aeApiAddEvent()</span><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0886em;">。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_07.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_07.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">32 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:23.0308em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 3.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0823em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">事件驱动详解 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.1264em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 15.1264em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.2.2 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">准备监听工作 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.8901em; left:7.5658em;"><span class="stl_10 stl_11 stl_332" style="word-spacing:0.2025em;">initServer() </span><span class="stl_17 stl_18 stl_332" style="word-spacing:0.2025em;">中调用了 </span><span class="stl_10 stl_11 stl_332" style="word-spacing:0.2025em;">aeCreateEventLoop() </span><span class="stl_17 stl_18 stl_332" style="word-spacing:0.2025em;">完成了事件中心的初始化，</span><span class="stl_10 stl_11 stl_332" style="word-spacing:0.2025em;">init- &nbsp;</span></div>
					<div class="stl_01" style="top: 17.8868em; left:5.9058em;"><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0859em;">Server() </span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0859em;">还做了监听的准备。 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.416em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.4118em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.416em; left:6.4282em;"><span class="stl_58 stl_59 stl_333" style="word-spacing:0.2857em;">* Open</span><span class="stl_58 stl_59 stl_333" style="word-spacing:0.3507em;">&nbsp;the</span><span class="stl_58 stl_59 stl_333" style="word-spacing:0.2527em;">&nbsp;TCP</span><span class="stl_58 stl_59 stl_333" style="word-spacing:0.3037em;">&nbsp;l</span><span class="stl_58 stl_59 stl_333" style="word-spacing:-0.2193em;">&nbsp;i</span><span class="stl_58 stl_59 stl_333" style="word-spacing:-0.2183em;">&nbsp;s</span><span class="stl_58 stl_59 stl_333" style="word-spacing:-0.2193em;">&nbsp;t</span><span class="stl_58 stl_59 stl_333" style="word-spacing:-0.2183em;">&nbsp;e</span><span class="stl_58 stl_59 stl_333" style="word-spacing:-0.2193em;">&nbsp;n</span><span class="stl_58 stl_59 stl_333" style="word-spacing:-0.2183em;">&nbsp;i</span><span class="stl_58 stl_59 stl_333" style="word-spacing:-0.2193em;">&nbsp;n</span><span class="stl_58 stl_59 stl_333" style="word-spacing:-0.2183em;">&nbsp;g</span><span class="stl_58 stl_59 stl_333" style="word-spacing:0.4914em;">&nbsp;socket for the</span><span class="stl_58 stl_59 stl_333" style="word-spacing:0.4457em;">&nbsp;user</span><span class="stl_58 stl_59 stl_333" style="word-spacing:0.3427em;">&nbsp;commands</span><span class="stl_58 stl_59 stl_333" style="word-spacing:-0.2243em;">&nbsp;.</span><span class="stl_58 stl_59 stl_333" style="word-spacing:0.4127em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.4118em; left:6.4282em;"><span class="stl_58 stl_59 stl_334" style="word-spacing:0.2788em;">/ listenToPort</span><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.2532em;">&nbsp;()</span><span class="stl_58 stl_59 stl_334" style="word-spacing:0.3159em;">&nbsp;</span><span class="stl_17 stl_18 stl_334" style="word-spacing:0.3159em;">中</span><span class="stl_17 stl_18 stl_334" style="word-spacing:-0.3112em;">&nbsp;有</span><span class="stl_17 stl_18 stl_334" style="word-spacing:-0.3112em;">&nbsp;调</span><span class="stl_17 stl_18 stl_334" style="word-spacing:-0.3112em;">&nbsp;用</span><span class="stl_17 stl_18 stl_334" style="word-spacing:0.3711em;">&nbsp;</span><span class="stl_58 stl_59 stl_334" style="word-spacing:0.3711em;">l</span><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.3302em;">&nbsp;i</span><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.3292em;">&nbsp;s</span><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.3292em;">&nbsp;t</span><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.3292em;">&nbsp;e</span><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.3292em;">&nbsp;n</span><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.2022em;">&nbsp;() &nbsp;</span></div>
					<div class="stl_01" style="top: 22.4018em; left:6.0525em;"><span class="stl_15 stl_16 stl_73" style="word-spacing:-0.2712em;">i f</span><span class="stl_15 stl_16 stl_73" style="word-spacing:0.4352em;">&nbsp;</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.4352em;">(</span><span class="stl_10 stl_11 stl_73" style="word-spacing:-0.1982em;">&nbsp;server</span><span class="stl_10 stl_11 stl_73" style="word-spacing:-0.1422em;">&nbsp;.</span><span class="stl_10 stl_11 stl_73" style="word-spacing:-0.1732em;">&nbsp;port</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.3138em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.2508em;">&nbsp;0</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.0838em;">&nbsp;&amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.4027em; left:8.005em;"><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.2242em;">listenToPort ( server . port , server . ipfd ,&amp; server . ipfd_count ) &nbsp;</span></div>
					<div class="stl_01" style="top: 24.3993em; left:9.46em;"><span class="stl_10 stl_11 stl_07">=</span></div>
					<div class="stl_01" style="top: 24.3993em; left:10.008em;"><span class="stl_10 stl_11 stl_336" style="word-spacing:0.2667em;">= REDIS_ERR) &nbsp;</span></div>
					<div class="stl_01" style="top: 25.3951em; left:8.0242em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.3048em;">e x i t (1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.3893em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.386em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.3893em; left:6.4282em;"><span class="stl_58 stl_59 stl_337" style="word-spacing:0.4513em;">/ UNIX</span><span class="stl_58 stl_59 stl_337" style="word-spacing:0.4912em;">&nbsp;</span><span class="stl_17 stl_18 stl_337" style="word-spacing:0.4912em;">域</span><span class="stl_17 stl_18 stl_337" style="word-spacing:0.0353em;">&nbsp;套 接</span><span class="stl_17 stl_18 stl_337" style="word-spacing:0.0353em;">&nbsp;字 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.386em; left:6.4282em;"><span class="stl_58 stl_59 stl_338" style="word-spacing:0.2684em;">* Open</span><span class="stl_58 stl_59 stl_338" style="word-spacing:0.3334em;">&nbsp;the</span><span class="stl_58 stl_59 stl_338" style="word-spacing:0.4874em;">&nbsp;l</span><span class="stl_58 stl_59 stl_338" style="word-spacing:-0.2356em;">&nbsp;i</span><span class="stl_58 stl_59 stl_338" style="word-spacing:-0.2366em;">&nbsp;s</span><span class="stl_58 stl_59 stl_338" style="word-spacing:-0.2356em;">&nbsp;t</span><span class="stl_58 stl_59 stl_338" style="word-spacing:-0.2356em;">&nbsp;e</span><span class="stl_58 stl_59 stl_338" style="word-spacing:-0.2366em;">&nbsp;n</span><span class="stl_58 stl_59 stl_338" style="word-spacing:-0.2356em;">&nbsp;i</span><span class="stl_58 stl_59 stl_338" style="word-spacing:-0.2366em;">&nbsp;n</span><span class="stl_58 stl_59 stl_338" style="word-spacing:-0.2356em;">&nbsp;g</span><span class="stl_58 stl_59 stl_338" style="word-spacing:0.4284em;">&nbsp;Unix</span><span class="stl_58 stl_59 stl_338" style="word-spacing:0.3084em;">&nbsp;domain</span><span class="stl_58 stl_59 stl_338" style="word-spacing:0.3814em;">&nbsp;socket</span><span class="stl_58 stl_59 stl_338" style="word-spacing:-0.1256em;">&nbsp;.</span><span class="stl_58 stl_59 stl_338" style="word-spacing:0.3954em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.3752em; left:6.0525em;"><span class="stl_15 stl_16 stl_236" style="word-spacing:-0.2554em;">i f</span><span class="stl_15 stl_16 stl_236" style="word-spacing:0.451em;">&nbsp;</span><span class="stl_10 stl_11 stl_236" style="word-spacing:0.451em;">(</span><span class="stl_10 stl_11 stl_236" style="word-spacing:-0.1824em;">&nbsp;server</span><span class="stl_10 stl_11 stl_236" style="word-spacing:-0.1264em;">&nbsp;.</span><span class="stl_10 stl_11 stl_236" style="word-spacing:-0.1444em;">&nbsp;unixsocket</span><span class="stl_10 stl_11 stl_236" style="word-spacing:0.3426em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_236" style="word-spacing:0.1466em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_236" style="word-spacing:0.1466em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.3768em; left:7.9983em;"><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.2555em;">unlink (</span><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.2325em;">&nbsp;server</span><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.1765em;">&nbsp;.</span><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.1945em;">&nbsp;unixsocket</span><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.2505em;">&nbsp;)</span><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.2145em;">&nbsp;;</span><span class="stl_10 stl_11 stl_339" style="word-spacing:0.3382em;">&nbsp;</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.3382em;">/*</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.0001em;">&nbsp;don ’</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2495em;">&nbsp;t</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.3615em;">&nbsp;care</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.4235em;">&nbsp;i</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2865em;">&nbsp;f</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.4825em;">&nbsp;t</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3135em;">&nbsp;h</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3135em;">&nbsp;i</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3125em;">&nbsp;s</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.4875em;">&nbsp;f</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2795em;">&nbsp;a</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2795em;">&nbsp;i</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2805em;">&nbsp;l</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2795em;">&nbsp;s</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.3795em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.3726em; left:8.0175em;"><span class="stl_10 stl_11 stl_340" style="word-spacing:-0.1994em;">server .</span><span class="stl_10 stl_11 stl_340" style="word-spacing:-0.2154em;">&nbsp;sofd</span><span class="stl_10 stl_11 stl_340" style="word-spacing:0.1356em;">&nbsp;=</span><span class="stl_10 stl_11 stl_340" style="word-spacing:-0.1738em;">&nbsp;anetUnixServer (</span><span class="stl_10 stl_11 stl_340" style="word-spacing:-0.2544em;">&nbsp;server</span><span class="stl_10 stl_11 stl_340" style="word-spacing:-0.1994em;">&nbsp;.</span><span class="stl_10 stl_11 stl_340" style="word-spacing:-0.2204em;">&nbsp;neterr</span><span class="stl_10 stl_11 stl_340" style="word-spacing:-0.0974em;">&nbsp;,</span><span class="stl_10 stl_11 stl_340" style="word-spacing:-0.1994em;">&nbsp;server</span><span class="stl_10 stl_11 stl_340" style="word-spacing:-0.1994em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 32.3693em; left:9.6542em;"><span class="stl_10 stl_11 stl_341" style="word-spacing:-0.19em;">unixsocket , server . unixsocketperm ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.3602em; left:8.045em;"><span class="stl_15 stl_16 stl_342" style="word-spacing:-0.0974em;">i f</span><span class="stl_15 stl_16 stl_342" style="word-spacing:0.609em;">&nbsp;</span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.609em;">(</span><span class="stl_10 stl_11 stl_342" style="word-spacing:-0.0244em;">&nbsp;server</span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.0316em;">&nbsp;.</span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.0166em;">&nbsp;sofd</span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.3376em;">&nbsp;==</span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.0946em;">&nbsp;ANET_ERR)</span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.0946em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.3618em; left:9.9933em;"><span class="stl_10 stl_11 stl_343" style="word-spacing:-0.1113em;">redisLog (REDIS_WARNING,</span><span class="stl_10 stl_11 stl_343" style="word-spacing:0.4837em;">&nbsp;”Opening␣</span><span class="stl_10 stl_11 stl_343" style="word-spacing:-0.1613em;">&nbsp;socket</span><span class="stl_10 stl_11 stl_343" style="word-spacing:-0.0503em;">&nbsp;:</span><span class="stl_10 stl_11 stl_343" style="word-spacing:-0.1293em;">&nbsp;␣%s</span><span class="stl_10 stl_11 stl_343" style="word-spacing:-0.1743em;">&nbsp;”</span><span class="stl_10 stl_11 stl_343" style="word-spacing:-0.0613em;">&nbsp;,</span><span class="stl_10 stl_11 stl_343" style="word-spacing:0.5107em;">&nbsp;server</span><span class="stl_10 stl_11 stl_343" style="word-spacing:0.5107em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 35.3577em; left:11.6675em;"><span class="stl_10 stl_11 stl_344" style="word-spacing:-0.2748em;">neterr ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.3543em; left:10.0167em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.3048em;">e x i t (1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.3502em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.3468em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 39.896em; left:7.5658em;"><span class="stl_17 stl_18 stl_345" style="word-spacing:0.0844em;">从上面可以看出，</span><span class="stl_10 stl_11 stl_345" style="word-spacing:0.0844em;">redis </span><span class="stl_17 stl_18 stl_345" style="word-spacing:0.0844em;">提供了 </span><span class="stl_10 stl_11 stl_345" style="word-spacing:0.0844em;">TCP </span><span class="stl_17 stl_18 stl_345" style="word-spacing:0.0844em;">和 </span><span class="stl_10 stl_11 stl_345" style="word-spacing:0.0844em;">UNIX </span><span class="stl_17 stl_18 stl_345" style="word-spacing:0.0844em;">域套接字两种工作方式。以 </span><span class="stl_10 stl_11 stl_345" style="word-spacing:0.0844em;">TCP &nbsp;</span></div>
					<div class="stl_01" style="top: 40.8918em; left:5.9058em;"><span class="stl_17 stl_18 stl_32" style="word-spacing:0.0837em;">工作方式为例，</span><span class="stl_10 stl_11 stl_32" style="word-spacing:0.0837em;">listenPort() </span><span class="stl_17 stl_18 stl_32" style="word-spacing:0.0837em;">创建绑定了套接字并启动了监听。 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.1173em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 43.1173em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.2.3 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">为监听套接字注册事件 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.8818em; left:7.5658em;z-index:687; "><span class="stl_17 stl_18 stl_346" style="word-spacing:0.068em;">在进入事件循环前还需要做一些准备工作。紧接着，</span><span class="stl_10 stl_11 stl_346" style="word-spacing:0.068em;">initServer() </span><span class="stl_17 stl_18 stl_346" style="word-spacing:0.068em;">为所有的监听套 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.8777em; left:5.9058em;"><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0856em;">接字注册了读事件，响应函数为 </span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0856em;">acceptTcpHandler() </span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0856em;">或者 </span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0856em;">acceptUnixHandler()</span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0856em;">。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">3.2. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">事件驱动原理 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">33 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_89">/</span><span class="stl_58 stl_59 stl_89" style="word-spacing:0.6234em;">&nbsp;</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.6234em;">创</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.0633em;">&nbsp;建 接 收</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.4869em;">&nbsp;</span><span class="stl_58 stl_59 stl_89" style="word-spacing:0.4869em;">TCP</span><span class="stl_58 stl_59 stl_89" style="word-spacing:0.4861em;">&nbsp;</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.4861em;">或</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.0626em;">&nbsp;者</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.5212em;">&nbsp;</span><span class="stl_58 stl_59 stl_89" style="word-spacing:0.5212em;">UNIX</span><span class="stl_58 stl_59 stl_89" style="word-spacing:0.5202em;">&nbsp;</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.5202em;">域</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.0636em;">&nbsp;套 接 字 的 事 件 处</span><span class="stl_17 stl_18 stl_89" style="word-spacing:0.0636em;">&nbsp;理 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_90" style="word-spacing:0.485em;">/ TCP &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4207em;"><span class="stl_58 stl_59 stl_91" style="word-spacing:0.2742em;">* Create an event</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.3786em;">&nbsp;handler for accepting</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.2756em;">&nbsp;new</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.2756em;">&nbsp;connections &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.65em;"><span class="stl_58 stl_59 stl_92" style="word-spacing:0.3182em;">in TCP</span><span class="stl_58 stl_59 stl_92" style="word-spacing:0.2603em;">&nbsp;and</span><span class="stl_58 stl_59 stl_92" style="word-spacing:0.4042em;">&nbsp;Unix &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.4371em;"><span class="stl_58 stl_59 stl_93" style="word-spacing:0.3488em;">domain sockets</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.1592em;">&nbsp;.</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.3558em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:7.9808em;"><span class="stl_15 stl_16 stl_94">for</span><span class="stl_15 stl_16 stl_94" style="word-spacing:0.3555em;">&nbsp;</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.3555em;">(</span><span class="stl_10 stl_11 stl_94" style="word-spacing:-0.1984em;">&nbsp;j</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.2046em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.4376em;">&nbsp;j</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.1776em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.2346em;">&nbsp;server</span><span class="stl_10 stl_11 stl_94" style="word-spacing:-0.1454em;">&nbsp;.</span><span class="stl_10 stl_11 stl_94" style="word-spacing:-0.1884em;">&nbsp;ipfd_count</span><span class="stl_10 stl_11 stl_94" style="word-spacing:-0.1884em;">&nbsp;;</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.4576em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_94" style="word-spacing:0.4576em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:10.4132em;"><span class="stl_58 stl_59 stl_95" style="word-spacing:0.3001em;">/ acceptTcpHandler</span><span class="stl_58 stl_59 stl_95" style="word-spacing:-0.2319em;">&nbsp;()</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.3911em;">&nbsp;tcp</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.364em;">&nbsp;</span><span class="stl_17 stl_18 stl_95" style="word-spacing:0.364em;">连</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;接</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;接</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;受</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;处</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;理</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;函</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2599em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:10.0375em;"><span class="stl_15 stl_16 stl_96" style="word-spacing:-0.3313em;">i f</span><span class="stl_15 stl_16 stl_96" style="word-spacing:0.3751em;">&nbsp;</span><span class="stl_10 stl_11 stl_96" style="word-spacing:0.3751em;">(</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2843em;">&nbsp;aeCreateFileEvent</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2843em;">&nbsp;(</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2583em;">&nbsp;server</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2033em;">&nbsp;.</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2263em;">&nbsp;el</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.1073em;">&nbsp;,</span><span class="stl_10 stl_11 stl_96" style="word-spacing:0.3977em;">&nbsp;server</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2033em;">&nbsp;.</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2053em;">&nbsp;ipfd</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.2063em;">&nbsp;[</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.1993em;">&nbsp;j</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.1993em;">&nbsp;]</span><span class="stl_10 stl_11 stl_96" style="word-spacing:-0.1993em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:11.4692em;"><span class="stl_10 stl_11 stl_97">AE_READABLE, &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.9583em;"><span class="stl_10 stl_11 stl_98" style="word-spacing:0.0443em;">acceptTcpHandler ,NULL)</span><span class="stl_10 stl_11 stl_98" style="word-spacing:0.2893em;">&nbsp;==</span><span class="stl_10 stl_11 stl_98" style="word-spacing:0.0783em;">&nbsp;AE_ERR) &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:11.925em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 17.6743em; left:13.9875em;"><span class="stl_10 stl_11 stl_99" style="word-spacing:-0.2794em;">redisPanic ( &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:15.9217em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 18.671em; left:16.4588em;"><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.2957em;">Unrecoverable ␣ error ␣ creating ␣ server . ipfd &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:17.57em;"><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.2351em;">␣ f i l e ␣ event . ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 21.6593em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4207em;"><span class="stl_58 stl_59 stl_337" style="word-spacing:0.4513em;">/ UNIX</span><span class="stl_58 stl_59 stl_337" style="word-spacing:0.4912em;">&nbsp;</span><span class="stl_17 stl_18 stl_337" style="word-spacing:0.4912em;">域</span><span class="stl_17 stl_18 stl_337" style="word-spacing:0.0353em;">&nbsp;套 接</span><span class="stl_17 stl_18 stl_337" style="word-spacing:0.0353em;">&nbsp;字 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:8.045em;"><span class="stl_15 stl_16 stl_347" style="word-spacing:-0.3197em;">i f</span><span class="stl_15 stl_16 stl_347" style="word-spacing:0.3867em;">&nbsp;</span><span class="stl_10 stl_11 stl_347" style="word-spacing:0.3867em;">(</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2467em;">&nbsp;server</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.1907em;">&nbsp;.</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2057em;">&nbsp;sofd</span><span class="stl_10 stl_11 stl_347" style="word-spacing:0.1153em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_347" style="word-spacing:0.0943em;">&nbsp;0</span><span class="stl_10 stl_11 stl_347" style="word-spacing:0.0363em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.1703em;">&nbsp;aeCreateFileEvent (</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2467em;">&nbsp;server</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.1917em;">&nbsp;.</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2147em;">&nbsp;el</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.0957em;">&nbsp;,</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.1907em;">&nbsp;server &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:9.6925em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 25.6443em; left:10.145em;"><span class="stl_10 stl_11 stl_348" style="word-spacing:0.2101em;">sofd ,AE_READABLE, &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.9708em;"><span class="stl_10 stl_11 stl_349" style="word-spacing:-0.0058em;">acceptUnixHandler ,NULL)</span><span class="stl_10 stl_11 stl_349" style="word-spacing:0.2262em;">&nbsp;==</span><span class="stl_10 stl_11 stl_349" style="word-spacing:0.0152em;">&nbsp;AE_ERR)</span><span class="stl_10 stl_11 stl_349" style="word-spacing:0.4792em;">&nbsp;redisPanic</span><span class="stl_10 stl_11 stl_349" style="word-spacing:-0.1198em;">&nbsp;(</span><span class="stl_10 stl_11 stl_349" style="word-spacing:-0.1198em;">&nbsp;” &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:11.6442em;"><span class="stl_10 stl_11 stl_334" style="word-spacing:-0.2894em;">Unrecoverable ␣ error ␣ creating ␣ server . sofd ␣ f i l e ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:11.6392em;"><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.231em;">event . ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:5.9883em;"><span class="stl_17 stl_18 stl_350" style="word-spacing:-0.2511em;">来 看</span><span class="stl_17 stl_18 stl_350" style="word-spacing:-0.2511em;">&nbsp;看</span><span class="stl_17 stl_18 stl_350" style="word-spacing:-0.2558em;">&nbsp;</span><span class="stl_10 stl_11 stl_350" style="word-spacing:-0.2558em;">acceptTcpHandler</span><span class="stl_10 stl_11 stl_350" style="word-spacing:-0.2151em;">&nbsp;()</span><span class="stl_10 stl_11 stl_350" style="word-spacing:0.3891em;">&nbsp;</span><span class="stl_17 stl_18 stl_350" style="word-spacing:0.3891em;">做</span><span class="stl_17 stl_18 stl_350" style="word-spacing:-0.2511em;">&nbsp;了</span><span class="stl_17 stl_18 stl_350" style="word-spacing:-0.2511em;">&nbsp;什</span><span class="stl_17 stl_18 stl_350" style="word-spacing:-0.2181em;">&nbsp;么： &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:6.4282em;"><span class="stl_58 stl_59 stl_149">/</span><span class="stl_58 stl_59 stl_149" style="word-spacing:0.6648em;">&nbsp;</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.6648em;">用</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.104em;">&nbsp;于</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.5284em;">&nbsp;</span><span class="stl_58 stl_59 stl_149" style="word-spacing:0.5284em;">TCP</span><span class="stl_58 stl_59 stl_149" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.5265em;">接</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.105em;">&nbsp;收 请 求 的 处 理 函</span><span class="stl_17 stl_18 stl_149" style="word-spacing:0.105em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:5.9483em;"><span class="stl_15 stl_16 stl_150">void</span><span class="stl_15 stl_16 stl_150" style="word-spacing:0.3246em;">&nbsp;</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.3246em;">acceptTcpHandler</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.2227em;">&nbsp;(</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.2447em;">&nbsp;aeEventLoop</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.2993em;">&nbsp;*</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.2547em;">&nbsp;el</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.0237em;">&nbsp;,</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.4358em;">&nbsp;</span><span class="stl_15 stl_16 stl_150" style="word-spacing:0.4358em;">int</span><span class="stl_15 stl_16 stl_150" style="word-spacing:0.3601em;">&nbsp;</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.3601em;">fd</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.0937em;">&nbsp;,</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.389em;">&nbsp;</span><span class="stl_15 stl_16 stl_150" style="word-spacing:0.389em;">void</span><span class="stl_15 stl_16 stl_150" style="word-spacing:0.2784em;">&nbsp;</span><span class="stl_10 stl_11 stl_150" style="word-spacing:0.2784em;">*</span><span class="stl_10 stl_11 stl_150" style="word-spacing:-0.2637em;">&nbsp;privdata &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:7.7em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 34.606em; left:8.6442em;"><span class="stl_15 stl_16 stl_151" style="word-spacing:0.3525em;">int </span><span class="stl_10 stl_11 stl_151" style="word-spacing:0.3525em;">mask) { &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:7.98em;"><span class="stl_15 stl_16 stl_152">int</span><span class="stl_15 stl_16 stl_152" style="word-spacing:0.3384em;">&nbsp;</span><span class="stl_10 stl_11 stl_152" style="word-spacing:0.3384em;">cport</span><span class="stl_10 stl_11 stl_152" style="word-spacing:-0.0965em;">&nbsp;,</span><span class="stl_10 stl_11 stl_152" style="word-spacing:0.4205em;">&nbsp;cfd</span><span class="stl_10 stl_11 stl_152" style="word-spacing:0.4205em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:7.9342em;"><span class="stl_15 stl_16 stl_153">char</span><span class="stl_15 stl_16 stl_153" style="word-spacing:0.549em;">&nbsp;</span><span class="stl_10 stl_11 stl_153" style="word-spacing:0.549em;">cip</span><span class="stl_10 stl_11 stl_153" style="word-spacing:0.0666em;">&nbsp;[REDIS_IP_STR_LEN</span><span class="stl_10 stl_11 stl_153" style="word-spacing:-0.0624em;">&nbsp;]</span><span class="stl_10 stl_11 stl_153" style="word-spacing:-0.0624em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:7.8358em;"><span class="stl_10 stl_11 stl_154" style="word-spacing:0.1487em;">REDIS_NOTUSED( e</span><span class="stl_10 stl_11 stl_154" style="word-spacing:0.0427em;">&nbsp;l</span><span class="stl_10 stl_11 stl_154" style="word-spacing:0.1497em;">&nbsp;)</span><span class="stl_10 stl_11 stl_154" style="word-spacing:0.1497em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:7.8358em;"><span class="stl_10 stl_11 stl_155" style="word-spacing:0.074em;">REDIS_NOTUSED(mask) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.8358em;"><span class="stl_10 stl_11 stl_156" style="word-spacing:-0.0077em;">REDIS_NOTUSED( privdata ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;收</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;客</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;户</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;端</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;请</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;求 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:8.0008em;"><span class="stl_10 stl_11 stl_157" style="word-spacing:0.1647em;">cfd =</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.1586em;">&nbsp;anetTcpAccept (</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.2203em;">&nbsp;server</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.1653em;">&nbsp;.</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.1863em;">&nbsp;neterr</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.0633em;">&nbsp;,</span><span class="stl_10 stl_11 stl_157" style="word-spacing:0.3747em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.1403em;">&nbsp;,</span><span class="stl_10 stl_11 stl_157" style="word-spacing:0.3947em;">&nbsp;cip</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.1003em;">&nbsp;,</span><span class="stl_10 stl_11 stl_157" style="word-spacing:0.4134em;">&nbsp;</span><span class="stl_15 stl_16 stl_157" style="word-spacing:0.4134em;">sizeof</span><span class="stl_15 stl_16 stl_157" style="word-spacing:-0.241em;">&nbsp;</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.241em;">(</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.2343em;">&nbsp;cip</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.2343em;">&nbsp;)</span><span class="stl_10 stl_11 stl_157" style="word-spacing:-0.2343em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:10.1558em;"><span class="stl_10 stl_11 stl_158" style="word-spacing:-0.2435em;">cport ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:9.485em;"><span class="stl_10 stl_11 stl_07">&amp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5718em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">出</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;错 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.561em; left:8.045em;"><span class="stl_15 stl_16 stl_159" style="word-spacing:0.0133em;">i f</span><span class="stl_15 stl_16 stl_159" style="word-spacing:0.7197em;">&nbsp;</span><span class="stl_10 stl_11 stl_159" style="word-spacing:0.7197em;">(</span><span class="stl_10 stl_11 stl_159" style="word-spacing:0.0663em;">&nbsp;cfd</span><span class="stl_10 stl_11 stl_159" style="word-spacing:0.4413em;">&nbsp;==</span><span class="stl_10 stl_11 stl_159" style="word-spacing:0.2123em;">&nbsp;AE_ERR)</span><span class="stl_10 stl_11 stl_159" style="word-spacing:0.2123em;">&nbsp;{ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">34 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:23.0308em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 3.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0823em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">事件驱动详解 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:9.9933em;"><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.1507em;">redisLog (REDIS_WARNING, ” Accepting ␣ c l i e n t ␣ connection : ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:11.4542em;"><span class="stl_10 stl_11 stl_07">%</span></div>
					<div class="stl_01" style="top: 6.7151em; left:12.135em;"><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.3682em;">s ”</span><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.2552em;">&nbsp;,</span><span class="stl_10 stl_11 stl_161" style="word-spacing:0.3168em;">&nbsp;server</span><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.2302em;">&nbsp;.</span><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.2322em;">&nbsp;neterr</span><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.2882em;">&nbsp;)</span><span class="stl_10 stl_11 stl_161" style="word-spacing:-0.2882em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:9.9383em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;录 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:8.0008em;"><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1106em;">redisLog (REDIS_VERBOSE,</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1146em;">&nbsp;”</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1896em;">&nbsp;Accepted␣%s:%d”</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.0606em;">&nbsp;,</span><span class="stl_10 stl_11 stl_163" style="word-spacing:0.4714em;">&nbsp;cip</span><span class="stl_10 stl_11 stl_163" style="word-spacing:0.0304em;">&nbsp;,</span><span class="stl_10 stl_11 stl_163" style="word-spacing:0.5414em;">&nbsp;cport</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1136em;">&nbsp;)</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1136em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">真</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;正</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;意</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;思</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;地</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;方 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:7.9483em;"><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.1512em;">acceptCommonHandler ( cfd , 0 ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 17.4327em; left:7.5658em;"><span class="stl_17 stl_18 stl_351" style="word-spacing:0.1164em;">接收套接字与客户端建立连接后，调用 </span><span class="stl_10 stl_11 stl_351" style="word-spacing:0.1164em;">acceptCommonHandler()</span><span class="stl_17 stl_18 stl_351" style="word-spacing:0.1164em;">。</span><span class="stl_10 stl_11 stl_351" style="word-spacing:0.1164em;">acceptCom- &nbsp;</span></div>
					<div class="stl_01" style="top: 18.4293em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.082em;">monHandler() </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.082em;">主要工作就是： &nbsp;</span></div>
					<div class="stl_01" style="top: 19.511em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 19.511em; left:7.981em;"><span class="stl_10 stl_11 stl_352">.</span><span class="stl_10 stl_11 stl_352" style="word-spacing:0.4534em;">&nbsp;</span><span class="stl_17 stl_18 stl_352" style="word-spacing:0.4534em;">建立并保存服务端与客户端的连接信息，这些信息保存在一个</span><span class="stl_17 stl_18 stl_352" style="word-spacing:0.0981em;">&nbsp;</span><span class="stl_10 stl_11 stl_352" style="word-spacing:0.0981em;">struct</span><span class="stl_10 stl_11 stl_352" style="word-spacing:0.0981em;">&nbsp;re- &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5068em; left:5.9058em;"><span class="stl_10 stl_11 stl_353">disClient</span><span class="stl_10 stl_11 stl_353" style="word-spacing:0.1013em;">&nbsp;</span><span class="stl_17 stl_18 stl_353" style="word-spacing:0.1013em;">结构体中；</span><span class="stl_10 stl_11 stl_353" style="word-spacing:0.1013em;">2.</span><span class="stl_10 stl_11 stl_353" style="word-spacing:0.3779em;">&nbsp;</span><span class="stl_17 stl_18 stl_353" style="word-spacing:0.3779em;">为与客户端连接的套接字注册读事件，相应的回调函数为 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.5035em; left:5.9058em;"><span class="stl_10 stl_11 stl_53" style="word-spacing:0.0947em;">readQueryFromClient()</span><span class="stl_17 stl_18 stl_53" style="word-spacing:0.0947em;">，</span><span class="stl_10 stl_11 stl_53" style="word-spacing:0.0947em;">readQueryFromClient() </span><span class="stl_17 stl_18 stl_53" style="word-spacing:0.0947em;">作用是从套接字读取数据，执行相 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.7215em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">应操作并回复客户端。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.0814em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 25.0814em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.2.4 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">事件循环 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.971em; left:7.5658em;"><span class="stl_17 stl_18 stl_354" style="word-spacing:0.1244em;">以上做好了准备工作，可以进入事件循环。跳出 </span><span class="stl_10 stl_11 stl_354" style="word-spacing:0.1244em;">initServer() </span><span class="stl_17 stl_18 stl_354" style="word-spacing:0.1244em;">回到 </span><span class="stl_10 stl_11 stl_354" style="word-spacing:0.1244em;">main() </span><span class="stl_17 stl_18 stl_354" style="word-spacing:0.1244em;">中， &nbsp;</span></div>
					<div class="stl_01" style="top: 27.9668em; left:5.9058em;"><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0839em;">main() </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0839em;">会调用 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0839em;">aeMain()</span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0839em;">。进入事件循环发生在 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0839em;">aeProcessEvents() </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0839em;">中： &nbsp;</span></div>
					<div class="stl_01" style="top: 29.0485em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 29.0485em; left:7.981em;"><span class="stl_10 stl_11 stl_355">.</span><span class="stl_10 stl_11 stl_355" style="word-spacing:0.2915em;">&nbsp;</span><span class="stl_17 stl_18 stl_355" style="word-spacing:0.2915em;">根据定时事件表计算需要等待的最短时间；</span><span class="stl_10 stl_11 stl_355" style="word-spacing:0.2915em;">2.</span><span class="stl_10 stl_11 stl_355" style="word-spacing:0.2915em;">&nbsp;</span><span class="stl_17 stl_18 stl_355" style="word-spacing:0.2915em;">调用</span><span class="stl_17 stl_18 stl_355" style="word-spacing:0.1018em;">&nbsp;</span><span class="stl_10 stl_11 stl_355" style="word-spacing:0.1018em;">redis api aeApiPoll()</span><span class="stl_10 stl_11 stl_355" style="word-spacing:0.1008em;">&nbsp;</span><span class="stl_17 stl_18 stl_355" style="word-spacing:0.1018em;">进 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.0452em; left:5.9058em;"><span class="stl_17 stl_18 stl_356" style="word-spacing:0.0849em;">入监听轮询，如果没有事件发生就会进入睡眠状态，其实就是 </span><span class="stl_10 stl_11 stl_356" style="word-spacing:0.0849em;">I/O </span><span class="stl_17 stl_18 stl_356" style="word-spacing:0.0849em;">多路复用 </span><span class="stl_10 stl_11 stl_356" style="word-spacing:0.0849em;">select() &nbsp;</span></div>
					<div class="stl_01" style="top: 31.041em; left:5.9058em;"><span class="stl_10 stl_11 stl_357">epoll()</span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0823em;">&nbsp;</span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0823em;">等的调用；</span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0823em;">3.</span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.192em;">&nbsp;</span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.192em;">有事件发生会被唤醒，处理已触发的</span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.081em;">&nbsp;</span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.081em;">I/O</span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0818em;">&nbsp;</span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0818em;">事件和定时事件。 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6977em; left:5.9483em;"><span class="stl_15 stl_16 stl_105">void</span><span class="stl_15 stl_16 stl_105" style="word-spacing:0.3121em;">&nbsp;</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.3121em;">aeMain</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.235em;">&nbsp;(</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.219em;">&nbsp;aeEventLoop</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.325em;">&nbsp;*eventLoop</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.207em;">&nbsp;)</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.207em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6993em; left:7.9625em;z-index:680; "><span class="stl_10 stl_11 stl_106" style="word-spacing:0.2377em;">eventLoop</span><span class="stl_107 stl_108 stl_106" style="word-spacing:0.2377em;">−</span><span class="stl_10 stl_11 stl_106" style="word-spacing:0.2377em;">&gt;stop =</span><span class="stl_10 stl_11 stl_106" style="word-spacing:0.2667em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6902em; left:7.9483em;z-index:705; "><span class="stl_15 stl_16 stl_109">while</span><span class="stl_15 stl_16 stl_109" style="word-spacing:0.4647em;">&nbsp;</span><span class="stl_10 stl_11 stl_109" style="word-spacing:0.4647em;">(</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.1971em;">&nbsp;!</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.1181em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_109" style="word-spacing:-0.1181em;">−</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.1181em;">&gt;stop</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.1561em;">&nbsp;)</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.1561em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.6893em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.6893em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">进 入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;事</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;件</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;循</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;环</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;能</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;睡</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;眠</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;状</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;态。</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;在</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;睡</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;眠</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;之</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;前，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;执</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;预 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.686em; left:11.6342em;"><span class="stl_17 stl_18 stl_110" style="word-spacing:-0.2891em;">设 置</span><span class="stl_17 stl_18 stl_110" style="word-spacing:-0.2881em;">&nbsp;的</span><span class="stl_17 stl_18 stl_110" style="word-spacing:-0.2881em;">&nbsp;函</span><span class="stl_17 stl_18 stl_110" style="word-spacing:-0.2881em;">&nbsp;数</span><span class="stl_17 stl_18 stl_110" style="word-spacing:0.3314em;">&nbsp;</span><span class="stl_58 stl_59 stl_110" style="word-spacing:0.3314em;">aeSetBeforeSleepProc</span><span class="stl_58 stl_59 stl_110" style="word-spacing:-0.2421em;">&nbsp;()</span><span class="stl_58 stl_59 stl_110" style="word-spacing:-0.2613em;">&nbsp;</span><span class="stl_17 stl_18 stl_110" style="word-spacing:-0.2421em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.6752em; left:10.0375em;z-index:780; "><span class="stl_15 stl_16 stl_111" style="word-spacing:-0.1306em;">i f</span><span class="stl_15 stl_16 stl_111" style="word-spacing:0.5758em;">&nbsp;</span><span class="stl_10 stl_11 stl_111" style="word-spacing:0.5758em;">(</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1236em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_111" style="word-spacing:-0.1236em;">−</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1236em;">&gt;b</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1536em;">&nbsp;e</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1526em;">&nbsp;f</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1536em;">&nbsp;o</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1526em;">&nbsp;r</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1536em;">&nbsp;e</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1526em;">&nbsp;s</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1536em;">&nbsp;l</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1526em;">&nbsp;e</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1536em;">&nbsp;e</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1526em;">&nbsp;p</span><span class="stl_10 stl_11 stl_111" style="word-spacing:0.4944em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_111" style="word-spacing:0.2714em;">&nbsp;NULL) &nbsp;</span></div>
					<div class="stl_01" style="top: 40.6768em; left:11.9483em;z-index:809; "><span class="stl_10 stl_11 stl_112" style="word-spacing:-0.2087em;">eventLoop</span><span class="stl_107 stl_108 stl_112" style="word-spacing:-0.2087em;">−</span><span class="stl_10 stl_11 stl_112" style="word-spacing:-0.2087em;">&gt;b e f o r e s l e e p ( eventLoop ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.671em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.671em; left:10.4132em;"><span class="stl_58 stl_59 stl_113" style="word-spacing:0.4967em;">/ AE_ALL_EVENTS</span><span class="stl_58 stl_59 stl_113" style="word-spacing:0.5356em;">&nbsp;</span><span class="stl_17 stl_18 stl_113" style="word-spacing:0.5356em;">表</span><span class="stl_17 stl_18 stl_113" style="word-spacing:0.1247em;">&nbsp;示 处 理 所 有 的 事</span><span class="stl_17 stl_18 stl_113" style="word-spacing:0.1247em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.6652em; left:9.985em;"><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.096em;">aeProcessEvents (</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.131em;">&nbsp;eventLoop</span><span class="stl_10 stl_11 stl_114" style="word-spacing:0.002em;">&nbsp;,</span><span class="stl_10 stl_11 stl_114" style="word-spacing:0.355em;">&nbsp;AE_ALL_EVENTS)</span><span class="stl_10 stl_11 stl_114" style="word-spacing:0.355em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.6618em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 45.6577em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">»</span></div>
					<div class="stl_01" style="top: 47.4085em; left:8.0275em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0834em;">»» </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0834em;">此处考虑要不要加代码了 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">3.2. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">事件驱动原理 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">35 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.5223em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 5.5223em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">.2.5 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">事件触发 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.5076em; left:7.5658em;"><span class="stl_17 stl_18 stl_248" style="word-spacing:0.0998em;">这里以 </span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.0998em;">select </span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.0998em;">版本的 </span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.0998em;">redis api </span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.0998em;">实现作为讲解，</span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.0998em;">aeApiPoll() </span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.0998em;">调用了 </span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.0998em;">select() </span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.0998em;">进入 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.5035em; left:5.9058em;z-index:83; "><span class="stl_17 stl_18 stl_358" style="word-spacing:0.078em;">了监听轮询。</span><span class="stl_10 stl_11 stl_358" style="word-spacing:0.078em;">aeApiPoll() </span><span class="stl_17 stl_18 stl_358" style="word-spacing:0.078em;">的 </span><span class="stl_10 stl_11 stl_358" style="word-spacing:0.078em;">tvp </span><span class="stl_17 stl_18 stl_358" style="word-spacing:0.078em;">参数是最小等待时间，它会被预先计算出来，它主要 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7223em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">完成： &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6335em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 10.6335em; left:7.981em;"><span class="stl_10 stl_11 stl_50">.</span><span class="stl_10 stl_11 stl_50" style="word-spacing:0.2964em;">&nbsp;</span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.2964em;">拷贝读写的</span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.1037em;">&nbsp;</span><span class="stl_10 stl_11 stl_50" style="word-spacing:0.1037em;">fdset</span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.1037em;">。</span><span class="stl_10 stl_11 stl_50" style="word-spacing:0.1037em;">select()</span><span class="stl_10 stl_11 stl_50" style="word-spacing:0.1035em;">&nbsp;</span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.1035em;">的调用会破坏传入的</span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.1038em;">&nbsp;</span><span class="stl_10 stl_11 stl_50" style="word-spacing:0.1038em;">fdset</span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.1038em;">，实际上有两份</span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.1042em;">&nbsp;</span><span class="stl_10 stl_11 stl_50" style="word-spacing:0.1042em;">fdset</span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.1042em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6302em; left:5.9058em;"><span class="stl_17 stl_18 stl_359" style="word-spacing:0.09em;">一份作为备份，另一份用作调用。每次调用 </span><span class="stl_10 stl_11 stl_359" style="word-spacing:0.09em;">select() </span><span class="stl_17 stl_18 stl_359" style="word-spacing:0.09em;">之前都从备份中直接拷贝一份； &nbsp;</span></div>
					<div class="stl_01" style="top: 12.626em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 12.626em; left:6.321em;"><span class="stl_10 stl_11 stl_360">.</span><span class="stl_10 stl_11 stl_360" style="word-spacing:0.2239em;">&nbsp;</span><span class="stl_17 stl_18 stl_360" style="word-spacing:0.2239em;">调用</span><span class="stl_17 stl_18 stl_360" style="word-spacing:0.0869em;">&nbsp;</span><span class="stl_10 stl_11 stl_360" style="word-spacing:0.0869em;">select()</span><span class="stl_17 stl_18 stl_360" style="word-spacing:0.0869em;">；</span><span class="stl_10 stl_11 stl_360" style="word-spacing:0.0869em;">3.</span><span class="stl_10 stl_11 stl_360" style="word-spacing:0.2249em;">&nbsp;</span><span class="stl_17 stl_18 stl_360" style="word-spacing:0.2249em;">被唤醒后，检查</span><span class="stl_17 stl_18 stl_360" style="word-spacing:0.0876em;">&nbsp;</span><span class="stl_10 stl_11 stl_360" style="word-spacing:0.0876em;">fdset</span><span class="stl_10 stl_11 stl_360" style="word-spacing:0.0872em;">&nbsp;</span><span class="stl_17 stl_18 stl_360" style="word-spacing:0.0872em;">中的每一个文件描述符，并将可读或者可 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.8448em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">写的描述符记录到触发表当中。 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.756em; left:7.5658em;"><span class="stl_17 stl_18 stl_116" style="word-spacing:0.0825em;">接下来的操作便是执行相应的回调函数，代码在上一段中已经贴出：先处理 </span><span class="stl_10 stl_11 stl_116" style="word-spacing:0.0825em;">I/O &nbsp;</span></div>
					<div class="stl_01" style="top: 15.974em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">事件，再处理定时事件。 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5118em; left:6.0075em;"><span class="stl_15 stl_16 stl_361" style="word-spacing:0.378em;">static int</span><span class="stl_15 stl_16 stl_361" style="word-spacing:0.3683em;">&nbsp;</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.3683em;">aeApiPoll</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.225em;">&nbsp;(</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.266em;">&nbsp;aeEventLoop</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.279em;">&nbsp;*eventLoop</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.127em;">&nbsp;,</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.4063em;">&nbsp;</span><span class="stl_15 stl_16 stl_361" style="word-spacing:0.4063em;">struct</span><span class="stl_15 stl_16 stl_361" style="word-spacing:0.3646em;">&nbsp;</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.3646em;">timeval</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.3646em;">&nbsp;* &nbsp;</span></div>
					<div class="stl_01" style="top: 19.5135em; left:7.6342em;"><span class="stl_10 stl_11 stl_362" style="word-spacing:-0.226em;">tvp )</span><span class="stl_10 stl_11 stl_362" style="word-spacing:-0.226em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5093em; left:7.9883em;z-index:406; "><span class="stl_10 stl_11 stl_363" style="word-spacing:0.3226em;">aeApiState *</span><span class="stl_10 stl_11 stl_363" style="word-spacing:-0.2394em;">&nbsp;state</span><span class="stl_10 stl_11 stl_363" style="word-spacing:0.2216em;">&nbsp;=</span><span class="stl_10 stl_11 stl_363" style="word-spacing:-0.0039em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_363" style="word-spacing:-0.0039em;">−</span><span class="stl_10 stl_11 stl_363" style="word-spacing:-0.0039em;">&gt;apidata</span><span class="stl_10 stl_11 stl_363" style="word-spacing:-0.0039em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.501em; left:7.98em;"><span class="stl_15 stl_16 stl_364">int</span><span class="stl_15 stl_16 stl_364" style="word-spacing:0.3874em;">&nbsp;</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.3874em;">retval</span><span class="stl_10 stl_11 stl_364" style="word-spacing:-0.0176em;">&nbsp;,</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.4134em;">&nbsp;j</span><span class="stl_10 stl_11 stl_364" style="word-spacing:-0.0886em;">&nbsp;,</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.3854em;">&nbsp;numevents</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.1354em;">&nbsp;=</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.2064em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.5001em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.5001em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 24.496em; left:7.9808em;"><span class="stl_17 stl_18 stl_365" style="word-spacing:-0.2875em;">真 有</span><span class="stl_17 stl_18 stl_365" style="word-spacing:-0.2875em;">&nbsp;意</span><span class="stl_17 stl_18 stl_365" style="word-spacing:-0.2545em;">&nbsp;思，</span><span class="stl_17 stl_18 stl_365" style="word-spacing:-0.2545em;">&nbsp;在</span><span class="stl_17 stl_18 stl_365" style="word-spacing:0.3285em;">&nbsp;</span><span class="stl_58 stl_59 stl_365" style="word-spacing:0.3285em;">aeApiState</span><span class="stl_58 stl_59 stl_365" style="word-spacing:0.3289em;">&nbsp;</span><span class="stl_17 stl_18 stl_365" style="word-spacing:0.3289em;">结</span><span class="stl_17 stl_18 stl_365" style="word-spacing:-0.2885em;">&nbsp;构</span><span class="stl_17 stl_18 stl_365" style="word-spacing:-0.2535em;">&nbsp;中： &nbsp;</span></div>
					<div class="stl_01" style="top: 25.4926em; left:8.0158em;"><span class="stl_58 stl_59 stl_366" style="word-spacing:0.3981em;">typedef s</span><span class="stl_58 stl_59 stl_366" style="word-spacing:-0.3439em;">&nbsp;t</span><span class="stl_58 stl_59 stl_366" style="word-spacing:-0.3429em;">&nbsp;r</span><span class="stl_58 stl_59 stl_366" style="word-spacing:-0.3439em;">&nbsp;u</span><span class="stl_58 stl_59 stl_366" style="word-spacing:-0.3439em;">&nbsp;c</span><span class="stl_58 stl_59 stl_366" style="word-spacing:-0.3439em;">&nbsp;t</span><span class="stl_58 stl_59 stl_366" style="word-spacing:0.3721em;">&nbsp;aeApiState</span><span class="stl_58 stl_59 stl_366" style="word-spacing:0.3721em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4885em; left:9.99em;"><span class="stl_58 stl_59 stl_367" style="word-spacing:0.3625em;">fd_set rfds</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.0865em;">&nbsp;,</span><span class="stl_58 stl_59 stl_367" style="word-spacing:0.3665em;">&nbsp;wfds</span><span class="stl_58 stl_59 stl_367" style="word-spacing:0.3665em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4851em; left:9.99em;"><span class="stl_58 stl_59 stl_368" style="word-spacing:0.3741em;">fd_set _rfds</span><span class="stl_58 stl_59 stl_368" style="word-spacing:-0.1129em;">&nbsp;,</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.3751em;">&nbsp;_wfds</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.3751em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.481em; left:8.9903em;"><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.2191em;">aeApiState ; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.481em; left:7.9392em;"><span class="stl_58 stl_59 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.4776em; left:7.9808em;"><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">在 调</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">&nbsp;用</span><span class="stl_17 stl_18 stl_370" style="word-spacing:0.4522em;">&nbsp;</span><span class="stl_58 stl_59 stl_370" style="word-spacing:0.4522em;">s</span><span class="stl_58 stl_59 stl_370" style="word-spacing:-0.2487em;">&nbsp;e</span><span class="stl_58 stl_59 stl_370" style="word-spacing:-0.2477em;">&nbsp;l</span><span class="stl_58 stl_59 stl_370" style="word-spacing:-0.2477em;">&nbsp;e</span><span class="stl_58 stl_59 stl_370" style="word-spacing:-0.2487em;">&nbsp;c</span><span class="stl_58 stl_59 stl_370" style="word-spacing:-0.2477em;">&nbsp;t</span><span class="stl_58 stl_59 stl_370" style="word-spacing:-0.1207em;">&nbsp;()</span><span class="stl_58 stl_59 stl_370" style="word-spacing:0.405em;">&nbsp;</span><span class="stl_17 stl_18 stl_370" style="word-spacing:0.405em;">的</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2237em;">&nbsp;时</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">&nbsp;候</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">&nbsp;传</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">&nbsp;入</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">&nbsp;的</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">&nbsp;是</span><span class="stl_17 stl_18 stl_370" style="word-spacing:0.3786em;">&nbsp;</span><span class="stl_58 stl_59 stl_370" style="word-spacing:0.3786em;">_rfds</span><span class="stl_58 stl_59 stl_370" style="word-spacing:0.3797em;">&nbsp;</span><span class="stl_17 stl_18 stl_370" style="word-spacing:0.3797em;">和</span><span class="stl_17 stl_18 stl_370" style="word-spacing:0.3378em;">&nbsp;</span><span class="stl_58 stl_59 stl_370" style="word-spacing:0.3378em;">_wfds</span><span class="stl_58 stl_59 stl_370" style="word-spacing:-0.2614em;">&nbsp;</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2614em;">，</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2237em;">&nbsp;所</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">&nbsp;有</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">&nbsp;监</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">&nbsp;听</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2227em;">&nbsp;的 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4735em; left:9.6417em;"><span class="stl_17 stl_18 stl_371" style="word-spacing:-0.297em;">数 据</span><span class="stl_17 stl_18 stl_371" style="word-spacing:-0.296em;">&nbsp;在</span><span class="stl_17 stl_18 stl_371" style="word-spacing:0.3547em;">&nbsp;</span><span class="stl_58 stl_59 stl_371" style="word-spacing:0.3547em;">r</span><span class="stl_58 stl_59 stl_371" style="word-spacing:-0.346em;">&nbsp;fds</span><span class="stl_58 stl_59 stl_371" style="word-spacing:0.3549em;">&nbsp;</span><span class="stl_17 stl_18 stl_371" style="word-spacing:0.3549em;">和</span><span class="stl_17 stl_18 stl_371" style="word-spacing:0.3057em;">&nbsp;</span><span class="stl_58 stl_59 stl_371" style="word-spacing:0.3057em;">wfds</span><span class="stl_58 stl_59 stl_371" style="word-spacing:0.3392em;">&nbsp;</span><span class="stl_17 stl_18 stl_371" style="word-spacing:0.3392em;">中。 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4701em; left:7.9808em;"><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2974em;">在 下</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2974em;">&nbsp;次</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2974em;">&nbsp;需</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2974em;">&nbsp;要</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2974em;">&nbsp;调</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2974em;">&nbsp;用</span><span class="stl_17 stl_18 stl_372" style="word-spacing:0.3621em;">&nbsp;</span><span class="stl_58 stl_59 stl_372" style="word-spacing:0.3621em;">s</span><span class="stl_58 stl_59 stl_372" style="word-spacing:-0.3394em;">&nbsp;e</span><span class="stl_58 stl_59 stl_372" style="word-spacing:-0.3374em;">&nbsp;l</span><span class="stl_58 stl_59 stl_372" style="word-spacing:-0.3384em;">&nbsp;e</span><span class="stl_58 stl_59 stl_372" style="word-spacing:-0.3384em;">&nbsp;c</span><span class="stl_58 stl_59 stl_372" style="word-spacing:-0.2114em;">&nbsp;()</span><span class="stl_58 stl_59 stl_372" style="word-spacing:0.3301em;">&nbsp;</span><span class="stl_17 stl_18 stl_372" style="word-spacing:0.3301em;">的</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2984em;">&nbsp;时</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2634em;">&nbsp;候，</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2644em;">&nbsp;会</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2974em;">&nbsp;将</span><span class="stl_17 stl_18 stl_372" style="word-spacing:0.3536em;">&nbsp;</span><span class="stl_58 stl_59 stl_372" style="word-spacing:0.3536em;">rf</span><span class="stl_58 stl_59 stl_372" style="word-spacing:-0.3474em;">&nbsp;ds</span><span class="stl_58 stl_59 stl_372" style="word-spacing:0.3535em;">&nbsp;</span><span class="stl_17 stl_18 stl_372" style="word-spacing:0.3535em;">和</span><span class="stl_17 stl_18 stl_372" style="word-spacing:0.3042em;">&nbsp;</span><span class="stl_58 stl_59 stl_372" style="word-spacing:0.3042em;">wfds</span><span class="stl_58 stl_59 stl_372" style="word-spacing:0.3047em;">&nbsp;</span><span class="stl_17 stl_18 stl_372" style="word-spacing:0.3047em;">中</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2984em;">&nbsp;的</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2974em;">&nbsp;数</span><span class="stl_17 stl_18 stl_372" style="word-spacing:-0.2974em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.466em; left:9.6417em;"><span class="stl_17 stl_18 stl_373" style="word-spacing:-0.219em;">拷 贝</span><span class="stl_17 stl_18 stl_373" style="word-spacing:-0.218em;">&nbsp;进</span><span class="stl_17 stl_18 stl_373" style="word-spacing:0.3845em;">&nbsp;</span><span class="stl_58 stl_59 stl_373" style="word-spacing:0.3845em;">_rfds</span><span class="stl_58 stl_59 stl_373" style="word-spacing:0.3843em;">&nbsp;</span><span class="stl_17 stl_18 stl_373" style="word-spacing:0.3843em;">和</span><span class="stl_17 stl_18 stl_373" style="word-spacing:0.3425em;">&nbsp;</span><span class="stl_58 stl_59 stl_373" style="word-spacing:0.3425em;">_wfds</span><span class="stl_58 stl_59 stl_373" style="word-spacing:0.3766em;">&nbsp;</span><span class="stl_17 stl_18 stl_373" style="word-spacing:0.3766em;">中。</span><span class="stl_17 stl_18 stl_373" style="word-spacing:-0.2254em;">&nbsp;</span><span class="stl_58 stl_59 stl_373" style="word-spacing:-0.2254em;">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.456em; left:7.8933em;z-index:659; "><span class="stl_10 stl_11 stl_374" style="word-spacing:-0.1623em;">memcpy(&amp;state </span><span class="stl_107 stl_108 stl_374" style="word-spacing:-0.1623em;">−</span><span class="stl_10 stl_11 stl_374" style="word-spacing:-0.1623em;">&gt;_rfds ,&amp; state </span><span class="stl_107 stl_108 stl_374" style="word-spacing:-0.1623em;">−</span><span class="stl_10 stl_11 stl_374" style="word-spacing:-0.1623em;">&gt;rfds , </span><span class="stl_15 stl_16 stl_374" style="word-spacing:-0.1623em;">sizeof </span><span class="stl_10 stl_11 stl_374" style="word-spacing:-0.1623em;">( fd_set ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4527em; left:7.8933em;z-index:709; "><span class="stl_10 stl_11 stl_375" style="word-spacing:-0.1514em;">memcpy(&amp;state </span><span class="stl_107 stl_108 stl_375" style="word-spacing:-0.1514em;">−</span><span class="stl_10 stl_11 stl_375" style="word-spacing:-0.1514em;">&gt;_wfds,&amp; state </span><span class="stl_107 stl_108 stl_375" style="word-spacing:-0.1514em;">−</span><span class="stl_10 stl_11 stl_375" style="word-spacing:-0.1514em;">&gt;wfds , </span><span class="stl_15 stl_16 stl_375" style="word-spacing:-0.1514em;">sizeof </span><span class="stl_10 stl_11 stl_375" style="word-spacing:-0.1514em;">( fd_set ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4502em; left:8.025em;z-index:755; "><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1976em;">r e</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1966em;">&nbsp;t</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1976em;">&nbsp;v</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1966em;">&nbsp;a</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1966em;">&nbsp;l</span><span class="stl_10 stl_11 stl_376" style="word-spacing:0.3239em;">&nbsp;= s</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1766em;">&nbsp;e</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1776em;">&nbsp;l</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1776em;">&nbsp;e</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1766em;">&nbsp;c</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1776em;">&nbsp;t</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.0716em;">&nbsp;(</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1656em;">&nbsp;eventLoop</span><span class="stl_107 stl_108 stl_376" style="word-spacing:-0.1656em;">−</span><span class="stl_10 stl_11 stl_376" style="word-spacing:-0.1656em;">&gt;maxfd+1, &nbsp;</span></div>
					<div class="stl_01" style="top: 37.446em; left:13.8017em;"><span class="stl_10 stl_11 stl_07">&amp;</span></div>
					<div class="stl_01" style="top: 37.446em; left:14.4783em;z-index:785; "><span class="stl_10 stl_11 stl_377" style="word-spacing:-0.1345em;">state </span><span class="stl_107 stl_108 stl_377" style="word-spacing:-0.1345em;">−</span><span class="stl_10 stl_11 stl_377" style="word-spacing:-0.1345em;">&gt;_rfds ,&amp; state </span><span class="stl_107 stl_108 stl_377" style="word-spacing:-0.1345em;">−</span><span class="stl_10 stl_11 stl_377" style="word-spacing:-0.1345em;">&gt;_wfds ,NULL, tvp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4377em; left:8.045em;"><span class="stl_15 stl_16 stl_265" style="word-spacing:-0.28em;">i f</span><span class="stl_15 stl_16 stl_265" style="word-spacing:0.4264em;">&nbsp;</span><span class="stl_10 stl_11 stl_265" style="word-spacing:0.4264em;">(</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.198em;">&nbsp;r</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.303em;">&nbsp;e</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.304em;">&nbsp;t</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.303em;">&nbsp;v</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.303em;">&nbsp;a</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.304em;">&nbsp;l</span><span class="stl_10 stl_11 stl_265" style="word-spacing:0.1835em;">&nbsp;&gt; 0)</span><span class="stl_10 stl_11 stl_265" style="word-spacing:0.1835em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">轮</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;询 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4302em; left:9.9733em;z-index:840; "><span class="stl_15 stl_16 stl_378">for</span><span class="stl_15 stl_16 stl_378" style="word-spacing:0.4698em;">&nbsp;</span><span class="stl_10 stl_11 stl_378" style="word-spacing:0.4698em;">(</span><span class="stl_10 stl_11 stl_378" style="word-spacing:-0.0841em;">&nbsp;j</span><span class="stl_10 stl_11 stl_378" style="word-spacing:0.3189em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_378" style="word-spacing:0.5519em;">&nbsp;j</span><span class="stl_10 stl_11 stl_378" style="word-spacing:0.2424em;">&nbsp;&lt;= eventLoop</span><span class="stl_107 stl_108 stl_378" style="word-spacing:0.2424em;">−</span><span class="stl_10 stl_11 stl_378" style="word-spacing:0.2424em;">&gt;maxfd</span><span class="stl_10 stl_11 stl_378" style="word-spacing:-0.1291em;">&nbsp;;</span><span class="stl_10 stl_11 stl_378" style="word-spacing:0.5719em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_378" style="word-spacing:0.5719em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:11.965em;"><span class="stl_15 stl_16 stl_379">int</span><span class="stl_15 stl_16 stl_379" style="word-spacing:0.3373em;">&nbsp;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.3373em;">mask</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.1487em;">&nbsp;=</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.2607em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:11.98em;z-index:888; "><span class="stl_10 stl_11 stl_380" style="word-spacing:0.3414em;">aeFileEvent *</span><span class="stl_10 stl_11 stl_380" style="word-spacing:-0.2256em;">&nbsp;fe</span><span class="stl_10 stl_11 stl_380" style="word-spacing:0.2354em;">&nbsp;=</span><span class="stl_10 stl_11 stl_380" style="word-spacing:-0.0036em;">&nbsp;&amp;eventLoop</span><span class="stl_107 stl_108 stl_380" style="word-spacing:-0.0036em;">−</span><span class="stl_10 stl_11 stl_380" style="word-spacing:-0.0036em;">&gt;events</span><span class="stl_10 stl_11 stl_380" style="word-spacing:-0.1436em;">&nbsp;[</span><span class="stl_10 stl_11 stl_380" style="word-spacing:-0.1176em;">&nbsp;j</span><span class="stl_10 stl_11 stl_380" style="word-spacing:-0.0636em;">&nbsp;]</span><span class="stl_10 stl_11 stl_380" style="word-spacing:-0.0636em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4152em; left:12.03em;z-index:905; "><span class="stl_15 stl_16 stl_381" style="word-spacing:-0.0427em;">i f</span><span class="stl_15 stl_16 stl_381" style="word-spacing:0.6637em;">&nbsp;</span><span class="stl_10 stl_11 stl_381" style="word-spacing:0.6637em;">(</span><span class="stl_10 stl_11 stl_381" style="word-spacing:-0.0007em;">&nbsp;fe</span><span class="stl_107 stl_108 stl_381" style="word-spacing:-0.0007em;">−</span><span class="stl_10 stl_11 stl_381" style="word-spacing:-0.0007em;">&gt;mask</span><span class="stl_10 stl_11 stl_381" style="word-spacing:0.2913em;">&nbsp;==</span><span class="stl_10 stl_11 stl_381" style="word-spacing:0.1443em;">&nbsp;AE_NONE)</span><span class="stl_10 stl_11 stl_381" style="word-spacing:0.5418em;">&nbsp;</span><span class="stl_15 stl_16 stl_381" style="word-spacing:0.5418em;">continue</span><span class="stl_15 stl_16 stl_381" style="word-spacing:-0.0016em;">&nbsp;</span><span class="stl_10 stl_11 stl_381" style="word-spacing:0.5418em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:12.03em;z-index:973; "><span class="stl_15 stl_16 stl_382" style="word-spacing:-0.0231em;">i f</span><span class="stl_15 stl_16 stl_382" style="word-spacing:0.6833em;">&nbsp;</span><span class="stl_10 stl_11 stl_382" style="word-spacing:0.6833em;">(</span><span class="stl_10 stl_11 stl_382" style="word-spacing:0.0189em;">&nbsp;fe</span><span class="stl_107 stl_108 stl_382" style="word-spacing:0.0189em;">−</span><span class="stl_10 stl_11 stl_382" style="word-spacing:0.0189em;">&gt;mask</span><span class="stl_10 stl_11 stl_382" style="word-spacing:0.3409em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_382" style="word-spacing:0.2059em;">&nbsp;AE_READABLE</span><span class="stl_10 stl_11 stl_382" style="word-spacing:0.1749em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_382" style="word-spacing:0.2539em;">&nbsp;FD_ISSET(</span><span class="stl_10 stl_11 stl_382" style="word-spacing:0.0039em;">&nbsp;j</span><span class="stl_10 stl_11 stl_382" style="word-spacing:0.0449em;">&nbsp;,&amp;</span><span class="stl_10 stl_11 stl_382" style="word-spacing:-0.0251em;">&nbsp;state</span><span class="stl_10 stl_11 stl_382" style="word-spacing:-0.0363em;">&nbsp;</span><span class="stl_107 stl_108 stl_382" style="word-spacing:-0.0251em;">−</span><span class="stl_10 stl_11 stl_382" style="word-spacing:-0.0251em;">&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:13.6267em;"><span class="stl_10 stl_11 stl_07">_</span></div>
					<div class="stl_01" style="top: 46.4127em; left:14.3324em;"><span class="stl_10 stl_11 stl_383" style="word-spacing:-0.2422em;">rfds ) ) &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:13.9em;"><span class="stl_10 stl_11 stl_384" style="word-spacing:0.5437em;">mask |=</span><span class="stl_10 stl_11 stl_384" style="word-spacing:0.4087em;">&nbsp;AE_READABLE; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">36 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:23.0308em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 3.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0823em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">事件驱动详解 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:12.03em;z-index:66; "><span class="stl_15 stl_16 stl_385" style="word-spacing:-0.0275em;">i f</span><span class="stl_15 stl_16 stl_385" style="word-spacing:0.6789em;">&nbsp;</span><span class="stl_10 stl_11 stl_385" style="word-spacing:0.6789em;">(</span><span class="stl_10 stl_11 stl_385" style="word-spacing:0.0145em;">&nbsp;fe</span><span class="stl_107 stl_108 stl_385" style="word-spacing:0.0145em;">−</span><span class="stl_10 stl_11 stl_385" style="word-spacing:0.0145em;">&gt;mask</span><span class="stl_10 stl_11 stl_385" style="word-spacing:0.3365em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_385" style="word-spacing:0.2085em;">&nbsp;AE_WRITABLE</span><span class="stl_10 stl_11 stl_385" style="word-spacing:0.1775em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_385" style="word-spacing:0.2495em;">&nbsp;FD_ISSET(</span><span class="stl_10 stl_11 stl_385" style="word-spacing:-0.0005em;">&nbsp;j</span><span class="stl_10 stl_11 stl_385" style="word-spacing:0.0405em;">&nbsp;,&amp;</span><span class="stl_10 stl_11 stl_385" style="word-spacing:-0.0295em;">&nbsp;state</span><span class="stl_10 stl_11 stl_385" style="word-spacing:-0.0407em;">&nbsp;</span><span class="stl_107 stl_108 stl_385" style="word-spacing:-0.0295em;">−</span><span class="stl_10 stl_11 stl_385" style="word-spacing:-0.0295em;">&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:13.5808em;"><span class="stl_10 stl_11 stl_07">_</span></div>
					<div class="stl_01" style="top: 6.7151em; left:14.2409em;"><span class="stl_10 stl_11 stl_386" style="word-spacing:-0.1597em;">wfds ) ) &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:13.9em;"><span class="stl_10 stl_11 stl_387" style="word-spacing:0.5334em;">mask |=</span><span class="stl_10 stl_11 stl_387" style="word-spacing:0.4054em;">&nbsp;AE_WRITABLE; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">添</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;加</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;触</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:11.9483em;z-index:112; "><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.2058em;">eventLoop</span><span class="stl_107 stl_108 stl_388" style="word-spacing:-0.2058em;">−</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.2058em;">&gt;f i</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.2068em;">&nbsp;r</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.2058em;">&nbsp;e</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.2058em;">&nbsp;d</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.0458em;">&nbsp;[</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.1458em;">&nbsp;numevents</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.0918em;">&nbsp;]</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.1618em;">&nbsp;.</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.0498em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_388" style="word-spacing:0.2462em;">&nbsp;=</span><span class="stl_10 stl_11 stl_388" style="word-spacing:0.2812em;">&nbsp;j</span><span class="stl_10 stl_11 stl_388" style="word-spacing:0.2812em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:11.9483em;z-index:145; "><span class="stl_10 stl_11 stl_389" style="word-spacing:-0.1853em;">eventLoop</span><span class="stl_107 stl_108 stl_389" style="word-spacing:-0.1853em;">−</span><span class="stl_10 stl_11 stl_389" style="word-spacing:-0.1853em;">&gt;f i</span><span class="stl_10 stl_11 stl_389" style="word-spacing:-0.1863em;">&nbsp;r</span><span class="stl_10 stl_11 stl_389" style="word-spacing:-0.1853em;">&nbsp;e</span><span class="stl_10 stl_11 stl_389" style="word-spacing:-0.1853em;">&nbsp;d</span><span class="stl_10 stl_11 stl_389" style="word-spacing:-0.0253em;">&nbsp;[</span><span class="stl_10 stl_11 stl_389" style="word-spacing:-0.1253em;">&nbsp;numevents</span><span class="stl_10 stl_11 stl_389" style="word-spacing:-0.0713em;">&nbsp;]</span><span class="stl_10 stl_11 stl_389" style="word-spacing:-0.1413em;">&nbsp;.</span><span class="stl_10 stl_11 stl_389" style="word-spacing:-0.1133em;">&nbsp;mask</span><span class="stl_10 stl_11 stl_389" style="word-spacing:0.1837em;">&nbsp;= mask</span><span class="stl_10 stl_11 stl_389" style="word-spacing:0.1837em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:11.9417em;"><span class="stl_10 stl_11 stl_390">numevents++; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 14.686em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6768em; left:7.9458em;"><span class="stl_15 stl_16 stl_240">return</span><span class="stl_15 stl_16 stl_240" style="word-spacing:0.3477em;">&nbsp;</span><span class="stl_10 stl_11 stl_240" style="word-spacing:0.3477em;">numevents</span><span class="stl_10 stl_11 stl_240" style="word-spacing:0.3477em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 19.4749em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 19.4749em; left:6.5789em;"><span class="stl_38 stl_13 stl_29" style="word-spacing:0.7524em;">.3 redis</span><span class="stl_38 stl_13 stl_29" style="word-spacing:0.1291em;">&nbsp;</span><span class="stl_39 stl_18 stl_29" style="word-spacing:0.1291em;">与</span><span class="stl_39 stl_18 stl_29" style="word-spacing:0.1287em;">&nbsp;</span><span class="stl_38 stl_13 stl_29" style="word-spacing:0.1287em;">memcache</span><span class="stl_38 stl_13 stl_29" style="word-spacing:0.1287em;">&nbsp;</span><span class="stl_39 stl_18 stl_29" style="word-spacing:0.1287em;">的事件驱动比较 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.7176em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">»</span></div>
					<div class="stl_01" style="top: 21.7176em; left:8.0275em;"><span class="stl_10 stl_11 stl_07">»»»»&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.0332em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">3</span></div>
					<div class="stl_01" style="top: 24.0332em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.4 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">总结 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.3393em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">的事件驱动总结如下： &nbsp;</span></div>
					<div class="stl_01" style="top: 44.1227em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 45.766em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 47.4085em; left:6.92em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 44.1227em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">初始化事件循环结构体 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.766em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">注册监听套接字的读事件 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">注册定时事件 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">3.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">总结 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">37 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:6.92em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 7.3793em; left:6.92em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 9.0401em; left:6.92em;"><span class="stl_10 stl_11 stl_07">6</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">进入事件循环 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.3793em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">如果监听套接字变为可读，会接收客户端请求，并为对应的套接字注册读事件 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.0401em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">如果与客户端连接的套接字变为可读，执行相应的操作 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">38 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:23.0308em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 3.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0823em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">事件驱动详解 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 18.5239em; left:18.3092em;"><span class="stl_36 stl_13 stl_391" style="word-spacing:0.1235em;">Part II &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2839em; left:12.2433em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1251em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1251em;">基础数据结构 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">9</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02" />
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 11.0055em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 4 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.8481em; left:5.9058em;"><span class="stl_12 stl_13 stl_244" style="word-spacing:0.1214em;">redis </span><span class="stl_37 stl_18 stl_244" style="word-spacing:0.1214em;">数据结构 </span><span class="stl_12 stl_13 stl_244" style="word-spacing:0.1214em;">redisObject &nbsp;</span></div>
					<div class="stl_01" style="top: 20.8443em; left:7.5658em;"><span class="stl_10 stl_11 stl_392" style="word-spacing:0.1165em;">redis </span><span class="stl_17 stl_18 stl_392" style="word-spacing:0.1165em;">是 </span><span class="stl_10 stl_11 stl_392" style="word-spacing:0.1165em;">key-value </span><span class="stl_17 stl_18 stl_392" style="word-spacing:0.1165em;">存储系统，其中 </span><span class="stl_10 stl_11 stl_392" style="word-spacing:0.1165em;">key </span><span class="stl_17 stl_18 stl_392" style="word-spacing:0.1165em;">类型一般为字符串，而 </span><span class="stl_10 stl_11 stl_392" style="word-spacing:0.1165em;">value </span><span class="stl_17 stl_18 stl_392" style="word-spacing:0.1165em;">类型则为 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.8401em; left:5.9058em;z-index:121; "><span class="stl_10 stl_11 stl_393" style="word-spacing:0.0816em;">redis </span><span class="stl_17 stl_18 stl_393" style="word-spacing:0.0816em;">对象（</span><span class="stl_10 stl_11 stl_393" style="word-spacing:0.0816em;">redis object</span><span class="stl_17 stl_18 stl_393" style="word-spacing:0.0816em;">）。</span><span class="stl_10 stl_11 stl_393" style="word-spacing:0.0816em;">redis </span><span class="stl_17 stl_18 stl_393" style="word-spacing:0.0816em;">对象可以绑定各种类型的数据，譬如 </span><span class="stl_10 stl_11 stl_393" style="word-spacing:0.0816em;">string</span><span class="stl_17 stl_18 stl_393" style="word-spacing:0.0816em;">、</span><span class="stl_10 stl_11 stl_393" style="word-spacing:0.0816em;">list </span><span class="stl_17 stl_18 stl_393" style="word-spacing:0.0816em;">和 </span><span class="stl_10 stl_11 stl_393" style="word-spacing:0.0816em;">set</span><span class="stl_17 stl_18 stl_393" style="word-spacing:0.0816em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.486em; left:5.9533em;"><span class="stl_15 stl_16 stl_140" style="word-spacing:0.2938em;">typedef struct</span><span class="stl_15 stl_16 stl_140" style="word-spacing:0.3704em;">&nbsp;</span><span class="stl_10 stl_11 stl_140" style="word-spacing:0.3704em;">redisObject</span><span class="stl_10 stl_11 stl_140" style="word-spacing:0.3704em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4885em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.4885em; left:8.4207em;"><span class="stl_58 stl_59 stl_71">/</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.3918em;">&nbsp;</span><span class="stl_17 stl_18 stl_71" style="word-spacing:0.3918em;">刚</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.169em;">&nbsp;刚</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;好</span><span class="stl_17 stl_18 stl_71" style="word-spacing:0.3914em;">&nbsp;</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.3914em;">32</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.47em;">&nbsp;b</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.19em;">&nbsp;i</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.189em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.189em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 28.481em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.481em; left:8.4207em;"><span class="stl_58 stl_59 stl_394">/</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.114em;">&nbsp;</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.114em;">对 象</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;的</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;类</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3034em;">&nbsp;型，</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3034em;">&nbsp;字</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;符</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;串</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.3364em;">/</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">列</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;表</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.3364em;">/</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">集</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;合</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.3364em;">/</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3374em;">哈</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3374em;">&nbsp;希</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3374em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.471em; left:7.9325em;"><span class="stl_15 stl_16 stl_395">unsigned</span><span class="stl_15 stl_16 stl_395" style="word-spacing:0.3732em;">&nbsp;</span><span class="stl_10 stl_11 stl_395" style="word-spacing:0.3732em;">type</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.082em;">&nbsp;:</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.179em;">&nbsp;4</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.179em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4701em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.4701em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">未</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;使</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;两</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;位 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4593em; left:7.9325em;"><span class="stl_15 stl_16 stl_396">unsigned</span><span class="stl_15 stl_16 stl_396" style="word-spacing:0.3554em;">&nbsp;</span><span class="stl_10 stl_11 stl_396" style="word-spacing:0.3554em;">notused</span><span class="stl_10 stl_11 stl_396" style="word-spacing:-0.0998em;">&nbsp;:</span><span class="stl_10 stl_11 stl_396" style="word-spacing:-0.2008em;">&nbsp;2</span><span class="stl_10 stl_11 stl_396" style="word-spacing:-0.2008em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.466em; left:19.9025em;"><span class="stl_58 stl_59 stl_397" style="word-spacing:0.3159em;">/* Not</span><span class="stl_58 stl_59 stl_397" style="word-spacing:0.3559em;">&nbsp;used</span><span class="stl_58 stl_59 stl_397" style="word-spacing:0.3559em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4593em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.4518em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.4593em; left:8.4207em;"><span class="stl_58 stl_59 stl_398">/</span><span class="stl_58 stl_59 stl_398" style="word-spacing:-0.1159em;">&nbsp;</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.1159em;">编 码</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;的</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;方</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3043em;">&nbsp;式，</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.2555em;">&nbsp;</span><span class="stl_58 stl_59 stl_398" style="word-spacing:-0.2555em;">redis</span><span class="stl_58 stl_59 stl_398" style="word-spacing:-0.0265em;">&nbsp;</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.0265em;">为 了</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;节</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;省</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;空</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3043em;">&nbsp;间，</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3043em;">&nbsp;提</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;供</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;多</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;种</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;方</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;式</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;来</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;保</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;存</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;一</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;个 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6757em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">数 据 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4518em; left:8.4207em;"><span class="stl_58 stl_59 stl_399">/</span><span class="stl_58 stl_59 stl_399" style="word-spacing:0.3416em;">&nbsp;</span><span class="stl_17 stl_18 stl_399" style="word-spacing:0.3416em;">譬</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.1692em;">&nbsp;如：</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2682em;">&nbsp;“</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.1876em;">&nbsp;</span><span class="stl_58 stl_59 stl_399" style="word-spacing:-0.1876em;">123456789</span><span class="stl_58 stl_59 stl_399" style="word-spacing:-0.2372em;">&nbsp;</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2372em;">”</span><span class="stl_17 stl_18 stl_399" style="word-spacing:0.3808em;">&nbsp;会</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;被</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;存</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;储</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;为</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;整</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;数</span><span class="stl_17 stl_18 stl_399" style="word-spacing:0.3627em;">&nbsp;</span><span class="stl_58 stl_59 stl_399" style="word-spacing:0.3627em;">123456789 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.441em; left:7.9325em;"><span class="stl_15 stl_16 stl_400">unsigned</span><span class="stl_15 stl_16 stl_400" style="word-spacing:0.3501em;">&nbsp;</span><span class="stl_10 stl_11 stl_400" style="word-spacing:0.3501em;">encoding</span><span class="stl_10 stl_11 stl_400" style="word-spacing:-0.1041em;">&nbsp;:</span><span class="stl_10 stl_11 stl_400" style="word-spacing:-0.2121em;">&nbsp;4</span><span class="stl_10 stl_11 stl_400" style="word-spacing:-0.2121em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.4401em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">当 内</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;存</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;紧</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;张，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;淘</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;汰</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;数</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;据</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;的</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;时</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;候</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;用</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;到 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:19.9025em;"><span class="stl_58 stl_59 stl_401" style="word-spacing:0.3143em;">/* lru</span><span class="stl_58 stl_59 stl_401" style="word-spacing:0.3513em;">&nbsp;time</span><span class="stl_58 stl_59 stl_401" style="word-spacing:0.3003em;">&nbsp;(</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.2197em;">&nbsp;r</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;e</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;l</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;a</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;t</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;i</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;v</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;e</span><span class="stl_58 stl_59 stl_401" style="word-spacing:0.3848em;">&nbsp;to server</span><span class="stl_58 stl_59 stl_401" style="word-spacing:0.3848em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4302em; left:7.9325em;"><span class="stl_15 stl_16 stl_402">unsigned</span><span class="stl_15 stl_16 stl_402" style="word-spacing:0.4082em;">&nbsp;</span><span class="stl_10 stl_11 stl_402" style="word-spacing:0.4082em;">lru</span><span class="stl_10 stl_11 stl_402" style="word-spacing:-0.0651em;">&nbsp;:</span><span class="stl_10 stl_11 stl_402" style="word-spacing:-0.2081em;">&nbsp;2</span><span class="stl_10 stl_11 stl_402" style="word-spacing:-0.2081em;">&nbsp;2</span><span class="stl_10 stl_11 stl_402" style="word-spacing:-0.2081em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:9.6908em;"><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">l r</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;u</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;c</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;l</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;o</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;c</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;k</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.112em;">&nbsp;)</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.387em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.4251em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">引</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;计</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4152em; left:7.98em;"><span class="stl_15 stl_16 stl_403">int</span><span class="stl_15 stl_16 stl_403" style="word-spacing:0.3307em;">&nbsp;</span><span class="stl_10 stl_11 stl_403" style="word-spacing:0.3307em;">refcount</span><span class="stl_10 stl_11 stl_403" style="word-spacing:0.3307em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:7.9408em;"><span class="stl_15 stl_16 stl_291">void</span><span class="stl_15 stl_16 stl_291" style="word-spacing:0.2973em;">&nbsp;</span><span class="stl_10 stl_11 stl_291" style="word-spacing:0.2973em;">*</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.2388em;">&nbsp;ptr</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.2388em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">1</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">42 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:18.4183em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 4.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">REDISOBJECT &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.0086em;"><span class="stl_10 stl_11 stl_404" style="word-spacing:-0.2187em;">robj ; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.1876em; left:7.5658em;"><span class="stl_10 stl_11 stl_405" style="word-spacing:0.0684em;">redis </span><span class="stl_17 stl_18 stl_405" style="word-spacing:0.0684em;">中定义了 </span><span class="stl_10 stl_11 stl_405" style="word-spacing:0.0684em;">struct redisObject</span><span class="stl_17 stl_18 stl_405" style="word-spacing:0.0684em;">，它是一个简单优秀的数据结构，因为在 </span><span class="stl_10 stl_11 stl_405" style="word-spacing:0.0684em;">redis- &nbsp;</span></div>
					<div class="stl_01" style="top: 8.1843em; left:5.9058em;"><span class="stl_10 stl_11 stl_406" style="word-spacing:0.0847em;">Object </span><span class="stl_17 stl_18 stl_406" style="word-spacing:0.0847em;">中数据属性和数据分开来了，其中，数据属性包括数据类型，存储编码方式， &nbsp;</span></div>
					<div class="stl_01" style="top: 9.4023em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">淘汰时钟，引用计数。下面一一展开： &nbsp;</span></div>
					<div class="stl_01" style="top: 11.1727em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">数据类型，标记了 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">对象绑定的是什么类型的数据，有下面几种可能的值； &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6401em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.6401em; left:6.4282em;"><span class="stl_58 stl_59 stl_407" style="word-spacing:0.2898em;">* Object</span><span class="stl_58 stl_59 stl_407" style="word-spacing:0.3648em;">&nbsp;types</span><span class="stl_58 stl_59 stl_407" style="word-spacing:0.3078em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6293em; left:6.4748em;"><span class="stl_15 stl_16 stl_64" style="word-spacing:0.3804em;">define </span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.3804em;">REDIS_STRING 0 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.626em; left:6.4748em;"><span class="stl_15 stl_16 stl_408">define</span><span class="stl_15 stl_16 stl_408" style="word-spacing:0.3785em;">&nbsp;</span><span class="stl_10 stl_11 stl_408" style="word-spacing:0.3785em;">REDIS_LIST</span><span class="stl_10 stl_11 stl_408" style="word-spacing:0.3785em;">&nbsp;1 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6218em; left:6.4748em;"><span class="stl_15 stl_16 stl_409">define</span><span class="stl_15 stl_16 stl_409" style="word-spacing:0.3797em;">&nbsp;</span><span class="stl_10 stl_11 stl_409" style="word-spacing:0.3797em;">REDIS_SET</span><span class="stl_10 stl_11 stl_409" style="word-spacing:0.3797em;">&nbsp;2 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6185em; left:6.4748em;"><span class="stl_15 stl_16 stl_410">define</span><span class="stl_15 stl_16 stl_410" style="word-spacing:0.3863em;">&nbsp;</span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.3863em;">REDIS_ZSET</span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.3863em;">&nbsp;3 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6143em; left:6.4748em;"><span class="stl_15 stl_16 stl_411" style="word-spacing:0.3742em;">define </span><span class="stl_10 stl_11 stl_411" style="word-spacing:0.3742em;">REDIS_HASH 4 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6293em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 15.626em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 16.6218em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 17.6185em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 18.6143em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 20.0885em; left:7.5658em;z-index:313; "><span class="stl_17 stl_18 stl_07">存储编码方式</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_412">，一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.341em;">&nbsp;</span><span class="stl_17 stl_18 stl_07">个数据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_413">，可</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.342em;">&nbsp;</span><span class="stl_17 stl_18 stl_414">以以多种方式存储。譬如</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_413">，数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.342em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0261em;">据类型为 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0261em;">REDIS_SET </span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0261em;">的 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.0843em; left:5.9058em;z-index:355; "><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0289em;">数据编码方式可能为 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0289em;">REDIS_ENCODING_HT</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.2509em;">&nbsp;</span><span class="stl_17 stl_18 stl_415">，也</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.354em;">&nbsp;</span><span class="stl_17 stl_18 stl_416" style="word-spacing:-0.0288em;">可能为 </span><span class="stl_10 stl_11 stl_416" style="word-spacing:-0.0288em;">REDIS_ENCODING_INTSET</span><span class="stl_17 stl_18 stl_416" style="word-spacing:-0.0288em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.5476em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.5401em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 28.5326em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 24.5476em; left:6.4282em;"><span class="stl_58 stl_59 stl_417" style="word-spacing:0.3231em;">* Objects</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.3711em;">&nbsp;encoding</span><span class="stl_58 stl_59 stl_417" style="word-spacing:-0.2079em;">&nbsp;.</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.2941em;">&nbsp;Some</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.2601em;">&nbsp;kind</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.3771em;">&nbsp;of</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.4231em;">&nbsp;o</span><span class="stl_58 stl_59 stl_417" style="word-spacing:-0.3049em;">&nbsp;b</span><span class="stl_58 stl_59 stl_417" style="word-spacing:-0.3039em;">&nbsp;j</span><span class="stl_58 stl_59 stl_417" style="word-spacing:-0.3039em;">&nbsp;e</span><span class="stl_58 stl_59 stl_417" style="word-spacing:-0.3049em;">&nbsp;c</span><span class="stl_58 stl_59 stl_417" style="word-spacing:-0.3039em;">&nbsp;t</span><span class="stl_58 stl_59 stl_417" style="word-spacing:-0.3039em;">&nbsp;s</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.4791em;">&nbsp;l</span><span class="stl_58 stl_59 stl_417" style="word-spacing:-0.2789em;">&nbsp;i</span><span class="stl_58 stl_59 stl_417" style="word-spacing:-0.2789em;">&nbsp;k</span><span class="stl_58 stl_59 stl_417" style="word-spacing:-0.2779em;">&nbsp;e</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.4641em;">&nbsp;Strings</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.3351em;">&nbsp;and &nbsp;</span></div>
					<div class="stl_01" style="top: 25.5435em; left:7.6317em;"><span class="stl_58 stl_59 stl_418" style="word-spacing:0.3467em;">Hashes can be &nbsp;</span></div>
					<div class="stl_01" style="top: 26.5401em; left:7.0409em;"><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.3135em;">i n</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.3145em;">&nbsp;t</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.3135em;">&nbsp;e</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.3135em;">&nbsp;r</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.3135em;">&nbsp;n</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.3135em;">&nbsp;a</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.3135em;">&nbsp;l</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.3145em;">&nbsp;l</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.3135em;">&nbsp;y</span><span class="stl_58 stl_59 stl_419" style="word-spacing:0.4195em;">&nbsp;represented</span><span class="stl_58 stl_59 stl_419" style="word-spacing:0.368em;">&nbsp;in multiple</span><span class="stl_58 stl_59 stl_419" style="word-spacing:0.3315em;">&nbsp;ways</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.2685em;">&nbsp;.</span><span class="stl_58 stl_59 stl_419" style="word-spacing:0.2935em;">&nbsp;The</span><span class="stl_58 stl_59 stl_419" style="word-spacing:0.3425em;">&nbsp;’</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.2765em;">&nbsp;encoding</span><span class="stl_58 stl_59 stl_419" style="word-spacing:-0.2765em;">&nbsp;’ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.536em; left:7.7267em;"><span class="stl_58 stl_59 stl_420" style="word-spacing:-0.3093em;">f i</span><span class="stl_58 stl_59 stl_420" style="word-spacing:-0.3083em;">&nbsp;e</span><span class="stl_58 stl_59 stl_420" style="word-spacing:-0.3073em;">&nbsp;l</span><span class="stl_58 stl_59 stl_420" style="word-spacing:-0.3083em;">&nbsp;d</span><span class="stl_58 stl_59 stl_420" style="word-spacing:0.4187em;">&nbsp;of</span><span class="stl_58 stl_59 stl_420" style="word-spacing:0.3627em;">&nbsp;the o</span><span class="stl_58 stl_59 stl_420" style="word-spacing:-0.3483em;">&nbsp;b</span><span class="stl_58 stl_59 stl_420" style="word-spacing:-0.3483em;">&nbsp;j</span><span class="stl_58 stl_59 stl_420" style="word-spacing:-0.3493em;">&nbsp;e</span><span class="stl_58 stl_59 stl_420" style="word-spacing:-0.3483em;">&nbsp;c</span><span class="stl_58 stl_59 stl_420" style="word-spacing:-0.3483em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 28.5326em; left:7.0351em;"><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.305em;">i s</span><span class="stl_58 stl_59 stl_421" style="word-spacing:0.444em;">&nbsp;se</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.317em;">&nbsp;t</span><span class="stl_58 stl_59 stl_421" style="word-spacing:0.402em;">&nbsp;to</span><span class="stl_58 stl_59 stl_421" style="word-spacing:0.323em;">&nbsp;one of</span><span class="stl_58 stl_59 stl_421" style="word-spacing:0.428em;">&nbsp;t</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.299em;">&nbsp;h</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.298em;">&nbsp;i</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.299em;">&nbsp;s</span><span class="stl_58 stl_59 stl_421" style="word-spacing:0.494em;">&nbsp;f</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.274em;">&nbsp;i</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.274em;">&nbsp;e</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.274em;">&nbsp;l</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.275em;">&nbsp;d</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.274em;">&nbsp;s</span><span class="stl_58 stl_59 stl_421" style="word-spacing:0.4535em;">&nbsp;for t</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.298em;">&nbsp;h</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.299em;">&nbsp;i</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.299em;">&nbsp;s</span><span class="stl_58 stl_59 stl_421" style="word-spacing:0.454em;">&nbsp;o</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.314em;">&nbsp;b</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.314em;">&nbsp;j</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.314em;">&nbsp;e</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.314em;">&nbsp;c</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.315em;">&nbsp;t</span><span class="stl_58 stl_59 stl_421" style="word-spacing:-0.167em;">&nbsp;.</span><span class="stl_58 stl_59 stl_421" style="word-spacing:0.339em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.5218em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 29.5218em; left:6.4748em;"><span class="stl_15 stl_16 stl_422" style="word-spacing:0.4335em;">define </span><span class="stl_10 stl_11 stl_422" style="word-spacing:0.4335em;">REDIS_ENCODING_RAW 0 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.5285em; left:22.3933em;"><span class="stl_58 stl_59 stl_123" style="word-spacing:0.157em;">/* Raw</span><span class="stl_58 stl_59 stl_123" style="word-spacing:0.24em;">&nbsp;representation</span><span class="stl_58 stl_59 stl_123" style="word-spacing:0.326em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.5251em; left:22.3933em;"><span class="stl_58 stl_59 stl_423" style="word-spacing:0.2817em;">/* Encoded</span><span class="stl_58 stl_59 stl_423" style="word-spacing:0.3157em;">&nbsp;as</span><span class="stl_58 stl_59 stl_423" style="word-spacing:0.4017em;">&nbsp;in</span><span class="stl_58 stl_59 stl_423" style="word-spacing:-0.2913em;">&nbsp;teger</span><span class="stl_58 stl_59 stl_423" style="word-spacing:0.3677em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.521em; left:22.3933em;"><span class="stl_58 stl_59 stl_374" style="word-spacing:0.3457em;">/* Encoded as</span><span class="stl_58 stl_59 stl_374" style="word-spacing:0.3907em;">&nbsp;hash</span><span class="stl_58 stl_59 stl_374" style="word-spacing:0.4607em;">&nbsp;t</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.2313em;">&nbsp;a</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.2303em;">&nbsp;b</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.2313em;">&nbsp;l</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.2303em;">&nbsp;e</span><span class="stl_58 stl_59 stl_374" style="word-spacing:0.4287em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.5185em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 30.5185em; left:6.4748em;"><span class="stl_15 stl_16 stl_424" style="word-spacing:0.4142em;">define </span><span class="stl_10 stl_11 stl_424" style="word-spacing:0.4142em;">REDIS_ENCODING_INT 1 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.5143em; left:6.4748em;"><span class="stl_15 stl_16 stl_425" style="word-spacing:0.4196em;">define </span><span class="stl_10 stl_11 stl_425" style="word-spacing:0.4196em;">REDIS_ENCODING_HT 2 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.5143em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 32.511em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 32.511em; left:6.4748em;"><span class="stl_15 stl_16 stl_426">define</span><span class="stl_15 stl_16 stl_426" style="word-spacing:0.3666em;">&nbsp;</span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.3666em;">REDIS_ENCODING_ZIPMAP</span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.3294em;">&nbsp;3</span><span class="stl_10 stl_11 stl_426" style="word-spacing:1.0614em;">&nbsp;</span><span class="stl_58 stl_59 stl_426" style="word-spacing:1.0614em;">/*</span><span class="stl_58 stl_59 stl_426" style="word-spacing:0.4987em;">&nbsp;Encoded as zipmap</span><span class="stl_58 stl_59 stl_426" style="word-spacing:0.4987em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.5068em; left:6.4748em;"><span class="stl_15 stl_16 stl_342">define</span><span class="stl_15 stl_16 stl_342" style="word-spacing:0.3588em;">&nbsp;</span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.3588em;">REDIS_ENCODING_LINKEDLIST</span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.3216em;">&nbsp;4</span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.4423em;">&nbsp;</span><span class="stl_58 stl_59 stl_342" style="word-spacing:0.4423em;">/* Encoded</span><span class="stl_58 stl_59 stl_342" style="word-spacing:0.4836em;">&nbsp;as</span><span class="stl_58 stl_59 stl_342" style="word-spacing:0.5616em;">&nbsp;regular &nbsp;</span></div>
					<div class="stl_01" style="top: 34.5101em; left:7.69em;"><span class="stl_58 stl_59 stl_215" style="word-spacing:0.45em;">linked l</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.298em;">&nbsp;i</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.299em;">&nbsp;s</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.299em;">&nbsp;t</span><span class="stl_58 stl_59 stl_215" style="word-spacing:0.361em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4993em; left:6.4748em;"><span class="stl_15 stl_16 stl_427">define</span><span class="stl_15 stl_16 stl_427" style="word-spacing:0.3672em;">&nbsp;</span><span class="stl_10 stl_11 stl_427" style="word-spacing:0.3672em;">REDIS_ENCODING_ZIPLIST 5</span><span class="stl_10 stl_11 stl_427" style="word-spacing:0.455em;">&nbsp;</span><span class="stl_58 stl_59 stl_427" style="word-spacing:0.455em;">/* Encoded</span><span class="stl_58 stl_59 stl_427" style="word-spacing:0.4961em;">&nbsp;as</span><span class="stl_58 stl_59 stl_427" style="word-spacing:0.6411em;">&nbsp;z</span><span class="stl_58 stl_59 stl_427" style="word-spacing:-0.0529em;">&nbsp;i</span><span class="stl_58 stl_59 stl_427" style="word-spacing:-0.0519em;">&nbsp;p</span><span class="stl_58 stl_59 stl_427" style="word-spacing:-0.0519em;">&nbsp;l</span><span class="stl_58 stl_59 stl_427" style="word-spacing:-0.0529em;">&nbsp;i</span><span class="stl_58 stl_59 stl_427" style="word-spacing:-0.0519em;">&nbsp;s</span><span class="stl_58 stl_59 stl_427" style="word-spacing:-0.0519em;">&nbsp;t</span><span class="stl_58 stl_59 stl_427" style="word-spacing:0.6071em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.496em; left:6.4748em;"><span class="stl_15 stl_16 stl_201">define</span><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3691em;">&nbsp;</span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3691em;">REDIS_ENCODING_INTSET 6</span><span class="stl_10 stl_11 stl_201" style="word-spacing:1.073em;">&nbsp;</span><span class="stl_58 stl_59 stl_201" style="word-spacing:1.073em;">/*</span><span class="stl_58 stl_59 stl_201" style="word-spacing:0.504em;">&nbsp;Encoded as</span><span class="stl_58 stl_59 stl_201" style="word-spacing:0.628em;">&nbsp;i</span><span class="stl_58 stl_59 stl_201" style="word-spacing:-0.064em;">&nbsp;n</span><span class="stl_58 stl_59 stl_201" style="word-spacing:-0.065em;">&nbsp;t</span><span class="stl_58 stl_59 stl_201" style="word-spacing:-0.065em;">&nbsp;s</span><span class="stl_58 stl_59 stl_201" style="word-spacing:-0.065em;">&nbsp;e</span><span class="stl_58 stl_59 stl_201" style="word-spacing:-0.065em;">&nbsp;t</span><span class="stl_58 stl_59 stl_201" style="word-spacing:0.595em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4927em; left:6.4748em;"><span class="stl_15 stl_16 stl_428">define</span><span class="stl_15 stl_16 stl_428" style="word-spacing:0.371em;">&nbsp;</span><span class="stl_10 stl_11 stl_428" style="word-spacing:0.371em;">REDIS_ENCODING_SKIPLIST 7</span><span class="stl_10 stl_11 stl_428" style="word-spacing:1.0542em;">&nbsp;</span><span class="stl_58 stl_59 stl_428" style="word-spacing:1.0542em;">/*</span><span class="stl_58 stl_59 stl_428" style="word-spacing:0.4858em;">&nbsp;Encoded as</span><span class="stl_58 stl_59 stl_428" style="word-spacing:0.6408em;">&nbsp;s</span><span class="stl_58 stl_59 stl_428" style="word-spacing:-0.0532em;">&nbsp;k</span><span class="stl_58 stl_59 stl_428" style="word-spacing:-0.0532em;">&nbsp;i</span><span class="stl_58 stl_59 stl_428" style="word-spacing:-0.0532em;">&nbsp;p</span><span class="stl_58 stl_59 stl_428" style="word-spacing:-0.0532em;">&nbsp;l</span><span class="stl_58 stl_59 stl_428" style="word-spacing:-0.0532em;">&nbsp;i</span><span class="stl_58 stl_59 stl_428" style="word-spacing:-0.0532em;">&nbsp;s</span><span class="stl_58 stl_59 stl_428" style="word-spacing:-0.0532em;">&nbsp;t</span><span class="stl_58 stl_59 stl_428" style="word-spacing:0.6058em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.5068em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 35.4993em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 36.496em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 37.4927em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 38.966em; left:7.5658em;z-index:951; "><span class="stl_17 stl_18 stl_429" style="word-spacing:0.0886em;">淘汰时钟，</span><span class="stl_10 stl_11 stl_429" style="word-spacing:0.0886em;">redis </span><span class="stl_17 stl_18 stl_429" style="word-spacing:0.0886em;">对数据集占用内存的大小有「实时」的计算，当超出限额时，会 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.1848em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">淘汰超时的数据。 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.9552em; left:7.5658em;"><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0836em;">引用计数，一个 </span><span class="stl_10 stl_11 stl_28" style="word-spacing:0.0836em;">redis </span><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0836em;">对象可能被多个指针引用。当需要增加或者减少引用的时 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.1732em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">候，必须调用相应的函数，程序员必须遵守这一准则。 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:6.4282em;"><span class="stl_58 stl_59 stl_430">/</span><span class="stl_58 stl_59 stl_430" style="word-spacing:-0.0671em;">&nbsp;</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.0671em;">增 加</span><span class="stl_17 stl_18 stl_430" style="word-spacing:0.3028em;">&nbsp;</span><span class="stl_58 stl_59 stl_430" style="word-spacing:0.3028em;">redis</span><span class="stl_58 stl_59 stl_430" style="word-spacing:-0.0449em;">&nbsp;</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.0449em;">对 象</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;引</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:5.9483em;"><span class="stl_15 stl_16 stl_364">void</span><span class="stl_15 stl_16 stl_364" style="word-spacing:0.3087em;">&nbsp;</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.3087em;">incrRefCount</span><span class="stl_10 stl_11 stl_364" style="word-spacing:-0.2386em;">&nbsp;(</span><span class="stl_10 stl_11 stl_364" style="word-spacing:-0.2106em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.3344em;">&nbsp;*o</span><span class="stl_10 stl_11 stl_364" style="word-spacing:-0.2906em;">&nbsp;)</span><span class="stl_10 stl_11 stl_364" style="word-spacing:-0.2906em;">&nbsp;{ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 3.3893em; left:36.1993em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.9258em;z-index:4; "><span class="stl_10 stl_11 stl_431">o</span><span class="stl_107 stl_108 stl_431">−</span><span class="stl_10 stl_11 stl_431">&gt;refcount++; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7093em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:6.4282em;"><span class="stl_58 stl_59 stl_394">/</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.0569em;">&nbsp;</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.0569em;">减 少</span><span class="stl_17 stl_18 stl_394" style="word-spacing:0.3129em;">&nbsp;</span><span class="stl_58 stl_59 stl_394" style="word-spacing:0.3129em;">redis</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.0245em;">&nbsp;</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.0245em;">对 象</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;引</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3023em;">&nbsp;用。</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3023em;">&nbsp;特</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;别</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3033em;">&nbsp;的，</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3023em;">&nbsp;引</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;用</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;为</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;零</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;的</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;时</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;候</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;会</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;销</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;毁</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;对</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;象 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:5.9483em;"><span class="stl_15 stl_16 stl_432">void</span><span class="stl_15 stl_16 stl_432" style="word-spacing:0.3111em;">&nbsp;</span><span class="stl_10 stl_11 stl_432" style="word-spacing:0.3111em;">decrRefCount</span><span class="stl_10 stl_11 stl_432" style="word-spacing:-0.2361em;">&nbsp;(</span><span class="stl_10 stl_11 stl_432" style="word-spacing:-0.1951em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_432" style="word-spacing:0.3489em;">&nbsp;*o</span><span class="stl_10 stl_11 stl_432" style="word-spacing:-0.2751em;">&nbsp;)</span><span class="stl_10 stl_11 stl_432" style="word-spacing:-0.2751em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:8.045em;z-index:77; "><span class="stl_15 stl_16 stl_433" style="word-spacing:-0.278em;">i f</span><span class="stl_15 stl_16 stl_433" style="word-spacing:0.4283em;">&nbsp;</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.4283em;">(o</span><span class="stl_107 stl_108 stl_433" style="word-spacing:0.4283em;">−</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.4283em;">&gt;refcount</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.103em;">&nbsp;&lt;=</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.16em;">&nbsp;0)</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.383em;">&nbsp;redisPanic</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.214em;">&nbsp;(</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.285em;">&nbsp;”</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.301em;">&nbsp;decrRefCount␣</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.268em;">&nbsp;against</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.268em;">&nbsp;␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:9.67em;"><span class="stl_10 stl_11 stl_434" style="word-spacing:-0.1932em;">refcount ␣&lt;=␣0” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">如 果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;取</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;消</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;最</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;后</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;引</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;用，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;则</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;释</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;放</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;资</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;源 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:8.045em;z-index:164; "><span class="stl_15 stl_16 stl_435" style="word-spacing:-0.2146em;">i f</span><span class="stl_15 stl_16 stl_435" style="word-spacing:0.4918em;">&nbsp;</span><span class="stl_10 stl_11 stl_435" style="word-spacing:0.4918em;">(o</span><span class="stl_107 stl_108 stl_435" style="word-spacing:0.4918em;">−</span><span class="stl_10 stl_11 stl_435" style="word-spacing:0.4918em;">&gt;refcount</span><span class="stl_10 stl_11 stl_435" style="word-spacing:0.2264em;">&nbsp;==</span><span class="stl_10 stl_11 stl_435" style="word-spacing:0.1934em;">&nbsp;1)</span><span class="stl_10 stl_11 stl_435" style="word-spacing:0.1934em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.4132em;z-index:180; "><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">不 同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;类</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;型，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;销</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;毁</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;操</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;作</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:9.9383em;z-index:202; "><span class="stl_15 stl_16 stl_436">switch</span><span class="stl_15 stl_16 stl_436" style="word-spacing:-0.1743em;">&nbsp;</span><span class="stl_10 stl_11 stl_436" style="word-spacing:-0.1743em;">(o</span><span class="stl_107 stl_108 stl_436" style="word-spacing:-0.1743em;">−</span><span class="stl_10 stl_11 stl_436" style="word-spacing:-0.1743em;">&gt;type</span><span class="stl_10 stl_11 stl_436" style="word-spacing:-0.1348em;">&nbsp;)</span><span class="stl_10 stl_11 stl_436" style="word-spacing:-0.1348em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:9.9483em;"><span class="stl_15 stl_16 stl_437">case</span><span class="stl_15 stl_16 stl_437" style="word-spacing:0.2528em;">&nbsp;</span><span class="stl_10 stl_11 stl_437" style="word-spacing:0.2528em;">REDIS_STRING:</span><span class="stl_10 stl_11 stl_437" style="word-spacing:0.5291em;">&nbsp;freeStringObject</span><span class="stl_10 stl_11 stl_437" style="word-spacing:-0.1269em;">&nbsp;(</span><span class="stl_10 stl_11 stl_437" style="word-spacing:-0.2199em;">&nbsp;o</span><span class="stl_10 stl_11 stl_437" style="word-spacing:-0.2189em;">&nbsp;)</span><span class="stl_10 stl_11 stl_437" style="word-spacing:-0.1089em;">&nbsp;;</span><span class="stl_10 stl_11 stl_437" style="word-spacing:0.4191em;">&nbsp;</span><span class="stl_15 stl_16 stl_437" style="word-spacing:0.4191em;">break</span><span class="stl_15 stl_16 stl_437" style="word-spacing:-0.1803em;">&nbsp;</span><span class="stl_10 stl_11 stl_437" style="word-spacing:0.4191em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.666em; left:9.9483em;"><span class="stl_15 stl_16 stl_438">case</span><span class="stl_15 stl_16 stl_438" style="word-spacing:0.2556em;">&nbsp;</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.2556em;">REDIS_LIST:</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.5048em;">&nbsp;freeListObject</span><span class="stl_10 stl_11 stl_438" style="word-spacing:-0.1512em;">&nbsp;(</span><span class="stl_10 stl_11 stl_438" style="word-spacing:-0.2492em;">&nbsp;o</span><span class="stl_10 stl_11 stl_438" style="word-spacing:-0.2482em;">&nbsp;)</span><span class="stl_10 stl_11 stl_438" style="word-spacing:-0.1382em;">&nbsp;;</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.3888em;">&nbsp;</span><span class="stl_15 stl_16 stl_438" style="word-spacing:0.3888em;">break</span><span class="stl_15 stl_16 stl_438" style="word-spacing:-0.2106em;">&nbsp;</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.3888em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:9.9483em;"><span class="stl_15 stl_16 stl_439">case</span><span class="stl_15 stl_16 stl_439" style="word-spacing:0.2535em;">&nbsp;</span><span class="stl_10 stl_11 stl_439" style="word-spacing:0.2535em;">REDIS_SET:</span><span class="stl_10 stl_11 stl_439" style="word-spacing:0.5218em;">&nbsp;freeSetObject</span><span class="stl_10 stl_11 stl_439" style="word-spacing:-0.1342em;">&nbsp;(</span><span class="stl_10 stl_11 stl_439" style="word-spacing:-0.2212em;">&nbsp;o</span><span class="stl_10 stl_11 stl_439" style="word-spacing:-0.2202em;">&nbsp;)</span><span class="stl_10 stl_11 stl_439" style="word-spacing:-0.1102em;">&nbsp;;</span><span class="stl_10 stl_11 stl_439" style="word-spacing:0.4174em;">&nbsp;</span><span class="stl_15 stl_16 stl_439" style="word-spacing:0.4174em;">break</span><span class="stl_15 stl_16 stl_439" style="word-spacing:-0.1826em;">&nbsp;</span><span class="stl_10 stl_11 stl_439" style="word-spacing:0.4174em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:9.9483em;"><span class="stl_15 stl_16 stl_388">case</span><span class="stl_15 stl_16 stl_388" style="word-spacing:0.2559em;">&nbsp;</span><span class="stl_10 stl_11 stl_388" style="word-spacing:0.2559em;">REDIS_ZSET:</span><span class="stl_10 stl_11 stl_388" style="word-spacing:0.5222em;">&nbsp;freeZsetObject</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.1338em;">&nbsp;(</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.2218em;">&nbsp;o</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.2208em;">&nbsp;)</span><span class="stl_10 stl_11 stl_388" style="word-spacing:-0.1108em;">&nbsp;;</span><span class="stl_10 stl_11 stl_388" style="word-spacing:0.4163em;">&nbsp;</span><span class="stl_15 stl_16 stl_388" style="word-spacing:0.4163em;">break</span><span class="stl_15 stl_16 stl_388" style="word-spacing:-0.1832em;">&nbsp;</span><span class="stl_10 stl_11 stl_388" style="word-spacing:0.4163em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:9.9483em;"><span class="stl_15 stl_16 stl_440">case</span><span class="stl_15 stl_16 stl_440" style="word-spacing:0.269em;">&nbsp;</span><span class="stl_10 stl_11 stl_440" style="word-spacing:0.269em;">REDIS_HASH:</span><span class="stl_10 stl_11 stl_440" style="word-spacing:0.5323em;">&nbsp;freeHashObject</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1227em;">&nbsp;(</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1867em;">&nbsp;o</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1857em;">&nbsp;)</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.0757em;">&nbsp;;</span><span class="stl_10 stl_11 stl_440" style="word-spacing:0.4515em;">&nbsp;</span><span class="stl_15 stl_16 stl_440" style="word-spacing:0.4515em;">break</span><span class="stl_15 stl_16 stl_440" style="word-spacing:-0.1481em;">&nbsp;</span><span class="stl_10 stl_11 stl_440" style="word-spacing:0.4515em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:9.965em;"><span class="stl_15 stl_16 stl_281">default</span><span class="stl_15 stl_16 stl_281" style="word-spacing:-0.174em;">&nbsp;</span><span class="stl_10 stl_11 stl_281" style="word-spacing:-0.174em;">:</span><span class="stl_10 stl_11 stl_281" style="word-spacing:0.4702em;">&nbsp;redisPanic</span><span class="stl_10 stl_11 stl_281" style="word-spacing:-0.1848em;">&nbsp;(</span><span class="stl_10 stl_11 stl_281" style="word-spacing:-0.2558em;">&nbsp;”Unknown␣</span><span class="stl_10 stl_11 stl_281" style="word-spacing:-0.2378em;">&nbsp;object</span><span class="stl_10 stl_11 stl_281" style="word-spacing:-0.2378em;">&nbsp;␣type</span><span class="stl_10 stl_11 stl_281" style="word-spacing:-0.2648em;">&nbsp;”</span><span class="stl_10 stl_11 stl_281" style="word-spacing:-0.2548em;">&nbsp;)</span><span class="stl_10 stl_11 stl_281" style="word-spacing:-0.1588em;">&nbsp;;</span><span class="stl_10 stl_11 stl_281" style="word-spacing:0.3689em;">&nbsp;</span><span class="stl_15 stl_16 stl_281" style="word-spacing:0.3689em;">break</span><span class="stl_15 stl_16 stl_281" style="word-spacing:-0.2302em;">&nbsp;</span><span class="stl_10 stl_11 stl_281" style="word-spacing:0.3689em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.6485em; left:10.025em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0636em;">z f r e e ( o ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6393em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.9183em;z-index:472; "><span class="stl_10 stl_11 stl_135" style="word-spacing:-0.1253em;">o</span><span class="stl_107 stl_108 stl_135" style="word-spacing:-0.1253em;">−</span><span class="stl_10 stl_11 stl_135" style="word-spacing:-0.1253em;">&gt;refcount </span><span class="stl_107 stl_108 stl_135" style="word-spacing:-0.1253em;">−−</span><span class="stl_10 stl_11 stl_135" style="word-spacing:-0.1253em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.94em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 27.6368em; left:7.94em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.6335em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 30.1277em; left:7.5658em;"><span class="stl_17 stl_18 stl_441" style="word-spacing:0.0869em;">得益于 </span><span class="stl_10 stl_11 stl_441" style="word-spacing:0.0869em;">redis </span><span class="stl_17 stl_18 stl_441" style="word-spacing:0.0869em;">是单进程单线程工作的，所以增加</span><span class="stl_10 stl_11 stl_441" style="word-spacing:0.0869em;">/</span><span class="stl_17 stl_18 stl_441" style="word-spacing:0.0869em;">减少引用的操作不必保证原子 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.1243em; left:5.9058em;"><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0853em;">性，这在 </span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.0853em;">memcache </span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0853em;">中是做不到的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.1168em; left:7.5658em;"><span class="stl_10 stl_11 stl_103" style="word-spacing:0.0809em;">struct redisObject </span><span class="stl_17 stl_18 stl_103" style="word-spacing:0.0809em;">把最后一个指针留给了真正的数据。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">44 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:18.4183em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 4.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">REDISOBJECT &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9239em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 5 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6839em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.125em;">数据结构 </span><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">adlist &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6365em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">就是链表 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">5</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">46 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:21.2783em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 5.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0823em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">ADLIST &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 12.1522em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 6 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.1406em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.125em;">数据结构 </span><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">sds &nbsp;</span></div>
					<div class="stl_01" style="top: 24.0985em; left:7.5658em;"><span class="stl_10 stl_11 stl_442">sds</span><span class="stl_10 stl_11 stl_442" style="word-spacing:0.0942em;">&nbsp;</span><span class="stl_17 stl_18 stl_442" style="word-spacing:0.0942em;">被称为是</span><span class="stl_17 stl_18 stl_442" style="word-spacing:0.0946em;">&nbsp;</span><span class="stl_10 stl_11 stl_442" style="word-spacing:0.0946em;">Hacking String.</span><span class="stl_10 stl_11 stl_442" style="word-spacing:0.2449em;">&nbsp;hack</span><span class="stl_10 stl_11 stl_442" style="word-spacing:0.0938em;">&nbsp;</span><span class="stl_17 stl_18 stl_442" style="word-spacing:0.0938em;">的地方就在</span><span class="stl_17 stl_18 stl_442" style="word-spacing:0.0949em;">&nbsp;</span><span class="stl_10 stl_11 stl_442" style="word-spacing:0.0949em;">sds</span><span class="stl_10 stl_11 stl_442" style="word-spacing:0.0942em;">&nbsp;</span><span class="stl_17 stl_18 stl_442" style="word-spacing:0.0942em;">保存了字符串的长度以及剩 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.0952em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">余空间。</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">sds </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">的实现在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">sds.c </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">中。 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.316em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0832em;">sds </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">头部的实现： &nbsp;</span></div>
					<div class="stl_01" style="top: 34.2543em; left:5.98em;"><span class="stl_15 stl_16 stl_290">struct</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.3506em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3506em;">sdshdr</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3506em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.251em; left:7.98em;"><span class="stl_15 stl_16 stl_443">int</span><span class="stl_15 stl_16 stl_443" style="word-spacing:0.3515em;">&nbsp;</span><span class="stl_10 stl_11 stl_443" style="word-spacing:0.3515em;">len</span><span class="stl_10 stl_11 stl_443" style="word-spacing:0.3515em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.2468em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.4151em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4151em;">f</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.285em;">&nbsp;r</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.284em;">&nbsp;e</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.284em;">&nbsp;e</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.284em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.2435em; left:7.9342em;"><span class="stl_15 stl_16 stl_164">char</span><span class="stl_15 stl_16 stl_164" style="word-spacing:0.3613em;">&nbsp;</span><span class="stl_10 stl_11 stl_164" style="word-spacing:0.3613em;">buf</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.041em;">&nbsp;[</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.136em;">&nbsp;]</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.136em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.2443em; left:6.0225em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.2443em; left:6.5539em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:7.5658em;"><span class="stl_17 stl_18 stl_444" style="word-spacing:0.0881em;">倘若使用指针即 </span><span class="stl_10 stl_11 stl_444" style="word-spacing:0.0881em;">char *buf</span><span class="stl_17 stl_18 stl_444" style="word-spacing:0.0881em;">，分配内存需要量两个步骤：一次分配结构体，一次 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:5.9058em;"><span class="stl_17 stl_18 stl_116" style="word-spacing:0.0868em;">分配 </span><span class="stl_10 stl_11 stl_116" style="word-spacing:0.0868em;">char *buf</span><span class="stl_17 stl_18 stl_116" style="word-spacing:0.0868em;">，在是否内存的时候也需要释放两次内存：一次为 </span><span class="stl_10 stl_11 stl_116" style="word-spacing:0.0868em;">char *buf</span><span class="stl_17 stl_18 stl_116" style="word-spacing:0.0868em;">，一次为 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_445" style="word-spacing:0.0815em;">结构体内存。而用长度为 </span><span class="stl_10 stl_11 stl_445" style="word-spacing:0.0815em;">0 </span><span class="stl_17 stl_18 stl_445" style="word-spacing:0.0815em;">的字符数组可以将分配和释放内存的次数都降低为 </span><span class="stl_10 stl_11 stl_445" style="word-spacing:0.0815em;">1 </span><span class="stl_17 stl_18 stl_445" style="word-spacing:0.0815em;">次， &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">从而简化内存的管理。 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">7</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_09.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_09.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">48 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.8575em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 6.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">SDS &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 3.3893em; left:36.1993em;"><span class="stl_10 stl_11 stl_07">9</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.5658em;"><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0853em;">另外，长度为 </span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.0853em;">0 </span><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0853em;">的数组即 </span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.0853em;">char buf[] </span><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0853em;">不占用内存： &nbsp;</span></div>
					<div class="stl_01" style="top: 9.2076em; left:6.4282em;"><span class="stl_58 stl_59 stl_447" style="word-spacing:0.2896em;">/ char</span><span class="stl_58 stl_59 stl_447" style="word-spacing:0.3546em;">&nbsp;buf</span><span class="stl_58 stl_59 stl_447" style="word-spacing:-0.1494em;">&nbsp;[</span><span class="stl_58 stl_59 stl_447" style="word-spacing:-0.2724em;">&nbsp;]</span><span class="stl_58 stl_59 stl_447" style="word-spacing:0.4268em;">&nbsp;</span><span class="stl_17 stl_18 stl_447" style="word-spacing:0.4268em;">的</span><span class="stl_17 stl_18 stl_447" style="word-spacing:-0.2694em;">&nbsp;情</span><span class="stl_17 stl_18 stl_447" style="word-spacing:-0.2694em;">&nbsp;况 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.2076em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.1977em; left:5.98em;"><span class="stl_15 stl_16 stl_290">struct</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.3568em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3568em;">sdshdr s</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3568em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.1935em; left:6.0383em;"><span class="stl_10 stl_11 stl_448" style="word-spacing:-0.1837em;">p r i n t f ( ”%d” , </span><span class="stl_15 stl_16 stl_448" style="word-spacing:-0.1837em;">sizeof </span><span class="stl_10 stl_11 stl_448" style="word-spacing:-0.1837em;">( s ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.1968em; left:6.4282em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:0.453em;">/ 8 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.1968em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.1893em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.1893em; left:6.4282em;"><span class="stl_58 stl_59 stl_447" style="word-spacing:0.2821em;">/ char *</span><span class="stl_58 stl_59 stl_447" style="word-spacing:-0.2994em;">&nbsp;buf</span><span class="stl_58 stl_59 stl_447" style="word-spacing:0.3556em;">&nbsp;</span><span class="stl_17 stl_18 stl_447" style="word-spacing:0.3556em;">的</span><span class="stl_17 stl_18 stl_447" style="word-spacing:-0.2684em;">&nbsp;情</span><span class="stl_17 stl_18 stl_447" style="word-spacing:-0.2684em;">&nbsp;况 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.1785em; left:5.98em;"><span class="stl_15 stl_16 stl_290">struct</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.3568em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3568em;">sdshdr s</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3568em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.1752em; left:6.0383em;"><span class="stl_10 stl_11 stl_448" style="word-spacing:-0.1837em;">p r i n t f ( ”%d” , </span><span class="stl_15 stl_16 stl_448" style="word-spacing:-0.1837em;">sizeof </span><span class="stl_10 stl_11 stl_448" style="word-spacing:-0.1837em;">( s ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.1776em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.1776em; left:6.4282em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:0.348em;">/ 12 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:7.5658em;"><span class="stl_10 stl_11 stl_449" style="word-spacing:0.0887em;">redis </span><span class="stl_17 stl_18 stl_449" style="word-spacing:0.0887em;">中涉及较多的字符串操作，譬如 </span><span class="stl_10 stl_11 stl_449" style="word-spacing:0.0887em;">APPEND </span><span class="stl_17 stl_18 stl_449" style="word-spacing:0.0887em;">命令。相比普通的字符串，</span><span class="stl_10 stl_11 stl_449" style="word-spacing:0.0887em;">sds &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">获取字符串的长度以及剩余空间的复杂度都是 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">O(1)</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">，前者需要 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">O(N). &nbsp;</span></div>
					<div class="stl_01" style="top: 23.1551em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.1551em; left:6.4282em;"><span class="stl_58 stl_59 stl_450">/</span><span class="stl_58 stl_59 stl_450" style="word-spacing:-0.014em;">&nbsp;</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.014em;">返 回</span><span class="stl_17 stl_18 stl_450" style="word-spacing:0.3247em;">&nbsp;</span><span class="stl_58 stl_59 stl_450" style="word-spacing:0.3247em;">sdshdr</span><span class="stl_58 stl_59 stl_450" style="word-spacing:-0.2294em;">&nbsp;.</span><span class="stl_58 stl_59 stl_450" style="word-spacing:-0.2164em;">&nbsp;len &nbsp;</span></div>
					<div class="stl_01" style="top: 24.1452em; left:6.0075em;"><span class="stl_15 stl_16 stl_451">static</span><span class="stl_15 stl_16 stl_451" style="word-spacing:0.4149em;">&nbsp;</span><span class="stl_10 stl_11 stl_451" style="word-spacing:0.4149em;">i</span><span class="stl_10 stl_11 stl_451" style="word-spacing:-0.3088em;">&nbsp;n</span><span class="stl_10 stl_11 stl_451" style="word-spacing:-0.3098em;">&nbsp;l</span><span class="stl_10 stl_11 stl_451" style="word-spacing:-0.3088em;">&nbsp;i</span><span class="stl_10 stl_11 stl_451" style="word-spacing:-0.3088em;">&nbsp;n</span><span class="stl_10 stl_11 stl_451" style="word-spacing:-0.3088em;">&nbsp;e</span><span class="stl_10 stl_11 stl_451" style="word-spacing:0.4037em;">&nbsp;size_t sdslen</span><span class="stl_10 stl_11 stl_451" style="word-spacing:-0.2368em;">&nbsp;(</span><span class="stl_10 stl_11 stl_451" style="word-spacing:-0.3136em;">&nbsp;</span><span class="stl_15 stl_16 stl_451" style="word-spacing:-0.3136em;">const</span><span class="stl_15 stl_16 stl_451" style="word-spacing:0.2947em;">&nbsp;</span><span class="stl_10 stl_11 stl_451" style="word-spacing:0.2947em;">sds</span><span class="stl_10 stl_11 stl_451" style="word-spacing:0.3352em;">&nbsp;s</span><span class="stl_10 stl_11 stl_451" style="word-spacing:-0.2738em;">&nbsp;)</span><span class="stl_10 stl_11 stl_451" style="word-spacing:-0.2738em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.141em; left:7.9725em;"><span class="stl_15 stl_16 stl_452">struct</span><span class="stl_15 stl_16 stl_452" style="word-spacing:0.3502em;">&nbsp;</span><span class="stl_10 stl_11 stl_452" style="word-spacing:0.3502em;">sdshdr</span><span class="stl_10 stl_11 stl_452" style="word-spacing:0.3096em;">&nbsp;*sh</span><span class="stl_10 stl_11 stl_452" style="word-spacing:0.1466em;">&nbsp;=</span><span class="stl_10 stl_11 stl_452" style="word-spacing:0.1696em;">&nbsp;(</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2895em;">&nbsp;</span><span class="stl_15 stl_16 stl_452" style="word-spacing:-0.2895em;">void</span><span class="stl_15 stl_16 stl_452" style="word-spacing:-0.2913em;">&nbsp;</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2913em;">*)</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2384em;">&nbsp;(</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2384em;">&nbsp;s</span><span class="stl_107 stl_108 stl_452" style="word-spacing:-0.2384em;">−</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2384em;">(</span><span class="stl_15 stl_16 stl_452" style="word-spacing:-0.2724em;">sizeof</span><span class="stl_15 stl_16 stl_452" style="word-spacing:-0.2181em;">&nbsp;</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2181em;">(</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2522em;">&nbsp;</span><span class="stl_15 stl_16 stl_452" style="word-spacing:-0.2522em;">struct</span><span class="stl_15 stl_16 stl_452" style="word-spacing:0.3502em;">&nbsp;</span><span class="stl_10 stl_11 stl_452" style="word-spacing:0.3502em;">sdshdr</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2344em;">&nbsp;)</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2364em;">&nbsp;)</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2364em;">&nbsp;)</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2364em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.1377em; left:7.9458em;z-index:319; "><span class="stl_15 stl_16 stl_453">return</span><span class="stl_15 stl_16 stl_453" style="word-spacing:0.377em;">&nbsp;</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.377em;">sh</span><span class="stl_107 stl_108 stl_453" style="word-spacing:0.377em;">−</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.377em;">&gt;len</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.377em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.1385em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.1335em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.1335em; left:6.4282em;"><span class="stl_58 stl_59 stl_454">/</span><span class="stl_58 stl_59 stl_454" style="word-spacing:-0.0176em;">&nbsp;</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.0176em;">返 回</span><span class="stl_17 stl_18 stl_454" style="word-spacing:0.3212em;">&nbsp;</span><span class="stl_58 stl_59 stl_454" style="word-spacing:0.3212em;">sdshdr</span><span class="stl_58 stl_59 stl_454" style="word-spacing:-0.233em;">&nbsp;.</span><span class="stl_58 stl_59 stl_454" style="word-spacing:-0.2em;">&nbsp;fr</span><span class="stl_58 stl_59 stl_454" style="word-spacing:-0.347em;">&nbsp;e</span><span class="stl_58 stl_59 stl_454" style="word-spacing:-0.347em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 30.1227em; left:6.0075em;"><span class="stl_15 stl_16 stl_455">static</span><span class="stl_15 stl_16 stl_455" style="word-spacing:0.4298em;">&nbsp;</span><span class="stl_10 stl_11 stl_455" style="word-spacing:0.4298em;">i</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.2939em;">&nbsp;n</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.2949em;">&nbsp;l</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.2939em;">&nbsp;i</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.2939em;">&nbsp;n</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.2939em;">&nbsp;e</span><span class="stl_10 stl_11 stl_455" style="word-spacing:0.4246em;">&nbsp;size_t s</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.3139em;">&nbsp;d</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.3149em;">&nbsp;s</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.3139em;">&nbsp;a</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.3149em;">&nbsp;v</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.3139em;">&nbsp;a</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.3149em;">&nbsp;i</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.3139em;">&nbsp;l</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.2099em;">&nbsp;(</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.2982em;">&nbsp;</span><span class="stl_15 stl_16 stl_455" style="word-spacing:-0.2982em;">const</span><span class="stl_15 stl_16 stl_455" style="word-spacing:0.3096em;">&nbsp;</span><span class="stl_10 stl_11 stl_455" style="word-spacing:0.3096em;">sds</span><span class="stl_10 stl_11 stl_455" style="word-spacing:0.3501em;">&nbsp;s</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.2579em;">&nbsp;)</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.2579em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.1193em; left:7.9725em;"><span class="stl_15 stl_16 stl_452">struct</span><span class="stl_15 stl_16 stl_452" style="word-spacing:0.3502em;">&nbsp;</span><span class="stl_10 stl_11 stl_452" style="word-spacing:0.3502em;">sdshdr</span><span class="stl_10 stl_11 stl_452" style="word-spacing:0.3096em;">&nbsp;*sh</span><span class="stl_10 stl_11 stl_452" style="word-spacing:0.1466em;">&nbsp;=</span><span class="stl_10 stl_11 stl_452" style="word-spacing:0.1696em;">&nbsp;(</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2895em;">&nbsp;</span><span class="stl_15 stl_16 stl_452" style="word-spacing:-0.2895em;">void</span><span class="stl_15 stl_16 stl_452" style="word-spacing:-0.2913em;">&nbsp;</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2913em;">*)</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2384em;">&nbsp;(</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2384em;">&nbsp;s</span><span class="stl_107 stl_108 stl_452" style="word-spacing:-0.2384em;">−</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2384em;">(</span><span class="stl_15 stl_16 stl_452" style="word-spacing:-0.2724em;">sizeof</span><span class="stl_15 stl_16 stl_452" style="word-spacing:-0.2181em;">&nbsp;</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2181em;">(</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2522em;">&nbsp;</span><span class="stl_15 stl_16 stl_452" style="word-spacing:-0.2522em;">struct</span><span class="stl_15 stl_16 stl_452" style="word-spacing:0.3502em;">&nbsp;</span><span class="stl_10 stl_11 stl_452" style="word-spacing:0.3502em;">sdshdr</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2344em;">&nbsp;)</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2364em;">&nbsp;)</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2364em;">&nbsp;)</span><span class="stl_10 stl_11 stl_452" style="word-spacing:-0.2364em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.1152em; left:7.9458em;z-index:437; "><span class="stl_15 stl_16 stl_456">return</span><span class="stl_15 stl_16 stl_456" style="word-spacing:0.4073em;">&nbsp;</span><span class="stl_10 stl_11 stl_456" style="word-spacing:0.4073em;">sh</span><span class="stl_107 stl_108 stl_456" style="word-spacing:0.4073em;">−</span><span class="stl_10 stl_11 stl_456" style="word-spacing:0.4073em;">&gt;f</span><span class="stl_10 stl_11 stl_456" style="word-spacing:-0.1492em;">&nbsp;r</span><span class="stl_10 stl_11 stl_456" style="word-spacing:-0.1492em;">&nbsp;e</span><span class="stl_10 stl_11 stl_456" style="word-spacing:-0.1502em;">&nbsp;e</span><span class="stl_10 stl_11 stl_456" style="word-spacing:-0.1502em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.1168em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.611em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0831em;">sds.c </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">中还实现了针对 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0831em;">sds </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">的字符串操作函数，譬如分配，追加，释放等。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">50 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.8575em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 6.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">SDS &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9764em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 7 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.7898em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.125em;">数据结构 </span><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">dict &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6474em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">7</span></div>
					<div class="stl_01" style="top: 20.6474em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">.1 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1257em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1257em;">的键值对存储在哪里 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9885em; left:7.5658em;"><span class="stl_17 stl_18 stl_98" style="word-spacing:0.0872em;">在 </span><span class="stl_10 stl_11 stl_98" style="word-spacing:0.0872em;">redis </span><span class="stl_17 stl_18 stl_98" style="word-spacing:0.0872em;">中有多个数据集，数据集采用的数据结构是哈希表，用以存储键值对。 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.9843em; left:5.9058em;"><span class="stl_17 stl_18 stl_22" style="word-spacing:0.0751em;">默认所有的客户端都是使用第一个数据集，如果客户端有需要可以使用 </span><span class="stl_10 stl_11 stl_22" style="word-spacing:0.0751em;">select </span><span class="stl_17 stl_18 stl_22" style="word-spacing:0.0751em;">命令来 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.981em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">选择不同的数据集。</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">在初始化服务器的时候就会初始化所有的数据集： &nbsp;</span></div>
					<div class="stl_01" style="top: 27.5718em; left:5.9483em;"><span class="stl_15 stl_16 stl_66">void</span><span class="stl_15 stl_16 stl_66" style="word-spacing:0.412em;">&nbsp;</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.412em;">i</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2405em;">&nbsp;n</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2395em;">&nbsp;i</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2405em;">&nbsp;t</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2395em;">&nbsp;S</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2405em;">&nbsp;e</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2395em;">&nbsp;r</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2405em;">&nbsp;v</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2405em;">&nbsp;e</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2395em;">&nbsp;r</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0995em;">&nbsp;()</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0995em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.5735em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 28.5735em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 29.571em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.571em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;配</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;集</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.561em; left:8.0175em;"><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.1537em;">server .</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2687em;">&nbsp;db</span><span class="stl_10 stl_11 stl_69" style="word-spacing:0.0823em;">&nbsp;=</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.0705em;">&nbsp;zmalloc (</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2294em;">&nbsp;</span><span class="stl_15 stl_16 stl_69" style="word-spacing:-0.2294em;">sizeof</span><span class="stl_15 stl_16 stl_69" style="word-spacing:-0.2295em;">&nbsp;</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2295em;">(</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2517em;">&nbsp;redisDb</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2517em;">&nbsp;)</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.3027em;">&nbsp;*</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2657em;">&nbsp;server</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.1537em;">&nbsp;.</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.3077em;">&nbsp;dbnum)</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.3077em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.5618em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 32.5601em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.556em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.5618em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 32.5601em; left:8.4207em;"><span class="stl_58 stl_59 stl_76">/</span><span class="stl_58 stl_59 stl_76" style="word-spacing:-0.1352em;">&nbsp;</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.1352em;">初 始</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.347em;">&nbsp;化</span><span class="stl_17 stl_18 stl_76" style="word-spacing:0.3017em;">&nbsp;</span><span class="stl_58 stl_59 stl_76" style="word-spacing:0.3017em;">redis</span><span class="stl_58 stl_59 stl_76" style="word-spacing:-0.0459em;">&nbsp;</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.0459em;">数 据</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.0459em;">&nbsp;集 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.556em; left:8.4207em;"><span class="stl_58 stl_59 stl_77" style="word-spacing:0.2938em;">* Create</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.3545em;">&nbsp;the Redis databases</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.0842em;">&nbsp;,</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.3348em;">&nbsp;and</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.3928em;">&nbsp;i</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;n</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;i</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;t</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2622em;">&nbsp;i</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;a</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;l</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;i</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2612em;">&nbsp;z</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.2622em;">&nbsp;e</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.4668em;">&nbsp;other &nbsp;</span></div>
					<div class="stl_01" style="top: 34.5526em; left:9.6867em;"><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">i n</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">&nbsp;e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">&nbsp;r</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.213em;">&nbsp;n</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">&nbsp;a</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.214em;">&nbsp;l</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.546em;">&nbsp;s</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;a</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.062em;">&nbsp;.</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.438em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.5418em; left:7.9808em;"><span class="stl_15 stl_16 stl_78">for</span><span class="stl_15 stl_16 stl_78" style="word-spacing:0.5905em;">&nbsp;</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.5905em;">(</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.0366em;">&nbsp;j</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.4396em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.6726em;">&nbsp;j</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.4126em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.4696em;">&nbsp;server</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.0896em;">&nbsp;.REDIS_DEFAULT_DBNUM;</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.6926em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.3976em;">&nbsp;{</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.4938em;">&nbsp;</span><span class="stl_58 stl_59 stl_78" style="word-spacing:0.4938em;">//</span><span class="stl_58 stl_59 stl_78" style="word-spacing:0.5444em;">&nbsp;</span><span class="stl_17 stl_18 stl_78" style="word-spacing:0.4938em;">初 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.7657em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">始 化 多 个 数 据 库 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.541em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.541em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">哈 希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;表，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;于</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;储</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;键</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;值</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;对 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.536em; left:10.01em;"><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1212em;">server .</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.2362em;">&nbsp;db</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.2352em;">&nbsp;[</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1182em;">&nbsp;j</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.0652em;">&nbsp;]</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.2112em;">&nbsp;.</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.0652em;">&nbsp;dict</span><span class="stl_10 stl_11 stl_80" style="word-spacing:0.2238em;">&nbsp;= dictCreate(&amp;dbDictType</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1382em;">&nbsp;,NULL)</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1382em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5301em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5301em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">哈 希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;表，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;于</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;储</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;每</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;键</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;过</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;期</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5251em; left:10.01em;"><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.1732em;">server .</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.2882em;">&nbsp;db</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.2872em;">&nbsp;[</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.1702em;">&nbsp;j</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.1172em;">&nbsp;]</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.2632em;">&nbsp;.</span><span class="stl_10 stl_11 stl_81" style="word-spacing:-0.1182em;">&nbsp;expires</span><span class="stl_10 stl_11 stl_81" style="word-spacing:0.1713em;">&nbsp;= dictCreate(&amp;keyptrDictType</span><span class="stl_10 stl_11 stl_81" style="word-spacing:0.1713em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 42.521em; left:11.4933em;"><span class="stl_10 stl_11 stl_82" style="word-spacing:0.1035em;">NULL) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5177em; left:10.12em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 43.5177em; left:10.5791em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5135em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 45.5102em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 45.5102em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 46.506em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">1</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_11.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_11.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">52 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.2825em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 7.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">DICT &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4507em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">7</span></div>
					<div class="stl_01" style="top: 5.4507em; left:6.5789em;"><span class="stl_38 stl_13 stl_07">.2</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">哈希表</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1245em;">&nbsp;</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1245em;">dict &nbsp;</span></div>
					<div class="stl_01" style="top: 24.1698em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">数据集采用的数据结构是哈希表，数据真正存储在哈希表中，用开链法解决冲突 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.9435em; left:5.9058em;"><span class="stl_17 stl_18 stl_457" style="word-spacing:0.0909em;">问题，</span><span class="stl_10 stl_11 stl_457" style="word-spacing:0.0909em;">struct dictht </span><span class="stl_17 stl_18 stl_457" style="word-spacing:0.0909em;">即为一个哈希表。但在 </span><span class="stl_10 stl_11 stl_457" style="word-spacing:0.0909em;">redis </span><span class="stl_17 stl_18 stl_457" style="word-spacing:0.0909em;">哈希表数据结构 </span><span class="stl_10 stl_11 stl_457" style="word-spacing:0.0909em;">struct dict </span><span class="stl_17 stl_18 stl_457" style="word-spacing:0.0909em;">中有两 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.9402em; left:5.9058em;"><span class="stl_17 stl_18 stl_458" style="word-spacing:0.0859em;">个哈希表，下文将两个哈希表分别称为第一个和第二个哈希表，</span><span class="stl_10 stl_11 stl_458" style="word-spacing:0.0859em;">redis </span><span class="stl_17 stl_18 stl_458" style="word-spacing:0.0859em;">提供两个哈希 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.936em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">表是为了能够在不中断服务的情况下扩展（</span><span class="stl_10 stl_11 stl_07">expand</span><span class="stl_17 stl_18 stl_07">）哈希表，很有趣的一部分。 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4776em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.4776em; left:6.4282em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">可 以</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;把</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;它</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;认</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;为</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;链</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;表，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;提</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;示，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;开</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;链</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;法 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4668em; left:5.9533em;"><span class="stl_15 stl_16 stl_459" style="word-spacing:0.3143em;">typedef struct</span><span class="stl_15 stl_16 stl_459" style="word-spacing:0.3748em;">&nbsp;</span><span class="stl_10 stl_11 stl_459" style="word-spacing:0.3748em;">dictEntry</span><span class="stl_10 stl_11 stl_459" style="word-spacing:0.3748em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4635em; left:7.9408em;"><span class="stl_15 stl_16 stl_314">void</span><span class="stl_15 stl_16 stl_314" style="word-spacing:0.3084em;">&nbsp;</span><span class="stl_10 stl_11 stl_314" style="word-spacing:0.3084em;">*key</span><span class="stl_10 stl_11 stl_314" style="word-spacing:0.3084em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4593em; left:7.9242em;"><span class="stl_15 stl_16 stl_460" style="word-spacing:0.3684em;">union </span><span class="stl_10 stl_11 stl_460" style="word-spacing:0.3684em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.456em; left:9.9342em;"><span class="stl_15 stl_16 stl_461">void</span><span class="stl_15 stl_16 stl_461" style="word-spacing:0.2913em;">&nbsp;</span><span class="stl_10 stl_11 stl_461" style="word-spacing:0.2913em;">*</span><span class="stl_10 stl_11 stl_461" style="word-spacing:-0.2378em;">&nbsp;val</span><span class="stl_10 stl_11 stl_461" style="word-spacing:-0.2378em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4577em; left:9.9717em;"><span class="stl_10 stl_11 stl_462" style="word-spacing:0.3294em;">uint64_t u64</span><span class="stl_10 stl_11 stl_462" style="word-spacing:0.3294em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4535em; left:9.9775em;"><span class="stl_10 stl_11 stl_463" style="word-spacing:0.3483em;">int64_t s64</span><span class="stl_10 stl_11 stl_463" style="word-spacing:0.3483em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4502em; left:8.9238em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.053em;">v ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4502em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.441em; left:7.9725em;"><span class="stl_15 stl_16 stl_464">struct</span><span class="stl_15 stl_16 stl_464" style="word-spacing:0.3429em;">&nbsp;</span><span class="stl_10 stl_11 stl_464" style="word-spacing:0.3429em;">dictEntry</span><span class="stl_10 stl_11 stl_464" style="word-spacing:0.3032em;">&nbsp;*next</span><span class="stl_10 stl_11 stl_464" style="word-spacing:0.3032em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4427em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.4427em; left:7.0003em;"><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.2073em;">dictEntry ; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:6.4282em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">要 存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;储</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;多</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;种</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;多</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;样</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;结</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;构，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;势</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;必</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;算</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;法， &nbsp;</span></div>
					<div class="stl_01" style="top: 41.6532em; left:7.6492em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3093em;">不 同 的 键 值 比 较 算 法， 不 同 的 析 构 函 数。 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:5.9533em;"><span class="stl_15 stl_16 stl_466" style="word-spacing:0.3334em;">typedef struct</span><span class="stl_15 stl_16 stl_466" style="word-spacing:0.3739em;">&nbsp;</span><span class="stl_10 stl_11 stl_466" style="word-spacing:0.3739em;">dictType</span><span class="stl_10 stl_11 stl_466" style="word-spacing:0.3739em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.4251em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4152em; left:7.9325em;"><span class="stl_15 stl_16 stl_467" style="word-spacing:0.3394em;">unsigned int</span><span class="stl_15 stl_16 stl_467" style="word-spacing:0.4025em;">&nbsp;</span><span class="stl_10 stl_11 stl_467" style="word-spacing:0.4025em;">(*</span><span class="stl_10 stl_11 stl_467" style="word-spacing:-0.1996em;">&nbsp;hashFunction</span><span class="stl_10 stl_11 stl_467" style="word-spacing:-0.1986em;">&nbsp;)</span><span class="stl_10 stl_11 stl_467" style="word-spacing:-0.1896em;">&nbsp;(</span><span class="stl_10 stl_11 stl_467" style="word-spacing:-0.2322em;">&nbsp;</span><span class="stl_15 stl_16 stl_467" style="word-spacing:-0.2322em;">const</span><span class="stl_15 stl_16 stl_467" style="word-spacing:0.3134em;">&nbsp;void</span><span class="stl_15 stl_16 stl_467" style="word-spacing:0.3018em;">&nbsp;</span><span class="stl_10 stl_11 stl_467" style="word-spacing:0.3018em;">*key</span><span class="stl_10 stl_11 stl_467" style="word-spacing:-0.2206em;">&nbsp;)</span><span class="stl_10 stl_11 stl_467" style="word-spacing:-0.2206em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4077em; left:7.9408em;"><span class="stl_15 stl_16 stl_468">void</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.3554em;">&nbsp;</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.3554em;">*(*keyDup)</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.1889em;">&nbsp;(</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2417em;">&nbsp;</span><span class="stl_15 stl_16 stl_468" style="word-spacing:-0.2417em;">void</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.3032em;">&nbsp;</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.3032em;">*</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2409em;">&nbsp;privdata</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.0189em;">&nbsp;,</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.4235em;">&nbsp;</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.4235em;">const</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.3141em;">&nbsp;void</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.3024em;">&nbsp;</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.3024em;">*key</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2199em;">&nbsp;)</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2199em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:7.9408em;"><span class="stl_15 stl_16 stl_469">void</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.3529em;">&nbsp;</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3529em;">*(*</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.2404em;">&nbsp;valDup</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.2374em;">&nbsp;)</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.1914em;">&nbsp;(</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.2442em;">&nbsp;</span><span class="stl_15 stl_16 stl_469" style="word-spacing:-0.2442em;">void</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.3007em;">&nbsp;</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3007em;">*</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.2434em;">&nbsp;privdata</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.0214em;">&nbsp;,</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.421em;">&nbsp;</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.421em;">const</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.3116em;">&nbsp;void</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.3em;">&nbsp;</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3em;">*</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.2434em;">&nbsp;obj</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.1874em;">&nbsp;)</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.1874em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07">7.2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">哈希表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0823em;">DICT &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">53 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">比</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;较</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:7.98em;"><span class="stl_15 stl_16 stl_333">int</span><span class="stl_15 stl_16 stl_333" style="word-spacing:0.4098em;">&nbsp;</span><span class="stl_10 stl_11 stl_333" style="word-spacing:0.4098em;">(*</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.2391em;">&nbsp;keyCompare</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.2381em;">&nbsp;)</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.1821em;">&nbsp;(</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.2352em;">&nbsp;</span><span class="stl_15 stl_16 stl_333" style="word-spacing:-0.2352em;">void</span><span class="stl_15 stl_16 stl_333" style="word-spacing:0.309em;">&nbsp;</span><span class="stl_10 stl_11 stl_333" style="word-spacing:0.309em;">*</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.2331em;">&nbsp;privdata</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.0111em;">&nbsp;,</span><span class="stl_10 stl_11 stl_333" style="word-spacing:0.4303em;">&nbsp;</span><span class="stl_15 stl_16 stl_333" style="word-spacing:0.4303em;">const</span><span class="stl_15 stl_16 stl_333" style="word-spacing:0.3209em;">&nbsp;void</span><span class="stl_15 stl_16 stl_333" style="word-spacing:0.3092em;">&nbsp;</span><span class="stl_10 stl_11 stl_333" style="word-spacing:0.3092em;">*key1</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.0991em;">&nbsp;,</span><span class="stl_10 stl_11 stl_333" style="word-spacing:0.4315em;">&nbsp;</span><span class="stl_15 stl_16 stl_333" style="word-spacing:0.4315em;">const &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:10.1em;"><span class="stl_15 stl_16 stl_470">void</span><span class="stl_15 stl_16 stl_470" style="word-spacing:0.3034em;">&nbsp;</span><span class="stl_10 stl_11 stl_470" style="word-spacing:0.3034em;">*key2</span><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.2137em;">&nbsp;)</span><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.2137em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">键</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;值</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;析</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:7.9408em;"><span class="stl_15 stl_16 stl_471">void</span><span class="stl_15 stl_16 stl_471" style="word-spacing:0.3177em;">&nbsp;</span><span class="stl_10 stl_11 stl_471" style="word-spacing:0.3177em;">(*</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2186em;">&nbsp;keyDestructor</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2166em;">&nbsp;)</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2276em;">&nbsp;(</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2811em;">&nbsp;</span><span class="stl_15 stl_16 stl_471" style="word-spacing:-0.2811em;">void</span><span class="stl_15 stl_16 stl_471" style="word-spacing:-0.0152em;">&nbsp;</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.0152em;">* privdata</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.0566em;">&nbsp;,</span><span class="stl_10 stl_11 stl_471" style="word-spacing:0.3748em;">&nbsp;</span><span class="stl_15 stl_16 stl_471" style="word-spacing:0.3748em;">void</span><span class="stl_15 stl_16 stl_471" style="word-spacing:0.2635em;">&nbsp;</span><span class="stl_10 stl_11 stl_471" style="word-spacing:0.2635em;">*key</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2586em;">&nbsp;)</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2586em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:7.9408em;"><span class="stl_15 stl_16 stl_472">void</span><span class="stl_15 stl_16 stl_472" style="word-spacing:0.3045em;">&nbsp;</span><span class="stl_10 stl_11 stl_472" style="word-spacing:0.3045em;">(*</span><span class="stl_10 stl_11 stl_472" style="word-spacing:-0.2178em;">&nbsp;valDestructor</span><span class="stl_10 stl_11 stl_472" style="word-spacing:-0.2158em;">&nbsp;)</span><span class="stl_10 stl_11 stl_472" style="word-spacing:-0.2408em;">&nbsp;(</span><span class="stl_10 stl_11 stl_472" style="word-spacing:-0.2943em;">&nbsp;</span><span class="stl_15 stl_16 stl_472" style="word-spacing:-0.2943em;">void</span><span class="stl_15 stl_16 stl_472" style="word-spacing:-0.0415em;">&nbsp;</span><span class="stl_10 stl_11 stl_472" style="word-spacing:-0.0415em;">* privdata</span><span class="stl_10 stl_11 stl_472" style="word-spacing:-0.0698em;">&nbsp;,</span><span class="stl_10 stl_11 stl_472" style="word-spacing:0.3616em;">&nbsp;</span><span class="stl_15 stl_16 stl_472" style="word-spacing:0.3616em;">void</span><span class="stl_15 stl_16 stl_472" style="word-spacing:-0.0425em;">&nbsp;</span><span class="stl_10 stl_11 stl_472" style="word-spacing:-0.0425em;">* obj</span><span class="stl_10 stl_11 stl_472" style="word-spacing:-0.2368em;">&nbsp;)</span><span class="stl_10 stl_11 stl_472" style="word-spacing:-0.2368em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:6.9828em;"><span class="stl_10 stl_11 stl_473" style="word-spacing:-0.1873em;">dictType ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6835em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;般</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;构 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:6.4282em;"><span class="stl_58 stl_59 stl_474" style="word-spacing:0.2657em;">* This</span><span class="stl_58 stl_59 stl_474" style="word-spacing:0.3677em;">&nbsp;i</span><span class="stl_58 stl_59 stl_474" style="word-spacing:-0.3223em;">&nbsp;s</span><span class="stl_58 stl_59 stl_474" style="word-spacing:0.3587em;">&nbsp;our</span><span class="stl_58 stl_59 stl_474" style="word-spacing:0.2907em;">&nbsp;hash</span><span class="stl_58 stl_59 stl_474" style="word-spacing:0.3717em;">&nbsp;t</span><span class="stl_58 stl_59 stl_474" style="word-spacing:-0.3213em;">&nbsp;a</span><span class="stl_58 stl_59 stl_474" style="word-spacing:-0.3203em;">&nbsp;b</span><span class="stl_58 stl_59 stl_474" style="word-spacing:-0.3213em;">&nbsp;l</span><span class="stl_58 stl_59 stl_474" style="word-spacing:-0.3203em;">&nbsp;e</span><span class="stl_58 stl_59 stl_474" style="word-spacing:0.4277em;">&nbsp;structure</span><span class="stl_58 stl_59 stl_474" style="word-spacing:-0.1883em;">&nbsp;.</span><span class="stl_58 stl_59 stl_474" style="word-spacing:0.3467em;">&nbsp;Every dictionary has</span><span class="stl_58 stl_59 stl_474" style="word-spacing:0.2817em;">&nbsp;two &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.17em;"><span class="stl_58 stl_59 stl_466" style="word-spacing:0.4803em;">of t</span><span class="stl_58 stl_59 stl_466" style="word-spacing:-0.2467em;">&nbsp;h</span><span class="stl_58 stl_59 stl_466" style="word-spacing:-0.2457em;">&nbsp;i</span><span class="stl_58 stl_59 stl_466" style="word-spacing:-0.2467em;">&nbsp;s</span><span class="stl_58 stl_59 stl_466" style="word-spacing:0.4463em;">&nbsp;as</span><span class="stl_58 stl_59 stl_466" style="word-spacing:0.3033em;">&nbsp;we &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:6.9745em;"><span class="stl_58 stl_59 stl_263" style="word-spacing:0.3543em;">implement incremental rehashing</span><span class="stl_58 stl_59 stl_263" style="word-spacing:-0.0937em;">&nbsp;,</span><span class="stl_58 stl_59 stl_263" style="word-spacing:0.3921em;">&nbsp;for the old to the</span><span class="stl_58 stl_59 stl_263" style="word-spacing:0.2853em;">&nbsp;new &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.7017em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">t a</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.206em;">&nbsp;b</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">&nbsp;l</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.206em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.06em;">&nbsp;.</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.435em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 20.6585em; left:5.9533em;"><span class="stl_15 stl_16 stl_475" style="word-spacing:0.3105em;">typedef struct</span><span class="stl_15 stl_16 stl_475" style="word-spacing:0.3941em;">&nbsp;</span><span class="stl_10 stl_11 stl_475" style="word-spacing:0.3941em;">dictht</span><span class="stl_10 stl_11 stl_475" style="word-spacing:0.3941em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">两</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:7.9967em;"><span class="stl_10 stl_11 stl_401" style="word-spacing:0.2933em;">dictEntry **</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.2857em;">&nbsp;table</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.2857em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6393em; left:7.9325em;"><span class="stl_15 stl_16 stl_476" style="word-spacing:0.3566em;">unsigned long</span><span class="stl_15 stl_16 stl_476" style="word-spacing:0.4841em;">&nbsp;</span><span class="stl_10 stl_11 stl_476" style="word-spacing:0.4841em;">s</span><span class="stl_10 stl_11 stl_476" style="word-spacing:-0.1754em;">&nbsp;i</span><span class="stl_10 stl_11 stl_476" style="word-spacing:-0.1744em;">&nbsp;z</span><span class="stl_10 stl_11 stl_476" style="word-spacing:-0.1744em;">&nbsp;e</span><span class="stl_10 stl_11 stl_476" style="word-spacing:-0.1744em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;掩</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;码 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6285em; left:7.9325em;"><span class="stl_15 stl_16 stl_374" style="word-spacing:0.3045em;">unsigned long</span><span class="stl_15 stl_16 stl_374" style="word-spacing:0.3729em;">&nbsp;</span><span class="stl_10 stl_11 stl_374" style="word-spacing:0.3729em;">sizemask</span><span class="stl_10 stl_11 stl_374" style="word-spacing:0.3729em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.6276em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;项</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;量 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6168em; left:7.9325em;"><span class="stl_15 stl_16 stl_477" style="word-spacing:0.3364em;">unsigned long</span><span class="stl_15 stl_16 stl_477" style="word-spacing:0.3856em;">&nbsp;</span><span class="stl_10 stl_11 stl_477" style="word-spacing:0.3856em;">used</span><span class="stl_10 stl_11 stl_477" style="word-spacing:0.3856em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:7.0185em;"><span class="stl_10 stl_11 stl_60" style="word-spacing:-0.2304em;">dictht ; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.6126em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:6.4282em;"><span class="stl_58 stl_59 stl_478">/</span><span class="stl_58 stl_59 stl_478" style="word-spacing:-0.1057em;">&nbsp;</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.1057em;">哈 希</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;表</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.2993em;">&nbsp;（字</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.2662em;">&nbsp;典）</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.2993em;">&nbsp;数</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;据</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;结</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.2982em;">&nbsp;构，</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.2508em;">&nbsp;</span><span class="stl_58 stl_59 stl_478" style="word-spacing:-0.2508em;">redis</span><span class="stl_58 stl_59 stl_478" style="word-spacing:-0.0164em;">&nbsp;</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.0164em;">的 所</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;有</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;键</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;值</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;对</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;都</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;会</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;存</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;储</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;在</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.3323em;">&nbsp;这</span><span class="stl_17 stl_18 stl_478" style="word-spacing:-0.2992em;">&nbsp;里。 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.829em; left:7.6492em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3119em;">其 中 包 含 两 个 哈 希 表。 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:5.9533em;"><span class="stl_15 stl_16 stl_80" style="word-spacing:0.3217em;">typedef struct</span><span class="stl_15 stl_16 stl_80" style="word-spacing:0.4103em;">&nbsp;</span><span class="stl_10 stl_11 stl_80" style="word-spacing:0.4103em;">dict</span><span class="stl_10 stl_11 stl_80" style="word-spacing:0.4103em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">哈 希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;表</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;类</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;型，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;包</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;括</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;函</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;比</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;较</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;函</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;键</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;值</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;内</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;释</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;放</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;函 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.8182em; left:9.6417em;"><span class="stl_17 stl_18 stl_07">数</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.9792em;"><span class="stl_10 stl_11 stl_140" style="word-spacing:0.2938em;">dictType *type</span><span class="stl_10 stl_11 stl_140" style="word-spacing:0.2938em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;储</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;些</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;额</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;外</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:7.9408em;"><span class="stl_15 stl_16 stl_479">void</span><span class="stl_15 stl_16 stl_479" style="word-spacing:-0.0311em;">&nbsp;</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.0311em;">* privdata</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.0311em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">两</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:8.015em;"><span class="stl_10 stl_11 stl_100" style="word-spacing:0.3123em;">dictht ht</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.2157em;">&nbsp;[</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3007em;">&nbsp;2</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3007em;">&nbsp;]</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3007em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">54 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.2825em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 7.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">DICT &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">哈 希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;表</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;重</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;置</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;下</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;标，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;指</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;定</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;组</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;组</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;下</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;标 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:7.98em;"><span class="stl_15 stl_16 stl_219">int</span><span class="stl_15 stl_16 stl_219" style="word-spacing:0.3266em;">&nbsp;</span><span class="stl_10 stl_11 stl_219" style="word-spacing:0.3266em;">rehashidx</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.2114em;">&nbsp;;</span><span class="stl_10 stl_11 stl_219" style="word-spacing:0.3278em;">&nbsp;</span><span class="stl_58 stl_59 stl_219" style="word-spacing:0.3278em;">/*</span><span class="stl_58 stl_59 stl_219" style="word-spacing:0.2916em;">&nbsp;rehashing</span><span class="stl_58 stl_59 stl_219" style="word-spacing:0.3236em;">&nbsp;not in</span><span class="stl_58 stl_59 stl_219" style="word-spacing:0.3506em;">&nbsp;progress</span><span class="stl_58 stl_59 stl_219" style="word-spacing:0.4356em;">&nbsp;i</span><span class="stl_58 stl_59 stl_219" style="word-spacing:-0.2974em;">&nbsp;f</span><span class="stl_58 stl_59 stl_219" style="word-spacing:0.4326em;">&nbsp;rehashidx &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.0105em;"><span class="stl_58 stl_59 stl_480">=</span><span class="stl_58 stl_59 stl_480" style="word-spacing:0.1561em;">&nbsp;</span><span class="stl_107 stl_108 stl_480">−</span><span class="stl_58 stl_59 stl_480" style="word-spacing:0.1561em;">1</span><span class="stl_58 stl_59 stl_480" style="word-spacing:0.3492em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.4658em;"><span class="stl_58 stl_59 stl_07">=</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">绑</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;定</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;迭</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;代</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;器</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:7.98em;"><span class="stl_15 stl_16 stl_481">int</span><span class="stl_15 stl_16 stl_481" style="word-spacing:0.4135em;">&nbsp;</span><span class="stl_10 stl_11 stl_481" style="word-spacing:0.4135em;">i</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2857em;">&nbsp;t</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2857em;">&nbsp;e</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2857em;">&nbsp;r</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2847em;">&nbsp;a</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2857em;">&nbsp;t</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2857em;">&nbsp;o</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2857em;">&nbsp;r</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2857em;">&nbsp;s</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.1237em;">&nbsp;;</span><span class="stl_10 stl_11 stl_481" style="word-spacing:0.3623em;">&nbsp;</span><span class="stl_58 stl_59 stl_481" style="word-spacing:0.3623em;">/*</span><span class="stl_58 stl_59 stl_481" style="word-spacing:0.2503em;">&nbsp;number</span><span class="stl_58 stl_59 stl_481" style="word-spacing:0.3183em;">&nbsp;of</span><span class="stl_58 stl_59 stl_481" style="word-spacing:0.4393em;">&nbsp;i</span><span class="stl_58 stl_59 stl_481" style="word-spacing:-0.2887em;">&nbsp;t</span><span class="stl_58 stl_59 stl_481" style="word-spacing:-0.2877em;">&nbsp;e</span><span class="stl_58 stl_59 stl_481" style="word-spacing:-0.2887em;">&nbsp;r</span><span class="stl_58 stl_59 stl_481" style="word-spacing:-0.2877em;">&nbsp;a</span><span class="stl_58 stl_59 stl_481" style="word-spacing:-0.2887em;">&nbsp;t</span><span class="stl_58 stl_59 stl_481" style="word-spacing:-0.2887em;">&nbsp;o</span><span class="stl_58 stl_59 stl_481" style="word-spacing:-0.2877em;">&nbsp;r</span><span class="stl_58 stl_59 stl_481" style="word-spacing:-0.2887em;">&nbsp;s</span><span class="stl_58 stl_59 stl_481" style="word-spacing:0.4583em;">&nbsp;currently</span><span class="stl_58 stl_59 stl_481" style="word-spacing:0.3873em;">&nbsp;running &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:9.6075em;"><span class="stl_58 stl_59 stl_71">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.0235em;"><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.2347em;">dict ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.3549em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">7</span></div>
					<div class="stl_01" style="top: 15.3549em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.3 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">扩展哈希表 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.5976em; left:7.5658em;"><span class="stl_10 stl_11 stl_115" style="word-spacing:0.0841em;">redis </span><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0841em;">为每个数据集配备两个哈希表，能在不中断服务的情况下扩展哈希表。平 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.8157em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">时哈希表扩展的做法是，为新的哈希表另外开辟一个空间，将原哈希表的数据重新计 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.8123em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">算哈希值，以移动到新哈希表。如果原哈希表数据过多，中间大量的计算过程较好费 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.8082em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">大量时间。 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.5826em; left:5.9058em;"><span class="stl_10 stl_11 stl_483" style="word-spacing:0.0837em;">redis </span><span class="stl_17 stl_18 stl_483" style="word-spacing:0.0837em;">扩展哈希表的做法有点小聪明：为第二个哈希表分配新空间，其空间大小为原 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.8007em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">哈希表键值对数量的两倍（是的，没错），接着逐步将第一个哈希表中的数据移动到 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.7973em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">第二个哈希表；待移动完毕后，将第二个哈希值赋值给第一个哈希表，第二个哈希表 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.5718em; left:5.9058em;"><span class="stl_17 stl_18 stl_484" style="word-spacing:0.0843em;">置空。在这个过程中，数据会分布在两个哈希表，这时候就要求在 </span><span class="stl_10 stl_11 stl_484" style="word-spacing:0.0843em;">CURD </span><span class="stl_17 stl_18 stl_484" style="word-spacing:0.0843em;">时，都要 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.7898em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">考虑两个哈希表。 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.5643em; left:5.9058em;z-index:493; "><span class="stl_17 stl_18 stl_202">而这里，将第一个哈希表中的数据移动到第二个哈希表被称为重置哈希（</span><span class="stl_10 stl_11 stl_202">rehash</span><span class="stl_17 stl_18 stl_202">）。 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.8391em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">7</span></div>
					<div class="stl_01" style="top: 28.8391em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.4 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">重置哈希表 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.0818em; left:7.5658em;"><span class="stl_17 stl_18 stl_485" style="word-spacing:0.0423em;">在 </span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.0423em;">CURD </span><span class="stl_17 stl_18 stl_485" style="word-spacing:0.0423em;">的时候会执行一步的重置哈希表操作，在服务器定时程序 </span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.0423em;">serverCorn() &nbsp;</span></div>
					<div class="stl_01" style="top: 32.0785em; left:5.9058em;"><span class="stl_17 stl_18 stl_43" style="word-spacing:0.0678em;">中会执行一定时间的重置哈希表操作。为什么在定时程序中重置哈希表了，还 </span><span class="stl_10 stl_11 stl_43" style="word-spacing:0.0678em;">CURD &nbsp;</span></div>
					<div class="stl_01" style="top: 33.0743em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0838em;">的时候还要呢？或者反过来问。一个可能的原因是 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0838em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0838em;">做了两手准备：在服务器空 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.2932em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">闲的时候，定时程序会完成重置哈希表；在服务器过载的时候，更多重置哈希表操作 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.0668em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">会落在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">CURD </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">的服务上。 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.2857em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">下面是重置哈希表的函数，其主要任务就是选择哈希表中的一个位置上的单链表，重 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.2815em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">新计算哈希值，放到第二个哈希表。 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4335em; left:5.9875em;"><span class="stl_15 stl_16 stl_487">int</span><span class="stl_15 stl_16 stl_487" style="word-spacing:0.3357em;">&nbsp;</span><span class="stl_10 stl_11 stl_487" style="word-spacing:0.3357em;">dictRehash</span><span class="stl_10 stl_11 stl_487" style="word-spacing:-0.2592em;">&nbsp;(</span><span class="stl_10 stl_11 stl_487" style="word-spacing:-0.2162em;">&nbsp;dict</span><span class="stl_10 stl_11 stl_487" style="word-spacing:0.3288em;">&nbsp;*d</span><span class="stl_10 stl_11 stl_487" style="word-spacing:-0.2782em;">&nbsp;,</span><span class="stl_10 stl_11 stl_487" style="word-spacing:0.3912em;">&nbsp;</span><span class="stl_15 stl_16 stl_487" style="word-spacing:0.3912em;">int</span><span class="stl_15 stl_16 stl_487" style="word-spacing:0.2534em;">&nbsp;</span><span class="stl_10 stl_11 stl_487" style="word-spacing:0.2534em;">n)</span><span class="stl_10 stl_11 stl_487" style="word-spacing:0.2534em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">重 置</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;表</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;结</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;束，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;直</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;返</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;回 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:8.045em;"><span class="stl_15 stl_16 stl_488" style="word-spacing:-0.2995em;">i f</span><span class="stl_15 stl_16 stl_488" style="word-spacing:0.4791em;">&nbsp;</span><span class="stl_10 stl_11 stl_488" style="word-spacing:0.4791em;">(</span><span class="stl_10 stl_11 stl_488" style="word-spacing:-0.2985em;">&nbsp;!</span><span class="stl_10 stl_11 stl_488" style="word-spacing:-0.1695em;">&nbsp;dictIsRehashing</span><span class="stl_10 stl_11 stl_488" style="word-spacing:-0.2415em;">&nbsp;(d)</span><span class="stl_10 stl_11 stl_488" style="word-spacing:-0.2645em;">&nbsp;)</span><span class="stl_10 stl_11 stl_488" style="word-spacing:0.2878em;">&nbsp;</span><span class="stl_15 stl_16 stl_488" style="word-spacing:0.2878em;">return</span><span class="stl_15 stl_16 stl_488" style="word-spacing:0.3223em;">&nbsp;</span><span class="stl_10 stl_11 stl_488" style="word-spacing:0.3223em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4185em; left:7.9483em;z-index:803; "><span class="stl_15 stl_16 stl_489">while</span><span class="stl_15 stl_16 stl_489" style="word-spacing:-0.1523em;">&nbsp;</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1523em;">(n</span><span class="stl_107 stl_108 stl_489" style="word-spacing:-0.1523em;">−−</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1523em;">)</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1523em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:9.9892em;"><span class="stl_10 stl_11 stl_455" style="word-spacing:0.3023em;">dictEntry *de</span><span class="stl_10 stl_11 stl_455" style="word-spacing:-0.2058em;">&nbsp;,</span><span class="stl_10 stl_11 stl_455" style="word-spacing:0.3442em;">&nbsp;*nextde</span><span class="stl_10 stl_11 stl_455" style="word-spacing:0.3442em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">第 一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;表</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;为</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;空，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;证</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;明</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;重</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;置</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;表</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;已</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;经</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;完</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;成，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;将</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;第</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;二</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:11.6342em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3119em;">哈 希 表 赋 值 给 第 一 个， &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">7.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">重置哈希表 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">55 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;束 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:10.4132em;"><span class="stl_58 stl_59 stl_490" style="word-spacing:0.2703em;">* Check</span><span class="stl_58 stl_59 stl_490" style="word-spacing:0.4053em;">&nbsp;i</span><span class="stl_58 stl_59 stl_490" style="word-spacing:-0.2587em;">&nbsp;f</span><span class="stl_58 stl_59 stl_490" style="word-spacing:0.3653em;">&nbsp;we</span><span class="stl_58 stl_59 stl_490" style="word-spacing:0.3003em;">&nbsp;already</span><span class="stl_58 stl_59 stl_490" style="word-spacing:0.3793em;">&nbsp;rehashed the whole</span><span class="stl_58 stl_59 stl_490" style="word-spacing:0.4083em;">&nbsp;t</span><span class="stl_58 stl_59 stl_490" style="word-spacing:-0.2917em;">&nbsp;a</span><span class="stl_58 stl_59 stl_490" style="word-spacing:-0.2907em;">&nbsp;b</span><span class="stl_58 stl_59 stl_490" style="word-spacing:-0.2917em;">&nbsp;l</span><span class="stl_58 stl_59 stl_490" style="word-spacing:-0.2907em;">&nbsp;e</span><span class="stl_58 stl_59 stl_490" style="word-spacing:-0.0717em;">&nbsp;.</span><span class="stl_58 stl_59 stl_490" style="word-spacing:-0.2347em;">&nbsp;.</span><span class="stl_58 stl_59 stl_490" style="word-spacing:-0.2347em;">&nbsp;.</span><span class="stl_58 stl_59 stl_490" style="word-spacing:0.4243em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:10.0375em;z-index:64; "><span class="stl_15 stl_16 stl_491" style="word-spacing:-0.118em;">i f</span><span class="stl_15 stl_16 stl_491" style="word-spacing:0.5884em;">&nbsp;</span><span class="stl_10 stl_11 stl_491" style="word-spacing:0.5884em;">(d</span><span class="stl_107 stl_108 stl_491" style="word-spacing:0.5884em;">−</span><span class="stl_10 stl_11 stl_491" style="word-spacing:0.5884em;">&gt;ht</span><span class="stl_10 stl_11 stl_491" style="word-spacing:-0.076em;">&nbsp;[ 0</span><span class="stl_10 stl_11 stl_491" style="word-spacing:-0.081em;">&nbsp;]</span><span class="stl_10 stl_11 stl_491" style="word-spacing:-0.081em;">&nbsp;.</span><span class="stl_10 stl_11 stl_491" style="word-spacing:0.009em;">&nbsp;used</span><span class="stl_10 stl_11 stl_491" style="word-spacing:0.284em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_491" style="word-spacing:0.284em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:12.0175em;z-index:88; "><span class="stl_10 stl_11 stl_492" style="word-spacing:-0.1394em;">z f r e e (d</span><span class="stl_107 stl_108 stl_492" style="word-spacing:-0.1394em;">−</span><span class="stl_10 stl_11 stl_492" style="word-spacing:-0.1394em;">&gt;ht [ 0 ] . table ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:11.895em;z-index:113; "><span class="stl_10 stl_11 stl_206" style="word-spacing:0.0989em;">d</span><span class="stl_107 stl_108 stl_206" style="word-spacing:0.0989em;">−</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.0989em;">&gt;ht [</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.0139em;">&nbsp;0 ]</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.5249em;">&nbsp;=</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.5249em;">&nbsp;d</span><span class="stl_107 stl_108 stl_206" style="word-spacing:0.5249em;">−</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.3539em;">&gt;ht</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.1259em;">&nbsp;[</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.0409em;">&nbsp;1 ]</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.0409em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:11.9717em;z-index:121; "><span class="stl_10 stl_11 stl_07">_</span></div>
					<div class="stl_01" style="top: 10.7001em; left:12.6832em;z-index:134; "><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.1236em;">dictReset(&amp;d</span><span class="stl_107 stl_108 stl_493" style="word-spacing:-0.1236em;">−</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.1236em;">&gt;ht [ 1 ] ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:11.895em;z-index:155; "><span class="stl_10 stl_11 stl_494" style="word-spacing:0.2393em;">d</span><span class="stl_107 stl_108 stl_494" style="word-spacing:0.2393em;">−</span><span class="stl_10 stl_11 stl_494" style="word-spacing:0.2393em;">&gt;rehashidx = </span><span class="stl_107 stl_108 stl_494" style="word-spacing:0.2393em;">−</span><span class="stl_10 stl_11 stl_494" style="word-spacing:0.2393em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:11.9308em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.4132em;"><span class="stl_58 stl_59 stl_496" style="word-spacing:0.2525em;">* Note</span><span class="stl_58 stl_59 stl_496" style="word-spacing:0.3365em;">&nbsp;that</span><span class="stl_58 stl_59 stl_496" style="word-spacing:0.3955em;">&nbsp;rehashidx</span><span class="stl_58 stl_59 stl_496" style="word-spacing:0.3185em;">&nbsp;can</span><span class="stl_58 stl_59 stl_496" style="word-spacing:-0.2145em;">&nbsp;’</span><span class="stl_58 stl_59 stl_496" style="word-spacing:-0.2465em;">&nbsp;t</span><span class="stl_58 stl_59 stl_496" style="word-spacing:0.3915em;">&nbsp;overflow</span><span class="stl_58 stl_59 stl_496" style="word-spacing:0.3505em;">&nbsp;as</span><span class="stl_58 stl_59 stl_496" style="word-spacing:0.2455em;">&nbsp;we are</span><span class="stl_58 stl_59 stl_496" style="word-spacing:0.3385em;">&nbsp;sure &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:11.6642em;"><span class="stl_58 stl_59 stl_423" style="word-spacing:0.3969em;">there are</span><span class="stl_58 stl_59 stl_423" style="word-spacing:0.2979em;">&nbsp;more &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 17.676em; left:11.4811em;"><span class="stl_58 stl_59 stl_497" style="word-spacing:0.3702em;">elements because ht</span><span class="stl_58 stl_59 stl_497" style="word-spacing:-0.1473em;">&nbsp;[</span><span class="stl_58 stl_59 stl_497" style="word-spacing:-0.2673em;">&nbsp;0</span><span class="stl_58 stl_59 stl_497" style="word-spacing:-0.2663em;">&nbsp;]</span><span class="stl_58 stl_59 stl_497" style="word-spacing:-0.2673em;">&nbsp;.</span><span class="stl_58 stl_59 stl_497" style="word-spacing:-0.1693em;">&nbsp;used</span><span class="stl_58 stl_59 stl_497" style="word-spacing:0.2787em;">&nbsp;!=</span><span class="stl_58 stl_59 stl_497" style="word-spacing:0.2347em;">&nbsp;0</span><span class="stl_58 stl_59 stl_497" style="word-spacing:0.2347em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.666em; left:10.0192em;z-index:286; "><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.2038em;">a s</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.2028em;">&nbsp;s</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.2038em;">&nbsp;e</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.2038em;">&nbsp;r</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.2038em;">&nbsp;t</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.0978em;">&nbsp;(d</span><span class="stl_107 stl_108 stl_297" style="word-spacing:-0.0978em;">−</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.0978em;">&gt;ht</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.0598em;">&nbsp;[</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1458em;">&nbsp;0</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1458em;">&nbsp;]</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1458em;">&nbsp;.</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1687em;">&nbsp;s i</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1898em;">&nbsp;z</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1908em;">&nbsp;e</span><span class="stl_10 stl_11 stl_297" style="word-spacing:0.2887em;">&nbsp;&gt; (</span><span class="stl_15 stl_16 stl_297" style="word-spacing:0.2887em;">unsigned</span><span class="stl_10 stl_11 stl_297" style="word-spacing:0.2887em;">)d</span><span class="stl_107 stl_108 stl_297" style="word-spacing:0.2887em;">−</span><span class="stl_10 stl_11 stl_297" style="word-spacing:0.2887em;">&gt;rehashidx</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1338em;">&nbsp;)</span><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1338em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">找</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;不</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;位</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;置 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:9.9408em;z-index:356; "><span class="stl_15 stl_16 stl_353">while</span><span class="stl_15 stl_16 stl_353" style="word-spacing:-0.1462em;">&nbsp;</span><span class="stl_10 stl_11 stl_353" style="word-spacing:-0.1462em;">(d</span><span class="stl_107 stl_108 stl_353" style="word-spacing:-0.1462em;">−</span><span class="stl_10 stl_11 stl_353" style="word-spacing:-0.1462em;">&gt;ht</span><span class="stl_10 stl_11 stl_353" style="word-spacing:-0.0155em;">&nbsp;[</span><span class="stl_10 stl_11 stl_353" style="word-spacing:-0.1005em;">&nbsp;0</span><span class="stl_10 stl_11 stl_353" style="word-spacing:-0.1005em;">&nbsp;]</span><span class="stl_10 stl_11 stl_353" style="word-spacing:-0.0995em;">&nbsp;.</span><span class="stl_10 stl_11 stl_353" style="word-spacing:0.0385em;">&nbsp;table</span><span class="stl_10 stl_11 stl_353" style="word-spacing:-0.0135em;">&nbsp;[</span><span class="stl_10 stl_11 stl_353" style="word-spacing:-0.0135em;">&nbsp;d</span><span class="stl_107 stl_108 stl_353" style="word-spacing:-0.0135em;">−</span><span class="stl_10 stl_11 stl_353" style="word-spacing:-0.1385em;">&gt;rehashidx</span><span class="stl_10 stl_11 stl_353" style="word-spacing:-0.0335em;">&nbsp;]</span><span class="stl_10 stl_11 stl_353" style="word-spacing:0.3295em;">&nbsp;==</span><span class="stl_10 stl_11 stl_353" style="word-spacing:0.0965em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_353" style="word-spacing:0.0965em;">&nbsp;d</span><span class="stl_107 stl_108 stl_353" style="word-spacing:0.0965em;">−</span><span class="stl_10 stl_11 stl_353" style="word-spacing:0.0965em;">&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:11.65em;"><span class="stl_10 stl_11 stl_423">rehashidx++; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:9.9458em;z-index:388; "><span class="stl_10 stl_11 stl_498" style="word-spacing:0.2065em;">de =</span><span class="stl_10 stl_11 stl_498" style="word-spacing:0.2065em;">&nbsp;d</span><span class="stl_107 stl_108 stl_498" style="word-spacing:0.2065em;">−</span><span class="stl_10 stl_11 stl_498" style="word-spacing:0.1545em;">&gt;ht</span><span class="stl_10 stl_11 stl_498" style="word-spacing:-0.0735em;">&nbsp;[</span><span class="stl_10 stl_11 stl_498" style="word-spacing:-0.1585em;">&nbsp;0</span><span class="stl_10 stl_11 stl_498" style="word-spacing:-0.1575em;">&nbsp;]</span><span class="stl_10 stl_11 stl_498" style="word-spacing:-0.1585em;">&nbsp;.</span><span class="stl_10 stl_11 stl_498" style="word-spacing:-0.0195em;">&nbsp;table</span><span class="stl_10 stl_11 stl_498" style="word-spacing:-0.0715em;">&nbsp;[</span><span class="stl_10 stl_11 stl_498" style="word-spacing:-0.0715em;">&nbsp;d</span><span class="stl_107 stl_108 stl_498" style="word-spacing:-0.0715em;">−</span><span class="stl_10 stl_11 stl_498" style="word-spacing:-0.1955em;">&gt;rehashidx</span><span class="stl_10 stl_11 stl_498" style="word-spacing:-0.0375em;">&nbsp;]</span><span class="stl_10 stl_11 stl_498" style="word-spacing:-0.0375em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">此</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;位</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;所</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;移</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;动</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;二</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:10.4132em;"><span class="stl_58 stl_59 stl_499" style="word-spacing:0.2208em;">* Move</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3558em;">&nbsp;a</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2572em;">&nbsp;l</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2582em;">&nbsp;l</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.4658em;">&nbsp;the</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3818em;">&nbsp;keys in</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.4258em;">&nbsp;t</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2832em;">&nbsp;h</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2842em;">&nbsp;i</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2842em;">&nbsp;s</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.4438em;">&nbsp;bucket</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3423em;">&nbsp;from the</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3998em;">&nbsp;old</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3998em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:11.6542em;"><span class="stl_58 stl_59 stl_500" style="word-spacing:0.3634em;">the new hash</span><span class="stl_58 stl_59 stl_500" style="word-spacing:0.2319em;">&nbsp;HT</span><span class="stl_58 stl_59 stl_500" style="word-spacing:0.1989em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6285em; left:9.9408em;"><span class="stl_15 stl_16 stl_109">while</span><span class="stl_15 stl_16 stl_109" style="word-spacing:-0.2067em;">&nbsp;</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.2067em;">(</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.203em;">&nbsp;de</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.202em;">&nbsp;)</span><span class="stl_10 stl_11 stl_109" style="word-spacing:-0.202em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6243em; left:11.9175em;"><span class="stl_15 stl_16 stl_180" style="word-spacing:0.3827em;">unsigned int</span><span class="stl_15 stl_16 stl_180" style="word-spacing:0.3645em;">&nbsp;</span><span class="stl_10 stl_11 stl_180" style="word-spacing:0.3645em;">h</span><span class="stl_10 stl_11 stl_180" style="word-spacing:0.3645em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:11.9642em;z-index:506; "><span class="stl_10 stl_11 stl_194" style="word-spacing:0.2477em;">nextde =</span><span class="stl_10 stl_11 stl_194" style="word-spacing:0.1997em;">&nbsp;de</span><span class="stl_107 stl_108 stl_194" style="word-spacing:0.1997em;">−</span><span class="stl_10 stl_11 stl_194" style="word-spacing:0.1997em;">&gt;next</span><span class="stl_10 stl_11 stl_194" style="word-spacing:0.1997em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:12.4057em;"><span class="stl_58 stl_59 stl_501" style="word-spacing:0.2821em;">* Get</span><span class="stl_58 stl_59 stl_501" style="word-spacing:0.3461em;">&nbsp;the</span><span class="stl_58 stl_59 stl_501" style="word-spacing:0.3978em;">&nbsp;index in the</span><span class="stl_58 stl_59 stl_501" style="word-spacing:0.3171em;">&nbsp;new</span><span class="stl_58 stl_59 stl_501" style="word-spacing:0.2841em;">&nbsp;hash</span><span class="stl_58 stl_59 stl_501" style="word-spacing:0.4191em;">&nbsp;t</span><span class="stl_58 stl_59 stl_501" style="word-spacing:-0.2729em;">&nbsp;a</span><span class="stl_58 stl_59 stl_501" style="word-spacing:-0.2719em;">&nbsp;b</span><span class="stl_58 stl_59 stl_501" style="word-spacing:-0.2729em;">&nbsp;l</span><span class="stl_58 stl_59 stl_501" style="word-spacing:-0.2719em;">&nbsp;e</span><span class="stl_58 stl_59 stl_501" style="word-spacing:0.3871em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">计</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;算</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:11.9017em;z-index:578; "><span class="stl_10 stl_11 stl_502" style="word-spacing:0.17em;">h =</span><span class="stl_10 stl_11 stl_502" style="word-spacing:0.231em;">&nbsp;dictHashKey</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.174em;">&nbsp;(d</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.172em;">&nbsp;,</span><span class="stl_10 stl_11 stl_502" style="word-spacing:0.449em;">&nbsp;de</span><span class="stl_107 stl_108 stl_502" style="word-spacing:0.449em;">−</span><span class="stl_10 stl_11 stl_502" style="word-spacing:0.449em;">&gt;key</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.181em;">&nbsp;)</span><span class="stl_10 stl_11 stl_502" style="word-spacing:0.254em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_502" style="word-spacing:0.254em;">&nbsp;d</span><span class="stl_107 stl_108 stl_502" style="word-spacing:0.254em;">−</span><span class="stl_10 stl_11 stl_502" style="word-spacing:0.164em;">&gt;ht</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.064em;">&nbsp;[</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.148em;">&nbsp;1</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.149em;">&nbsp;]</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.149em;">&nbsp;.</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.039em;">&nbsp;sizemask</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.039em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">头</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;插</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;法 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:11.925em;z-index:610; "><span class="stl_10 stl_11 stl_503" style="word-spacing:0.2806em;">de</span><span class="stl_107 stl_108 stl_503" style="word-spacing:0.2806em;">−</span><span class="stl_10 stl_11 stl_503" style="word-spacing:0.2806em;">&gt;next =</span><span class="stl_10 stl_11 stl_503" style="word-spacing:0.2806em;">&nbsp;d</span><span class="stl_107 stl_108 stl_503" style="word-spacing:0.2806em;">−</span><span class="stl_10 stl_11 stl_503" style="word-spacing:0.1986em;">&gt;ht</span><span class="stl_10 stl_11 stl_503" style="word-spacing:-0.0294em;">&nbsp;[</span><span class="stl_10 stl_11 stl_503" style="word-spacing:-0.1144em;">&nbsp;1</span><span class="stl_10 stl_11 stl_503" style="word-spacing:-0.1144em;">&nbsp;]</span><span class="stl_10 stl_11 stl_503" style="word-spacing:-0.1144em;">&nbsp;.</span><span class="stl_10 stl_11 stl_503" style="word-spacing:-0.0028em;">&nbsp;table [</span><span class="stl_10 stl_11 stl_503" style="word-spacing:-0.1444em;">&nbsp;h</span><span class="stl_10 stl_11 stl_503" style="word-spacing:-0.0914em;">&nbsp;]</span><span class="stl_10 stl_11 stl_503" style="word-spacing:-0.0914em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:11.895em;z-index:628; "><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.0556em;">d</span><span class="stl_107 stl_108 stl_504" style="word-spacing:-0.0556em;">−</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.0556em;">&gt;ht [</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1396em;">&nbsp;1</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1406em;">&nbsp;]</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1406em;">&nbsp;.</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.0016em;">&nbsp;table</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.0536em;">&nbsp;[</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1706em;">&nbsp;h</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1706em;">&nbsp;]</span><span class="stl_10 stl_11 stl_504" style="word-spacing:0.3184em;">&nbsp;=</span><span class="stl_10 stl_11 stl_504" style="word-spacing:0.2244em;">&nbsp;de</span><span class="stl_10 stl_11 stl_504" style="word-spacing:0.2244em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5901em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">更</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;新</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;量 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:11.895em;z-index:674; "><span class="stl_10 stl_11 stl_505" style="word-spacing:-0.0437em;">d</span><span class="stl_107 stl_108 stl_505" style="word-spacing:-0.0437em;">−</span><span class="stl_10 stl_11 stl_505" style="word-spacing:-0.0437em;">&gt;ht [ 0 ] . used</span><span class="stl_107 stl_108 stl_505" style="word-spacing:-0.0437em;">−−</span><span class="stl_10 stl_11 stl_505" style="word-spacing:-0.0437em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:11.895em;z-index:677; "><span class="stl_10 stl_11 stl_506" style="word-spacing:-0.0378em;">d</span><span class="stl_107 stl_108 stl_506" style="word-spacing:-0.0378em;">−</span><span class="stl_10 stl_11 stl_506" style="word-spacing:-0.0378em;">&gt;ht [ 1 ] . used++; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:11.9383em;"><span class="stl_10 stl_11 stl_507" style="word-spacing:0.1433em;">de =</span><span class="stl_10 stl_11 stl_507" style="word-spacing:-0.0012em;">&nbsp;nextde</span><span class="stl_10 stl_11 stl_507" style="word-spacing:-0.0012em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.5676em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.5676em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;空 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">56 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.2825em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 7.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">DICT &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:9.9025em;z-index:41; "><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.0416em;">d</span><span class="stl_107 stl_108 stl_163" style="word-spacing:-0.0416em;">−</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.0416em;">&gt;ht [</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1256em;">&nbsp;0</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1266em;">&nbsp;]</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1266em;">&nbsp;.</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.0272em;">&nbsp;table [</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.0272em;">&nbsp;d</span><span class="stl_107 stl_108 stl_163" style="word-spacing:-0.0272em;">−</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.1636em;">&gt;rehashidx</span><span class="stl_10 stl_11 stl_163" style="word-spacing:-0.0586em;">&nbsp;]</span><span class="stl_10 stl_11 stl_163" style="word-spacing:0.3324em;">&nbsp;=</span><span class="stl_10 stl_11 stl_163" style="word-spacing:0.1014em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;向</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;下</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;位</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;置 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7076em; left:9.9025em;z-index:73; "><span class="stl_10 stl_11 stl_508">d</span><span class="stl_107 stl_108 stl_508">−</span><span class="stl_10 stl_11 stl_508">&gt;rehashidx++; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 10.6952em; left:7.9458em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 36.5624em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">7</span></div>
					<div class="stl_01" style="top: 36.5624em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.5 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">低效率的哈希表添加替换 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:7.5658em;"><span class="stl_17 stl_18 stl_509" style="word-spacing:0.084em;">在 </span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.084em;">redis </span><span class="stl_17 stl_18 stl_509" style="word-spacing:0.084em;">添加替换的时候，都先要查看数据集中是否已经存在该键，也就是一个 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0839em;">查找的过程，如果一个 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0839em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0839em;">命令导致过多的查找，会导致效率低下。可能是为了扬 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;z-index:201; "><span class="stl_17 stl_18 stl_510" style="word-spacing:0.0801em;">长避短，即高读性能和低写性能，</span><span class="stl_10 stl_11 stl_510" style="word-spacing:0.0801em;">redis </span><span class="stl_17 stl_18 stl_510" style="word-spacing:0.0801em;">中数据的添加和替换效率不高，特别是替换效 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">率低的恶心。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_13.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_13.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">7.5. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">低效率的哈希表添加替换 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">57 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:7.5658em;"><span class="stl_17 stl_18 stl_511" style="word-spacing:0.0787em;">在 </span><span class="stl_10 stl_11 stl_511" style="word-spacing:0.0787em;">redis SET </span><span class="stl_17 stl_18 stl_511" style="word-spacing:0.0787em;">命令的调用链中，添加键值对会导致了 </span><span class="stl_10 stl_11 stl_511" style="word-spacing:0.0787em;">2 </span><span class="stl_17 stl_18 stl_511" style="word-spacing:0.0787em;">次的键值对查找；替换键 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_512" style="word-spacing:0.1087em;">值对最多会导致 </span><span class="stl_10 stl_11 stl_512" style="word-spacing:0.1087em;">4 </span><span class="stl_17 stl_18 stl_512" style="word-spacing:0.1087em;">次的键值对查找。在 </span><span class="stl_10 stl_11 stl_512" style="word-spacing:0.1087em;">dict </span><span class="stl_17 stl_18 stl_512" style="word-spacing:0.1087em;">的实现中，</span><span class="stl_10 stl_11 stl_512" style="word-spacing:0.1087em;">dictFind() </span><span class="stl_17 stl_18 stl_512" style="word-spacing:0.1087em;">和 </span><span class="stl_10 stl_11 stl_512" style="word-spacing:0.1087em;">_dictIndex() &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.084em;">都会导致键值对的查找，详细可以参看源码。所以，从源码来看，经常在 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.084em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.084em;">上写 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">不是一个明智的选择。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">58 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.2825em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 7.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">DICT &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4507em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">7</span></div>
					<div class="stl_01" style="top: 5.4507em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.6 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">哈希表的迭代 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.8685em; left:7.5658em;"><span class="stl_17 stl_18 stl_509" style="word-spacing:0.0857em;">在 </span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.0857em;">RDB </span><span class="stl_17 stl_18 stl_509" style="word-spacing:0.0857em;">和 </span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.0857em;">AOF </span><span class="stl_17 stl_18 stl_509" style="word-spacing:0.0857em;">持久化操作中，都需要迭代哈希表。哈希表的遍历本身难度不 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.0865em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">大，但因为每个数据集都有两个哈希表，所以遍历哈希表的时候也需要注意遍历两个 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.0832em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">哈希表：第一个哈希表遍历完毕的时候，如果发现重置哈希表尚未结束，则需要继续 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.0798em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">遍历第二个哈希表。 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.5376em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.5376em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">迭</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;代</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;器</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;下</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;项</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;口 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.5318em; left:6.0042em;"><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.0331em;">dictEntry * dictNext</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.2635em;">&nbsp;(</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.2105em;">&nbsp;d</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3155em;">&nbsp;i</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3155em;">&nbsp;c</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3165em;">&nbsp;t</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3155em;">&nbsp;I</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3155em;">&nbsp;t</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3165em;">&nbsp;e</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3155em;">&nbsp;r</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3165em;">&nbsp;a</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3155em;">&nbsp;t</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3155em;">&nbsp;o</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3165em;">&nbsp;r</span><span class="stl_10 stl_11 stl_367" style="word-spacing:0.3345em;">&nbsp;*</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.2535em;">&nbsp;i</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3025em;">&nbsp;t</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3035em;">&nbsp;e</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3025em;">&nbsp;r</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.3025em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 15.5285em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 16.5193em; left:7.9483em;"><span class="stl_15 stl_16 stl_373" style="word-spacing:0.3678em;">while </span><span class="stl_10 stl_11 stl_373" style="word-spacing:0.3678em;">(1) { &nbsp;</span></div>
					<div class="stl_01" style="top: 17.516em; left:10.0375em;z-index:221; "><span class="stl_15 stl_16 stl_513" style="word-spacing:-0.1403em;">i f</span><span class="stl_15 stl_16 stl_513" style="word-spacing:0.5661em;">&nbsp;</span><span class="stl_10 stl_11 stl_513" style="word-spacing:0.5661em;">(</span><span class="stl_10 stl_11 stl_513" style="word-spacing:-0.0613em;">&nbsp;iter</span><span class="stl_10 stl_11 stl_513" style="word-spacing:-0.1059em;">&nbsp;</span><span class="stl_107 stl_108 stl_513" style="word-spacing:-0.0613em;">−</span><span class="stl_10 stl_11 stl_513" style="word-spacing:-0.1059em;">&gt;entry</span><span class="stl_10 stl_11 stl_513" style="word-spacing:0.2807em;">&nbsp;==</span><span class="stl_10 stl_11 stl_513" style="word-spacing:0.0947em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_513" style="word-spacing:0.0947em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5168em; left:12em;z-index:263; "><span class="stl_10 stl_11 stl_514" style="word-spacing:0.4008em;">dictht *ht</span><span class="stl_10 stl_11 stl_514" style="word-spacing:0.2058em;">&nbsp;=</span><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.2085em;">&nbsp;&amp;ite r</span><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.1801em;">&nbsp;</span><span class="stl_107 stl_108 stl_514" style="word-spacing:-0.2085em;">−</span><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.1801em;">&gt;d</span><span class="stl_107 stl_108 stl_514" style="word-spacing:-0.1801em;">−</span><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.1801em;">&gt;ht</span><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.1442em;">&nbsp;[</span><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.0792em;">&nbsp;iter</span><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.1795em;">&nbsp;</span><span class="stl_107 stl_108 stl_514" style="word-spacing:-0.0792em;">−</span><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.1795em;">&gt;table</span><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.0372em;">&nbsp;]</span><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.0372em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.5151em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.5151em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">新</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;迭</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;代</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;器 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5043em; left:12.03em;z-index:303; "><span class="stl_15 stl_16 stl_515" style="word-spacing:-0.1889em;">i f</span><span class="stl_15 stl_16 stl_515" style="word-spacing:0.5175em;">&nbsp;</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.5175em;">(</span><span class="stl_10 stl_11 stl_515" style="word-spacing:-0.1099em;">&nbsp;iter</span><span class="stl_10 stl_11 stl_515" style="word-spacing:-0.1545em;">&nbsp;</span><span class="stl_107 stl_108 stl_515" style="word-spacing:-0.1099em;">−</span><span class="stl_10 stl_11 stl_515" style="word-spacing:-0.1545em;">&gt;index</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.2231em;">&nbsp;==</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.0775em;">&nbsp;</span><span class="stl_107 stl_108 stl_515" style="word-spacing:0.2231em;">−</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.0775em;">1</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.0961em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.2651em;">&nbsp;iter</span><span class="stl_10 stl_11 stl_515" style="word-spacing:-0.1547em;">&nbsp;</span><span class="stl_107 stl_108 stl_515" style="word-spacing:0.2651em;">−</span><span class="stl_10 stl_11 stl_515" style="word-spacing:-0.1547em;">&gt;table</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.2551em;">&nbsp;==</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.2191em;">&nbsp;0)</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.2191em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.501em; left:14.0225em;z-index:322; "><span class="stl_15 stl_16 stl_440" style="word-spacing:-0.1656em;">i f</span><span class="stl_15 stl_16 stl_440" style="word-spacing:0.5408em;">&nbsp;</span><span class="stl_10 stl_11 stl_440" style="word-spacing:0.5408em;">(</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.0866em;">&nbsp;it</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1916em;">&nbsp;er</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1312em;">&nbsp;</span><span class="stl_107 stl_108 stl_440" style="word-spacing:-0.1916em;">−</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1312em;">&gt;s</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1906em;">&nbsp;a</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1906em;">&nbsp;f</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1906em;">&nbsp;e</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1906em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 22.5018em; left:15.9925em;z-index:336; "><span class="stl_10 stl_11 stl_516" style="word-spacing:-0.0498em;">ite r </span><span class="stl_107 stl_108 stl_516" style="word-spacing:-0.0498em;">−</span><span class="stl_10 stl_11 stl_516" style="word-spacing:-0.0498em;">&gt;d</span><span class="stl_107 stl_108 stl_516" style="word-spacing:-0.0498em;">−</span><span class="stl_10 stl_11 stl_516" style="word-spacing:-0.0498em;">&gt;i t e r a t o r s ++; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.4935em; left:13.9708em;"><span class="stl_15 stl_16 stl_443">else &nbsp;</span></div>
					<div class="stl_01" style="top: 24.4943em; left:15.9925em;z-index:358; "><span class="stl_10 stl_11 stl_517">iter</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.2962em;">&nbsp;</span><span class="stl_107 stl_108 stl_517">−</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.2962em;">&gt;f</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.3432em;">&nbsp;i</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.3432em;">&nbsp;n</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.3432em;">&nbsp;g</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.3442em;">&nbsp;e</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.3432em;">&nbsp;r</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.3432em;">&nbsp;p</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.3432em;">&nbsp;r</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.3442em;">&nbsp;i</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.3432em;">&nbsp;n</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.3432em;">&nbsp;t</span><span class="stl_10 stl_11 stl_517" style="word-spacing:0.1678em;">&nbsp;=</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.1044em;">&nbsp;dictFingerprint (</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.2512em;">&nbsp;ite</span><span class="stl_10 stl_11 stl_517" style="word-spacing:-0.2512em;">&nbsp;r &nbsp;</span></div>
					<div class="stl_01" style="top: 25.491em; left:17.455em;z-index:392; "><span class="stl_107 stl_108 stl_206" style="word-spacing:0.0939em;">−</span><span class="stl_10 stl_11 stl_206" style="word-spacing:0.0939em;">&gt;d) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4868em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 27.4835em; left:12.0075em;z-index:402; "><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.1725em;">iter </span><span class="stl_107 stl_108 stl_228" style="word-spacing:-0.1725em;">−</span><span class="stl_10 stl_11 stl_228" style="word-spacing:-0.1725em;">&gt;index++; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4776em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.4776em; left:12.4057em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">下 标</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;超</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;过</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;了</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;表</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;大</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;小，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;合</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;法 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4668em; left:12.03em;z-index:454; "><span class="stl_15 stl_16 stl_518" style="word-spacing:-0.1737em;">i f</span><span class="stl_15 stl_16 stl_518" style="word-spacing:0.5326em;">&nbsp;</span><span class="stl_10 stl_11 stl_518" style="word-spacing:0.5326em;">(</span><span class="stl_10 stl_11 stl_518" style="word-spacing:-0.0947em;">&nbsp;iter</span><span class="stl_10 stl_11 stl_518" style="word-spacing:-0.1394em;">&nbsp;</span><span class="stl_107 stl_108 stl_518" style="word-spacing:-0.0947em;">−</span><span class="stl_10 stl_11 stl_518" style="word-spacing:-0.1394em;">&gt;index</span><span class="stl_10 stl_11 stl_518" style="word-spacing:0.1793em;">&nbsp;&gt;=</span><span class="stl_10 stl_11 stl_518" style="word-spacing:0.2653em;">&nbsp;(</span><span class="stl_10 stl_11 stl_518" style="word-spacing:-0.1798em;">&nbsp;</span><span class="stl_15 stl_16 stl_518" style="word-spacing:-0.1798em;">signed</span><span class="stl_15 stl_16 stl_518" style="word-spacing:-0.1803em;">&nbsp;</span><span class="stl_10 stl_11 stl_518" style="word-spacing:-0.1803em;">)</span><span class="stl_10 stl_11 stl_518" style="word-spacing:0.4193em;">&nbsp;ht</span><span class="stl_107 stl_108 stl_518" style="word-spacing:0.4193em;">−</span><span class="stl_10 stl_11 stl_518" style="word-spacing:0.4193em;">&gt;s</span><span class="stl_10 stl_11 stl_518" style="word-spacing:-0.1817em;">&nbsp;i</span><span class="stl_10 stl_11 stl_518" style="word-spacing:-0.1817em;">&nbsp;z</span><span class="stl_10 stl_11 stl_518" style="word-spacing:-0.1817em;">&nbsp;e</span><span class="stl_10 stl_11 stl_518" style="word-spacing:-0.0757em;">&nbsp;)</span><span class="stl_10 stl_11 stl_518" style="word-spacing:-0.0757em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4701em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.4626em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.4701em; left:14.3982em;"><span class="stl_58 stl_59 stl_519">/</span><span class="stl_58 stl_59 stl_519" style="word-spacing:-0.1228em;">&nbsp;</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.1228em;">如 果</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;正</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;在</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;重</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;置</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;希</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3068em;">&nbsp;表，</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.2592em;">&nbsp;</span><span class="stl_58 stl_59 stl_519" style="word-spacing:-0.2592em;">redis</span><span class="stl_58 stl_59 stl_519" style="word-spacing:-0.0335em;">&nbsp;</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.0335em;">会 尝</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;试</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;在</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;第</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;二</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;个</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;哈 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6865em; left:15.6192em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3105em;">希 表 上 进 行 迭 代， &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:14.3982em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">否</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;则</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;真</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;就</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;不</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;合</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;法</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;了 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4485em; left:14.0225em;z-index:539; "><span class="stl_15 stl_16 stl_520" style="word-spacing:-0.2629em;">i f</span><span class="stl_15 stl_16 stl_520" style="word-spacing:0.4435em;">&nbsp;</span><span class="stl_10 stl_11 stl_520" style="word-spacing:0.4435em;">(</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.2049em;">&nbsp;dictIsRehashing</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.2049em;">&nbsp;(</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.1839em;">&nbsp;iter</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.228em;">&nbsp;</span><span class="stl_107 stl_108 stl_520" style="word-spacing:-0.1839em;">−</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.228em;">&gt;d)</span><span class="stl_10 stl_11 stl_520" style="word-spacing:0.1481em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.0979em;">&nbsp;ite r</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.2285em;">&nbsp;</span><span class="stl_107 stl_108 stl_520" style="word-spacing:-0.0979em;">−</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.2285em;">&gt;table &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4502em; left:15.9855em;"><span class="stl_10 stl_11 stl_521" style="word-spacing:0.126em;">= 0)</span><span class="stl_10 stl_11 stl_521" style="word-spacing:0.126em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4502em; left:15.4375em;"><span class="stl_10 stl_11 stl_07">=</span></div>
					<div class="stl_01" style="top: 37.4476em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.4476em; left:14.3982em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">正 在</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;重</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;置</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;表，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;证</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;明</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;正</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;在</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;第</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.315em;">&nbsp;希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.315em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.6648em; left:15.6192em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3119em;">整 合 到 第 二 个 哈 希 表， &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:14.3982em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">则</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;向</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;二</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4352em; left:15.9925em;z-index:599; "><span class="stl_10 stl_11 stl_522" style="word-spacing:-0.2228em;">ite r </span><span class="stl_107 stl_108 stl_522" style="word-spacing:-0.2228em;">−</span><span class="stl_10 stl_11 stl_522" style="word-spacing:-0.2228em;">&gt;table++; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.431em; left:15.9925em;z-index:613; "><span class="stl_10 stl_11 stl_288">iter</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2108em;">&nbsp;</span><span class="stl_107 stl_108 stl_288">−</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2108em;">&gt;index</span><span class="stl_10 stl_11 stl_288" style="word-spacing:0.1972em;">&nbsp;=</span><span class="stl_10 stl_11 stl_288" style="word-spacing:0.2302em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:15.9392em;z-index:634; "><span class="stl_10 stl_11 stl_523" style="word-spacing:0.3124em;">ht =</span><span class="stl_10 stl_11 stl_523" style="word-spacing:0.1384em;">&nbsp;&amp;iter</span><span class="stl_10 stl_11 stl_523" style="word-spacing:-0.0731em;">&nbsp;</span><span class="stl_107 stl_108 stl_523" style="word-spacing:0.1384em;">−</span><span class="stl_10 stl_11 stl_523" style="word-spacing:-0.0731em;">&gt;d</span><span class="stl_107 stl_108 stl_523" style="word-spacing:-0.0731em;">−</span><span class="stl_10 stl_11 stl_523" style="word-spacing:-0.0731em;">&gt;ht</span><span class="stl_10 stl_11 stl_523" style="word-spacing:-0.0552em;">&nbsp;[ 1</span><span class="stl_10 stl_11 stl_523" style="word-spacing:-0.0706em;">&nbsp;]</span><span class="stl_10 stl_11 stl_523" style="word-spacing:-0.0706em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:13.9175em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 44.4218em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.4185em; left:14.9675em;"><span class="stl_15 stl_16 stl_443" style="word-spacing:0.2862em;">else </span><span class="stl_10 stl_11 stl_443" style="word-spacing:0.2862em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:14.3982em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">否 则</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;迭</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;代</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;完</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;毕，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;这</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;真</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;正</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;合</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;法</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;情</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;况 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:15.895em;"><span class="stl_15 stl_16 stl_524" style="word-spacing:-0.1209em;">break </span><span class="stl_10 stl_11 stl_524" style="word-spacing:-0.1209em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:13.9175em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 47.4085em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">7.6. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">哈希表的迭代 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">59 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;得</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;项</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;口 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:12.0075em;z-index:48; "><span class="stl_10 stl_11 stl_525" style="word-spacing:-0.2418em;">ite r</span><span class="stl_10 stl_11 stl_525" style="word-spacing:-0.1818em;">&nbsp;</span><span class="stl_107 stl_108 stl_525" style="word-spacing:-0.2418em;">−</span><span class="stl_10 stl_11 stl_525" style="word-spacing:-0.1818em;">&gt;entry</span><span class="stl_10 stl_11 stl_525" style="word-spacing:0.2342em;">&nbsp;=</span><span class="stl_10 stl_11 stl_525" style="word-spacing:0.1832em;">&nbsp;ht</span><span class="stl_107 stl_108 stl_525" style="word-spacing:0.1832em;">−</span><span class="stl_10 stl_11 stl_525" style="word-spacing:0.1832em;">&gt;table</span><span class="stl_10 stl_11 stl_525" style="word-spacing:-0.0918em;">&nbsp;[</span><span class="stl_10 stl_11 stl_525" style="word-spacing:-0.0818em;">&nbsp;ite</span><span class="stl_10 stl_11 stl_525" style="word-spacing:-0.2418em;">&nbsp;r</span><span class="stl_10 stl_11 stl_525" style="word-spacing:-0.1813em;">&nbsp;</span><span class="stl_107 stl_108 stl_525" style="word-spacing:-0.2418em;">−</span><span class="stl_10 stl_11 stl_525" style="word-spacing:-0.1813em;">&gt;index</span><span class="stl_10 stl_11 stl_525" style="word-spacing:-0.0698em;">&nbsp;]</span><span class="stl_10 stl_11 stl_525" style="word-spacing:-0.0698em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7027em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7001em; left:12.0075em;z-index:91; "><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.2556em;">ite r</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.1956em;">&nbsp;</span><span class="stl_107 stl_108 stl_526" style="word-spacing:-0.2556em;">−</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.1956em;">&gt;entry</span><span class="stl_10 stl_11 stl_526" style="word-spacing:0.2204em;">&nbsp;=</span><span class="stl_10 stl_11 stl_526" style="word-spacing:0.2554em;">&nbsp;iter</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.1957em;">&nbsp;</span><span class="stl_107 stl_108 stl_526" style="word-spacing:0.2554em;">−</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.1957em;">&gt;nextEntry</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.1957em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;得</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;下</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;项</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;人</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;口 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.691em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">迭 代</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;器</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;保</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;下</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;项</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;口，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;因</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;为</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;户</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;能</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;删</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;除 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.9082em; left:11.6342em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0501em;">此 函 数 返 回 的 数 据 项 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0392em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0392em;">入 口，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;如</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;此</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;导</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;致</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;迭</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;代</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;器</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;失</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;效，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;找</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;到</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;下</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;项</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;口 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:10.0375em;z-index:174; "><span class="stl_15 stl_16 stl_399" style="word-spacing:-0.2423em;">i f</span><span class="stl_15 stl_16 stl_399" style="word-spacing:0.4641em;">&nbsp;</span><span class="stl_10 stl_11 stl_399" style="word-spacing:0.4641em;">(</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.1633em;">&nbsp;iter</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2079em;">&nbsp;</span><span class="stl_107 stl_108 stl_399" style="word-spacing:-0.1633em;">−</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2079em;">&gt;entry</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.1973em;">&nbsp;)</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.1973em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:12.4057em;z-index:186; "><span class="stl_58 stl_59 stl_527" style="word-spacing:0.1304em;">* We</span><span class="stl_58 stl_59 stl_527" style="word-spacing:0.1524em;">&nbsp;need</span><span class="stl_58 stl_59 stl_527" style="word-spacing:0.3798em;">&nbsp;to save the</span><span class="stl_58 stl_59 stl_527" style="word-spacing:0.4774em;">&nbsp;’</span><span class="stl_58 stl_59 stl_527" style="word-spacing:-0.2286em;">&nbsp;next</span><span class="stl_58 stl_59 stl_527" style="word-spacing:-0.1306em;">&nbsp;’</span><span class="stl_58 stl_59 stl_527" style="word-spacing:0.3454em;">&nbsp;here</span><span class="stl_58 stl_59 stl_527" style="word-spacing:-0.1136em;">&nbsp;,</span><span class="stl_58 stl_59 stl_527" style="word-spacing:0.4384em;">&nbsp;the i</span><span class="stl_58 stl_59 stl_527" style="word-spacing:-0.2756em;">&nbsp;t</span><span class="stl_58 stl_59 stl_527" style="word-spacing:-0.2756em;">&nbsp;e</span><span class="stl_58 stl_59 stl_527" style="word-spacing:-0.2756em;">&nbsp;r</span><span class="stl_58 stl_59 stl_527" style="word-spacing:-0.2756em;">&nbsp;a</span><span class="stl_58 stl_59 stl_527" style="word-spacing:-0.2756em;">&nbsp;t</span><span class="stl_58 stl_59 stl_527" style="word-spacing:-0.2756em;">&nbsp;o</span><span class="stl_58 stl_59 stl_527" style="word-spacing:-0.2756em;">&nbsp;r &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:13.6383em;"><span class="stl_58 stl_59 stl_443">user &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:13.374em;"><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.0034em;">may d e</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.2992em;">&nbsp;l</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.2982em;">&nbsp;e</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.2992em;">&nbsp;t</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.2992em;">&nbsp;e</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.4063em;">&nbsp;the entry</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.2783em;">&nbsp;we are</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.3768em;">&nbsp;returning</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.1792em;">&nbsp;.</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.3468em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:12.0075em;z-index:288; "><span class="stl_10 stl_11 stl_529" style="word-spacing:-0.2254em;">ite r</span><span class="stl_10 stl_11 stl_529" style="word-spacing:-0.1654em;">&nbsp;</span><span class="stl_107 stl_108 stl_529" style="word-spacing:-0.2254em;">−</span><span class="stl_10 stl_11 stl_529" style="word-spacing:-0.1654em;">&gt;nextEntry</span><span class="stl_10 stl_11 stl_529" style="word-spacing:0.2296em;">&nbsp;=</span><span class="stl_10 stl_11 stl_529" style="word-spacing:0.2846em;">&nbsp;ite</span><span class="stl_10 stl_11 stl_529" style="word-spacing:-0.2254em;">&nbsp;r</span><span class="stl_10 stl_11 stl_529" style="word-spacing:-0.1656em;">&nbsp;</span><span class="stl_107 stl_108 stl_529" style="word-spacing:-0.2254em;">−</span><span class="stl_10 stl_11 stl_529" style="word-spacing:-0.1656em;">&gt;entry</span><span class="stl_107 stl_108 stl_529" style="word-spacing:-0.1656em;">−</span><span class="stl_10 stl_11 stl_529" style="word-spacing:-0.1656em;">&gt;next</span><span class="stl_10 stl_11 stl_529" style="word-spacing:-0.1656em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:11.9308em;z-index:305; "><span class="stl_15 stl_16 stl_530">return</span><span class="stl_15 stl_16 stl_530" style="word-spacing:0.408em;">&nbsp;</span><span class="stl_10 stl_11 stl_530" style="word-spacing:0.408em;">iter</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.1879em;">&nbsp;</span><span class="stl_107 stl_108 stl_530" style="word-spacing:0.408em;">−</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.1879em;">&gt;entry</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.1879em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6518em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.6435em; left:7.9458em;"><span class="stl_15 stl_16 stl_186" style="word-spacing:0.3002em;">return </span><span class="stl_10 stl_11 stl_186" style="word-spacing:0.3002em;">NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">60 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.2825em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 7.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">DICT &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9314em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 8 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6989em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.125em;">数据结构 </span><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">ziplist &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5107em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">8</span></div>
					<div class="stl_01" style="top: 20.5107em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">概述 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.7676em; left:7.5658em;z-index:80; "><span class="stl_17 stl_18 stl_531" style="word-spacing:0.1045em;">在 </span><span class="stl_10 stl_11 stl_531" style="word-spacing:0.1045em;">redis </span><span class="stl_17 stl_18 stl_531" style="word-spacing:0.1045em;">中，</span><span class="stl_10 stl_11 stl_531" style="word-spacing:0.1045em;">list </span><span class="stl_17 stl_18 stl_531" style="word-spacing:0.1045em;">有两种存储方式：双链表（</span><span class="stl_10 stl_11 stl_531" style="word-spacing:0.1045em;">LinkedList</span><span class="stl_17 stl_18 stl_531" style="word-spacing:0.1045em;">）和压缩双链表（</span><span class="stl_10 stl_11 stl_531" style="word-spacing:0.1045em;">ziplist</span><span class="stl_17 stl_18 stl_531" style="word-spacing:0.1045em;">）。 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.7635em; left:5.9058em;"><span class="stl_17 stl_18 stl_410" style="word-spacing:0.0883em;">双链表即普通数据结构中遇到的，在 </span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.0883em;">adlist.h </span><span class="stl_17 stl_18 stl_410" style="word-spacing:0.0883em;">和 </span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.0883em;">adlist.c </span><span class="stl_17 stl_18 stl_410" style="word-spacing:0.0883em;">中实现。压缩双链表以连续 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.7602em; left:5.9058em;"><span class="stl_17 stl_18 stl_532">的内存空间来表示双链表，压缩双链表节省前驱和后驱指针的空间（</span><span class="stl_10 stl_11 stl_532">8B</span><span class="stl_17 stl_18 stl_532">），这在小的 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.756em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">list </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">上，压缩效率是非常明显的；压缩双链表在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">ziplist.h </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">和 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">ziplist.c </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">中实现。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.9782em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">这篇主要详述压缩双链表，普通双链表可以参看其他。 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.1191em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">8</span></div>
					<div class="stl_01" style="top: 30.1191em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.2 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">压缩双链表的具体实现 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.376em; left:7.5658em;"><span class="stl_17 stl_18 stl_211" style="word-spacing:0.0828em;">在压缩双链表中，节省了前驱和后驱指针的空间，共 </span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.0828em;">8 </span><span class="stl_17 stl_18 stl_211" style="word-spacing:0.0828em;">个字节，这让数据在内存 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.594em; left:5.9058em;"><span class="stl_17 stl_18 stl_533">中更为紧凑。只要清晰的描述每个数据项的边界，就可以轻易得到后驱数据项的位置； &nbsp;</span></div>
					<div class="stl_01" style="top: 34.3685em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">只要描述前驱数据项的大小，就可以定位前驱数据项的位置，</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">就是这么做的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.3718em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">ziplist </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">的格式可以表示为： &nbsp;</span></div>
					<div class="stl_01" style="top: 37.8777em; left:5.8067em;"><span class="stl_10 stl_11 stl_07">&lt;</span></div>
					<div class="stl_01" style="top: 37.8777em; left:6.5107em;"><span class="stl_10 stl_11 stl_534" style="word-spacing:-0.1944em;">zlbytes &gt;&lt;z l t a i l &gt;&lt;zllen &gt;&lt;entry &gt;... &lt; entry&gt;&lt;zlend&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.3943em; left:7.5658em;"><span class="stl_10 stl_11 stl_27" style="word-spacing:0.0799em;">zlbytes </span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0799em;">是 </span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.0799em;">ziplist </span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0799em;">占用的空间；</span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.0799em;">zltail </span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0799em;">是最后一个数据项的偏移位置，这方便逆向 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.3901em; left:5.9058em;z-index:500; "><span class="stl_17 stl_18 stl_535" style="word-spacing:0.0858em;">遍历链表，也是双链表的特性；</span><span class="stl_10 stl_11 stl_535" style="word-spacing:0.0858em;">zllen </span><span class="stl_17 stl_18 stl_535" style="word-spacing:0.0858em;">是数据项 </span><span class="stl_10 stl_11 stl_535" style="word-spacing:0.0858em;">entry </span><span class="stl_17 stl_18 stl_535" style="word-spacing:0.0858em;">的个数；</span><span class="stl_10 stl_11 stl_535" style="word-spacing:0.0858em;">zlend </span><span class="stl_17 stl_18 stl_535" style="word-spacing:0.0858em;">就是 </span><span class="stl_10 stl_11 stl_535" style="word-spacing:0.0858em;">255</span><span class="stl_17 stl_18 stl_535" style="word-spacing:0.0858em;">，占 </span><span class="stl_10 stl_11 stl_535" style="word-spacing:0.0858em;">1B. &nbsp;</span></div>
					<div class="stl_01" style="top: 41.3868em; left:5.9058em;"><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0878em;">详细展开 </span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0878em;">entry </span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0878em;">的结构。 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.3901em; left:7.5658em;"><span class="stl_10 stl_11 stl_532" style="word-spacing:0.0944em;">entry </span><span class="stl_17 stl_18 stl_532" style="word-spacing:0.0944em;">的格式即为典型的 </span><span class="stl_10 stl_11 stl_532" style="word-spacing:0.0944em;">type-lenght-value</span><span class="stl_17 stl_18 stl_532" style="word-spacing:0.0944em;">，即 </span><span class="stl_10 stl_11 stl_532" style="word-spacing:0.0944em;">TLV</span><span class="stl_17 stl_18 stl_532" style="word-spacing:0.0944em;">，表述如下： &nbsp;</span></div>
					<div class="stl_01" style="top: 44.896em; left:5.935em;"><span class="stl_10 stl_11 stl_07">|</span></div>
					<div class="stl_01" style="top: 44.896em; left:6.2256em;"><span class="stl_10 stl_11 stl_378" style="word-spacing:-0.1725em;">&lt; prelen&gt;&lt;&lt;encoding+l e n s i z e &gt;&lt;len&gt;&gt;&lt;data &gt;| &nbsp;</span></div>
					<div class="stl_01" style="top: 45.8918em; left:5.8475em;z-index:611; "><span class="stl_10 stl_11 stl_07">|</span></div>
					<div class="stl_01" style="top: 45.8918em; left:5.9625em;z-index:651; "><span class="stl_107 stl_108 stl_536">−−−</span><span class="stl_10 stl_11 stl_536">1</span><span class="stl_107 stl_108 stl_536">−−−−−−−−−−−−−−−−</span><span class="stl_10 stl_11 stl_536">2</span><span class="stl_107 stl_108 stl_536">−−−−−−−−−−−−−−</span><span class="stl_10 stl_11 stl_536">3</span><span class="stl_107 stl_108 stl_536">−−−</span><span class="stl_10 stl_11 stl_536">| &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">域 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">1</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">）是前驱数据项的大小。因为不用描述前驱的数据类型，描述较为简单。 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">6</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">1</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">62 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:21.1633em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 8.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">ZIPLIST &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.5658em;z-index:52; "><span class="stl_17 stl_18 stl_537" style="word-spacing:0.0799em;">域 </span><span class="stl_10 stl_11 stl_537" style="word-spacing:0.0799em;">2</span><span class="stl_17 stl_18 stl_537" style="word-spacing:0.0799em;">）是此数据项的的类型和数据大小。为了节省空间，</span><span class="stl_10 stl_11 stl_537" style="word-spacing:0.0799em;">redis </span><span class="stl_17 stl_18 stl_537" style="word-spacing:0.0799em;">预设定了多种长度 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.9373em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">的字符串和整数。 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.9582em; left:8.2575em;"><span class="stl_17 stl_18 stl_07">种长度的字符串 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.736em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 10.271em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 10.271em; left:6.4748em;"><span class="stl_15 stl_16 stl_538">define</span><span class="stl_15 stl_16 stl_538" style="word-spacing:0.3923em;">&nbsp;</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.3923em;">ZIP_STR_06B (0</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.2817em;">&nbsp;&lt;&lt;</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.3517em;">&nbsp;6) &nbsp;</span></div>
					<div class="stl_01" style="top: 11.2677em; left:6.4748em;"><span class="stl_15 stl_16 stl_538">define</span><span class="stl_15 stl_16 stl_538" style="word-spacing:0.3923em;">&nbsp;</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.3923em;">ZIP_STR_14B (1</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.2817em;">&nbsp;&lt;&lt;</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.3517em;">&nbsp;6) &nbsp;</span></div>
					<div class="stl_01" style="top: 12.2635em; left:6.4748em;"><span class="stl_15 stl_16 stl_538">define</span><span class="stl_15 stl_16 stl_538" style="word-spacing:0.3923em;">&nbsp;</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.3923em;">ZIP_STR_32B (2</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.2817em;">&nbsp;&lt;&lt;</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.3517em;">&nbsp;6) &nbsp;</span></div>
					<div class="stl_01" style="top: 11.2677em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 12.2635em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 13.8368em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 14.059em; left:8.2575em;"><span class="stl_17 stl_18 stl_07">种长度的整数 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.3718em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 16.3718em; left:6.4748em;"><span class="stl_15 stl_16 stl_46">define</span><span class="stl_15 stl_16 stl_46" style="word-spacing:0.3769em;">&nbsp;</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.3769em;">ZIP_INT_16B (0</span><span class="stl_10 stl_11 stl_46" style="word-spacing:-0.1248em;">&nbsp;xc0</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.5332em;">&nbsp;|</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.4582em;">&nbsp;0&lt;&lt;4) &nbsp;</span></div>
					<div class="stl_01" style="top: 17.3685em; left:6.4748em;"><span class="stl_15 stl_16 stl_46">define</span><span class="stl_15 stl_16 stl_46" style="word-spacing:0.3769em;">&nbsp;</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.3769em;">ZIP_INT_32B (0</span><span class="stl_10 stl_11 stl_46" style="word-spacing:-0.1248em;">&nbsp;xc0</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.5332em;">&nbsp;|</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.4582em;">&nbsp;1&lt;&lt;4) &nbsp;</span></div>
					<div class="stl_01" style="top: 18.3643em; left:6.4748em;"><span class="stl_15 stl_16 stl_46">define</span><span class="stl_15 stl_16 stl_46" style="word-spacing:0.3769em;">&nbsp;</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.3769em;">ZIP_INT_64B (0</span><span class="stl_10 stl_11 stl_46" style="word-spacing:-0.1248em;">&nbsp;xc0</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.5332em;">&nbsp;|</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.4582em;">&nbsp;2&lt;&lt;4) &nbsp;</span></div>
					<div class="stl_01" style="top: 19.361em; left:6.4748em;"><span class="stl_15 stl_16 stl_46">define</span><span class="stl_15 stl_16 stl_46" style="word-spacing:0.3769em;">&nbsp;</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.3769em;">ZIP_INT_24B (0</span><span class="stl_10 stl_11 stl_46" style="word-spacing:-0.1248em;">&nbsp;xc0</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.5332em;">&nbsp;|</span><span class="stl_10 stl_11 stl_46" style="word-spacing:0.4582em;">&nbsp;3&lt;&lt;4) &nbsp;</span></div>
					<div class="stl_01" style="top: 20.3568em; left:6.4748em;"><span class="stl_15 stl_16 stl_539">define</span><span class="stl_15 stl_16 stl_539" style="word-spacing:0.3522em;">&nbsp;</span><span class="stl_10 stl_11 stl_539" style="word-spacing:0.3522em;">ZIP_INT_8B</span><span class="stl_10 stl_11 stl_539" style="word-spacing:0.3149em;">&nbsp;0</span><span class="stl_10 stl_11 stl_539" style="word-spacing:-0.1351em;">&nbsp;xfe &nbsp;</span></div>
					<div class="stl_01" style="top: 17.3685em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 18.3643em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 19.361em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 20.3568em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 21.9301em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">域 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">3</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">）为真正的数据。 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.951em; left:7.5658em;"><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0841em;">透过 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0841em;">ziplist </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0841em;">查找函数 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0841em;">ziplistFind()</span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0841em;">，熟悉 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0841em;">ziplist entry </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0841em;">对数据格式： &nbsp;</span></div>
					<div class="stl_01" style="top: 25.4926em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.4885em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.4926em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">在</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6581em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6581em;">z</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.042em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.041em;">&nbsp;p</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.042em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.041em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.041em;">&nbsp;s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.042em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6594em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6594em;">中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;查</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;找</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.049em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.049em;">&nbsp;项 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4885em; left:6.4282em;"><span class="stl_58 stl_59 stl_540" style="word-spacing:0.239em;">* Find</span><span class="stl_58 stl_59 stl_540" style="word-spacing:0.317em;">&nbsp;pointer</span><span class="stl_58 stl_59 stl_540" style="word-spacing:0.3552em;">&nbsp;to the entry equal to the</span><span class="stl_58 stl_59 stl_540" style="word-spacing:0.398em;">&nbsp;s</span><span class="stl_58 stl_59 stl_540" style="word-spacing:-0.326em;">&nbsp;p</span><span class="stl_58 stl_59 stl_540" style="word-spacing:-0.326em;">&nbsp;e</span><span class="stl_58 stl_59 stl_540" style="word-spacing:-0.327em;">&nbsp;c</span><span class="stl_58 stl_59 stl_540" style="word-spacing:-0.326em;">&nbsp;i</span><span class="stl_58 stl_59 stl_540" style="word-spacing:-0.326em;">&nbsp;f</span><span class="stl_58 stl_59 stl_540" style="word-spacing:-0.326em;">&nbsp;i</span><span class="stl_58 stl_59 stl_540" style="word-spacing:-0.326em;">&nbsp;e</span><span class="stl_58 stl_59 stl_540" style="word-spacing:-0.327em;">&nbsp;d</span><span class="stl_58 stl_59 stl_540" style="word-spacing:0.397em;">&nbsp;entry</span><span class="stl_58 stl_59 stl_540" style="word-spacing:0.397em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4851em; left:7.6592em;"><span class="stl_58 stl_59 stl_340" style="word-spacing:0.4037em;">Skip ’</span><span class="stl_58 stl_59 stl_340" style="word-spacing:-0.2643em;">&nbsp;skip</span><span class="stl_58 stl_59 stl_340" style="word-spacing:-0.1663em;">&nbsp;’</span><span class="stl_58 stl_59 stl_340" style="word-spacing:0.3487em;">&nbsp;e</span><span class="stl_58 stl_59 stl_340" style="word-spacing:-0.3483em;">&nbsp;n</span><span class="stl_58 stl_59 stl_340" style="word-spacing:-0.3483em;">&nbsp;t</span><span class="stl_58 stl_59 stl_340" style="word-spacing:-0.3483em;">&nbsp;r</span><span class="stl_58 stl_59 stl_340" style="word-spacing:-0.3483em;">&nbsp;i</span><span class="stl_58 stl_59 stl_340" style="word-spacing:-0.3483em;">&nbsp;e</span><span class="stl_58 stl_59 stl_340" style="word-spacing:-0.3483em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 28.481em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 28.481em; left:6.9845em;"><span class="stl_58 stl_59 stl_259" style="word-spacing:0.3965em;">between every comparison</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.181em;">&nbsp;.</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.423em;">&nbsp;Returns</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.208em;">&nbsp;NULL</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.155em;">&nbsp;when</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.348em;">&nbsp;the</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.5em;">&nbsp;f</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.223em;">&nbsp;i</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.224em;">&nbsp;e</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.224em;">&nbsp;l</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.224em;">&nbsp;d</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.497em;">&nbsp;could &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4776em; left:8.1458em;"><span class="stl_58 stl_59 stl_541" style="word-spacing:0.3568em;">not be found</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.1913em;">&nbsp;.</span><span class="stl_58 stl_59 stl_541" style="word-spacing:0.3718em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4668em; left:5.9392em;"><span class="stl_15 stl_16 stl_542" style="word-spacing:0.3426em;">unsigned char</span><span class="stl_15 stl_16 stl_542" style="word-spacing:0.3517em;">&nbsp;</span><span class="stl_10 stl_11 stl_542" style="word-spacing:0.3517em;">*</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1304em;">&nbsp;z</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1794em;">&nbsp;i</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1794em;">&nbsp;p</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1804em;">&nbsp;l</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1794em;">&nbsp;i</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1794em;">&nbsp;s</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1804em;">&nbsp;t</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1794em;">&nbsp;F</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1794em;">&nbsp;i</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1804em;">&nbsp;n</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1794em;">&nbsp;d</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1794em;">&nbsp;(</span><span class="stl_15 stl_16 stl_542" style="word-spacing:-0.0744em;">unsigned</span><span class="stl_15 stl_16 stl_542" style="word-spacing:0.3426em;">&nbsp;char</span><span class="stl_15 stl_16 stl_542" style="word-spacing:0.3527em;">&nbsp;</span><span class="stl_10 stl_11 stl_542" style="word-spacing:0.3527em;">*p</span><span class="stl_10 stl_11 stl_542" style="word-spacing:-0.1514em;">&nbsp;,</span><span class="stl_10 stl_11 stl_542" style="word-spacing:0.4615em;">&nbsp;</span><span class="stl_15 stl_16 stl_542" style="word-spacing:0.4615em;">unsigned</span><span class="stl_15 stl_16 stl_542" style="word-spacing:0.3436em;">&nbsp;char</span><span class="stl_15 stl_16 stl_542" style="word-spacing:0.3528em;">&nbsp;</span><span class="stl_10 stl_11 stl_542" style="word-spacing:0.3436em;">* &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4635em; left:7.6625em;"><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.005em;">vstr ,</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.405em;">&nbsp;</span><span class="stl_15 stl_16 stl_105" style="word-spacing:0.405em;">unsigned</span><span class="stl_15 stl_16 stl_105" style="word-spacing:0.342em;">&nbsp;int</span><span class="stl_15 stl_16 stl_105" style="word-spacing:0.4001em;">&nbsp;</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.4001em;">vlen</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.039em;">&nbsp;,</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.4041em;">&nbsp;</span><span class="stl_15 stl_16 stl_105" style="word-spacing:0.4041em;">unsigned</span><span class="stl_15 stl_16 stl_105" style="word-spacing:0.341em;">&nbsp;int</span><span class="stl_15 stl_16 stl_105" style="word-spacing:0.4302em;">&nbsp;</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.4302em;">skip</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.163em;">&nbsp;)</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.163em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4593em; left:7.98em;"><span class="stl_15 stl_16 stl_543">int</span><span class="stl_15 stl_16 stl_543" style="word-spacing:0.3301em;">&nbsp;</span><span class="stl_10 stl_11 stl_543" style="word-spacing:0.3301em;">skipcnt</span><span class="stl_10 stl_11 stl_543" style="word-spacing:0.1461em;">&nbsp;=</span><span class="stl_10 stl_11 stl_543" style="word-spacing:0.1461em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.456em; left:7.9325em;"><span class="stl_15 stl_16 stl_284" style="word-spacing:0.2879em;">unsigned char</span><span class="stl_15 stl_16 stl_284" style="word-spacing:0.3512em;">&nbsp;</span><span class="stl_10 stl_11 stl_284" style="word-spacing:0.3512em;">vencoding</span><span class="stl_10 stl_11 stl_284" style="word-spacing:0.2189em;">&nbsp;=</span><span class="stl_10 stl_11 stl_284" style="word-spacing:0.2549em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4527em; left:7.9467em;"><span class="stl_15 stl_16 stl_435" style="word-spacing:0.3254em;">long long</span><span class="stl_15 stl_16 stl_435" style="word-spacing:0.4471em;">&nbsp;</span><span class="stl_10 stl_11 stl_435" style="word-spacing:0.4471em;">v</span><span class="stl_10 stl_11 stl_435" style="word-spacing:-0.2126em;">&nbsp;l</span><span class="stl_10 stl_11 stl_435" style="word-spacing:-0.2116em;">&nbsp;l</span><span class="stl_10 stl_11 stl_435" style="word-spacing:0.2994em;">&nbsp;=</span><span class="stl_10 stl_11 stl_435" style="word-spacing:0.2614em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4452em; left:7.9483em;"><span class="stl_15 stl_16 stl_544">while</span><span class="stl_15 stl_16 stl_544" style="word-spacing:0.4896em;">&nbsp;</span><span class="stl_10 stl_11 stl_544" style="word-spacing:0.4896em;">(p</span><span class="stl_10 stl_11 stl_544" style="word-spacing:-0.0689em;">&nbsp;[</span><span class="stl_10 stl_11 stl_544" style="word-spacing:-0.0909em;">&nbsp;0</span><span class="stl_10 stl_11 stl_544" style="word-spacing:-0.0909em;">&nbsp;]</span><span class="stl_10 stl_11 stl_544" style="word-spacing:0.5571em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_544" style="word-spacing:0.3221em;">&nbsp;ZIP_END)</span><span class="stl_10 stl_11 stl_544" style="word-spacing:0.3221em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.441em; left:9.925em;"><span class="stl_15 stl_16 stl_479" style="word-spacing:0.2874em;">unsigned int</span><span class="stl_15 stl_16 stl_479" style="word-spacing:0.3886em;">&nbsp;</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.3886em;">prevlensize</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.0076em;">&nbsp;,</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.4044em;">&nbsp;encoding</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.0986em;">&nbsp;,</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.4594em;">&nbsp;l</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.3016em;">&nbsp;e</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.3006em;">&nbsp;n</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.3016em;">&nbsp;s</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.3016em;">&nbsp;i</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.3006em;">&nbsp;z</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.3016em;">&nbsp;e</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.0114em;">&nbsp;,</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.4384em;">&nbsp;len</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.4384em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4377em; left:9.925em;"><span class="stl_15 stl_16 stl_545" style="word-spacing:0.3437em;">unsigned char</span><span class="stl_15 stl_16 stl_545" style="word-spacing:0.3518em;">&nbsp;</span><span class="stl_10 stl_11 stl_545" style="word-spacing:0.3518em;">*q</span><span class="stl_10 stl_11 stl_545" style="word-spacing:0.3518em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4352em; left:9.8383em;"><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0426em;">ZIP_DECODE_PREVLENSIZE(p ,</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.7656em;">&nbsp;p</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0056em;">&nbsp;r</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0046em;">&nbsp;e</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0056em;">&nbsp;v</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0046em;">&nbsp;l</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0056em;">&nbsp;e</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0046em;">&nbsp;n</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0056em;">&nbsp;s</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0046em;">&nbsp;i</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0056em;">&nbsp;z</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.0046em;">&nbsp;e</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.1146em;">&nbsp;)</span><span class="stl_10 stl_11 stl_546" style="word-spacing:0.1146em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.4251em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.4218em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4293em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">跳 过</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;前</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;驱</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;项</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;大</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;小，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;解</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;析</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;项</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;大</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:10.4132em;"><span class="stl_58 stl_59 stl_547" style="word-spacing:0.3076em;">/ len</span><span class="stl_58 stl_59 stl_547" style="word-spacing:0.3483em;">&nbsp;</span><span class="stl_17 stl_18 stl_547" style="word-spacing:0.3483em;">为</span><span class="stl_17 stl_18 stl_547" style="word-spacing:0.3243em;">&nbsp;</span><span class="stl_58 stl_59 stl_547" style="word-spacing:0.3243em;">data</span><span class="stl_58 stl_59 stl_547" style="word-spacing:0.3257em;">&nbsp;</span><span class="stl_17 stl_18 stl_547" style="word-spacing:0.3257em;">大</span><span class="stl_17 stl_18 stl_547" style="word-spacing:0.3257em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:10.4132em;"><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.029em;">/ l e</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.344em;">&nbsp;n</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.343em;">&nbsp;s</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.344em;">&nbsp;i</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.344em;">&nbsp;z</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.344em;">&nbsp;e</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.3566em;">&nbsp;</span><span class="stl_17 stl_18 stl_72" style="word-spacing:0.3566em;">为</span><span class="stl_17 stl_18 stl_72" style="word-spacing:0.3188em;">&nbsp;</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.3188em;">len</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.3198em;">&nbsp;</span><span class="stl_17 stl_18 stl_72" style="word-spacing:0.3198em;">所</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;占</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;内</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;存</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;大</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:9.8142em;"><span class="stl_10 stl_11 stl_548" style="word-spacing:0.2394em;">ZIP_DECODE_LENGTH(p +</span><span class="stl_10 stl_11 stl_548" style="word-spacing:0.3584em;">&nbsp;prevlensize</span><span class="stl_10 stl_11 stl_548" style="word-spacing:0.1514em;">&nbsp;,</span><span class="stl_10 stl_11 stl_548" style="word-spacing:0.5634em;">&nbsp;encoding</span><span class="stl_10 stl_11 stl_548" style="word-spacing:0.0604em;">&nbsp;,</span><span class="stl_10 stl_11 stl_548" style="word-spacing:0.6184em;">&nbsp;l</span><span class="stl_10 stl_11 stl_548" style="word-spacing:-0.1416em;">&nbsp;e</span><span class="stl_10 stl_11 stl_548" style="word-spacing:-0.1426em;">&nbsp;n</span><span class="stl_10 stl_11 stl_548" style="word-spacing:-0.1426em;">&nbsp;s</span><span class="stl_10 stl_11 stl_548" style="word-spacing:-0.1416em;">&nbsp;i</span><span class="stl_10 stl_11 stl_548" style="word-spacing:-0.1426em;">&nbsp;z</span><span class="stl_10 stl_11 stl_548" style="word-spacing:-0.1426em;">&nbsp;e</span><span class="stl_10 stl_11 stl_548" style="word-spacing:-0.1426em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:12.1575em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.26em;">len ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">8.2. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">压缩双链表的具体实现 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">63 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:10.4132em;"><span class="stl_58 stl_59 stl_152" style="word-spacing:0.2657em;">/ q</span><span class="stl_58 stl_59 stl_152" style="word-spacing:0.3069em;">&nbsp;</span><span class="stl_17 stl_18 stl_152" style="word-spacing:0.3069em;">指</span><span class="stl_17 stl_18 stl_152" style="word-spacing:-0.2633em;">&nbsp;向</span><span class="stl_17 stl_18 stl_152" style="word-spacing:0.3438em;">&nbsp;</span><span class="stl_58 stl_59 stl_152" style="word-spacing:0.3438em;">data &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.9208em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2873em;">q = p +</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.415em;">&nbsp;p</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.097em;">&nbsp;r</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.096em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.097em;">&nbsp;v</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.096em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.097em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.096em;">&nbsp;n</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.097em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.096em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.097em;">&nbsp;z</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.096em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4225em;">&nbsp;+ l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.079em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.08em;">&nbsp;n</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.08em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.079em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.08em;">&nbsp;z</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.08em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.08em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:10.0375em;"><span class="stl_15 stl_16 stl_549" style="word-spacing:-0.2682em;">i f</span><span class="stl_15 stl_16 stl_549" style="word-spacing:0.4381em;">&nbsp;</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.4381em;">(</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.2073em;">&nbsp;skipcnt</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.1698em;">&nbsp;==</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.1398em;">&nbsp;0)</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.1398em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:12.4057em;"><span class="stl_58 stl_59 stl_550" style="word-spacing:0.2452em;">* Compare</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.3122em;">&nbsp;current</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.3992em;">&nbsp;entry with</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.4392em;">&nbsp;s</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2778em;">&nbsp;p</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2778em;">&nbsp;e</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2778em;">&nbsp;c</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2788em;">&nbsp;i</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2778em;">&nbsp;f</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2778em;">&nbsp;i</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2778em;">&nbsp;e</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2778em;">&nbsp;d</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.4442em;">&nbsp;entry</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.3382em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:12.03em;"><span class="stl_15 stl_16 stl_551" style="word-spacing:-0.1716em;">i f</span><span class="stl_15 stl_16 stl_551" style="word-spacing:0.5348em;">&nbsp;</span><span class="stl_10 stl_11 stl_551" style="word-spacing:0.5348em;">(ZIP_IS_STR(</span><span class="stl_10 stl_11 stl_551" style="word-spacing:-0.1346em;">&nbsp;encoding</span><span class="stl_10 stl_11 stl_551" style="word-spacing:-0.1346em;">&nbsp;)</span><span class="stl_10 stl_11 stl_551" style="word-spacing:-0.1366em;">&nbsp;)</span><span class="stl_10 stl_11 stl_551" style="word-spacing:-0.1366em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">字</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;符</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;串</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;比</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;较 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:14.0225em;"><span class="stl_15 stl_16 stl_552" style="word-spacing:-0.1607em;">i f</span><span class="stl_15 stl_16 stl_552" style="word-spacing:0.5457em;">&nbsp;</span><span class="stl_10 stl_11 stl_552" style="word-spacing:0.5457em;">(</span><span class="stl_10 stl_11 stl_552" style="word-spacing:-0.1007em;">&nbsp;len</span><span class="stl_10 stl_11 stl_552" style="word-spacing:0.267em;">&nbsp;== vlen &amp;&amp;</span><span class="stl_10 stl_11 stl_552" style="word-spacing:-0.0167em;">&nbsp;memcmp(q ,</span><span class="stl_10 stl_11 stl_552" style="word-spacing:0.5413em;">&nbsp;vstr</span><span class="stl_10 stl_11 stl_552" style="word-spacing:0.0563em;">&nbsp;,</span><span class="stl_10 stl_11 stl_552" style="word-spacing:0.5433em;">&nbsp;vlen</span><span class="stl_10 stl_11 stl_552" style="word-spacing:-0.1127em;">&nbsp;)</span><span class="stl_10 stl_11 stl_552" style="word-spacing:0.2503em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:16.1231em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.504em;">) { &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:15.9158em;"><span class="stl_15 stl_16 stl_162">return</span><span class="stl_15 stl_16 stl_162" style="word-spacing:0.3154em;">&nbsp;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3154em;">p</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3154em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:15.6225em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 15.6818em; left:13.9175em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 16.6785em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 17.676em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6735em; left:12.9742em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">整</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;比</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;较 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:14.3982em;"><span class="stl_58 stl_59 stl_553" style="word-spacing:0.2798em;">* Find</span><span class="stl_58 stl_59 stl_553" style="word-spacing:0.3248em;">&nbsp;out</span><span class="stl_58 stl_59 stl_553" style="word-spacing:0.4478em;">&nbsp;i</span><span class="stl_58 stl_59 stl_553" style="word-spacing:-0.2582em;">&nbsp;f</span><span class="stl_58 stl_59 stl_553" style="word-spacing:0.4658em;">&nbsp;the</span><span class="stl_58 stl_59 stl_553" style="word-spacing:0.3888em;">&nbsp;searched</span><span class="stl_58 stl_59 stl_553" style="word-spacing:0.4578em;">&nbsp;f</span><span class="stl_58 stl_59 stl_553" style="word-spacing:-0.2602em;">&nbsp;i</span><span class="stl_58 stl_59 stl_553" style="word-spacing:-0.2602em;">&nbsp;e</span><span class="stl_58 stl_59 stl_553" style="word-spacing:-0.2602em;">&nbsp;l</span><span class="stl_58 stl_59 stl_553" style="word-spacing:-0.2602em;">&nbsp;d</span><span class="stl_58 stl_59 stl_553" style="word-spacing:0.4068em;">&nbsp;can</span><span class="stl_58 stl_59 stl_553" style="word-spacing:0.3068em;">&nbsp;be &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:15.6117em;"><span class="stl_58 stl_59 stl_452" style="word-spacing:-0.2105em;">encoded .</span><span class="stl_58 stl_59 stl_452" style="word-spacing:0.3675em;">&nbsp;Note</span><span class="stl_58 stl_59 stl_452" style="word-spacing:0.3675em;">&nbsp;that &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 22.6576em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 20.6651em; left:15.3905em;"><span class="stl_58 stl_59 stl_554" style="word-spacing:0.2609em;">we do</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.4229em;">&nbsp;i</span><span class="stl_58 stl_59 stl_554" style="word-spacing:-0.2361em;">&nbsp;t</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.4809em;">&nbsp;only</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.4179em;">&nbsp;the</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.5049em;">&nbsp;f</span><span class="stl_58 stl_59 stl_554" style="word-spacing:-0.2191em;">&nbsp;i</span><span class="stl_58 stl_59 stl_554" style="word-spacing:-0.2191em;">&nbsp;r</span><span class="stl_58 stl_59 stl_554" style="word-spacing:-0.2201em;">&nbsp;s</span><span class="stl_58 stl_59 stl_554" style="word-spacing:-0.2191em;">&nbsp;t</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.4619em;">&nbsp;time</span><span class="stl_58 stl_59 stl_554" style="word-spacing:-0.1151em;">&nbsp;,</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.4049em;">&nbsp;once</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.3289em;">&nbsp;done &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:16.1258em;"><span class="stl_58 stl_59 stl_341" style="word-spacing:0.3918em;">vencoding i</span><span class="stl_58 stl_59 stl_341" style="word-spacing:-0.3192em;">&nbsp;s</span><span class="stl_58 stl_59 stl_341" style="word-spacing:0.4308em;">&nbsp;s</span><span class="stl_58 stl_59 stl_341" style="word-spacing:-0.3302em;">&nbsp;et &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:15.4686em;z-index:297; "><span class="stl_58 stl_59 stl_73" style="word-spacing:0.3157em;">to non</span><span class="stl_107 stl_108 stl_73" style="word-spacing:0.3157em;">−</span><span class="stl_58 stl_59 stl_73" style="word-spacing:0.3157em;">zero and</span><span class="stl_58 stl_59 stl_73" style="word-spacing:0.4138em;">&nbsp;v</span><span class="stl_58 stl_59 stl_73" style="word-spacing:-0.2403em;">&nbsp;l</span><span class="stl_58 stl_59 stl_73" style="word-spacing:-0.2403em;">&nbsp;l</span><span class="stl_58 stl_59 stl_73" style="word-spacing:0.5207em;">&nbsp;i</span><span class="stl_58 stl_59 stl_73" style="word-spacing:-0.2862em;">&nbsp;s</span><span class="stl_58 stl_59 stl_73" style="word-spacing:0.4637em;">&nbsp;s</span><span class="stl_58 stl_59 stl_73" style="word-spacing:-0.2972em;">&nbsp;et</span><span class="stl_58 stl_59 stl_73" style="word-spacing:0.4147em;">&nbsp;to the i</span><span class="stl_58 stl_59 stl_73" style="word-spacing:-0.2972em;">&nbsp;n</span><span class="stl_58 stl_59 stl_73" style="word-spacing:-0.2973em;">&nbsp;teger &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:16.1417em;z-index:330; "><span class="stl_58 stl_59 stl_91" style="word-spacing:-0.2044em;">value .</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.3256em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:14.0225em;"><span class="stl_15 stl_16 stl_289" style="word-spacing:-0.2374em;">i f</span><span class="stl_15 stl_16 stl_289" style="word-spacing:0.469em;">&nbsp;</span><span class="stl_10 stl_11 stl_289" style="word-spacing:0.469em;">(</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2044em;">&nbsp;vencoding</span><span class="stl_10 stl_11 stl_289" style="word-spacing:0.1711em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_289" style="word-spacing:0.1711em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:15.9175em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:16.3907em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">尝</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;试</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;将</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6057em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6057em;">v</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.095em;">&nbsp;s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.094em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.095em;">&nbsp;r</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6059em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6059em;">解</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;析</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;整</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.636em; left:16.015em;"><span class="stl_15 stl_16 stl_555" style="word-spacing:-0.2747em;">i f</span><span class="stl_15 stl_16 stl_555" style="word-spacing:0.5039em;">&nbsp;</span><span class="stl_10 stl_11 stl_555" style="word-spacing:0.5039em;">(</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.2737em;">&nbsp;!</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.1787em;">&nbsp;zipTryEncoding</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.2507em;">&nbsp;(</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.2297em;">&nbsp;vstr</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.0577em;">&nbsp;,</span><span class="stl_10 stl_11 stl_555" style="word-spacing:0.4093em;">&nbsp;vlen</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.0917em;">&nbsp;,</span><span class="stl_10 stl_11 stl_555" style="word-spacing:0.2213em;">&nbsp;&amp;vll</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.0037em;">&nbsp;,</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.0037em;">&nbsp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:17.615em;"><span class="stl_10 stl_11 stl_556" style="word-spacing:-0.2485em;">vencoding )</span><span class="stl_10 stl_11 stl_556" style="word-spacing:-0.2465em;">&nbsp;)</span><span class="stl_10 stl_11 stl_556" style="word-spacing:-0.2465em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:17.91em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:18.3832em;"><span class="stl_58 stl_59 stl_557" style="word-spacing:0.386em;">* I</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.273em;">&nbsp;f</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.452em;">&nbsp;the</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.405em;">&nbsp;entry</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.348em;">&nbsp;can</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.18em;">&nbsp;’</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.211em;">&nbsp;t</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.386em;">&nbsp;be</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.342em;">&nbsp;encoded</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.274em;">&nbsp;we &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:19.6458em;"><span class="stl_58 stl_59 stl_558" style="word-spacing:0.4073em;">set i</span><span class="stl_58 stl_59 stl_558" style="word-spacing:-0.3417em;">&nbsp;t</span><span class="stl_58 stl_59 stl_558" style="word-spacing:0.3773em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:18.3958em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 30.6276em; left:19.2385em;"><span class="stl_58 stl_59 stl_486" style="word-spacing:0.2893em;">UCHAR_MAX so</span><span class="stl_58 stl_59 stl_486" style="word-spacing:0.5733em;">&nbsp;that</span><span class="stl_58 stl_59 stl_486" style="word-spacing:0.5063em;">&nbsp;we</span><span class="stl_58 stl_59 stl_486" style="word-spacing:0.4163em;">&nbsp;don</span><span class="stl_58 stl_59 stl_486" style="word-spacing:-0.0127em;">&nbsp;’</span><span class="stl_58 stl_59 stl_486" style="word-spacing:-0.0317em;">&nbsp;t</span><span class="stl_58 stl_59 stl_486" style="word-spacing:0.6183em;">&nbsp;retry &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:20.1092em;"><span class="stl_58 stl_59 stl_443" style="word-spacing:0.3583em;">again the next &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:18.3958em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 32.6201em; left:19.4353em;"><span class="stl_58 stl_59 stl_264" style="word-spacing:-0.182em;">time .</span><span class="stl_58 stl_59 stl_264" style="word-spacing:0.38em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:17.91em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:18.3832em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">不</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;能</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;编</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;码</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.08em;">&nbsp;字 ！</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.09em;">&nbsp;！</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.089em;">&nbsp;！</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.04em;">&nbsp;会 导</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;致</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;当</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;前</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;查</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;找 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.8332em; left:19.6042em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">的 数 据 项 被 跳 过 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:17.9467em;"><span class="stl_10 stl_11 stl_559" style="word-spacing:0.4046em;">vencoding =</span><span class="stl_10 stl_11 stl_559" style="word-spacing:0.1536em;">&nbsp;UCHAR_MAX; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:15.91em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.601em; left:15.9175em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:16.3907em;z-index:552; "><span class="stl_58 stl_59 stl_560" style="word-spacing:0.3613em;">* Must be non</span><span class="stl_107 stl_108 stl_560" style="word-spacing:0.3613em;">−</span><span class="stl_58 stl_59 stl_560" style="word-spacing:0.3613em;">zero</span><span class="stl_58 stl_59 stl_560" style="word-spacing:0.4423em;">&nbsp;by</span><span class="stl_58 stl_59 stl_560" style="word-spacing:0.3258em;">&nbsp;now</span><span class="stl_58 stl_59 stl_560" style="word-spacing:0.3258em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:15.9975em;"><span class="stl_10 stl_11 stl_556" style="word-spacing:-0.2662em;">a s s e r t ( vencoding ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:13.9175em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 41.586em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:14.3982em;"><span class="stl_58 stl_59 stl_557" style="word-spacing:0.2491em;">* Compare</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.3151em;">&nbsp;current</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.4026em;">&nbsp;entry with</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.4421em;">&nbsp;s</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.2749em;">&nbsp;p</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.2749em;">&nbsp;e</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.2749em;">&nbsp;c</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.2759em;">&nbsp;i</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.2749em;">&nbsp;f</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.2749em;">&nbsp;i</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.2749em;">&nbsp;e</span><span class="stl_58 stl_59 stl_557" style="word-spacing:-0.2749em;">&nbsp;d</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.4301em;">&nbsp;entry &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:15.6575em;"><span class="stl_58 stl_59 stl_07">,</span></div>
					<div class="stl_01" style="top: 42.5826em; left:16.5816em;"><span class="stl_58 stl_59 stl_561" style="word-spacing:0.391em;">do i</span><span class="stl_58 stl_59 stl_561" style="word-spacing:-0.268em;">&nbsp;t</span><span class="stl_58 stl_59 stl_561" style="word-spacing:0.449em;">&nbsp;only &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 45.5718em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 43.5793em; left:15.5317em;"><span class="stl_58 stl_59 stl_562" style="word-spacing:-0.1301em;">i f</span><span class="stl_58 stl_59 stl_562" style="word-spacing:0.5799em;">&nbsp;vencoding</span><span class="stl_58 stl_59 stl_562" style="word-spacing:0.4269em;">&nbsp;!=</span><span class="stl_58 stl_59 stl_562" style="word-spacing:0.1759em;">&nbsp;UCHAR_MAX</span><span class="stl_58 stl_59 stl_562" style="word-spacing:0.2459em;">&nbsp;because</span><span class="stl_58 stl_59 stl_562" style="word-spacing:0.5829em;">&nbsp;i</span><span class="stl_58 stl_59 stl_562" style="word-spacing:-0.1311em;">&nbsp;f</span><span class="stl_58 stl_59 stl_562" style="word-spacing:0.6049em;">&nbsp;there &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:16.6667em;"><span class="stl_58 stl_59 stl_563" style="word-spacing:-0.2885em;">i s</span><span class="stl_58 stl_59 stl_563" style="word-spacing:0.3555em;">&nbsp;no</span><span class="stl_58 stl_59 stl_563" style="word-spacing:0.3015em;">&nbsp;encoding &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:15.5059em;"><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3017em;">p o</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3017em;">&nbsp;s</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3017em;">&nbsp;s</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3007em;">&nbsp;i</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3017em;">&nbsp;b</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3017em;">&nbsp;l</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3017em;">&nbsp;e</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.4293em;">&nbsp;for the f</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2727em;">&nbsp;i</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2717em;">&nbsp;e</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2727em;">&nbsp;l</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2727em;">&nbsp;d</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.5143em;">&nbsp;i</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2787em;">&nbsp;t</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.3883em;">&nbsp;can</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2027em;">&nbsp;’</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2347em;">&nbsp;t</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.3623em;">&nbsp;be</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.2723em;">&nbsp;a</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.3373em;">&nbsp;v</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3057em;">&nbsp;a</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3067em;">&nbsp;l</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3067em;">&nbsp;i</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3067em;">&nbsp;d &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:16.6567em;"><span class="stl_58 stl_59 stl_564" style="word-spacing:-0.369em;">in teger</span><span class="stl_58 stl_59 stl_564" style="word-spacing:-0.223em;">&nbsp;.</span><span class="stl_58 stl_59 stl_564" style="word-spacing:0.287em;">&nbsp;*/ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">64 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:21.1633em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 8.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">ZIPLIST &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:14.0225em;"><span class="stl_15 stl_16 stl_565" style="word-spacing:-0.036em;">i f</span><span class="stl_15 stl_16 stl_565" style="word-spacing:0.6704em;">&nbsp;</span><span class="stl_10 stl_11 stl_565" style="word-spacing:0.6704em;">(</span><span class="stl_10 stl_11 stl_565" style="word-spacing:-0.003em;">&nbsp;vencoding</span><span class="stl_10 stl_11 stl_565" style="word-spacing:0.539em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_565" style="word-spacing:0.289em;">&nbsp;UCHAR_MAX)</span><span class="stl_10 stl_11 stl_565" style="word-spacing:0.289em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:16.3907em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">读</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;整</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:15.9167em;"><span class="stl_15 stl_16 stl_566" style="word-spacing:0.2568em;">long long</span><span class="stl_15 stl_16 stl_566" style="word-spacing:0.4126em;">&nbsp;</span><span class="stl_10 stl_11 stl_566" style="word-spacing:0.4126em;">l</span><span class="stl_10 stl_11 stl_566" style="word-spacing:-0.2452em;">&nbsp;l</span><span class="stl_10 stl_11 stl_566" style="word-spacing:0.2648em;">&nbsp;=</span><span class="stl_10 stl_11 stl_566" style="word-spacing:-0.0564em;">&nbsp;zipLoadInteger (q</span><span class="stl_10 stl_11 stl_566" style="word-spacing:-0.2512em;">&nbsp;,</span><span class="stl_10 stl_11 stl_566" style="word-spacing:0.4088em;">&nbsp;encoding &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:15.9175em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7076em; left:17.6167em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 8.7076em; left:18.1605em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:16.015em;"><span class="stl_15 stl_16 stl_567" style="word-spacing:0.162em;">i f</span><span class="stl_15 stl_16 stl_567" style="word-spacing:0.8684em;">&nbsp;</span><span class="stl_10 stl_11 stl_567" style="word-spacing:0.8684em;">(</span><span class="stl_10 stl_11 stl_567" style="word-spacing:0.306em;">&nbsp;l</span><span class="stl_10 stl_11 stl_567" style="word-spacing:0.201em;">&nbsp;l</span><span class="stl_10 stl_11 stl_567" style="word-spacing:0.6635em;">&nbsp;== v</span><span class="stl_10 stl_11 stl_567" style="word-spacing:0.165em;">&nbsp;l l</span><span class="stl_10 stl_11 stl_567" style="word-spacing:0.271em;">&nbsp;)</span><span class="stl_10 stl_11 stl_567" style="word-spacing:0.271em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:17.9083em;"><span class="stl_15 stl_16 stl_162">return</span><span class="stl_15 stl_16 stl_162" style="word-spacing:0.3154em;">&nbsp;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3154em;">p</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3154em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:15.91em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 12.6927em; left:13.9175em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.6893em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6835em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:12.4057em;"><span class="stl_58 stl_59 stl_568" style="word-spacing:0.2957em;">* Reset</span><span class="stl_58 stl_59 stl_568" style="word-spacing:0.3782em;">&nbsp;skip count</span><span class="stl_58 stl_59 stl_568" style="word-spacing:0.2937em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:11.9925em;"><span class="stl_10 stl_11 stl_569" style="word-spacing:0.1299em;">skipcnt = skip</span><span class="stl_10 stl_11 stl_569" style="word-spacing:0.1299em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 20.6635em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 17.6693em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6668em; left:11.9808em;"><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.1928em;">skipcnt </span><span class="stl_107 stl_108 stl_570" style="word-spacing:-0.1928em;">−−</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.1928em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:12.4057em;"><span class="stl_58 stl_59 stl_571" style="word-spacing:0.2993em;">* Skip</span><span class="stl_58 stl_59 stl_571" style="word-spacing:0.3633em;">&nbsp;entry</span><span class="stl_58 stl_59 stl_571" style="word-spacing:0.3113em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">移</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;动</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6589em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6589em;">z</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.042em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.041em;">&nbsp;p</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.041em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.042em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.041em;">&nbsp;s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.041em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6584em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6584em;">的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;下</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;项 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:10.4132em;"><span class="stl_58 stl_59 stl_572" style="word-spacing:0.2458em;">* Move</span><span class="stl_58 stl_59 stl_572" style="word-spacing:0.3058em;">&nbsp;to</span><span class="stl_58 stl_59 stl_572" style="word-spacing:0.4103em;">&nbsp;next entry</span><span class="stl_58 stl_59 stl_572" style="word-spacing:0.3558em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:9.9092em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:0.021em;">p =</span><span class="stl_10 stl_11 stl_72" style="word-spacing:0.036em;">&nbsp;q +</span><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.0445em;">&nbsp;len</span><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.0445em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 27.6385em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">没</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;找</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6285em; left:7.9458em;"><span class="stl_15 stl_16 stl_186" style="word-spacing:0.3002em;">return </span><span class="stl_10 stl_11 stl_186" style="word-spacing:0.3002em;">NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 31.3465em; left:7.5658em;z-index:258; "><span class="stl_17 stl_18 stl_07">》</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.749em;">&nbsp;</span><span class="stl_17 stl_18 stl_573">》》》</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_573">》》</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_573">》》</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_573">》》</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_07">》</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.75em;">&nbsp;</span><span class="stl_17 stl_18 stl_573">》》 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_15.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_15.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9805em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 9 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.7973em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.125em;">数据结构 </span><span class="stl_12 stl_13 stl_07" style="word-spacing:0.125em;">skiplist &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6591em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">9</span></div>
					<div class="stl_01" style="top: 20.6591em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">概述 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.0076em; left:7.5658em;"><span class="stl_17 stl_18 stl_26">跳表（</span><span class="stl_10 stl_11 stl_26">skiplist</span><span class="stl_17 stl_18 stl_26">）是一个特俗的链表，相比一般的链表，有更高的查找效率，其效 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.2265em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">率可比拟于二叉查找树。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.279em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">一张关于跳表和跳表搜索过程如下图： &nbsp;</span></div>
					<div class="stl_01" style="top: 37.3327em; left:7.5658em;"><span class="stl_17 stl_18 stl_574" style="word-spacing:0.0868em;">在图中，需要寻找 </span><span class="stl_10 stl_11 stl_574" style="word-spacing:0.0868em;">68</span><span class="stl_17 stl_18 stl_574" style="word-spacing:0.0868em;">，在给出的查找过程中，利用跳表数据结构优势，只比较了 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5507em; left:6.6042em;"><span class="stl_17 stl_18 stl_575">次，横箭头不比较，竖箭头比较。由此可见，跳表预先间隔地保存了有序链表中的 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5473em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">节点，从而在查找过程中能达到类似于二分搜索的效果，而二分搜索思想就是通过比 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5432em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">较中点数据放弃另一半的查找，从而节省一半的查找时间。 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.3285em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 42.5923em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">缺点即浪费了空间，自古空间和时间两难全。 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:7.5658em;"><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0803em;">插播一段：跳表在 </span><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0803em;">1990 </span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0803em;">年由 </span><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0803em;">William Pugh </span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0803em;">提出，而红黑树早在 </span><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0803em;">1972 </span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0803em;">年由鲁道 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.6382em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">夫·贝尔发明了。红黑树在空间和时间效率上略胜跳表一筹，但跳表实现相对简单得 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_17 stl_18 stl_576" style="word-spacing:0.0846em;">到程序猿们的青睐。</span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.0846em;">redis </span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.0846em;">和 </span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.0846em;">leveldb </span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.0846em;">中都有采用跳表。 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">6</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">5</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_16.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_16.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">66 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:20.5625em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 9.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.082em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">SKIPLIST &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">这篇文章，借着 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">的源码了解跳表的实现。 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.0666em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">9</span></div>
					<div class="stl_01" style="top: 9.0666em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.2 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">跳表的数据结构 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.7532em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">从上图中，总结跳表的性质： &nbsp;</span></div>
					<div class="stl_01" style="top: 24.3785em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 26.0601em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 27.7418em; left:6.92em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 29.4226em; left:6.92em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 31.1043em; left:6.92em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 24.3785em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">由很多层结构组成 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.0601em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">每一层都是一个有序的链表 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.7418em; left:7.3351em;"><span class="stl_10 stl_11 stl_243">.</span><span class="stl_10 stl_11 stl_243" style="word-spacing:0.2532em;">&nbsp;</span><span class="stl_17 stl_18 stl_243" style="word-spacing:0.2532em;">最底层</span><span class="stl_17 stl_18 stl_243" style="word-spacing:0.0862em;">&nbsp;</span><span class="stl_10 stl_11 stl_243" style="word-spacing:0.0862em;">(Level 1)</span><span class="stl_10 stl_11 stl_243" style="word-spacing:0.0872em;">&nbsp;</span><span class="stl_17 stl_18 stl_243" style="word-spacing:0.0872em;">的链表包含所有元素 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4226em; left:7.3351em;"><span class="stl_10 stl_11 stl_243">.</span><span class="stl_10 stl_11 stl_243" style="word-spacing:0.2533em;">&nbsp;</span><span class="stl_17 stl_18 stl_243" style="word-spacing:0.2533em;">如果一个元素出现在</span><span class="stl_17 stl_18 stl_243" style="word-spacing:0.0858em;">&nbsp;</span><span class="stl_10 stl_11 stl_243" style="word-spacing:0.0858em;">Level i</span><span class="stl_10 stl_11 stl_243" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_243" style="word-spacing:0.0865em;">的链表中，则它在</span><span class="stl_17 stl_18 stl_243" style="word-spacing:0.0855em;">&nbsp;</span><span class="stl_10 stl_11 stl_243" style="word-spacing:0.0855em;">Level i</span><span class="stl_10 stl_11 stl_243" style="word-spacing:0.0855em;">&nbsp;</span><span class="stl_17 stl_18 stl_243" style="word-spacing:0.0855em;">之下的链表也都会出现。 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.1043em; left:7.3351em;"><span class="stl_10 stl_11 stl_577" style="word-spacing:0.2202em;">. </span><span class="stl_17 stl_18 stl_577" style="word-spacing:0.2202em;">每个节点包含两个指针，一个指向同一链表中的下一个元素，一个指向下面一 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.3232em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">层的元素。 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.9485em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">中跳表数据结构定义： &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4518em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.4476em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.4518em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">跳</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;节</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;点</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;体 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:6.4282em;"><span class="stl_58 stl_59 stl_578" style="word-spacing:0.2416em;">* ZSETs</span><span class="stl_58 stl_59 stl_578" style="word-spacing:0.2806em;">&nbsp;use</span><span class="stl_58 stl_59 stl_578" style="word-spacing:0.3216em;">&nbsp;a</span><span class="stl_58 stl_59 stl_578" style="word-spacing:0.3906em;">&nbsp;s</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2554em;">&nbsp;p</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2544em;">&nbsp;e</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2554em;">&nbsp;c</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2544em;">&nbsp;i</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2544em;">&nbsp;a</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2554em;">&nbsp;l</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2544em;">&nbsp;i</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2554em;">&nbsp;z</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2544em;">&nbsp;e</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2554em;">&nbsp;d</span><span class="stl_58 stl_59 stl_578" style="word-spacing:0.4696em;">&nbsp;version of S</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2364em;">&nbsp;k</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2374em;">&nbsp;i</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2364em;">&nbsp;p</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2364em;">&nbsp;l</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2374em;">&nbsp;i</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2364em;">&nbsp;s</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2364em;">&nbsp;t</span><span class="stl_58 stl_59 stl_578" style="word-spacing:-0.2364em;">&nbsp;s</span><span class="stl_58 stl_59 stl_578" style="word-spacing:0.4226em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4377em; left:5.9533em;"><span class="stl_15 stl_16 stl_579" style="word-spacing:0.279em;">typedef struct</span><span class="stl_15 stl_16 stl_579" style="word-spacing:0.3647em;">&nbsp;</span><span class="stl_10 stl_11 stl_579" style="word-spacing:0.3647em;">zskiplistNode</span><span class="stl_10 stl_11 stl_579" style="word-spacing:0.3647em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.4401em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">节</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;点</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4352em; left:8.005em;"><span class="stl_10 stl_11 stl_580" style="word-spacing:-0.0476em;">robj * obj</span><span class="stl_10 stl_11 stl_580" style="word-spacing:-0.0476em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4293em; left:8.4207em;"><span class="stl_58 stl_59 stl_581">/</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.0422em;">&nbsp;</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.0422em;">分 数，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;游</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;戏</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;分</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.283em;">&nbsp;数？</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;按</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;游</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;戏</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;分</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;数</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;排</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;序 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4185em; left:7.9292em;"><span class="stl_15 stl_16 stl_582">double</span><span class="stl_15 stl_16 stl_582" style="word-spacing:0.3611em;">&nbsp;</span><span class="stl_10 stl_11 stl_582" style="word-spacing:0.3611em;">score</span><span class="stl_10 stl_11 stl_582" style="word-spacing:0.3611em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">后</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;驱</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4077em; left:7.9725em;"><span class="stl_15 stl_16 stl_583">struct</span><span class="stl_15 stl_16 stl_583" style="word-spacing:0.3633em;">&nbsp;</span><span class="stl_10 stl_11 stl_583" style="word-spacing:0.3633em;">zskiplistNode</span><span class="stl_10 stl_11 stl_583" style="word-spacing:0.3235em;">&nbsp;*backward</span><span class="stl_10 stl_11 stl_583" style="word-spacing:0.3235em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_17.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_17.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">9.3. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">跳表的插入 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">67 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_584">/</span><span class="stl_58 stl_59 stl_584" style="word-spacing:0.7511em;">&nbsp;</span><span class="stl_17 stl_18 stl_584" style="word-spacing:0.7511em;">前</span><span class="stl_17 stl_18 stl_584" style="word-spacing:0.1911em;">&nbsp;驱 指 针 数 组</span><span class="stl_17 stl_18 stl_584" style="word-spacing:0.5704em;">&nbsp;</span><span class="stl_58 stl_59 stl_584" style="word-spacing:0.5704em;">TODO &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:7.9725em;"><span class="stl_15 stl_16 stl_585">struct</span><span class="stl_15 stl_16 stl_585" style="word-spacing:0.4306em;">&nbsp;</span><span class="stl_10 stl_11 stl_585" style="word-spacing:0.4306em;">z</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2602em;">&nbsp;s</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2602em;">&nbsp;k</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2592em;">&nbsp;i</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2602em;">&nbsp;p</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2592em;">&nbsp;l</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2602em;">&nbsp;i</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2592em;">&nbsp;s</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2602em;">&nbsp;t</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2592em;">&nbsp;L</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2602em;">&nbsp;e</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2592em;">&nbsp;v</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2602em;">&nbsp;e</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2592em;">&nbsp;l</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2592em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:9.965em;"><span class="stl_15 stl_16 stl_540">struct</span><span class="stl_15 stl_16 stl_540" style="word-spacing:0.3407em;">&nbsp;</span><span class="stl_10 stl_11 stl_540" style="word-spacing:0.3407em;">zskiplistNode</span><span class="stl_10 stl_11 stl_540" style="word-spacing:-0.0381em;">&nbsp;* forward</span><span class="stl_10 stl_11 stl_540" style="word-spacing:-0.0381em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;下</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;项</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;需</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;要</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;走</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;多</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;少</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:9.925em;"><span class="stl_15 stl_16 stl_586" style="word-spacing:0.3702em;">unsigned int</span><span class="stl_15 stl_16 stl_586" style="word-spacing:0.4082em;">&nbsp;</span><span class="stl_10 stl_11 stl_586" style="word-spacing:0.4082em;">span</span><span class="stl_10 stl_11 stl_586" style="word-spacing:0.4082em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:7.9392em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.571em;">} l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.078em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.079em;">&nbsp;v</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.079em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.078em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.163em;">&nbsp;[</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.009em;">&nbsp;]</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.009em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.021em;"><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.2322em;">zskiplistNode ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 14.681em; left:5.9533em;"><span class="stl_15 stl_16 stl_588" style="word-spacing:0.3535em;">typedef struct</span><span class="stl_15 stl_16 stl_588" style="word-spacing:0.4812em;">&nbsp;</span><span class="stl_10 stl_11 stl_588" style="word-spacing:0.4812em;">z</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2085em;">&nbsp;s</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2085em;">&nbsp;k</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2085em;">&nbsp;i</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2085em;">&nbsp;p</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2075em;">&nbsp;l</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2085em;">&nbsp;i</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2085em;">&nbsp;s</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2085em;">&nbsp;t</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2085em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">跳</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;头</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;尾</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:7.9725em;"><span class="stl_15 stl_16 stl_170">struct</span><span class="stl_15 stl_16 stl_170" style="word-spacing:0.3444em;">&nbsp;</span><span class="stl_10 stl_11 stl_170" style="word-spacing:0.3444em;">zskiplistNode</span><span class="stl_10 stl_11 stl_170" style="word-spacing:0.3047em;">&nbsp;*header</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.1513em;">&nbsp;,</span><span class="stl_10 stl_11 stl_170" style="word-spacing:0.3217em;">&nbsp;*</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.2483em;">&nbsp;t</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.2983em;">&nbsp;a</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.2983em;">&nbsp;i</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.2983em;">&nbsp;l</span><span class="stl_10 stl_11 stl_170" style="word-spacing:-0.2983em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">跳</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:7.9325em;"><span class="stl_15 stl_16 stl_589" style="word-spacing:0.3039em;">unsigned long</span><span class="stl_15 stl_16 stl_589" style="word-spacing:0.3883em;">&nbsp;</span><span class="stl_10 stl_11 stl_589" style="word-spacing:0.3883em;">length</span><span class="stl_10 stl_11 stl_589" style="word-spacing:0.3883em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.661em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">跳</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;高</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.4231em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4231em;">l</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.276em;">&nbsp;e</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.275em;">&nbsp;v</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.276em;">&nbsp;e</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.276em;">&nbsp;l</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.276em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6518em; left:7.0559em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">z s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;k</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;p</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.063em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.2626em; left:7.5658em;"><span class="stl_17 stl_18 stl_590" style="word-spacing:0.0832em;">特别的，在上图中似乎每个数据都被保存了多次，其实只保存了一次。在 </span><span class="stl_10 stl_11 stl_590" style="word-spacing:0.0832em;">struct &nbsp;</span></div>
					<div class="stl_01" style="top: 26.2593em; left:5.9058em;z-index:309; "><span class="stl_10 stl_11 stl_35" style="word-spacing:0.0623em;">zskiplistNode </span><span class="stl_17 stl_18 stl_35" style="word-spacing:0.0623em;">中数据和指针是分开存储的，</span><span class="stl_10 stl_11 stl_35" style="word-spacing:0.0623em;">struct zskiplistLevel </span><span class="stl_17 stl_18 stl_35" style="word-spacing:0.0623em;">即是一个描述跳表层 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4773em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">级的数据结构。 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.7849em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">9</span></div>
					<div class="stl_01" style="top: 29.7849em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.3 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">跳表的插入 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.1002em; left:7.5658em;"><span class="stl_17 stl_18 stl_509" style="word-spacing:0.0837em;">跳表算法描述如下：找出每一层新插入数据位置的前驱并保存，在 </span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.0837em;">redis </span><span class="stl_17 stl_18 stl_509" style="word-spacing:0.0837em;">中跳表 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.0968em; left:5.9058em;"><span class="stl_17 stl_18 stl_591" style="word-spacing:0.0879em;">插入是根据 </span><span class="stl_10 stl_11 stl_591" style="word-spacing:0.0879em;">score/member </span><span class="stl_17 stl_18 stl_591" style="word-spacing:0.0879em;">的大小（看不懂可以参看 </span><span class="stl_10 stl_11 stl_591" style="word-spacing:0.0879em;">redis ZADD </span><span class="stl_17 stl_18 stl_591" style="word-spacing:0.0879em;">命令）来决定插入 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.0927em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">的位置；将新数据插入到指定位置，并调整指针，在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">中还会调整 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">span</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.1243em; left:7.5658em;"><span class="stl_17 stl_18 stl_416" style="word-spacing:0.0835em;">什么是 </span><span class="stl_10 stl_11 stl_416" style="word-spacing:0.0835em;">span</span><span class="stl_17 stl_18 stl_416" style="word-spacing:0.0835em;">？ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_19.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_19.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">6</span></div>
					<div class="stl_01" style="top: 6.7151em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 3.3893em; left:6.321em;"><span class="stl_10 stl_11 stl_07">8</span></div>
					<div class="stl_01" style="top: 3.3893em; left:20.5625em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 9.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.082em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">SKIPLIST &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.5658em;"><span class="stl_10 stl_11 stl_64" style="word-spacing:0.085em;">span </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.085em;">即从两个相邻节点间隔了多少节点。譬如 </span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.085em;">level 1</span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.085em;">，</span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.085em;">-1 </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.085em;">的 </span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.085em;">span </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.085em;">就是 </span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.085em;">1</span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.085em;">；</span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.085em;">level &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:6.3208em;"><span class="stl_17 stl_18 stl_416" style="word-spacing:0.0831em;">，</span><span class="stl_10 stl_11 stl_416" style="word-spacing:0.0831em;">-1 </span><span class="stl_17 stl_18 stl_416" style="word-spacing:0.0831em;">的 </span><span class="stl_10 stl_11 stl_416" style="word-spacing:0.0831em;">span </span><span class="stl_17 stl_18 stl_416" style="word-spacing:0.0831em;">为 </span><span class="stl_10 stl_11 stl_416" style="word-spacing:0.0831em;">2</span><span class="stl_17 stl_18 stl_416" style="word-spacing:0.0831em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.796em; left:7.5658em;"><span class="stl_17 stl_18 stl_342" style="word-spacing:0.082em;">因为新出入数据的层数是随机的，有两种情况 </span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.082em;">ꢀ </span><span class="stl_17 stl_18 stl_342" style="word-spacing:0.082em;">小于等于原有的层数；</span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.082em;">ꢀ </span><span class="stl_17 stl_18 stl_342" style="word-spacing:0.082em;">大于原 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.0148em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">有的层数。需要做特殊处理。 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.0948em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">）小于等于原有的层数 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.8726em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 21.8351em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">中跳表插入算法的具体实现： &nbsp;</span></div>
					<div class="stl_01" style="top: 24.4893em; left:6.025em;"><span class="stl_10 stl_11 stl_592" style="word-spacing:0.3101em;">zskiplistNode *</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2599em;">&nbsp;z</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.3089em;">&nbsp;s</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.3089em;">&nbsp;l</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.3089em;">&nbsp;I</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.3089em;">&nbsp;n</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.3089em;">&nbsp;s</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.3099em;">&nbsp;e</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.3089em;">&nbsp;r</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.3089em;">&nbsp;t</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2039em;">&nbsp;(</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.1919em;">&nbsp;z</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2979em;">&nbsp;s</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2979em;">&nbsp;k</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2979em;">&nbsp;i</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2979em;">&nbsp;p</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2979em;">&nbsp;l</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2969em;">&nbsp;i</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2979em;">&nbsp;s</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2979em;">&nbsp;t</span><span class="stl_10 stl_11 stl_592" style="word-spacing:0.3521em;">&nbsp;*</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.2969em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.0489em;">&nbsp;,</span><span class="stl_10 stl_11 stl_592" style="word-spacing:0.3137em;">&nbsp;</span><span class="stl_15 stl_16 stl_592" style="word-spacing:0.3137em;">double</span><span class="stl_15 stl_16 stl_592" style="word-spacing:0.2719em;">&nbsp;</span><span class="stl_10 stl_11 stl_592" style="word-spacing:0.2719em;">score</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.0869em;">&nbsp;,</span><span class="stl_10 stl_11 stl_592" style="word-spacing:0.4071em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_592" style="word-spacing:0.4071em;">&nbsp;* &nbsp;</span></div>
					<div class="stl_01" style="top: 25.491em; left:7.6567em;"><span class="stl_10 stl_11 stl_579" style="word-spacing:-0.254em;">obj )</span><span class="stl_10 stl_11 stl_579" style="word-spacing:-0.254em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4868em; left:8.0175em;"><span class="stl_10 stl_11 stl_343" style="word-spacing:0.4538em;">zskiplistNode *update</span><span class="stl_10 stl_11 stl_343" style="word-spacing:-0.0932em;">&nbsp;[ZSKIPLIST_MAXLEVEL]</span><span class="stl_10 stl_11 stl_343" style="word-spacing:-0.0182em;">&nbsp;,</span><span class="stl_10 stl_11 stl_343" style="word-spacing:0.4708em;">&nbsp;*x</span><span class="stl_10 stl_11 stl_343" style="word-spacing:0.4708em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4785em; left:7.9325em;"><span class="stl_15 stl_16 stl_287" style="word-spacing:0.4919em;">unsigned int</span><span class="stl_15 stl_16 stl_287" style="word-spacing:0.536em;">&nbsp;</span><span class="stl_10 stl_11 stl_287" style="word-spacing:0.536em;">rank</span><span class="stl_10 stl_11 stl_287" style="word-spacing:-0.0021em;">&nbsp;[ZSKIPLIST_MAXLEVEL</span><span class="stl_10 stl_11 stl_287" style="word-spacing:-0.0861em;">&nbsp;]</span><span class="stl_10 stl_11 stl_287" style="word-spacing:-0.0861em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4743em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.3599em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3599em;">i</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.072em;">&nbsp;,</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.485em;">&nbsp;l</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.275em;">&nbsp;e</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.276em;">&nbsp;v</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.276em;">&nbsp;e</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.275em;">&nbsp;l</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.275em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4718em; left:8.0208em;"><span class="stl_10 stl_11 stl_593" style="word-spacing:-0.2797em;">redisAssert ( ! isnan ( score ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4685em; left:7.9283em;z-index:347; "><span class="stl_10 stl_11 stl_594" style="word-spacing:0.1595em;">x =</span><span class="stl_10 stl_11 stl_594" style="word-spacing:0.2615em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_594" style="word-spacing:-0.2014em;">&nbsp;</span><span class="stl_107 stl_108 stl_594" style="word-spacing:0.2615em;">−</span><span class="stl_10 stl_11 stl_594" style="word-spacing:-0.2014em;">&gt;header</span><span class="stl_10 stl_11 stl_594" style="word-spacing:-0.2014em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.4626em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0386em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0386em;">遍 历</span><span class="stl_17 stl_18 stl_215" style="word-spacing:0.3835em;">&nbsp;</span><span class="stl_58 stl_59 stl_215" style="word-spacing:0.3835em;">s</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.317em;">&nbsp;k</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.317em;">&nbsp;i</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.317em;">&nbsp;p</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.317em;">&nbsp;l</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.317em;">&nbsp;i</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.317em;">&nbsp;s</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.317em;">&nbsp;t</span><span class="stl_58 stl_59 stl_215" style="word-spacing:0.3826em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:0.3826em;">中</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;所</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;有</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;的</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;层，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;找</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;到</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;数</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;据</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;将</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;要</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;插</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;入</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;的</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;位</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;置，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;并</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;保 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4593em; left:9.6417em;"><span class="stl_17 stl_18 stl_595" style="word-spacing:-0.2618em;">存 在</span><span class="stl_17 stl_18 stl_595" style="word-spacing:0.3453em;">&nbsp;</span><span class="stl_58 stl_59 stl_595" style="word-spacing:0.3453em;">update</span><span class="stl_58 stl_59 stl_595" style="word-spacing:0.3447em;">&nbsp;</span><span class="stl_17 stl_18 stl_595" style="word-spacing:0.3453em;">中 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4485em; left:7.9808em;z-index:413; "><span class="stl_15 stl_16 stl_596">for</span><span class="stl_15 stl_16 stl_596" style="word-spacing:0.4269em;">&nbsp;</span><span class="stl_10 stl_11 stl_596" style="word-spacing:0.4269em;">(</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.113em;">&nbsp;i</span><span class="stl_10 stl_11 stl_596" style="word-spacing:0.281em;">&nbsp;= zsl</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.1939em;">&nbsp;</span><span class="stl_107 stl_108 stl_596" style="word-spacing:0.281em;">−</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.1939em;">&gt;level</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.0241em;">&nbsp;</span><span class="stl_107 stl_108 stl_596" style="word-spacing:-0.1939em;">−</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.0241em;">1;</span><span class="stl_10 stl_11 stl_596" style="word-spacing:0.443em;">&nbsp;i</span><span class="stl_10 stl_11 stl_596" style="word-spacing:0.204em;">&nbsp;&gt;=</span><span class="stl_10 stl_11 stl_596" style="word-spacing:0.272em;">&nbsp;0;</span><span class="stl_10 stl_11 stl_596" style="word-spacing:0.469em;">&nbsp;i</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.1935em;">&nbsp;</span><span class="stl_107 stl_108 stl_596" style="word-spacing:-0.1935em;">−−</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.1935em;">)</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.1935em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4518em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.4518em; left:10.4132em;z-index:449; "><span class="stl_58 stl_59 stl_371" style="word-spacing:0.3268em;">* store rank that</span><span class="stl_58 stl_59 stl_371" style="word-spacing:0.4081em;">&nbsp;i</span><span class="stl_58 stl_59 stl_371" style="word-spacing:-0.3339em;">&nbsp;s</span><span class="stl_58 stl_59 stl_371" style="word-spacing:0.3921em;">&nbsp;crossed</span><span class="stl_58 stl_59 stl_371" style="word-spacing:0.3381em;">&nbsp;to reach the</span><span class="stl_58 stl_59 stl_371" style="word-spacing:0.3871em;">&nbsp;i</span><span class="stl_58 stl_59 stl_371" style="word-spacing:-0.3379em;">&nbsp;n</span><span class="stl_58 stl_59 stl_371" style="word-spacing:-0.3379em;">&nbsp;s</span><span class="stl_58 stl_59 stl_371" style="word-spacing:-0.3379em;">&nbsp;e</span><span class="stl_58 stl_59 stl_371" style="word-spacing:-0.3369em;">&nbsp;r</span><span class="stl_58 stl_59 stl_371" style="word-spacing:-0.3369em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:11.6758em;"><span class="stl_58 stl_59 stl_597" style="word-spacing:-0.3632em;">pos i</span><span class="stl_58 stl_59 stl_597" style="word-spacing:-0.3632em;">&nbsp;ti</span><span class="stl_58 stl_59 stl_597" style="word-spacing:-0.3632em;">&nbsp;on</span><span class="stl_58 stl_59 stl_597" style="word-spacing:0.2968em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4427em; left:9.9608em;z-index:491; "><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.1578em;">rank [</span><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.0818em;">&nbsp;i</span><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.0818em;">&nbsp;]</span><span class="stl_10 stl_11 stl_598" style="word-spacing:0.2682em;">&nbsp;= i</span><span class="stl_10 stl_11 stl_598" style="word-spacing:0.2382em;">&nbsp;==</span><span class="stl_10 stl_11 stl_598" style="word-spacing:0.1822em;">&nbsp;(</span><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.1618em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.2183em;">&nbsp;</span><span class="stl_107 stl_108 stl_598" style="word-spacing:-0.1618em;">−</span><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.2183em;">&gt;level</span><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.076em;">&nbsp;</span><span class="stl_107 stl_108 stl_598" style="word-spacing:-0.2183em;">−</span><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.076em;">1)</span><span class="stl_10 stl_11 stl_598" style="word-spacing:0.3017em;">&nbsp;? 0</span><span class="stl_10 stl_11 stl_598" style="word-spacing:0.4247em;">&nbsp;: rank</span><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.1578em;">&nbsp;[</span><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.0818em;">&nbsp;i</span><span class="stl_10 stl_11 stl_598" style="word-spacing:-0.1298em;">&nbsp;+1]; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">链</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;搜</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;索 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:9.9408em;z-index:528; "><span class="stl_15 stl_16 stl_599">while</span><span class="stl_15 stl_16 stl_599" style="word-spacing:0.4174em;">&nbsp;</span><span class="stl_10 stl_11 stl_599" style="word-spacing:0.4174em;">(x</span><span class="stl_107 stl_108 stl_599" style="word-spacing:0.4174em;">−</span><span class="stl_10 stl_11 stl_599" style="word-spacing:0.4174em;">&gt;l</span><span class="stl_10 stl_11 stl_599" style="word-spacing:-0.1781em;">&nbsp;e</span><span class="stl_10 stl_11 stl_599" style="word-spacing:-0.1781em;">&nbsp;v</span><span class="stl_10 stl_11 stl_599" style="word-spacing:-0.1771em;">&nbsp;e</span><span class="stl_10 stl_11 stl_599" style="word-spacing:-0.1781em;">&nbsp;l</span><span class="stl_10 stl_11 stl_599" style="word-spacing:-0.0171em;">&nbsp;[</span><span class="stl_10 stl_11 stl_599" style="word-spacing:-0.0271em;">&nbsp;i</span><span class="stl_10 stl_11 stl_599" style="word-spacing:-0.1071em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_599" style="word-spacing:-0.0301em;">&nbsp;forward</span><span class="stl_10 stl_11 stl_599" style="word-spacing:0.2359em;">&nbsp;&amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:12.4009em;z-index:568; "><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.2268em;">x</span><span class="stl_107 stl_108 stl_530" style="word-spacing:-0.2268em;">−</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.2268em;">&gt;l e</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.2278em;">&nbsp;v</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.2278em;">&nbsp;e</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.2268em;">&nbsp;l</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.0668em;">&nbsp;[</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.0768em;">&nbsp;i</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.0228em;">&nbsp;]</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.1848em;">&nbsp;.</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.0918em;">&nbsp;forward</span><span class="stl_107 stl_108 stl_530" style="word-spacing:-0.0918em;">−</span><span class="stl_10 stl_11 stl_530" style="word-spacing:-0.0918em;">&gt;score</span><span class="stl_10 stl_11 stl_530" style="word-spacing:0.2202em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_530" style="word-spacing:0.2792em;">&nbsp;score</span><span class="stl_10 stl_11 stl_530" style="word-spacing:0.5532em;">&nbsp;|</span><span class="stl_10 stl_11 stl_530" style="word-spacing:0.5532em;">&nbsp;| &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:14.3934em;z-index:603; "><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.1919em;">x</span><span class="stl_107 stl_108 stl_493" style="word-spacing:-0.1919em;">−</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.1919em;">&gt;l e</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.1929em;">&nbsp;v</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.1929em;">&nbsp;e</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.1919em;">&nbsp;l</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.0319em;">&nbsp;[</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.0419em;">&nbsp;i</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.1378em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.0569em;">&nbsp;forward</span><span class="stl_107 stl_108 stl_493" style="word-spacing:-0.0569em;">−</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.0569em;">&gt;score</span><span class="stl_10 stl_11 stl_493" style="word-spacing:0.2548em;">&nbsp;== score</span><span class="stl_10 stl_11 stl_493" style="word-spacing:0.2548em;">&nbsp;&amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:13.9683em;z-index:659; "><span class="stl_10 stl_11 stl_600" style="word-spacing:-0.1672em;">compareStringObjects (x</span><span class="stl_107 stl_108 stl_600" style="word-spacing:-0.1672em;">−</span><span class="stl_10 stl_11 stl_600" style="word-spacing:-0.1672em;">&gt;l e v e l [ i ] . forward</span><span class="stl_107 stl_108 stl_600" style="word-spacing:-0.1672em;">−</span><span class="stl_10 stl_11 stl_600" style="word-spacing:-0.1672em;">&gt;obj &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:11.9708em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 43.4235em; left:13.9633em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 45.416em; left:15.67em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 45.416em; left:16.125em;"><span class="stl_10 stl_11 stl_568" style="word-spacing:-0.2503em;">obj )</span><span class="stl_10 stl_11 stl_568" style="word-spacing:0.1217em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_568" style="word-spacing:-0.0777em;">&nbsp;0) )</span><span class="stl_10 stl_11 stl_568" style="word-spacing:-0.2543em;">&nbsp;)</span><span class="stl_10 stl_11 stl_568" style="word-spacing:-0.2543em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:11.9533em;z-index:685; "><span class="stl_10 stl_11 stl_601" style="word-spacing:-0.0516em;">rank [</span><span class="stl_10 stl_11 stl_601" style="word-spacing:0.0244em;">&nbsp;i ]</span><span class="stl_10 stl_11 stl_601" style="word-spacing:0.3444em;">&nbsp;+=</span><span class="stl_10 stl_11 stl_601" style="word-spacing:0.3444em;">&nbsp;x</span><span class="stl_107 stl_108 stl_601" style="word-spacing:0.3444em;">−</span><span class="stl_10 stl_11 stl_601" style="word-spacing:0.2064em;">&gt;l</span><span class="stl_10 stl_11 stl_601" style="word-spacing:-0.1266em;">&nbsp;e</span><span class="stl_10 stl_11 stl_601" style="word-spacing:-0.1256em;">&nbsp;v</span><span class="stl_10 stl_11 stl_601" style="word-spacing:-0.1266em;">&nbsp;e</span><span class="stl_10 stl_11 stl_601" style="word-spacing:-0.1266em;">&nbsp;l</span><span class="stl_10 stl_11 stl_601" style="word-spacing:0.0354em;">&nbsp;[</span><span class="stl_10 stl_11 stl_601" style="word-spacing:0.0244em;">&nbsp;i</span><span class="stl_10 stl_11 stl_601" style="word-spacing:-0.0053em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_601" style="word-spacing:-0.0046em;">&nbsp;span</span><span class="stl_10 stl_11 stl_601" style="word-spacing:-0.0046em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:11.9133em;z-index:711; "><span class="stl_10 stl_11 stl_602" style="word-spacing:0.1819em;">x = x</span><span class="stl_107 stl_108 stl_602" style="word-spacing:0.1819em;">−</span><span class="stl_10 stl_11 stl_602" style="word-spacing:0.1819em;">&gt;l</span><span class="stl_10 stl_11 stl_602" style="word-spacing:-0.1876em;">&nbsp;e</span><span class="stl_10 stl_11 stl_602" style="word-spacing:-0.1876em;">&nbsp;v</span><span class="stl_10 stl_11 stl_602" style="word-spacing:-0.1866em;">&nbsp;e</span><span class="stl_10 stl_11 stl_602" style="word-spacing:-0.1876em;">&nbsp;l</span><span class="stl_10 stl_11 stl_602" style="word-spacing:-0.0266em;">&nbsp;[</span><span class="stl_10 stl_11 stl_602" style="word-spacing:-0.0366em;">&nbsp;i</span><span class="stl_10 stl_11 stl_602" style="word-spacing:-0.1263em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_602" style="word-spacing:-0.0406em;">&nbsp;forward</span><span class="stl_10 stl_11 stl_602" style="word-spacing:-0.0406em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5266em;">9.3. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5266em;">跳表的插入 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">69 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.4132em;"><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3028em;">/ update</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2092em;">&nbsp;[</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.1682em;">&nbsp;i</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.1682em;">&nbsp;]</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3848em;">&nbsp;</span><span class="stl_17 stl_18 stl_603" style="word-spacing:0.3848em;">记</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;录</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;了</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;新</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;数</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;据</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;项</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;的</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;前</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;驱 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:9.9617em;"><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.1738em;">update [</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.0988em;">&nbsp;i</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.0988em;">&nbsp;]</span><span class="stl_10 stl_11 stl_288" style="word-spacing:0.2512em;">&nbsp;=</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.0488em;">&nbsp;x</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.0488em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 11.6985em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.4207em;"><span class="stl_58 stl_59 stl_604" style="word-spacing:0.3714em;">/ random</span><span class="stl_58 stl_59 stl_604" style="word-spacing:0.4127em;">&nbsp;</span><span class="stl_17 stl_18 stl_604" style="word-spacing:0.4127em;">一</span><span class="stl_17 stl_18 stl_604" style="word-spacing:-0.1266em;">&nbsp;个</span><span class="stl_17 stl_18 stl_604" style="word-spacing:0.5598em;">&nbsp;</span><span class="stl_58 stl_59 stl_604" style="word-spacing:0.5598em;">l</span><span class="stl_58 stl_59 stl_604" style="word-spacing:-0.1416em;">&nbsp;e</span><span class="stl_58 stl_59 stl_604" style="word-spacing:-0.1406em;">&nbsp;v</span><span class="stl_58 stl_59 stl_604" style="word-spacing:-0.1406em;">&nbsp;e</span><span class="stl_58 stl_59 stl_604" style="word-spacing:-0.1416em;">&nbsp;l</span><span class="stl_58 stl_59 stl_604" style="word-spacing:-0.0398em;">&nbsp;</span><span class="stl_17 stl_18 stl_604" style="word-spacing:-0.0398em;">，</span><span class="stl_17 stl_18 stl_604" style="word-spacing:-0.1266em;">&nbsp;是</span><span class="stl_17 stl_18 stl_604" style="word-spacing:-0.1256em;">&nbsp;随</span><span class="stl_17 stl_18 stl_604" style="word-spacing:-0.1256em;">&nbsp;机</span><span class="stl_17 stl_18 stl_604" style="word-spacing:-0.1256em;">&nbsp;的 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4207em;"><span class="stl_58 stl_59 stl_152" style="word-spacing:0.2235em;">* we assume</span><span class="stl_58 stl_59 stl_152" style="word-spacing:0.3425em;">&nbsp;the key</span><span class="stl_58 stl_59 stl_152" style="word-spacing:0.3955em;">&nbsp;i</span><span class="stl_58 stl_59 stl_152" style="word-spacing:-0.3015em;">&nbsp;s</span><span class="stl_58 stl_59 stl_152" style="word-spacing:0.3868em;">&nbsp;not already inside</span><span class="stl_58 stl_59 stl_152" style="word-spacing:-0.0555em;">&nbsp;,</span><span class="stl_58 stl_59 stl_152" style="word-spacing:0.4165em;">&nbsp;since</span><span class="stl_58 stl_59 stl_152" style="word-spacing:0.2955em;">&nbsp;we &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:9.6692em;"><span class="stl_58 stl_59 stl_605" style="word-spacing:0.3447em;">allow duplicated &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 14.6876em; left:9.4886em;"><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.0871em;">scores ,</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.3289em;">&nbsp;and the re</span><span class="stl_107 stl_108 stl_77" style="word-spacing:0.3289em;">−</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.3289em;">i</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3131em;">&nbsp;n</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;s</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;e</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3131em;">&nbsp;r</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;t</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;i</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;o</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;n</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.4004em;">&nbsp;of score</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.3244em;">&nbsp;and redis</span><span class="stl_58 stl_59 stl_77" style="word-spacing:0.4359em;">&nbsp;o</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;b</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;j</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;e</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;c</span><span class="stl_58 stl_59 stl_77" style="word-spacing:-0.3121em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.6575em;"><span class="stl_58 stl_59 stl_419" style="word-spacing:0.3487em;">should never &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.4554em;"><span class="stl_58 stl_59 stl_606" style="word-spacing:0.3337em;">happen since</span><span class="stl_58 stl_59 stl_606" style="word-spacing:0.4027em;">&nbsp;the c</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.2993em;">&nbsp;a</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3003em;">&nbsp;l</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.2993em;">&nbsp;l</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3003em;">&nbsp;e</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.2993em;">&nbsp;r</span><span class="stl_58 stl_59 stl_606" style="word-spacing:0.4262em;">&nbsp;of z</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3003em;">&nbsp;s</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3003em;">&nbsp;l</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3013em;">&nbsp;I</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3003em;">&nbsp;n</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3013em;">&nbsp;s</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3003em;">&nbsp;e</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3013em;">&nbsp;r</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3003em;">&nbsp;t</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.1743em;">&nbsp;()</span><span class="stl_58 stl_59 stl_606" style="word-spacing:0.3747em;">&nbsp;should</span><span class="stl_58 stl_59 stl_606" style="word-spacing:0.4207em;">&nbsp;t</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3033em;">&nbsp;e</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3033em;">&nbsp;s</span><span class="stl_58 stl_59 stl_606" style="word-spacing:-0.3023em;">&nbsp;t</span><span class="stl_58 stl_59 stl_606" style="word-spacing:0.4067em;">&nbsp;in &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:10.16em;"><span class="stl_58 stl_59 stl_69" style="word-spacing:0.3572em;">the hash</span><span class="stl_58 stl_59 stl_69" style="word-spacing:0.3972em;">&nbsp;t</span><span class="stl_58 stl_59 stl_69" style="word-spacing:-0.2958em;">&nbsp;a</span><span class="stl_58 stl_59 stl_69" style="word-spacing:-0.2948em;">&nbsp;b</span><span class="stl_58 stl_59 stl_69" style="word-spacing:-0.2958em;">&nbsp;l</span><span class="stl_58 stl_59 stl_69" style="word-spacing:-0.2958em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.5542em;"><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.2953em;">i f</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.4297em;">&nbsp;the</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.3397em;">&nbsp;element</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.3777em;">&nbsp;i</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.3283em;">&nbsp;s</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.3947em;">&nbsp;already inside</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.3477em;">&nbsp;or</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.2977em;">&nbsp;not</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.2443em;">&nbsp;.</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.3147em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:8.04em;"><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2581em;">l e</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2571em;">&nbsp;v</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2581em;">&nbsp;e</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.2581em;">&nbsp;l</span><span class="stl_10 stl_11 stl_585" style="word-spacing:0.2539em;">&nbsp;=</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.0363em;">&nbsp;zslRandomLevel ()</span><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.0363em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.661em; left:8.4207em;z-index:319; "><span class="stl_58 stl_59 stl_607" style="word-spacing:0.341em;">/ random</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.467em;">&nbsp;l</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.172em;">&nbsp;e</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.171em;">&nbsp;v</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.171em;">&nbsp;e</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.172em;">&nbsp;l</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.5296em;">&nbsp;</span><span class="stl_17 stl_18 stl_607" style="word-spacing:0.5296em;">比</span><span class="stl_17 stl_18 stl_607" style="word-spacing:-0.157em;">&nbsp;原</span><span class="stl_17 stl_18 stl_607" style="word-spacing:-0.156em;">&nbsp;有</span><span class="stl_17 stl_18 stl_607" style="word-spacing:-0.156em;">&nbsp;的</span><span class="stl_17 stl_18 stl_607" style="word-spacing:0.4891em;">&nbsp;</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.4891em;">zsl</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.1542em;">&nbsp;</span><span class="stl_107 stl_108 stl_607" style="word-spacing:0.4891em;">−</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.1542em;">&gt;l</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.171em;">&nbsp;e</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.171em;">&nbsp;v</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.172em;">&nbsp;e</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.171em;">&nbsp;l</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.5623em;">&nbsp;</span><span class="stl_17 stl_18 stl_607" style="word-spacing:0.5623em;">大，</span><span class="stl_17 stl_18 stl_607" style="word-spacing:-0.123em;">&nbsp;需</span><span class="stl_17 stl_18 stl_607" style="word-spacing:-0.156em;">&nbsp;要</span><span class="stl_17 stl_18 stl_607" style="word-spacing:-0.156em;">&nbsp;增</span><span class="stl_17 stl_18 stl_607" style="word-spacing:-0.156em;">&nbsp;加</span><span class="stl_17 stl_18 stl_607" style="word-spacing:0.5451em;">&nbsp;</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.5451em;">s</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.155em;">&nbsp;k</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.155em;">&nbsp;i</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.155em;">&nbsp;p</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.155em;">&nbsp;l</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.155em;">&nbsp;i</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.155em;">&nbsp;s</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.155em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:10.14em;"><span class="stl_17 stl_18 stl_07">的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.634em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.634em;">l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.066em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.065em;">&nbsp;v</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.065em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.065em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:8.045em;z-index:358; "><span class="stl_15 stl_16 stl_608" style="word-spacing:-0.1631em;">i f</span><span class="stl_15 stl_16 stl_608" style="word-spacing:0.5433em;">&nbsp;</span><span class="stl_10 stl_11 stl_608" style="word-spacing:0.5433em;">(</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.0631em;">&nbsp;l</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1671em;">&nbsp;e</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;v</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;e</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1671em;">&nbsp;l</span><span class="stl_10 stl_11 stl_608" style="word-spacing:0.3259em;">&nbsp;&gt; zsl</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1542em;">&nbsp;</span><span class="stl_107 stl_108 stl_608" style="word-spacing:0.3259em;">−</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1542em;">&gt;l</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;e</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1671em;">&nbsp;v</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;e</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;l</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.0621em;">&nbsp;)</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.0621em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:9.9733em;z-index:376; "><span class="stl_15 stl_16 stl_609">for</span><span class="stl_15 stl_16 stl_609" style="word-spacing:0.4601em;">&nbsp;</span><span class="stl_10 stl_11 stl_609" style="word-spacing:0.4601em;">(</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.0798em;">&nbsp;i</span><span class="stl_10 stl_11 stl_609" style="word-spacing:0.3142em;">&nbsp;= zsl</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1608em;">&nbsp;</span><span class="stl_107 stl_108 stl_609" style="word-spacing:0.3142em;">−</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1608em;">&gt;l</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1748em;">&nbsp;e</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1738em;">&nbsp;v</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1748em;">&nbsp;e</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1748em;">&nbsp;l</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.0128em;">&nbsp;;</span><span class="stl_10 stl_11 stl_609" style="word-spacing:0.5762em;">&nbsp;i</span><span class="stl_10 stl_11 stl_609" style="word-spacing:0.2962em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_609" style="word-spacing:0.3662em;">&nbsp;l</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1748em;">&nbsp;e</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1738em;">&nbsp;v</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1748em;">&nbsp;e</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1748em;">&nbsp;l</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.0128em;">&nbsp;;</span><span class="stl_10 stl_11 stl_609" style="word-spacing:0.5762em;">&nbsp;i++)</span><span class="stl_10 stl_11 stl_609" style="word-spacing:0.5762em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:11.9533em;z-index:404; "><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.201em;">rank [</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.125em;">&nbsp;i</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.125em;">&nbsp;]</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.215em;">&nbsp;=</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.215em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:11.9542em;z-index:420; "><span class="stl_10 stl_11 stl_610" style="word-spacing:-0.1516em;">update [</span><span class="stl_10 stl_11 stl_610" style="word-spacing:-0.0766em;">&nbsp;i</span><span class="stl_10 stl_11 stl_610" style="word-spacing:-0.0766em;">&nbsp;]</span><span class="stl_10 stl_11 stl_610" style="word-spacing:0.2614em;">&nbsp;= zsl</span><span class="stl_10 stl_11 stl_610" style="word-spacing:-0.2129em;">&nbsp;</span><span class="stl_107 stl_108 stl_610" style="word-spacing:0.2614em;">−</span><span class="stl_10 stl_11 stl_610" style="word-spacing:-0.2129em;">&gt;header</span><span class="stl_10 stl_11 stl_610" style="word-spacing:-0.2129em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:11.9542em;z-index:457; "><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1505em;">update [</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.0755em;">&nbsp;i</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.0755em;">&nbsp;]</span><span class="stl_107 stl_108 stl_611" style="word-spacing:-0.0755em;">−</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2425em;">&gt;</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2325em;">&nbsp;l</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2265em;">&nbsp;e</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2255em;">&nbsp;v</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2265em;">&nbsp;e</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2265em;">&nbsp;l</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.0645em;">&nbsp;[</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.0755em;">&nbsp;i</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.0225em;">&nbsp;]</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1825em;">&nbsp;.</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1045em;">&nbsp;span</span><span class="stl_10 stl_11 stl_611" style="word-spacing:0.1925em;">&nbsp;=</span><span class="stl_10 stl_11 stl_611" style="word-spacing:0.2505em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2128em;">&nbsp;</span><span class="stl_107 stl_108 stl_611" style="word-spacing:0.2505em;">−</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2128em;">&gt;length</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2128em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.6293em; left:10.0042em;z-index:470; "><span class="stl_10 stl_11 stl_608">zsl</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1543em;">&nbsp;</span><span class="stl_107 stl_108 stl_608">−</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1543em;">&gt;l</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;e</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1671em;">&nbsp;v</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;e</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;l</span><span class="stl_10 stl_11 stl_608" style="word-spacing:0.3434em;">&nbsp;= l</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;e</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1671em;">&nbsp;v</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;e</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;l</span><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1681em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 32.6201em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">插</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;入 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:7.9283em;"><span class="stl_10 stl_11 stl_88" style="word-spacing:0.0595em;">x =</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.1359em;">&nbsp;zslCreateNode (</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.2345em;">&nbsp;level</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.0315em;">&nbsp;,</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.2075em;">&nbsp;score</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.0895em;">&nbsp;,</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.2155em;">&nbsp;obj</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.2715em;">&nbsp;)</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.2715em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:7.9808em;"><span class="stl_15 stl_16 stl_309">for</span><span class="stl_15 stl_16 stl_309" style="word-spacing:0.4249em;">&nbsp;</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.4249em;">(</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.115em;">&nbsp;i</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.281em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.521em;">&nbsp;i</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.261em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.331em;">&nbsp;l</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.209em;">&nbsp;e</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.21em;">&nbsp;v</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.21em;">&nbsp;e</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.209em;">&nbsp;l</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.049em;">&nbsp;;</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.541em;">&nbsp;i++)</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.541em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:10.4132em;"><span class="stl_58 stl_59 stl_595">/</span><span class="stl_58 stl_59 stl_595" style="word-spacing:0.299em;">&nbsp;</span><span class="stl_17 stl_18 stl_595" style="word-spacing:0.299em;">新</span><span class="stl_17 stl_18 stl_595" style="word-spacing:-0.2618em;">&nbsp;节</span><span class="stl_17 stl_18 stl_595" style="word-spacing:-0.2608em;">&nbsp;点</span><span class="stl_17 stl_18 stl_595" style="word-spacing:-0.2608em;">&nbsp;项</span><span class="stl_17 stl_18 stl_595" style="word-spacing:-0.2608em;">&nbsp;插</span><span class="stl_17 stl_18 stl_595" style="word-spacing:-0.2608em;">&nbsp;到</span><span class="stl_17 stl_18 stl_595" style="word-spacing:0.3451em;">&nbsp;</span><span class="stl_58 stl_59 stl_595" style="word-spacing:0.3451em;">update</span><span class="stl_58 stl_59 stl_595" style="word-spacing:-0.2088em;">&nbsp;[</span><span class="stl_58 stl_59 stl_595" style="word-spacing:-0.1678em;">&nbsp;i</span><span class="stl_58 stl_59 stl_595" style="word-spacing:-0.1678em;">&nbsp;]</span><span class="stl_58 stl_59 stl_595" style="word-spacing:0.3854em;">&nbsp;</span><span class="stl_17 stl_18 stl_595" style="word-spacing:0.3854em;">的</span><span class="stl_17 stl_18 stl_595" style="word-spacing:-0.2608em;">&nbsp;后</span><span class="stl_17 stl_18 stl_595" style="word-spacing:-0.2608em;">&nbsp;面 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:9.9108em;z-index:592; "><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2158em;">x</span><span class="stl_107 stl_108 stl_612" style="word-spacing:-0.2158em;">−</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2158em;">&gt;l e</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2168em;">&nbsp;v</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2168em;">&nbsp;e</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2158em;">&nbsp;l</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0558em;">&nbsp;[</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0658em;">&nbsp;i</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0118em;">&nbsp;]</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.1738em;">&nbsp;.</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0688em;">&nbsp;forward</span><span class="stl_10 stl_11 stl_612" style="word-spacing:0.2182em;">&nbsp;= update</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.1418em;">&nbsp;[</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0658em;">&nbsp;i</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0658em;">&nbsp;]</span><span class="stl_107 stl_108 stl_612" style="word-spacing:-0.0658em;">−</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2318em;">&gt;</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2218em;">&nbsp;l</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2168em;">&nbsp;e</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2168em;">&nbsp;v</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2158em;">&nbsp;e</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2168em;">&nbsp;l</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0558em;">&nbsp;[</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0658em;">&nbsp;i</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0118em;">&nbsp;]</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.1728em;">&nbsp;.</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0698em;">&nbsp;forward</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.0698em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:9.9617em;z-index:640; "><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.1615em;">update [</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.0865em;">&nbsp;i</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.0865em;">&nbsp;]</span><span class="stl_107 stl_108 stl_613" style="word-spacing:-0.0865em;">−</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.2535em;">&gt;</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.2435em;">&nbsp;l</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.2375em;">&nbsp;e</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.2365em;">&nbsp;v</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.2375em;">&nbsp;e</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.2375em;">&nbsp;l</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.0755em;">&nbsp;[</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.0865em;">&nbsp;i</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.0335em;">&nbsp;]</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.1935em;">&nbsp;.</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.0895em;">&nbsp;forward</span><span class="stl_10 stl_11 stl_613" style="word-spacing:0.2065em;">&nbsp;=</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.0365em;">&nbsp;x</span><span class="stl_10 stl_11 stl_613" style="word-spacing:-0.0365em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:10.4132em;"><span class="stl_58 stl_59 stl_614" style="word-spacing:0.3081em;">* update span covered by update</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.2269em;">&nbsp;[</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.1859em;">&nbsp;i</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.1859em;">&nbsp;]</span><span class="stl_58 stl_59 stl_614" style="word-spacing:0.3611em;">&nbsp;as</span><span class="stl_58 stl_59 stl_614" style="word-spacing:0.2821em;">&nbsp;x</span><span class="stl_58 stl_59 stl_614" style="word-spacing:0.3511em;">&nbsp;i</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.3179em;">&nbsp;s</span><span class="stl_58 stl_59 stl_614" style="word-spacing:0.4311em;">&nbsp;inserted &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:11.6417em;"><span class="stl_58 stl_59 stl_143" style="word-spacing:0.3255em;">here */ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:9.9108em;z-index:691; "><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1827em;">x</span><span class="stl_107 stl_108 stl_615" style="word-spacing:-0.1827em;">−</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1827em;">&gt;l e</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1837em;">&nbsp;v</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1837em;">&nbsp;e</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1827em;">&nbsp;l</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.0227em;">&nbsp;[</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.0327em;">&nbsp;i</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1194em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.0607em;">&nbsp;span</span><span class="stl_10 stl_11 stl_615" style="word-spacing:0.2388em;">&nbsp;= update</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1087em;">&nbsp;[</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.0327em;">&nbsp;i</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.0327em;">&nbsp;]</span><span class="stl_107 stl_108 stl_615" style="word-spacing:-0.0327em;">−</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1987em;">&gt;</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1897em;">&nbsp;l</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1827em;">&nbsp;e</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1837em;">&nbsp;v</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1837em;">&nbsp;e</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1827em;">&nbsp;l</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.0227em;">&nbsp;[</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.0327em;">&nbsp;i</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1194em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.0607em;">&nbsp;span</span><span class="stl_10 stl_11 stl_615" style="word-spacing:0.2058em;">&nbsp;</span><span class="stl_107 stl_108 stl_615" style="word-spacing:0.2058em;">−</span><span class="stl_107 stl_108 stl_615" style="word-spacing:0.2926em;">&nbsp;</span><span class="stl_10 stl_11 stl_615" style="word-spacing:0.2926em;">(</span><span class="stl_10 stl_11 stl_615" style="word-spacing:-0.1647em;">&nbsp;rank &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:11.7058em;"><span class="stl_10 stl_11 stl_07">[</span></div>
					<div class="stl_01" style="top: 42.581em; left:12.0902em;z-index:740; "><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.2333em;">0 ]</span><span class="stl_10 stl_11 stl_616" style="word-spacing:0.2484em;">&nbsp;</span><span class="stl_107 stl_108 stl_616" style="word-spacing:0.2484em;">−</span><span class="stl_107 stl_108 stl_616" style="word-spacing:0.2069em;">&nbsp;</span><span class="stl_10 stl_11 stl_616" style="word-spacing:0.2069em;">rank</span><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.1733em;">&nbsp;[</span><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.0973em;">&nbsp;i</span><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.0803em;">&nbsp;]</span><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.2423em;">&nbsp;)</span><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.2423em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:9.9617em;z-index:758; "><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.155em;">update [</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.08em;">&nbsp;i</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.08em;">&nbsp;]</span><span class="stl_107 stl_108 stl_280" style="word-spacing:-0.08em;">−</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.247em;">&gt;</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.237em;">&nbsp;l</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.231em;">&nbsp;e</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.23em;">&nbsp;v</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.231em;">&nbsp;e</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.231em;">&nbsp;l</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.069em;">&nbsp;[</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.08em;">&nbsp;i</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.027em;">&nbsp;]</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.187em;">&nbsp;.</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.109em;">&nbsp;span</span><span class="stl_10 stl_11 stl_280" style="word-spacing:0.188em;">&nbsp;=</span><span class="stl_10 stl_11 stl_280" style="word-spacing:0.214em;">&nbsp;(</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.212em;">&nbsp;rank</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.131em;">&nbsp;[</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.216em;">&nbsp;0</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.216em;">&nbsp;]</span><span class="stl_10 stl_11 stl_280" style="word-spacing:0.2649em;">&nbsp;</span><span class="stl_107 stl_108 stl_280" style="word-spacing:0.2649em;">−</span><span class="stl_107 stl_108 stl_280" style="word-spacing:0.2242em;">&nbsp;</span><span class="stl_10 stl_11 stl_280" style="word-spacing:0.2242em;">rank</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.156em;">&nbsp;[</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.08em;">&nbsp;i</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.063em;">&nbsp;]</span><span class="stl_10 stl_11 stl_280" style="word-spacing:-0.225em;">&nbsp;)</span><span class="stl_10 stl_11 stl_280" style="word-spacing:0.287em;">&nbsp;+</span><span class="stl_10 stl_11 stl_280" style="word-spacing:0.25em;">&nbsp;1; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.5676em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.5676em; left:8.4207em;"><span class="stl_58 stl_59 stl_600">/</span><span class="stl_58 stl_59 stl_600" style="word-spacing:0.3471em;">&nbsp;</span><span class="stl_17 stl_18 stl_600" style="word-spacing:0.3471em;">更</span><span class="stl_17 stl_18 stl_600" style="word-spacing:-0.2137em;">&nbsp;高</span><span class="stl_17 stl_18 stl_600" style="word-spacing:-0.2127em;">&nbsp;的</span><span class="stl_17 stl_18 stl_600" style="word-spacing:0.4722em;">&nbsp;</span><span class="stl_58 stl_59 stl_600" style="word-spacing:0.4722em;">l</span><span class="stl_58 stl_59 stl_600" style="word-spacing:-0.2287em;">&nbsp;e</span><span class="stl_58 stl_59 stl_600" style="word-spacing:-0.2277em;">&nbsp;v</span><span class="stl_58 stl_59 stl_600" style="word-spacing:-0.2277em;">&nbsp;e</span><span class="stl_58 stl_59 stl_600" style="word-spacing:-0.2287em;">&nbsp;l</span><span class="stl_58 stl_59 stl_600" style="word-spacing:0.4733em;">&nbsp;</span><span class="stl_17 stl_18 stl_600" style="word-spacing:0.4733em;">尚</span><span class="stl_17 stl_18 stl_600" style="word-spacing:-0.2137em;">&nbsp;未</span><span class="stl_17 stl_18 stl_600" style="word-spacing:-0.2127em;">&nbsp;调</span><span class="stl_17 stl_18 stl_600" style="word-spacing:-0.2127em;">&nbsp;整</span><span class="stl_17 stl_18 stl_600" style="word-spacing:0.3692em;">&nbsp;</span><span class="stl_58 stl_59 stl_600" style="word-spacing:0.3692em;">span &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_21.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_21.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">70 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:20.5625em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 9.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.082em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">SKIPLIST &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_617" style="word-spacing:0.3238em;">* increment span</span><span class="stl_58 stl_59 stl_617" style="word-spacing:0.3813em;">&nbsp;for untouched</span><span class="stl_58 stl_59 stl_617" style="word-spacing:0.4358em;">&nbsp;l</span><span class="stl_58 stl_59 stl_617" style="word-spacing:-0.2632em;">&nbsp;e</span><span class="stl_58 stl_59 stl_617" style="word-spacing:-0.2622em;">&nbsp;v</span><span class="stl_58 stl_59 stl_617" style="word-spacing:-0.2622em;">&nbsp;e</span><span class="stl_58 stl_59 stl_617" style="word-spacing:-0.2632em;">&nbsp;l</span><span class="stl_58 stl_59 stl_617" style="word-spacing:-0.2622em;">&nbsp;s</span><span class="stl_58 stl_59 stl_617" style="word-spacing:0.3968em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:7.9808em;z-index:81; "><span class="stl_15 stl_16 stl_618">for</span><span class="stl_15 stl_16 stl_618" style="word-spacing:0.4603em;">&nbsp;</span><span class="stl_10 stl_11 stl_618" style="word-spacing:0.4603em;">(</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.0796em;">&nbsp;i</span><span class="stl_10 stl_11 stl_618" style="word-spacing:0.3314em;">&nbsp;= l</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.1736em;">&nbsp;e</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.1746em;">&nbsp;v</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.1746em;">&nbsp;e</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.1736em;">&nbsp;l</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.0136em;">&nbsp;;</span><span class="stl_10 stl_11 stl_618" style="word-spacing:0.5764em;">&nbsp;i</span><span class="stl_10 stl_11 stl_618" style="word-spacing:0.2964em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_618" style="word-spacing:0.3324em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.1601em;">&nbsp;</span><span class="stl_107 stl_108 stl_618" style="word-spacing:0.3324em;">−</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.1601em;">&gt;l</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.1736em;">&nbsp;e</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.1746em;">&nbsp;v</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.1746em;">&nbsp;e</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.1736em;">&nbsp;l</span><span class="stl_10 stl_11 stl_618" style="word-spacing:-0.0136em;">&nbsp;;</span><span class="stl_10 stl_11 stl_618" style="word-spacing:0.5764em;">&nbsp;i++)</span><span class="stl_10 stl_11 stl_618" style="word-spacing:0.5764em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9617em;"><span class="stl_10 stl_11 stl_619" style="word-spacing:-0.1179em;">update [ i ]</span><span class="stl_107 stl_108 stl_619" style="word-spacing:-0.1179em;">−</span><span class="stl_10 stl_11 stl_619" style="word-spacing:-0.1179em;">&gt; l e v e l [ i ] . span++; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;整</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;新</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;节</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;点</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;前</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;驱</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:7.9183em;z-index:161; "><span class="stl_10 stl_11 stl_620" style="word-spacing:0.245em;">x</span><span class="stl_107 stl_108 stl_620" style="word-spacing:0.245em;">−</span><span class="stl_10 stl_11 stl_620" style="word-spacing:0.245em;">&gt;backward =</span><span class="stl_10 stl_11 stl_620" style="word-spacing:0.284em;">&nbsp;(</span><span class="stl_10 stl_11 stl_620" style="word-spacing:-0.142em;">&nbsp;update</span><span class="stl_10 stl_11 stl_620" style="word-spacing:-0.062em;">&nbsp;[</span><span class="stl_10 stl_11 stl_620" style="word-spacing:-0.147em;">&nbsp;0</span><span class="stl_10 stl_11 stl_620" style="word-spacing:-0.147em;">&nbsp;]</span><span class="stl_10 stl_11 stl_620" style="word-spacing:0.335em;">&nbsp;==</span><span class="stl_10 stl_11 stl_620" style="word-spacing:0.284em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_620" style="word-spacing:-0.1487em;">&nbsp;</span><span class="stl_107 stl_108 stl_620" style="word-spacing:0.284em;">−</span><span class="stl_10 stl_11 stl_620" style="word-spacing:-0.1487em;">&gt;header</span><span class="stl_10 stl_11 stl_620" style="word-spacing:-0.126em;">&nbsp;)</span><span class="stl_10 stl_11 stl_620" style="word-spacing:0.436em;">&nbsp;?</span><span class="stl_10 stl_11 stl_620" style="word-spacing:0.261em;">&nbsp;NULL</span><span class="stl_10 stl_11 stl_620" style="word-spacing:0.357em;">&nbsp;:</span><span class="stl_10 stl_11 stl_620" style="word-spacing:0.514em;">&nbsp;update &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:9.7358em;"><span class="stl_10 stl_11 stl_07">[</span></div>
					<div class="stl_01" style="top: 12.6927em; left:10.1427em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0365em;">0 ] ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:8.045em;z-index:190; "><span class="stl_15 stl_16 stl_621" style="word-spacing:-0.1974em;">i f</span><span class="stl_15 stl_16 stl_621" style="word-spacing:0.509em;">&nbsp;</span><span class="stl_10 stl_11 stl_621" style="word-spacing:0.509em;">(x</span><span class="stl_107 stl_108 stl_621" style="word-spacing:0.509em;">−</span><span class="stl_10 stl_11 stl_621" style="word-spacing:0.509em;">&gt;l</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.2014em;">&nbsp;e</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.2024em;">&nbsp;v</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.2024em;">&nbsp;e</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.2014em;">&nbsp;l</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.1488em;">&nbsp;[ 0</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.1604em;">&nbsp;]</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.1604em;">&nbsp;.</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.0564em;">&nbsp;forward</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.0564em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:9.9108em;z-index:228; "><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1603em;">x</span><span class="stl_107 stl_108 stl_622" style="word-spacing:-0.1603em;">−</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1603em;">&gt;l e</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1613em;">&nbsp;v</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1613em;">&nbsp;e</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1603em;">&nbsp;l</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.0666em;">&nbsp;[ 0</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1193em;">&nbsp;]</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1193em;">&nbsp;.</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.0263em;">&nbsp;forward</span><span class="stl_107 stl_108 stl_622" style="word-spacing:-0.0263em;">−</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.0263em;">&gt;backward</span><span class="stl_10 stl_11 stl_622" style="word-spacing:0.2457em;">&nbsp;=</span><span class="stl_10 stl_11 stl_622" style="word-spacing:0.2147em;">&nbsp;x</span><span class="stl_10 stl_11 stl_622" style="word-spacing:0.2147em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:7.9933em;"><span class="stl_15 stl_16 stl_443">else &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:10.0042em;z-index:248; "><span class="stl_10 stl_11 stl_623">zsl</span><span class="stl_10 stl_11 stl_623" style="word-spacing:-0.1643em;">&nbsp;</span><span class="stl_107 stl_108 stl_623">−</span><span class="stl_10 stl_11 stl_623" style="word-spacing:-0.1643em;">&gt;t</span><span class="stl_10 stl_11 stl_623" style="word-spacing:-0.1581em;">&nbsp;a</span><span class="stl_10 stl_11 stl_623" style="word-spacing:-0.1581em;">&nbsp;i</span><span class="stl_10 stl_11 stl_623" style="word-spacing:-0.1581em;">&nbsp;l</span><span class="stl_10 stl_11 stl_623" style="word-spacing:0.3529em;">&nbsp;=</span><span class="stl_10 stl_11 stl_623" style="word-spacing:0.1979em;">&nbsp;x</span><span class="stl_10 stl_11 stl_623" style="word-spacing:0.1979em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;整</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6515em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6515em;">s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.049em;">&nbsp;k</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.049em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.049em;">&nbsp;p</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.049em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.049em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.049em;">&nbsp;s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.049em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6506em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6506em;">的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:8.0117em;z-index:275; "><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.2084em;">zsl </span><span class="stl_107 stl_108 stl_333" style="word-spacing:-0.2084em;">−</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.2084em;">&gt;length++; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:7.9458em;"><span class="stl_15 stl_16 stl_162">return</span><span class="stl_15 stl_16 stl_162" style="word-spacing:0.3295em;">&nbsp;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3295em;">x</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3295em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.7399em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">9</span></div>
					<div class="stl_01" style="top: 24.7399em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.75em;">.4 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.75em;">跳表的删除 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.2715em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">跳表的删除算和插入算法步骤类似：找出每一层需删除数据的前驱并保存；接着 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.0452em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">调整指针，在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">中还会调整 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">span</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.8585em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">中跳表删除算法的具体实现： &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.4218em; left:6.4282em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:0.477em;">/ x</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5182em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5182em;">是</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;需</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;要</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;删</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;除</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;节</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;点 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:6.4282em;"><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3028em;">/ update</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.341em;">&nbsp;</span><span class="stl_17 stl_18 stl_603" style="word-spacing:0.341em;">是 每</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;一</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;个</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;层</span><span class="stl_17 stl_18 stl_603" style="word-spacing:0.3073em;">&nbsp;</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3073em;">x</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3074em;">&nbsp;</span><span class="stl_17 stl_18 stl_603" style="word-spacing:0.3074em;">的</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2622em;">&nbsp;前</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;驱</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;数</span><span class="stl_17 stl_18 stl_603" style="word-spacing:-0.2612em;">&nbsp;组 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:6.4282em;"><span class="stl_58 stl_59 stl_624" style="word-spacing:0.2956em;">* Internal</span><span class="stl_58 stl_59 stl_624" style="word-spacing:0.3726em;">&nbsp;function</span><span class="stl_58 stl_59 stl_624" style="word-spacing:0.3246em;">&nbsp;used</span><span class="stl_58 stl_59 stl_624" style="word-spacing:0.2736em;">&nbsp;by</span><span class="stl_58 stl_59 stl_624" style="word-spacing:0.3226em;">&nbsp;zslDelete</span><span class="stl_58 stl_59 stl_624" style="word-spacing:-0.0704em;">&nbsp;,</span><span class="stl_58 stl_59 stl_624" style="word-spacing:0.3666em;">&nbsp;zslDeleteByScore</span><span class="stl_58 stl_59 stl_624" style="word-spacing:0.2746em;">&nbsp;and &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:7.6567em;"><span class="stl_58 stl_59 stl_277" style="word-spacing:0.3069em;">zslDeleteByRank */ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">9.5. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">中的跳表 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">71 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:5.9483em;"><span class="stl_15 stl_16 stl_625">void</span><span class="stl_15 stl_16 stl_625" style="word-spacing:0.2773em;">&nbsp;</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.2773em;">zslDeleteNode</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.269em;">&nbsp;(</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.202em;">&nbsp;z</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.308em;">&nbsp;s</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.308em;">&nbsp;k</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.308em;">&nbsp;i</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.308em;">&nbsp;p</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.308em;">&nbsp;l</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.308em;">&nbsp;i</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.308em;">&nbsp;s</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.307em;">&nbsp;t</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.342em;">&nbsp;*</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.308em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.059em;">&nbsp;,</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.41em;">&nbsp;zskiplistNode</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.3em;">&nbsp;*x</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.3em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:7.685em;"><span class="stl_10 stl_11 stl_626" style="word-spacing:-0.0311em;">zskiplistNode ** update</span><span class="stl_10 stl_11 stl_626" style="word-spacing:-0.3056em;">&nbsp;)</span><span class="stl_10 stl_11 stl_626" style="word-spacing:-0.3056em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.4131em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4131em;">i</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4131em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4207em;"><span class="stl_58 stl_59 stl_473">/</span><span class="stl_58 stl_59 stl_473" style="word-spacing:0.3136em;">&nbsp;</span><span class="stl_17 stl_18 stl_473" style="word-spacing:0.3136em;">调</span><span class="stl_17 stl_18 stl_473" style="word-spacing:-0.2472em;">&nbsp;整</span><span class="stl_17 stl_18 stl_473" style="word-spacing:0.3358em;">&nbsp;</span><span class="stl_58 stl_59 stl_473" style="word-spacing:0.3358em;">span</span><span class="stl_58 stl_59 stl_473" style="word-spacing:0.3349em;">&nbsp;</span><span class="stl_17 stl_18 stl_473" style="word-spacing:0.3349em;">和</span><span class="stl_17 stl_18 stl_473" style="word-spacing:0.3605em;">&nbsp;</span><span class="stl_58 stl_59 stl_473" style="word-spacing:0.3605em;">forward</span><span class="stl_58 stl_59 stl_473" style="word-spacing:0.3605em;">&nbsp;</span><span class="stl_17 stl_18 stl_473" style="word-spacing:0.3605em;">指</span><span class="stl_17 stl_18 stl_473" style="word-spacing:0.3605em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:7.9808em;z-index:123; "><span class="stl_15 stl_16 stl_162">for</span><span class="stl_15 stl_16 stl_162" style="word-spacing:0.4419em;">&nbsp;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.4419em;">(</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.098em;">&nbsp;i</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.298em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.538em;">&nbsp;i</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.278em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.314em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1785em;">&nbsp;</span><span class="stl_107 stl_108 stl_162" style="word-spacing:0.314em;">−</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1785em;">&gt;l</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.193em;">&nbsp;e</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.192em;">&nbsp;v</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.193em;">&nbsp;e</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.192em;">&nbsp;l</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.032em;">&nbsp;;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.558em;">&nbsp;i++)</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.558em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:10.0375em;z-index:150; "><span class="stl_15 stl_16 stl_627" style="word-spacing:-0.2145em;">i f</span><span class="stl_15 stl_16 stl_627" style="word-spacing:0.4919em;">&nbsp;</span><span class="stl_10 stl_11 stl_627" style="word-spacing:0.4919em;">(</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.1995em;">&nbsp;update</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.1445em;">&nbsp;[</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.0685em;">&nbsp;i</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.0685em;">&nbsp;]</span><span class="stl_107 stl_108 stl_627" style="word-spacing:-0.0685em;">−</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.2345em;">&gt;</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.2255em;">&nbsp;l</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.2195em;">&nbsp;e</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.2185em;">&nbsp;v</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.2195em;">&nbsp;e</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.2195em;">&nbsp;l</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.0575em;">&nbsp;[</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.0685em;">&nbsp;i</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.0155em;">&nbsp;]</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.1755em;">&nbsp;.</span><span class="stl_10 stl_11 stl_627" style="word-spacing:-0.0714em;">&nbsp;forward</span><span class="stl_10 stl_11 stl_627" style="word-spacing:0.1945em;">&nbsp;==</span><span class="stl_10 stl_11 stl_627" style="word-spacing:0.1265em;">&nbsp;x)</span><span class="stl_10 stl_11 stl_627" style="word-spacing:0.1265em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:11.9542em;z-index:213; "><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0881em;">update [</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0131em;">&nbsp;i</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0131em;">&nbsp;]</span><span class="stl_107 stl_108 stl_628" style="word-spacing:-0.0131em;">−</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1801em;">&gt;</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1701em;">&nbsp;l</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1641em;">&nbsp;e</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1631em;">&nbsp;v</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1641em;">&nbsp;e</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1641em;">&nbsp;l</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0021em;">&nbsp;[</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0131em;">&nbsp;i</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0802em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0421em;">&nbsp;span</span><span class="stl_10 stl_11 stl_628" style="word-spacing:0.2249em;">&nbsp;+=</span><span class="stl_10 stl_11 stl_628" style="word-spacing:0.2249em;">&nbsp;x</span><span class="stl_107 stl_108 stl_628" style="word-spacing:0.2249em;">−</span><span class="stl_10 stl_11 stl_628" style="word-spacing:0.1699em;">&gt;l</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1641em;">&nbsp;e</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1631em;">&nbsp;v</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1641em;">&nbsp;e</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1641em;">&nbsp;l</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0021em;">&nbsp;[</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0131em;">&nbsp;i</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0802em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.0421em;">&nbsp;span</span><span class="stl_10 stl_11 stl_628" style="word-spacing:0.2251em;">&nbsp;</span><span class="stl_107 stl_108 stl_628" style="word-spacing:0.2251em;">−</span><span class="stl_107 stl_108 stl_628" style="word-spacing:0.3473em;">&nbsp;</span><span class="stl_10 stl_11 stl_628" style="word-spacing:0.3473em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:11.9542em;z-index:245; "><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1409em;">update [</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0659em;">&nbsp;i</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0659em;">&nbsp;]</span><span class="stl_107 stl_108 stl_629" style="word-spacing:-0.0659em;">−</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2329em;">&gt;</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2229em;">&nbsp;l</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2169em;">&nbsp;e</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2159em;">&nbsp;v</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2169em;">&nbsp;e</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2169em;">&nbsp;l</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0549em;">&nbsp;[</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0659em;">&nbsp;i</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0129em;">&nbsp;]</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1729em;">&nbsp;.</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0689em;">&nbsp;forward</span><span class="stl_10 stl_11 stl_629" style="word-spacing:0.2271em;">&nbsp;=</span><span class="stl_10 stl_11 stl_629" style="word-spacing:0.2271em;">&nbsp;x</span><span class="stl_107 stl_108 stl_629" style="word-spacing:0.2271em;">−</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0689em;">&gt;l e</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2169em;">&nbsp;v</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2169em;">&nbsp;e</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2159em;">&nbsp;l</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0559em;">&nbsp;[</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0659em;">&nbsp;i</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0119em;">&nbsp;]</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1739em;">&nbsp;.</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0689em;">&nbsp;forward &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:13.6775em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 19.6668em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6768em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:12.4058em;"><span class="stl_58 stl_59 stl_630" style="word-spacing:0.4121em;">/ update</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.1009em;">&nbsp;[</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.0599em;">&nbsp;i]</span><span class="stl_107 stl_108 stl_630" style="word-spacing:-0.0599em;">−</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.0599em;">&gt;</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.1789em;">&nbsp;l</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.1689em;">&nbsp;e</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.1679em;">&nbsp;v</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.1679em;">&nbsp;e</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.1689em;">&nbsp;l</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.0219em;">&nbsp;[</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.0599em;">&nbsp;i</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.0109em;">&nbsp;]</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.1569em;">&nbsp;.</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.0519em;">&nbsp;forward</span><span class="stl_58 stl_59 stl_630" style="word-spacing:0.2431em;">&nbsp;==</span><span class="stl_58 stl_59 stl_630" style="word-spacing:-0.0858em;">&nbsp;NULL</span><span class="stl_17 stl_18 stl_630" style="word-spacing:-0.0858em;">， 只</span><span class="stl_17 stl_18 stl_630" style="word-spacing:-0.1529em;">&nbsp;调</span><span class="stl_17 stl_18 stl_630" style="word-spacing:-0.1529em;">&nbsp;整 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:13.6108em;"><span class="stl_58 stl_59 stl_600">span &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:11.9542em;"><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.119em;">update [</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.044em;">&nbsp;i</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.044em;">&nbsp;]</span><span class="stl_107 stl_108 stl_631" style="word-spacing:-0.044em;">−</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.211em;">&gt;</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.201em;">&nbsp;l</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.195em;">&nbsp;e</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.194em;">&nbsp;v</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.195em;">&nbsp;e</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.195em;">&nbsp;l</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.033em;">&nbsp;[</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.044em;">&nbsp;i</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.1419em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_631" style="word-spacing:-0.073em;">&nbsp;span</span><span class="stl_10 stl_11 stl_631" style="word-spacing:0.1353em;">&nbsp;</span><span class="stl_107 stl_108 stl_631" style="word-spacing:-0.073em;">−</span><span class="stl_10 stl_11 stl_631" style="word-spacing:0.1353em;">=</span><span class="stl_10 stl_11 stl_631" style="word-spacing:0.285em;">&nbsp;1; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;整</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;后</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;驱</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:8.045em;z-index:355; "><span class="stl_15 stl_16 stl_621" style="word-spacing:-0.1974em;">i f</span><span class="stl_15 stl_16 stl_621" style="word-spacing:0.509em;">&nbsp;</span><span class="stl_10 stl_11 stl_621" style="word-spacing:0.509em;">(x</span><span class="stl_107 stl_108 stl_621" style="word-spacing:0.509em;">−</span><span class="stl_10 stl_11 stl_621" style="word-spacing:0.509em;">&gt;l</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.2014em;">&nbsp;e</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.2024em;">&nbsp;v</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.2024em;">&nbsp;e</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.2014em;">&nbsp;l</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.1488em;">&nbsp;[ 0</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.1604em;">&nbsp;]</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.1604em;">&nbsp;.</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.0564em;">&nbsp;forward</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.1634em;">&nbsp;)</span><span class="stl_10 stl_11 stl_621" style="word-spacing:-0.1634em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:9.9108em;z-index:406; "><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1477em;">x</span><span class="stl_107 stl_108 stl_489" style="word-spacing:-0.1477em;">−</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1477em;">&gt;l e</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1487em;">&nbsp;v</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1487em;">&nbsp;e</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1477em;">&nbsp;l</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.0413em;">&nbsp;[ 0</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1067em;">&nbsp;]</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1067em;">&nbsp;.</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.0137em;">&nbsp;forward</span><span class="stl_107 stl_108 stl_489" style="word-spacing:-0.0137em;">−</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.0137em;">&gt;backward</span><span class="stl_10 stl_11 stl_489" style="word-spacing:0.2583em;">&nbsp;=</span><span class="stl_10 stl_11 stl_489" style="word-spacing:0.2583em;">&nbsp;x</span><span class="stl_107 stl_108 stl_489" style="word-spacing:0.2583em;">−</span><span class="stl_10 stl_11 stl_489" style="word-spacing:0.2153em;">&gt;backward</span><span class="stl_10 stl_11 stl_489" style="word-spacing:0.2153em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6393em; left:8.9892em;z-index:421; "><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:10.0042em;z-index:434; "><span class="stl_10 stl_11 stl_632">zsl</span><span class="stl_10 stl_11 stl_632" style="word-spacing:-0.126em;">&nbsp;</span><span class="stl_107 stl_108 stl_632">−</span><span class="stl_10 stl_11 stl_632" style="word-spacing:-0.126em;">&gt;t</span><span class="stl_10 stl_11 stl_632" style="word-spacing:-0.1198em;">&nbsp;a</span><span class="stl_10 stl_11 stl_632" style="word-spacing:-0.1198em;">&nbsp;i</span><span class="stl_10 stl_11 stl_632" style="word-spacing:-0.1198em;">&nbsp;l</span><span class="stl_10 stl_11 stl_632" style="word-spacing:0.3912em;">&nbsp;=</span><span class="stl_10 stl_11 stl_632" style="word-spacing:0.3912em;">&nbsp;x</span><span class="stl_107 stl_108 stl_632" style="word-spacing:0.3912em;">−</span><span class="stl_10 stl_11 stl_632" style="word-spacing:0.2242em;">&gt;backward</span><span class="stl_10 stl_11 stl_632" style="word-spacing:0.2242em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 27.6368em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">删 除</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;某</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;节</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;点</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;后，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;层</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:0.3694em;">&nbsp;</span><span class="stl_58 stl_59 stl_79" style="word-spacing:0.3694em;">l</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.332em;">&nbsp;e</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.332em;">&nbsp;v</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.331em;">&nbsp;e</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.331em;">&nbsp;l</span><span class="stl_58 stl_59 stl_79" style="word-spacing:0.369em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:0.369em;">可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.317em;">&nbsp;能</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;降</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;低，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;调</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;整</span><span class="stl_17 stl_18 stl_79" style="word-spacing:0.3696em;">&nbsp;</span><span class="stl_58 stl_59 stl_79" style="word-spacing:0.3696em;">l</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.332em;">&nbsp;e</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.332em;">&nbsp;v</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.331em;">&nbsp;e</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.331em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:7.9483em;z-index:518; "><span class="stl_15 stl_16 stl_586">while</span><span class="stl_15 stl_16 stl_586" style="word-spacing:-0.2025em;">&nbsp;</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.2025em;">(</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1287em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1846em;">&nbsp;</span><span class="stl_107 stl_108 stl_586" style="word-spacing:-0.1287em;">−</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1846em;">&gt;l</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1977em;">&nbsp;e</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1987em;">&nbsp;v</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1977em;">&nbsp;e</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1987em;">&nbsp;l</span><span class="stl_10 stl_11 stl_586" style="word-spacing:0.2833em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_586" style="word-spacing:0.2203em;">&nbsp;1</span><span class="stl_10 stl_11 stl_586" style="word-spacing:0.1623em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_586" style="word-spacing:0.2473em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.185em;">&nbsp;</span><span class="stl_107 stl_108 stl_586" style="word-spacing:0.2473em;">−</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.185em;">&gt;header</span><span class="stl_107 stl_108 stl_586" style="word-spacing:-0.185em;">−</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.185em;">&gt;l</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1977em;">&nbsp;e</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1987em;">&nbsp;v</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1987em;">&nbsp;e</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1977em;">&nbsp;l</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.0377em;">&nbsp;[</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.0717em;">&nbsp;zsl</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1845em;">&nbsp;</span><span class="stl_107 stl_108 stl_586" style="word-spacing:-0.0717em;">−</span><span class="stl_10 stl_11 stl_586" style="word-spacing:-0.1845em;">&gt;level</span><span class="stl_10 stl_11 stl_586" style="word-spacing:0.0373em;">&nbsp;</span><span class="stl_107 stl_108 stl_586" style="word-spacing:-0.1845em;">−</span><span class="stl_10 stl_11 stl_586" style="word-spacing:0.0373em;">1]. &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:9.645em;"><span class="stl_10 stl_11 stl_633" style="word-spacing:0.2758em;">forward ==</span><span class="stl_10 stl_11 stl_633" style="word-spacing:0.0998em;">&nbsp;NULL) &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:10.0042em;z-index:546; "><span class="stl_10 stl_11 stl_374" style="word-spacing:-0.1582em;">zsl </span><span class="stl_107 stl_108 stl_374" style="word-spacing:-0.1582em;">−</span><span class="stl_10 stl_11 stl_374" style="word-spacing:-0.1582em;">&gt;level </span><span class="stl_107 stl_108 stl_374" style="word-spacing:-0.1582em;">−−</span><span class="stl_10 stl_11 stl_374" style="word-spacing:-0.1582em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:8.4208em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;整</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;跳</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:8.0117em;z-index:568; "><span class="stl_10 stl_11 stl_634" style="word-spacing:-0.1686em;">zsl </span><span class="stl_107 stl_108 stl_634" style="word-spacing:-0.1686em;">−</span><span class="stl_10 stl_11 stl_634" style="word-spacing:-0.1686em;">&gt;length </span><span class="stl_107 stl_108 stl_634" style="word-spacing:-0.1686em;">−−</span><span class="stl_10 stl_11 stl_634" style="word-spacing:-0.1686em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 39.5957em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">9</span></div>
					<div class="stl_01" style="top: 39.5957em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">.5 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1257em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1257em;">中的跳表 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.8826em; left:7.5658em;"><span class="stl_10 stl_11 stl_65" style="word-spacing:0.082em;">redis </span><span class="stl_17 stl_18 stl_65" style="word-spacing:0.082em;">中结合跳表（</span><span class="stl_10 stl_11 stl_65" style="word-spacing:0.082em;">skiplist</span><span class="stl_17 stl_18 stl_65" style="word-spacing:0.082em;">）和哈希表（</span><span class="stl_10 stl_11 stl_65" style="word-spacing:0.082em;">dict</span><span class="stl_17 stl_18 stl_65" style="word-spacing:0.082em;">）形成一个新的数据结构 </span><span class="stl_10 stl_11 stl_65" style="word-spacing:0.082em;">zset</span><span class="stl_17 stl_18 stl_65" style="word-spacing:0.082em;">。添加 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.8785em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">dict </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">是为了快速定位跳表中是否存在某个 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">member</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">！ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:5.9533em;"><span class="stl_15 stl_16 stl_635" style="word-spacing:0.322em;">typedef struct</span><span class="stl_15 stl_16 stl_635" style="word-spacing:0.4096em;">&nbsp;</span><span class="stl_10 stl_11 stl_635" style="word-spacing:0.4096em;">zset</span><span class="stl_10 stl_11 stl_635" style="word-spacing:0.4096em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:8.02em;"><span class="stl_10 stl_11 stl_636" style="word-spacing:-0.093em;">dict * dict</span><span class="stl_10 stl_11 stl_636" style="word-spacing:-0.093em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:8.0525em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">z s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;k</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;p</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.064em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.587em;">&nbsp;*</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.029em;">&nbsp;z</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.079em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.079em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.079em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">72 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:20.5625em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 9.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.082em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">SKIPLIST &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.0227em;"><span class="stl_10 stl_11 stl_637" style="word-spacing:-0.2343em;">zset ; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.5407em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">9</span></div>
					<div class="stl_01" style="top: 8.5407em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">.6 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1257em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1257em;">选用</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1249em;">&nbsp;</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1249em;">skiplist</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1256em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1256em;">场景 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7835em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">ZXX </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">命令是针对有序集合（</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">sorted set</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">）的，譬如： &nbsp;</span></div>
					<div class="stl_01" style="top: 13.2743em; left:5.8242em;"><span class="stl_10 stl_11 stl_638">ZADD &nbsp;</span></div>
					<div class="stl_01" style="top: 14.2701em; left:5.825em;"><span class="stl_10 stl_11 stl_639">ZCARD &nbsp;</span></div>
					<div class="stl_01" style="top: 15.2668em; left:5.8183em;"><span class="stl_10 stl_11 stl_640">ZCOUNT &nbsp;</span></div>
					<div class="stl_01" style="top: 16.2626em; left:5.86em;"><span class="stl_10 stl_11 stl_641">ZINCRBY &nbsp;</span></div>
					<div class="stl_01" style="top: 17.2593em; left:5.855em;"><span class="stl_10 stl_11 stl_642">ZINTERSTORE &nbsp;</span></div>
					<div class="stl_01" style="top: 18.2551em; left:5.8233em;"><span class="stl_10 stl_11 stl_643">ZLEXCOUNT &nbsp;</span></div>
					<div class="stl_01" style="top: 19.2518em; left:5.8208em;"><span class="stl_10 stl_11 stl_644">ZRANGE &nbsp;</span></div>
					<div class="stl_01" style="top: 20.2476em; left:5.8208em;"><span class="stl_10 stl_11 stl_645">ZRANGEBYLEX &nbsp;</span></div>
					<div class="stl_01" style="top: 21.2443em; left:5.82em;"><span class="stl_10 stl_11 stl_646">ZRANGEBYSCORE &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2401em; left:5.8192em;"><span class="stl_10 stl_11 stl_647">ZRANK &nbsp;</span></div>
					<div class="stl_01" style="top: 23.2368em; left:5.815em;"><span class="stl_10 stl_11 stl_648">ZREM &nbsp;</span></div>
					<div class="stl_01" style="top: 24.2326em; left:5.8083em;"><span class="stl_10 stl_11 stl_649">ZREMRANGEBYLEX &nbsp;</span></div>
					<div class="stl_01" style="top: 25.2293em; left:5.7958em;"><span class="stl_10 stl_11 stl_650">ZREMRANGEBYRANK &nbsp;</span></div>
					<div class="stl_01" style="top: 26.2252em; left:5.8092em;"><span class="stl_10 stl_11 stl_651">ZREMRANGEBYSCORE &nbsp;</span></div>
					<div class="stl_01" style="top: 27.2218em; left:5.8158em;"><span class="stl_10 stl_11 stl_652">ZREVRANGE &nbsp;</span></div>
					<div class="stl_01" style="top: 28.2177em; left:5.8167em;"><span class="stl_10 stl_11 stl_653">ZREVRANGEBYSCORE &nbsp;</span></div>
					<div class="stl_01" style="top: 29.2143em; left:5.8142em;"><span class="stl_10 stl_11 stl_654">ZREVRANK &nbsp;</span></div>
					<div class="stl_01" style="top: 30.2102em; left:5.8517em;"><span class="stl_10 stl_11 stl_655">ZSCAN &nbsp;</span></div>
					<div class="stl_01" style="top: 31.2068em; left:5.8483em;"><span class="stl_10 stl_11 stl_656">ZSCORE &nbsp;</span></div>
					<div class="stl_01" style="top: 32.2027em; left:5.845em;"><span class="stl_10 stl_11 stl_657">ZUNIONSTORE &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9247em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 10 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6856em; left:5.9058em;"><span class="stl_12 stl_13 stl_25" style="word-spacing:0.1301em;">redis </span><span class="stl_37 stl_18 stl_25" style="word-spacing:0.1301em;">数据结构 </span><span class="stl_12 stl_13 stl_25" style="word-spacing:0.1301em;">intset &nbsp;</span></div>
					<div class="stl_01" style="top: 20.416em; left:7.5658em;"><span class="stl_10 stl_11 stl_658" style="word-spacing:0.0991em;">intset </span><span class="stl_17 stl_18 stl_658" style="word-spacing:0.0991em;">和 </span><span class="stl_10 stl_11 stl_658" style="word-spacing:0.0991em;">dict </span><span class="stl_17 stl_18 stl_658" style="word-spacing:0.0991em;">都是 </span><span class="stl_10 stl_11 stl_658" style="word-spacing:0.0991em;">sadd </span><span class="stl_17 stl_18 stl_658" style="word-spacing:0.0991em;">命令的底层数据结构，当添加的所有数据都是整数时， &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">会使用前者；否则使用后者。特别的，当遇到添加数据为字符串，即不能表示为整数 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.4085em; left:5.9058em;"><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0842em;">时，</span><span class="stl_10 stl_11 stl_659" style="word-spacing:0.0842em;">redis </span><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0842em;">会把数据结构转换为 </span><span class="stl_10 stl_11 stl_659" style="word-spacing:0.0842em;">dict</span><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0842em;">，即把 </span><span class="stl_10 stl_11 stl_659" style="word-spacing:0.0842em;">intset </span><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0842em;">中的数据全部搬迁到 </span><span class="stl_10 stl_11 stl_659" style="word-spacing:0.0842em;">dict</span><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0842em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.4018em; left:7.5658em;"><span class="stl_17 stl_18 stl_660" style="word-spacing:0.0941em;">本片展开的是 </span><span class="stl_10 stl_11 stl_660" style="word-spacing:0.0941em;">intset</span><span class="stl_17 stl_18 stl_660" style="word-spacing:0.0941em;">，</span><span class="stl_10 stl_11 stl_660" style="word-spacing:0.0941em;">dict </span><span class="stl_17 stl_18 stl_660" style="word-spacing:0.0941em;">的文章可以参看之前写的《深入剖析 </span><span class="stl_10 stl_11 stl_660" style="word-spacing:0.0941em;">redis </span><span class="stl_17 stl_18 stl_660" style="word-spacing:0.0941em;">数据结构 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.3985em; left:5.9058em;z-index:193; "><span class="stl_10 stl_11 stl_661">dict</span><span class="stl_17 stl_18 stl_661">》。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.7249em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 27.7249em; left:6.5789em;"><span class="stl_38 stl_13 stl_331" style="word-spacing:0.7557em;">0.1 intset</span><span class="stl_38 stl_13 stl_331" style="word-spacing:0.1314em;">&nbsp;</span><span class="stl_39 stl_18 stl_331" style="word-spacing:0.1314em;">结构体 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.9693em; left:7.5658em;"><span class="stl_10 stl_11 stl_659" style="word-spacing:0.0837em;">intset </span><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0837em;">底层本质是一个有序的、不重复的、整型的数组，支持不同类型整数。 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.456em; left:5.9533em;"><span class="stl_15 stl_16 stl_588" style="word-spacing:0.3535em;">typedef struct</span><span class="stl_15 stl_16 stl_588" style="word-spacing:0.4602em;">&nbsp;</span><span class="stl_10 stl_11 stl_588" style="word-spacing:0.4602em;">i</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2305em;">&nbsp;n</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2305em;">&nbsp;t</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2305em;">&nbsp;s</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2305em;">&nbsp;e</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2295em;">&nbsp;t</span><span class="stl_10 stl_11 stl_588" style="word-spacing:-0.2295em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4593em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">每</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;整</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;类</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;型 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4535em; left:7.9792em;"><span class="stl_10 stl_11 stl_178" style="word-spacing:0.3496em;">uint32_t encoding</span><span class="stl_10 stl_11 stl_178" style="word-spacing:0.3496em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4593em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.4476em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.4476em; left:8.4207em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:0.58em;">/ i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;n</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.078em;">&nbsp;s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6213em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6213em;">长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6213em;">&nbsp;度 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4427em; left:7.9792em;"><span class="stl_10 stl_11 stl_662" style="word-spacing:0.3542em;">uint32_t length</span><span class="stl_10 stl_11 stl_662" style="word-spacing:0.3542em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4368em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.4368em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">整</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;组 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.431em; left:7.9858em;"><span class="stl_10 stl_11 stl_592" style="word-spacing:0.347em;">int8_t contents</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.118em;">&nbsp;[</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.242em;">&nbsp;]</span><span class="stl_10 stl_11 stl_592" style="word-spacing:-0.242em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4277em; left:7.0376em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.085em;">i n</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.086em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.086em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.086em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.085em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.085em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4277em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 42.9243em; left:7.5658em;"><span class="stl_10 stl_11 stl_663" style="word-spacing:0.0806em;">encoding </span><span class="stl_17 stl_18 stl_663" style="word-spacing:0.0806em;">能下面的三个值：分别是 </span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.0806em;">16</span><span class="stl_17 stl_18 stl_663" style="word-spacing:0.0806em;">，</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.0806em;">32 </span><span class="stl_17 stl_18 stl_663" style="word-spacing:0.0806em;">和 </span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.0806em;">64 </span><span class="stl_17 stl_18 stl_663" style="word-spacing:0.0806em;">位整数： &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 45.4176em; left:6.4282em;"><span class="stl_58 stl_59 stl_664" style="word-spacing:0.2565em;">* Note</span><span class="stl_58 stl_59 stl_664" style="word-spacing:0.3405em;">&nbsp;that</span><span class="stl_58 stl_59 stl_664" style="word-spacing:0.394em;">&nbsp;these encodings</span><span class="stl_58 stl_59 stl_664" style="word-spacing:0.3365em;">&nbsp;are ordered</span><span class="stl_58 stl_59 stl_664" style="word-spacing:-0.1265em;">&nbsp;,</span><span class="stl_58 stl_59 stl_664" style="word-spacing:0.3665em;">&nbsp;so</span><span class="stl_58 stl_59 stl_664" style="word-spacing:0.3665em;">&nbsp;: &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:6.8674em;"><span class="stl_58 stl_59 stl_665" style="word-spacing:0.2597em;">INTSET_ENC_INT16 &lt;</span><span class="stl_58 stl_59 stl_665" style="word-spacing:0.3207em;">&nbsp;INTSET_ENC_INT32</span><span class="stl_58 stl_59 stl_665" style="word-spacing:0.2607em;">&nbsp;&lt;</span><span class="stl_58 stl_59 stl_665" style="word-spacing:0.3207em;">&nbsp;INTSET_ENC_INT64.</span><span class="stl_58 stl_59 stl_665" style="word-spacing:0.6267em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:6.4748em;"><span class="stl_15 stl_16 stl_666">define</span><span class="stl_15 stl_16 stl_666" style="word-spacing:0.3365em;">&nbsp;</span><span class="stl_10 stl_11 stl_666" style="word-spacing:0.3365em;">INTSET_ENC_INT16 (</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.0906em;">&nbsp;</span><span class="stl_15 stl_16 stl_666" style="word-spacing:-0.0906em;">sizeof</span><span class="stl_15 stl_16 stl_666" style="word-spacing:-0.0899em;">&nbsp;</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.0899em;">(</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1092em;">&nbsp;int16_t</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1082em;">&nbsp;)</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1082em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">7</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">3</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">74 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:20.8517em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 10.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">INTSET &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 5.7143em; left:6.4748em;"><span class="stl_15 stl_16 stl_666">define</span><span class="stl_15 stl_16 stl_666" style="word-spacing:0.3365em;">&nbsp;</span><span class="stl_10 stl_11 stl_666" style="word-spacing:0.3365em;">INTSET_ENC_INT32 (</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.0906em;">&nbsp;</span><span class="stl_15 stl_16 stl_666" style="word-spacing:-0.0906em;">sizeof</span><span class="stl_15 stl_16 stl_666" style="word-spacing:-0.0899em;">&nbsp;</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.0899em;">(</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1092em;">&nbsp;int32_t</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1082em;">&nbsp;)</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1082em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 6.7102em; left:6.4748em;"><span class="stl_15 stl_16 stl_666">define</span><span class="stl_15 stl_16 stl_666" style="word-spacing:0.3365em;">&nbsp;</span><span class="stl_10 stl_11 stl_666" style="word-spacing:0.3365em;">INTSET_ENC_INT64 (</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.0906em;">&nbsp;</span><span class="stl_15 stl_16 stl_666" style="word-spacing:-0.0906em;">sizeof</span><span class="stl_15 stl_16 stl_666" style="word-spacing:-0.0899em;">&nbsp;</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.0899em;">(</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1092em;">&nbsp;int64_t</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1082em;">&nbsp;)</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1082em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7082em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 9.7082em; left:6.5789em;"><span class="stl_38 stl_13 stl_667" style="word-spacing:0.7565em;">0.2 intset</span><span class="stl_38 stl_13 stl_667" style="word-spacing:0.1322em;">&nbsp;</span><span class="stl_39 stl_18 stl_667" style="word-spacing:0.1322em;">搜索 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.9943em; left:7.5658em;"><span class="stl_10 stl_11 stl_426" style="word-spacing:0.0845em;">intset </span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.0845em;">是有序的整数数组，可以用二分搜索查找。 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.5268em; left:6.0075em;"><span class="stl_15 stl_16 stl_668">static</span><span class="stl_15 stl_16 stl_668" style="word-spacing:0.343em;">&nbsp;</span><span class="stl_10 stl_11 stl_668" style="word-spacing:0.343em;">uint8_t intsetSearch</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.2392em;">&nbsp;(</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.2182em;">&nbsp;i</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.3242em;">&nbsp;n</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.3242em;">&nbsp;t</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.3242em;">&nbsp;s</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.3232em;">&nbsp;e</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.3242em;">&nbsp;t</span><span class="stl_10 stl_11 stl_668" style="word-spacing:0.3258em;">&nbsp;*</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.3062em;">&nbsp;is</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.0632em;">&nbsp;,</span><span class="stl_10 stl_11 stl_668" style="word-spacing:0.3778em;">&nbsp;int64_t</span><span class="stl_10 stl_11 stl_668" style="word-spacing:0.3158em;">&nbsp;value</span><span class="stl_10 stl_11 stl_668" style="word-spacing:0.3158em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 15.5285em; left:7.6475em;"><span class="stl_10 stl_11 stl_669" style="word-spacing:0.2984em;">uint32_t *pos</span><span class="stl_10 stl_11 stl_669" style="word-spacing:-0.2566em;">&nbsp;)</span><span class="stl_10 stl_11 stl_669" style="word-spacing:-0.2566em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.5193em; left:7.98em;z-index:236; "><span class="stl_15 stl_16 stl_670">int</span><span class="stl_15 stl_16 stl_670" style="word-spacing:0.3691em;">&nbsp;</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.3691em;">min</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.1805em;">&nbsp;=</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.2535em;">&nbsp;0</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.1525em;">&nbsp;,</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.3265em;">&nbsp;max</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.1315em;">&nbsp;=</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.3035em;">&nbsp;i</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2075em;">&nbsp;n</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2075em;">&nbsp;t</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2065em;">&nbsp;r</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2075em;">&nbsp;e</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2075em;">&nbsp;v</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2075em;">&nbsp;3</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2075em;">&nbsp;2</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2075em;">&nbsp;i</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2075em;">&nbsp;f</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2075em;">&nbsp;b</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.2075em;">&nbsp;e</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.1015em;">&nbsp;(</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.1265em;">&nbsp;is</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.1884em;">&nbsp;</span><span class="stl_107 stl_108 stl_670" style="word-spacing:-0.1265em;">−</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.1884em;">&gt;length</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.1325em;">&nbsp;)</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.1761em;">&nbsp;</span><span class="stl_107 stl_108 stl_670" style="word-spacing:-0.1325em;">−</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.1761em;">1,</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.3105em;">&nbsp;mid</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.1815em;">&nbsp;=</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.2457em;">&nbsp;</span><span class="stl_107 stl_108 stl_670" style="word-spacing:0.1815em;">−</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.2457em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.521em; left:7.985em;"><span class="stl_10 stl_11 stl_671" style="word-spacing:0.371em;">int64_t cur</span><span class="stl_10 stl_11 stl_671" style="word-spacing:0.177em;">&nbsp;=</span><span class="stl_10 stl_11 stl_671" style="word-spacing:0.173em;">&nbsp;</span><span class="stl_107 stl_108 stl_671" style="word-spacing:0.177em;">−</span><span class="stl_10 stl_11 stl_671" style="word-spacing:0.173em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.5151em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.511em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.5151em; left:8.4207em;"><span class="stl_58 stl_59 stl_672" style="word-spacing:0.2577em;">* The</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.3277em;">&nbsp;value</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.3597em;">&nbsp;can never be found</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.3207em;">&nbsp;when the</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.4632em;">&nbsp;set i</span><span class="stl_58 stl_59 stl_672" style="word-spacing:-0.2683em;">&nbsp;s</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.3977em;">&nbsp;empty</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.2957em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.511em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">集</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;合</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.501em; left:8.045em;z-index:337; "><span class="stl_15 stl_16 stl_673" style="word-spacing:-0.1946em;">i f</span><span class="stl_15 stl_16 stl_673" style="word-spacing:0.5118em;">&nbsp;</span><span class="stl_10 stl_11 stl_673" style="word-spacing:0.5118em;">(</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.1096em;">&nbsp;i</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2146em;">&nbsp;n</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2146em;">&nbsp;t</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2146em;">&nbsp;r</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2146em;">&nbsp;e</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2136em;">&nbsp;v</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2146em;">&nbsp;3</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2146em;">&nbsp;2</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2146em;">&nbsp;i</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2146em;">&nbsp;f</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2146em;">&nbsp;b</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.2146em;">&nbsp;e</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.1086em;">&nbsp;(</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.1336em;">&nbsp;is</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.1948em;">&nbsp;</span><span class="stl_107 stl_108 stl_673" style="word-spacing:-0.1336em;">−</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.1948em;">&gt;length</span><span class="stl_10 stl_11 stl_673" style="word-spacing:-0.1406em;">&nbsp;)</span><span class="stl_10 stl_11 stl_673" style="word-spacing:0.2149em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_673" style="word-spacing:0.2149em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.4968em; left:10.0375em;z-index:362; "><span class="stl_15 stl_16 stl_674" style="word-spacing:-0.2837em;">i f</span><span class="stl_15 stl_16 stl_674" style="word-spacing:0.4227em;">&nbsp;</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.4227em;">(</span><span class="stl_10 stl_11 stl_674" style="word-spacing:-0.2667em;">&nbsp;pos</span><span class="stl_10 stl_11 stl_674" style="word-spacing:-0.2667em;">&nbsp;)</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.2953em;">&nbsp;*pos</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.1383em;">&nbsp;=</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.1923em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.4935em; left:9.9383em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.4943em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.4893em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.4926em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.4926em; left:10.4132em;"><span class="stl_58 stl_59 stl_432" style="word-spacing:0.2949em;">* Check</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.3749em;">&nbsp;for</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.4199em;">&nbsp;the case</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.3629em;">&nbsp;where</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.2759em;">&nbsp;we</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.2359em;">&nbsp;know we</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.2899em;">&nbsp;cannot</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.4069em;">&nbsp;find &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4885em; left:11.6542em;"><span class="stl_58 stl_59 stl_675" style="word-spacing:0.3543em;">the value</span><span class="stl_58 stl_59 stl_675" style="word-spacing:0.3543em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4851em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 27.4851em; left:11.4827em;"><span class="stl_58 stl_59 stl_433" style="word-spacing:0.323em;">but do</span><span class="stl_58 stl_59 stl_433" style="word-spacing:0.245em;">&nbsp;know</span><span class="stl_58 stl_59 stl_433" style="word-spacing:0.311em;">&nbsp;the</span><span class="stl_58 stl_59 stl_433" style="word-spacing:0.428em;">&nbsp;i</span><span class="stl_58 stl_59 stl_433" style="word-spacing:-0.295em;">&nbsp;n</span><span class="stl_58 stl_59 stl_433" style="word-spacing:-0.296em;">&nbsp;s</span><span class="stl_58 stl_59 stl_433" style="word-spacing:-0.296em;">&nbsp;e</span><span class="stl_58 stl_59 stl_433" style="word-spacing:-0.296em;">&nbsp;r</span><span class="stl_58 stl_59 stl_433" style="word-spacing:-0.295em;">&nbsp;t</span><span class="stl_58 stl_59 stl_433" style="word-spacing:0.454em;">&nbsp;po</span><span class="stl_58 stl_59 stl_433" style="word-spacing:-0.304em;">&nbsp;sit</span><span class="stl_58 stl_59 stl_433" style="word-spacing:-0.304em;">&nbsp;i</span><span class="stl_58 stl_59 stl_433" style="word-spacing:-0.304em;">&nbsp;on</span><span class="stl_58 stl_59 stl_433" style="word-spacing:-0.157em;">&nbsp;.</span><span class="stl_58 stl_59 stl_433" style="word-spacing:0.351em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.481em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.471em; left:10.0375em;z-index:510; "><span class="stl_15 stl_16 stl_671" style="word-spacing:-0.2601em;">i f</span><span class="stl_15 stl_16 stl_671" style="word-spacing:0.4463em;">&nbsp;</span><span class="stl_10 stl_11 stl_671" style="word-spacing:0.4463em;">(</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2151em;">&nbsp;value</span><span class="stl_10 stl_11 stl_671" style="word-spacing:0.1609em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.0112em;">&nbsp;_intsetGet (</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.1991em;">&nbsp;is</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.0111em;">&nbsp;,</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.1191em;">&nbsp;i</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2801em;">&nbsp;n</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2791em;">&nbsp;t</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2801em;">&nbsp;r</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2801em;">&nbsp;e</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2801em;">&nbsp;v</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2801em;">&nbsp;3</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2801em;">&nbsp;2</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2801em;">&nbsp;i</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2801em;">&nbsp;f</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2801em;">&nbsp;b</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2801em;">&nbsp;e</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.1741em;">&nbsp;(</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.1991em;">&nbsp;is</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2615em;">&nbsp;</span><span class="stl_107 stl_108 stl_671" style="word-spacing:-0.1991em;">−</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2615em;">&gt;length</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2051em;">&nbsp;)</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2768em;">&nbsp;</span><span class="stl_107 stl_108 stl_671" style="word-spacing:-0.2051em;">−</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2768em;">1) &nbsp;</span></div>
					<div class="stl_01" style="top: 28.481em; left:10.4132em;"><span class="stl_58 stl_59 stl_168" style="word-spacing:0.279em;">/ value</span><span class="stl_58 stl_59 stl_168" style="word-spacing:0.3201em;">&nbsp;</span><span class="stl_17 stl_18 stl_168" style="word-spacing:0.3201em;">比</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;最</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;大</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;元</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;素</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;还</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;大 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4718em; left:11.6383em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 30.4718em; left:12.5881em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 31.4635em; left:12.03em;z-index:551; "><span class="stl_15 stl_16 stl_676" style="word-spacing:-0.244em;">i f</span><span class="stl_15 stl_16 stl_676" style="word-spacing:0.4624em;">&nbsp;</span><span class="stl_10 stl_11 stl_676" style="word-spacing:0.4624em;">(</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.227em;">&nbsp;pos</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.227em;">&nbsp;)</span><span class="stl_10 stl_11 stl_676" style="word-spacing:0.335em;">&nbsp;*pos</span><span class="stl_10 stl_11 stl_676" style="word-spacing:0.178em;">&nbsp;=</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.0171em;">&nbsp;i n</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.263em;">&nbsp;t</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.264em;">&nbsp;r</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.264em;">&nbsp;e</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.264em;">&nbsp;v</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.264em;">&nbsp;3</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.264em;">&nbsp;2</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.264em;">&nbsp;i</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.264em;">&nbsp;f</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.264em;">&nbsp;b</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.264em;">&nbsp;e</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.158em;">&nbsp;(</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.183em;">&nbsp;is</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.2446em;">&nbsp;</span><span class="stl_107 stl_108 stl_676" style="word-spacing:-0.183em;">−</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.2446em;">&gt;length</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.189em;">&nbsp;)</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.189em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4593em; left:11.9308em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.4577em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 33.4626em; left:10.4132em;"><span class="stl_58 stl_59 stl_168" style="word-spacing:0.279em;">/ value</span><span class="stl_58 stl_59 stl_168" style="word-spacing:0.3201em;">&nbsp;</span><span class="stl_17 stl_18 stl_168" style="word-spacing:0.3201em;">比</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;最</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;小</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;元</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;素</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;还</span><span class="stl_17 stl_18 stl_168" style="word-spacing:-0.309em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4527em; left:10.9817em;"><span class="stl_15 stl_16 stl_255" style="word-spacing:0.4168em;">else i</span><span class="stl_15 stl_16 stl_255" style="word-spacing:-0.2972em;">&nbsp;f</span><span class="stl_15 stl_16 stl_255" style="word-spacing:0.4075em;">&nbsp;</span><span class="stl_10 stl_11 stl_255" style="word-spacing:0.4075em;">(</span><span class="stl_10 stl_11 stl_255" style="word-spacing:-0.2532em;">&nbsp;value</span><span class="stl_10 stl_11 stl_255" style="word-spacing:0.1228em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_255" style="word-spacing:-0.0875em;">&nbsp;_intsetGet (</span><span class="stl_10 stl_11 stl_255" style="word-spacing:-0.2362em;">&nbsp;is</span><span class="stl_10 stl_11 stl_255" style="word-spacing:-0.0522em;">&nbsp;,</span><span class="stl_10 stl_11 stl_255" style="word-spacing:-0.3162em;">&nbsp;0</span><span class="stl_10 stl_11 stl_255" style="word-spacing:-0.3162em;">&nbsp;)</span><span class="stl_10 stl_11 stl_255" style="word-spacing:-0.2102em;">&nbsp;)</span><span class="stl_10 stl_11 stl_255" style="word-spacing:-0.2102em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4485em; left:12.03em;"><span class="stl_15 stl_16 stl_674" style="word-spacing:-0.2837em;">i f</span><span class="stl_15 stl_16 stl_674" style="word-spacing:0.4227em;">&nbsp;</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.4227em;">(</span><span class="stl_10 stl_11 stl_674" style="word-spacing:-0.2667em;">&nbsp;pos</span><span class="stl_10 stl_11 stl_674" style="word-spacing:-0.2667em;">&nbsp;)</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.2953em;">&nbsp;*pos</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.1383em;">&nbsp;=</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.1923em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4452em; left:11.9308em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.446em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.4427em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 40.4368em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">二</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;查</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;找 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:7.9483em;"><span class="stl_15 stl_16 stl_677">while</span><span class="stl_15 stl_16 stl_677" style="word-spacing:-0.1591em;">&nbsp;</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1591em;">(max</span><span class="stl_10 stl_11 stl_677" style="word-spacing:0.0796em;">&nbsp;&gt;=</span><span class="stl_10 stl_11 stl_677" style="word-spacing:0.2166em;">&nbsp;min)</span><span class="stl_10 stl_11 stl_677" style="word-spacing:0.2166em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:9.9183em;"><span class="stl_10 stl_11 stl_188" style="word-spacing:0.222em;">mid =</span><span class="stl_10 stl_11 stl_188" style="word-spacing:0.295em;">&nbsp;(min+max)</span><span class="stl_10 stl_11 stl_188" style="word-spacing:-0.086em;">&nbsp;/2; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:9.975em;"><span class="stl_10 stl_11 stl_63" style="word-spacing:0.1642em;">cur = _intsetGet</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2393em;">&nbsp;(</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2133em;">&nbsp;is</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.0263em;">&nbsp;,</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2573em;">&nbsp;mid)</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2573em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4152em; left:10.0375em;"><span class="stl_15 stl_16 stl_678" style="word-spacing:-0.2963em;">i f</span><span class="stl_15 stl_16 stl_678" style="word-spacing:0.4101em;">&nbsp;</span><span class="stl_10 stl_11 stl_678" style="word-spacing:0.4101em;">(</span><span class="stl_10 stl_11 stl_678" style="word-spacing:-0.2513em;">&nbsp;value</span><span class="stl_10 stl_11 stl_678" style="word-spacing:0.1247em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_678" style="word-spacing:-0.0473em;">&nbsp;cur )</span><span class="stl_10 stl_11 stl_678" style="word-spacing:-0.0473em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:11.9108em;"><span class="stl_10 stl_11 stl_518" style="word-spacing:0.1943em;">min = mid+1; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.4077em; left:10.9817em;"><span class="stl_15 stl_16 stl_679" style="word-spacing:0.4163em;">else i</span><span class="stl_15 stl_16 stl_679" style="word-spacing:-0.2977em;">&nbsp;f</span><span class="stl_15 stl_16 stl_679" style="word-spacing:0.4071em;">&nbsp;</span><span class="stl_10 stl_11 stl_679" style="word-spacing:0.4071em;">(</span><span class="stl_10 stl_11 stl_679" style="word-spacing:-0.2537em;">&nbsp;value</span><span class="stl_10 stl_11 stl_679" style="word-spacing:0.1223em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_679" style="word-spacing:-0.0497em;">&nbsp;cur )</span><span class="stl_10 stl_11 stl_679" style="word-spacing:-0.0497em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:11.8708em;"><span class="stl_10 stl_11 stl_680" style="word-spacing:0.1696em;">max =</span><span class="stl_10 stl_11 stl_680" style="word-spacing:0.2136em;">&nbsp;mid</span><span class="stl_107 stl_108 stl_680" style="word-spacing:0.2136em;">−</span><span class="stl_10 stl_11 stl_680" style="word-spacing:0.2136em;">1; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">10.3. INTSET</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0837em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0837em;">插入 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">75 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 5.7143em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:11.91em;"><span class="stl_15 stl_16 stl_681" style="word-spacing:-0.1209em;">break </span><span class="stl_10 stl_11 stl_681" style="word-spacing:-0.1209em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 10.6952em; left:8.045em;"><span class="stl_15 stl_16 stl_682" style="word-spacing:-0.2309em;">i f</span><span class="stl_15 stl_16 stl_682" style="word-spacing:0.4755em;">&nbsp;</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.4755em;">(</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1859em;">&nbsp;value</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.1826em;">&nbsp;== cur</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1989em;">&nbsp;)</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1989em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:10.0375em;"><span class="stl_15 stl_16 stl_683" style="word-spacing:-0.2326em;">i f</span><span class="stl_15 stl_16 stl_683" style="word-spacing:0.4738em;">&nbsp;</span><span class="stl_10 stl_11 stl_683" style="word-spacing:0.4738em;">(</span><span class="stl_10 stl_11 stl_683" style="word-spacing:-0.2156em;">&nbsp;pos</span><span class="stl_10 stl_11 stl_683" style="word-spacing:-0.2156em;">&nbsp;)</span><span class="stl_10 stl_11 stl_683" style="word-spacing:0.3464em;">&nbsp;*pos</span><span class="stl_10 stl_11 stl_683" style="word-spacing:0.1894em;">&nbsp;=</span><span class="stl_10 stl_11 stl_683" style="word-spacing:-0.0396em;">&nbsp;mid</span><span class="stl_10 stl_11 stl_683" style="word-spacing:-0.0396em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:9.9383em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.6843em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:10.0375em;"><span class="stl_15 stl_16 stl_683" style="word-spacing:-0.2326em;">i f</span><span class="stl_15 stl_16 stl_683" style="word-spacing:0.4738em;">&nbsp;</span><span class="stl_10 stl_11 stl_683" style="word-spacing:0.4738em;">(</span><span class="stl_10 stl_11 stl_683" style="word-spacing:-0.2156em;">&nbsp;pos</span><span class="stl_10 stl_11 stl_683" style="word-spacing:-0.2156em;">&nbsp;)</span><span class="stl_10 stl_11 stl_683" style="word-spacing:0.3464em;">&nbsp;*pos</span><span class="stl_10 stl_11 stl_683" style="word-spacing:0.1894em;">&nbsp;=</span><span class="stl_10 stl_11 stl_683" style="word-spacing:-0.0396em;">&nbsp;min</span><span class="stl_10 stl_11 stl_683" style="word-spacing:-0.0396em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:9.9383em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 17.6743em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 20.6666em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 20.6666em; left:6.5789em;"><span class="stl_38 stl_13 stl_667" style="word-spacing:0.7565em;">0.3 intset</span><span class="stl_38 stl_13 stl_667" style="word-spacing:0.1322em;">&nbsp;</span><span class="stl_39 stl_18 stl_667" style="word-spacing:0.1322em;">插入 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9535em; left:7.5658em;"><span class="stl_10 stl_11 stl_446" style="word-spacing:0.0848em;">intset </span><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0848em;">实现中比较有意思的是插入算法部分。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.4926em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.4926em; left:6.4282em;"><span class="stl_58 stl_59 stl_684" style="word-spacing:0.2863em;">* Insert an in</span><span class="stl_58 stl_59 stl_684" style="word-spacing:-0.3593em;">&nbsp;teger</span><span class="stl_58 stl_59 stl_684" style="word-spacing:0.3377em;">&nbsp;in the</span><span class="stl_58 stl_59 stl_684" style="word-spacing:0.3857em;">&nbsp;i</span><span class="stl_58 stl_59 stl_684" style="word-spacing:-0.3383em;">&nbsp;n</span><span class="stl_58 stl_59 stl_684" style="word-spacing:-0.3373em;">&nbsp;t</span><span class="stl_58 stl_59 stl_684" style="word-spacing:-0.3383em;">&nbsp;s</span><span class="stl_58 stl_59 stl_684" style="word-spacing:-0.3383em;">&nbsp;e</span><span class="stl_58 stl_59 stl_684" style="word-spacing:-0.3383em;">&nbsp;t</span><span class="stl_58 stl_59 stl_684" style="word-spacing:0.3207em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4868em; left:6.0417em;"><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3094em;">i n</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3094em;">&nbsp;t</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3084em;">&nbsp;s</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3094em;">&nbsp;e</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3094em;">&nbsp;t</span><span class="stl_10 stl_11 stl_664" style="word-spacing:0.3416em;">&nbsp;*</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3154em;">&nbsp;intsetAdd</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.2594em;">&nbsp;(</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.2034em;">&nbsp;i</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3094em;">&nbsp;n</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3094em;">&nbsp;t</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3084em;">&nbsp;s</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3094em;">&nbsp;e</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.3094em;">&nbsp;t</span><span class="stl_10 stl_11 stl_664" style="word-spacing:0.3416em;">&nbsp;*</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.2914em;">&nbsp;is</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.0484em;">&nbsp;,</span><span class="stl_10 stl_11 stl_664" style="word-spacing:0.3916em;">&nbsp;int64_t</span><span class="stl_10 stl_11 stl_664" style="word-spacing:0.3306em;">&nbsp;value</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.1144em;">&nbsp;,</span><span class="stl_10 stl_11 stl_664" style="word-spacing:0.3856em;">&nbsp;uint8_t</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.0039em;">&nbsp;*</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.0039em;">&nbsp;success &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4835em; left:7.6533em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 27.4835em; left:8.6031em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 28.4793em; left:7.9792em;"><span class="stl_10 stl_11 stl_685" style="word-spacing:0.3545em;">uint8_t valenc</span><span class="stl_10 stl_11 stl_685" style="word-spacing:0.1685em;">&nbsp;=</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.1019em;">&nbsp;_intsetValueEncoding (</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.2435em;">&nbsp;value</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.2425em;">&nbsp;)</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.2425em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.476em; left:7.9792em;"><span class="stl_10 stl_11 stl_686" style="word-spacing:0.3437em;">uint32_t pos</span><span class="stl_10 stl_11 stl_686" style="word-spacing:0.3437em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4668em; left:8.045em;"><span class="stl_15 stl_16 stl_687" style="word-spacing:-0.3566em;">i f</span><span class="stl_15 stl_16 stl_687" style="word-spacing:0.3498em;">&nbsp;</span><span class="stl_10 stl_11 stl_687" style="word-spacing:0.3498em;">(</span><span class="stl_10 stl_11 stl_687" style="word-spacing:-0.2866em;">&nbsp;success</span><span class="stl_10 stl_11 stl_687" style="word-spacing:-0.2856em;">&nbsp;)</span><span class="stl_10 stl_11 stl_687" style="word-spacing:-0.0596em;">&nbsp;* success</span><span class="stl_10 stl_11 stl_687" style="word-spacing:0.1194em;">&nbsp;=</span><span class="stl_10 stl_11 stl_687" style="word-spacing:0.1194em;">&nbsp;1; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.466em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.466em; left:8.4207em;"><span class="stl_58 stl_59 stl_688" style="word-spacing:0.2896em;">* Upgrade</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.3376em;">&nbsp;encoding</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.4596em;">&nbsp;i</span><span class="stl_58 stl_59 stl_688" style="word-spacing:-0.2464em;">&nbsp;f</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.4746em;">&nbsp;necessary</span><span class="stl_58 stl_59 stl_688" style="word-spacing:-0.1734em;">&nbsp;.</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.4726em;">&nbsp;I</span><span class="stl_58 stl_59 stl_688" style="word-spacing:-0.2734em;">&nbsp;f</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.3526em;">&nbsp;we</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.2646em;">&nbsp;need</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.3611em;">&nbsp;to upgrade</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.3611em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:9.5792em;"><span class="stl_58 stl_59 stl_466" style="word-spacing:0.2514em;">we know</span><span class="stl_58 stl_59 stl_466" style="word-spacing:0.3684em;">&nbsp;that &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4593em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 34.4593em; left:9.5318em;"><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2932em;">t h</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2932em;">&nbsp;i</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2922em;">&nbsp;s</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.4358em;">&nbsp;value</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3788em;">&nbsp;should be e</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.3022em;">&nbsp;i</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.3032em;">&nbsp;t</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.3032em;">&nbsp;h</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.3032em;">&nbsp;e</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.3022em;">&nbsp;r</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3818em;">&nbsp;appended</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3198em;">&nbsp;(</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.1712em;">&nbsp;i</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2652em;">&nbsp;f</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.2148em;">&nbsp;&gt;</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.1728em;">&nbsp;0)</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3208em;">&nbsp;or &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4551em; left:10.1392em;"><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3481em;">prepended (</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.1559em;">&nbsp;i</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2519em;">&nbsp;f</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.2301em;">&nbsp;&lt;</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.1871em;">&nbsp;0)</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.1871em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4518em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 36.4518em; left:9.4861em;"><span class="stl_58 stl_59 stl_690" style="word-spacing:0.4012em;">because i</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3118em;">&nbsp;t</span><span class="stl_58 stl_59 stl_690" style="word-spacing:0.4812em;">&nbsp;l</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3047em;">&nbsp;i</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3048em;">&nbsp;e</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3058em;">&nbsp;s</span><span class="stl_58 stl_59 stl_690" style="word-spacing:0.4372em;">&nbsp;outside</span><span class="stl_58 stl_59 stl_690" style="word-spacing:0.3672em;">&nbsp;the</span><span class="stl_58 stl_59 stl_690" style="word-spacing:0.3237em;">&nbsp;range of</span><span class="stl_58 stl_59 stl_690" style="word-spacing:0.3953em;">&nbsp;e</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3327em;">&nbsp;x</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3318em;">&nbsp;i</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3328em;">&nbsp;s</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3318em;">&nbsp;t</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3328em;">&nbsp;i</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3317em;">&nbsp;n</span><span class="stl_58 stl_59 stl_690" style="word-spacing:-0.3318em;">&nbsp;g</span><span class="stl_58 stl_59 stl_690" style="word-spacing:0.4052em;">&nbsp;values</span><span class="stl_58 stl_59 stl_690" style="word-spacing:0.4052em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:10.1058em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 37.4476em; left:10.5791em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.4443em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.426em; left:8.045em;z-index:528; "><span class="stl_15 stl_16 stl_165" style="word-spacing:-0.2515em;">i f</span><span class="stl_15 stl_16 stl_165" style="word-spacing:0.4549em;">&nbsp;</span><span class="stl_10 stl_11 stl_165" style="word-spacing:0.4549em;">(</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2005em;">&nbsp;valenc</span><span class="stl_10 stl_11 stl_165" style="word-spacing:0.1745em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.002em;">&nbsp;i n</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2715em;">&nbsp;t</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2715em;">&nbsp;r</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2705em;">&nbsp;e</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2715em;">&nbsp;v</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2715em;">&nbsp;3</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2715em;">&nbsp;2</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2715em;">&nbsp;i</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2715em;">&nbsp;f</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2715em;">&nbsp;b</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2715em;">&nbsp;e</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.1655em;">&nbsp;(</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.1905em;">&nbsp;is</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2527em;">&nbsp;</span><span class="stl_107 stl_108 stl_165" style="word-spacing:-0.1905em;">−</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2527em;">&gt;encoding</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2145em;">&nbsp;)</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2165em;">&nbsp;)</span><span class="stl_10 stl_11 stl_165" style="word-spacing:-0.2165em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4443em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">需 要</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;插</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;整</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;所</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;需</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;内</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;超</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;出</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;了</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;原</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;集</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;合</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;整</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;范</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;围，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;即</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;内</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.6607em; left:9.6417em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.305em;">类 型 不 同， &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">则</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;升</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;级</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;整</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;类</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;型 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4293em; left:10.4132em;"><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3058em;">* This</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3653em;">&nbsp;always succeeds</span><span class="stl_58 stl_59 stl_549" style="word-spacing:-0.0782em;">&nbsp;,</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3958em;">&nbsp;so</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.2748em;">&nbsp;we</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.2348em;">&nbsp;don</span><span class="stl_58 stl_59 stl_549" style="word-spacing:-0.1942em;">&nbsp;’</span><span class="stl_58 stl_59 stl_549" style="word-spacing:-0.2132em;">&nbsp;t</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3718em;">&nbsp;need to curry</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3718em;">&nbsp;* &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:11.6608em;"><span class="stl_58 stl_59 stl_580" style="word-spacing:-0.2139em;">success .</span><span class="stl_58 stl_59 stl_580" style="word-spacing:0.3131em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4152em; left:9.9383em;"><span class="stl_15 stl_16 stl_691">return</span><span class="stl_15 stl_16 stl_691" style="word-spacing:0.3225em;">&nbsp;</span><span class="stl_10 stl_11 stl_691" style="word-spacing:0.3225em;">intsetUpgradeAndAdd</span><span class="stl_10 stl_11 stl_691" style="word-spacing:-0.2291em;">&nbsp;(</span><span class="stl_10 stl_11 stl_691" style="word-spacing:-0.1741em;">&nbsp;is</span><span class="stl_10 stl_11 stl_691" style="word-spacing:-0.1201em;">&nbsp;, value</span><span class="stl_10 stl_11 stl_691" style="word-spacing:-0.1901em;">&nbsp;)</span><span class="stl_10 stl_11 stl_691" style="word-spacing:-0.1901em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.4143em; left:8.4207em;"><span class="stl_58 stl_59 stl_581">/</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.0422em;">&nbsp;</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.0422em;">正 常，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;分</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;配</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;内</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.283em;">&nbsp;存，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;插</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;入 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">76 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:20.8517em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 10.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">INTSET &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:10.4132em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:0.58em;">/ i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;n</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.078em;">&nbsp;s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6213em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6213em;">内</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;部</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;不</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;允</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;许</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;重</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;复 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:10.4132em;"><span class="stl_58 stl_59 stl_692" style="word-spacing:0.2503em;">* Abort</span><span class="stl_58 stl_59 stl_692" style="word-spacing:0.3863em;">&nbsp;i</span><span class="stl_58 stl_59 stl_692" style="word-spacing:-0.3017em;">&nbsp;f</span><span class="stl_58 stl_59 stl_692" style="word-spacing:0.4213em;">&nbsp;the</span><span class="stl_58 stl_59 stl_692" style="word-spacing:0.3743em;">&nbsp;value i</span><span class="stl_58 stl_59 stl_692" style="word-spacing:-0.3367em;">&nbsp;s</span><span class="stl_58 stl_59 stl_692" style="word-spacing:0.3788em;">&nbsp;already present</span><span class="stl_58 stl_59 stl_692" style="word-spacing:0.3403em;">&nbsp;in the</span><span class="stl_58 stl_59 stl_692" style="word-spacing:0.3763em;">&nbsp;set</span><span class="stl_58 stl_59 stl_692" style="word-spacing:0.3763em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:11.4603em;"><span class="stl_58 stl_59 stl_693" style="word-spacing:0.3866em;">This c</span><span class="stl_58 stl_59 stl_693" style="word-spacing:-0.3044em;">&nbsp;a</span><span class="stl_58 stl_59 stl_693" style="word-spacing:-0.3054em;">&nbsp;l</span><span class="stl_58 stl_59 stl_693" style="word-spacing:-0.3044em;">&nbsp;l</span><span class="stl_58 stl_59 stl_693" style="word-spacing:0.4776em;">&nbsp;w</span><span class="stl_58 stl_59 stl_693" style="word-spacing:-0.3044em;">&nbsp;i</span><span class="stl_58 stl_59 stl_693" style="word-spacing:-0.3054em;">&nbsp;l</span><span class="stl_58 stl_59 stl_693" style="word-spacing:-0.3044em;">&nbsp;l</span><span class="stl_58 stl_59 stl_693" style="word-spacing:0.4246em;">&nbsp;populate</span><span class="stl_58 stl_59 stl_693" style="word-spacing:0.2901em;">&nbsp;”pos” with</span><span class="stl_58 stl_59 stl_693" style="word-spacing:0.3526em;">&nbsp;the</span><span class="stl_58 stl_59 stl_693" style="word-spacing:0.3966em;">&nbsp;r</span><span class="stl_58 stl_59 stl_693" style="word-spacing:-0.3264em;">&nbsp;i</span><span class="stl_58 stl_59 stl_693" style="word-spacing:-0.3274em;">&nbsp;g</span><span class="stl_58 stl_59 stl_693" style="word-spacing:-0.3274em;">&nbsp;h</span><span class="stl_58 stl_59 stl_693" style="word-spacing:-0.3274em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:12.1733em;"><span class="stl_58 stl_59 stl_694" style="word-spacing:-0.3876em;">pos i</span><span class="stl_58 stl_59 stl_694" style="word-spacing:-0.3876em;">&nbsp;ti</span><span class="stl_58 stl_59 stl_694" style="word-spacing:-0.3876em;">&nbsp;on</span><span class="stl_58 stl_59 stl_694" style="word-spacing:0.3354em;">&nbsp;to i</span><span class="stl_58 stl_59 stl_694" style="word-spacing:-0.3786em;">&nbsp;n</span><span class="stl_58 stl_59 stl_694" style="word-spacing:-0.3796em;">&nbsp;s</span><span class="stl_58 stl_59 stl_694" style="word-spacing:-0.3796em;">&nbsp;e</span><span class="stl_58 stl_59 stl_694" style="word-spacing:-0.3786em;">&nbsp;r</span><span class="stl_58 stl_59 stl_694" style="word-spacing:-0.3786em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:11.4877em;"><span class="stl_58 stl_59 stl_233" style="word-spacing:0.4134em;">the value</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.3304em;">&nbsp;when</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.3884em;">&nbsp;i</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2526em;">&nbsp;t</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.4424em;">&nbsp;cannot</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.3484em;">&nbsp;be found</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.1976em;">&nbsp;.</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.3654em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 10.6952em; left:10.0375em;"><span class="stl_15 stl_16 stl_371" style="word-spacing:-0.32em;">i f</span><span class="stl_15 stl_16 stl_371" style="word-spacing:0.3864em;">&nbsp;</span><span class="stl_10 stl_11 stl_371" style="word-spacing:0.3864em;">(</span><span class="stl_10 stl_11 stl_371" style="word-spacing:-0.248em;">&nbsp;intsetSearch</span><span class="stl_10 stl_11 stl_371" style="word-spacing:-0.247em;">&nbsp;(</span><span class="stl_10 stl_11 stl_371" style="word-spacing:-0.259em;">&nbsp;is</span><span class="stl_10 stl_11 stl_371" style="word-spacing:-0.071em;">&nbsp;,</span><span class="stl_10 stl_11 stl_371" style="word-spacing:-0.236em;">&nbsp;value</span><span class="stl_10 stl_11 stl_371" style="word-spacing:-0.25em;">&nbsp;,&amp;pos</span><span class="stl_10 stl_11 stl_371" style="word-spacing:-0.303em;">&nbsp;)</span><span class="stl_10 stl_11 stl_371" style="word-spacing:-0.285em;">&nbsp;)</span><span class="stl_10 stl_11 stl_371" style="word-spacing:-0.285em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:12.03em;"><span class="stl_15 stl_16 stl_60" style="word-spacing:-0.3565em;">i f</span><span class="stl_15 stl_16 stl_60" style="word-spacing:0.3499em;">&nbsp;</span><span class="stl_10 stl_11 stl_60" style="word-spacing:0.3499em;">(</span><span class="stl_10 stl_11 stl_60" style="word-spacing:-0.2865em;">&nbsp;success</span><span class="stl_10 stl_11 stl_60" style="word-spacing:-0.2855em;">&nbsp;)</span><span class="stl_10 stl_11 stl_60" style="word-spacing:-0.059em;">&nbsp;* success</span><span class="stl_10 stl_11 stl_60" style="word-spacing:0.1195em;">&nbsp;=</span><span class="stl_10 stl_11 stl_60" style="word-spacing:0.1195em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:11.9308em;"><span class="stl_15 stl_16 stl_162">return</span><span class="stl_15 stl_16 stl_162" style="word-spacing:0.469em;">&nbsp;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.469em;">i</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.188em;">&nbsp;s</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.188em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.4132em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:0.575em;">/ r</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.085em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.084em;">&nbsp;a</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.085em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.084em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.085em;">&nbsp;o</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.085em;">&nbsp;c &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:10.0367em;z-index:277; "><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2332em;">i s</span><span class="stl_10 stl_11 stl_695" style="word-spacing:0.2668em;">&nbsp;= i</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;n</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2552em;">&nbsp;t</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;s</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;e</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2552em;">&nbsp;t</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;R</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;e</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2552em;">&nbsp;s</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;i</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2552em;">&nbsp;z</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;e</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1492em;">&nbsp;(</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1712em;">&nbsp;is</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.0764em;">&nbsp;, i</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;n</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;t</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;r</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;e</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;v</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;3</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;2</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;i</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2522em;">&nbsp;f</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;b</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;e</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1482em;">&nbsp;(</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1712em;">&nbsp;is</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2343em;">&nbsp;</span><span class="stl_107 stl_108 stl_695" style="word-spacing:-0.1712em;">−</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2343em;">&gt;length</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1792em;">&nbsp;)+1)</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1792em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:10.4132em;"><span class="stl_58 stl_59 stl_696">/</span><span class="stl_58 stl_59 stl_696" style="word-spacing:-0.0469em;">&nbsp;</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.0469em;">迁 移</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.3029em;">&nbsp;内</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.2689em;">&nbsp;存，</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.2699em;">&nbsp;腾</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.3029em;">&nbsp;出</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.3029em;">&nbsp;空</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.3029em;">&nbsp;间</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.3029em;">&nbsp;给</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.3029em;">&nbsp;新</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.3029em;">&nbsp;的</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.3029em;">&nbsp;数</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.2689em;">&nbsp;据。</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.2442em;">&nbsp;</span><span class="stl_58 stl_59 stl_696" style="word-spacing:-0.2442em;">intsetMoveTail</span><span class="stl_58 stl_59 stl_696" style="word-spacing:-0.2509em;">&nbsp;()</span><span class="stl_58 stl_59 stl_696" style="word-spacing:0.3248em;">&nbsp;</span><span class="stl_17 stl_18 stl_696" style="word-spacing:-0.2509em;">完 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.889em; left:11.6342em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">成 内 存 迁 移 工 作 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:10.0375em;z-index:353; "><span class="stl_15 stl_16 stl_86" style="word-spacing:-0.2799em;">i f</span><span class="stl_15 stl_16 stl_86" style="word-spacing:0.4265em;">&nbsp;</span><span class="stl_10 stl_11 stl_86" style="word-spacing:0.4265em;">(</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2629em;">&nbsp;pos</span><span class="stl_10 stl_11 stl_86" style="word-spacing:0.1131em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.0597em;">&nbsp;i n</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2999em;">&nbsp;t</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2989em;">&nbsp;r</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2999em;">&nbsp;e</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2999em;">&nbsp;v</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2999em;">&nbsp;3</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2999em;">&nbsp;2</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2999em;">&nbsp;i</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2999em;">&nbsp;f</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2999em;">&nbsp;b</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2999em;">&nbsp;e</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.1939em;">&nbsp;(</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2189em;">&nbsp;is</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2807em;">&nbsp;</span><span class="stl_107 stl_108 stl_86" style="word-spacing:-0.2189em;">−</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2807em;">&gt;length</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2249em;">&nbsp;)</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2449em;">&nbsp;)</span><span class="stl_10 stl_11 stl_86" style="word-spacing:0.3682em;">&nbsp;intsetMoveTail</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2319em;">&nbsp;(</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2179em;">&nbsp;is &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:11.685em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 21.6593em; left:12.1068em;"><span class="stl_10 stl_11 stl_697" style="word-spacing:-0.1454em;">pos , pos+1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_71">//</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.3918em;">&nbsp;</span><span class="stl_17 stl_18 stl_71" style="word-spacing:0.3918em;">在</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.169em;">&nbsp;腾</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;出</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;的</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;空</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;间</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;中</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;设</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;置</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;新</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;的</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;数</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:8.0042em;"><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.212em;">_intsetSet ( is , pos , value ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">更</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;新</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6214em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6214em;">i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;n</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.079em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.078em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.684em;">&nbsp;s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.087em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.087em;">&nbsp;z</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.087em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:8.0075em;z-index:486; "><span class="stl_10 stl_11 stl_223">is</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2259em;">&nbsp;</span><span class="stl_107 stl_108 stl_223">−</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2259em;">&gt;length</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.2345em;">&nbsp;=</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.2655em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;n</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;t</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;r</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;v</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;3</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2445em;">&nbsp;2</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;f</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;b</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1405em;">&nbsp;(</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1395em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;n</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;t</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;r</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;v</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2445em;">&nbsp;3</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;2</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;f</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;b</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1395em;">&nbsp;(</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1645em;">&nbsp;is</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2272em;">&nbsp;</span><span class="stl_107 stl_108 stl_223" style="word-spacing:-0.1645em;">−</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2272em;">&gt;length</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1705em;">&nbsp;)+1)</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1705em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6243em; left:7.9458em;"><span class="stl_15 stl_16 stl_162">return</span><span class="stl_15 stl_16 stl_162" style="word-spacing:0.469em;">&nbsp;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.469em;">i</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.188em;">&nbsp;s</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.188em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 32.6201em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:6.4282em;z-index:526; "><span class="stl_58 stl_59 stl_370">/</span><span class="stl_58 stl_59 stl_370" style="word-spacing:0.3372em;">&nbsp;</span><span class="stl_17 stl_18 stl_370" style="word-spacing:0.3372em;">升</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2236em;">&nbsp;级</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;整</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;数</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;类</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.1896em;">&nbsp;型，</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.1896em;">&nbsp;譬</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;如</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;从</span><span class="stl_17 stl_18 stl_370" style="word-spacing:0.3941em;">&nbsp;</span><span class="stl_58 stl_59 stl_370" style="word-spacing:0.3941em;">short</span><span class="stl_107 stl_108 stl_370" style="word-spacing:0.3941em;">−</span><span class="stl_58 stl_59 stl_370" style="word-spacing:0.3941em;">&gt;in</span><span class="stl_58 stl_59 stl_370" style="word-spacing:-0.2726em;">&nbsp;t</span><span class="stl_58 stl_59 stl_370" style="word-spacing:-0.173em;">&nbsp;</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.173em;">。</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;当</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;插</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;入</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;数</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;据</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;的</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;内</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;存</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;占</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;用</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;比</span><span class="stl_17 stl_18 stl_370" style="word-spacing:-0.2226em;">&nbsp;原 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.8365em; left:7.6492em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0503em;">有 数 据 大 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:6.4282em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">的 时</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;候，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;会</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;被</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;调</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:6.4282em;"><span class="stl_58 stl_59 stl_699" style="word-spacing:0.2972em;">* Upgrades</span><span class="stl_58 stl_59 stl_699" style="word-spacing:0.3622em;">&nbsp;the</span><span class="stl_58 stl_59 stl_699" style="word-spacing:0.4472em;">&nbsp;i</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2768em;">&nbsp;n</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2768em;">&nbsp;t</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2758em;">&nbsp;s</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2768em;">&nbsp;e</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2768em;">&nbsp;t</span><span class="stl_58 stl_59 stl_699" style="word-spacing:0.4422em;">&nbsp;to</span><span class="stl_58 stl_59 stl_699" style="word-spacing:0.3327em;">&nbsp;a l</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2948em;">&nbsp;a</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2958em;">&nbsp;r</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2948em;">&nbsp;g</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2948em;">&nbsp;e</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2958em;">&nbsp;r</span><span class="stl_58 stl_59 stl_699" style="word-spacing:0.4132em;">&nbsp;encoding</span><span class="stl_58 stl_59 stl_699" style="word-spacing:0.3132em;">&nbsp;and</span><span class="stl_58 stl_59 stl_699" style="word-spacing:0.3692em;">&nbsp;i</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2858em;">&nbsp;n</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2858em;">&nbsp;s</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2848em;">&nbsp;e</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2858em;">&nbsp;r</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2848em;">&nbsp;t</span><span class="stl_58 stl_59 stl_699" style="word-spacing:-0.2858em;">&nbsp;s</span><span class="stl_58 stl_59 stl_699" style="word-spacing:0.4392em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:7.67em;"><span class="stl_58 stl_59 stl_96" style="word-spacing:0.3679em;">given in</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3571em;">&nbsp;t</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3571em;">&nbsp;eger</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.2111em;">&nbsp;.</span><span class="stl_58 stl_59 stl_96" style="word-spacing:0.2989em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:6.0075em;"><span class="stl_15 stl_16 stl_700">static</span><span class="stl_15 stl_16 stl_700" style="word-spacing:0.4478em;">&nbsp;</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.4478em;">i</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2779em;">&nbsp;n</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2759em;">&nbsp;t</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2769em;">&nbsp;s</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2769em;">&nbsp;e</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2759em;">&nbsp;t</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.3731em;">&nbsp;*intsetUpgradeAndAdd</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2589em;">&nbsp;(</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.1719em;">&nbsp;i</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2759em;">&nbsp;n</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2769em;">&nbsp;t</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2769em;">&nbsp;s</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2759em;">&nbsp;e</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2769em;">&nbsp;t</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.3731em;">&nbsp;*</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2589em;">&nbsp;is</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.0159em;">&nbsp;,</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.4251em;">&nbsp;int64_t</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.3801em;">&nbsp;value</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.3801em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:8.1058em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.9792em;z-index:708; "><span class="stl_10 stl_11 stl_701" style="word-spacing:0.3803em;">uint8_t curenc</span><span class="stl_10 stl_11 stl_701" style="word-spacing:0.1933em;">&nbsp;=</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.0304em;">&nbsp;i n</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2707em;">&nbsp;t</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2707em;">&nbsp;r</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2707em;">&nbsp;e</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2707em;">&nbsp;v</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2697em;">&nbsp;3</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2707em;">&nbsp;2</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2707em;">&nbsp;i</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2707em;">&nbsp;f</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2707em;">&nbsp;b</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2707em;">&nbsp;e</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.1647em;">&nbsp;(</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.1897em;">&nbsp;is</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2513em;">&nbsp;</span><span class="stl_107 stl_108 stl_701" style="word-spacing:-0.1897em;">−</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2513em;">&gt;encoding</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2137em;">&nbsp;)</span><span class="stl_10 stl_11 stl_701" style="word-spacing:-0.2137em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:7.9792em;"><span class="stl_10 stl_11 stl_290" style="word-spacing:0.313em;">uint8_t newenc</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.126em;">&nbsp;=</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.067em;">&nbsp;_intsetValueEncoding (</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.226em;">&nbsp;value</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.225em;">&nbsp;)</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.225em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5793em; left:7.98em;z-index:787; "><span class="stl_15 stl_16 stl_557">int</span><span class="stl_15 stl_16 stl_557" style="word-spacing:0.383em;">&nbsp;</span><span class="stl_10 stl_11 stl_557" style="word-spacing:0.383em;">length</span><span class="stl_10 stl_11 stl_557" style="word-spacing:0.194em;">&nbsp;=</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.0611em;">&nbsp;i n</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.286em;">&nbsp;t</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.286em;">&nbsp;r</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.286em;">&nbsp;e</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.286em;">&nbsp;v</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.286em;">&nbsp;3</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.286em;">&nbsp;2</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.285em;">&nbsp;i</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.286em;">&nbsp;f</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.286em;">&nbsp;b</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.286em;">&nbsp;e</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.181em;">&nbsp;(</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.204em;">&nbsp;is</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.2675em;">&nbsp;</span><span class="stl_107 stl_108 stl_557" style="word-spacing:-0.204em;">−</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.2675em;">&gt;length</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.211em;">&nbsp;)</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.211em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:8.4207em;"><span class="stl_58 stl_59 stl_264" style="word-spacing:0.3451em;">/ value</span><span class="stl_58 stl_59 stl_264" style="word-spacing:-0.2329em;">&nbsp;&lt;0</span><span class="stl_58 stl_59 stl_264" style="word-spacing:0.2447em;">&nbsp;</span><span class="stl_17 stl_18 stl_264" style="word-spacing:0.2447em;">头</span><span class="stl_17 stl_18 stl_264" style="word-spacing:-0.1919em;">&nbsp;插，</span><span class="stl_17 stl_18 stl_264" style="word-spacing:-0.1806em;">&nbsp;</span><span class="stl_58 stl_59 stl_264" style="word-spacing:-0.1806em;">value</span><span class="stl_58 stl_59 stl_264" style="word-spacing:-0.2329em;">&nbsp;&gt;0</span><span class="stl_58 stl_59 stl_264" style="word-spacing:0.2448em;">&nbsp;</span><span class="stl_17 stl_18 stl_264" style="word-spacing:0.2448em;">尾</span><span class="stl_17 stl_18 stl_264" style="word-spacing:0.2448em;">&nbsp;插 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5685em; left:7.98em;"><span class="stl_15 stl_16 stl_553">int</span><span class="stl_15 stl_16 stl_553" style="word-spacing:0.3326em;">&nbsp;</span><span class="stl_10 stl_11 stl_553" style="word-spacing:0.3326em;">prepend</span><span class="stl_10 stl_11 stl_553" style="word-spacing:0.1448em;">&nbsp;=</span><span class="stl_10 stl_11 stl_553" style="word-spacing:0.1738em;">&nbsp;value</span><span class="stl_10 stl_11 stl_553" style="word-spacing:0.1408em;">&nbsp;&lt; 0</span><span class="stl_10 stl_11 stl_553" style="word-spacing:0.2608em;">&nbsp;? 1</span><span class="stl_10 stl_11 stl_553" style="word-spacing:0.3578em;">&nbsp;:</span><span class="stl_10 stl_11 stl_553" style="word-spacing:0.4488em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.5676em; left:8.4207em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:0.574em;">/ r</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.084em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.085em;">&nbsp;a</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.084em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.084em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.085em;">&nbsp;o</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.085em;">&nbsp;c &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">10.3. INTSET</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0837em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0837em;">插入 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">77 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_702" style="word-spacing:0.3538em;">* First</span><span class="stl_58 stl_59 stl_702" style="word-spacing:0.4448em;">&nbsp;s</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.3012em;">&nbsp;et</span><span class="stl_58 stl_59 stl_702" style="word-spacing:0.3278em;">&nbsp;new</span><span class="stl_58 stl_59 stl_702" style="word-spacing:0.2973em;">&nbsp;encoding and</span><span class="stl_58 stl_59 stl_702" style="word-spacing:0.3648em;">&nbsp;r</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2892em;">&nbsp;e</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2892em;">&nbsp;s</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2892em;">&nbsp;i</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2902em;">&nbsp;z</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2892em;">&nbsp;e</span><span class="stl_58 stl_59 stl_702" style="word-spacing:0.3708em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:8.0075em;z-index:50; "><span class="stl_10 stl_11 stl_612">is</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2123em;">&nbsp;</span><span class="stl_107 stl_108 stl_612">−</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2123em;">&gt;encoding</span><span class="stl_10 stl_11 stl_612" style="word-spacing:0.2301em;">&nbsp;=</span><span class="stl_10 stl_11 stl_612" style="word-spacing:0.2791em;">&nbsp;i</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2319em;">&nbsp;n</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2319em;">&nbsp;t</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2319em;">&nbsp;r</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2319em;">&nbsp;e</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2319em;">&nbsp;v</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2319em;">&nbsp;3</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2309em;">&nbsp;2</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2319em;">&nbsp;i</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2319em;">&nbsp;f</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2319em;">&nbsp;b</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2319em;">&nbsp;e</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.1269em;">&nbsp;(</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2199em;">&nbsp;newenc</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2199em;">&nbsp;)</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.2199em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:8.0442em;z-index:116; "><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2332em;">i s</span><span class="stl_10 stl_11 stl_695" style="word-spacing:0.2668em;">&nbsp;= i</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;n</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2552em;">&nbsp;t</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;s</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;e</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2552em;">&nbsp;t</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;R</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;e</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2552em;">&nbsp;s</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;i</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2552em;">&nbsp;z</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2542em;">&nbsp;e</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1492em;">&nbsp;(</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1712em;">&nbsp;is</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.0764em;">&nbsp;, i</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;n</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;t</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;r</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;e</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;v</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;3</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;2</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;i</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2522em;">&nbsp;f</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;b</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2532em;">&nbsp;e</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1482em;">&nbsp;(</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1712em;">&nbsp;is</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2343em;">&nbsp;</span><span class="stl_107 stl_108 stl_695" style="word-spacing:-0.1712em;">−</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.2343em;">&gt;length</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1792em;">&nbsp;)+1)</span><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1792em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4207em;"><span class="stl_58 stl_59 stl_581">/</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.0752em;">&nbsp;</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.0752em;">逆 向</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;处</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;理，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;防</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;止</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;数</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;据</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;被</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;覆</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.283em;">&nbsp;盖，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;一</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;般</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;的</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;插</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;入</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;排</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;序</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;步</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;骤 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4207em;z-index:169; "><span class="stl_58 stl_59 stl_267" style="word-spacing:0.2898em;">* Upgrade back</span><span class="stl_107 stl_108 stl_267" style="word-spacing:0.2898em;">−</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.2898em;">to</span><span class="stl_107 stl_108 stl_267" style="word-spacing:0.2898em;">−</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.2898em;">front</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.3828em;">&nbsp;so</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.2638em;">&nbsp;we</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.2238em;">&nbsp;don</span><span class="stl_58 stl_59 stl_267" style="word-spacing:-0.2052em;">&nbsp;’</span><span class="stl_58 stl_59 stl_267" style="word-spacing:-0.2242em;">&nbsp;t</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.4173em;">&nbsp;overwrite values</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.4173em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 11.6985em; left:9.4512em;z-index:211; "><span class="stl_58 stl_59 stl_94" style="word-spacing:0.3637em;">Note that</span><span class="stl_58 stl_59 stl_94" style="word-spacing:0.4167em;">&nbsp;the</span><span class="stl_58 stl_59 stl_94" style="word-spacing:0.3452em;">&nbsp;”prepend” v</span><span class="stl_58 stl_59 stl_94" style="word-spacing:-0.2933em;">&nbsp;a</span><span class="stl_58 stl_59 stl_94" style="word-spacing:-0.2933em;">&nbsp;r</span><span class="stl_58 stl_59 stl_94" style="word-spacing:-0.2933em;">&nbsp;i</span><span class="stl_58 stl_59 stl_94" style="word-spacing:-0.2933em;">&nbsp;a</span><span class="stl_58 stl_59 stl_94" style="word-spacing:-0.2933em;">&nbsp;b</span><span class="stl_58 stl_59 stl_94" style="word-spacing:-0.2933em;">&nbsp;l</span><span class="stl_58 stl_59 stl_94" style="word-spacing:-0.2933em;">&nbsp;e</span><span class="stl_58 stl_59 stl_94" style="word-spacing:0.4677em;">&nbsp;i</span><span class="stl_58 stl_59 stl_94" style="word-spacing:-0.2883em;">&nbsp;s</span><span class="stl_58 stl_59 stl_94" style="word-spacing:0.4077em;">&nbsp;used</span><span class="stl_58 stl_59 stl_94" style="word-spacing:0.3657em;">&nbsp;to</span><span class="stl_58 stl_59 stl_94" style="word-spacing:0.2967em;">&nbsp;make</span><span class="stl_58 stl_59 stl_94" style="word-spacing:0.2967em;">&nbsp;sure &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:10.0775em;"><span class="stl_58 stl_59 stl_120" style="word-spacing:0.3354em;">we have an empty &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:9.4819em;"><span class="stl_58 stl_59 stl_703" style="word-spacing:0.346em;">space at</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.396em;">&nbsp;e</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.323em;">&nbsp;i</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.322em;">&nbsp;t</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.323em;">&nbsp;h</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.323em;">&nbsp;e</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.322em;">&nbsp;r</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.385em;">&nbsp;the beginning</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.3222em;">&nbsp;or the end of</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.37em;">&nbsp;the</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.414em;">&nbsp;i</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.31em;">&nbsp;n</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.309em;">&nbsp;t</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.31em;">&nbsp;s</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.31em;">&nbsp;e</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.31em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:10.1783em;"><span class="stl_58 stl_59 stl_07">.</span></div>
					<div class="stl_01" style="top: 14.6876em; left:11.1016em;"><span class="stl_58 stl_59 stl_132">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:7.9483em;z-index:319; "><span class="stl_15 stl_16 stl_704" style="word-spacing:-0.1875em;">while </span><span class="stl_10 stl_11 stl_704" style="word-spacing:-0.1875em;">( length </span><span class="stl_107 stl_108 stl_704" style="word-spacing:-0.1875em;">−−</span><span class="stl_10 stl_11 stl_704" style="word-spacing:-0.1875em;">) &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:10.7256em;"><span class="stl_10 stl_11 stl_563" style="word-spacing:-0.1585em;">intsetSet ( is , length+prepend , _intsetGetEncoded ( is , &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:11.6417em;"><span class="stl_10 stl_11 stl_171" style="word-spacing:-0.2em;">length , curenc ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:9.9975em;"><span class="stl_10 stl_11 stl_07">_</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4207em;"><span class="stl_58 stl_59 stl_705" style="word-spacing:0.3254em;">/ value</span><span class="stl_58 stl_59 stl_705" style="word-spacing:-0.2526em;">&nbsp;&lt;0</span><span class="stl_58 stl_59 stl_705" style="word-spacing:-0.0206em;">&nbsp;</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.0206em;">放 在</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2446em;">&nbsp;集</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2446em;">&nbsp;合</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2446em;">&nbsp;开</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2106em;">&nbsp;头，</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2116em;">&nbsp;否</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2446em;">&nbsp;则</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2446em;">&nbsp;放</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2446em;">&nbsp;在</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2446em;">&nbsp;集</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2446em;">&nbsp;合</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2446em;">&nbsp;末</span><span class="stl_17 stl_18 stl_705" style="word-spacing:-0.2106em;">&nbsp;尾。 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:8.4207em;"><span class="stl_58 stl_59 stl_706">/</span><span class="stl_58 stl_59 stl_706" style="word-spacing:-0.0309em;">&nbsp;</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.0309em;">因 为，</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.2783em;">&nbsp;此</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;函</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;数</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;是</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;对</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;整</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;数</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;所</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;占</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;内</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;存</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;进</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;行</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;升</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.2773em;">&nbsp;级，</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.2783em;">&nbsp;意</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;味</span><span class="stl_17 stl_18 stl_706" style="word-spacing:-0.3113em;">&nbsp;着</span><span class="stl_17 stl_18 stl_706" style="word-spacing:0.3177em;">&nbsp;</span><span class="stl_58 stl_59 stl_706" style="word-spacing:0.3177em;">value</span><span class="stl_58 stl_59 stl_706" style="word-spacing:0.3189em;">&nbsp;</span><span class="stl_17 stl_18 stl_706" style="word-spacing:0.3177em;">不 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.8815em; left:9.6417em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3127em;">是 在 集 合 中 最 大 就 是 最 小！ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_451" style="word-spacing:0.2882em;">* Set</span><span class="stl_58 stl_59 stl_451" style="word-spacing:0.3642em;">&nbsp;the value at the beginning</span><span class="stl_58 stl_59 stl_451" style="word-spacing:0.3246em;">&nbsp;or the end</span><span class="stl_58 stl_59 stl_451" style="word-spacing:-0.2688em;">&nbsp;.</span><span class="stl_58 stl_59 stl_451" style="word-spacing:0.3242em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:8.045em;"><span class="stl_15 stl_16 stl_707" style="word-spacing:-0.248em;">i f</span><span class="stl_15 stl_16 stl_707" style="word-spacing:0.4584em;">&nbsp;</span><span class="stl_10 stl_11 stl_707" style="word-spacing:0.4584em;">(</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.232em;">&nbsp;prepend</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.232em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:9.9975em;"><span class="stl_10 stl_11 stl_07">_</span></div>
					<div class="stl_01" style="top: 24.6485em; left:10.7256em;"><span class="stl_10 stl_11 stl_708" style="word-spacing:-0.239em;">intsetSet ( is , 0 , value ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6393em; left:7.9933em;"><span class="stl_15 stl_16 stl_443">else &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.9975em;"><span class="stl_10 stl_11 stl_07">_</span></div>
					<div class="stl_01" style="top: 26.641em; left:10.7256em;z-index:559; "><span class="stl_10 stl_11 stl_279" style="word-spacing:-0.2517em;">intsetSet ( is , i n t r e v 3 2 i f b e ( is </span><span class="stl_107 stl_108 stl_279" style="word-spacing:-0.2517em;">−</span><span class="stl_10 stl_11 stl_279" style="word-spacing:-0.2517em;">&gt;length ) , value ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_709">/</span><span class="stl_58 stl_59 stl_709" style="word-spacing:-0.0696em;">&nbsp;</span><span class="stl_17 stl_18 stl_709" style="word-spacing:-0.0696em;">更 新</span><span class="stl_17 stl_18 stl_709" style="word-spacing:0.3013em;">&nbsp;</span><span class="stl_58 stl_59 stl_709" style="word-spacing:0.3013em;">set</span><span class="stl_58 stl_59 stl_709" style="word-spacing:-0.022em;">&nbsp;s i</span><span class="stl_58 stl_59 stl_709" style="word-spacing:-0.386em;">&nbsp;z</span><span class="stl_58 stl_59 stl_709" style="word-spacing:-0.386em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:8.0075em;z-index:626; "><span class="stl_10 stl_11 stl_223">is</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2259em;">&nbsp;</span><span class="stl_107 stl_108 stl_223">−</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2259em;">&gt;length</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.2345em;">&nbsp;=</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.2655em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;n</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;t</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;r</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;v</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;3</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2445em;">&nbsp;2</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;f</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;b</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1405em;">&nbsp;(</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1395em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;n</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;t</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;r</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;v</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2445em;">&nbsp;3</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;2</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;f</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;b</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2455em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1395em;">&nbsp;(</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1645em;">&nbsp;is</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2272em;">&nbsp;</span><span class="stl_107 stl_108 stl_223" style="word-spacing:-0.1645em;">−</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2272em;">&gt;length</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1705em;">&nbsp;)+1)</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1705em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:7.9458em;"><span class="stl_15 stl_16 stl_162">return</span><span class="stl_15 stl_16 stl_162" style="word-spacing:0.469em;">&nbsp;</span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.469em;">i</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.188em;">&nbsp;s</span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.188em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">78 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:20.8517em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 10.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">INTSET &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 18.5239em; left:17.9217em;"><span class="stl_36 stl_13 stl_486" style="word-spacing:0.1112em;">Part III &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2839em; left:14.3092em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1251em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1251em;">内功心法 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">7</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">9</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02" />
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 11.0347em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 11 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.9056em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1247em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1247em;">数据淘汰机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.8216em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 20.8216em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">1.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">概述 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.271em; left:7.5658em;"><span class="stl_17 stl_18 stl_317" style="word-spacing:0.0737em;">在 </span><span class="stl_10 stl_11 stl_317" style="word-spacing:0.0737em;">redis </span><span class="stl_17 stl_18 stl_317" style="word-spacing:0.0737em;">中，允许用户设置最大使用内存大小 </span><span class="stl_10 stl_11 stl_317" style="word-spacing:0.0737em;">server.maxmemory</span><span class="stl_17 stl_18 stl_317" style="word-spacing:0.0737em;">，在内存限定的 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.2668em; left:5.9058em;"><span class="stl_17 stl_18 stl_23" style="word-spacing:0.084em;">情况下是很有用的。譬如，在一台 </span><span class="stl_10 stl_11 stl_23" style="word-spacing:0.084em;">8G </span><span class="stl_17 stl_18 stl_23" style="word-spacing:0.084em;">机子上部署了 </span><span class="stl_10 stl_11 stl_23" style="word-spacing:0.084em;">4 </span><span class="stl_17 stl_18 stl_23" style="word-spacing:0.084em;">个 </span><span class="stl_10 stl_11 stl_23" style="word-spacing:0.084em;">redis </span><span class="stl_17 stl_18 stl_23" style="word-spacing:0.084em;">服务点，每一个服务 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.2635em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">点分配 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">1.5G </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">的内存大小，减少内存紧张的情况，由此获取更为稳健的服务。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.3668em; left:7.5658em;"><span class="stl_10 stl_11 stl_710" style="word-spacing:0.0857em;">redis </span><span class="stl_17 stl_18 stl_710" style="word-spacing:0.0857em;">内存数据集大小上升到一定大小的时候，就会施行数据淘汰策略。</span><span class="stl_10 stl_11 stl_710" style="word-spacing:0.0857em;">redis </span><span class="stl_17 stl_18 stl_710" style="word-spacing:0.0857em;">提 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.3626em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">供 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">6 </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">种数据淘汰策略： &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6335em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 33.7335em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 36.8335em; left:6.92em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 30.6335em; left:7.3351em;"><span class="stl_10 stl_11 stl_711" style="word-spacing:0.2647em;">. volatile-lru</span><span class="stl_17 stl_18 stl_711" style="word-spacing:0.2647em;">：从已设置过期时间的数据集（</span><span class="stl_10 stl_11 stl_711" style="word-spacing:0.2647em;">server.db[i].expires</span><span class="stl_17 stl_18 stl_711" style="word-spacing:0.2647em;">）中挑选最近最少 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.8515em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">使用的数据淘汰 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.7335em; left:7.3351em;"><span class="stl_10 stl_11 stl_712" style="word-spacing:0.2583em;">. volatile-ttl</span><span class="stl_17 stl_18 stl_712" style="word-spacing:0.2583em;">：从已设置过期时间的数据集（</span><span class="stl_10 stl_11 stl_712" style="word-spacing:0.2583em;">server.db[i].expires</span><span class="stl_17 stl_18 stl_712" style="word-spacing:0.2583em;">）中挑选将要过期 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.9515em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">的数据淘汰 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.8335em; left:7.3351em;"><span class="stl_10 stl_11 stl_713" style="word-spacing:0.2686em;">. volatile-random</span><span class="stl_17 stl_18 stl_713" style="word-spacing:0.2686em;">：从已设置过期时间的数据集（</span><span class="stl_10 stl_11 stl_713" style="word-spacing:0.2686em;">server.db[i].expires</span><span class="stl_17 stl_18 stl_713" style="word-spacing:0.2686em;">）中任意选择 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.0523em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">数据淘汰 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.9343em; left:6.92em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 42.0385em; left:6.92em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 44.1427em; left:6.92em;"><span class="stl_10 stl_11 stl_07">6</span></div>
					<div class="stl_01" style="top: 39.9343em; left:7.3351em;"><span class="stl_10 stl_11 stl_426" style="word-spacing:0.2521em;">. allkeys-lru</span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.2521em;">：从数据集（</span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.2521em;">server.db[i].dict</span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.2521em;">）中挑选最近最少使用的数据淘汰 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.0385em; left:7.3351em;"><span class="stl_10 stl_11 stl_426" style="word-spacing:0.2522em;">. allkeys-random</span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.2522em;">：从数据集（</span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.2522em;">server.db[i].dict</span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.2522em;">）中任意选择数据淘汰 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.1427em; left:7.3351em;"><span class="stl_10 stl_11 stl_714" style="word-spacing:0.2977em;">. no-enviction</span><span class="stl_17 stl_18 stl_714" style="word-spacing:0.2977em;">（驱逐）：禁止驱逐数据 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.5658em;"><span class="stl_10 stl_11 stl_115" style="word-spacing:0.0841em;">redis </span><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0841em;">确定驱逐某个键值对后，会删除这个数据并，并将这个数据变更消息发布 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;z-index:563; "><span class="stl_17 stl_18 stl_715" style="word-spacing:0.1377em;">到本地（</span><span class="stl_10 stl_11 stl_715" style="word-spacing:0.1377em;">AOF </span><span class="stl_17 stl_18 stl_715" style="word-spacing:0.1377em;">持久化）和从机（主从连接）。 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">8</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">1</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">82 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.6158em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 11.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">数据淘汰机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4507em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.4507em; left:6.5789em;"><span class="stl_38 stl_13 stl_331" style="word-spacing:0.7557em;">1.2 LRU</span><span class="stl_38 stl_13 stl_331" style="word-spacing:0.1313em;">&nbsp;</span><span class="stl_39 stl_18 stl_331" style="word-spacing:0.1313em;">数据淘汰机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.8085em; left:7.5658em;"><span class="stl_17 stl_18 stl_358" style="word-spacing:0.0572em;">在服务器配置中保存了 </span><span class="stl_10 stl_11 stl_358" style="word-spacing:0.0572em;">lru </span><span class="stl_17 stl_18 stl_358" style="word-spacing:0.0572em;">计数器 </span><span class="stl_10 stl_11 stl_358" style="word-spacing:0.0572em;">server.lrulock</span><span class="stl_17 stl_18 stl_358" style="word-spacing:0.0572em;">，会定时（</span><span class="stl_10 stl_11 stl_358" style="word-spacing:0.0572em;">redis </span><span class="stl_17 stl_18 stl_358" style="word-spacing:0.0572em;">定时程序 </span><span class="stl_10 stl_11 stl_358" style="word-spacing:0.0572em;">server- &nbsp;</span></div>
					<div class="stl_01" style="top: 8.8051em; left:5.9058em;"><span class="stl_10 stl_11 stl_426" style="word-spacing:0.085em;">Corn()</span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.085em;">）更新，</span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.085em;">server.lrulock </span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.085em;">的值是根据 </span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.085em;">server.unixtime </span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.085em;">计算出来的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.8593em; left:7.5658em;"><span class="stl_17 stl_18 stl_27" style="word-spacing:0.075em;">另外，从 </span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.075em;">struct redisObject </span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.075em;">中可以发现，每一个 </span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.075em;">redis </span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.075em;">对象都会设置相应的 </span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.075em;">lru</span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.075em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.856em; left:5.9058em;"><span class="stl_17 stl_18 stl_716" style="word-spacing:0.0803em;">可以想象的是，每一次访问数据的时候，会更新 </span><span class="stl_10 stl_11 stl_716" style="word-spacing:0.0803em;">redisObject.lru</span><span class="stl_17 stl_18 stl_716" style="word-spacing:0.0803em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.9101em; left:7.5658em;"><span class="stl_10 stl_11 stl_316" style="word-spacing:0.076em;">LRU </span><span class="stl_17 stl_18 stl_316" style="word-spacing:0.076em;">数据淘汰机制是这样的：在数据集中随机挑选几个键值对，取出其中 </span><span class="stl_10 stl_11 stl_316" style="word-spacing:0.076em;">lru </span><span class="stl_17 stl_18 stl_316" style="word-spacing:0.076em;">最 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.906em; left:5.9058em;z-index:275; "><span class="stl_17 stl_18 stl_510" style="word-spacing:0.078em;">大的键值对淘汰。所以，你会发现，</span><span class="stl_10 stl_11 stl_510" style="word-spacing:0.078em;">redis </span><span class="stl_17 stl_18 stl_510" style="word-spacing:0.078em;">并不是保证取得所有数据集中最近最少使用 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.1248em; left:5.435em;"><span class="stl_17 stl_18 stl_07">（</span></div>
					<div class="stl_01" style="top: 15.9026em; left:6.2658em;"><span class="stl_10 stl_11 stl_426">LRU</span><span class="stl_17 stl_18 stl_426">）的键值对，而只是随机挑选的几个键值对中的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5185em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.5185em; left:6.4282em;"><span class="stl_58 stl_59 stl_717" style="word-spacing:0.2655em;">/ redisServer</span><span class="stl_58 stl_59 stl_717" style="word-spacing:-0.0296em;">&nbsp;</span><span class="stl_17 stl_18 stl_717" style="word-spacing:-0.0296em;">保 存</span><span class="stl_17 stl_18 stl_717" style="word-spacing:-0.3355em;">&nbsp;了</span><span class="stl_17 stl_18 stl_717" style="word-spacing:0.3112em;">&nbsp;</span><span class="stl_58 stl_59 stl_717" style="word-spacing:0.3112em;">lru</span><span class="stl_58 stl_59 stl_717" style="word-spacing:-0.0243em;">&nbsp;</span><span class="stl_17 stl_18 stl_717" style="word-spacing:-0.0243em;">计 数</span><span class="stl_17 stl_18 stl_717" style="word-spacing:-0.0243em;">&nbsp;器 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.5085em; left:5.98em;"><span class="stl_15 stl_16 stl_718">struct</span><span class="stl_15 stl_16 stl_718" style="word-spacing:0.3313em;">&nbsp;</span><span class="stl_10 stl_11 stl_718" style="word-spacing:0.3313em;">redisServer</span><span class="stl_10 stl_11 stl_718" style="word-spacing:0.3313em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5093em; left:8.0983em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 20.5093em; left:8.5292em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.008em;">. . &nbsp;</span></div>
					<div class="stl_01" style="top: 21.501em; left:7.9325em;"><span class="stl_15 stl_16 stl_719">unsigned</span><span class="stl_15 stl_16 stl_719" style="word-spacing:0.4627em;">&nbsp;</span><span class="stl_10 stl_11 stl_719" style="word-spacing:0.4627em;">l</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.1787em;">&nbsp;r</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.1777em;">&nbsp;u</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.1787em;">&nbsp;c</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.1787em;">&nbsp;l</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.1777em;">&nbsp;o</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.1787em;">&nbsp;c</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.1787em;">&nbsp;k</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.0097em;">&nbsp;:</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.1627em;">&nbsp;2</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.1627em;">&nbsp;2</span><span class="stl_10 stl_11 stl_719" style="word-spacing:-0.1627em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.5076em; left:21.895em;"><span class="stl_58 stl_59 stl_579" style="word-spacing:0.2899em;">/* Clock</span><span class="stl_58 stl_59 stl_579" style="word-spacing:0.3544em;">&nbsp;incrementing</span><span class="stl_58 stl_59 stl_579" style="word-spacing:0.3544em;">&nbsp;every &nbsp;</span></div>
					<div class="stl_01" style="top: 22.5035em; left:9.6192em;"><span class="stl_58 stl_59 stl_139" style="word-spacing:-0.068em;">minute ,</span><span class="stl_58 stl_59 stl_139" style="word-spacing:0.525em;">&nbsp;for</span><span class="stl_58 stl_59 stl_139" style="word-spacing:0.304em;">&nbsp;LRU</span><span class="stl_58 stl_59 stl_139" style="word-spacing:0.223em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.4985em; left:8.5292em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.008em;">. . &nbsp;</span></div>
					<div class="stl_01" style="top: 23.4985em; left:8.0983em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 24.4943em; left:6.0225em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.4943em; left:6.5539em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 26.4885em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.4885em; left:6.4282em;"><span class="stl_58 stl_59 stl_720">/</span><span class="stl_58 stl_59 stl_720" style="word-spacing:-0.1325em;">&nbsp;</span><span class="stl_17 stl_18 stl_720" style="word-spacing:-0.1325em;">每 一</span><span class="stl_17 stl_18 stl_720" style="word-spacing:-0.3457em;">&nbsp;个</span><span class="stl_17 stl_18 stl_720" style="word-spacing:0.303em;">&nbsp;</span><span class="stl_58 stl_59 stl_720" style="word-spacing:0.303em;">redis</span><span class="stl_58 stl_59 stl_720" style="word-spacing:-0.0432em;">&nbsp;</span><span class="stl_17 stl_18 stl_720" style="word-spacing:-0.0432em;">对 象</span><span class="stl_17 stl_18 stl_720" style="word-spacing:-0.3457em;">&nbsp;都</span><span class="stl_17 stl_18 stl_720" style="word-spacing:-0.3457em;">&nbsp;保</span><span class="stl_17 stl_18 stl_720" style="word-spacing:-0.3457em;">&nbsp;存</span><span class="stl_17 stl_18 stl_720" style="word-spacing:-0.3457em;">&nbsp;了</span><span class="stl_17 stl_18 stl_720" style="word-spacing:0.3004em;">&nbsp;</span><span class="stl_58 stl_59 stl_720" style="word-spacing:0.3004em;">lru &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4785em; left:6.4748em;z-index:505; "><span class="stl_15 stl_16 stl_41">define</span><span class="stl_15 stl_16 stl_41" style="word-spacing:0.3316em;">&nbsp;</span><span class="stl_10 stl_11 stl_41" style="word-spacing:0.3316em;">REDIS_LRU_CLOCK_MAX</span><span class="stl_10 stl_11 stl_41" style="word-spacing:0.2966em;">&nbsp;((1&lt;&lt;21)</span><span class="stl_107 stl_108 stl_41" style="word-spacing:0.2966em;">−</span><span class="stl_10 stl_11 stl_41" style="word-spacing:0.2966em;">1)</span><span class="stl_10 stl_11 stl_41" style="word-spacing:0.4365em;">&nbsp;</span><span class="stl_58 stl_59 stl_41" style="word-spacing:0.4365em;">/*</span><span class="stl_58 stl_59 stl_41" style="word-spacing:0.3925em;">&nbsp;Max</span><span class="stl_58 stl_59 stl_41" style="word-spacing:0.4606em;">&nbsp;value</span><span class="stl_58 stl_59 stl_41" style="word-spacing:0.5951em;">&nbsp;of</span><span class="stl_58 stl_59 stl_41" style="word-spacing:0.5951em;">&nbsp;obj</span><span class="stl_107 stl_108 stl_41" style="word-spacing:0.5951em;">−</span><span class="stl_58 stl_59 stl_41" style="word-spacing:0.5951em;">&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.481em; left:7.6875em;"><span class="stl_58 stl_59 stl_721" style="word-spacing:0.3203em;">lru */ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4785em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 29.471em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 29.471em; left:6.4748em;"><span class="stl_15 stl_16 stl_155">define</span><span class="stl_15 stl_16 stl_155" style="word-spacing:0.4006em;">&nbsp;</span><span class="stl_10 stl_11 stl_155" style="word-spacing:0.4006em;">REDIS_LRU_CLOCK_RESOLUTION 10</span><span class="stl_10 stl_11 stl_155" style="word-spacing:0.5331em;">&nbsp;</span><span class="stl_58 stl_59 stl_155" style="word-spacing:0.5331em;">/*</span><span class="stl_58 stl_59 stl_155" style="word-spacing:0.391em;">&nbsp;LRU</span><span class="stl_58 stl_59 stl_155" style="word-spacing:0.473em;">&nbsp;clock</span><span class="stl_58 stl_59 stl_155" style="word-spacing:0.703em;">&nbsp;r</span><span class="stl_58 stl_59 stl_155" style="word-spacing:-0.039em;">&nbsp;e</span><span class="stl_58 stl_59 stl_155" style="word-spacing:-0.039em;">&nbsp;s</span><span class="stl_58 stl_59 stl_155" style="word-spacing:-0.039em;">&nbsp;o</span><span class="stl_58 stl_59 stl_155" style="word-spacing:-0.039em;">&nbsp;l</span><span class="stl_58 stl_59 stl_155" style="word-spacing:-0.039em;">&nbsp;u</span><span class="stl_58 stl_59 stl_155" style="word-spacing:-0.04em;">&nbsp;t</span><span class="stl_58 stl_59 stl_155" style="word-spacing:-0.039em;">&nbsp;i</span><span class="stl_58 stl_59 stl_155" style="word-spacing:-0.039em;">&nbsp;o</span><span class="stl_58 stl_59 stl_155" style="word-spacing:-0.039em;">&nbsp;n &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4735em; left:8.1558em;"><span class="stl_58 stl_59 stl_722" style="word-spacing:0.363em;">in seconds</span><span class="stl_58 stl_59 stl_722" style="word-spacing:0.312em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4635em; left:5.9533em;"><span class="stl_15 stl_16 stl_433" style="word-spacing:0.2939em;">typedef struct</span><span class="stl_15 stl_16 stl_433" style="word-spacing:0.3715em;">&nbsp;</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.3715em;">redisObject</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.3715em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.466em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.466em; left:8.4207em;"><span class="stl_58 stl_59 stl_71">/</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.3918em;">&nbsp;</span><span class="stl_17 stl_18 stl_71" style="word-spacing:0.3918em;">刚</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.169em;">&nbsp;刚</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;好</span><span class="stl_17 stl_18 stl_71" style="word-spacing:0.3914em;">&nbsp;</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.3914em;">32</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.47em;">&nbsp;b</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.19em;">&nbsp;i</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.189em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.189em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4593em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.4593em; left:8.4207em;"><span class="stl_58 stl_59 stl_394">/</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.114em;">&nbsp;</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.114em;">对 象</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;的</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;类</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3034em;">&nbsp;型，</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3034em;">&nbsp;字</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;符</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;串</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.3364em;">/</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">列</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;表</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.3364em;">/</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">集</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3364em;">&nbsp;合</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.3364em;">/</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3374em;">哈</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3374em;">&nbsp;希</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3374em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4485em; left:7.9325em;"><span class="stl_15 stl_16 stl_395">unsigned</span><span class="stl_15 stl_16 stl_395" style="word-spacing:0.3732em;">&nbsp;</span><span class="stl_10 stl_11 stl_395" style="word-spacing:0.3732em;">type</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.082em;">&nbsp;:</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.179em;">&nbsp;4</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.179em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4518em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.4518em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">未</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;使</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;两</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;位 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:19.9025em;"><span class="stl_58 stl_59 stl_397" style="word-spacing:0.3159em;">/* Not</span><span class="stl_58 stl_59 stl_397" style="word-spacing:0.3559em;">&nbsp;used</span><span class="stl_58 stl_59 stl_397" style="word-spacing:0.3559em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4443em; left:8.4207em;"><span class="stl_58 stl_59 stl_398">/</span><span class="stl_58 stl_59 stl_398" style="word-spacing:-0.1159em;">&nbsp;</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.1159em;">编 码</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;的</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;方</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3043em;">&nbsp;式，</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.2555em;">&nbsp;</span><span class="stl_58 stl_59 stl_398" style="word-spacing:-0.2555em;">redis</span><span class="stl_58 stl_59 stl_398" style="word-spacing:-0.0265em;">&nbsp;</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.0265em;">为 了</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;节</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;省</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;空</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3043em;">&nbsp;间，</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3043em;">&nbsp;提</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;供</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;多</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;种</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;方</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;式</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;来</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;保</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;存</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;一</span><span class="stl_17 stl_18 stl_398" style="word-spacing:-0.3373em;">&nbsp;个 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.6607em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">数 据 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.441em; left:7.9325em;"><span class="stl_15 stl_16 stl_396">unsigned</span><span class="stl_15 stl_16 stl_396" style="word-spacing:0.3554em;">&nbsp;</span><span class="stl_10 stl_11 stl_396" style="word-spacing:0.3554em;">notused</span><span class="stl_10 stl_11 stl_396" style="word-spacing:-0.0998em;">&nbsp;:</span><span class="stl_10 stl_11 stl_396" style="word-spacing:-0.2008em;">&nbsp;2</span><span class="stl_10 stl_11 stl_396" style="word-spacing:-0.2008em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4443em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:8.4207em;"><span class="stl_58 stl_59 stl_399">/</span><span class="stl_58 stl_59 stl_399" style="word-spacing:0.3416em;">&nbsp;</span><span class="stl_17 stl_18 stl_399" style="word-spacing:0.3416em;">譬</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.1692em;">&nbsp;如</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2682em;">&nbsp;：“</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.1876em;">&nbsp;</span><span class="stl_58 stl_59 stl_399" style="word-spacing:-0.1876em;">123456789</span><span class="stl_58 stl_59 stl_399" style="word-spacing:-0.2372em;">&nbsp;</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2372em;">”</span><span class="stl_17 stl_18 stl_399" style="word-spacing:0.3808em;">&nbsp;会</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;被</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;存</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;储</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;为</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;整</span><span class="stl_17 stl_18 stl_399" style="word-spacing:-0.2182em;">&nbsp;数</span><span class="stl_17 stl_18 stl_399" style="word-spacing:0.3627em;">&nbsp;</span><span class="stl_58 stl_59 stl_399" style="word-spacing:0.3627em;">123456789 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:7.9325em;"><span class="stl_15 stl_16 stl_105">unsigned</span><span class="stl_15 stl_16 stl_105" style="word-spacing:0.3512em;">&nbsp;</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.3512em;">encoding</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.104em;">&nbsp;:</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.212em;">&nbsp;4</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.212em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:7.9325em;"><span class="stl_15 stl_16 stl_402">unsigned</span><span class="stl_15 stl_16 stl_402" style="word-spacing:0.4082em;">&nbsp;</span><span class="stl_10 stl_11 stl_402" style="word-spacing:0.4082em;">lru</span><span class="stl_10 stl_11 stl_402" style="word-spacing:-0.0651em;">&nbsp;:</span><span class="stl_10 stl_11 stl_402" style="word-spacing:-0.2081em;">&nbsp;2</span><span class="stl_10 stl_11 stl_402" style="word-spacing:-0.2081em;">&nbsp;2</span><span class="stl_10 stl_11 stl_402" style="word-spacing:-0.2081em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:9.6908em;"><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">l r</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;u</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;c</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;l</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;o</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;c</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;k</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.112em;">&nbsp;)</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.387em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:19.9025em;"><span class="stl_58 stl_59 stl_401" style="word-spacing:0.3143em;">/* lru</span><span class="stl_58 stl_59 stl_401" style="word-spacing:0.3513em;">&nbsp;time</span><span class="stl_58 stl_59 stl_401" style="word-spacing:0.3003em;">&nbsp;(</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.2197em;">&nbsp;r</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;e</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;l</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;a</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;t</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;i</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;v</span><span class="stl_58 stl_59 stl_401" style="word-spacing:-0.3147em;">&nbsp;e</span><span class="stl_58 stl_59 stl_401" style="word-spacing:0.3848em;">&nbsp;to server</span><span class="stl_58 stl_59 stl_401" style="word-spacing:0.3848em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">引</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4077em; left:7.98em;"><span class="stl_15 stl_16 stl_403">int</span><span class="stl_15 stl_16 stl_403" style="word-spacing:0.3307em;">&nbsp;</span><span class="stl_10 stl_11 stl_403" style="word-spacing:0.3307em;">refcount</span><span class="stl_10 stl_11 stl_403" style="word-spacing:0.3307em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">11.3. TTL</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0834em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0834em;">数据淘汰机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">83 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:7.9408em;"><span class="stl_15 stl_16 stl_291">void</span><span class="stl_15 stl_16 stl_291" style="word-spacing:0.2973em;">&nbsp;</span><span class="stl_10 stl_11 stl_291" style="word-spacing:0.2973em;">*</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.2388em;">&nbsp;ptr</span><span class="stl_10 stl_11 stl_291" style="word-spacing:-0.2388em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:7.0086em;"><span class="stl_10 stl_11 stl_404" style="word-spacing:-0.2187em;">robj ; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.706em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:6.4282em;"><span class="stl_58 stl_59 stl_723" style="word-spacing:0.2941em;">/ redis</span><span class="stl_58 stl_59 stl_723" style="word-spacing:0.3362em;">&nbsp;</span><span class="stl_17 stl_18 stl_723" style="word-spacing:0.3362em;">定</span><span class="stl_17 stl_18 stl_723" style="word-spacing:-0.3129em;">&nbsp;时</span><span class="stl_17 stl_18 stl_723" style="word-spacing:-0.3129em;">&nbsp;执</span><span class="stl_17 stl_18 stl_723" style="word-spacing:-0.3129em;">&nbsp;行</span><span class="stl_17 stl_18 stl_723" style="word-spacing:-0.3129em;">&nbsp;程</span><span class="stl_17 stl_18 stl_723" style="word-spacing:-0.2799em;">&nbsp;序。</span><span class="stl_17 stl_18 stl_723" style="word-spacing:-0.2789em;">&nbsp;联</span><span class="stl_17 stl_18 stl_723" style="word-spacing:-0.2799em;">&nbsp;想：</span><span class="stl_17 stl_18 stl_723" style="word-spacing:-0.2334em;">&nbsp;</span><span class="stl_58 stl_59 stl_723" style="word-spacing:-0.2334em;">linux</span><span class="stl_58 stl_59 stl_723" style="word-spacing:0.3221em;">&nbsp;cron &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:5.9875em;"><span class="stl_15 stl_16 stl_724">int</span><span class="stl_15 stl_16 stl_724" style="word-spacing:0.3915em;">&nbsp;</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.3915em;">serverCron</span><span class="stl_10 stl_11 stl_724" style="word-spacing:-0.2025em;">&nbsp;(</span><span class="stl_10 stl_11 stl_724" style="word-spacing:-0.2251em;">&nbsp;</span><span class="stl_15 stl_16 stl_724" style="word-spacing:-0.2251em;">struct</span><span class="stl_15 stl_16 stl_724" style="word-spacing:0.342em;">&nbsp;</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.342em;">aeEventLoop</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.3025em;">&nbsp;*eventLoop</span><span class="stl_10 stl_11 stl_724" style="word-spacing:-0.1035em;">&nbsp;,</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.3988em;">&nbsp;</span><span class="stl_15 stl_16 stl_724" style="word-spacing:0.3988em;">long</span><span class="stl_15 stl_16 stl_724" style="word-spacing:0.2965em;">&nbsp;long</span><span class="stl_15 stl_16 stl_724" style="word-spacing:0.3299em;">&nbsp;</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.3299em;">id</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.3299em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:7.6092em;"><span class="stl_15 stl_16 stl_679">void</span><span class="stl_15 stl_16 stl_679" style="word-spacing:-0.0642em;">&nbsp;</span><span class="stl_10 stl_11 stl_679" style="word-spacing:-0.0642em;">* clientData</span><span class="stl_10 stl_11 stl_679" style="word-spacing:-0.2367em;">&nbsp;)</span><span class="stl_10 stl_11 stl_679" style="word-spacing:-0.2367em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 12.6927em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_257" style="word-spacing:0.1523em;">* We</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.1843em;">&nbsp;have</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.4343em;">&nbsp;j</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2577em;">&nbsp;u</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2577em;">&nbsp;s</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2577em;">&nbsp;t</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.4088em;">&nbsp;22 b</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2417em;">&nbsp;i</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2427em;">&nbsp;t</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2417em;">&nbsp;s</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.4468em;">&nbsp;per o</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2677em;">&nbsp;b</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2677em;">&nbsp;j</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2677em;">&nbsp;e</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2687em;">&nbsp;c</span><span class="stl_58 stl_59 stl_257" style="word-spacing:-0.2677em;">&nbsp;t</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.4723em;">&nbsp;for</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.2343em;">&nbsp;LRU information</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.2343em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 14.6876em; left:9.4271em;"><span class="stl_58 stl_59 stl_582" style="word-spacing:0.2542em;">So we</span><span class="stl_58 stl_59 stl_582" style="word-spacing:0.3202em;">&nbsp;use an (</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.1648em;">&nbsp;e</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.2618em;">&nbsp;v</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.2608em;">&nbsp;e</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.2608em;">&nbsp;n</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.2608em;">&nbsp;t</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.2618em;">&nbsp;u</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.2608em;">&nbsp;a</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.2608em;">&nbsp;l</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.2618em;">&nbsp;l</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.2608em;">&nbsp;y</span><span class="stl_58 stl_59 stl_582" style="word-spacing:0.4342em;">&nbsp;wrapping</span><span class="stl_58 stl_59 stl_582" style="word-spacing:-0.2228em;">&nbsp;)</span><span class="stl_58 stl_59 stl_582" style="word-spacing:0.2062em;">&nbsp;LRU</span><span class="stl_58 stl_59 stl_582" style="word-spacing:0.2522em;">&nbsp;clock</span><span class="stl_58 stl_59 stl_582" style="word-spacing:0.4452em;">&nbsp;with</span><span class="stl_58 stl_59 stl_582" style="word-spacing:0.3622em;">&nbsp;10 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.1475em;"><span class="stl_58 stl_59 stl_725" style="word-spacing:0.3947em;">seconds r</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3153em;">&nbsp;e</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3153em;">&nbsp;s</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3153em;">&nbsp;o</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3153em;">&nbsp;l</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3153em;">&nbsp;u</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3153em;">&nbsp;t</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3163em;">&nbsp;i</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3153em;">&nbsp;o</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3153em;">&nbsp;n</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3153em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.4437em;"><span class="stl_58 stl_59 stl_313" style="word-spacing:0.4184em;">2^22 b</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2426em;">&nbsp;i</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2436em;">&nbsp;t</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2436em;">&nbsp;s</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.4744em;">&nbsp;with</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.3509em;">&nbsp;10 seconds</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.4424em;">&nbsp;r</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2676em;">&nbsp;e</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2677em;">&nbsp;s</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2676em;">&nbsp;o</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2676em;">&nbsp;l</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2686em;">&nbsp;u</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2676em;">&nbsp;t</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2676em;">&nbsp;i</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2676em;">&nbsp;o</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2676em;">&nbsp;n</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.4934em;">&nbsp;i</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2596em;">&nbsp;s</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.3774em;">&nbsp;more</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.3054em;">&nbsp;or</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.4404em;">&nbsp;l</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2476em;">&nbsp;e</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2486em;">&nbsp;s</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2486em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:10.1542em;"><span class="stl_58 stl_59 stl_07">1</span></div>
					<div class="stl_01" style="top: 17.676em; left:10.6764em;"><span class="stl_58 stl_59 stl_88" style="word-spacing:0.3506em;">.5 years</span><span class="stl_58 stl_59 stl_88" style="word-spacing:0.3506em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:9.4512em;"><span class="stl_58 stl_59 stl_726" style="word-spacing:0.374em;">Note that even</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.437em;">&nbsp;i</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.254em;">&nbsp;f</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.513em;">&nbsp;t</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.282em;">&nbsp;h</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.281em;">&nbsp;i</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.282em;">&nbsp;s</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.501em;">&nbsp;w</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.266em;">&nbsp;i</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.267em;">&nbsp;l</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.266em;">&nbsp;l</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.38em;">&nbsp;wrap a</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.288em;">&nbsp;f</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.289em;">&nbsp;t</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.289em;">&nbsp;e</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.288em;">&nbsp;r</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.429em;">&nbsp;1.5</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.387em;">&nbsp;years</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.456em;">&nbsp;i</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.263em;">&nbsp;t</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.067em;">&nbsp;’</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.067em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:10.1383em;"><span class="stl_58 stl_59 stl_80" style="word-spacing:0.3103em;">not a problem</span><span class="stl_58 stl_59 stl_80" style="word-spacing:0.3103em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 21.661em; left:9.5085em;"><span class="stl_58 stl_59 stl_685" style="word-spacing:0.4586em;">everything w</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2804em;">&nbsp;i</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2814em;">&nbsp;l</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2814em;">&nbsp;l</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.5596em;">&nbsp;s</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2244em;">&nbsp;t</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2244em;">&nbsp;i</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2244em;">&nbsp;l</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2244em;">&nbsp;l</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.4446em;">&nbsp;work</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.3226em;">&nbsp;but</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.4166em;">&nbsp;j</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.3014em;">&nbsp;u</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.3014em;">&nbsp;s</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.3014em;">&nbsp;t</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.3336em;">&nbsp;some o</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.3114em;">&nbsp;b</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.3114em;">&nbsp;j</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.3114em;">&nbsp;e</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.3124em;">&nbsp;c</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.3114em;">&nbsp;t</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.4726em;">&nbsp;w</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2814em;">&nbsp;i</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2814em;">&nbsp;l</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2814em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:10.1367em;"><span class="stl_58 stl_59 stl_686" style="word-spacing:0.3495em;">appear younger &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:9.4911em;"><span class="stl_58 stl_59 stl_566" style="word-spacing:0.3558em;">to Redis</span><span class="stl_58 stl_59 stl_566" style="word-spacing:-0.2172em;">&nbsp;.</span><span class="stl_58 stl_59 stl_566" style="word-spacing:0.3403em;">&nbsp;But for</span><span class="stl_58 stl_59 stl_566" style="word-spacing:0.4478em;">&nbsp;t</span><span class="stl_58 stl_59 stl_566" style="word-spacing:-0.2922em;">&nbsp;h</span><span class="stl_58 stl_59 stl_566" style="word-spacing:-0.2912em;">&nbsp;i</span><span class="stl_58 stl_59 stl_566" style="word-spacing:-0.2922em;">&nbsp;s</span><span class="stl_58 stl_59 stl_566" style="word-spacing:0.4268em;">&nbsp;to</span><span class="stl_58 stl_59 stl_566" style="word-spacing:0.3348em;">&nbsp;happen</span><span class="stl_58 stl_59 stl_566" style="word-spacing:0.2608em;">&nbsp;a</span><span class="stl_58 stl_59 stl_566" style="word-spacing:0.3088em;">&nbsp;given</span><span class="stl_58 stl_59 stl_566" style="word-spacing:0.4178em;">&nbsp;o</span><span class="stl_58 stl_59 stl_566" style="word-spacing:-0.3072em;">&nbsp;b</span><span class="stl_58 stl_59 stl_566" style="word-spacing:-0.3072em;">&nbsp;j</span><span class="stl_58 stl_59 stl_566" style="word-spacing:-0.3072em;">&nbsp;e</span><span class="stl_58 stl_59 stl_566" style="word-spacing:-0.3082em;">&nbsp;c</span><span class="stl_58 stl_59 stl_566" style="word-spacing:-0.3072em;">&nbsp;t</span><span class="stl_58 stl_59 stl_566" style="word-spacing:0.4168em;">&nbsp;should &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:10.6425em;"><span class="stl_58 stl_59 stl_275" style="word-spacing:0.3372em;">never be touched &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:9.5085em;"><span class="stl_58 stl_59 stl_727" style="word-spacing:0.3503em;">for 1.5 years</span><span class="stl_58 stl_59 stl_727" style="word-spacing:0.3503em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 26.6426em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 27.6385em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4458em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 27.6385em; left:9.4512em;"><span class="stl_58 stl_59 stl_364" style="word-spacing:0.3659em;">Note that you</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.3004em;">&nbsp;can change</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.3694em;">&nbsp;the</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.4324em;">&nbsp;r</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2916em;">&nbsp;e</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2916em;">&nbsp;s</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2916em;">&nbsp;o</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2916em;">&nbsp;l</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2926em;">&nbsp;u</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2916em;">&nbsp;t</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2916em;">&nbsp;i</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2916em;">&nbsp;o</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2916em;">&nbsp;n</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.4744em;">&nbsp;a</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2806em;">&nbsp;l</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2796em;">&nbsp;t</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2806em;">&nbsp;e</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2796em;">&nbsp;r</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2806em;">&nbsp;i</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2796em;">&nbsp;n</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2796em;">&nbsp;g</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.4434em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:9.3259em;"><span class="stl_58 stl_59 stl_337" style="word-spacing:0.4964em;">REDIS_LRU_CLOCK_RESOLUTION define</span><span class="stl_58 stl_59 stl_337" style="word-spacing:0.4964em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.9182em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.626em; left:7.9433em;"><span class="stl_10 stl_11 stl_196" style="word-spacing:-0.1225em;">updateLRUClock () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 32.6185em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.6126em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:6.4282em;"><span class="stl_58 stl_59 stl_728">/</span><span class="stl_58 stl_59 stl_728" style="word-spacing:-0.1252em;">&nbsp;</span><span class="stl_17 stl_18 stl_728" style="word-spacing:-0.1252em;">更 新</span><span class="stl_17 stl_18 stl_728" style="word-spacing:-0.342em;">&nbsp;服</span><span class="stl_17 stl_18 stl_728" style="word-spacing:-0.342em;">&nbsp;务</span><span class="stl_17 stl_18 stl_728" style="word-spacing:-0.342em;">&nbsp;器</span><span class="stl_17 stl_18 stl_728" style="word-spacing:-0.342em;">&nbsp;的</span><span class="stl_17 stl_18 stl_728" style="word-spacing:0.305em;">&nbsp;</span><span class="stl_58 stl_59 stl_728" style="word-spacing:0.305em;">lru</span><span class="stl_58 stl_59 stl_728" style="word-spacing:-0.0383em;">&nbsp;</span><span class="stl_17 stl_18 stl_728" style="word-spacing:-0.0383em;">计 数</span><span class="stl_17 stl_18 stl_728" style="word-spacing:-0.0383em;">&nbsp;器 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:5.9483em;"><span class="stl_15 stl_16 stl_179">void</span><span class="stl_15 stl_16 stl_179" style="word-spacing:0.3501em;">&nbsp;</span><span class="stl_10 stl_11 stl_179" style="word-spacing:0.3501em;">updateLRUClock</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.1971em;">&nbsp;(</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.1988em;">&nbsp;</span><span class="stl_15 stl_16 stl_179" style="word-spacing:-0.1988em;">void</span><span class="stl_15 stl_16 stl_179" style="word-spacing:-0.199em;">&nbsp;</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.199em;">)</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.199em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:8.0175em;"><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.1999em;">server .</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.1909em;">&nbsp;l</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.3519em;">&nbsp;r</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.3509em;">&nbsp;u</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.3519em;">&nbsp;c</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.3519em;">&nbsp;l</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.3509em;">&nbsp;o</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.3519em;">&nbsp;c</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.3519em;">&nbsp;k</span><span class="stl_10 stl_11 stl_729" style="word-spacing:0.1601em;">&nbsp;=</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.1449em;">&nbsp;( server</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.1999em;">&nbsp;.</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.2399em;">&nbsp;unixtime</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.2399em;">&nbsp;/ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:9.49em;"><span class="stl_10 stl_11 stl_730" style="word-spacing:0.5224em;">REDIS_LRU_CLOCK_RESOLUTION) &amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:29.7292em;"><span class="stl_10 stl_11 stl_731">REDIS_LRU_CLOCK_MAX &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:31.61em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.1732em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 43.1732em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">1.3 TTL</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1259em;">数据淘汰机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:7.5658em;z-index:770; "><span class="stl_10 stl_11 stl_732" style="word-spacing:0.0485em;">redis </span><span class="stl_17 stl_18 stl_732" style="word-spacing:0.0485em;">数据集数据结构中保存了键值对过期时间的表，即 </span><span class="stl_10 stl_11 stl_732" style="word-spacing:0.0485em;">redisDb.expires</span><span class="stl_17 stl_18 stl_732" style="word-spacing:0.0485em;">。和 </span><span class="stl_10 stl_11 stl_732" style="word-spacing:0.0485em;">LRU &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4126em; left:5.9058em;"><span class="stl_17 stl_18 stl_733" style="word-spacing:0.0834em;">数据淘汰机制类似，</span><span class="stl_10 stl_11 stl_733" style="word-spacing:0.0834em;">TTL </span><span class="stl_17 stl_18 stl_733" style="word-spacing:0.0834em;">数据淘汰机制是这样的：从过期时间的表中随机挑选几个 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;"><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0814em;">键值对，取出其中 </span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0814em;">ttl </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0814em;">最大的键值对淘汰。同样你会发现，</span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0814em;">redis </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0814em;">并不是保证取得所有 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">84 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.6158em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 11.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">数据淘汰机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.9415em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">过期时间的表中最快过期的键值对，而只是随机挑选的几个键值对中的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.9674em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 8.9674em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">1.4 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">总结 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.2101em; left:7.5658em;"><span class="stl_10 stl_11 stl_115" style="word-spacing:0.0841em;">redis </span><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0841em;">每服务客户端执行一个命令的时候，会检测使用的内存是否超额。如果超 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.429em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">额，即进行数据淘汰。 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.5335em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.5335em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.5235em; left:5.9875em;"><span class="stl_15 stl_16 stl_193">int</span><span class="stl_15 stl_16 stl_193" style="word-spacing:0.3761em;">&nbsp;</span><span class="stl_10 stl_11 stl_193" style="word-spacing:0.3761em;">processCommand</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2166em;">&nbsp;(</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.1136em;">&nbsp;r</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;e</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2196em;">&nbsp;d</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;i</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;s</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;C</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2196em;">&nbsp;l</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;i</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;e</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;n</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2196em;">&nbsp;t</span><span class="stl_10 stl_11 stl_193" style="word-spacing:0.4314em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.1906em;">&nbsp;)</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.1906em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.5243em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 17.5226em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.5185em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.5243em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 17.5226em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">内</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;超</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;额 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5185em; left:8.4207em;"><span class="stl_58 stl_59 stl_328" style="word-spacing:0.393em;">* Handle</span><span class="stl_58 stl_59 stl_328" style="word-spacing:0.458em;">&nbsp;the</span><span class="stl_58 stl_59 stl_328" style="word-spacing:0.387em;">&nbsp;maxmemory</span><span class="stl_58 stl_59 stl_328" style="word-spacing:0.431em;">&nbsp;d</span><span class="stl_58 stl_59 stl_328" style="word-spacing:-0.178em;">&nbsp;i</span><span class="stl_58 stl_59 stl_328" style="word-spacing:-0.178em;">&nbsp;r</span><span class="stl_58 stl_59 stl_328" style="word-spacing:-0.177em;">&nbsp;e</span><span class="stl_58 stl_59 stl_328" style="word-spacing:-0.178em;">&nbsp;c</span><span class="stl_58 stl_59 stl_328" style="word-spacing:-0.178em;">&nbsp;t</span><span class="stl_58 stl_59 stl_328" style="word-spacing:-0.178em;">&nbsp;i</span><span class="stl_58 stl_59 stl_328" style="word-spacing:-0.178em;">&nbsp;v</span><span class="stl_58 stl_59 stl_328" style="word-spacing:-0.178em;">&nbsp;e</span><span class="stl_58 stl_59 stl_328" style="word-spacing:-0.178em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 19.5151em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 20.511em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 22.5035em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 24.496em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 20.511em; left:9.5135em;"><span class="stl_58 stl_59 stl_734" style="word-spacing:0.3329em;">First we try</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.4289em;">&nbsp;to fr</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.2841em;">&nbsp;ee</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.3549em;">&nbsp;some</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.2169em;">&nbsp;memory</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.3719em;">&nbsp;i</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.2391em;">&nbsp;f</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.5239em;">&nbsp;p</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.2711em;">&nbsp;o</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.2711em;">&nbsp;s</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.2701em;">&nbsp;s</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.2711em;">&nbsp;i</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.2711em;">&nbsp;b</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.2711em;">&nbsp;l</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.2711em;">&nbsp;e</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.4249em;">&nbsp;(</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.1451em;">&nbsp;i</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.2391em;">&nbsp;f</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.4959em;">&nbsp;there &nbsp;</span></div>
					<div class="stl_01" style="top: 21.5076em; left:10.6392em;"><span class="stl_58 stl_59 stl_735" style="word-spacing:0.439em;">are v</span><span class="stl_58 stl_59 stl_735" style="word-spacing:-0.264em;">&nbsp;o</span><span class="stl_58 stl_59 stl_735" style="word-spacing:-0.263em;">&nbsp;l</span><span class="stl_58 stl_59 stl_735" style="word-spacing:-0.263em;">&nbsp;a</span><span class="stl_58 stl_59 stl_735" style="word-spacing:-0.264em;">&nbsp;t</span><span class="stl_58 stl_59 stl_735" style="word-spacing:-0.263em;">&nbsp;i</span><span class="stl_58 stl_59 stl_735" style="word-spacing:-0.263em;">&nbsp;l</span><span class="stl_58 stl_59 stl_735" style="word-spacing:-0.263em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 22.5035em; left:9.4894em;"><span class="stl_58 stl_59 stl_251" style="word-spacing:0.3289em;">keys in the</span><span class="stl_58 stl_59 stl_251" style="word-spacing:0.3639em;">&nbsp;dataset</span><span class="stl_58 stl_59 stl_251" style="word-spacing:-0.2651em;">&nbsp;)</span><span class="stl_58 stl_59 stl_251" style="word-spacing:-0.2601em;">&nbsp;.</span><span class="stl_58 stl_59 stl_251" style="word-spacing:0.4139em;">&nbsp;I</span><span class="stl_58 stl_59 stl_251" style="word-spacing:-0.3331em;">&nbsp;f</span><span class="stl_58 stl_59 stl_251" style="word-spacing:0.4029em;">&nbsp;there</span><span class="stl_58 stl_59 stl_251" style="word-spacing:0.3359em;">&nbsp;are</span><span class="stl_58 stl_59 stl_251" style="word-spacing:0.3099em;">&nbsp;not the</span><span class="stl_58 stl_59 stl_251" style="word-spacing:0.3459em;">&nbsp;only</span><span class="stl_58 stl_59 stl_251" style="word-spacing:0.3459em;">&nbsp;thing &nbsp;</span></div>
					<div class="stl_01" style="top: 23.5001em; left:10.0775em;"><span class="stl_58 stl_59 stl_736" style="word-spacing:0.35em;">we can do &nbsp;</span></div>
					<div class="stl_01" style="top: 24.496em; left:9.5259em;"><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.3291em;">i s</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.4049em;">&nbsp;returning</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.2824em;">&nbsp;an error</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.2171em;">&nbsp;.</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.3159em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.486em; left:8.045em;"><span class="stl_15 stl_16 stl_181" style="word-spacing:-0.1929em;">i f</span><span class="stl_15 stl_16 stl_181" style="word-spacing:0.5135em;">&nbsp;</span><span class="stl_10 stl_11 stl_181" style="word-spacing:0.5135em;">(</span><span class="stl_10 stl_11 stl_181" style="word-spacing:-0.1199em;">&nbsp;server</span><span class="stl_10 stl_11 stl_181" style="word-spacing:-0.0639em;">&nbsp;.</span><span class="stl_10 stl_11 stl_181" style="word-spacing:-0.2069em;">&nbsp;maxmemory)</span><span class="stl_10 stl_11 stl_181" style="word-spacing:-0.2069em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4818em; left:9.9725em;"><span class="stl_15 stl_16 stl_737">int</span><span class="stl_15 stl_16 stl_737" style="word-spacing:0.4128em;">&nbsp;</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.4128em;">r</span><span class="stl_10 stl_11 stl_737" style="word-spacing:-0.2873em;">&nbsp;e</span><span class="stl_10 stl_11 stl_737" style="word-spacing:-0.2863em;">&nbsp;t</span><span class="stl_10 stl_11 stl_737" style="word-spacing:-0.2863em;">&nbsp;v</span><span class="stl_10 stl_11 stl_737" style="word-spacing:-0.2873em;">&nbsp;a</span><span class="stl_10 stl_11 stl_737" style="word-spacing:-0.2863em;">&nbsp;l</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.2247em;">&nbsp;=</span><span class="stl_10 stl_11 stl_737" style="word-spacing:-0.0436em;">&nbsp;freeMemoryIfNeeded ()</span><span class="stl_10 stl_11 stl_737" style="word-spacing:-0.0436em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4785em; left:10.0375em;z-index:382; "><span class="stl_15 stl_16 stl_738" style="word-spacing:0.1083em;">i f</span><span class="stl_15 stl_16 stl_738" style="word-spacing:0.8499em;">&nbsp;</span><span class="stl_10 stl_11 stl_738" style="word-spacing:0.8499em;">((</span><span class="stl_10 stl_11 stl_738" style="word-spacing:0.8499em;">&nbsp;c</span><span class="stl_107 stl_108 stl_738" style="word-spacing:0.8499em;">−</span><span class="stl_10 stl_11 stl_738" style="word-spacing:0.1253em;">&gt;cmd</span><span class="stl_107 stl_108 stl_738" style="word-spacing:0.1253em;">−</span><span class="stl_10 stl_11 stl_738" style="word-spacing:0.1253em;">&gt;f</span><span class="stl_10 stl_11 stl_738" style="word-spacing:0.1026em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_738" style="word-spacing:0.6143em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_738" style="word-spacing:0.3203em;">&nbsp;REDIS_CMD_DENYOOM)</span><span class="stl_10 stl_11 stl_738" style="word-spacing:0.5418em;">&nbsp;&amp;&amp; r</span><span class="stl_10 stl_11 stl_738" style="word-spacing:0.0849em;">&nbsp;e t v a l</span><span class="stl_10 stl_11 stl_738" style="word-spacing:0.5663em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4793em; left:11.5008em;"><span class="stl_10 stl_11 stl_336" style="word-spacing:0.6017em;">REDIS_ERR) { &nbsp;</span></div>
					<div class="stl_01" style="top: 29.476em; left:11.9967em;"><span class="stl_10 stl_11 stl_198" style="word-spacing:-0.304em;">flagTransaction ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4718em; left:11.9425em;"><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2401em;">addReply (</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2611em;">&nbsp;c</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.1531em;">&nbsp;,</span><span class="stl_10 stl_11 stl_399" style="word-spacing:0.4509em;">&nbsp;shared</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.1491em;">&nbsp;.</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.1801em;">&nbsp;oomerr</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2351em;">&nbsp;)</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2351em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4635em; left:11.9308em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4643em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 33.461em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.4577em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 34.4577em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4535em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.4476em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.4476em; left:6.4282em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">如 果</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;需</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;要，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;是</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;否</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;一</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;些</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;内</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;存 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4377em; left:5.9875em;"><span class="stl_15 stl_16 stl_119">int</span><span class="stl_15 stl_16 stl_119" style="word-spacing:0.3674em;">&nbsp;</span><span class="stl_10 stl_11 stl_119" style="word-spacing:0.3674em;">freeMemoryIfNeeded</span><span class="stl_10 stl_11 stl_119" style="word-spacing:-0.2265em;">&nbsp;(</span><span class="stl_10 stl_11 stl_119" style="word-spacing:-0.2654em;">&nbsp;</span><span class="stl_15 stl_16 stl_119" style="word-spacing:-0.2654em;">void</span><span class="stl_15 stl_16 stl_119" style="word-spacing:-0.2664em;">&nbsp;</span><span class="stl_10 stl_11 stl_119" style="word-spacing:-0.2664em;">)</span><span class="stl_10 stl_11 stl_119" style="word-spacing:-0.2664em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4385em; left:8.005em;"><span class="stl_10 stl_11 stl_739" style="word-spacing:0.3777em;">size_t mem_used</span><span class="stl_10 stl_11 stl_739" style="word-spacing:-0.1923em;">&nbsp;,</span><span class="stl_10 stl_11 stl_739" style="word-spacing:0.4657em;">&nbsp;mem_tofree</span><span class="stl_10 stl_11 stl_739" style="word-spacing:-0.0783em;">&nbsp;,</span><span class="stl_10 stl_11 stl_739" style="word-spacing:0.4507em;">&nbsp;mem_freed</span><span class="stl_10 stl_11 stl_739" style="word-spacing:0.4507em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4302em; left:7.98em;"><span class="stl_15 stl_16 stl_740">int</span><span class="stl_15 stl_16 stl_740" style="word-spacing:-0.0522em;">&nbsp;</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.0522em;">s l</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.3751em;">&nbsp;a</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.3751em;">&nbsp;v</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.3761em;">&nbsp;e</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.3751em;">&nbsp;s</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.0134em;">&nbsp;= listLength (</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.2771em;">&nbsp;server</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.2221em;">&nbsp;.</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.2141em;">&nbsp;s</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.3761em;">&nbsp;l</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.3751em;">&nbsp;a</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.3751em;">&nbsp;v</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.3761em;">&nbsp;e</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.3751em;">&nbsp;s</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.2701em;">&nbsp;)</span><span class="stl_10 stl_11 stl_740" style="word-spacing:-0.2701em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.4218em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4293em; left:8.4207em;"><span class="stl_58 stl_59 stl_741" style="word-spacing:0.3554em;">/ redis</span><span class="stl_58 stl_59 stl_741" style="word-spacing:0.3965em;">&nbsp;</span><span class="stl_17 stl_18 stl_741" style="word-spacing:0.3965em;">从</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;机</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;回</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;复</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;空</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;间</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;和</span><span class="stl_17 stl_18 stl_741" style="word-spacing:0.158em;">&nbsp;</span><span class="stl_58 stl_59 stl_741" style="word-spacing:0.158em;">AOF</span><span class="stl_58 stl_59 stl_741" style="word-spacing:-0.0956em;">&nbsp;</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.0956em;">内 存</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;大</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;小</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;不</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;计</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;算</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;入</span><span class="stl_17 stl_18 stl_741" style="word-spacing:0.3973em;">&nbsp;</span><span class="stl_58 stl_59 stl_741" style="word-spacing:0.3973em;">redis</span><span class="stl_58 stl_59 stl_741" style="word-spacing:0.3965em;">&nbsp;</span><span class="stl_17 stl_18 stl_741" style="word-spacing:0.3965em;">内</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;存</span><span class="stl_17 stl_18 stl_741" style="word-spacing:-0.2516em;">&nbsp;大 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.6457em; left:9.6417em;"><span class="stl_17 stl_18 stl_07">小</span></div>
					<div class="stl_01" style="top: 44.4218em; left:8.4207em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:0.312em;">* Remove</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.377em;">&nbsp;the</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.517em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">&nbsp;i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">&nbsp;z</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.517em;">&nbsp;of s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.214em;">&nbsp;l</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.214em;">&nbsp;a</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.213em;">&nbsp;v</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.214em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.213em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.509em;">&nbsp;output b</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">&nbsp;u</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">&nbsp;r</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.446em;">&nbsp;and</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.194em;">&nbsp;AOF &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:9.69em;"><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2746em;">b u</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2726em;">&nbsp;f</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2736em;">&nbsp;f</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2736em;">&nbsp;e</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2736em;">&nbsp;r</span><span class="stl_58 stl_59 stl_742" style="word-spacing:0.3779em;">&nbsp;from</span><span class="stl_58 stl_59 stl_742" style="word-spacing:0.3779em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 46.4143em; left:9.4745em;"><span class="stl_58 stl_59 stl_743" style="word-spacing:0.441em;">count of used</span><span class="stl_58 stl_59 stl_743" style="word-spacing:0.325em;">&nbsp;memory</span><span class="stl_58 stl_59 stl_743" style="word-spacing:-0.226em;">&nbsp;.</span><span class="stl_58 stl_59 stl_743" style="word-spacing:0.422em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.8975em;"><span class="stl_10 stl_11 stl_744" style="word-spacing:0.1696em;">mem_used =</span><span class="stl_10 stl_11 stl_744" style="word-spacing:0.2286em;">&nbsp;zmalloc_used_memory</span><span class="stl_10 stl_11 stl_744" style="word-spacing:-0.1414em;">&nbsp;()</span><span class="stl_10 stl_11 stl_744" style="word-spacing:-0.1414em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">11.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">总结 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">85 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;回</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;复</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:8.045em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:-0.074em;">i f</span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.6324em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6324em;">(</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.091em;">&nbsp;s l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.099em;">&nbsp;a</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.098em;">&nbsp;v</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.098em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.099em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.008em;">&nbsp;)</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.008em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:10.0633em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">l i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;I</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;r</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.773em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:10.0025em;"><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">listNode * ln</span><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:9.9942em;"><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2318em;">listRewind ( server . slaves ,&amp; l i ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:9.9408em;"><span class="stl_15 stl_16 stl_735">while</span><span class="stl_15 stl_16 stl_735" style="word-spacing:-0.2505em;">&nbsp;</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2505em;">((</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.1899em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_735" style="word-spacing:0.1801em;">&nbsp;=</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.0948em;">&nbsp;lis tN</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.3029em;">&nbsp;e</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.3029em;">&nbsp;xt</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2919em;">&nbsp;(&amp;</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2279em;">&nbsp;l</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2379em;">&nbsp;i</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.1329em;">&nbsp;)</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2419em;">&nbsp;)</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2419em;">&nbsp;)</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2419em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:12.0125em;"><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.3463em;">r e</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.3453em;">&nbsp;d</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.3453em;">&nbsp;i</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.3463em;">&nbsp;s</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.3453em;">&nbsp;C</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.3453em;">&nbsp;l</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.3453em;">&nbsp;i</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.3453em;">&nbsp;e</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.3463em;">&nbsp;n</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.3453em;">&nbsp;t</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.0023em;">&nbsp;* slave</span><span class="stl_10 stl_11 stl_747" style="word-spacing:0.1527em;">&nbsp;=</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.1466em;">&nbsp;listNodeValue (</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.2733em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.2743em;">&nbsp;)</span><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.2743em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:11.9175em;"><span class="stl_15 stl_16 stl_594" style="word-spacing:0.3136em;">unsigned long</span><span class="stl_15 stl_16 stl_594" style="word-spacing:0.3648em;">&nbsp;</span><span class="stl_10 stl_11 stl_594" style="word-spacing:0.3648em;">obuf_bytes</span><span class="stl_10 stl_11 stl_594" style="word-spacing:0.3648em;">&nbsp;= &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:13.6208em;"><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.2067em;">getClientOutputBufferMemoryUsage ( slave ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:12.03em;"><span class="stl_15 stl_16 stl_748" style="word-spacing:-0.1836em;">i f</span><span class="stl_15 stl_16 stl_748" style="word-spacing:0.5227em;">&nbsp;</span><span class="stl_10 stl_11 stl_748" style="word-spacing:0.5227em;">(</span><span class="stl_10 stl_11 stl_748" style="word-spacing:-0.1616em;">&nbsp;obuf_bytes</span><span class="stl_10 stl_11 stl_748" style="word-spacing:0.2154em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_748" style="word-spacing:0.1794em;">&nbsp;mem_used) &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:13.875em;"><span class="stl_10 stl_11 stl_749" style="word-spacing:0.2245em;">mem_used =</span><span class="stl_10 stl_11 stl_749" style="word-spacing:0.3685em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.666em; left:11.9783em;"><span class="stl_15 stl_16 stl_443">else &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:13.875em;"><span class="stl_10 stl_11 stl_750">mem_used</span><span class="stl_10 stl_11 stl_750" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_107 stl_108 stl_750">−</span><span class="stl_10 stl_11 stl_750" style="word-spacing:0.0832em;">=</span><span class="stl_10 stl_11 stl_750" style="word-spacing:0.2659em;">&nbsp;obuf_bytes</span><span class="stl_10 stl_11 stl_750" style="word-spacing:0.2659em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 21.6593em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_319" style="word-spacing:0.3171em;">/ server</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.1949em;">&nbsp;.</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.2309em;">&nbsp;aof_buf</span><span class="stl_58 stl_59 stl_319" style="word-spacing:0.1121em;">&nbsp;&amp;&amp;</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.0488em;">&nbsp;server .</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.2159em;">&nbsp;aof_rewrite_buf_blocks &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:8.045em;"><span class="stl_15 stl_16 stl_751" style="word-spacing:-0.1382em;">i f</span><span class="stl_15 stl_16 stl_751" style="word-spacing:0.5682em;">&nbsp;</span><span class="stl_10 stl_11 stl_751" style="word-spacing:0.5682em;">(</span><span class="stl_10 stl_11 stl_751" style="word-spacing:-0.0652em;">&nbsp;server</span><span class="stl_10 stl_11 stl_751" style="word-spacing:-0.0092em;">&nbsp;.</span><span class="stl_10 stl_11 stl_751" style="word-spacing:-0.0302em;">&nbsp;aof_state</span><span class="stl_10 stl_11 stl_751" style="word-spacing:0.4568em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_751" style="word-spacing:0.2578em;">&nbsp;REDIS_AOF_OFF)</span><span class="stl_10 stl_11 stl_751" style="word-spacing:0.2578em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:9.89em;z-index:361; "><span class="stl_10 stl_11 stl_526">mem_used</span><span class="stl_10 stl_11 stl_526" style="word-spacing:0.0147em;">&nbsp;</span><span class="stl_107 stl_108 stl_526">−</span><span class="stl_10 stl_11 stl_526" style="word-spacing:0.0147em;">=</span><span class="stl_10 stl_11 stl_526" style="word-spacing:0.2444em;">&nbsp;sdslen</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.1606em;">&nbsp;(</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.1566em;">&nbsp;server</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.1016em;">&nbsp;.</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.1536em;">&nbsp;aof_buf</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.2096em;">&nbsp;)</span><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.2096em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:9.89em;z-index:394; "><span class="stl_10 stl_11 stl_752">mem_used</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.0174em;">&nbsp;</span><span class="stl_107 stl_108 stl_752">−</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.0174em;">=</span><span class="stl_10 stl_11 stl_752" style="word-spacing:0.2082em;">&nbsp;aofRewriteBufferSize</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.1608em;">&nbsp;()</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.1608em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">内</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;是</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;否</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;超</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;过</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;设</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_753" style="word-spacing:0.3418em;">* Check</span><span class="stl_58 stl_59 stl_753" style="word-spacing:0.4778em;">&nbsp;i</span><span class="stl_58 stl_59 stl_753" style="word-spacing:-0.1862em;">&nbsp;f</span><span class="stl_58 stl_59 stl_753" style="word-spacing:0.4378em;">&nbsp;we</span><span class="stl_58 stl_59 stl_753" style="word-spacing:0.3448em;">&nbsp;are</span><span class="stl_58 stl_59 stl_753" style="word-spacing:0.4398em;">&nbsp;over the</span><span class="stl_58 stl_59 stl_753" style="word-spacing:0.3538em;">&nbsp;memory</span><span class="stl_58 stl_59 stl_753" style="word-spacing:0.3938em;">&nbsp;l</span><span class="stl_58 stl_59 stl_753" style="word-spacing:-0.2192em;">&nbsp;i</span><span class="stl_58 stl_59 stl_753" style="word-spacing:-0.2192em;">&nbsp;m</span><span class="stl_58 stl_59 stl_753" style="word-spacing:-0.2182em;">&nbsp;i</span><span class="stl_58 stl_59 stl_753" style="word-spacing:-0.2192em;">&nbsp;t</span><span class="stl_58 stl_59 stl_753" style="word-spacing:-0.0722em;">&nbsp;.</span><span class="stl_58 stl_59 stl_753" style="word-spacing:0.4238em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:8.045em;"><span class="stl_15 stl_16 stl_754" style="word-spacing:-0.1157em;">i f</span><span class="stl_15 stl_16 stl_754" style="word-spacing:0.5907em;">&nbsp;</span><span class="stl_10 stl_11 stl_754" style="word-spacing:0.5907em;">(mem_used</span><span class="stl_10 stl_11 stl_754" style="word-spacing:0.1283em;">&nbsp;&lt;=</span><span class="stl_10 stl_11 stl_754" style="word-spacing:0.3623em;">&nbsp;server</span><span class="stl_10 stl_11 stl_754" style="word-spacing:-0.0582em;">&nbsp;. maxmemory)</span><span class="stl_10 stl_11 stl_754" style="word-spacing:0.471em;">&nbsp;</span><span class="stl_15 stl_16 stl_754" style="word-spacing:0.471em;">return</span><span class="stl_15 stl_16 stl_754" style="word-spacing:0.2984em;">&nbsp;</span><span class="stl_10 stl_11 stl_754" style="word-spacing:0.2984em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:8.4207em;"><span class="stl_58 stl_59 stl_755" style="word-spacing:0.2595em;">/ redis</span><span class="stl_58 stl_59 stl_755" style="word-spacing:-0.0469em;">&nbsp;</span><span class="stl_17 stl_18 stl_755" style="word-spacing:-0.0469em;">中 可</span><span class="stl_17 stl_18 stl_755" style="word-spacing:-0.3475em;">&nbsp;以</span><span class="stl_17 stl_18 stl_755" style="word-spacing:-0.3475em;">&nbsp;设</span><span class="stl_17 stl_18 stl_755" style="word-spacing:-0.3475em;">&nbsp;置</span><span class="stl_17 stl_18 stl_755" style="word-spacing:-0.3475em;">&nbsp;内</span><span class="stl_17 stl_18 stl_755" style="word-spacing:-0.3475em;">&nbsp;存</span><span class="stl_17 stl_18 stl_755" style="word-spacing:-0.3475em;">&nbsp;超</span><span class="stl_17 stl_18 stl_755" style="word-spacing:-0.3475em;">&nbsp;额</span><span class="stl_17 stl_18 stl_755" style="word-spacing:-0.3475em;">&nbsp;策</span><span class="stl_17 stl_18 stl_755" style="word-spacing:-0.3475em;">&nbsp;略 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:8.045em;"><span class="stl_15 stl_16 stl_756" style="word-spacing:-0.2047em;">i f</span><span class="stl_15 stl_16 stl_756" style="word-spacing:0.5017em;">&nbsp;</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.5017em;">(</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1317em;">&nbsp;server</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.0757em;">&nbsp;.</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1677em;">&nbsp;maxmemory_policy</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.1523em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:9.47em;"><span class="stl_10 stl_11 stl_646">REDIS_MAXMEMORY_NO_EVICTION) &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:9.9383em;"><span class="stl_15 stl_16 stl_205">return</span><span class="stl_15 stl_16 stl_205" style="word-spacing:0.2986em;">&nbsp;</span><span class="stl_10 stl_11 stl_205" style="word-spacing:0.2986em;">REDIS_ERR;</span><span class="stl_10 stl_11 stl_205" style="word-spacing:0.5224em;">&nbsp;</span><span class="stl_58 stl_59 stl_205" style="word-spacing:0.5224em;">/*</span><span class="stl_58 stl_59 stl_205" style="word-spacing:0.285em;">&nbsp;We need</span><span class="stl_58 stl_59 stl_205" style="word-spacing:0.5025em;">&nbsp;to</span><span class="stl_58 stl_59 stl_205" style="word-spacing:0.5705em;">&nbsp;f</span><span class="stl_58 stl_59 stl_205" style="word-spacing:-0.1485em;">&nbsp;re</span><span class="stl_58 stl_59 stl_205" style="word-spacing:-0.1475em;">&nbsp;e</span><span class="stl_58 stl_59 stl_205" style="word-spacing:0.4625em;">&nbsp;memory</span><span class="stl_58 stl_59 stl_205" style="word-spacing:-0.1315em;">&nbsp;,</span><span class="stl_58 stl_59 stl_205" style="word-spacing:0.5665em;">&nbsp;but &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:11.6775em;"><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.215em;">p o</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.216em;">&nbsp;l</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.215em;">&nbsp;i</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.215em;">&nbsp;c</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.215em;">&nbsp;y</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.543em;">&nbsp;f</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.208em;">&nbsp;o</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;r</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;b</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;i</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;d</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;s</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.062em;">&nbsp;.</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.438em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.5976em; left:8.4207em;"><span class="stl_58 stl_59 stl_552" style="word-spacing:0.3463em;">* Compute how</span><span class="stl_58 stl_59 stl_552" style="word-spacing:0.299em;">&nbsp;much memory we</span><span class="stl_58 stl_59 stl_552" style="word-spacing:0.3703em;">&nbsp;need</span><span class="stl_58 stl_59 stl_552" style="word-spacing:0.4633em;">&nbsp;to</span><span class="stl_58 stl_59 stl_552" style="word-spacing:0.5323em;">&nbsp;f</span><span class="stl_58 stl_59 stl_552" style="word-spacing:-0.1857em;">&nbsp;r</span><span class="stl_58 stl_59 stl_552" style="word-spacing:-0.1867em;">&nbsp;ee</span><span class="stl_58 stl_59 stl_552" style="word-spacing:-0.0397em;">&nbsp;.</span><span class="stl_58 stl_59 stl_552" style="word-spacing:0.4693em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.9483em;"><span class="stl_10 stl_11 stl_757" style="word-spacing:0.234em;">mem_tofree =</span><span class="stl_10 stl_11 stl_757" style="word-spacing:0.173em;">&nbsp;mem_used</span><span class="stl_10 stl_11 stl_757" style="word-spacing:0.1421em;">&nbsp;</span><span class="stl_107 stl_108 stl_757" style="word-spacing:0.1421em;">−</span><span class="stl_107 stl_108 stl_757" style="word-spacing:0.3484em;">&nbsp;</span><span class="stl_10 stl_11 stl_757" style="word-spacing:0.3484em;">server</span><span class="stl_10 stl_11 stl_757" style="word-spacing:-0.032em;">&nbsp;.</span><span class="stl_10 stl_11 stl_757" style="word-spacing:-0.175em;">&nbsp;maxmemory</span><span class="stl_10 stl_11 stl_757" style="word-spacing:-0.175em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:7.9308em;"><span class="stl_10 stl_11 stl_758" style="word-spacing:0.1992em;">mem_freed =</span><span class="stl_10 stl_11 stl_758" style="word-spacing:0.3002em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5793em; left:7.9483em;"><span class="stl_15 stl_16 stl_493">while</span><span class="stl_15 stl_16 stl_493" style="word-spacing:0.4028em;">&nbsp;</span><span class="stl_10 stl_11 stl_493" style="word-spacing:0.4028em;">(mem_freed</span><span class="stl_10 stl_11 stl_493" style="word-spacing:0.1573em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_493" style="word-spacing:0.2373em;">&nbsp;mem_tofree</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.1977em;">&nbsp;)</span><span class="stl_10 stl_11 stl_493" style="word-spacing:-0.1977em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:9.9725em;"><span class="stl_15 stl_16 stl_571">int</span><span class="stl_15 stl_16 stl_571" style="word-spacing:0.325em;">&nbsp;</span><span class="stl_10 stl_11 stl_571" style="word-spacing:0.325em;">j</span><span class="stl_10 stl_11 stl_571" style="word-spacing:-0.1148em;">&nbsp;,</span><span class="stl_10 stl_11 stl_571" style="word-spacing:0.3132em;">&nbsp;k</span><span class="stl_10 stl_11 stl_571" style="word-spacing:-0.2628em;">&nbsp;,</span><span class="stl_10 stl_11 stl_571" style="word-spacing:0.3992em;">&nbsp;keys_freed</span><span class="stl_10 stl_11 stl_571" style="word-spacing:0.1492em;">&nbsp;=</span><span class="stl_10 stl_11 stl_571" style="word-spacing:0.1802em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">遍</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;历</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;所</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;集 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5652em; left:9.9733em;"><span class="stl_15 stl_16 stl_379">for</span><span class="stl_15 stl_16 stl_379" style="word-spacing:0.4146em;">&nbsp;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.4146em;">(</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.1393em;">&nbsp;j</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.2637em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.4967em;">&nbsp;j</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.2367em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.2937em;">&nbsp;server</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.0863em;">&nbsp;.</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.2393em;">&nbsp;dbnum</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.2413em;">&nbsp;;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.5167em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.5167em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.561em; left:11.9317em;"><span class="stl_15 stl_16 stl_279">long</span><span class="stl_15 stl_16 stl_279" style="word-spacing:0.3341em;">&nbsp;</span><span class="stl_10 stl_11 stl_279" style="word-spacing:0.3341em;">bestval</span><span class="stl_10 stl_11 stl_279" style="word-spacing:0.1872em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_279" style="word-spacing:0.348em;">&nbsp;</span><span class="stl_58 stl_59 stl_279" style="word-spacing:0.348em;">/* j</span><span class="stl_58 stl_59 stl_279" style="word-spacing:-0.3003em;">&nbsp;u</span><span class="stl_58 stl_59 stl_279" style="word-spacing:-0.3003em;">&nbsp;s</span><span class="stl_58 stl_59 stl_279" style="word-spacing:-0.3003em;">&nbsp;t</span><span class="stl_58 stl_59 stl_279" style="word-spacing:0.3992em;">&nbsp;to prevent</span><span class="stl_58 stl_59 stl_279" style="word-spacing:0.3497em;">&nbsp;warning</span><span class="stl_58 stl_59 stl_279" style="word-spacing:0.2847em;">&nbsp;*/ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">86 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.6158em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 11.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">数据淘汰机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:11.9775em;"><span class="stl_10 stl_11 stl_228" style="word-spacing:0.4463em;">sds bestkey</span><span class="stl_10 stl_11 stl_228" style="word-spacing:0.2433em;">&nbsp;=</span><span class="stl_10 stl_11 stl_228" style="word-spacing:0.0583em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:11.9575em;"><span class="stl_15 stl_16 stl_759">struct</span><span class="stl_15 stl_16 stl_759" style="word-spacing:0.3477em;">&nbsp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:0.3477em;">dictEntry</span><span class="stl_10 stl_11 stl_759" style="word-spacing:0.3071em;">&nbsp;*de</span><span class="stl_10 stl_11 stl_759" style="word-spacing:0.3071em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:11.9675em;"><span class="stl_10 stl_11 stl_760" style="word-spacing:0.3186em;">redisDb *db</span><span class="stl_10 stl_11 stl_760" style="word-spacing:0.1066em;">&nbsp;=</span><span class="stl_10 stl_11 stl_760" style="word-spacing:0.2216em;">&nbsp;server</span><span class="stl_10 stl_11 stl_760" style="word-spacing:-0.1284em;">&nbsp;.</span><span class="stl_10 stl_11 stl_760" style="word-spacing:-0.2434em;">&nbsp;db+j</span><span class="stl_10 stl_11 stl_760" style="word-spacing:-0.2434em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:12.005em;"><span class="stl_10 stl_11 stl_636" style="word-spacing:-0.093em;">dict * dict</span><span class="stl_10 stl_11 stl_636" style="word-spacing:-0.093em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:12.4057em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">不 同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;策</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;略，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;选</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;择</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;集</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;样 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:12.03em;"><span class="stl_15 stl_16 stl_761" style="word-spacing:-0.2048em;">i f</span><span class="stl_15 stl_16 stl_761" style="word-spacing:0.5016em;">&nbsp;</span><span class="stl_10 stl_11 stl_761" style="word-spacing:0.5016em;">(</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.1318em;">&nbsp;server</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.0768em;">&nbsp;.</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.1678em;">&nbsp;maxmemory_policy</span><span class="stl_10 stl_11 stl_761" style="word-spacing:0.1522em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:13.4483em;"><span class="stl_10 stl_11 stl_762" style="word-spacing:0.679em;">REDIS_MAXMEMORY_ALLKEYS_LRU |</span><span class="stl_10 stl_11 stl_762" style="word-spacing:0.679em;">&nbsp;| &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:13.995em;"><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.0759em;">server .</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.1689em;">&nbsp;maxmemory_policy</span><span class="stl_10 stl_11 stl_761" style="word-spacing:0.1511em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:15.4292em;"><span class="stl_10 stl_11 stl_763">REDIS_MAXMEMORY_ALLKEYS_RANDOM) &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.925em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 16.6785em; left:13.9975em;"><span class="stl_10 stl_11 stl_764" style="word-spacing:0.1355em;">dict = server</span><span class="stl_10 stl_11 stl_764" style="word-spacing:-0.216em;">&nbsp;.</span><span class="stl_10 stl_11 stl_764" style="word-spacing:-0.331em;">&nbsp;db</span><span class="stl_10 stl_11 stl_764" style="word-spacing:-0.331em;">&nbsp;[</span><span class="stl_10 stl_11 stl_764" style="word-spacing:-0.213em;">&nbsp;j</span><span class="stl_10 stl_11 stl_764" style="word-spacing:-0.159em;">&nbsp;]</span><span class="stl_10 stl_11 stl_764" style="word-spacing:-0.307em;">&nbsp;.</span><span class="stl_10 stl_11 stl_764" style="word-spacing:-0.159em;">&nbsp;dict</span><span class="stl_10 stl_11 stl_764" style="word-spacing:-0.159em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:12.9742em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:13.9975em;"><span class="stl_10 stl_11 stl_765" style="word-spacing:0.1318em;">dict = server</span><span class="stl_10 stl_11 stl_765" style="word-spacing:-0.2197em;">&nbsp;.</span><span class="stl_10 stl_11 stl_765" style="word-spacing:-0.3347em;">&nbsp;db</span><span class="stl_10 stl_11 stl_765" style="word-spacing:-0.3347em;">&nbsp;[</span><span class="stl_10 stl_11 stl_765" style="word-spacing:-0.2167em;">&nbsp;j</span><span class="stl_10 stl_11 stl_765" style="word-spacing:-0.1627em;">&nbsp;]</span><span class="stl_10 stl_11 stl_765" style="word-spacing:-0.3107em;">&nbsp;.</span><span class="stl_10 stl_11 stl_765" style="word-spacing:-0.1647em;">&nbsp;expires</span><span class="stl_10 stl_11 stl_765" style="word-spacing:-0.1647em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 19.6668em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 21.661em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.661em; left:12.4057em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">数 据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;集</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;为</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;空，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;继</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;续</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;下</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;集 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:12.03em;"><span class="stl_15 stl_16 stl_766" style="word-spacing:-0.2102em;">i f</span><span class="stl_15 stl_16 stl_766" style="word-spacing:0.4962em;">&nbsp;</span><span class="stl_10 stl_11 stl_766" style="word-spacing:0.4962em;">(</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.1242em;">&nbsp;d</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.2292em;">&nbsp;i</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.2292em;">&nbsp;c</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.2302em;">&nbsp;t</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.2292em;">&nbsp;S</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.2292em;">&nbsp;i</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.2292em;">&nbsp;z</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.2302em;">&nbsp;e</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.1232em;">&nbsp;(</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.1342em;">&nbsp;dict</span><span class="stl_10 stl_11 stl_766" style="word-spacing:-0.1342em;">&nbsp;)</span><span class="stl_10 stl_11 stl_766" style="word-spacing:0.1993em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_766" style="word-spacing:0.3735em;">&nbsp;</span><span class="stl_15 stl_16 stl_766" style="word-spacing:0.3735em;">continue</span><span class="stl_15 stl_16 stl_766" style="word-spacing:-0.169em;">&nbsp;</span><span class="stl_10 stl_11 stl_766" style="word-spacing:0.3735em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:12.4057em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">随 机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;淘</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;汰</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;随</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;策</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;略：</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;随</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;挑</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;选 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:12.4057em;z-index:367; "><span class="stl_58 stl_59 stl_767" style="word-spacing:0.5206em;">* v</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1384em;">&nbsp;o</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1394em;">&nbsp;l</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1384em;">&nbsp;a</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1384em;">&nbsp;t</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1394em;">&nbsp;i</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1384em;">&nbsp;l</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1384em;">&nbsp;e</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.0565em;">&nbsp;</span><span class="stl_107 stl_108 stl_767" style="word-spacing:-0.1384em;">−</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.0565em;">random</span><span class="stl_58 stl_59 stl_767" style="word-spacing:0.3816em;">&nbsp;and</span><span class="stl_58 stl_59 stl_767" style="word-spacing:0.4966em;">&nbsp;a</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1584em;">&nbsp;l</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1584em;">&nbsp;l</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1574em;">&nbsp;k</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1584em;">&nbsp;e</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1584em;">&nbsp;y</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1574em;">&nbsp;s</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.0959em;">&nbsp;</span><span class="stl_107 stl_108 stl_767" style="word-spacing:-0.1574em;">−</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.0959em;">random</span><span class="stl_58 stl_59 stl_767" style="word-spacing:0.4816em;">&nbsp;p</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1574em;">&nbsp;o</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1564em;">&nbsp;l</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1564em;">&nbsp;i</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1564em;">&nbsp;c</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.1574em;">&nbsp;y</span><span class="stl_58 stl_59 stl_767" style="word-spacing:0.5026em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.636em; left:12.03em;z-index:409; "><span class="stl_15 stl_16 stl_761" style="word-spacing:-0.2048em;">i f</span><span class="stl_15 stl_16 stl_761" style="word-spacing:0.5016em;">&nbsp;</span><span class="stl_10 stl_11 stl_761" style="word-spacing:0.5016em;">(</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.1318em;">&nbsp;server</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.0768em;">&nbsp;.</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.1678em;">&nbsp;maxmemory_policy</span><span class="stl_10 stl_11 stl_761" style="word-spacing:0.1522em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:13.4367em;"><span class="stl_10 stl_11 stl_768" style="word-spacing:0.6923em;">REDIS_MAXMEMORY_ALLKEYS_RANDOM |</span><span class="stl_10 stl_11 stl_768" style="word-spacing:0.6923em;">&nbsp;| &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:13.995em;"><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.0759em;">server .</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.1689em;">&nbsp;maxmemory_policy</span><span class="stl_10 stl_11 stl_761" style="word-spacing:0.1511em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:15.4342em;"><span class="stl_10 stl_11 stl_769">REDIS_MAXMEMORY_VOLATILE_RANDOM) &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:11.925em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 31.6218em; left:13.9308em;"><span class="stl_10 stl_11 stl_770" style="word-spacing:0.1851em;">de = dictGetRandomKey</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.2274em;">&nbsp;(</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.1334em;">&nbsp;dict</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.1334em;">&nbsp;)</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.1334em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:13.9708em;"><span class="stl_10 stl_11 stl_771" style="word-spacing:0.1832em;">bestkey =</span><span class="stl_10 stl_11 stl_771" style="word-spacing:-0.0925em;">&nbsp;dictGetKey (</span><span class="stl_10 stl_11 stl_771" style="word-spacing:-0.2707em;">&nbsp;de</span><span class="stl_10 stl_11 stl_771" style="word-spacing:-0.2697em;">&nbsp;)</span><span class="stl_10 stl_11 stl_771" style="word-spacing:-0.2697em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 35.6085em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.5943em; left:11.9783em;"><span class="stl_15 stl_16 stl_772" style="word-spacing:0.4991em;">else i</span><span class="stl_15 stl_16 stl_772" style="word-spacing:-0.2169em;">&nbsp;f</span><span class="stl_15 stl_16 stl_772" style="word-spacing:0.4898em;">&nbsp;</span><span class="stl_10 stl_11 stl_772" style="word-spacing:0.4898em;">(</span><span class="stl_10 stl_11 stl_772" style="word-spacing:-0.1439em;">&nbsp;server</span><span class="stl_10 stl_11 stl_772" style="word-spacing:-0.0879em;">&nbsp;.</span><span class="stl_10 stl_11 stl_772" style="word-spacing:-0.1799em;">&nbsp;maxmemory_policy</span><span class="stl_10 stl_11 stl_772" style="word-spacing:0.1401em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:13.4483em;"><span class="stl_10 stl_11 stl_762" style="word-spacing:0.679em;">REDIS_MAXMEMORY_ALLKEYS_LRU |</span><span class="stl_10 stl_11 stl_762" style="word-spacing:0.679em;">&nbsp;| &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:13.995em;"><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.0759em;">server .</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.1689em;">&nbsp;maxmemory_policy</span><span class="stl_10 stl_11 stl_761" style="word-spacing:0.1511em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:15.4458em;"><span class="stl_10 stl_11 stl_773">REDIS_MAXMEMORY_VOLATILE_LRU) &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:11.925em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 35.6085em; left:12.4058em;"><span class="stl_58 stl_59 stl_774" style="word-spacing:0.344em;">/ LRU</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.3847em;">&nbsp;</span><span class="stl_17 stl_18 stl_774" style="word-spacing:0.3847em;">策</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.007em;">&nbsp;略：</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.007em;">&nbsp;挑</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.04em;">&nbsp;选</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.04em;">&nbsp;最</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.04em;">&nbsp;近</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.04em;">&nbsp;最</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.04em;">&nbsp;少</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.04em;">&nbsp;使</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.04em;">&nbsp;用</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.04em;">&nbsp;的</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.04em;">&nbsp;数</span><span class="stl_17 stl_18 stl_774" style="word-spacing:-0.04em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:12.4058em;z-index:593; "><span class="stl_58 stl_59 stl_771" style="word-spacing:0.3873em;">* v</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2717em;">&nbsp;o</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2727em;">&nbsp;l</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2717em;">&nbsp;a</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2717em;">&nbsp;t</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2727em;">&nbsp;i</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2717em;">&nbsp;l</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2717em;">&nbsp;e</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.1898em;">&nbsp;</span><span class="stl_107 stl_108 stl_771" style="word-spacing:-0.2717em;">−</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.1898em;">lru</span><span class="stl_58 stl_59 stl_771" style="word-spacing:0.3598em;">&nbsp;and a</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2907em;">&nbsp;l</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2917em;">&nbsp;l</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2917em;">&nbsp;k</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2907em;">&nbsp;e</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2917em;">&nbsp;y</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2917em;">&nbsp;s</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2283em;">&nbsp;</span><span class="stl_107 stl_108 stl_771" style="word-spacing:-0.2917em;">−</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2283em;">lru</span><span class="stl_58 stl_59 stl_771" style="word-spacing:0.4563em;">&nbsp;p</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2897em;">&nbsp;o</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2907em;">&nbsp;l</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2897em;">&nbsp;i</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2897em;">&nbsp;c</span><span class="stl_58 stl_59 stl_771" style="word-spacing:-0.2897em;">&nbsp;y</span><span class="stl_58 stl_59 stl_771" style="word-spacing:0.3693em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:14.3983em;"><span class="stl_58 stl_59 stl_775" style="word-spacing:0.4156em;">/ server</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.0964em;">&nbsp;.</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.1924em;">&nbsp;maxmemory_samples</span><span class="stl_58 stl_59 stl_775" style="word-spacing:0.3619em;">&nbsp;</span><span class="stl_17 stl_18 stl_775" style="word-spacing:0.3619em;">为</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1824em;">&nbsp;随</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;机</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;挑</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;选</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;键</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;值</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;对 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.7998em; left:15.6192em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">次 数 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:14.3983em;"><span class="stl_58 stl_59 stl_431">/</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.3714em;">&nbsp;</span><span class="stl_17 stl_18 stl_431" style="word-spacing:0.3714em;">随</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1894em;">&nbsp;机</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1884em;">&nbsp;挑</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1884em;">&nbsp;选</span><span class="stl_17 stl_18 stl_431" style="word-spacing:0.4507em;">&nbsp;</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.4507em;">server</span><span class="stl_58 stl_59 stl_431" style="word-spacing:-0.1034em;">&nbsp;.</span><span class="stl_58 stl_59 stl_431" style="word-spacing:-0.1994em;">&nbsp;maxmemory_samples</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1994em;">个</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1884em;">&nbsp;键</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1884em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.7923em; left:15.6467em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3129em;">对， 驱 逐 最 近 最 少 使 用 的 数 据 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.561em; left:13.9583em;"><span class="stl_15 stl_16 stl_776">for</span><span class="stl_15 stl_16 stl_776" style="word-spacing:0.413em;">&nbsp;</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.413em;">(k</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.1541em;">&nbsp;=</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.2591em;">&nbsp;0;</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.3841em;">&nbsp;k</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.1241em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.2921em;">&nbsp;server</span><span class="stl_10 stl_11 stl_776" style="word-spacing:-0.0879em;">&nbsp;.</span><span class="stl_10 stl_11 stl_776" style="word-spacing:-0.1949em;">&nbsp;maxmemory_samples</span><span class="stl_10 stl_11 stl_776" style="word-spacing:-0.1959em;">&nbsp;;</span><span class="stl_10 stl_11 stl_776" style="word-spacing:-0.1959em;">&nbsp;k &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">11.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">总结 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">87 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:15.5058em;"><span class="stl_10 stl_11 stl_07">+</span></div>
					<div class="stl_01" style="top: 5.7193em; left:16.1227em;"><span class="stl_10 stl_11 stl_777" style="word-spacing:0.437em;">+) { &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:15.9625em;"><span class="stl_10 stl_11 stl_778" style="word-spacing:0.3387em;">sds thiskey</span><span class="stl_10 stl_11 stl_778" style="word-spacing:0.3387em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:15.9167em;"><span class="stl_15 stl_16 stl_779">long</span><span class="stl_15 stl_16 stl_779" style="word-spacing:0.4518em;">&nbsp;</span><span class="stl_10 stl_11 stl_779" style="word-spacing:0.4518em;">t</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2077em;">&nbsp;h</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2067em;">&nbsp;i</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2077em;">&nbsp;s</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2067em;">&nbsp;v</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2077em;">&nbsp;a</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2067em;">&nbsp;l</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2067em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:15.9758em;"><span class="stl_10 stl_11 stl_780" style="word-spacing:0.2855em;">robj *o</span><span class="stl_10 stl_11 stl_780" style="word-spacing:0.2855em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:15.9175em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:16.3907em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">随</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;挑</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;选</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;键</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;值</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;对 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:15.9233em;"><span class="stl_10 stl_11 stl_770" style="word-spacing:0.1851em;">de = dictGetRandomKey</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.2274em;">&nbsp;(</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.1334em;">&nbsp;dict</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.1334em;">&nbsp;)</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.1334em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:15.9175em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:16.3907em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">获</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;键 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:15.9808em;"><span class="stl_10 stl_11 stl_781" style="word-spacing:0.1876em;">thiskey =</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.1238em;">&nbsp;dictGetKey (</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2864em;">&nbsp;de</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2854em;">&nbsp;)</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2854em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:15.9175em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:16.3907em;"><span class="stl_58 stl_59 stl_607" style="word-spacing:0.277em;">* When</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.369em;">&nbsp;p</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.203em;">&nbsp;o</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.204em;">&nbsp;l</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.203em;">&nbsp;i</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.203em;">&nbsp;c</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.203em;">&nbsp;y</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.558em;">&nbsp;i</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.195em;">&nbsp;s</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.576em;">&nbsp;v</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.185em;">&nbsp;o</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.186em;">&nbsp;l</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.185em;">&nbsp;a</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.185em;">&nbsp;t</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.185em;">&nbsp;i</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.186em;">&nbsp;l</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.185em;">&nbsp;e</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.1038em;">&nbsp;</span><span class="stl_107 stl_108 stl_607" style="word-spacing:-0.185em;">−</span><span class="stl_58 stl_59 stl_607" style="word-spacing:-0.1038em;">lru</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.416em;">&nbsp;we</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.3595em;">&nbsp;need</span><span class="stl_58 stl_59 stl_607" style="word-spacing:0.3595em;">&nbsp;an &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:18.1533em;"><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3294em;">a d</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3294em;">&nbsp;d</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3304em;">&nbsp;i</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3294em;">&nbsp;t</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3294em;">&nbsp;i</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3294em;">&nbsp;o</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3294em;">&nbsp;n</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3294em;">&nbsp;a</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3304em;">&nbsp;l</span><span class="stl_58 stl_59 stl_547" style="word-spacing:0.3876em;">&nbsp;lookup &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:16.4033em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 18.6726em; left:17.4611em;"><span class="stl_58 stl_59 stl_782" style="word-spacing:0.3782em;">to l</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.3408em;">&nbsp;o</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.3408em;">&nbsp;c</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.3418em;">&nbsp;a</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.3408em;">&nbsp;t</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.3408em;">&nbsp;e</span><span class="stl_58 stl_59 stl_782" style="word-spacing:0.3817em;">&nbsp;the r</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.3428em;">&nbsp;eal</span><span class="stl_58 stl_59 stl_782" style="word-spacing:0.3352em;">&nbsp;key</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.1898em;">&nbsp;,</span><span class="stl_58 stl_59 stl_782" style="word-spacing:0.3517em;">&nbsp;as d</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.3358em;">&nbsp;i</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.3358em;">&nbsp;c</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.3358em;">&nbsp;t</span><span class="stl_58 stl_59 stl_782" style="word-spacing:0.4262em;">&nbsp;i</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.3328em;">&nbsp;s</span><span class="stl_58 stl_59 stl_782" style="word-spacing:0.4172em;">&nbsp;set &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:18.6242em;z-index:192; "><span class="stl_58 stl_59 stl_783" style="word-spacing:0.3567em;">to db</span><span class="stl_107 stl_108 stl_783" style="word-spacing:0.3567em;">−</span><span class="stl_58 stl_59 stl_783" style="word-spacing:0.3567em;">&gt;expires</span><span class="stl_58 stl_59 stl_783" style="word-spacing:-0.1273em;">&nbsp;.</span><span class="stl_58 stl_59 stl_783" style="word-spacing:0.3867em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:16.015em;z-index:213; "><span class="stl_15 stl_16 stl_761" style="word-spacing:-0.2048em;">i f</span><span class="stl_15 stl_16 stl_761" style="word-spacing:0.5016em;">&nbsp;</span><span class="stl_10 stl_11 stl_761" style="word-spacing:0.5016em;">(</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.1318em;">&nbsp;server</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.0768em;">&nbsp;.</span><span class="stl_10 stl_11 stl_761" style="word-spacing:-0.1678em;">&nbsp;maxmemory_policy</span><span class="stl_10 stl_11 stl_761" style="word-spacing:0.1522em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:17.4383em;"><span class="stl_10 stl_11 stl_773">REDIS_MAXMEMORY_VOLATILE_LRU) &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:17.9158em;z-index:275; "><span class="stl_10 stl_11 stl_784" style="word-spacing:0.1403em;">de =</span><span class="stl_10 stl_11 stl_784" style="word-spacing:-0.0145em;">&nbsp;dictFind (db</span><span class="stl_107 stl_108 stl_784" style="word-spacing:-0.0145em;">−</span><span class="stl_10 stl_11 stl_784" style="word-spacing:-0.0145em;">&gt;dict</span><span class="stl_10 stl_11 stl_784" style="word-spacing:-0.0307em;">&nbsp;,</span><span class="stl_10 stl_11 stl_784" style="word-spacing:0.4593em;">&nbsp;thiskey</span><span class="stl_10 stl_11 stl_784" style="word-spacing:-0.1967em;">&nbsp;)</span><span class="stl_10 stl_11 stl_784" style="word-spacing:-0.1967em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:15.91em;"><span class="stl_10 stl_11 stl_481" style="word-spacing:0.1024em;">o =</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.0822em;">&nbsp;dictGetVal (</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2856em;">&nbsp;de</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2856em;">&nbsp;)</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2856em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:15.9175em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:16.3907em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">计</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;算</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;闲</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:16.0008em;"><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3255em;">t h</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3245em;">&nbsp;i</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3255em;">&nbsp;s</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3245em;">&nbsp;v</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3245em;">&nbsp;a</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3255em;">&nbsp;l</span><span class="stl_10 stl_11 stl_474" style="word-spacing:0.1865em;">&nbsp;=</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.118em;">&nbsp;estimateObjectIdleTime (</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3295em;">&nbsp;o</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3285em;">&nbsp;)</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3285em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:15.9175em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:15.9175em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:16.3907em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">当 前</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;键</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;值</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;空</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;闲</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;间</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;更</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;长，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;则</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;记</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;录 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:16.3907em;"><span class="stl_58 stl_59 stl_785" style="word-spacing:0.287em;">* Higher</span><span class="stl_58 stl_59 stl_785" style="word-spacing:0.4em;">&nbsp;i</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.298em;">&nbsp;d</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.299em;">&nbsp;l</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.299em;">&nbsp;e</span><span class="stl_58 stl_59 stl_785" style="word-spacing:0.392em;">&nbsp;time i</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.311em;">&nbsp;s</span><span class="stl_58 stl_59 stl_785" style="word-spacing:0.451em;">&nbsp;b</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.31em;">&nbsp;e</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.31em;">&nbsp;t</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.31em;">&nbsp;t</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.31em;">&nbsp;e</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.31em;">&nbsp;r</span><span class="stl_58 stl_59 stl_785" style="word-spacing:0.414em;">&nbsp;candidate &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:17.645em;"><span class="stl_58 stl_59 stl_126" style="word-spacing:0.4207em;">for d</span><span class="stl_58 stl_59 stl_126" style="word-spacing:-0.3193em;">&nbsp;e</span><span class="stl_58 stl_59 stl_126" style="word-spacing:-0.3203em;">&nbsp;l</span><span class="stl_58 stl_59 stl_126" style="word-spacing:-0.3193em;">&nbsp;e</span><span class="stl_58 stl_59 stl_126" style="word-spacing:-0.3193em;">&nbsp;t</span><span class="stl_58 stl_59 stl_126" style="word-spacing:-0.3203em;">&nbsp;i</span><span class="stl_58 stl_59 stl_126" style="word-spacing:-0.3193em;">&nbsp;o</span><span class="stl_58 stl_59 stl_126" style="word-spacing:-0.3193em;">&nbsp;n</span><span class="stl_58 stl_59 stl_126" style="word-spacing:0.3397em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6168em; left:16.015em;"><span class="stl_15 stl_16 stl_786" style="word-spacing:-0.2234em;">i f</span><span class="stl_15 stl_16 stl_786" style="word-spacing:0.483em;">&nbsp;</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.483em;">(</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1794em;">&nbsp;bestkey</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.1966em;">&nbsp;==</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.0106em;">&nbsp;NULL</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.3446em;">&nbsp;|</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1844em;">&nbsp;|</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.5746em;">&nbsp;t</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2394em;">&nbsp;h</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2404em;">&nbsp;i</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2394em;">&nbsp;s</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2394em;">&nbsp;v</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2404em;">&nbsp;a</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2394em;">&nbsp;l</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.2416em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.2796em;">&nbsp;bestval</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.2796em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:18.0683em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 33.6143em; left:17.9558em;"><span class="stl_10 stl_11 stl_787" style="word-spacing:0.126em;">bestkey =</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.029em;">&nbsp;thiskey</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.029em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:17.9758em;"><span class="stl_10 stl_11 stl_788" style="word-spacing:0.1223em;">bestval =</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.2253em;">&nbsp;t h</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3677em;">&nbsp;i</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3677em;">&nbsp;s</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3687em;">&nbsp;v</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3677em;">&nbsp;a</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3687em;">&nbsp;l</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3687em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:15.91em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 36.6035em; left:13.9175em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.5993em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 39.5935em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5901em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:12.4057em;"><span class="stl_58 stl_59 stl_47" style="word-spacing:0.3407em;">/ TTL</span><span class="stl_58 stl_59 stl_47" style="word-spacing:0.3814em;">&nbsp;</span><span class="stl_17 stl_18 stl_47" style="word-spacing:0.3814em;">策</span><span class="stl_17 stl_18 stl_47" style="word-spacing:-0.0203em;">&nbsp;略：</span><span class="stl_17 stl_18 stl_47" style="word-spacing:-0.0203em;">&nbsp;挑</span><span class="stl_17 stl_18 stl_47" style="word-spacing:-0.0533em;">&nbsp;选</span><span class="stl_17 stl_18 stl_47" style="word-spacing:-0.0533em;">&nbsp;将</span><span class="stl_17 stl_18 stl_47" style="word-spacing:-0.0533em;">&nbsp;要</span><span class="stl_17 stl_18 stl_47" style="word-spacing:-0.0533em;">&nbsp;过</span><span class="stl_17 stl_18 stl_47" style="word-spacing:-0.0533em;">&nbsp;期</span><span class="stl_17 stl_18 stl_47" style="word-spacing:-0.0533em;">&nbsp;的</span><span class="stl_17 stl_18 stl_47" style="word-spacing:-0.0533em;">&nbsp;数</span><span class="stl_17 stl_18 stl_47" style="word-spacing:-0.0533em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:12.4057em;z-index:512; "><span class="stl_58 stl_59 stl_789" style="word-spacing:0.3896em;">* v</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.2694em;">&nbsp;o</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.2704em;">&nbsp;l</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.2694em;">&nbsp;a</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.2694em;">&nbsp;t</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.2704em;">&nbsp;i</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.2694em;">&nbsp;l</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.2694em;">&nbsp;e</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.1875em;">&nbsp;</span><span class="stl_107 stl_108 stl_789" style="word-spacing:-0.2694em;">−</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.1875em;">t</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.2204em;">&nbsp;t</span><span class="stl_58 stl_59 stl_789" style="word-spacing:-0.2204em;">&nbsp;l</span><span class="stl_58 stl_59 stl_789" style="word-spacing:0.4386em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5793em; left:11.9783em;"><span class="stl_15 stl_16 stl_772" style="word-spacing:0.4991em;">else i</span><span class="stl_15 stl_16 stl_772" style="word-spacing:-0.2169em;">&nbsp;f</span><span class="stl_15 stl_16 stl_772" style="word-spacing:0.4898em;">&nbsp;</span><span class="stl_10 stl_11 stl_772" style="word-spacing:0.4898em;">(</span><span class="stl_10 stl_11 stl_772" style="word-spacing:-0.1439em;">&nbsp;server</span><span class="stl_10 stl_11 stl_772" style="word-spacing:-0.0879em;">&nbsp;.</span><span class="stl_10 stl_11 stl_772" style="word-spacing:-0.1799em;">&nbsp;maxmemory_policy</span><span class="stl_10 stl_11 stl_772" style="word-spacing:0.1401em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:13.455em;"><span class="stl_10 stl_11 stl_790" style="word-spacing:0.7106em;">REDIS_MAXMEMORY_VOLATILE_TTL) { &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5718em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:14.3982em;"><span class="stl_58 stl_59 stl_775" style="word-spacing:0.4156em;">/ server</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.0964em;">&nbsp;.</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.1924em;">&nbsp;maxmemory_samples</span><span class="stl_58 stl_59 stl_775" style="word-spacing:0.3619em;">&nbsp;</span><span class="stl_17 stl_18 stl_775" style="word-spacing:0.3619em;">为</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1824em;">&nbsp;随</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;机</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;挑</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;选</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;键</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;值</span><span class="stl_17 stl_18 stl_775" style="word-spacing:-0.1814em;">&nbsp;对 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.7957em; left:15.6192em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">次 数 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:14.3982em;"><span class="stl_58 stl_59 stl_431">/</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.3714em;">&nbsp;</span><span class="stl_17 stl_18 stl_431" style="word-spacing:0.3714em;">随</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1894em;">&nbsp;机</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1884em;">&nbsp;挑</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1884em;">&nbsp;选</span><span class="stl_17 stl_18 stl_431" style="word-spacing:0.4507em;">&nbsp;</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.4507em;">server</span><span class="stl_58 stl_59 stl_431" style="word-spacing:-0.1034em;">&nbsp;.</span><span class="stl_58 stl_59 stl_431" style="word-spacing:-0.1994em;">&nbsp;maxmemory_samples</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1994em;">个</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1884em;">&nbsp;键</span><span class="stl_17 stl_18 stl_431" style="word-spacing:-0.1884em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.7882em; left:15.6467em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3126em;">对， 驱 逐 最 快 要 过 期 的 数 据 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">88 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.6158em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 11.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">数据淘汰机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:13.9583em;"><span class="stl_15 stl_16 stl_776">for</span><span class="stl_15 stl_16 stl_776" style="word-spacing:0.413em;">&nbsp;</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.413em;">(k</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.1541em;">&nbsp;=</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.2591em;">&nbsp;0;</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.3841em;">&nbsp;k</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.1241em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_776" style="word-spacing:0.2921em;">&nbsp;server</span><span class="stl_10 stl_11 stl_776" style="word-spacing:-0.0879em;">&nbsp;.</span><span class="stl_10 stl_11 stl_776" style="word-spacing:-0.1949em;">&nbsp;maxmemory_samples</span><span class="stl_10 stl_11 stl_776" style="word-spacing:-0.1959em;">&nbsp;;</span><span class="stl_10 stl_11 stl_776" style="word-spacing:-0.1959em;">&nbsp;k &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:15.5058em;"><span class="stl_10 stl_11 stl_07">+</span></div>
					<div class="stl_01" style="top: 6.7151em; left:16.1227em;"><span class="stl_10 stl_11 stl_777" style="word-spacing:0.437em;">+) { &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:15.9625em;"><span class="stl_10 stl_11 stl_778" style="word-spacing:0.3387em;">sds thiskey</span><span class="stl_10 stl_11 stl_778" style="word-spacing:0.3387em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:15.9167em;"><span class="stl_15 stl_16 stl_779">long</span><span class="stl_15 stl_16 stl_779" style="word-spacing:0.4518em;">&nbsp;</span><span class="stl_10 stl_11 stl_779" style="word-spacing:0.4518em;">t</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2077em;">&nbsp;h</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2067em;">&nbsp;i</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2077em;">&nbsp;s</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2067em;">&nbsp;v</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2077em;">&nbsp;a</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2067em;">&nbsp;l</span><span class="stl_10 stl_11 stl_779" style="word-spacing:-0.2067em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:15.9233em;"><span class="stl_10 stl_11 stl_770" style="word-spacing:0.1851em;">de = dictGetRandomKey</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.2274em;">&nbsp;(</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.1334em;">&nbsp;dict</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.1334em;">&nbsp;)</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.1334em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:15.9808em;"><span class="stl_10 stl_11 stl_781" style="word-spacing:0.1876em;">thiskey =</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.1237em;">&nbsp;dictGetKey (</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2864em;">&nbsp;de</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2854em;">&nbsp;)</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2854em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:16.0008em;"><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2776em;">t h</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2766em;">&nbsp;i</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2776em;">&nbsp;s</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2766em;">&nbsp;v</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2766em;">&nbsp;a</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2776em;">&nbsp;l</span><span class="stl_10 stl_11 stl_129" style="word-spacing:0.2344em;">&nbsp;=</span><span class="stl_10 stl_11 stl_129" style="word-spacing:0.1794em;">&nbsp;(</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2716em;">&nbsp;</span><span class="stl_15 stl_16 stl_129" style="word-spacing:-0.2716em;">long</span><span class="stl_15 stl_16 stl_129" style="word-spacing:-0.2726em;">&nbsp;</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2726em;">)</span><span class="stl_10 stl_11 stl_129" style="word-spacing:0.3764em;">&nbsp;dictGetVal</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2236em;">&nbsp;(</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2646em;">&nbsp;de</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2646em;">&nbsp;)</span><span class="stl_10 stl_11 stl_129" style="word-spacing:-0.2646em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:15.9175em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:16.3907em;"><span class="stl_58 stl_59 stl_85" style="word-spacing:0.3054em;">* Expire</span><span class="stl_58 stl_59 stl_85" style="word-spacing:0.3439em;">&nbsp;sooner (</span><span class="stl_58 stl_59 stl_85" style="word-spacing:-0.3026em;">&nbsp;minor</span><span class="stl_58 stl_59 stl_85" style="word-spacing:0.3414em;">&nbsp;expire</span><span class="stl_58 stl_59 stl_85" style="word-spacing:0.3834em;">&nbsp;unix &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:17.6033em;"><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2443em;">timestamp )</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.4267em;">&nbsp;i</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2693em;">&nbsp;s</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.4938em;">&nbsp;b</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2683em;">&nbsp;e</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2683em;">&nbsp;t</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2683em;">&nbsp;t</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2683em;">&nbsp;e</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2683em;">&nbsp;r &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:16.4033em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 16.6801em; left:17.4652em;"><span class="stl_58 stl_59 stl_791" style="word-spacing:0.3882em;">candidate for d</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.3363em;">&nbsp;e</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.3353em;">&nbsp;l</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.3353em;">&nbsp;e</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.3363em;">&nbsp;t</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.3353em;">&nbsp;i</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.3353em;">&nbsp;o</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.3353em;">&nbsp;n</span><span class="stl_58 stl_59 stl_791" style="word-spacing:0.3237em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:16.015em;"><span class="stl_15 stl_16 stl_786" style="word-spacing:-0.2234em;">i f</span><span class="stl_15 stl_16 stl_786" style="word-spacing:0.483em;">&nbsp;</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.483em;">(</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1794em;">&nbsp;bestkey</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.1966em;">&nbsp;==</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.0106em;">&nbsp;NULL</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.3446em;">&nbsp;|</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1844em;">&nbsp;|</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.5746em;">&nbsp;t</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2394em;">&nbsp;h</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2404em;">&nbsp;i</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2394em;">&nbsp;s</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2394em;">&nbsp;v</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2404em;">&nbsp;a</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2394em;">&nbsp;l</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.2416em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.2796em;">&nbsp;bestval</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.2796em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:18.0683em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 19.6668em; left:17.9558em;"><span class="stl_10 stl_11 stl_787" style="word-spacing:0.126em;">bestkey =</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.029em;">&nbsp;thiskey</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.029em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:17.9758em;"><span class="stl_10 stl_11 stl_788" style="word-spacing:0.1223em;">bestval =</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.2253em;">&nbsp;t h</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3677em;">&nbsp;i</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3677em;">&nbsp;s</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3687em;">&nbsp;v</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3677em;">&nbsp;a</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3687em;">&nbsp;l</span><span class="stl_10 stl_11 stl_788" style="word-spacing:-0.3687em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:15.91em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 22.656em; left:13.9175em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6518em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 25.646em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">删</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;除</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;选</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;定</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;键</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;值</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;对 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:12.4057em;"><span class="stl_58 stl_59 stl_792" style="word-spacing:0.3384em;">* Finally remove the</span><span class="stl_58 stl_59 stl_792" style="word-spacing:0.4214em;">&nbsp;s</span><span class="stl_58 stl_59 stl_792" style="word-spacing:-0.3036em;">&nbsp;e</span><span class="stl_58 stl_59 stl_792" style="word-spacing:-0.3036em;">&nbsp;l</span><span class="stl_58 stl_59 stl_792" style="word-spacing:-0.3026em;">&nbsp;e</span><span class="stl_58 stl_59 stl_792" style="word-spacing:-0.3036em;">&nbsp;c</span><span class="stl_58 stl_59 stl_792" style="word-spacing:-0.3036em;">&nbsp;t</span><span class="stl_58 stl_59 stl_792" style="word-spacing:-0.3026em;">&nbsp;e</span><span class="stl_58 stl_59 stl_792" style="word-spacing:-0.3036em;">&nbsp;d</span><span class="stl_58 stl_59 stl_792" style="word-spacing:0.3954em;">&nbsp;key</span><span class="stl_58 stl_59 stl_792" style="word-spacing:-0.2196em;">&nbsp;.</span><span class="stl_58 stl_59 stl_792" style="word-spacing:0.3414em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:12.03em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:-0.3033em;">i f</span><span class="stl_15 stl_16 stl_217" style="word-spacing:0.4031em;">&nbsp;</span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.4031em;">(</span><span class="stl_10 stl_11 stl_217" style="word-spacing:-0.2593em;">&nbsp;bestkey</span><span class="stl_10 stl_11 stl_217" style="word-spacing:-0.2593em;">&nbsp;)</span><span class="stl_10 stl_11 stl_217" style="word-spacing:-0.2593em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6285em; left:13.9242em;"><span class="stl_15 stl_16 stl_793" style="word-spacing:0.286em;">long long</span><span class="stl_15 stl_16 stl_793" style="word-spacing:0.3665em;">&nbsp;</span><span class="stl_10 stl_11 stl_793" style="word-spacing:0.3665em;">delta</span><span class="stl_10 stl_11 stl_793" style="word-spacing:0.3665em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:13.9833em;"><span class="stl_10 stl_11 stl_794" style="word-spacing:-0.0315em;">robj * keyobj</span><span class="stl_10 stl_11 stl_794" style="word-spacing:0.1175em;">&nbsp;=</span><span class="stl_10 stl_11 stl_794" style="word-spacing:-0.1059em;">&nbsp;createStringObject (</span><span class="stl_10 stl_11 stl_794" style="word-spacing:-0.2915em;">&nbsp;bestkey</span><span class="stl_10 stl_11 stl_794" style="word-spacing:-0.2915em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:15.6525em;"><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.2696em;">sdslen ( bestkey ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:14.3982em;"><span class="stl_58 stl_59 stl_795">/</span><span class="stl_58 stl_59 stl_795" style="word-spacing:0.5418em;">&nbsp;</span><span class="stl_17 stl_18 stl_795" style="word-spacing:0.5418em;">发</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.019em;">&nbsp;布</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;数</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;据</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;更</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;新</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;消</span><span class="stl_17 stl_18 stl_795" style="word-spacing:0.0155em;">&nbsp;息， 主</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;要</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;是</span><span class="stl_17 stl_18 stl_795" style="word-spacing:0.3918em;">&nbsp;</span><span class="stl_58 stl_59 stl_795" style="word-spacing:0.3918em;">AOF</span><span class="stl_58 stl_59 stl_795" style="word-spacing:0.3906em;">&nbsp;</span><span class="stl_17 stl_18 stl_795" style="word-spacing:0.3906em;">持</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.019em;">&nbsp;久</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;化</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;和</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;从</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:13.9683em;"><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.2298em;">propagateExpire (db , keyobj ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:14.3982em;"><span class="stl_58 stl_59 stl_450">/</span><span class="stl_58 stl_59 stl_450" style="word-spacing:0.2664em;">&nbsp;</span><span class="stl_17 stl_18 stl_450" style="word-spacing:0.2664em;">注</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2604em;">&nbsp;意，</span><span class="stl_17 stl_18 stl_450" style="word-spacing:0.3612em;">&nbsp;</span><span class="stl_58 stl_59 stl_450" style="word-spacing:0.3612em;">propagateExpire</span><span class="stl_58 stl_59 stl_450" style="word-spacing:-0.2454em;">&nbsp;()</span><span class="stl_58 stl_59 stl_450" style="word-spacing:0.3345em;">&nbsp;</span><span class="stl_17 stl_18 stl_450" style="word-spacing:0.3345em;">可</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2944em;">&nbsp;能</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2934em;">&nbsp;会</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2934em;">&nbsp;导</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2934em;">&nbsp;致</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2934em;">&nbsp;内</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2934em;">&nbsp;存</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2934em;">&nbsp;的 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:15.6192em;"><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2605em;">分 配，</span><span class="stl_17 stl_18 stl_450" style="word-spacing:0.3611em;">&nbsp;</span><span class="stl_58 stl_59 stl_450" style="word-spacing:0.3611em;">propagateExpire</span><span class="stl_58 stl_59 stl_450" style="word-spacing:-0.2455em;">&nbsp;()</span><span class="stl_58 stl_59 stl_450" style="word-spacing:0.3334em;">&nbsp;</span><span class="stl_17 stl_18 stl_450" style="word-spacing:0.3334em;">提</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;前</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;执</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;行</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;就</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;是</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;因</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;为 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:15.6592em;"><span class="stl_58 stl_59 stl_796">redis</span><span class="stl_58 stl_59 stl_796" style="word-spacing:0.3353em;">&nbsp;</span><span class="stl_17 stl_18 stl_796" style="word-spacing:0.3353em;">只</span><span class="stl_17 stl_18 stl_796" style="word-spacing:-0.3148em;">&nbsp;计</span><span class="stl_17 stl_18 stl_796" style="word-spacing:-0.3138em;">&nbsp;算</span><span class="stl_17 stl_18 stl_796" style="word-spacing:0.3098em;">&nbsp;</span><span class="stl_58 stl_59 stl_796" style="word-spacing:0.3098em;">dbDelete</span><span class="stl_58 stl_59 stl_796" style="word-spacing:-0.2638em;">&nbsp;()</span><span class="stl_58 stl_59 stl_796" style="word-spacing:-0.0004em;">&nbsp;</span><span class="stl_17 stl_18 stl_796" style="word-spacing:-0.0004em;">释 放</span><span class="stl_17 stl_18 stl_796" style="word-spacing:-0.3138em;">&nbsp;的</span><span class="stl_17 stl_18 stl_796" style="word-spacing:-0.3138em;">&nbsp;内</span><span class="stl_17 stl_18 stl_796" style="word-spacing:-0.3138em;">&nbsp;存</span><span class="stl_17 stl_18 stl_796" style="word-spacing:-0.3138em;">&nbsp;大</span><span class="stl_17 stl_18 stl_796" style="word-spacing:-0.2808em;">&nbsp;小。</span><span class="stl_17 stl_18 stl_796" style="word-spacing:-0.2808em;">&nbsp;倘 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:15.6192em;"><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">若 同</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;时</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;计</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;算</span><span class="stl_17 stl_18 stl_454" style="word-spacing:0.3255em;">&nbsp;</span><span class="stl_58 stl_59 stl_454" style="word-spacing:0.3255em;">dbDelete</span><span class="stl_58 stl_59 stl_454" style="word-spacing:-0.247em;">&nbsp;()</span><span class="stl_58 stl_59 stl_454" style="word-spacing:0.3303em;">&nbsp;</span><span class="stl_17 stl_18 stl_454" style="word-spacing:0.3303em;">释</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.298em;">&nbsp;放</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;的</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;内</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;存</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;和 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:15.6358em;"><span class="stl_58 stl_59 stl_450" style="word-spacing:-0.2455em;">propagateExpire ()</span><span class="stl_58 stl_59 stl_450" style="word-spacing:0.3344em;">&nbsp;</span><span class="stl_17 stl_18 stl_450" style="word-spacing:0.3344em;">分</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2945em;">&nbsp;配</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;空</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;间</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;的</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;大</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2595em;">&nbsp;小，</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2605em;">&nbsp;与</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;此</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;同</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;时 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.8065em; left:15.6192em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3125em;">假 设 分 配 空 间 大 于 释 放 空 间， 就 有 可 能 永 远 退 不 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.8032em; left:15.6192em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3078em;">出 这 个 循 环。 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:14.3982em;"><span class="stl_58 stl_59 stl_626">/</span><span class="stl_58 stl_59 stl_626" style="word-spacing:-0.0342em;">&nbsp;</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.0342em;">下 面</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;的</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;代</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;码</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;会</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;同</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;时</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;计</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;算</span><span class="stl_17 stl_18 stl_626" style="word-spacing:0.3272em;">&nbsp;</span><span class="stl_58 stl_59 stl_626" style="word-spacing:0.3272em;">dbDelete</span><span class="stl_58 stl_59 stl_626" style="word-spacing:-0.2455em;">&nbsp;()</span><span class="stl_58 stl_59 stl_626" style="word-spacing:0.3308em;">&nbsp;</span><span class="stl_17 stl_18 stl_626" style="word-spacing:0.3308em;">释</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;放</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;的</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;内</span><span class="stl_17 stl_18 stl_626" style="word-spacing:-0.2965em;">&nbsp;存 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:15.6192em;"><span class="stl_17 stl_18 stl_450">和</span><span class="stl_17 stl_18 stl_450" style="word-spacing:0.3272em;">&nbsp;</span><span class="stl_58 stl_59 stl_450" style="word-spacing:0.3272em;">propagateExpire</span><span class="stl_58 stl_59 stl_450" style="word-spacing:-0.2455em;">&nbsp;()</span><span class="stl_58 stl_59 stl_450" style="word-spacing:0.3334em;">&nbsp;</span><span class="stl_17 stl_18 stl_450" style="word-spacing:0.3334em;">分</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;配</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;空</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;间</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;的</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2935em;">&nbsp;大</span><span class="stl_17 stl_18 stl_450" style="word-spacing:-0.2605em;">&nbsp;小： &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:14.3982em;"><span class="stl_58 stl_59 stl_797" style="word-spacing:0.2901em;">/ propagateExpire</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.2739em;">&nbsp;(</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.3369em;">&nbsp;db</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.2289em;">&nbsp;,</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.2129em;">&nbsp;keyobj</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.2629em;">&nbsp;)</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.2629em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.5676em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.5676em; left:14.3982em;"><span class="stl_58 stl_59 stl_798" style="word-spacing:0.4043em;">/ d</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.2547em;">&nbsp;e</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.2547em;">&nbsp;l</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.2547em;">&nbsp;t</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.2547em;">&nbsp;a</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.2623em;">&nbsp;=</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.2023em;">&nbsp;(</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.1927em;">&nbsp;long</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.4343em;">&nbsp;long</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.1917em;">&nbsp;)</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.3483em;">&nbsp;zmalloc_used_memory</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.2187em;">&nbsp;()</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.2187em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">11.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">总结 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">89 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:14.3982em;"><span class="stl_58 stl_59 stl_799" style="word-spacing:0.2902em;">/ dbDelete</span><span class="stl_58 stl_59 stl_799" style="word-spacing:-0.2728em;">&nbsp;(</span><span class="stl_58 stl_59 stl_799" style="word-spacing:-0.3398em;">&nbsp;db</span><span class="stl_58 stl_59 stl_799" style="word-spacing:-0.2308em;">&nbsp;,</span><span class="stl_58 stl_59 stl_799" style="word-spacing:-0.2148em;">&nbsp;keyobj</span><span class="stl_58 stl_59 stl_799" style="word-spacing:-0.2648em;">&nbsp;)</span><span class="stl_58 stl_59 stl_799" style="word-spacing:-0.2648em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:14.3982em;"><span class="stl_58 stl_59 stl_800" style="word-spacing:0.4172em;">/ d</span><span class="stl_58 stl_59 stl_800" style="word-spacing:-0.2418em;">&nbsp;e</span><span class="stl_58 stl_59 stl_800" style="word-spacing:-0.2418em;">&nbsp;l</span><span class="stl_58 stl_59 stl_800" style="word-spacing:-0.2418em;">&nbsp;t</span><span class="stl_58 stl_59 stl_800" style="word-spacing:-0.2418em;">&nbsp;a</span><span class="stl_58 stl_59 stl_800" style="word-spacing:0.1863em;">&nbsp;</span><span class="stl_107 stl_108 stl_800" style="word-spacing:-0.2418em;">−</span><span class="stl_58 stl_59 stl_800" style="word-spacing:0.1863em;">=</span><span class="stl_58 stl_59 stl_800" style="word-spacing:0.2122em;">&nbsp;(</span><span class="stl_58 stl_59 stl_800" style="word-spacing:-0.1788em;">&nbsp;long</span><span class="stl_58 stl_59 stl_800" style="word-spacing:0.4482em;">&nbsp;long</span><span class="stl_58 stl_59 stl_800" style="word-spacing:-0.1788em;">&nbsp;)</span><span class="stl_58 stl_59 stl_800" style="word-spacing:0.3612em;">&nbsp;zmalloc_used_memory</span><span class="stl_58 stl_59 stl_800" style="word-spacing:-0.2058em;">&nbsp;() &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:15.6575em;"><span class="stl_58 stl_59 stl_07">;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:14.3982em;"><span class="stl_58 stl_59 stl_98" style="word-spacing:0.4021em;">/ mem_freed</span><span class="stl_58 stl_59 stl_98" style="word-spacing:0.2321em;">&nbsp;+=</span><span class="stl_58 stl_59 stl_98" style="word-spacing:0.3451em;">&nbsp;d</span><span class="stl_58 stl_59 stl_98" style="word-spacing:-0.1419em;">&nbsp;e</span><span class="stl_58 stl_59 stl_98" style="word-spacing:-0.1419em;">&nbsp;l</span><span class="stl_58 stl_59 stl_98" style="word-spacing:-0.1419em;">&nbsp;t</span><span class="stl_58 stl_59 stl_98" style="word-spacing:-0.1419em;">&nbsp;a</span><span class="stl_58 stl_59 stl_98" style="word-spacing:-0.1419em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:14.3982em;"><span class="stl_58 stl_59 stl_701">//////////////////////////////////////// &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:14.3982em;"><span class="stl_58 stl_59 stl_801" style="word-spacing:0.1963em;">* We compute</span><span class="stl_58 stl_59 stl_801" style="word-spacing:0.3976em;">&nbsp;the amount of</span><span class="stl_58 stl_59 stl_801" style="word-spacing:0.3628em;">&nbsp;memory freed</span><span class="stl_58 stl_59 stl_801" style="word-spacing:0.4423em;">&nbsp;by &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:15.6383em;"><span class="stl_58 stl_59 stl_219" style="word-spacing:-0.2423em;">dbDelete ()</span><span class="stl_58 stl_59 stl_219" style="word-spacing:0.3517em;">&nbsp;alone</span><span class="stl_58 stl_59 stl_219" style="word-spacing:0.3517em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 15.6835em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 17.676em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 13.691em; left:15.5034em;"><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2376em;">I t</span><span class="stl_58 stl_59 stl_611" style="word-spacing:0.5244em;">&nbsp;i</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2356em;">&nbsp;s</span><span class="stl_58 stl_59 stl_611" style="word-spacing:0.5274em;">&nbsp;p</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2336em;">&nbsp;o</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2336em;">&nbsp;s</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2336em;">&nbsp;s</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2326em;">&nbsp;i</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2336em;">&nbsp;b</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2336em;">&nbsp;l</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2336em;">&nbsp;e</span><span class="stl_58 stl_59 stl_611" style="word-spacing:0.5079em;">&nbsp;that a</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2356em;">&nbsp;c</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2366em;">&nbsp;t</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2366em;">&nbsp;u</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2366em;">&nbsp;a</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2366em;">&nbsp;l</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2356em;">&nbsp;l</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2366em;">&nbsp;y</span><span class="stl_58 stl_59 stl_611" style="word-spacing:0.4874em;">&nbsp;the</span><span class="stl_58 stl_59 stl_611" style="word-spacing:0.3384em;">&nbsp;memory &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:16.11em;"><span class="stl_58 stl_59 stl_802" style="word-spacing:0.3574em;">needed to propagate &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:15.4727em;"><span class="stl_58 stl_59 stl_803" style="word-spacing:0.3662em;">the DEL in</span><span class="stl_58 stl_59 stl_803" style="word-spacing:0.3337em;">&nbsp;AOF</span><span class="stl_58 stl_59 stl_803" style="word-spacing:0.2767em;">&nbsp;and</span><span class="stl_58 stl_59 stl_803" style="word-spacing:0.5327em;">&nbsp;r</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1223em;">&nbsp;e</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1223em;">&nbsp;p</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1213em;">&nbsp;l</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1223em;">&nbsp;i</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1213em;">&nbsp;c</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1223em;">&nbsp;a</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1223em;">&nbsp;t</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1213em;">&nbsp;i</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1223em;">&nbsp;o</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1213em;">&nbsp;n</span><span class="stl_58 stl_59 stl_803" style="word-spacing:0.6407em;">&nbsp;l</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1223em;">&nbsp;i</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1223em;">&nbsp;n</span><span class="stl_58 stl_59 stl_803" style="word-spacing:-0.1223em;">&nbsp;k</span><span class="stl_58 stl_59 stl_803" style="word-spacing:0.6397em;">&nbsp;i</span><span class="stl_58 stl_59 stl_803" style="word-spacing:0.6397em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:16.1517em;"><span class="stl_58 stl_59 stl_474" style="word-spacing:0.3452em;">greater than the</span><span class="stl_58 stl_59 stl_474" style="word-spacing:0.3067em;">&nbsp;one &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:15.3905em;"><span class="stl_58 stl_59 stl_804" style="word-spacing:0.2984em;">we are</span><span class="stl_58 stl_59 stl_804" style="word-spacing:0.4264em;">&nbsp;f</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2756em;">&nbsp;r</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2766em;">&nbsp;e</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2756em;">&nbsp;e</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2756em;">&nbsp;i</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2756em;">&nbsp;n</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2766em;">&nbsp;g</span><span class="stl_58 stl_59 stl_804" style="word-spacing:0.3907em;">&nbsp;removing the key</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.1246em;">&nbsp;,</span><span class="stl_58 stl_59 stl_804" style="word-spacing:0.4354em;">&nbsp;but</span><span class="stl_58 stl_59 stl_804" style="word-spacing:0.3154em;">&nbsp;we &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:16.09em;"><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.1948em;">can ’</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.2258em;">&nbsp;t</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3837em;">&nbsp;account</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3837em;">&nbsp;for &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:15.4885em;"><span class="stl_58 stl_59 stl_91" style="word-spacing:0.3946em;">that otherwise</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.2766em;">&nbsp;we</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.2316em;">&nbsp;would</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.3126em;">&nbsp;never</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.3936em;">&nbsp;e</span><span class="stl_58 stl_59 stl_91" style="word-spacing:-0.3134em;">&nbsp;x</span><span class="stl_58 stl_59 stl_91" style="word-spacing:-0.3134em;">&nbsp;i</span><span class="stl_58 stl_59 stl_91" style="word-spacing:-0.3124em;">&nbsp;t</span><span class="stl_58 stl_59 stl_91" style="word-spacing:0.4106em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:16.1358em;"><span class="stl_58 stl_59 stl_625" style="word-spacing:-0.225em;">loop . &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 22.6576em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 22.6576em; left:15.2942em;"><span class="stl_58 stl_59 stl_560" style="word-spacing:0.2004em;">AOF and</span><span class="stl_58 stl_59 stl_560" style="word-spacing:0.3754em;">&nbsp;Output</span><span class="stl_58 stl_59 stl_560" style="word-spacing:0.4794em;">&nbsp;b</span><span class="stl_58 stl_59 stl_560" style="word-spacing:-0.2036em;">&nbsp;u</span><span class="stl_58 stl_59 stl_560" style="word-spacing:-0.2026em;">&nbsp;f</span><span class="stl_58 stl_59 stl_560" style="word-spacing:-0.2036em;">&nbsp;f</span><span class="stl_58 stl_59 stl_560" style="word-spacing:-0.2036em;">&nbsp;e</span><span class="stl_58 stl_59 stl_560" style="word-spacing:-0.2036em;">&nbsp;r</span><span class="stl_58 stl_59 stl_560" style="word-spacing:0.4214em;">&nbsp;memory w</span><span class="stl_58 stl_59 stl_560" style="word-spacing:-0.1786em;">&nbsp;i</span><span class="stl_58 stl_59 stl_560" style="word-spacing:-0.1786em;">&nbsp;l</span><span class="stl_58 stl_59 stl_560" style="word-spacing:-0.1776em;">&nbsp;l</span><span class="stl_58 stl_59 stl_560" style="word-spacing:0.4934em;">&nbsp;be</span><span class="stl_58 stl_59 stl_560" style="word-spacing:0.4934em;">&nbsp;freed &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:16.6592em;"><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.286em;">e v</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.285em;">&nbsp;e</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.285em;">&nbsp;n</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.285em;">&nbsp;t</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.286em;">&nbsp;u</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.285em;">&nbsp;a</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.285em;">&nbsp;l</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.286em;">&nbsp;l</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.285em;">&nbsp;y</span><span class="stl_58 stl_59 stl_806" style="word-spacing:0.408em;">&nbsp;so &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:15.3905em;"><span class="stl_58 stl_59 stl_807" style="word-spacing:0.3236em;">we only</span><span class="stl_58 stl_59 stl_807" style="word-spacing:0.4031em;">&nbsp;care about</span><span class="stl_58 stl_59 stl_807" style="word-spacing:0.2961em;">&nbsp;memory used</span><span class="stl_58 stl_59 stl_807" style="word-spacing:0.3856em;">&nbsp;by the</span><span class="stl_58 stl_59 stl_807" style="word-spacing:0.3856em;">&nbsp;key &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:16.1242em;"><span class="stl_58 stl_59 stl_808" style="word-spacing:-0.1914em;">space .</span><span class="stl_58 stl_59 stl_808" style="word-spacing:0.3596em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 26.6426em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:14.3982em;"><span class="stl_58 stl_59 stl_809">/</span><span class="stl_58 stl_59 stl_809" style="word-spacing:-0.0347em;">&nbsp;</span><span class="stl_17 stl_18 stl_809" style="word-spacing:-0.0347em;">只 计</span><span class="stl_17 stl_18 stl_809" style="word-spacing:-0.2968em;">&nbsp;算</span><span class="stl_17 stl_18 stl_809" style="word-spacing:0.3269em;">&nbsp;</span><span class="stl_58 stl_59 stl_809" style="word-spacing:0.3269em;">dbDelete</span><span class="stl_58 stl_59 stl_809" style="word-spacing:-0.2468em;">&nbsp;()</span><span class="stl_58 stl_59 stl_809" style="word-spacing:0.3316em;">&nbsp;</span><span class="stl_17 stl_18 stl_809" style="word-spacing:0.3316em;">释</span><span class="stl_17 stl_18 stl_809" style="word-spacing:-0.2978em;">&nbsp;放</span><span class="stl_17 stl_18 stl_809" style="word-spacing:-0.2967em;">&nbsp;内</span><span class="stl_17 stl_18 stl_809" style="word-spacing:-0.2968em;">&nbsp;存</span><span class="stl_17 stl_18 stl_809" style="word-spacing:-0.2968em;">&nbsp;的</span><span class="stl_17 stl_18 stl_809" style="word-spacing:-0.2968em;">&nbsp;大</span><span class="stl_17 stl_18 stl_809" style="word-spacing:-0.2968em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:13.9908em;"><span class="stl_10 stl_11 stl_333" style="word-spacing:0.2569em;">delta =</span><span class="stl_10 stl_11 stl_333" style="word-spacing:0.2229em;">&nbsp;(</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.2284em;">&nbsp;</span><span class="stl_15 stl_16 stl_333" style="word-spacing:-0.2284em;">long</span><span class="stl_15 stl_16 stl_333" style="word-spacing:0.3229em;">&nbsp;long</span><span class="stl_15 stl_16 stl_333" style="word-spacing:-0.2289em;">&nbsp;</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.2289em;">)</span><span class="stl_10 stl_11 stl_333" style="word-spacing:0.3689em;">&nbsp;zmalloc_used_memory</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.1951em;">&nbsp;()</span><span class="stl_10 stl_11 stl_333" style="word-spacing:-0.1951em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:13.9608em;"><span class="stl_10 stl_11 stl_810" style="word-spacing:-0.218em;">dbDelete (db , keyobj ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6243em; left:13.9908em;z-index:546; "><span class="stl_10 stl_11 stl_811">delta</span><span class="stl_10 stl_11 stl_811" style="word-spacing:0.1788em;">&nbsp;</span><span class="stl_107 stl_108 stl_811">−</span><span class="stl_10 stl_11 stl_811" style="word-spacing:0.1788em;">=</span><span class="stl_10 stl_11 stl_811" style="word-spacing:0.2347em;">&nbsp;(</span><span class="stl_10 stl_11 stl_811" style="word-spacing:-0.2181em;">&nbsp;</span><span class="stl_15 stl_16 stl_811" style="word-spacing:-0.2181em;">long</span><span class="stl_15 stl_16 stl_811" style="word-spacing:0.3347em;">&nbsp;long</span><span class="stl_15 stl_16 stl_811" style="word-spacing:-0.2182em;">&nbsp;</span><span class="stl_10 stl_11 stl_811" style="word-spacing:-0.2182em;">)</span><span class="stl_10 stl_11 stl_811" style="word-spacing:0.3807em;">&nbsp;zmalloc_used_memory</span><span class="stl_10 stl_11 stl_811" style="word-spacing:-0.1843em;">&nbsp;()</span><span class="stl_10 stl_11 stl_811" style="word-spacing:-0.1843em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:13.9092em;"><span class="stl_10 stl_11 stl_631" style="word-spacing:0.156em;">mem_freed +=</span><span class="stl_10 stl_11 stl_631" style="word-spacing:0.253em;">&nbsp;delta</span><span class="stl_10 stl_11 stl_631" style="word-spacing:0.253em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:13.995em;"><span class="stl_10 stl_11 stl_283" style="word-spacing:-0.193em;">server . stat_evictedkeys++; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:14.3982em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">将</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;删</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;除</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;通</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;知</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;所</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;订</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;阅</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;客</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;户</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;端 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:13.965em;"><span class="stl_10 stl_11 stl_98" style="word-spacing:-0.0829em;">notifyKeyspaceEvent (REDIS_NOTIFY_EVICTED,</span><span class="stl_10 stl_11 stl_98" style="word-spacing:-0.0829em;">&nbsp;” &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:15.6517em;"><span class="stl_10 stl_11 stl_812" style="word-spacing:-0.2883em;">evicted ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:15.945em;z-index:701; "><span class="stl_10 stl_11 stl_813" style="word-spacing:0.0119em;">keyobj ,</span><span class="stl_10 stl_11 stl_813" style="word-spacing:0.4498em;">&nbsp;db</span><span class="stl_107 stl_108 stl_813" style="word-spacing:0.4498em;">−</span><span class="stl_10 stl_11 stl_813" style="word-spacing:0.4498em;">&gt;id</span><span class="stl_10 stl_11 stl_813" style="word-spacing:-0.1052em;">&nbsp;)</span><span class="stl_10 stl_11 stl_813" style="word-spacing:-0.1052em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:13.9492em;"><span class="stl_10 stl_11 stl_806" style="word-spacing:-0.2172em;">decrRefCount ( keyobj ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:13.9675em;"><span class="stl_10 stl_11 stl_814">keys_freed++; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:14.3982em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">将</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;回</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;复</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;及</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;送</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;给</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:14.3982em;"><span class="stl_58 stl_59 stl_106" style="word-spacing:0.2478em;">* When</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.3108em;">&nbsp;the</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.3483em;">&nbsp;memory to</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.4838em;">&nbsp;f</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2342em;">&nbsp;ree</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.5348em;">&nbsp;s</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2162em;">&nbsp;t</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2162em;">&nbsp;a</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2162em;">&nbsp;r</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2152em;">&nbsp;t</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2162em;">&nbsp;s</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.5028em;">&nbsp;to</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.4398em;">&nbsp;be</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.4398em;">&nbsp;big &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:15.5942em;"><span class="stl_58 stl_59 stl_377" style="word-spacing:-0.0558em;">enough ,</span><span class="stl_58 stl_59 stl_377" style="word-spacing:0.4303em;">&nbsp;we</span><span class="stl_58 stl_59 stl_377" style="word-spacing:0.2803em;">&nbsp;may &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 44.5752em; left:15.5076em;"><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2826em;">s t</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2816em;">&nbsp;a</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2816em;">&nbsp;r</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2826em;">&nbsp;t</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.4314em;">&nbsp;spending</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.3584em;">&nbsp;so</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.2624em;">&nbsp;much time</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.3584em;">&nbsp;here</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.4044em;">&nbsp;that</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.4574em;">&nbsp;i</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.4574em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:16.1517em;"><span class="stl_58 stl_59 stl_788" style="word-spacing:0.3324em;">impossible to &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 46.5676em; left:15.5068em;"><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2725em;">d e</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2735em;">&nbsp;l</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2725em;">&nbsp;i</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2735em;">&nbsp;v</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2725em;">&nbsp;e</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2725em;">&nbsp;r</span><span class="stl_58 stl_59 stl_471" style="word-spacing:0.4335em;">&nbsp;data</span><span class="stl_58 stl_59 stl_471" style="word-spacing:0.396em;">&nbsp;to the</span><span class="stl_58 stl_59 stl_471" style="word-spacing:0.4425em;">&nbsp;s</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2825em;">&nbsp;l</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2825em;">&nbsp;a</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2815em;">&nbsp;v</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2825em;">&nbsp;e</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2815em;">&nbsp;s</span><span class="stl_58 stl_59 stl_471" style="word-spacing:0.4855em;">&nbsp;f</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2695em;">&nbsp;a</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2705em;">&nbsp;s</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.2705em;">&nbsp;t</span><span class="stl_58 stl_59 stl_471" style="word-spacing:0.3995em;">&nbsp;enough</span><span class="stl_58 stl_59 stl_471" style="word-spacing:-0.1515em;">&nbsp;,</span><span class="stl_58 stl_59 stl_471" style="word-spacing:0.4015em;">&nbsp;so &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">90 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.6158em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 11.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">数据淘汰机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:16.5533em;"><span class="stl_58 stl_59 stl_110" style="word-spacing:0.277em;">we force</span><span class="stl_58 stl_59 stl_110" style="word-spacing:0.377em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:15.4744em;"><span class="stl_58 stl_59 stl_307" style="word-spacing:0.3474em;">transmission here in</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.3491em;">&nbsp;side</span><span class="stl_58 stl_59 stl_307" style="word-spacing:0.3604em;">&nbsp;the loop</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.2301em;">&nbsp;.</span><span class="stl_58 stl_59 stl_307" style="word-spacing:0.3069em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:14.0225em;"><span class="stl_15 stl_16 stl_597" style="word-spacing:-0.3372em;">i f</span><span class="stl_15 stl_16 stl_597" style="word-spacing:0.3692em;">&nbsp;</span><span class="stl_10 stl_11 stl_597" style="word-spacing:0.3692em;">(</span><span class="stl_10 stl_11 stl_597" style="word-spacing:-0.2562em;">&nbsp;s</span><span class="stl_10 stl_11 stl_597" style="word-spacing:-0.3612em;">&nbsp;l</span><span class="stl_10 stl_11 stl_597" style="word-spacing:-0.3622em;">&nbsp;a</span><span class="stl_10 stl_11 stl_597" style="word-spacing:-0.3612em;">&nbsp;v</span><span class="stl_10 stl_11 stl_597" style="word-spacing:-0.3612em;">&nbsp;e</span><span class="stl_10 stl_11 stl_597" style="word-spacing:-0.3612em;">&nbsp;s</span><span class="stl_10 stl_11 stl_597" style="word-spacing:-0.2562em;">&nbsp;)</span><span class="stl_10 stl_11 stl_597" style="word-spacing:0.3238em;">&nbsp;flushSlavesOutputBuffers</span><span class="stl_10 stl_11 stl_597" style="word-spacing:-0.2412em;">&nbsp;()</span><span class="stl_10 stl_11 stl_597" style="word-spacing:-0.2412em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7076em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.7043em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 11.6985em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:10.4132em;"><span class="stl_58 stl_59 stl_519">/</span><span class="stl_58 stl_59 stl_519" style="word-spacing:-0.1228em;">&nbsp;</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.1228em;">未 能</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;释</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;放</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;空</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3068em;">&nbsp;间，</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3078em;">&nbsp;且</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;此</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;时</span><span class="stl_17 stl_18 stl_519" style="word-spacing:0.308em;">&nbsp;</span><span class="stl_58 stl_59 stl_519" style="word-spacing:0.308em;">redis</span><span class="stl_58 stl_59 stl_519" style="word-spacing:-0.0335em;">&nbsp;</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.0335em;">使 用</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;的</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;内</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;存</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;大</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;小</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;依</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;旧</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;超 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.9148em; left:11.6617em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3078em;">额， 失 败 返 回 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:10.0375em;"><span class="stl_15 stl_16 stl_816" style="word-spacing:-0.1954em;">i f</span><span class="stl_15 stl_16 stl_816" style="word-spacing:0.5833em;">&nbsp;</span><span class="stl_10 stl_11 stl_816" style="word-spacing:0.5833em;">(</span><span class="stl_10 stl_11 stl_816" style="word-spacing:-0.1944em;">&nbsp;!</span><span class="stl_10 stl_11 stl_816" style="word-spacing:-0.0834em;">&nbsp;keys_freed</span><span class="stl_10 stl_11 stl_816" style="word-spacing:-0.1564em;">&nbsp;)</span><span class="stl_10 stl_11 stl_816" style="word-spacing:0.3923em;">&nbsp;</span><span class="stl_15 stl_16 stl_816" style="word-spacing:0.3923em;">return</span><span class="stl_15 stl_16 stl_816" style="word-spacing:0.2257em;">&nbsp;</span><span class="stl_10 stl_11 stl_816" style="word-spacing:0.2257em;">REDIS_ERR;</span><span class="stl_10 stl_11 stl_816" style="word-spacing:0.4286em;">&nbsp;</span><span class="stl_58 stl_59 stl_816" style="word-spacing:0.4286em;">/* nothing</span><span class="stl_58 stl_59 stl_816" style="word-spacing:0.4826em;">&nbsp;to f</span><span class="stl_58 stl_59 stl_816" style="word-spacing:-0.2214em;">&nbsp;re</span><span class="stl_58 stl_59 stl_816" style="word-spacing:-0.2214em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:12.17em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.15em;">. .</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.509em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:11.7333em;"><span class="stl_58 stl_59 stl_07">.</span></div>
					<div class="stl_01" style="top: 15.6818em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 16.6735em; left:7.9458em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9639em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 12 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.7648em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1247em;">RDB </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1247em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6091em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 20.6091em; left:6.5789em;"><span class="stl_38 stl_13 stl_817">2.1</span><span class="stl_38 stl_13 stl_817" style="word-spacing:0.7536em;">&nbsp;</span><span class="stl_39 stl_18 stl_817" style="word-spacing:0.7536em;">简介</span><span class="stl_39 stl_18 stl_817" style="word-spacing:0.1297em;">&nbsp;</span><span class="stl_38 stl_13 stl_817" style="word-spacing:0.1297em;">redis</span><span class="stl_38 stl_13 stl_817" style="word-spacing:0.1288em;">&nbsp;</span><span class="stl_39 stl_18 stl_817" style="word-spacing:0.1288em;">持久化</span><span class="stl_39 stl_18 stl_817" style="word-spacing:0.1292em;">&nbsp;</span><span class="stl_38 stl_13 stl_817" style="word-spacing:0.1292em;">RDB</span><span class="stl_39 stl_18 stl_817" style="word-spacing:0.1292em;">、</span><span class="stl_38 stl_13 stl_817" style="word-spacing:0.1292em;">AOF &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9268em; left:7.5658em;"><span class="stl_10 stl_11 stl_818" style="word-spacing:0.0888em;">redis </span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.0888em;">提供两种持久化方式：</span><span class="stl_10 stl_11 stl_818" style="word-spacing:0.0888em;">RDB </span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.0888em;">和 </span><span class="stl_10 stl_11 stl_818" style="word-spacing:0.0888em;">AOF</span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.0888em;">。</span><span class="stl_10 stl_11 stl_818" style="word-spacing:0.0888em;">redis </span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.0888em;">允许两者结合，也允许两者同 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.1448em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">时关闭。 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.9593em; left:7.5658em;"><span class="stl_10 stl_11 stl_229" style="word-spacing:0.0848em;">RDB </span><span class="stl_17 stl_18 stl_229" style="word-spacing:0.0848em;">可以定时备份内存中的数据集。服务器启动的时候，可以从 </span><span class="stl_10 stl_11 stl_229" style="word-spacing:0.0848em;">RDB </span><span class="stl_17 stl_18 stl_229" style="word-spacing:0.0848em;">文件中 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.1782em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">回复数据集。 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.9918em; left:7.5658em;"><span class="stl_10 stl_11 stl_544" style="word-spacing:0.0832em;">AOF </span><span class="stl_17 stl_18 stl_544" style="word-spacing:0.0832em;">可以记录服务器的所有写操作。在服务器重新启动的时候，会把所有的写 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.2107em; left:5.9058em;z-index:196; "><span class="stl_17 stl_18 stl_819">操作重新执行一遍，从而实现数据备份。当写操作集过大（比原有的数据集还大）， &nbsp;</span></div>
					<div class="stl_01" style="top: 28.9843em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">会重写写操作集。 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.021em; left:7.5658em;"><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0789em;">本篇主要讲的是 </span><span class="stl_10 stl_11 stl_331" style="word-spacing:0.0789em;">RDB </span><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0789em;">持久化，了解 </span><span class="stl_10 stl_11 stl_331" style="word-spacing:0.0789em;">RDB </span><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0789em;">的数据保存结构和运作机制。</span><span class="stl_10 stl_11 stl_331" style="word-spacing:0.0789em;">redis </span><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0789em;">主 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.0176em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">要在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">rdb.h </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">和 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">rdb.c </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">两个文件中实现 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">RDB </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">的操作。 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.5541em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 33.5541em; left:6.5789em;"><span class="stl_38 stl_13 stl_07">2.2</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">数据结构</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1254em;">&nbsp;</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1254em;">rio &nbsp;</span></div>
					<div class="stl_01" style="top: 35.871em; left:7.5658em;"><span class="stl_17 stl_18 stl_820" style="word-spacing:0.0839em;">持久化的 </span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.0839em;">IO </span><span class="stl_17 stl_18 stl_820" style="word-spacing:0.0839em;">操作在 </span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.0839em;">rio.h </span><span class="stl_17 stl_18 stl_820" style="word-spacing:0.0839em;">和 </span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.0839em;">rio.c </span><span class="stl_17 stl_18 stl_820" style="word-spacing:0.0839em;">中实现，核心数据结构是 </span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.0839em;">struct rio</span><span class="stl_17 stl_18 stl_820" style="word-spacing:0.0839em;">。</span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.0839em;">RDB </span><span class="stl_17 stl_18 stl_820" style="word-spacing:0.0839em;">中 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.8676em; left:5.9058em;"><span class="stl_17 stl_18 stl_821" style="word-spacing:0.0802em;">的几乎每一个函数都带有 </span><span class="stl_10 stl_11 stl_821" style="word-spacing:0.0802em;">rio </span><span class="stl_17 stl_18 stl_821" style="word-spacing:0.0802em;">参数。</span><span class="stl_10 stl_11 stl_821" style="word-spacing:0.0802em;">struct rio </span><span class="stl_17 stl_18 stl_821" style="word-spacing:0.0802em;">既适用于文件，又适用于内存缓存，从 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.8635em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">struct rio </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">的实现可见一斑。 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4302em; left:5.98em;"><span class="stl_15 stl_16 stl_294">struct</span><span class="stl_15 stl_16 stl_294" style="word-spacing:0.3528em;">&nbsp;</span><span class="stl_10 stl_11 stl_294" style="word-spacing:0.3528em;">_rio</span><span class="stl_10 stl_11 stl_294" style="word-spacing:0.3528em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4293em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.4326em; left:8.4207em;"><span class="stl_58 stl_59 stl_581">/</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.0752em;">&nbsp;</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.0752em;">函 数</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;指</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;针，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;包</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;括</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;读</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;操</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.283em;">&nbsp;作，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;写</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;操</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;作</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;和</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;文</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;件</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;指</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;针</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;移</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;动</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;操</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;作 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:8.4207em;"><span class="stl_58 stl_59 stl_662" style="word-spacing:0.2563em;">* Backend</span><span class="stl_58 stl_59 stl_662" style="word-spacing:0.3383em;">&nbsp;functions</span><span class="stl_58 stl_59 stl_662" style="word-spacing:0.3383em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 43.4251em; left:9.4819em;"><span class="stl_58 stl_59 stl_822" style="word-spacing:0.3723em;">Since t</span><span class="stl_58 stl_59 stl_822" style="word-spacing:-0.3357em;">&nbsp;h</span><span class="stl_58 stl_59 stl_822" style="word-spacing:-0.3357em;">&nbsp;i</span><span class="stl_58 stl_59 stl_822" style="word-spacing:-0.3347em;">&nbsp;s</span><span class="stl_58 stl_59 stl_822" style="word-spacing:0.4053em;">&nbsp;functions</span><span class="stl_58 stl_59 stl_822" style="word-spacing:0.2963em;">&nbsp;do</span><span class="stl_58 stl_59 stl_822" style="word-spacing:0.2543em;">&nbsp;not</span><span class="stl_58 stl_59 stl_822" style="word-spacing:0.3633em;">&nbsp;t</span><span class="stl_58 stl_59 stl_822" style="word-spacing:-0.3347em;">&nbsp;o</span><span class="stl_58 stl_59 stl_822" style="word-spacing:-0.3357em;">&nbsp;l</span><span class="stl_58 stl_59 stl_822" style="word-spacing:-0.3347em;">&nbsp;e</span><span class="stl_58 stl_59 stl_822" style="word-spacing:-0.3357em;">&nbsp;r</span><span class="stl_58 stl_59 stl_822" style="word-spacing:-0.3347em;">&nbsp;a</span><span class="stl_58 stl_59 stl_822" style="word-spacing:-0.3357em;">&nbsp;t</span><span class="stl_58 stl_59 stl_822" style="word-spacing:-0.3347em;">&nbsp;e</span><span class="stl_58 stl_59 stl_822" style="word-spacing:0.3883em;">&nbsp;short writes</span><span class="stl_58 stl_59 stl_822" style="word-spacing:0.3293em;">&nbsp;or &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:10.1517em;"><span class="stl_58 stl_59 stl_276" style="word-spacing:0.3521em;">reads the return &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 45.4176em; left:9.4994em;"><span class="stl_58 stl_59 stl_823" style="word-spacing:0.4349em;">value i</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.2941em;">&nbsp;s</span><span class="stl_58 stl_59 stl_823" style="word-spacing:0.4689em;">&nbsp;s</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.2921em;">&nbsp;i</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.2911em;">&nbsp;m</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.2921em;">&nbsp;p</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.2921em;">&nbsp;l</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.2911em;">&nbsp;i</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.2921em;">&nbsp;f</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.2921em;">&nbsp;i</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.2921em;">&nbsp;e</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.2911em;">&nbsp;d</span><span class="stl_58 stl_59 stl_823" style="word-spacing:0.4269em;">&nbsp;to</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.1911em;">&nbsp;:</span><span class="stl_58 stl_59 stl_823" style="word-spacing:0.4109em;">&nbsp;zero</span><span class="stl_58 stl_59 stl_823" style="word-spacing:0.3004em;">&nbsp;on error</span><span class="stl_58 stl_59 stl_823" style="word-spacing:-0.0911em;">&nbsp;,</span><span class="stl_58 stl_59 stl_823" style="word-spacing:0.3136em;">&nbsp;non zero</span><span class="stl_58 stl_59 stl_823" style="word-spacing:0.3136em;">&nbsp;on &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:10.1483em;"><span class="stl_58 stl_59 stl_451" style="word-spacing:0.3603em;">complete success</span><span class="stl_58 stl_59 stl_451" style="word-spacing:-0.2027em;">&nbsp;.</span><span class="stl_58 stl_59 stl_451" style="word-spacing:0.3243em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:8.005em;"><span class="stl_10 stl_11 stl_781" style="word-spacing:0.3735em;">size_t (*</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2535em;">&nbsp;read</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2515em;">&nbsp;)</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2475em;">&nbsp;(</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2623em;">&nbsp;</span><span class="stl_15 stl_16 stl_781" style="word-spacing:-0.2623em;">struct</span><span class="stl_15 stl_16 stl_781" style="word-spacing:0.3348em;">&nbsp;</span><span class="stl_10 stl_11 stl_781" style="word-spacing:0.3348em;">_rio *</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2475em;">&nbsp;,</span><span class="stl_10 stl_11 stl_781" style="word-spacing:0.2991em;">&nbsp;</span><span class="stl_15 stl_16 stl_781" style="word-spacing:0.2991em;">void</span><span class="stl_15 stl_16 stl_781" style="word-spacing:0.2436em;">&nbsp;</span><span class="stl_10 stl_11 stl_781" style="word-spacing:0.2436em;">*buf</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.1445em;">&nbsp;,</span><span class="stl_10 stl_11 stl_781" style="word-spacing:0.416em;">&nbsp;size_t len</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2225em;">&nbsp;)</span><span class="stl_10 stl_11 stl_781" style="word-spacing:-0.2225em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.845em;"><span class="stl_10 stl_11 stl_07">9</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.2601em;"><span class="stl_10 stl_11 stl_07">1</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">92 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.185em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 12.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;RDB</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0839em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0839em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:8.005em;"><span class="stl_10 stl_11 stl_741" style="word-spacing:0.3805em;">size_t (*</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.2185em;">&nbsp;write</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.2175em;">&nbsp;)</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.2405em;">&nbsp;(</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.2561em;">&nbsp;</span><span class="stl_15 stl_16 stl_741" style="word-spacing:-0.2561em;">struct</span><span class="stl_15 stl_16 stl_741" style="word-spacing:0.3428em;">&nbsp;</span><span class="stl_10 stl_11 stl_741" style="word-spacing:0.3428em;">_rio *</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.2405em;">&nbsp;,</span><span class="stl_10 stl_11 stl_741" style="word-spacing:0.3161em;">&nbsp;</span><span class="stl_15 stl_16 stl_741" style="word-spacing:0.3161em;">const</span><span class="stl_15 stl_16 stl_741" style="word-spacing:0.2635em;">&nbsp;void</span><span class="stl_15 stl_16 stl_741" style="word-spacing:0.2509em;">&nbsp;</span><span class="stl_10 stl_11 stl_741" style="word-spacing:0.2509em;">*buf</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.1375em;">&nbsp;,</span><span class="stl_10 stl_11 stl_741" style="word-spacing:0.4385em;">&nbsp;size_t &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.6667em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.26em;">len ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:8.0017em;"><span class="stl_10 stl_11 stl_265" style="word-spacing:0.372em;">off_t (*</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.15em;">&nbsp;t</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.254em;">&nbsp;e</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.254em;">&nbsp;l</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.253em;">&nbsp;l</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.149em;">&nbsp;)</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.245em;">&nbsp;(</span><span class="stl_10 stl_11 stl_265" style="word-spacing:-0.26em;">&nbsp;</span><span class="stl_15 stl_16 stl_265" style="word-spacing:-0.26em;">struct</span><span class="stl_15 stl_16 stl_265" style="word-spacing:0.3368em;">&nbsp;</span><span class="stl_10 stl_11 stl_265" style="word-spacing:0.3368em;">_rio *)</span><span class="stl_10 stl_11 stl_265" style="word-spacing:0.3368em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">校</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;验</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;和</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;计</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;算</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4207em;"><span class="stl_58 stl_59 stl_824" style="word-spacing:0.3221em;">* The update_cksum</span><span class="stl_58 stl_59 stl_824" style="word-spacing:0.3646em;">&nbsp;method</span><span class="stl_58 stl_59 stl_824" style="word-spacing:0.4896em;">&nbsp;i</span><span class="stl_58 stl_59 stl_824" style="word-spacing:-0.1744em;">&nbsp;f</span><span class="stl_58 stl_59 stl_824" style="word-spacing:0.5236em;">&nbsp;not</span><span class="stl_58 stl_59 stl_824" style="word-spacing:0.2606em;">&nbsp;NULL</span><span class="stl_58 stl_59 stl_824" style="word-spacing:0.3226em;">&nbsp;i</span><span class="stl_58 stl_59 stl_824" style="word-spacing:-0.2094em;">&nbsp;s</span><span class="stl_58 stl_59 stl_824" style="word-spacing:0.4661em;">&nbsp;used to</span><span class="stl_58 stl_59 stl_824" style="word-spacing:0.4206em;">&nbsp;compute &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:10.16em;"><span class="stl_58 stl_59 stl_825" style="word-spacing:0.3697em;">the checksum of &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.5533em;"><span class="stl_58 stl_59 stl_826" style="word-spacing:-0.2772em;">a l</span><span class="stl_58 stl_59 stl_826" style="word-spacing:-0.2762em;">&nbsp;l</span><span class="stl_58 stl_59 stl_826" style="word-spacing:0.4468em;">&nbsp;the</span><span class="stl_58 stl_59 stl_826" style="word-spacing:0.3693em;">&nbsp;data that</span><span class="stl_58 stl_59 stl_826" style="word-spacing:0.3258em;">&nbsp;was</span><span class="stl_58 stl_59 stl_826" style="word-spacing:0.2818em;">&nbsp;read</span><span class="stl_58 stl_59 stl_826" style="word-spacing:0.3168em;">&nbsp;or</span><span class="stl_58 stl_59 stl_826" style="word-spacing:0.3605em;">&nbsp;written so far</span><span class="stl_58 stl_59 stl_826" style="word-spacing:-0.1842em;">&nbsp;.</span><span class="stl_58 stl_59 stl_826" style="word-spacing:0.3028em;">&nbsp;The &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:10.1108em;"><span class="stl_58 stl_59 stl_471" style="word-spacing:0.3645em;">method should be &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:9.4952em;"><span class="stl_58 stl_59 stl_110" style="word-spacing:0.3334em;">designed so that can</span><span class="stl_58 stl_59 stl_110" style="word-spacing:0.2721em;">&nbsp;be</span><span class="stl_58 stl_59 stl_110" style="word-spacing:0.3691em;">&nbsp;c</span><span class="stl_58 stl_59 stl_110" style="word-spacing:-0.3249em;">&nbsp;a</span><span class="stl_58 stl_59 stl_110" style="word-spacing:-0.3239em;">&nbsp;l</span><span class="stl_58 stl_59 stl_110" style="word-spacing:-0.3239em;">&nbsp;l</span><span class="stl_58 stl_59 stl_110" style="word-spacing:-0.3239em;">&nbsp;e</span><span class="stl_58 stl_59 stl_110" style="word-spacing:-0.3249em;">&nbsp;d</span><span class="stl_58 stl_59 stl_110" style="word-spacing:0.3931em;">&nbsp;with</span><span class="stl_58 stl_59 stl_110" style="word-spacing:0.3576em;">&nbsp;the</span><span class="stl_58 stl_59 stl_110" style="word-spacing:0.3576em;">&nbsp;current &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.1133em;"><span class="stl_58 stl_59 stl_827" style="word-spacing:-0.1326em;">checksum ,</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.3729em;">&nbsp;and the</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.4314em;">&nbsp;buf &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.4371em;"><span class="stl_58 stl_59 stl_828" style="word-spacing:0.3019em;">and len</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.4419em;">&nbsp;f</span><span class="stl_58 stl_59 stl_828" style="word-spacing:-0.2891em;">&nbsp;i</span><span class="stl_58 stl_59 stl_828" style="word-spacing:-0.2901em;">&nbsp;e</span><span class="stl_58 stl_59 stl_828" style="word-spacing:-0.2891em;">&nbsp;l</span><span class="stl_58 stl_59 stl_828" style="word-spacing:-0.2891em;">&nbsp;d</span><span class="stl_58 stl_59 stl_828" style="word-spacing:-0.2891em;">&nbsp;s</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.4499em;">&nbsp;pointing</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.3684em;">&nbsp;to the</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.2794em;">&nbsp;new block</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.3609em;">&nbsp;of data</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.3609em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:10.1117em;"><span class="stl_58 stl_59 stl_829" style="word-spacing:0.3638em;">add to</span><span class="stl_58 stl_59 stl_829" style="word-spacing:0.4218em;">&nbsp;the</span><span class="stl_58 stl_59 stl_829" style="word-spacing:0.3778em;">&nbsp;checksum &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.4753em;"><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.197em;">computation .</span><span class="stl_58 stl_59 stl_361" style="word-spacing:0.362em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:7.9408em;"><span class="stl_15 stl_16 stl_830">void</span><span class="stl_15 stl_16 stl_830" style="word-spacing:0.369em;">&nbsp;</span><span class="stl_10 stl_11 stl_830" style="word-spacing:0.369em;">(*</span><span class="stl_10 stl_11 stl_830" style="word-spacing:-0.2303em;">&nbsp;update_cksum</span><span class="stl_10 stl_11 stl_830" style="word-spacing:-0.2283em;">&nbsp;)</span><span class="stl_10 stl_11 stl_830" style="word-spacing:-0.1763em;">&nbsp;(</span><span class="stl_10 stl_11 stl_830" style="word-spacing:-0.1918em;">&nbsp;</span><span class="stl_15 stl_16 stl_830" style="word-spacing:-0.1918em;">struct</span><span class="stl_15 stl_16 stl_830" style="word-spacing:0.407em;">&nbsp;</span><span class="stl_10 stl_11 stl_830" style="word-spacing:0.407em;">_rio *</span><span class="stl_10 stl_11 stl_830" style="word-spacing:-0.1763em;">&nbsp;,</span><span class="stl_10 stl_11 stl_830" style="word-spacing:0.3804em;">&nbsp;</span><span class="stl_15 stl_16 stl_830" style="word-spacing:0.3804em;">const</span><span class="stl_15 stl_16 stl_830" style="word-spacing:0.3277em;">&nbsp;void</span><span class="stl_15 stl_16 stl_830" style="word-spacing:0.3141em;">&nbsp;</span><span class="stl_10 stl_11 stl_830" style="word-spacing:0.3141em;">*buf</span><span class="stl_10 stl_11 stl_830" style="word-spacing:0.3141em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:9.665em;"><span class="stl_10 stl_11 stl_404" style="word-spacing:0.3504em;">size_t len</span><span class="stl_10 stl_11 stl_404" style="word-spacing:-0.2726em;">&nbsp;)</span><span class="stl_10 stl_11 stl_404" style="word-spacing:-0.2726em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">校</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;验</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;和 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4207em;"><span class="stl_58 stl_59 stl_831" style="word-spacing:0.2616em;">* The</span><span class="stl_58 stl_59 stl_831" style="word-spacing:0.3286em;">&nbsp;current</span><span class="stl_58 stl_59 stl_831" style="word-spacing:0.3766em;">&nbsp;checksum</span><span class="stl_58 stl_59 stl_831" style="word-spacing:0.3096em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:7.9792em;"><span class="stl_10 stl_11 stl_832" style="word-spacing:0.3346em;">uint64_t cksum</span><span class="stl_10 stl_11 stl_832" style="word-spacing:0.3346em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">已</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;经</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;读</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;或</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;者</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;字</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;符</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:8.4207em;"><span class="stl_58 stl_59 stl_417" style="word-spacing:0.2459em;">* number</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.3139em;">&nbsp;of</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.3929em;">&nbsp;bytes read</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.3259em;">&nbsp;or</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.3524em;">&nbsp;written</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.3524em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:8.005em;"><span class="stl_10 stl_11 stl_833" style="word-spacing:0.3572em;">size_t processed_bytes</span><span class="stl_10 stl_11 stl_833" style="word-spacing:0.3572em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.6276em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">每</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;次</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;最</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;多</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;能</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;处</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;理</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;字</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;符</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4207em;"><span class="stl_58 stl_59 stl_775" style="word-spacing:0.2686em;">* maximum</span><span class="stl_58 stl_59 stl_775" style="word-spacing:0.3726em;">&nbsp;s</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.2184em;">&nbsp;i</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.2174em;">&nbsp;n</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.2174em;">&nbsp;g</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.2174em;">&nbsp;l</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.2184em;">&nbsp;e</span><span class="stl_58 stl_59 stl_775" style="word-spacing:0.4816em;">&nbsp;read</span><span class="stl_58 stl_59 stl_775" style="word-spacing:0.428em;">&nbsp;or write chunk</span><span class="stl_58 stl_59 stl_775" style="word-spacing:0.4596em;">&nbsp;s</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.2184em;">&nbsp;i</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.2184em;">&nbsp;z</span><span class="stl_58 stl_59 stl_775" style="word-spacing:-0.2184em;">&nbsp;e</span><span class="stl_58 stl_59 stl_775" style="word-spacing:0.4416em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:8.005em;"><span class="stl_10 stl_11 stl_834" style="word-spacing:0.3823em;">size_t max_processing_chunk</span><span class="stl_10 stl_11 stl_834" style="word-spacing:0.3823em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">可 以</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;内</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;总</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;字</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;符</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;串，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;也</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;以</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;文</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;件</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;描</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;述</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;符 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:8.4207em;"><span class="stl_58 stl_59 stl_66" style="word-spacing:0.3197em;">* Backend</span><span class="stl_107 stl_108 stl_66" style="word-spacing:0.3197em;">−</span><span class="stl_58 stl_59 stl_66" style="word-spacing:0.3197em;">s</span><span class="stl_58 stl_59 stl_66" style="word-spacing:-0.2233em;">&nbsp;p</span><span class="stl_58 stl_59 stl_66" style="word-spacing:-0.2233em;">&nbsp;e</span><span class="stl_58 stl_59 stl_66" style="word-spacing:-0.2223em;">&nbsp;c</span><span class="stl_58 stl_59 stl_66" style="word-spacing:-0.2233em;">&nbsp;i</span><span class="stl_58 stl_59 stl_66" style="word-spacing:-0.2223em;">&nbsp;f</span><span class="stl_58 stl_59 stl_66" style="word-spacing:-0.2233em;">&nbsp;i</span><span class="stl_58 stl_59 stl_66" style="word-spacing:-0.2223em;">&nbsp;c</span><span class="stl_58 stl_59 stl_66" style="word-spacing:0.4967em;">&nbsp;vars</span><span class="stl_58 stl_59 stl_66" style="word-spacing:-0.1313em;">&nbsp;.</span><span class="stl_58 stl_59 stl_66" style="word-spacing:0.4067em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:7.9242em;"><span class="stl_15 stl_16 stl_460" style="word-spacing:0.3684em;">union </span><span class="stl_10 stl_11 stl_460" style="word-spacing:0.3684em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:9.965em;"><span class="stl_15 stl_16 stl_585" style="word-spacing:0.3112em;">struct </span><span class="stl_10 stl_11 stl_585" style="word-spacing:0.3112em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:11.9775em;"><span class="stl_10 stl_11 stl_835" style="word-spacing:0.3505em;">sds ptr</span><span class="stl_10 stl_11 stl_835" style="word-spacing:0.3505em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">偏</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;移</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;量 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:11.9867em;"><span class="stl_10 stl_11 stl_679" style="word-spacing:0.3373em;">off_t pos</span><span class="stl_10 stl_11 stl_679" style="word-spacing:0.3373em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:11.0102em;"><span class="stl_10 stl_11 stl_836" style="word-spacing:-0.2382em;">buffer ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:9.965em;"><span class="stl_15 stl_16 stl_585" style="word-spacing:0.3112em;">struct </span><span class="stl_10 stl_11 stl_585" style="word-spacing:0.3112em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:11.8967em;"><span class="stl_10 stl_11 stl_837" style="word-spacing:0.336em;">FILE *</span><span class="stl_10 stl_11 stl_837" style="word-spacing:-0.167em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_837" style="word-spacing:-0.167em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">偏</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;移</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;量 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:11.9867em;"><span class="stl_10 stl_11 stl_746" style="word-spacing:0.3583em;">off_t buffered</span><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2057em;">&nbsp;;</span><span class="stl_10 stl_11 stl_746" style="word-spacing:0.3155em;">&nbsp;</span><span class="stl_58 stl_59 stl_746" style="word-spacing:0.3155em;">/*</span><span class="stl_58 stl_59 stl_746" style="word-spacing:0.2563em;">&nbsp;Bytes</span><span class="stl_58 stl_59 stl_746" style="word-spacing:0.3528em;">&nbsp;written since</span><span class="stl_58 stl_59 stl_746" style="word-spacing:0.4073em;">&nbsp;l</span><span class="stl_58 stl_59 stl_746" style="word-spacing:-0.3267em;">&nbsp;a</span><span class="stl_58 stl_59 stl_746" style="word-spacing:-0.3257em;">&nbsp;s</span><span class="stl_58 stl_59 stl_746" style="word-spacing:-0.3267em;">&nbsp;t</span><span class="stl_58 stl_59 stl_746" style="word-spacing:0.4033em;">&nbsp;fsync &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:14.5891em;"><span class="stl_58 stl_59 stl_71">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.5843em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 44.5752em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.5676em; left:13.665em;"><span class="stl_58 stl_59 stl_07">.</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07">12.2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">数据结构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">RIO &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">93 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:11.9867em;"><span class="stl_10 stl_11 stl_367" style="word-spacing:0.3465em;">off_t autosync</span><span class="stl_10 stl_11 stl_367" style="word-spacing:-0.2175em;">&nbsp;;</span><span class="stl_10 stl_11 stl_367" style="word-spacing:0.3221em;">&nbsp;</span><span class="stl_58 stl_59 stl_367" style="word-spacing:0.3221em;">/* fsync</span><span class="stl_58 stl_59 stl_367" style="word-spacing:0.4085em;">&nbsp;a</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3215em;">&nbsp;f</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3215em;">&nbsp;t</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3205em;">&nbsp;e</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3215em;">&nbsp;r</span><span class="stl_58 stl_59 stl_367" style="word-spacing:0.4745em;">&nbsp;’</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.2745em;">&nbsp;autosync</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.1765em;">&nbsp;’</span><span class="stl_58 stl_59 stl_367" style="word-spacing:0.3575em;">&nbsp;bytes &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:13.66em;"><span class="stl_58 stl_59 stl_838" style="word-spacing:-0.2199em;">written .</span><span class="stl_58 stl_59 stl_838" style="word-spacing:0.2991em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:11.0683em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.031em;">f i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.032em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.031em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.031em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7076em; left:9.011em;"><span class="stl_10 stl_11 stl_271" style="word-spacing:-0.228em;">io ; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.7043em; left:6.0225em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.7043em; left:6.5539em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:5.9533em;"><span class="stl_15 stl_16 stl_839" style="word-spacing:0.3434em;">typedef struct</span><span class="stl_15 stl_16 stl_839" style="word-spacing:0.3819em;">&nbsp;</span><span class="stl_10 stl_11 stl_839" style="word-spacing:0.3819em;">_rio</span><span class="stl_10 stl_11 stl_839" style="word-spacing:0.4494em;">&nbsp;r</span><span class="stl_10 stl_11 stl_839" style="word-spacing:-0.2476em;">&nbsp;i</span><span class="stl_10 stl_11 stl_839" style="word-spacing:-0.2466em;">&nbsp;o</span><span class="stl_10 stl_11 stl_839" style="word-spacing:-0.2466em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:6.035em;"><span class="stl_10 stl_11 stl_403" style="word-spacing:-0.3474em;">r e</span><span class="stl_10 stl_11 stl_403" style="word-spacing:-0.3474em;">&nbsp;d</span><span class="stl_10 stl_11 stl_403" style="word-spacing:-0.3474em;">&nbsp;i</span><span class="stl_10 stl_11 stl_403" style="word-spacing:-0.3474em;">&nbsp;s</span><span class="stl_10 stl_11 stl_403" style="word-spacing:0.3527em;">&nbsp;</span><span class="stl_17 stl_18 stl_403" style="word-spacing:0.3527em;">定</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3044em;">&nbsp;义</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3034em;">&nbsp;两</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3034em;">&nbsp;个</span><span class="stl_17 stl_18 stl_403" style="word-spacing:0.2865em;">&nbsp;</span><span class="stl_15 stl_16 stl_403" style="word-spacing:0.2865em;">struct</span><span class="stl_15 stl_16 stl_403" style="word-spacing:-0.003em;">&nbsp;</span><span class="stl_10 stl_11 stl_403" style="word-spacing:-0.003em;">r i</span><span class="stl_10 stl_11 stl_403" style="word-spacing:-0.3454em;">&nbsp;o</span><span class="stl_10 stl_11 stl_403" style="word-spacing:-0.2459em;">&nbsp;</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.2459em;">，</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3034em;">&nbsp;分</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3034em;">&nbsp;别</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3034em;">&nbsp;是</span><span class="stl_17 stl_18 stl_403" style="word-spacing:0.3408em;">&nbsp;</span><span class="stl_10 stl_11 stl_403" style="word-spacing:0.3408em;">rioFileIO</span><span class="stl_10 stl_11 stl_403" style="word-spacing:0.3406em;">&nbsp;</span><span class="stl_17 stl_18 stl_403" style="word-spacing:0.3406em;">和</span><span class="stl_17 stl_18 stl_403" style="word-spacing:0.3284em;">&nbsp;</span><span class="stl_10 stl_11 stl_403" style="word-spacing:0.3284em;">rioBufferIO</span><span class="stl_10 stl_11 stl_403" style="word-spacing:-0.2711em;">&nbsp;</span><span class="stl_17 stl_18 stl_403" style="word-spacing:0.3284em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:7.6492em;"><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2335em;">前 者</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2325em;">&nbsp;用</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2325em;">&nbsp;于</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2325em;">&nbsp;内</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2325em;">&nbsp;存</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2325em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.1985em;">&nbsp;存，</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.1995em;">&nbsp;后</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2325em;">&nbsp;者</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2325em;">&nbsp;用</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2325em;">&nbsp;于</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2325em;">&nbsp;文</span><span class="stl_17 stl_18 stl_840" style="word-spacing:-0.2325em;">&nbsp;件</span><span class="stl_17 stl_18 stl_840" style="word-spacing:0.288em;">&nbsp;</span><span class="stl_10 stl_11 stl_840" style="word-spacing:0.288em;">IO</span><span class="stl_17 stl_18 stl_840" style="word-spacing:0.288em;">： &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">适</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;于</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;内</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;存 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:6.0075em;"><span class="stl_15 stl_16 stl_835" style="word-spacing:0.3064em;">static const</span><span class="stl_15 stl_16 stl_835" style="word-spacing:0.3404em;">&nbsp;</span><span class="stl_10 stl_11 stl_835" style="word-spacing:0.3404em;">r</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.3226em;">&nbsp;i</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.3216em;">&nbsp;o</span><span class="stl_10 stl_11 stl_835" style="word-spacing:0.4094em;">&nbsp;rioBufferIO</span><span class="stl_10 stl_11 stl_835" style="word-spacing:0.1634em;">&nbsp;=</span><span class="stl_10 stl_11 stl_835" style="word-spacing:0.1634em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:7.9908em;"><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.0893em;">rioBufferRead , &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:8.0008em;"><span class="stl_10 stl_11 stl_794" style="word-spacing:-0.0883em;">rioBufferWrite , &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:8.02em;"><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.0887em;">rioBufferTell , &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:7.85em;"><span class="stl_10 stl_11 stl_842">NULL, &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:15.9175em;"><span class="stl_58 stl_59 stl_291" style="word-spacing:0.3348em;">/* update_checksum */ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:15.9175em;"><span class="stl_58 stl_59 stl_304" style="word-spacing:0.3557em;">/* current checksum</span><span class="stl_58 stl_59 stl_304" style="word-spacing:0.2987em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:15.9175em;"><span class="stl_58 stl_59 stl_170" style="word-spacing:0.3116em;">/* bytes</span><span class="stl_58 stl_59 stl_170" style="word-spacing:0.3516em;">&nbsp;read</span><span class="stl_58 stl_59 stl_170" style="word-spacing:0.2986em;">&nbsp;or</span><span class="stl_58 stl_59 stl_170" style="word-spacing:0.3251em;">&nbsp;written</span><span class="stl_58 stl_59 stl_170" style="word-spacing:0.3251em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:7.9858em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 22.656em; left:7.9858em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 23.6518em; left:7.9858em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 24.6485em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 21.6593em; left:8.5753em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 22.656em; left:8.5753em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 23.6518em; left:8.5753em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 23.6535em; left:15.9175em;"><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3057em;">/* read/</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2723em;">&nbsp;write</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3757em;">&nbsp;chunk s</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2893em;">&nbsp;i</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2893em;">&nbsp;z</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2893em;">&nbsp;e</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3707em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:8.9355em;"><span class="stl_10 stl_11 stl_843" style="word-spacing:0.2022em;">{ NULL,</span><span class="stl_10 stl_11 stl_843" style="word-spacing:0.4212em;">&nbsp;0</span><span class="stl_10 stl_11 stl_843" style="word-spacing:0.3102em;">&nbsp;} }</span><span class="stl_10 stl_11 stl_843" style="word-spacing:0.3198em;">&nbsp;</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.3198em;">/*</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.3562em;">&nbsp;union</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.4417em;">&nbsp;for io</span><span class="stl_107 stl_108 stl_843" style="word-spacing:0.4417em;">−</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.4417em;">s</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2148em;">&nbsp;p</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2148em;">&nbsp;e</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2138em;">&nbsp;c</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2148em;">&nbsp;i</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2138em;">&nbsp;f</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2148em;">&nbsp;i</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2138em;">&nbsp;c</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.5052em;">&nbsp;vars</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.3892em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:6.0225em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 25.6443em; left:6.5539em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:6.4282em;"><span class="stl_58 stl_59 stl_458">/</span><span class="stl_58 stl_59 stl_458" style="word-spacing:0.4798em;">&nbsp;</span><span class="stl_17 stl_18 stl_458" style="word-spacing:0.4798em;">适</span><span class="stl_17 stl_18 stl_458" style="word-spacing:-0.081em;">&nbsp;用</span><span class="stl_17 stl_18 stl_458" style="word-spacing:-0.08em;">&nbsp;于</span><span class="stl_17 stl_18 stl_458" style="word-spacing:-0.08em;">&nbsp;文</span><span class="stl_17 stl_18 stl_458" style="word-spacing:-0.08em;">&nbsp;件</span><span class="stl_17 stl_18 stl_458" style="word-spacing:0.4361em;">&nbsp;</span><span class="stl_58 stl_59 stl_458" style="word-spacing:0.4361em;">IO &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6285em; left:6.0075em;"><span class="stl_15 stl_16 stl_465" style="word-spacing:0.2988em;">static const</span><span class="stl_15 stl_16 stl_465" style="word-spacing:0.3328em;">&nbsp;</span><span class="stl_10 stl_11 stl_465" style="word-spacing:0.3328em;">r</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.3302em;">&nbsp;i</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.3292em;">&nbsp;o</span><span class="stl_10 stl_11 stl_465" style="word-spacing:0.4138em;">&nbsp;rioFileIO</span><span class="stl_10 stl_11 stl_465" style="word-spacing:0.1678em;">&nbsp;=</span><span class="stl_10 stl_11 stl_465" style="word-spacing:0.1678em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:7.9967em;"><span class="stl_10 stl_11 stl_844" style="word-spacing:-0.089em;">rioFileRead , &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:8.0075em;"><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.0886em;">rioFileWrite , &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:8.0292em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.092em;">r i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.092em;">&nbsp;o</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.092em;">&nbsp;F</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.092em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.092em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.092em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.092em;">&nbsp;T</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.092em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.092em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.091em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.091em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:7.85em;"><span class="stl_10 stl_11 stl_842">NULL, &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:15.9175em;"><span class="stl_58 stl_59 stl_291" style="word-spacing:0.3347em;">/* update_checksum */ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:15.9175em;"><span class="stl_58 stl_59 stl_304" style="word-spacing:0.3557em;">/* current checksum</span><span class="stl_58 stl_59 stl_304" style="word-spacing:0.2987em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:15.9175em;"><span class="stl_58 stl_59 stl_170" style="word-spacing:0.3116em;">/* bytes</span><span class="stl_58 stl_59 stl_170" style="word-spacing:0.3516em;">&nbsp;read</span><span class="stl_58 stl_59 stl_170" style="word-spacing:0.2986em;">&nbsp;or</span><span class="stl_58 stl_59 stl_170" style="word-spacing:0.3251em;">&nbsp;written</span><span class="stl_58 stl_59 stl_170" style="word-spacing:0.3251em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:7.9858em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 34.611em; left:7.9858em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 35.6068em; left:7.9858em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 36.6035em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 33.6143em; left:8.5753em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 34.611em; left:8.5753em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 35.6068em; left:8.5753em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 35.6085em; left:15.9175em;"><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3057em;">/* read/</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2723em;">&nbsp;write</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3757em;">&nbsp;chunk s</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2893em;">&nbsp;i</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2893em;">&nbsp;z</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.2893em;">&nbsp;e</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3707em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:8.9355em;"><span class="stl_10 stl_11 stl_843" style="word-spacing:0.2022em;">{ NULL,</span><span class="stl_10 stl_11 stl_843" style="word-spacing:0.4212em;">&nbsp;0</span><span class="stl_10 stl_11 stl_843" style="word-spacing:0.3102em;">&nbsp;} }</span><span class="stl_10 stl_11 stl_843" style="word-spacing:0.3198em;">&nbsp;</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.3198em;">/*</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.3562em;">&nbsp;union</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.4417em;">&nbsp;for io</span><span class="stl_107 stl_108 stl_843" style="word-spacing:0.4417em;">−</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.4417em;">s</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2148em;">&nbsp;p</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2148em;">&nbsp;e</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2138em;">&nbsp;c</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2148em;">&nbsp;i</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2138em;">&nbsp;f</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2148em;">&nbsp;i</span><span class="stl_58 stl_59 stl_843" style="word-spacing:-0.2138em;">&nbsp;c</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.5052em;">&nbsp;vars</span><span class="stl_58 stl_59 stl_843" style="word-spacing:0.3892em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:6.0225em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.5993em; left:6.5539em;"><span class="stl_10 stl_11 stl_07">;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_23.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_23.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">94 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.185em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 12.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;RDB</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0839em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0839em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4507em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.4507em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">2.3 RDB</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1256em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1256em;">持久化的运作机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.291em; left:7.5658em;z-index:73; "><span class="stl_10 stl_11 stl_845" style="word-spacing:0.1546em;">redis </span><span class="stl_17 stl_18 stl_845" style="word-spacing:0.1546em;">支持两种方式进行 </span><span class="stl_10 stl_11 stl_845" style="word-spacing:0.1546em;">RDB</span><span class="stl_17 stl_18 stl_845" style="word-spacing:0.1546em;">：当前进程执行和后台执行（</span><span class="stl_10 stl_11 stl_845" style="word-spacing:0.1546em;">BGSAVE</span><span class="stl_17 stl_18 stl_845" style="word-spacing:0.1546em;">）。</span><span class="stl_10 stl_11 stl_845" style="word-spacing:0.1546em;">RDB &nbsp;</span></div>
					<div class="stl_01" style="top: 17.2868em; left:5.9058em;"><span class="stl_10 stl_11 stl_846" style="word-spacing:0.0881em;">BGSAVE </span><span class="stl_17 stl_18 stl_846" style="word-spacing:0.0881em;">策略是 </span><span class="stl_10 stl_11 stl_846" style="word-spacing:0.0881em;">fork </span><span class="stl_17 stl_18 stl_846" style="word-spacing:0.0881em;">出一个子进程，把内存中的数据集整个 </span><span class="stl_10 stl_11 stl_846" style="word-spacing:0.0881em;">dump </span><span class="stl_17 stl_18 stl_846" style="word-spacing:0.0881em;">到硬盘上。两个 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5057em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">场景举例： &nbsp;</span></div>
					<div class="stl_01" style="top: 20.216em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 22.9793em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 20.216em; left:7.3351em;"><span class="stl_10 stl_11 stl_226" style="word-spacing:0.2448em;">. redis</span><span class="stl_10 stl_11 stl_226" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_17 stl_18 stl_226" style="word-spacing:0.083em;">服务器初始化过程中，设定了定时事件，每隔一段时间就会触发持久化操 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.2126em; left:7.9808em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">作；进入定时事件处理程序中，就会 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">fork </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">产生子进程执行持久化操作。 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9793em; left:7.3351em;"><span class="stl_10 stl_11 stl_847" style="word-spacing:0.2701em;">. redis</span><span class="stl_10 stl_11 stl_847" style="word-spacing:0.0762em;">&nbsp;</span><span class="stl_17 stl_18 stl_847" style="word-spacing:0.0762em;">服务器预设了</span><span class="stl_17 stl_18 stl_847" style="word-spacing:0.0757em;">&nbsp;</span><span class="stl_10 stl_11 stl_847" style="word-spacing:0.0757em;">save</span><span class="stl_10 stl_11 stl_847" style="word-spacing:0.0752em;">&nbsp;</span><span class="stl_17 stl_18 stl_847" style="word-spacing:0.0752em;">指令，客户端可要求服务器进程中断服务，执行持久化 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.1982em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">操作。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.9093em; left:7.5658em;"><span class="stl_17 stl_18 stl_437" style="word-spacing:0.0786em;">这里主要展开的内容是 </span><span class="stl_10 stl_11 stl_437" style="word-spacing:0.0786em;">RDB </span><span class="stl_17 stl_18 stl_437" style="word-spacing:0.0786em;">持久化操作的写文件过程，读过程和写过程相 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.9051em; left:5.9058em;"><span class="stl_17 stl_18 stl_212" style="word-spacing:0.1201em;">反。子进程的产生发生在 </span><span class="stl_10 stl_11 stl_212" style="word-spacing:0.1201em;">rdbSaveBackground() </span><span class="stl_17 stl_18 stl_212" style="word-spacing:0.1201em;">中，真正的 </span><span class="stl_10 stl_11 stl_212" style="word-spacing:0.1201em;">RDB </span><span class="stl_17 stl_18 stl_212" style="word-spacing:0.1201em;">持久化操作是在 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.9018em; left:5.9058em;"><span class="stl_10 stl_11 stl_846" style="word-spacing:0.0894em;">rdbSave()</span><span class="stl_17 stl_18 stl_846" style="word-spacing:0.0894em;">，想要直接进行 </span><span class="stl_10 stl_11 stl_846" style="word-spacing:0.0894em;">RDB </span><span class="stl_17 stl_18 stl_846" style="word-spacing:0.0894em;">持久化，调用 </span><span class="stl_10 stl_11 stl_846" style="word-spacing:0.0894em;">rdbSave() </span><span class="stl_17 stl_18 stl_846" style="word-spacing:0.0894em;">即可。 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.9243em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">以下主要以代码的方式来展开 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">RDB </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">的运作机制： &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4701em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.466em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.4701em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">备</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;份</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;程</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;序 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.466em; left:6.4282em;"><span class="stl_58 stl_59 stl_848" style="word-spacing:0.4427em;">* Save</span><span class="stl_58 stl_59 stl_848" style="word-spacing:0.5077em;">&nbsp;the</span><span class="stl_58 stl_59 stl_848" style="word-spacing:0.3407em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_848" style="word-spacing:0.2577em;">&nbsp;on</span><span class="stl_58 stl_59 stl_848" style="word-spacing:0.4877em;">&nbsp;disk</span><span class="stl_58 stl_59 stl_848" style="word-spacing:-0.0073em;">&nbsp;.</span><span class="stl_58 stl_59 stl_848" style="word-spacing:0.5287em;">&nbsp;Return</span><span class="stl_58 stl_59 stl_848" style="word-spacing:0.3237em;">&nbsp;REDIS_ERR</span><span class="stl_58 stl_59 stl_848" style="word-spacing:0.2857em;">&nbsp;on</span><span class="stl_58 stl_59 stl_848" style="word-spacing:0.4537em;">&nbsp;error</span><span class="stl_58 stl_59 stl_848" style="word-spacing:0.0677em;">&nbsp;,</span><span class="stl_58 stl_59 stl_848" style="word-spacing:0.3837em;">&nbsp;REDIS_OK &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:7.6008em;"><span class="stl_58 stl_59 stl_145" style="word-spacing:0.3098em;">on success */ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4527em; left:5.9875em;"><span class="stl_15 stl_16 stl_699">int</span><span class="stl_15 stl_16 stl_699" style="word-spacing:0.335em;">&nbsp;</span><span class="stl_10 stl_11 stl_699" style="word-spacing:0.335em;">rdbSave</span><span class="stl_10 stl_11 stl_699" style="word-spacing:0.335em;">&nbsp;(</span><span class="stl_15 stl_16 stl_699" style="word-spacing:-0.2589em;">char</span><span class="stl_15 stl_16 stl_699" style="word-spacing:-0.0236em;">&nbsp;</span><span class="stl_10 stl_11 stl_699" style="word-spacing:-0.0236em;">* filename</span><span class="stl_10 stl_11 stl_699" style="word-spacing:-0.2139em;">&nbsp;)</span><span class="stl_10 stl_11 stl_699" style="word-spacing:-0.2139em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4535em; left:8.0367em;"><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0852em;">d i</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0852em;">&nbsp;c</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;t</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;I</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0852em;">&nbsp;t</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;e</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;r</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0852em;">&nbsp;a</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;t</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0852em;">&nbsp;o</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;r</span><span class="stl_10 stl_11 stl_849" style="word-spacing:0.5658em;">&nbsp;*</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0792em;">&nbsp;di</span><span class="stl_10 stl_11 stl_849" style="word-spacing:0.3818em;">&nbsp;=</span><span class="stl_10 stl_11 stl_849" style="word-spacing:0.1898em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4501em; left:7.9967em;"><span class="stl_10 stl_11 stl_606" style="word-spacing:0.2926em;">dictEntry *de</span><span class="stl_10 stl_11 stl_606" style="word-spacing:0.2926em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.441em; left:7.9342em;"><span class="stl_15 stl_16 stl_850">char</span><span class="stl_15 stl_16 stl_850" style="word-spacing:0.3176em;">&nbsp;</span><span class="stl_10 stl_11 stl_850" style="word-spacing:0.3176em;">tmpfile</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.1449em;">&nbsp;[</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.2839em;">&nbsp;2</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.2839em;">&nbsp;5</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.2839em;">&nbsp;6</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.2839em;">&nbsp;]</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.2839em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4377em; left:7.9342em;"><span class="stl_15 stl_16 stl_851">char</span><span class="stl_15 stl_16 stl_851" style="word-spacing:0.3452em;">&nbsp;</span><span class="stl_10 stl_11 stl_851" style="word-spacing:0.3452em;">magic</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.104em;">&nbsp;[</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.178em;">&nbsp;1</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.177em;">&nbsp;0</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.178em;">&nbsp;]</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.178em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4335em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.3991em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">j</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4302em; left:7.9467em;"><span class="stl_15 stl_16 stl_852" style="word-spacing:0.3506em;">long long</span><span class="stl_15 stl_16 stl_852" style="word-spacing:0.2986em;">&nbsp;</span><span class="stl_10 stl_11 stl_852" style="word-spacing:0.2986em;">now</span><span class="stl_10 stl_11 stl_852" style="word-spacing:0.1516em;">&nbsp;=</span><span class="stl_10 stl_11 stl_852" style="word-spacing:0.2066em;">&nbsp;mstime</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.1634em;">&nbsp;()</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.1634em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.431em; left:7.9117em;"><span class="stl_10 stl_11 stl_853" style="word-spacing:0.3365em;">FILE *</span><span class="stl_10 stl_11 stl_853" style="word-spacing:-0.1665em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_853" style="word-spacing:-0.1665em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4276em; left:8.0292em;"><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.241em;">r i</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.241em;">&nbsp;o</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.434em;">&nbsp;rdb</span><span class="stl_10 stl_11 stl_105" style="word-spacing:0.434em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:7.9792em;"><span class="stl_10 stl_11 stl_832" style="word-spacing:0.3346em;">uint64_t cksum</span><span class="stl_10 stl_11 stl_832" style="word-spacing:0.3346em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">打 开</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;文</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;件，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;准</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;备</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;写 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4077em; left:8.025em;z-index:627; "><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2648em;">s n</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2648em;">&nbsp;p</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2638em;">&nbsp;r</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2648em;">&nbsp;i</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2638em;">&nbsp;n</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2638em;">&nbsp;t</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2648em;">&nbsp;f</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.1588em;">&nbsp;(</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.1868em;">&nbsp;tmpfile</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.0338em;">&nbsp;,256</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.1468em;">&nbsp;,</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2178em;">&nbsp;”temp</span><span class="stl_107 stl_108 stl_854" style="word-spacing:-0.2178em;">−</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2178em;">%d</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2348em;">&nbsp;.</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.1818em;">&nbsp;rdb”</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.1378em;">&nbsp;,</span><span class="stl_10 stl_11 stl_854" style="word-spacing:0.3962em;">&nbsp;(</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2129em;">&nbsp;</span><span class="stl_15 stl_16 stl_854" style="word-spacing:-0.2129em;">int</span><span class="stl_15 stl_16 stl_854" style="word-spacing:-0.2121em;">&nbsp;</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.2121em;">)</span><span class="stl_10 stl_11 stl_854" style="word-spacing:0.4142em;">&nbsp;getpid</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.1508em;">&nbsp;()</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.1708em;">&nbsp;)</span><span class="stl_10 stl_11 stl_854" style="word-spacing:-0.1708em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.9917em;"><span class="stl_10 stl_11 stl_855" style="word-spacing:0.1725em;">fp = fopen</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.236em;">&nbsp;(</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.218em;">&nbsp;tmpfile</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.039em;">&nbsp;,</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.223em;">&nbsp;”w”</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.279em;">&nbsp;)</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.279em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">12.3. RDB</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0839em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0839em;">持久化的运作机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">95 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:8.045em;"><span class="stl_15 stl_16 stl_123" style="word-spacing:-0.3em;">i f</span><span class="stl_15 stl_16 stl_123" style="word-spacing:0.4787em;">&nbsp;</span><span class="stl_10 stl_11 stl_123" style="word-spacing:0.4787em;">(</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.299em;">&nbsp;!</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.186em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.258em;">&nbsp;)</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.258em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.9933em;"><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1093em;">redisLog (REDIS_WARNING,</span><span class="stl_10 stl_11 stl_856" style="word-spacing:0.4857em;">&nbsp;”</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1473em;">&nbsp;Failed</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1613em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1873em;">&nbsp;opening</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1873em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1273em;">&nbsp;.</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1033em;">&nbsp;rdb␣</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1373em;">&nbsp;fo</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1873em;">&nbsp;r</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1873em;">&nbsp;␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:11.6508em;"><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.1655em;">saving : ␣%s ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:12.0217em;"><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2909em;">s t r e r r o r ( errno ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:9.9383em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4207em;"><span class="stl_58 stl_59 stl_841">/</span><span class="stl_58 stl_59 stl_841" style="word-spacing:0.2855em;">&nbsp;</span><span class="stl_17 stl_18 stl_841" style="word-spacing:0.2855em;">初</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2753em;">&nbsp;始</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;化</span><span class="stl_17 stl_18 stl_841" style="word-spacing:0.3282em;">&nbsp;</span><span class="stl_58 stl_59 stl_841" style="word-spacing:0.3282em;">rdb</span><span class="stl_58 stl_59 stl_841" style="word-spacing:0.3275em;">&nbsp;</span><span class="stl_17 stl_18 stl_841" style="word-spacing:0.3275em;">结</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;构</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2413em;">&nbsp;体。</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2386em;">&nbsp;</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.2386em;">rdb</span><span class="stl_58 stl_59 stl_841" style="word-spacing:0.3275em;">&nbsp;</span><span class="stl_17 stl_18 stl_841" style="word-spacing:0.3275em;">结</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;构</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;体</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;内</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;指</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;定</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;了</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;读</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;写</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;文</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;件</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;的</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2743em;">&nbsp;函</span><span class="stl_17 stl_18 stl_841" style="word-spacing:-0.2413em;">&nbsp;数， &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:9.6417em;"><span class="stl_17 stl_18 stl_858" style="word-spacing:-0.3404em;">已 写</span><span class="stl_58 stl_59 stl_858" style="word-spacing:-0.3404em;">/</span><span class="stl_17 stl_18 stl_858" style="word-spacing:-0.3404em;">读 字 符 统 计 等 数 据 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.02em;"><span class="stl_10 stl_11 stl_794" style="word-spacing:-0.2592em;">rioInitWithFile (&amp;rdb , fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:8.045em;"><span class="stl_15 stl_16 stl_859" style="word-spacing:-0.2398em;">i f</span><span class="stl_15 stl_16 stl_859" style="word-spacing:0.4666em;">&nbsp;</span><span class="stl_10 stl_11 stl_859" style="word-spacing:0.4666em;">(</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.1668em;">&nbsp;server</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.1108em;">&nbsp;.</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.1968em;">&nbsp;rdb_checksum</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.2528em;">&nbsp;)</span><span class="stl_10 stl_11 stl_859" style="word-spacing:0.3489em;">&nbsp;</span><span class="stl_58 stl_59 stl_859" style="word-spacing:0.3489em;">//</span><span class="stl_58 stl_59 stl_859" style="word-spacing:0.344em;">&nbsp;</span><span class="stl_17 stl_18 stl_859" style="word-spacing:0.344em;">校</span><span class="stl_17 stl_18 stl_859" style="word-spacing:-0.2168em;">&nbsp;验</span><span class="stl_17 stl_18 stl_859" style="word-spacing:-0.2168em;">&nbsp;和 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:9.9517em;"><span class="stl_10 stl_11 stl_438" style="word-spacing:-0.1691em;">rdb .</span><span class="stl_10 stl_11 stl_438" style="word-spacing:-0.1901em;">&nbsp;update_cksum</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.1599em;">&nbsp;=</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.1959em;">&nbsp;rioGenericUpdateChecksum</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.1959em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">先</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;版</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;本</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;号 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:8.025em;"><span class="stl_10 stl_11 stl_860" style="word-spacing:-0.1537em;">s n p r i n t f ( magic , </span><span class="stl_15 stl_16 stl_860" style="word-spacing:-0.1537em;">sizeof </span><span class="stl_10 stl_11 stl_860" style="word-spacing:-0.1537em;">( magic ) , ”REDIS%04d” , &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:9.5025em;"><span class="stl_10 stl_11 stl_861" style="word-spacing:0.1389em;">REDIS_RDB_VERSION) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:8.045em;"><span class="stl_15 stl_16 stl_862" style="word-spacing:-0.1714em;">i f</span><span class="stl_15 stl_16 stl_862" style="word-spacing:0.535em;">&nbsp;</span><span class="stl_10 stl_11 stl_862" style="word-spacing:0.535em;">(</span><span class="stl_10 stl_11 stl_862" style="word-spacing:-0.1914em;">&nbsp;rdbWriteRaw(&amp;rdb</span><span class="stl_10 stl_11 stl_862" style="word-spacing:-0.0684em;">&nbsp;,</span><span class="stl_10 stl_11 stl_862" style="word-spacing:-0.1224em;">&nbsp;magic</span><span class="stl_10 stl_11 stl_862" style="word-spacing:-0.0624em;">&nbsp;,</span><span class="stl_10 stl_11 stl_862" style="word-spacing:-0.1884em;">&nbsp;9</span><span class="stl_10 stl_11 stl_862" style="word-spacing:-0.1894em;">&nbsp;)</span><span class="stl_10 stl_11 stl_862" style="word-spacing:0.2926em;">&nbsp;==</span><span class="stl_10 stl_11 stl_862" style="word-spacing:0.186em;">&nbsp;</span><span class="stl_107 stl_108 stl_862" style="word-spacing:0.2926em;">−</span><span class="stl_10 stl_11 stl_862" style="word-spacing:0.186em;">1)</span><span class="stl_10 stl_11 stl_862" style="word-spacing:0.3244em;">&nbsp;</span><span class="stl_15 stl_16 stl_862" style="word-spacing:0.3244em;">goto</span><span class="stl_15 stl_16 stl_862" style="word-spacing:0.3878em;">&nbsp;</span><span class="stl_10 stl_11 stl_862" style="word-spacing:0.3878em;">werr</span><span class="stl_10 stl_11 stl_862" style="word-spacing:0.3878em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:7.9808em;"><span class="stl_15 stl_16 stl_379">for</span><span class="stl_15 stl_16 stl_379" style="word-spacing:0.4146em;">&nbsp;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.4146em;">(</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.1393em;">&nbsp;j</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.2637em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.4967em;">&nbsp;j</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.2367em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.2937em;">&nbsp;server</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.0863em;">&nbsp;.</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.2403em;">&nbsp;dbnum</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.2403em;">&nbsp;;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.5167em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.5167em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:10.4132em;"><span class="stl_58 stl_59 stl_863" style="word-spacing:0.2706em;">/ server</span><span class="stl_58 stl_59 stl_863" style="word-spacing:-0.0145em;">&nbsp;</span><span class="stl_17 stl_18 stl_863" style="word-spacing:-0.0145em;">中 保</span><span class="stl_17 stl_18 stl_863" style="word-spacing:-0.3264em;">&nbsp;存</span><span class="stl_17 stl_18 stl_863" style="word-spacing:-0.3264em;">&nbsp;的</span><span class="stl_17 stl_18 stl_863" style="word-spacing:-0.3264em;">&nbsp;数</span><span class="stl_17 stl_18 stl_863" style="word-spacing:-0.3264em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.975em;"><span class="stl_10 stl_11 stl_760" style="word-spacing:0.3186em;">redisDb *db</span><span class="stl_10 stl_11 stl_760" style="word-spacing:0.1066em;">&nbsp;=</span><span class="stl_10 stl_11 stl_760" style="word-spacing:0.2216em;">&nbsp;server</span><span class="stl_10 stl_11 stl_760" style="word-spacing:-0.1284em;">&nbsp;.</span><span class="stl_10 stl_11 stl_760" style="word-spacing:-0.2434em;">&nbsp;db+j</span><span class="stl_10 stl_11 stl_760" style="word-spacing:-0.2434em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">字</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;典 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:10.0125em;z-index:445; "><span class="stl_10 stl_11 stl_864" style="word-spacing:0.4001em;">dict *d</span><span class="stl_10 stl_11 stl_864" style="word-spacing:0.1361em;">&nbsp;= db</span><span class="stl_107 stl_108 stl_864" style="word-spacing:0.1361em;">−</span><span class="stl_10 stl_11 stl_864" style="word-spacing:0.1361em;">&gt;dict</span><span class="stl_10 stl_11 stl_864" style="word-spacing:0.1361em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:10.0375em;"><span class="stl_15 stl_16 stl_395" style="word-spacing:-0.1891em;">i f</span><span class="stl_15 stl_16 stl_395" style="word-spacing:0.5173em;">&nbsp;</span><span class="stl_10 stl_11 stl_395" style="word-spacing:0.5173em;">(</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.1031em;">&nbsp;d</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2081em;">&nbsp;i</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2091em;">&nbsp;c</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2081em;">&nbsp;t</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2081em;">&nbsp;S</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2081em;">&nbsp;i</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2081em;">&nbsp;z</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2091em;">&nbsp;e</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.1021em;">&nbsp;(d)</span><span class="stl_10 stl_11 stl_395" style="word-spacing:0.2204em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_395" style="word-spacing:0.3939em;">&nbsp;</span><span class="stl_15 stl_16 stl_395" style="word-spacing:0.3939em;">continue</span><span class="stl_15 stl_16 stl_395" style="word-spacing:-0.1479em;">&nbsp;</span><span class="stl_10 stl_11 stl_395" style="word-spacing:0.3939em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">字</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;典</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;迭</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;代</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;器 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:9.9917em;"><span class="stl_10 stl_11 stl_865" style="word-spacing:0.0949em;">di =</span><span class="stl_10 stl_11 stl_865" style="word-spacing:-0.1662em;">&nbsp;dictGetSafeIterator (d)</span><span class="stl_10 stl_11 stl_865" style="word-spacing:-0.1662em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:10.0375em;"><span class="stl_15 stl_16 stl_625" style="word-spacing:-0.318em;">i f</span><span class="stl_15 stl_16 stl_625" style="word-spacing:0.4607em;">&nbsp;</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.4607em;">(</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.317em;">&nbsp;!</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.194em;">&nbsp;di</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.267em;">&nbsp;)</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.267em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:12.0292em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2687em;">f c l o s e ( fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:11.9308em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5901em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:10.4132em;"><span class="stl_58 stl_59 stl_866">/</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.7028em;">&nbsp;</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.7028em;">写</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.142em;">&nbsp;入</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5464em;">&nbsp;</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.5464em;">RDB</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.5456em;">&nbsp;</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5456em;">操</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.1425em;">&nbsp;作</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.1425em;">&nbsp;码 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:10.4132em;"><span class="stl_58 stl_59 stl_867" style="word-spacing:0.4081em;">* Write</span><span class="stl_58 stl_59 stl_867" style="word-spacing:0.4731em;">&nbsp;the</span><span class="stl_58 stl_59 stl_867" style="word-spacing:0.3391em;">&nbsp;SELECT</span><span class="stl_58 stl_59 stl_867" style="word-spacing:0.1281em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_867" style="word-spacing:0.2731em;">&nbsp;opcode</span><span class="stl_58 stl_59 stl_867" style="word-spacing:0.4201em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5793em; left:10.0375em;"><span class="stl_15 stl_16 stl_868" style="word-spacing:-0.0117em;">i f</span><span class="stl_15 stl_16 stl_868" style="word-spacing:0.6947em;">&nbsp;</span><span class="stl_10 stl_11 stl_868" style="word-spacing:0.6947em;">(</span><span class="stl_10 stl_11 stl_868" style="word-spacing:-0.0147em;">&nbsp;rdbSaveType(&amp;rdb</span><span class="stl_10 stl_11 stl_868" style="word-spacing:0.0913em;">&nbsp;,REDIS_RDB_OPCODE_SELECTDB)</span><span class="stl_10 stl_11 stl_868" style="word-spacing:0.3993em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 42.8732em; left:11.595em;"><span class="stl_107 stl_108 stl_07">−</span></div>
					<div class="stl_01" style="top: 42.576em; left:12.2633em;"><span class="stl_10 stl_11 stl_500">1)</span><span class="stl_10 stl_11 stl_500" style="word-spacing:0.2997em;">&nbsp;</span><span class="stl_15 stl_16 stl_500" style="word-spacing:0.2997em;">goto</span><span class="stl_15 stl_16 stl_500" style="word-spacing:0.3631em;">&nbsp;</span><span class="stl_10 stl_11 stl_500" style="word-spacing:0.3631em;">werr</span><span class="stl_10 stl_11 stl_500" style="word-spacing:0.3631em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;库</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;序</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;号 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5652em; left:10.0375em;"><span class="stl_15 stl_16 stl_199" style="word-spacing:-0.1886em;">i f</span><span class="stl_15 stl_16 stl_199" style="word-spacing:0.5178em;">&nbsp;</span><span class="stl_10 stl_11 stl_199" style="word-spacing:0.5178em;">(</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.1826em;">&nbsp;rdbSaveLen(&amp;rdb</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.0856em;">&nbsp;,</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.0566em;">&nbsp;j</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.1116em;">&nbsp;)</span><span class="stl_10 stl_11 stl_199" style="word-spacing:0.2224em;">&nbsp;==</span><span class="stl_10 stl_11 stl_199" style="word-spacing:0.1693em;">&nbsp;</span><span class="stl_107 stl_108 stl_199" style="word-spacing:0.2224em;">−</span><span class="stl_10 stl_11 stl_199" style="word-spacing:0.1693em;">1)</span><span class="stl_10 stl_11 stl_199" style="word-spacing:0.3083em;">&nbsp;</span><span class="stl_15 stl_16 stl_199" style="word-spacing:0.3083em;">goto</span><span class="stl_15 stl_16 stl_199" style="word-spacing:0.3717em;">&nbsp;</span><span class="stl_10 stl_11 stl_199" style="word-spacing:0.3717em;">werr</span><span class="stl_10 stl_11 stl_199" style="word-spacing:0.3717em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">96 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.185em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 12.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;RDB</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0839em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0839em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;库</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;每</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;项 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:10.4132em;"><span class="stl_58 stl_59 stl_230" style="word-spacing:0.346em;">* I</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.313em;">&nbsp;t</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.313em;">&nbsp;e</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.312em;">&nbsp;r</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.313em;">&nbsp;a</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.313em;">&nbsp;t</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.313em;">&nbsp;e</span><span class="stl_58 stl_59 stl_230" style="word-spacing:0.455em;">&nbsp;t</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.306em;">&nbsp;h</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.307em;">&nbsp;i</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.307em;">&nbsp;s</span><span class="stl_58 stl_59 stl_230" style="word-spacing:0.207em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_230" style="word-spacing:0.181em;">&nbsp;writing</span><span class="stl_58 stl_59 stl_230" style="word-spacing:0.3765em;">&nbsp;every entry</span><span class="stl_58 stl_59 stl_230" style="word-spacing:0.308em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:9.9408em;"><span class="stl_15 stl_16 stl_756">while</span><span class="stl_15 stl_16 stl_756" style="word-spacing:-0.1781em;">&nbsp;</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1781em;">((</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1735em;">&nbsp;de</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.1975em;">&nbsp;=</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.2435em;">&nbsp;dictNext</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1615em;">&nbsp;(</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1525em;">&nbsp;di</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1535em;">&nbsp;)</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1695em;">&nbsp;)</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.3735em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.1975em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.1975em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:11.9775em;"><span class="stl_10 stl_11 stl_267" style="word-spacing:0.3908em;">sds keystr</span><span class="stl_10 stl_11 stl_267" style="word-spacing:0.1878em;">&nbsp;=</span><span class="stl_10 stl_11 stl_267" style="word-spacing:-0.1174em;">&nbsp;dictGetKey (</span><span class="stl_10 stl_11 stl_267" style="word-spacing:-0.2832em;">&nbsp;de</span><span class="stl_10 stl_11 stl_267" style="word-spacing:-0.2822em;">&nbsp;)</span><span class="stl_10 stl_11 stl_267" style="word-spacing:-0.2822em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:11.9908em;"><span class="stl_10 stl_11 stl_869" style="word-spacing:0.3362em;">robj key</span><span class="stl_10 stl_11 stl_869" style="word-spacing:0.3362em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:13.9175em;"><span class="stl_10 stl_11 stl_07">*</span></div>
					<div class="stl_01" style="top: 10.7001em; left:14.4148em;"><span class="stl_10 stl_11 stl_481" style="word-spacing:0.1034em;">o =</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.0822em;">&nbsp;dictGetVal (</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2856em;">&nbsp;de</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2856em;">&nbsp;)</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2856em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:11.9317em;"><span class="stl_15 stl_16 stl_806" style="word-spacing:0.279em;">long long</span><span class="stl_15 stl_16 stl_806" style="word-spacing:0.3575em;">&nbsp;</span><span class="stl_10 stl_11 stl_806" style="word-spacing:0.3575em;">expire</span><span class="stl_10 stl_11 stl_806" style="word-spacing:0.3575em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:12.4057em;"><span class="stl_58 stl_59 stl_870">/</span><span class="stl_58 stl_59 stl_870" style="word-spacing:0.2211em;">&nbsp;</span><span class="stl_17 stl_18 stl_870" style="word-spacing:0.2211em;">将</span><span class="stl_17 stl_18 stl_870" style="word-spacing:0.3081em;">&nbsp;</span><span class="stl_58 stl_59 stl_870" style="word-spacing:0.3081em;">keystr</span><span class="stl_58 stl_59 stl_870" style="word-spacing:-0.0301em;">&nbsp;</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.0301em;">封 装</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.3388em;">&nbsp;在</span><span class="stl_17 stl_18 stl_870" style="word-spacing:0.3019em;">&nbsp;</span><span class="stl_58 stl_59 stl_870" style="word-spacing:0.3019em;">robj</span><span class="stl_58 stl_59 stl_870" style="word-spacing:0.3022em;">&nbsp;</span><span class="stl_17 stl_18 stl_870" style="word-spacing:0.3019em;">里 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:12.0117em;"><span class="stl_10 stl_11 stl_145" style="word-spacing:-0.2973em;">i n i t S t a t i c S t r i n g O b j e c t ( key , keystr ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">获</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;过</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;期</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:11.9967em;"><span class="stl_10 stl_11 stl_871" style="word-spacing:0.1783em;">expire =</span><span class="stl_10 stl_11 stl_871" style="word-spacing:-0.0854em;">&nbsp;getExpire (db,&amp;key</span><span class="stl_10 stl_11 stl_871" style="word-spacing:-0.2897em;">&nbsp;)</span><span class="stl_10 stl_11 stl_871" style="word-spacing:-0.2897em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">开</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;始</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;盘 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:12.03em;"><span class="stl_15 stl_16 stl_289" style="word-spacing:-0.2374em;">i f</span><span class="stl_15 stl_16 stl_289" style="word-spacing:0.469em;">&nbsp;</span><span class="stl_10 stl_11 stl_289" style="word-spacing:0.469em;">(</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2214em;">&nbsp;rdbSaveKeyValuePair(&amp;rdb</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2474em;">&nbsp;,&amp;key</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.1324em;">&nbsp;,</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2184em;">&nbsp;o</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.1864em;">&nbsp;,</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.1324em;">&nbsp;expire</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.0134em;">&nbsp;,</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2464em;">&nbsp;now) &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:13.993em;"><span class="stl_10 stl_11 stl_515">=</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.1696em;">&nbsp;</span><span class="stl_107 stl_108 stl_515">−</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.1696em;">1)</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.3081em;">&nbsp;</span><span class="stl_15 stl_16 stl_515" style="word-spacing:0.3081em;">goto</span><span class="stl_15 stl_16 stl_515" style="word-spacing:0.3715em;">&nbsp;</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.3715em;">werr</span><span class="stl_10 stl_11 stl_515" style="word-spacing:0.3715em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:13.445em;"><span class="stl_10 stl_11 stl_07">=</span></div>
					<div class="stl_01" style="top: 22.656em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6518em; left:10.02em;"><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.3214em;">d i c t R e l e a s e I t e r a t o r ( di ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9992em;"><span class="stl_10 stl_11 stl_468" style="word-spacing:0.2331em;">di =</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.0411em;">&nbsp;NULL;</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.4203em;">&nbsp;</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.4203em;">/*</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.3021em;">&nbsp;So</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.3766em;">&nbsp;that we</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.2791em;">&nbsp;don</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.1499em;">&nbsp;’</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.1679em;">&nbsp;t</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.4861em;">&nbsp;r</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.2469em;">&nbsp;e</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.2469em;">&nbsp;l</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.2469em;">&nbsp;e</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.2479em;">&nbsp;a</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.2469em;">&nbsp;s</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.2469em;">&nbsp;e</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.5401em;">&nbsp;i</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.2129em;">&nbsp;t</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.4951em;">&nbsp;again</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.3606em;">&nbsp;on error</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.3606em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:10.1058em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 26.6426em; left:10.5791em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_866" style="word-spacing:0.505em;">/ RDB</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.5457em;">&nbsp;</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5457em;">结</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.1425em;">&nbsp;束</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.1425em;">&nbsp;码 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_440" style="word-spacing:0.2425em;">* EOF</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.2745em;">&nbsp;opcode</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.4085em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:8.045em;"><span class="stl_15 stl_16 stl_872" style="word-spacing:-0.0373em;">i f</span><span class="stl_15 stl_16 stl_872" style="word-spacing:0.6691em;">&nbsp;</span><span class="stl_10 stl_11 stl_872" style="word-spacing:0.6691em;">(</span><span class="stl_10 stl_11 stl_872" style="word-spacing:-0.0403em;">&nbsp;rdbSaveType(&amp;rdb</span><span class="stl_10 stl_11 stl_872" style="word-spacing:0.0657em;">&nbsp;,REDIS_RDB_OPCODE_EOF)</span><span class="stl_10 stl_11 stl_872" style="word-spacing:0.3737em;">&nbsp;==</span><span class="stl_10 stl_11 stl_872" style="word-spacing:0.32em;">&nbsp;</span><span class="stl_107 stl_108 stl_872" style="word-spacing:0.3737em;">−</span><span class="stl_10 stl_11 stl_872" style="word-spacing:0.32em;">1)</span><span class="stl_10 stl_11 stl_872" style="word-spacing:0.4586em;">&nbsp;</span><span class="stl_15 stl_16 stl_872" style="word-spacing:0.4586em;">goto &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:9.6333em;"><span class="stl_10 stl_11 stl_672" style="word-spacing:-0.1783em;">werr ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">校</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;验</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;和 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:8.4207em;"><span class="stl_58 stl_59 stl_402" style="word-spacing:0.2588em;">* CRC64 checksum</span><span class="stl_58 stl_59 stl_402" style="word-spacing:-0.1542em;">&nbsp;.</span><span class="stl_58 stl_59 stl_402" style="word-spacing:0.5298em;">&nbsp;I</span><span class="stl_58 stl_59 stl_402" style="word-spacing:-0.2172em;">&nbsp;t</span><span class="stl_58 stl_59 stl_402" style="word-spacing:0.5678em;">&nbsp;w</span><span class="stl_58 stl_59 stl_402" style="word-spacing:-0.1942em;">&nbsp;i</span><span class="stl_58 stl_59 stl_402" style="word-spacing:-0.1942em;">&nbsp;l</span><span class="stl_58 stl_59 stl_402" style="word-spacing:-0.1932em;">&nbsp;l</span><span class="stl_58 stl_59 stl_402" style="word-spacing:0.4988em;">&nbsp;be</span><span class="stl_58 stl_59 stl_402" style="word-spacing:0.4358em;">&nbsp;zero</span><span class="stl_58 stl_59 stl_402" style="word-spacing:0.5378em;">&nbsp;i</span><span class="stl_58 stl_59 stl_402" style="word-spacing:-0.1822em;">&nbsp;f</span><span class="stl_58 stl_59 stl_402" style="word-spacing:0.4938em;">&nbsp;checksum &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:9.6425em;"><span class="stl_58 stl_59 stl_83" style="word-spacing:0.3787em;">computation i</span><span class="stl_58 stl_59 stl_83" style="word-spacing:-0.3223em;">&nbsp;s</span><span class="stl_58 stl_59 stl_83" style="word-spacing:0.4157em;">&nbsp;disabled</span><span class="stl_58 stl_59 stl_83" style="word-spacing:-0.0613em;">&nbsp;,</span><span class="stl_58 stl_59 stl_83" style="word-spacing:0.3877em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 36.6051em; left:9.5044em;"><span class="stl_58 stl_59 stl_703" style="word-spacing:0.3535em;">loading code s</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.331em;">&nbsp;k</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.33em;">&nbsp;i</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.33em;">&nbsp;ps</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.394em;">&nbsp;the</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.344em;">&nbsp;check in</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.397em;">&nbsp;t</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.313em;">&nbsp;h</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.312em;">&nbsp;i</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.313em;">&nbsp;s</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.399em;">&nbsp;case</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.222em;">&nbsp;.</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.324em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:7.9317em;"><span class="stl_10 stl_11 stl_873" style="word-spacing:0.2072em;">cksum =</span><span class="stl_10 stl_11 stl_873" style="word-spacing:0.2402em;">&nbsp;rdb</span><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.1098em;">&nbsp;.</span><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.1428em;">&nbsp;cksum</span><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.1428em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:7.9708em;"><span class="stl_10 stl_11 stl_874" style="word-spacing:-0.1354em;">memrev64ifbe(&amp;cksum) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.9992em;"><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.2058em;">rioWrite(&amp;rdb ,&amp;cksum , 8 ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;步</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;盘 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:8.4207em;"><span class="stl_58 stl_59 stl_875" style="word-spacing:0.2528em;">* Make</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.3078em;">&nbsp;sure</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.4008em;">&nbsp;data</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.4698em;">&nbsp;w</span><span class="stl_58 stl_59 stl_875" style="word-spacing:-0.2362em;">&nbsp;i</span><span class="stl_58 stl_59 stl_875" style="word-spacing:-0.2372em;">&nbsp;l</span><span class="stl_58 stl_59 stl_875" style="word-spacing:-0.2362em;">&nbsp;l</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.4618em;">&nbsp;not</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.3528em;">&nbsp;remain</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.2968em;">&nbsp;on</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.3458em;">&nbsp;the</span><span class="stl_58 stl_59 stl_875" style="word-spacing:-0.0073em;">&nbsp;OS ’</span><span class="stl_58 stl_59 stl_875" style="word-spacing:-0.2272em;">&nbsp;s</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.3948em;">&nbsp;output &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:9.6933em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">b u</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">&nbsp;r</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.451em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:8.0408em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2716em;">f f l u s h ( fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:8.005em;"><span class="stl_10 stl_11 stl_543" style="word-spacing:-0.2844em;">fsync ( f i l e n o ( fp ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:8.0442em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2687em;">f c l o s e ( fp ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">12.3. RDB</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0839em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0839em;">持久化的运作机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">97 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">修</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;改</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;临</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;文</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;名</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;定</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;文</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;名 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4207em;"><span class="stl_58 stl_59 stl_876" style="word-spacing:0.392em;">* Use</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.209em;">&nbsp;RENAME</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.28em;">&nbsp;to</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.433em;">&nbsp;make sure</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.524em;">&nbsp;the</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.324em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.412em;">&nbsp;f</span><span class="stl_58 stl_59 stl_876" style="word-spacing:-0.1em;">&nbsp;i</span><span class="stl_58 stl_59 stl_876" style="word-spacing:-0.1em;">&nbsp;l</span><span class="stl_58 stl_59 stl_876" style="word-spacing:-0.1em;">&nbsp;e</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.662em;">&nbsp;i</span><span class="stl_58 stl_59 stl_876" style="word-spacing:-0.153em;">&nbsp;s</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.538em;">&nbsp;changed &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.6758em;"><span class="stl_58 stl_59 stl_877" style="word-spacing:0.338em;">atomically only &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.5542em;"><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2518em;">i f</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.4732em;">&nbsp;the</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.4032em;">&nbsp;generate</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.1932em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.2802em;">&nbsp;f</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2328em;">&nbsp;i</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2328em;">&nbsp;l</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2328em;">&nbsp;e</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.5282em;">&nbsp;i</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2848em;">&nbsp;s</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3902em;">&nbsp;ok</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2248em;">&nbsp;.</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3592em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:8.045em;z-index:143; "><span class="stl_15 stl_16 stl_878" style="word-spacing:-0.2541em;">i f</span><span class="stl_15 stl_16 stl_878" style="word-spacing:0.4523em;">&nbsp;</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.4523em;">(</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.2631em;">&nbsp;rename</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.2631em;">&nbsp;(</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.2011em;">&nbsp;tmpfile</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.0211em;">&nbsp;,</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.1401em;">&nbsp;filename</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.1951em;">&nbsp;)</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.1569em;">&nbsp;==</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.1031em;">&nbsp;</span><span class="stl_107 stl_108 stl_878" style="word-spacing:0.1569em;">−</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.1031em;">1)</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.1031em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:9.9933em;"><span class="stl_10 stl_11 stl_879" style="word-spacing:-0.0869em;">redisLog (REDIS_WARNING, ” Error ␣moving␣temp␣DB␣ f i l e ␣on␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:11.6367em;"><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.328em;">the ␣</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.249em;">&nbsp;f</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.3em;">&nbsp;i</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.3em;">&nbsp;n</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.299em;">&nbsp;a</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.3em;">&nbsp;l</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.25em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.283em;">&nbsp;destination</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.172em;">&nbsp;:</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.269em;">&nbsp;␣%s</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.314em;">&nbsp;”</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.202em;">&nbsp;,</span><span class="stl_10 stl_11 stl_880" style="word-spacing:0.395em;">&nbsp;s</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.313em;">&nbsp;t</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.313em;">&nbsp;r</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.313em;">&nbsp;e</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.312em;">&nbsp;r</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.313em;">&nbsp;r</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.313em;">&nbsp;o</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.313em;">&nbsp;r</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.207em;">&nbsp;(</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.255em;">&nbsp;errno</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.255em;">&nbsp;)</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.269em;">&nbsp;)</span><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.269em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:9.9908em;"><span class="stl_10 stl_11 stl_881" style="word-spacing:-0.2666em;">unlink ( tmpfile ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:9.9383em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 16.6785em; left:8.0008em;"><span class="stl_10 stl_11 stl_476" style="word-spacing:-0.1321em;">redisLog (REDIS_NOTICE, ”DB␣saved␣on␣ disk ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:8.0175em;"><span class="stl_10 stl_11 stl_312" style="word-spacing:-0.231em;">server .</span><span class="stl_10 stl_11 stl_312" style="word-spacing:-0.232em;">&nbsp;dirty</span><span class="stl_10 stl_11 stl_312" style="word-spacing:0.1165em;">&nbsp;=</span><span class="stl_10 stl_11 stl_312" style="word-spacing:0.1165em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;录</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;成</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;功</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;保</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:8.0175em;"><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.0762em;">server .</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.0682em;">&nbsp;l</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.2282em;">&nbsp;a</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.2292em;">&nbsp;s</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.2282em;">&nbsp;t</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.2292em;">&nbsp;s</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.2282em;">&nbsp;a</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.2282em;">&nbsp;v</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.2292em;">&nbsp;e</span><span class="stl_10 stl_11 stl_200" style="word-spacing:0.2828em;">&nbsp;=</span><span class="stl_10 stl_11 stl_200" style="word-spacing:0.2208em;">&nbsp;time</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.1852em;">&nbsp;(NULL)</span><span class="stl_10 stl_11 stl_200" style="word-spacing:-0.1852em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;录</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;果</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;状</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;态</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;成</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;功 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:8.0175em;"><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1124em;">server .</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1264em;">&nbsp;lastbgsave_status</span><span class="stl_10 stl_11 stl_882" style="word-spacing:0.2236em;">&nbsp;=</span><span class="stl_10 stl_11 stl_882" style="word-spacing:0.0266em;">&nbsp;REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:7.9458em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:5.98em;"><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.179em;">werr : &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">清 理</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;工</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;作，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;关</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;闭</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;文</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;件</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;描</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;述</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;符</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;等 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:8.0442em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2687em;">f c l o s e ( fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:7.9983em;"><span class="stl_10 stl_11 stl_881" style="word-spacing:-0.2666em;">unlink ( tmpfile ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:8.0008em;"><span class="stl_10 stl_11 stl_883" style="word-spacing:-0.1305em;">redisLog (REDIS_WARNING, ”Write␣ error ␣ saving ␣DB␣on␣ disk : ␣%s &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:9.6117em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 31.6218em; left:10.2344em;"><span class="stl_10 stl_11 stl_693" style="word-spacing:0.3865em;">, s</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.3215em;">&nbsp;t</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.3215em;">&nbsp;r</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.3215em;">&nbsp;e</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.3205em;">&nbsp;r</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.3215em;">&nbsp;r</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.3215em;">&nbsp;o</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.3215em;">&nbsp;r</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2155em;">&nbsp;(</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2635em;">&nbsp;errno</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2635em;">&nbsp;)</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2775em;">&nbsp;)</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2775em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6135em; left:8.045em;"><span class="stl_15 stl_16 stl_625" style="word-spacing:-0.318em;">i f</span><span class="stl_15 stl_16 stl_625" style="word-spacing:0.3884em;">&nbsp;</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.3884em;">(</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.267em;">&nbsp;di</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.266em;">&nbsp;)</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.367em;">&nbsp;d</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;i</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;c</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;t</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;R</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;e</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;l</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;e</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;a</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;s</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;e</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;I</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;t</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;e</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;r</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;a</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;t</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;o</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;r</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.232em;">&nbsp;(</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.267em;">&nbsp;di</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.266em;">&nbsp;)</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.266em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:7.9458em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 36.6051em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:6.4282em;"><span class="stl_58 stl_59 stl_884" style="word-spacing:0.3232em;">/ bgsaveCommand</span><span class="stl_58 stl_59 stl_884" style="word-spacing:-0.2088em;">&nbsp;()</span><span class="stl_58 stl_59 stl_884" style="word-spacing:-0.0558em;">&nbsp;,</span><span class="stl_58 stl_59 stl_884" style="word-spacing:-0.1748em;">&nbsp;serverCron</span><span class="stl_58 stl_59 stl_884" style="word-spacing:-0.1458em;">&nbsp;()</span><span class="stl_58 stl_59 stl_884" style="word-spacing:-0.0558em;">&nbsp;,syncCommand()</span><span class="stl_58 stl_59 stl_884" style="word-spacing:-0.0558em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.6617em;"><span class="stl_58 stl_59 stl_850" style="word-spacing:-0.2218em;">updateSlavesWaitingBgsave ()</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.3623em;">&nbsp;</span><span class="stl_17 stl_18 stl_850" style="word-spacing:0.3623em;">会</span><span class="stl_17 stl_18 stl_850" style="word-spacing:-0.2648em;">&nbsp;调</span><span class="stl_17 stl_18 stl_850" style="word-spacing:-0.2648em;">&nbsp;用</span><span class="stl_17 stl_18 stl_850" style="word-spacing:0.3288em;">&nbsp;</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.3288em;">rdbSaveBackground</span><span class="stl_58 stl_59 stl_850" style="word-spacing:-0.2438em;">&nbsp;() &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:5.9875em;"><span class="stl_15 stl_16 stl_885">int</span><span class="stl_15 stl_16 stl_885" style="word-spacing:0.3463em;">&nbsp;</span><span class="stl_10 stl_11 stl_885" style="word-spacing:0.3463em;">rdbSaveBackground</span><span class="stl_10 stl_11 stl_885" style="word-spacing:0.3463em;">&nbsp;(</span><span class="stl_15 stl_16 stl_885" style="word-spacing:-0.2475em;">char</span><span class="stl_15 stl_16 stl_885" style="word-spacing:0.2616em;">&nbsp;</span><span class="stl_10 stl_11 stl_885" style="word-spacing:0.2616em;">*</span><span class="stl_10 stl_11 stl_885" style="word-spacing:-0.2535em;">&nbsp;filename</span><span class="stl_10 stl_11 stl_885" style="word-spacing:-0.1985em;">&nbsp;)</span><span class="stl_10 stl_11 stl_885" style="word-spacing:-0.1985em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.9633em;"><span class="stl_10 stl_11 stl_283" style="word-spacing:0.3325em;">pid_t childpid</span><span class="stl_10 stl_11 stl_283" style="word-spacing:0.3325em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5835em; left:7.9467em;"><span class="stl_15 stl_16 stl_235" style="word-spacing:0.349em;">long long</span><span class="stl_15 stl_16 stl_235" style="word-spacing:0.4476em;">&nbsp;</span><span class="stl_10 stl_11 stl_235" style="word-spacing:0.4476em;">s</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.212em;">&nbsp;t</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.211em;">&nbsp;a</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.211em;">&nbsp;r</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.211em;">&nbsp;t</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.211em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">已 经</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;后</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;台</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;程</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;序</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;了，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;拒</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;绝</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;再</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;次</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;执</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5727em; left:8.045em;"><span class="stl_15 stl_16 stl_886" style="word-spacing:-0.1818em;">i f</span><span class="stl_15 stl_16 stl_886" style="word-spacing:0.5246em;">&nbsp;</span><span class="stl_10 stl_11 stl_886" style="word-spacing:0.5246em;">(</span><span class="stl_10 stl_11 stl_886" style="word-spacing:-0.1088em;">&nbsp;server</span><span class="stl_10 stl_11 stl_886" style="word-spacing:-0.0528em;">&nbsp;.</span><span class="stl_10 stl_11 stl_886" style="word-spacing:-0.1038em;">&nbsp;rdb_child_pid</span><span class="stl_10 stl_11 stl_886" style="word-spacing:0.3822em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_886" style="word-spacing:0.3435em;">&nbsp;</span><span class="stl_107 stl_108 stl_886" style="word-spacing:0.3822em;">−</span><span class="stl_10 stl_11 stl_886" style="word-spacing:0.3435em;">1)</span><span class="stl_10 stl_11 stl_886" style="word-spacing:0.3261em;">&nbsp;</span><span class="stl_15 stl_16 stl_886" style="word-spacing:0.3261em;">return</span><span class="stl_15 stl_16 stl_886" style="word-spacing:0.2403em;">&nbsp;</span><span class="stl_10 stl_11 stl_886" style="word-spacing:0.2403em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:8.0175em;"><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.1938em;">server .</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2288em;">&nbsp;dirty_before_bgsave</span><span class="stl_10 stl_11 stl_690" style="word-spacing:0.1222em;">&nbsp;=</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.0376em;">&nbsp;server .</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.1948em;">&nbsp;dirty</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.1948em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">98 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.185em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 12.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;RDB</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0839em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0839em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;录</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;这</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;次</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;尝</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;试</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;持</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;久</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;化</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;操</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;作</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:8.0175em;"><span class="stl_10 stl_11 stl_282" style="word-spacing:-0.1345em;">server .</span><span class="stl_10 stl_11 stl_282" style="word-spacing:-0.1545em;">&nbsp;lastbgsave_try</span><span class="stl_10 stl_11 stl_282" style="word-spacing:0.1955em;">&nbsp;=</span><span class="stl_10 stl_11 stl_282" style="word-spacing:-0.0809em;">&nbsp;time (NULL)</span><span class="stl_10 stl_11 stl_282" style="word-spacing:-0.0809em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:8.0275em;"><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.309em;">s t</span><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.309em;">&nbsp;a</span><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.309em;">&nbsp;r</span><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.309em;">&nbsp;t</span><span class="stl_10 stl_11 stl_887" style="word-spacing:0.202em;">&nbsp;=</span><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.077em;">&nbsp;ustime ()</span><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.077em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:8.045em;"><span class="stl_15 stl_16 stl_888" style="word-spacing:-0.314em;">i f</span><span class="stl_15 stl_16 stl_888" style="word-spacing:0.4275em;">&nbsp;</span><span class="stl_10 stl_11 stl_888" style="word-spacing:0.4275em;">((</span><span class="stl_10 stl_11 stl_888" style="word-spacing:-0.205em;">&nbsp;childpid</span><span class="stl_10 stl_11 stl_888" style="word-spacing:0.1605em;">&nbsp;= fork</span><span class="stl_10 stl_11 stl_888" style="word-spacing:-0.214em;">&nbsp;()</span><span class="stl_10 stl_11 stl_888" style="word-spacing:-0.243em;">&nbsp;)</span><span class="stl_10 stl_11 stl_888" style="word-spacing:0.095em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_888" style="word-spacing:0.095em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:9.9725em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.4051em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4051em;">r</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.295em;">&nbsp;e</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;t</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;v</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.295em;">&nbsp;a</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;l</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;消</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;监</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;听 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:10.4132em;"><span class="stl_58 stl_59 stl_497" style="word-spacing:0.3151em;">* Child */ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:10.0142em;"><span class="stl_10 stl_11 stl_889" style="word-spacing:-0.258em;">closeListeningSockets (0) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:10.0117em;"><span class="stl_10 stl_11 stl_419" style="word-spacing:-0.2821em;">redisSetProcTitle ( ” redis </span><span class="stl_107 stl_108 stl_419" style="word-spacing:-0.2821em;">−</span><span class="stl_10 stl_11 stl_419" style="word-spacing:-0.2821em;">rdb</span><span class="stl_107 stl_108 stl_419" style="word-spacing:-0.2821em;">−</span><span class="stl_10 stl_11 stl_419" style="word-spacing:-0.2821em;">bgsave ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;备</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;份</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;程</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;序 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:10.0175em;"><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.314em;">r e</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.313em;">&nbsp;t</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.313em;">&nbsp;v</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.314em;">&nbsp;a</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.313em;">&nbsp;l</span><span class="stl_10 stl_11 stl_890" style="word-spacing:0.198em;">&nbsp;=</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.149em;">&nbsp;rdbSave (</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.231em;">&nbsp;filename</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.232em;">&nbsp;)</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.232em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">脏 数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;据，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;其</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;实</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;就</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;子</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;程</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;所</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;消</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;耗</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;内</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;大</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:10.0375em;"><span class="stl_15 stl_16 stl_891" style="word-spacing:0.048em;">i f</span><span class="stl_15 stl_16 stl_891" style="word-spacing:0.7544em;">&nbsp;</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.7544em;">(</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.13em;">&nbsp;r</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.0246em;">&nbsp;e t v a l</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.507em;">&nbsp;==</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.285em;">&nbsp;REDIS_OK)</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.285em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">获</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;脏</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:11.99em;"><span class="stl_10 stl_11 stl_693" style="word-spacing:0.3705em;">size_t private_dirty</span><span class="stl_10 stl_11 stl_693" style="word-spacing:0.1525em;">&nbsp;=</span><span class="stl_10 stl_11 stl_693" style="word-spacing:0.1345em;">&nbsp;zmalloc_get_private_dirty &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:14.1em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.051em;">) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6485em; left:13.66em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 26.6426em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;录</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;脏</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:12.03em;"><span class="stl_15 stl_16 stl_892" style="word-spacing:-0.334em;">i f</span><span class="stl_15 stl_16 stl_892" style="word-spacing:0.3724em;">&nbsp;</span><span class="stl_10 stl_11 stl_892" style="word-spacing:0.3724em;">(</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.275em;">&nbsp;private_dirty</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.274em;">&nbsp;)</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.274em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:13.9783em;"><span class="stl_10 stl_11 stl_98" style="word-spacing:-0.0678em;">redisLog (REDIS_NOTICE, &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:15.9217em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 29.6293em; left:16.282em;"><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1157em;">RDB: ␣%zu␣MB␣ of ␣memory␣used␣by␣copy</span><span class="stl_107 stl_108 stl_111" style="word-spacing:-0.1157em;">−</span><span class="stl_10 stl_11 stl_111" style="word-spacing:-0.1157em;">on</span><span class="stl_107 stl_108 stl_111" style="word-spacing:-0.1157em;">− &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:17.6358em;"><span class="stl_10 stl_11 stl_893" style="word-spacing:-0.272em;">write ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:15.9758em;"><span class="stl_10 stl_11 stl_894" style="word-spacing:-0.2503em;">private_dirty /(1024*1024) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 33.6143em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 35.6085em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">退</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;出</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;子</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;程 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:9.9733em;"><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.0862em;">exitFromChild ((</span><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.0332em;">&nbsp;r</span><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.1752em;">&nbsp;e</span><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.1742em;">&nbsp;t</span><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.1742em;">&nbsp;v</span><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.1742em;">&nbsp;a</span><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.1752em;">&nbsp;l</span><span class="stl_10 stl_11 stl_221" style="word-spacing:0.3068em;">&nbsp;==</span><span class="stl_10 stl_11 stl_221" style="word-spacing:0.0858em;">&nbsp;REDIS_OK)</span><span class="stl_10 stl_11 stl_221" style="word-spacing:0.4418em;">&nbsp;?</span><span class="stl_10 stl_11 stl_221" style="word-spacing:0.3868em;">&nbsp;0</span><span class="stl_10 stl_11 stl_221" style="word-spacing:0.4838em;">&nbsp;:</span><span class="stl_10 stl_11 stl_221" style="word-spacing:0.5378em;">&nbsp;1)</span><span class="stl_10 stl_11 stl_221" style="word-spacing:0.5378em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.5943em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:10.4132em;"><span class="stl_58 stl_59 stl_570" style="word-spacing:0.329em;">* Parent */ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:10.4132em;"><span class="stl_58 stl_59 stl_271">/</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.0506em;">&nbsp;</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.0506em;">计 算</span><span class="stl_17 stl_18 stl_271" style="word-spacing:0.3102em;">&nbsp;</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.3102em;">fork</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.02em;">&nbsp;</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.02em;">消 耗</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;的</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;时</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:10.01em;"><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.1628em;">server .</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2028em;">&nbsp;stat_fork_time</span><span class="stl_10 stl_11 stl_895" style="word-spacing:0.1457em;">&nbsp;= ustime</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2258em;">&nbsp;()</span><span class="stl_107 stl_108 stl_895" style="word-spacing:-0.2258em;">−</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2258em;">s</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3118em;">&nbsp;t</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3118em;">&nbsp;a</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3118em;">&nbsp;r</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3118em;">&nbsp;t</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3118em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:10.4132em;"><span class="stl_58 stl_59 stl_271" style="word-spacing:0.269em;">/ fork</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.01em;">&nbsp;</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.01em;">出</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.01em;">&nbsp;错 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5727em; left:10.0375em;z-index:587; "><span class="stl_15 stl_16 stl_737" style="word-spacing:-0.2632em;">i f</span><span class="stl_15 stl_16 stl_737" style="word-spacing:0.4432em;">&nbsp;</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.4432em;">(</span><span class="stl_10 stl_11 stl_737" style="word-spacing:-0.1902em;">&nbsp;childpid</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.1868em;">&nbsp;==</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.0945em;">&nbsp;</span><span class="stl_107 stl_108 stl_737" style="word-spacing:0.1868em;">−</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.0945em;">1)</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.0945em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:12.4057em;z-index:597; "><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;录</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;果</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;状</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;态</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;失</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;败 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:12.0025em;"><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.1065em;">server .</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.1205em;">&nbsp;lastbgsave_status</span><span class="stl_10 stl_11 stl_261" style="word-spacing:0.2295em;">&nbsp;=</span><span class="stl_10 stl_11 stl_261" style="word-spacing:0.0395em;">&nbsp;REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:11.9858em;"><span class="stl_10 stl_11 stl_185" style="word-spacing:-0.1254em;">redisLog (REDIS_WARNING, ”Can ’ t ␣ save ␣ in ␣background : &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">12.4. RDB</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0839em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0839em;">数据的组织方式 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.7842em;"><span class="stl_10 stl_11 stl_07">99 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:13.585em;"><span class="stl_10 stl_11 stl_07">␣</span></div>
					<div class="stl_01" style="top: 5.7193em; left:14.1529em;"><span class="stl_10 stl_11 stl_494" style="word-spacing:-0.1427em;">fork : ␣%s ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:14.0142em;"><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2909em;">s t r e r r o r ( errno ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:11.9308em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.7043em; left:9.9933em;"><span class="stl_10 stl_11 stl_896" style="word-spacing:-0.1872em;">redisLog (REDIS_NOTICE, ”Background␣ saving ␣ started ␣by␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:11.6358em;"><span class="stl_10 stl_11 stl_897" style="word-spacing:-0.1998em;">pid ␣%d” , childpid ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;录</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;保</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;起</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;始</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:10.01em;"><span class="stl_10 stl_11 stl_134" style="word-spacing:-0.1029em;">server .</span><span class="stl_10 stl_11 stl_134" style="word-spacing:-0.1589em;">&nbsp;rdb_save_time_start</span><span class="stl_10 stl_11 stl_134" style="word-spacing:0.1931em;">&nbsp;= time</span><span class="stl_10 stl_11 stl_134" style="word-spacing:-0.2119em;">&nbsp;(NULL)</span><span class="stl_10 stl_11 stl_134" style="word-spacing:-0.2119em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.4132em;"><span class="stl_58 stl_59 stl_898">/</span><span class="stl_58 stl_59 stl_898" style="word-spacing:0.4718em;">&nbsp;</span><span class="stl_17 stl_18 stl_898" style="word-spacing:0.4718em;">子</span><span class="stl_17 stl_18 stl_898" style="word-spacing:-0.089em;">&nbsp;进</span><span class="stl_17 stl_18 stl_898" style="word-spacing:-0.088em;">&nbsp;程</span><span class="stl_17 stl_18 stl_898" style="word-spacing:0.4322em;">&nbsp;</span><span class="stl_58 stl_59 stl_898" style="word-spacing:0.4322em;">ID &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:10.01em;"><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.1814em;">server .</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.2334em;">&nbsp;rdb_child_pid</span><span class="stl_10 stl_11 stl_88" style="word-spacing:0.1176em;">&nbsp;=</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.0064em;">&nbsp;childpid</span><span class="stl_10 stl_11 stl_88" style="word-spacing:-0.0064em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:9.9942em;"><span class="stl_10 stl_11 stl_420" style="word-spacing:-0.2174em;">updateDictResizePolicy () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.666em; left:9.9383em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 20.6585em; left:7.9458em;"><span class="stl_15 stl_16 stl_489">return</span><span class="stl_15 stl_16 stl_489" style="word-spacing:0.2705em;">&nbsp;</span><span class="stl_10 stl_11 stl_489" style="word-spacing:0.2705em;">REDIS_OK;</span><span class="stl_10 stl_11 stl_489" style="word-spacing:0.5011em;">&nbsp;</span><span class="stl_58 stl_59 stl_489" style="word-spacing:0.5011em;">/*</span><span class="stl_58 stl_59 stl_489" style="word-spacing:0.4364em;">&nbsp;unreached</span><span class="stl_58 stl_59 stl_489" style="word-spacing:0.4364em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.6885em; left:7.5658em;"><span class="stl_17 stl_18 stl_899" style="word-spacing:0.0955em;">如果采用 </span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.0955em;">BGSAVE </span><span class="stl_17 stl_18 stl_899" style="word-spacing:0.0955em;">策略，且内存中的数据集很大，</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.0955em;">fork() </span><span class="stl_17 stl_18 stl_899" style="word-spacing:0.0955em;">会因为要为子进程产 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.9065em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">生一份虚拟空间表而花费较长的时间；如果此时客户端请求数量非常大的话，会导致 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.681em; left:5.9058em;"><span class="stl_17 stl_18 stl_246" style="word-spacing:0.0872em;">较多的写时拷贝操作；在 </span><span class="stl_10 stl_11 stl_246" style="word-spacing:0.0872em;">RDB </span><span class="stl_17 stl_18 stl_246" style="word-spacing:0.0872em;">持久化操作过程中，每一个数据都会导致 </span><span class="stl_10 stl_11 stl_246" style="word-spacing:0.0872em;">write() </span><span class="stl_17 stl_18 stl_246" style="word-spacing:0.0872em;">系 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6768em; left:5.9058em;"><span class="stl_17 stl_18 stl_226" style="word-spacing:0.0841em;">统调用，</span><span class="stl_10 stl_11 stl_226" style="word-spacing:0.0841em;">CPU </span><span class="stl_17 stl_18 stl_226" style="word-spacing:0.0841em;">资源很紧张。因此，如果在一台物理机上部署多个 </span><span class="stl_10 stl_11 stl_226" style="word-spacing:0.0841em;">redis</span><span class="stl_17 stl_18 stl_226" style="word-spacing:0.0841em;">，应该避免同 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.8957em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">时持久化操作。 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.181em; left:7.5658em;"><span class="stl_17 stl_18 stl_900" style="word-spacing:0.0971em;">那如何知道 </span><span class="stl_10 stl_11 stl_900" style="word-spacing:0.0971em;">BGSAVE </span><span class="stl_17 stl_18 stl_900" style="word-spacing:0.0971em;">占用了多少内存？子进程在结束之前，读取了自身私有 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.1776em; left:5.9058em;"><span class="stl_17 stl_18 stl_901" style="word-spacing:0.1157em;">脏数据 </span><span class="stl_10 stl_11 stl_901" style="word-spacing:0.1157em;">Private_Dirty </span><span class="stl_17 stl_18 stl_901" style="word-spacing:0.1157em;">的大小，这样做是为了让用户看到 </span><span class="stl_10 stl_11 stl_901" style="word-spacing:0.1157em;">redis </span><span class="stl_17 stl_18 stl_901" style="word-spacing:0.1157em;">的持久化进程所占 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.1735em; left:5.9058em;"><span class="stl_17 stl_18 stl_902" style="word-spacing:0.0835em;">用了有多少的空间。在父进程 </span><span class="stl_10 stl_11 stl_902" style="word-spacing:0.0835em;">fork </span><span class="stl_17 stl_18 stl_902" style="word-spacing:0.0835em;">产生子进程过后，父子进程虽然有不同的虚拟空 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.3923em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">间，但物理空间上是共存的，直至父进程或者子进程修改内存数据为止，所以脏数据 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.166em; left:5.9058em;"><span class="stl_10 stl_11 stl_903" style="word-spacing:0.0871em;">Private_Dirty </span><span class="stl_17 stl_18 stl_903" style="word-spacing:0.0871em;">可以近似的认为是子进程，即持久化进程占用的空间。 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.2057em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 39.2057em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">2.4 RDB</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1256em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1256em;">数据的组织方式 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.401em; left:7.5658em;"><span class="stl_10 stl_11 stl_904" style="word-spacing:0.0937em;">RDB </span><span class="stl_17 stl_18 stl_904" style="word-spacing:0.0937em;">的文件组织方式为：数据集序号 </span><span class="stl_10 stl_11 stl_904" style="word-spacing:0.0937em;">1</span><span class="stl_17 stl_18 stl_904" style="word-spacing:0.0937em;">：操作码：数据 </span><span class="stl_10 stl_11 stl_904" style="word-spacing:0.0937em;">1</span><span class="stl_17 stl_18 stl_904" style="word-spacing:0.0937em;">：结束码：校验和</span><span class="stl_10 stl_11 stl_904" style="word-spacing:0.0937em;">—-</span><span class="stl_17 stl_18 stl_904" style="word-spacing:0.0937em;">数 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.3968em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">据集序号 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0821em;">2</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">：操作码：数据 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0821em;">2</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">：结束码：校验和</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0821em;">...... &nbsp;</span></div>
					<div class="stl_01" style="top: 44.9043em; left:7.5658em;z-index:756; "><span class="stl_17 stl_18 stl_905" style="word-spacing:0.1153em;">其中，数据的组织方式为：过期时间：数据类型：键：值，即 </span><span class="stl_10 stl_11 stl_905" style="word-spacing:0.1153em;">TVL</span><span class="stl_17 stl_18 stl_905" style="word-spacing:0.1153em;">（</span><span class="stl_10 stl_11 stl_905" style="word-spacing:0.1153em;">type</span><span class="stl_17 stl_18 stl_905" style="word-spacing:0.1153em;">，</span><span class="stl_10 stl_11 stl_905" style="word-spacing:0.1153em;">length</span><span class="stl_17 stl_18 stl_905" style="word-spacing:0.1153em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 45.901em; left:5.9058em;"><span class="stl_10 stl_11 stl_713">value)</span><span class="stl_17 stl_18 stl_713">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">举两个字符串存储的例子，其他的大概都以至于的形式来组织数据： &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_25.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_25.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">100 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.185em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 12.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;RDB</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0839em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0839em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.2268em; left:7.5658em;"><span class="stl_17 stl_18 stl_590" style="word-spacing:0.0836em;">可见，</span><span class="stl_10 stl_11 stl_590" style="word-spacing:0.0836em;">RDB </span><span class="stl_17 stl_18 stl_590" style="word-spacing:0.0836em;">持久化的结果是一个非常紧凑的文件，几乎每一位都是有用的信息。 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.2235em; left:5.9058em;"><span class="stl_17 stl_18 stl_906" style="word-spacing:0.0728em;">如果对 </span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.0728em;">redis RDB </span><span class="stl_17 stl_18 stl_906" style="word-spacing:0.0728em;">数据组织方式的细则感兴趣，可以参看 </span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.0728em;">rdb.h </span><span class="stl_17 stl_18 stl_906" style="word-spacing:0.0728em;">和 </span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.0728em;">rdb.c </span><span class="stl_17 stl_18 stl_906" style="word-spacing:0.0728em;">两个文件的 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.4415em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">实现。 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.216em; left:7.5658em;"><span class="stl_17 stl_18 stl_907" style="word-spacing:0.0922em;">对于每一个键值对都会调用 </span><span class="stl_10 stl_11 stl_907" style="word-spacing:0.0922em;">rdbSaveKeyValuePair()</span><span class="stl_17 stl_18 stl_907" style="word-spacing:0.0922em;">，如下： &nbsp;</span></div>
					<div class="stl_01" style="top: 18.701em; left:5.9875em;"><span class="stl_15 stl_16 stl_700">int</span><span class="stl_15 stl_16 stl_700" style="word-spacing:0.3448em;">&nbsp;</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.3448em;">rdbSaveKeyValuePair</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.249em;">&nbsp;(</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.178em;">&nbsp;r</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.283em;">&nbsp;i</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.283em;">&nbsp;o</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.366em;">&nbsp;*rdb</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.162em;">&nbsp;,</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.449em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.338em;">&nbsp;*key</span><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.16em;">&nbsp;,</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.449em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.338em;">&nbsp;*val</span><span class="stl_10 stl_11 stl_700" style="word-spacing:0.338em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6977em; left:17.9092em;"><span class="stl_15 stl_16 stl_682" style="word-spacing:0.3102em;">long long</span><span class="stl_15 stl_16 stl_682" style="word-spacing:0.3697em;">&nbsp;</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.3697em;">expiretime</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.0098em;">&nbsp;,</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.4127em;">&nbsp;</span><span class="stl_15 stl_16 stl_682" style="word-spacing:0.4127em;">long</span><span class="stl_15 stl_16 stl_682" style="word-spacing:0.3102em;">&nbsp;long</span><span class="stl_15 stl_16 stl_682" style="word-spacing:0.2573em;">&nbsp;</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.2573em;">now) &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6985em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 21.6968em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6926em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.6968em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">过</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;期</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6926em; left:8.4207em;"><span class="stl_58 stl_59 stl_157" style="word-spacing:0.2697em;">* Save</span><span class="stl_58 stl_59 stl_157" style="word-spacing:0.3347em;">&nbsp;the</span><span class="stl_58 stl_59 stl_157" style="word-spacing:0.3792em;">&nbsp;expire time</span><span class="stl_58 stl_59 stl_157" style="word-spacing:0.2847em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6827em; left:8.045em;"><span class="stl_15 stl_16 stl_674" style="word-spacing:-0.2837em;">i f</span><span class="stl_15 stl_16 stl_674" style="word-spacing:0.4227em;">&nbsp;</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.4227em;">(</span><span class="stl_10 stl_11 stl_674" style="word-spacing:-0.2257em;">&nbsp;expiretime</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.3163em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.2424em;">&nbsp;</span><span class="stl_107 stl_108 stl_674" style="word-spacing:0.3163em;">−</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.2424em;">1)</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.2424em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.686em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.686em; left:10.4133em;"><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.0032em;">* I f</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.4353em;">&nbsp;t</span><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.3337em;">&nbsp;h</span><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.3327em;">&nbsp;i</span><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.3337em;">&nbsp;s</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.3613em;">&nbsp;key i</span><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.3397em;">&nbsp;s</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.3753em;">&nbsp;already expired skip</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.4273em;">&nbsp;i</span><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.3147em;">&nbsp;t</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.3453em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6752em; left:10.0375em;"><span class="stl_15 stl_16 stl_282" style="word-spacing:-0.2634em;">i f</span><span class="stl_15 stl_16 stl_282" style="word-spacing:0.443em;">&nbsp;</span><span class="stl_10 stl_11 stl_282" style="word-spacing:0.443em;">(</span><span class="stl_10 stl_11 stl_282" style="word-spacing:-0.2054em;">&nbsp;expiretime</span><span class="stl_10 stl_11 stl_282" style="word-spacing:0.1706em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_282" style="word-spacing:0.1066em;">&nbsp;now)</span><span class="stl_10 stl_11 stl_282" style="word-spacing:0.3226em;">&nbsp;</span><span class="stl_15 stl_16 stl_282" style="word-spacing:0.3226em;">return</span><span class="stl_15 stl_16 stl_282" style="word-spacing:0.3584em;">&nbsp;</span><span class="stl_10 stl_11 stl_282" style="word-spacing:0.3584em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6718em; left:10.0375em;"><span class="stl_15 stl_16 stl_909" style="word-spacing:0.0044em;">i f</span><span class="stl_15 stl_16 stl_909" style="word-spacing:0.7108em;">&nbsp;</span><span class="stl_10 stl_11 stl_909" style="word-spacing:0.7108em;">(</span><span class="stl_10 stl_11 stl_909" style="word-spacing:0.0014em;">&nbsp;rdbSaveType</span><span class="stl_10 stl_11 stl_909" style="word-spacing:-0.0026em;">&nbsp;( rdb</span><span class="stl_10 stl_11 stl_909" style="word-spacing:0.1074em;">&nbsp;,REDIS_RDB_OPCODE_EXPIRETIME_MS) &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6727em; left:11.4525em;"><span class="stl_10 stl_11 stl_07">=</span></div>
					<div class="stl_01" style="top: 27.6677em; left:12.0005em;z-index:392; "><span class="stl_10 stl_11 stl_910">=</span><span class="stl_10 stl_11 stl_910" style="word-spacing:0.1874em;">&nbsp;</span><span class="stl_107 stl_108 stl_910">−</span><span class="stl_10 stl_11 stl_910" style="word-spacing:0.1874em;">1)</span><span class="stl_10 stl_11 stl_910" style="word-spacing:0.338em;">&nbsp;</span><span class="stl_15 stl_16 stl_910" style="word-spacing:0.338em;">return</span><span class="stl_15 stl_16 stl_910" style="word-spacing:0.4078em;">&nbsp;</span><span class="stl_107 stl_108 stl_910" style="word-spacing:0.338em;">−</span><span class="stl_10 stl_11 stl_910" style="word-spacing:0.4078em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6643em; left:10.0375em;"><span class="stl_15 stl_16 stl_855" style="word-spacing:-0.272em;">i f</span><span class="stl_15 stl_16 stl_855" style="word-spacing:0.4344em;">&nbsp;</span><span class="stl_10 stl_11 stl_855" style="word-spacing:0.4344em;">(</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.236em;">&nbsp;rdbSaveMillisecondTime</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.235em;">&nbsp;(</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.283em;">&nbsp;rdb</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.169em;">&nbsp;,</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.158em;">&nbsp;expiretime</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.214em;">&nbsp;)</span><span class="stl_10 stl_11 stl_855" style="word-spacing:0.139em;">&nbsp;==</span><span class="stl_10 stl_11 stl_855" style="word-spacing:0.0853em;">&nbsp;</span><span class="stl_107 stl_108 stl_855" style="word-spacing:0.139em;">−</span><span class="stl_10 stl_11 stl_855" style="word-spacing:0.0853em;">1) &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6602em; left:11.5983em;"><span class="stl_15 stl_16 stl_296" style="word-spacing:0.3962em;">return </span><span class="stl_107 stl_108 stl_296" style="word-spacing:0.3962em;">−</span><span class="stl_10 stl_11 stl_296" style="word-spacing:0.3962em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6618em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 32.656em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.6518em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.656em; left:8.4207em;"><span class="stl_58 stl_59 stl_815" style="word-spacing:0.2923em;">* Save</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.3353em;">&nbsp;type</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.0967em;">&nbsp;,</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.3773em;">&nbsp;key</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.1427em;">&nbsp;,</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.4273em;">&nbsp;value</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.3403em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6518em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;类</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;型 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6418em; left:8.045em;"><span class="stl_15 stl_16 stl_911" style="word-spacing:-0.2086em;">i f</span><span class="stl_15 stl_16 stl_911" style="word-spacing:0.4978em;">&nbsp;</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.4978em;">(</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.1966em;">&nbsp;rdbSaveObjectType</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.1956em;">&nbsp;(</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.2206em;">&nbsp;rdb</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.1056em;">&nbsp;,</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.0996em;">&nbsp;val</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.1556em;">&nbsp;)</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.2024em;">&nbsp;==</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.149em;">&nbsp;</span><span class="stl_107 stl_108 stl_911" style="word-spacing:0.2024em;">−</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.149em;">1)</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.3003em;">&nbsp;</span><span class="stl_15 stl_16 stl_911" style="word-spacing:0.3003em;">return</span><span class="stl_15 stl_16 stl_911" style="word-spacing:0.3701em;">&nbsp;</span><span class="stl_107 stl_108 stl_911" style="word-spacing:0.3003em;">−</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.3701em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.641em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.641em; left:8.4207em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">/ </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">键 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.6302em; left:8.045em;"><span class="stl_15 stl_16 stl_912" style="word-spacing:-0.239em;">i f</span><span class="stl_15 stl_16 stl_912" style="word-spacing:0.4674em;">&nbsp;</span><span class="stl_10 stl_11 stl_912" style="word-spacing:0.4674em;">(</span><span class="stl_10 stl_11 stl_912" style="word-spacing:-0.196em;">&nbsp;rdbSaveStringObject</span><span class="stl_10 stl_11 stl_912" style="word-spacing:-0.195em;">&nbsp;(</span><span class="stl_10 stl_11 stl_912" style="word-spacing:-0.251em;">&nbsp;rdb</span><span class="stl_10 stl_11 stl_912" style="word-spacing:-0.136em;">&nbsp;,</span><span class="stl_10 stl_11 stl_912" style="word-spacing:-0.179em;">&nbsp;key</span><span class="stl_10 stl_11 stl_912" style="word-spacing:-0.234em;">&nbsp;)</span><span class="stl_10 stl_11 stl_912" style="word-spacing:0.172em;">&nbsp;==</span><span class="stl_10 stl_11 stl_912" style="word-spacing:0.1181em;">&nbsp;</span><span class="stl_107 stl_108 stl_912" style="word-spacing:0.172em;">−</span><span class="stl_10 stl_11 stl_912" style="word-spacing:0.1181em;">1)</span><span class="stl_10 stl_11 stl_912" style="word-spacing:0.2689em;">&nbsp;</span><span class="stl_15 stl_16 stl_912" style="word-spacing:0.2689em;">return</span><span class="stl_15 stl_16 stl_912" style="word-spacing:0.3407em;">&nbsp;</span><span class="stl_107 stl_108 stl_912" style="word-spacing:0.2689em;">−</span><span class="stl_10 stl_11 stl_912" style="word-spacing:0.3407em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.6293em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.6293em; left:8.4208em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">/ </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">值 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.6193em; left:8.045em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:-0.2157em;">i f</span><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4907em;">&nbsp;</span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4907em;">(</span><span class="stl_10 stl_11 stl_495" style="word-spacing:-0.1897em;">&nbsp;rdbSaveObject</span><span class="stl_10 stl_11 stl_495" style="word-spacing:-0.1897em;">&nbsp;(</span><span class="stl_10 stl_11 stl_495" style="word-spacing:-0.2277em;">&nbsp;rdb</span><span class="stl_10 stl_11 stl_495" style="word-spacing:-0.1127em;">&nbsp;,</span><span class="stl_10 stl_11 stl_495" style="word-spacing:-0.1067em;">&nbsp;val</span><span class="stl_10 stl_11 stl_495" style="word-spacing:-0.1627em;">&nbsp;)</span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.1953em;">&nbsp;==</span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.142em;">&nbsp;</span><span class="stl_107 stl_108 stl_495" style="word-spacing:0.1953em;">−</span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.142em;">1)</span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.2932em;">&nbsp;</span><span class="stl_15 stl_16 stl_495" style="word-spacing:0.2932em;">return</span><span class="stl_15 stl_16 stl_495" style="word-spacing:0.363em;">&nbsp;</span><span class="stl_107 stl_108 stl_495" style="word-spacing:0.2932em;">−</span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.363em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.6152em; left:7.9458em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.6168em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.993em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 13 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.8231em; left:5.9058em;"><span class="stl_12 stl_13 stl_30" style="word-spacing:0.1351em;">AOF </span><span class="stl_37 stl_18 stl_30" style="word-spacing:0.1351em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6966em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 20.6966em; left:6.5789em;"><span class="stl_38 stl_13 stl_07">3.1</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">数据结构</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1254em;">&nbsp;</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1254em;">rio &nbsp;</span></div>
					<div class="stl_01" style="top: 23.0693em; left:7.5658em;"><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0849em;">本篇主要讲的是 </span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0849em;">AOF </span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0849em;">持久化，了解 </span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0849em;">AOF </span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0849em;">的数据组织方式和运作机制。</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0849em;">redis </span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0849em;">主 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.0651em; left:5.9058em;"><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0874em;">要在 </span><span class="stl_10 stl_11 stl_49" style="word-spacing:0.0874em;">aof.c </span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0874em;">中实现 </span><span class="stl_10 stl_11 stl_49" style="word-spacing:0.0874em;">AOF </span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0874em;">的操作。 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.7566em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 26.7566em; left:6.5789em;"><span class="stl_38 stl_13 stl_331" style="word-spacing:0.7557em;">3.2 AOF</span><span class="stl_38 stl_13 stl_331" style="word-spacing:0.1316em;">&nbsp;</span><span class="stl_39 stl_18 stl_331" style="word-spacing:0.1316em;">数据组织方式 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.1293em; left:7.5658em;"><span class="stl_17 stl_18 stl_457" style="word-spacing:0.094em;">假设 </span><span class="stl_10 stl_11 stl_457" style="word-spacing:0.094em;">redis </span><span class="stl_17 stl_18 stl_457" style="word-spacing:0.094em;">内存有「</span><span class="stl_10 stl_11 stl_457" style="word-spacing:0.094em;">name:Jhon</span><span class="stl_17 stl_18 stl_457" style="word-spacing:0.094em;">」的键值对，那么进行 </span><span class="stl_10 stl_11 stl_457" style="word-spacing:0.094em;">AOF </span><span class="stl_17 stl_18 stl_457" style="word-spacing:0.094em;">持久化后，</span><span class="stl_10 stl_11 stl_457" style="word-spacing:0.094em;">AOF </span><span class="stl_17 stl_18 stl_457" style="word-spacing:0.094em;">文 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.3473em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">件有如下内容： &nbsp;</span></div>
					<div class="stl_01" style="top: 32.7543em; left:5.9608em;"><span class="stl_10 stl_11 stl_07">*</span></div>
					<div class="stl_01" style="top: 33.751em; left:5.9608em;"><span class="stl_10 stl_11 stl_07">$</span></div>
					<div class="stl_01" style="top: 32.7543em; left:6.4308em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 33.751em; left:6.4308em;"><span class="stl_10 stl_11 stl_07">6</span></div>
					<div class="stl_01" style="top: 32.7543em; left:9.2951em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.284em;"># 2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0997em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0997em;">个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.751em; left:9.2951em;"><span class="stl_10 stl_11 stl_07">#</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3341em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3341em;">第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4996em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.05em;">6 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.7468em; left:11.2882em;"><span class="stl_10 stl_11 stl_07">#</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3334em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3334em;">第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.7468em; left:5.86em;"><span class="stl_10 stl_11 stl_913">SELECT &nbsp;</span></div>
					<div class="stl_01" style="top: 35.7435em; left:5.9608em;"><span class="stl_10 stl_11 stl_07">$</span></div>
					<div class="stl_01" style="top: 36.7393em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">8</span></div>
					<div class="stl_01" style="top: 37.736em; left:5.9608em;"><span class="stl_10 stl_11 stl_07">*</span></div>
					<div class="stl_01" style="top: 38.7326em; left:5.9608em;"><span class="stl_10 stl_11 stl_07">$</span></div>
					<div class="stl_01" style="top: 35.7435em; left:6.4308em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 35.7435em; left:9.2951em;"><span class="stl_10 stl_11 stl_07">#</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3341em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3341em;">第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;二</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5001em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.05em;">1 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.7393em; left:8.7969em;"><span class="stl_10 stl_11 stl_07">#</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3339em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3339em;">第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;二</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.736em; left:6.4308em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 38.7326em; left:6.4308em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 37.736em; left:9.2951em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.284em;"># 3</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0997em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0997em;">个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.7326em; left:9.2951em;"><span class="stl_10 stl_11 stl_07">#</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3341em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3341em;">第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4996em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.05em;">4 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.7285em; left:9.7938em;"><span class="stl_10 stl_11 stl_07">#</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3337em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3337em;">第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.7285em; left:5.8725em;"><span class="stl_10 stl_11 stl_914">SET &nbsp;</span></div>
					<div class="stl_01" style="top: 40.7251em; left:5.9608em;"><span class="stl_10 stl_11 stl_07">$</span></div>
					<div class="stl_01" style="top: 40.7251em; left:6.4308em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 40.7251em; left:9.2951em;"><span class="stl_10 stl_11 stl_07">#</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3341em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3341em;">第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;二</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5001em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.05em;">4 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.721em; left:10.2921em;"><span class="stl_10 stl_11 stl_07">#</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3337em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3337em;">第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;二</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.721em; left:5.9167em;"><span class="stl_10 stl_11 stl_915">name &nbsp;</span></div>
					<div class="stl_01" style="top: 42.7177em; left:5.9608em;"><span class="stl_10 stl_11 stl_07">$</span></div>
					<div class="stl_01" style="top: 42.7177em; left:6.4308em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 42.7177em; left:9.2951em;"><span class="stl_10 stl_11 stl_07">#</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3341em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3341em;">第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;三</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4996em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.05em;">4 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.7135em; left:10.2914em;"><span class="stl_10 stl_11 stl_07">#</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3346em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3346em;">第</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;二</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5001em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.05em;">4 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.7135em; left:5.9508em;"><span class="stl_10 stl_11 stl_296">Jhon &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:7.5658em;"><span class="stl_17 stl_18 stl_916" style="word-spacing:0.1123em;">所以对上面的内容进行恢复，能得到熟悉的一条 </span><span class="stl_10 stl_11 stl_916" style="word-spacing:0.1123em;">redis </span><span class="stl_17 stl_18 stl_916" style="word-spacing:0.1123em;">命令：</span><span class="stl_10 stl_11 stl_916" style="word-spacing:0.1123em;">SELECT 8;SET &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_10 stl_11 stl_248" style="word-spacing:0.0955em;">name Jhon.</span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.2472em;">&nbsp;</span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.2472em;">可以想象的是，</span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.2472em;">redis</span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.0964em;">&nbsp;</span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.0964em;">遍历内存数据集中的每个</span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.0959em;">&nbsp;</span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.0959em;">key-value</span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.0958em;">&nbsp;</span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.0958em;">对，依次写入 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;"><span class="stl_17 stl_18 stl_287" style="word-spacing:0.0843em;">磁盘中；</span><span class="stl_10 stl_11 stl_287" style="word-spacing:0.0843em;">redis </span><span class="stl_17 stl_18 stl_287" style="word-spacing:0.0843em;">启动的时候，从 </span><span class="stl_10 stl_11 stl_287" style="word-spacing:0.0843em;">AOF </span><span class="stl_17 stl_18 stl_287" style="word-spacing:0.0843em;">文件中读取数据，恢复数据。 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">01 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_27.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_27.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">102 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4507em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.4507em; left:6.5789em;"><span class="stl_38 stl_13 stl_27" style="word-spacing:0.755em;">3.3 AOF</span><span class="stl_38 stl_13 stl_27" style="word-spacing:0.1309em;">&nbsp;</span><span class="stl_39 stl_18 stl_27" style="word-spacing:0.1309em;">持久化运作机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7301em; left:7.5658em;z-index:54; "><span class="stl_17 stl_18 stl_53" style="word-spacing:0.0733em;">和 </span><span class="stl_10 stl_11 stl_53" style="word-spacing:0.0733em;">redis RDB </span><span class="stl_17 stl_18 stl_53" style="word-spacing:0.0733em;">持久化运作机制不同，</span><span class="stl_10 stl_11 stl_53" style="word-spacing:0.0733em;">redis AOF </span><span class="stl_17 stl_18 stl_53" style="word-spacing:0.0733em;">有后台执行和边服务边备份两种 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.949em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">方式。 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.9201em; left:7.5658em;"><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0862em;">1</span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0862em;">）</span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0862em;">AOF </span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0862em;">后台执行的方式和 </span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0862em;">RDB </span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0862em;">有类似的地方，</span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0862em;">fork </span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0862em;">一个子进程，主进程仍进 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.916em; left:5.9058em;"><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0869em;">行服务，子进程执行 </span><span class="stl_10 stl_11 stl_47" style="word-spacing:0.0869em;">AOF </span><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0869em;">持久化，数据被 </span><span class="stl_10 stl_11 stl_47" style="word-spacing:0.0869em;">dump </span><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0869em;">到磁盘上。与 </span><span class="stl_10 stl_11 stl_47" style="word-spacing:0.0869em;">RDB </span><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0869em;">不同的是，后 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.1348em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">台子进程持久化过程中，主进程会记录期间的所有数据变更（主进程还在服务），并 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.9085em; left:5.9058em;"><span class="stl_17 stl_18 stl_147" style="word-spacing:0.104em;">存储在 </span><span class="stl_10 stl_11 stl_147" style="word-spacing:0.104em;">server.aof_rewrite_buf_blocks </span><span class="stl_17 stl_18 stl_147" style="word-spacing:0.104em;">中；后台子进程结束后，</span><span class="stl_10 stl_11 stl_147" style="word-spacing:0.104em;">redis </span><span class="stl_17 stl_18 stl_147" style="word-spacing:0.104em;">更新缓存追加 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.9051em; left:5.9058em;"><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0863em;">到 </span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.0863em;">AOF </span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0863em;">文件中，是 </span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.0863em;">RDB </span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0863em;">持久化所不具备的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.9177em; left:7.5658em;"><span class="stl_17 stl_18 stl_353" style="word-spacing:0.1029em;">来说说更新缓存这个东西。</span><span class="stl_10 stl_11 stl_353" style="word-spacing:0.1029em;">redis </span><span class="stl_17 stl_18 stl_353" style="word-spacing:0.1029em;">服务器产生数据变更的时候，譬如 </span><span class="stl_10 stl_11 stl_353" style="word-spacing:0.1029em;">set name &nbsp;</span></div>
					<div class="stl_01" style="top: 24.9135em; left:5.9058em;"><span class="stl_10 stl_11 stl_65">Jhon</span><span class="stl_17 stl_18 stl_65">，不仅仅会修改内存数据集，也会记录此更新（修改）操作，记录的方式就是上 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.1323em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">面所说的数据组织方式。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.9227em; left:7.5658em;"><span class="stl_17 stl_18 stl_917" style="word-spacing:0.1017em;">更新缓存可以存储在 </span><span class="stl_10 stl_11 stl_917" style="word-spacing:0.1017em;">server.aof_buf </span><span class="stl_17 stl_18 stl_917" style="word-spacing:0.1017em;">中，你可以把它理解为一个小型临时中转 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.1407em; left:5.9058em;"><span class="stl_17 stl_18 stl_235">站，所有累积的更新缓存都会先放入这里，它会在特定时机写入文件或者插入到 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.9152em; left:5.9058em;z-index:473; "><span class="stl_10 stl_11 stl_818" style="word-spacing:0.1877em;">server.aof_rewrite_buf_blocks </span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.1877em;">下链表（下面会详述）；</span><span class="stl_10 stl_11 stl_818" style="word-spacing:0.1877em;">server.aof_buf </span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.1877em;">中的数据在 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.911em; left:5.9058em;"><span class="stl_10 stl_11 stl_918" style="word-spacing:0.1146em;">propagrate() </span><span class="stl_17 stl_18 stl_918" style="word-spacing:0.1146em;">添加，在涉及数据更新的地方都会调用 </span><span class="stl_10 stl_11 stl_918" style="word-spacing:0.1146em;">propagrate() </span><span class="stl_17 stl_18 stl_918" style="word-spacing:0.1146em;">以累积变更。更 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.9077em; left:5.9058em;"><span class="stl_17 stl_18 stl_75" style="word-spacing:0.1463em;">新缓存也可以存储在 </span><span class="stl_10 stl_11 stl_75" style="word-spacing:0.1463em;">server.aof_rewrite_buf_blocks</span><span class="stl_17 stl_18 stl_75" style="word-spacing:0.1463em;">，这是一个元素类型为 </span><span class="stl_10 stl_11 stl_75" style="word-spacing:0.1463em;">struct &nbsp;</span></div>
					<div class="stl_01" style="top: 32.9035em; left:5.9058em;"><span class="stl_10 stl_11 stl_47" style="word-spacing:0.0854em;">aofrwblock </span><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0854em;">的链表，你可以把它理解为一个仓库，当后台有 </span><span class="stl_10 stl_11 stl_47" style="word-spacing:0.0854em;">AOF </span><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0854em;">子进程的时候，会 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.9002em; left:5.9058em;"><span class="stl_17 stl_18 stl_919" style="word-spacing:0.0821em;">将累积的更新缓存（在 </span><span class="stl_10 stl_11 stl_919" style="word-spacing:0.0821em;">server.aof_buf </span><span class="stl_17 stl_18 stl_919" style="word-spacing:0.0821em;">中）插入到链表中，而当 </span><span class="stl_10 stl_11 stl_919" style="word-spacing:0.0821em;">AOF </span><span class="stl_17 stl_18 stl_919" style="word-spacing:0.0821em;">子进程结束，它 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.1182em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">会被整个写入到文件。两者是有关联的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.1307em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">下面是后台执行的主要代码： &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.4326em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.4401em; left:6.4282em;"><span class="stl_58 stl_59 stl_299">/</span><span class="stl_58 stl_59 stl_299" style="word-spacing:0.3632em;">&nbsp;</span><span class="stl_17 stl_18 stl_299" style="word-spacing:0.3632em;">启</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1976em;">&nbsp;动</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1966em;">&nbsp;后</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1966em;">&nbsp;台</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1966em;">&nbsp;子</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1966em;">&nbsp;进</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1636em;">&nbsp;程，</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1636em;">&nbsp;执</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1966em;">&nbsp;行</span><span class="stl_17 stl_18 stl_299" style="word-spacing:0.2133em;">&nbsp;</span><span class="stl_58 stl_59 stl_299" style="word-spacing:0.2133em;">AOF</span><span class="stl_58 stl_59 stl_299" style="word-spacing:0.212em;">&nbsp;</span><span class="stl_17 stl_18 stl_299" style="word-spacing:0.212em;">持</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1976em;">&nbsp;久</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1966em;">&nbsp;化</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1966em;">&nbsp;操</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.1626em;">&nbsp;作。</span><span class="stl_17 stl_18 stl_299" style="word-spacing:-0.181em;">&nbsp;</span><span class="stl_58 stl_59 stl_299" style="word-spacing:-0.181em;">bgrewriteaofCommand</span><span class="stl_58 stl_59 stl_299" style="word-spacing:-0.1876em;">&nbsp;() &nbsp;</span></div>
					<div class="stl_01" style="top: 40.6573em; left:7.6492em;"><span class="stl_17 stl_18 stl_07">，</span></div>
					<div class="stl_01" style="top: 40.4368em; left:8.6467em;"><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.2307em;">startAppendOnly ()</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.233em;">&nbsp;</span><span class="stl_17 stl_18 stl_674" style="word-spacing:-0.233em;">，</span><span class="stl_17 stl_18 stl_674" style="word-spacing:-0.2542em;">&nbsp;</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.2542em;">serverCron</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.2267em;">&nbsp;()</span><span class="stl_58 stl_59 stl_674" style="word-spacing:0.3682em;">&nbsp;</span><span class="stl_17 stl_18 stl_674" style="word-spacing:0.3682em;">中</span><span class="stl_17 stl_18 stl_674" style="word-spacing:-0.2607em;">&nbsp;会</span><span class="stl_17 stl_18 stl_674" style="word-spacing:-0.2597em;">&nbsp;调</span><span class="stl_17 stl_18 stl_674" style="word-spacing:-0.2597em;">&nbsp;用</span><span class="stl_17 stl_18 stl_674" style="word-spacing:-0.2597em;">&nbsp;此</span><span class="stl_17 stl_18 stl_674" style="word-spacing:-0.2597em;">&nbsp;函</span><span class="stl_17 stl_18 stl_674" style="word-spacing:-0.2597em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:6.4282em;"><span class="stl_58 stl_59 stl_177" style="word-spacing:0.2821em;">* This</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3841em;">&nbsp;i</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.3059em;">&nbsp;s</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3141em;">&nbsp;how rewriting</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3941em;">&nbsp;of the</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3286em;">&nbsp;append only</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.4631em;">&nbsp;f</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2539em;">&nbsp;i</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2539em;">&nbsp;l</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2539em;">&nbsp;e</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.4571em;">&nbsp;in &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:7.6492em;"><span class="stl_58 stl_59 stl_361" style="word-spacing:0.345em;">background works</span><span class="stl_58 stl_59 stl_361" style="word-spacing:0.345em;">&nbsp;: &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 44.4218em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 45.4176em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 46.4143em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 44.4218em; left:6.9786em;"><span class="stl_58 stl_59 stl_920" style="word-spacing:0.5582em;">1) The user</span><span class="stl_58 stl_59 stl_920" style="word-spacing:0.7257em;">&nbsp;c</span><span class="stl_58 stl_59 stl_920" style="word-spacing:0.0112em;">&nbsp;a l l s</span><span class="stl_58 stl_59 stl_920" style="word-spacing:0.5077em;">&nbsp;BGREWRITEAOF &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:6.9786em;"><span class="stl_58 stl_59 stl_307" style="word-spacing:0.2911em;">2) Redis</span><span class="stl_58 stl_59 stl_307" style="word-spacing:0.3831em;">&nbsp;c</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.3149em;">&nbsp;a</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.3139em;">&nbsp;l</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.3139em;">&nbsp;l</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.3149em;">&nbsp;s</span><span class="stl_58 stl_59 stl_307" style="word-spacing:0.4541em;">&nbsp;t</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.3309em;">&nbsp;h</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.3299em;">&nbsp;i</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.3309em;">&nbsp;s</span><span class="stl_58 stl_59 stl_307" style="word-spacing:0.3911em;">&nbsp;function</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.1079em;">&nbsp;,</span><span class="stl_58 stl_59 stl_307" style="word-spacing:0.3916em;">&nbsp;that forks</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.2229em;">&nbsp;()</span><span class="stl_58 stl_59 stl_307" style="word-spacing:-0.2229em;">&nbsp;: &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:8.4324em;"><span class="stl_58 stl_59 stl_802" style="word-spacing:0.3543em;">2a) the</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.4173em;">&nbsp;c</span><span class="stl_58 stl_59 stl_802" style="word-spacing:-0.3067em;">&nbsp;h</span><span class="stl_58 stl_59 stl_802" style="word-spacing:-0.3057em;">&nbsp;i</span><span class="stl_58 stl_59 stl_802" style="word-spacing:-0.3067em;">&nbsp;l</span><span class="stl_58 stl_59 stl_802" style="word-spacing:-0.3067em;">&nbsp;d</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.4173em;">&nbsp;rewrite the</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.3308em;">&nbsp;append only</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.4653em;">&nbsp;f</span><span class="stl_58 stl_59 stl_802" style="word-spacing:-0.2517em;">&nbsp;i</span><span class="stl_58 stl_59 stl_802" style="word-spacing:-0.2517em;">&nbsp;l</span><span class="stl_58 stl_59 stl_802" style="word-spacing:-0.2517em;">&nbsp;e</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.4593em;">&nbsp;in</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.2893em;">&nbsp;a</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.2343em;">&nbsp;temp &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:7.7433em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.036em;">f i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.036em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.036em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.036em;">&nbsp;. &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_49" style="word-spacing:0.5305em;">13.3. AOF</span><span class="stl_21 stl_11 stl_49" style="word-spacing:0.0872em;">&nbsp;</span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0872em;">持久化运作机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">103 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4324em;"><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3207em;">2b )</span><span class="stl_58 stl_59 stl_921" style="word-spacing:0.3416em;">&nbsp;the parent accumulates</span><span class="stl_58 stl_59 stl_921" style="word-spacing:0.3842em;">&nbsp;d</span><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3238em;">&nbsp;i</span><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3247em;">&nbsp;f</span><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3248em;">&nbsp;f</span><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3247em;">&nbsp;e</span><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3238em;">&nbsp;r</span><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3247em;">&nbsp;e</span><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3247em;">&nbsp;n</span><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3248em;">&nbsp;c</span><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3238em;">&nbsp;e</span><span class="stl_58 stl_59 stl_921" style="word-spacing:-0.3247em;">&nbsp;s</span><span class="stl_58 stl_59 stl_921" style="word-spacing:0.3742em;">&nbsp;in server</span><span class="stl_58 stl_59 stl_921" style="word-spacing:0.3742em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.66em;"><span class="stl_58 stl_59 stl_922" style="word-spacing:-0.2167em;">aof_rewrite_buf . &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7093em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:6.9787em;"><span class="stl_58 stl_59 stl_923" style="word-spacing:0.307em;">3) When the</span><span class="stl_58 stl_59 stl_923" style="word-spacing:0.508em;">&nbsp;c</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.216em;">&nbsp;h</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.215em;">&nbsp;i</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.216em;">&nbsp;l</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.216em;">&nbsp;d</span><span class="stl_58 stl_59 stl_923" style="word-spacing:0.543em;">&nbsp;f</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.217em;">&nbsp;i</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.217em;">&nbsp;n</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.216em;">&nbsp;i</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.217em;">&nbsp;s</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.216em;">&nbsp;h</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.217em;">&nbsp;e</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.216em;">&nbsp;d</span><span class="stl_58 stl_59 stl_923" style="word-spacing:0.574em;">&nbsp;’2a</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.135em;">&nbsp;’</span><span class="stl_58 stl_59 stl_923" style="word-spacing:0.496em;">&nbsp;e</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.201em;">&nbsp;x</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.2em;">&nbsp;i</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.201em;">&nbsp;s</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.201em;">&nbsp;t</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.201em;">&nbsp;s</span><span class="stl_58 stl_59 stl_923" style="word-spacing:-0.201em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:6.9787em;"><span class="stl_58 stl_59 stl_289" style="word-spacing:0.3186em;">4) The parent</span><span class="stl_58 stl_59 stl_289" style="word-spacing:0.4846em;">&nbsp;w</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2294em;">&nbsp;i</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2304em;">&nbsp;l</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2294em;">&nbsp;l</span><span class="stl_58 stl_59 stl_289" style="word-spacing:0.4946em;">&nbsp;trap</span><span class="stl_58 stl_59 stl_289" style="word-spacing:0.4571em;">&nbsp;the e</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2464em;">&nbsp;x</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2464em;">&nbsp;i</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2454em;">&nbsp;t</span><span class="stl_58 stl_59 stl_289" style="word-spacing:0.4306em;">&nbsp;code</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.1144em;">&nbsp;,</span><span class="stl_58 stl_59 stl_289" style="word-spacing:0.5286em;">&nbsp;i</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2184em;">&nbsp;f</span><span class="stl_58 stl_59 stl_289" style="word-spacing:0.5686em;">&nbsp;i</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2264em;">&nbsp;t</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.0304em;">&nbsp;’</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2204em;">&nbsp;s</span><span class="stl_58 stl_59 stl_289" style="word-spacing:0.1976em;">&nbsp;OK,</span><span class="stl_58 stl_59 stl_289" style="word-spacing:0.5156em;">&nbsp;w</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2304em;">&nbsp;i</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2294em;">&nbsp;l</span><span class="stl_58 stl_59 stl_289" style="word-spacing:-0.2294em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.6292em;"><span class="stl_58 stl_59 stl_814" style="word-spacing:0.3713em;">append the &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 12.6943em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 14.6876em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 16.6801em; left:5.955em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4847em;"><span class="stl_58 stl_59 stl_592" style="word-spacing:0.339em;">data accumulated into</span><span class="stl_58 stl_59 stl_592" style="word-spacing:0.391em;">&nbsp;server</span><span class="stl_58 stl_59 stl_592" style="word-spacing:-0.199em;">&nbsp;.</span><span class="stl_58 stl_59 stl_592" style="word-spacing:-0.224em;">&nbsp;aof_rewrite_buf</span><span class="stl_58 stl_59 stl_592" style="word-spacing:0.3725em;">&nbsp;into</span><span class="stl_58 stl_59 stl_592" style="word-spacing:0.3725em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:7.6125em;"><span class="stl_58 stl_59 stl_390" style="word-spacing:0.474em;">temp f</span><span class="stl_58 stl_59 stl_390" style="word-spacing:-0.182em;">&nbsp;i</span><span class="stl_58 stl_59 stl_390" style="word-spacing:-0.182em;">&nbsp;l</span><span class="stl_58 stl_59 stl_390" style="word-spacing:-0.181em;">&nbsp;e</span><span class="stl_58 stl_59 stl_390" style="word-spacing:0.143em;">&nbsp;,</span><span class="stl_58 stl_59 stl_390" style="word-spacing:0.441em;">&nbsp;and &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.5528em;"><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.258em;">f i</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.259em;">&nbsp;n</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.258em;">&nbsp;a</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.259em;">&nbsp;l</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.259em;">&nbsp;l</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.258em;">&nbsp;y</span><span class="stl_58 stl_59 stl_855" style="word-spacing:0.524em;">&nbsp;w</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.264em;">&nbsp;i</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.265em;">&nbsp;l</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.264em;">&nbsp;l</span><span class="stl_58 stl_59 stl_855" style="word-spacing:0.388em;">&nbsp;rename</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.278em;">&nbsp;(2)</span><span class="stl_58 stl_59 stl_855" style="word-spacing:0.394em;">&nbsp;the</span><span class="stl_58 stl_59 stl_855" style="word-spacing:0.332em;">&nbsp;temp</span><span class="stl_58 stl_59 stl_855" style="word-spacing:0.422em;">&nbsp;f</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.234em;">&nbsp;i</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.234em;">&nbsp;l</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.234em;">&nbsp;e</span><span class="stl_58 stl_59 stl_855" style="word-spacing:0.477em;">&nbsp;in</span><span class="stl_58 stl_59 stl_855" style="word-spacing:0.4025em;">&nbsp;the actual</span><span class="stl_58 stl_59 stl_855" style="word-spacing:0.508em;">&nbsp;f</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.234em;">&nbsp;i</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.234em;">&nbsp;l</span><span class="stl_58 stl_59 stl_855" style="word-spacing:-0.234em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.5742em;"><span class="stl_58 stl_59 stl_924" style="word-spacing:-0.1133em;">name . &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4191em;"><span class="stl_58 stl_59 stl_925" style="word-spacing:0.3335em;">The the new</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.423em;">&nbsp;f</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.205em;">&nbsp;i</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.205em;">&nbsp;l</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.205em;">&nbsp;e</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.556em;">&nbsp;i</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.257em;">&nbsp;s</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.442em;">&nbsp;reopened</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.3865em;">&nbsp;as the</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.334em;">&nbsp;new</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.286em;">&nbsp;append</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.374em;">&nbsp;only</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.512em;">&nbsp;f</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.205em;">&nbsp;i</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.205em;">&nbsp;l</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.205em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.6855em;"><span class="stl_58 stl_59 stl_926" style="word-spacing:-0.252em;">Profit ! &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.6875em;"><span class="stl_58 stl_59 stl_07">.</span></div>
					<div class="stl_01" style="top: 16.6801em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.6693em; left:5.9875em;"><span class="stl_15 stl_16 stl_927">int</span><span class="stl_15 stl_16 stl_927" style="word-spacing:0.3603em;">&nbsp;</span><span class="stl_10 stl_11 stl_927" style="word-spacing:0.3603em;">rewriteAppendOnlyFileBackground</span><span class="stl_10 stl_11 stl_927" style="word-spacing:-0.2335em;">&nbsp;(</span><span class="stl_10 stl_11 stl_927" style="word-spacing:-0.2787em;">&nbsp;</span><span class="stl_15 stl_16 stl_927" style="word-spacing:-0.2787em;">void</span><span class="stl_15 stl_16 stl_927" style="word-spacing:-0.2775em;">&nbsp;</span><span class="stl_10 stl_11 stl_927" style="word-spacing:-0.2775em;">)</span><span class="stl_10 stl_11 stl_927" style="word-spacing:-0.2775em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:7.9633em;"><span class="stl_10 stl_11 stl_283" style="word-spacing:0.3325em;">pid_t childpid</span><span class="stl_10 stl_11 stl_283" style="word-spacing:0.3325em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:7.9467em;"><span class="stl_15 stl_16 stl_235" style="word-spacing:0.349em;">long long</span><span class="stl_15 stl_16 stl_235" style="word-spacing:0.4476em;">&nbsp;</span><span class="stl_10 stl_11 stl_235" style="word-spacing:0.4476em;">s</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.212em;">&nbsp;t</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.211em;">&nbsp;a</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.211em;">&nbsp;r</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.211em;">&nbsp;t</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.211em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.661em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">已</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;经</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;正</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;在</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;备</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;份</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;子</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;程 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:8.045em;"><span class="stl_15 stl_16 stl_928" style="word-spacing:-0.1918em;">i f</span><span class="stl_15 stl_16 stl_928" style="word-spacing:0.5146em;">&nbsp;</span><span class="stl_10 stl_11 stl_928" style="word-spacing:0.5146em;">(</span><span class="stl_10 stl_11 stl_928" style="word-spacing:-0.1188em;">&nbsp;server</span><span class="stl_10 stl_11 stl_928" style="word-spacing:-0.0628em;">&nbsp;.</span><span class="stl_10 stl_11 stl_928" style="word-spacing:-0.0998em;">&nbsp;aof_child_pid</span><span class="stl_10 stl_11 stl_928" style="word-spacing:0.3862em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_928" style="word-spacing:0.3335em;">&nbsp;</span><span class="stl_107 stl_108 stl_928" style="word-spacing:0.3862em;">−</span><span class="stl_10 stl_11 stl_928" style="word-spacing:0.3335em;">1)</span><span class="stl_10 stl_11 stl_928" style="word-spacing:0.3161em;">&nbsp;</span><span class="stl_15 stl_16 stl_928" style="word-spacing:0.3161em;">return</span><span class="stl_15 stl_16 stl_928" style="word-spacing:0.2303em;">&nbsp;</span><span class="stl_10 stl_11 stl_928" style="word-spacing:0.2303em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:8.0275em;"><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.309em;">s t</span><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.309em;">&nbsp;a</span><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.309em;">&nbsp;r</span><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.309em;">&nbsp;t</span><span class="stl_10 stl_11 stl_887" style="word-spacing:0.202em;">&nbsp;=</span><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.077em;">&nbsp;ustime ()</span><span class="stl_10 stl_11 stl_887" style="word-spacing:-0.077em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6393em; left:8.045em;"><span class="stl_15 stl_16 stl_888" style="word-spacing:-0.314em;">i f</span><span class="stl_15 stl_16 stl_888" style="word-spacing:0.4275em;">&nbsp;</span><span class="stl_10 stl_11 stl_888" style="word-spacing:0.4275em;">((</span><span class="stl_10 stl_11 stl_888" style="word-spacing:-0.205em;">&nbsp;childpid</span><span class="stl_10 stl_11 stl_888" style="word-spacing:0.1605em;">&nbsp;= fork</span><span class="stl_10 stl_11 stl_888" style="word-spacing:-0.214em;">&nbsp;()</span><span class="stl_10 stl_11 stl_888" style="word-spacing:-0.243em;">&nbsp;)</span><span class="stl_10 stl_11 stl_888" style="word-spacing:0.095em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_888" style="word-spacing:0.095em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.636em; left:9.9267em;"><span class="stl_15 stl_16 stl_792">char</span><span class="stl_15 stl_16 stl_792" style="word-spacing:0.3188em;">&nbsp;</span><span class="stl_10 stl_11 stl_792" style="word-spacing:0.3188em;">tmpfile</span><span class="stl_10 stl_11 stl_792" style="word-spacing:-0.1447em;">&nbsp;[</span><span class="stl_10 stl_11 stl_792" style="word-spacing:-0.2837em;">&nbsp;2</span><span class="stl_10 stl_11 stl_792" style="word-spacing:-0.2837em;">&nbsp;5</span><span class="stl_10 stl_11 stl_792" style="word-spacing:-0.2837em;">&nbsp;6</span><span class="stl_10 stl_11 stl_792" style="word-spacing:-0.2837em;">&nbsp;]</span><span class="stl_10 stl_11 stl_792" style="word-spacing:-0.2837em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">子</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;程 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:10.4132em;"><span class="stl_58 stl_59 stl_497" style="word-spacing:0.3151em;">* Child */ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">关</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;闭</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;监</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;听 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:10.0142em;"><span class="stl_10 stl_11 stl_889" style="word-spacing:-0.258em;">closeListeningSockets (0) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">设</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;程</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6694em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6694em;">t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.032em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.031em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.031em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.031em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:10.0117em;"><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3078em;">redisSetProcTitle ( ” redis </span><span class="stl_107 stl_108 stl_100" style="word-spacing:-0.3078em;">−</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3078em;">aof</span><span class="stl_107 stl_108 stl_100" style="word-spacing:-0.3078em;">−</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3078em;">rewrite ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">临</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;文</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;名 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:10.0175em;z-index:665; "><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2586em;">s n</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2586em;">&nbsp;p</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2576em;">&nbsp;r</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2586em;">&nbsp;i</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2576em;">&nbsp;n</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2576em;">&nbsp;t</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2586em;">&nbsp;f</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1526em;">&nbsp;(</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1806em;">&nbsp;tmpfile</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.0276em;">&nbsp;,256</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1406em;">&nbsp;,</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2116em;">&nbsp;”temp</span><span class="stl_107 stl_108 stl_338" style="word-spacing:-0.2116em;">−</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2116em;">rewriteaof</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2272em;">&nbsp;</span><span class="stl_107 stl_108 stl_338" style="word-spacing:-0.2116em;">−</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2272em;">bg</span><span class="stl_107 stl_108 stl_338" style="word-spacing:-0.2272em;">−</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2272em;">%d</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2286em;">&nbsp;.</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1266em;">&nbsp;aof</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2226em;">&nbsp;”</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1316em;">&nbsp;,</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1316em;">&nbsp;( &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5868em; left:11.6333em;"><span class="stl_15 stl_16 stl_276">int</span><span class="stl_15 stl_16 stl_276" style="word-spacing:-0.2863em;">&nbsp;</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.2863em;">)</span><span class="stl_10 stl_11 stl_276" style="word-spacing:0.339em;">&nbsp;getpid</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.225em;">&nbsp;()</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.245em;">&nbsp;)</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.245em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">脏 数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;据，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;其</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;实</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;就</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;子</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;程</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;所</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;消</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;耗</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;内</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;大</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:10.0375em;"><span class="stl_15 stl_16 stl_929" style="word-spacing:-0.2114em;">i f</span><span class="stl_15 stl_16 stl_929" style="word-spacing:0.495em;">&nbsp;</span><span class="stl_10 stl_11 stl_929" style="word-spacing:0.495em;">(</span><span class="stl_10 stl_11 stl_929" style="word-spacing:-0.1764em;">&nbsp;rewriteAppendOnlyFile</span><span class="stl_10 stl_11 stl_929" style="word-spacing:-0.1754em;">&nbsp;(</span><span class="stl_10 stl_11 stl_929" style="word-spacing:-0.1424em;">&nbsp;tmpfile</span><span class="stl_10 stl_11 stl_929" style="word-spacing:-0.1424em;">&nbsp;)</span><span class="stl_10 stl_11 stl_929" style="word-spacing:0.1996em;">&nbsp;==</span><span class="stl_10 stl_11 stl_929" style="word-spacing:0.0256em;">&nbsp;REDIS_OK)</span><span class="stl_10 stl_11 stl_929" style="word-spacing:0.0256em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">获</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;脏</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:11.99em;"><span class="stl_10 stl_11 stl_693" style="word-spacing:0.3705em;">size_t private_dirty</span><span class="stl_10 stl_11 stl_693" style="word-spacing:0.1525em;">&nbsp;=</span><span class="stl_10 stl_11 stl_693" style="word-spacing:0.1345em;">&nbsp;zmalloc_get_private_dirty &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:14.1em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.051em;">) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5702em; left:13.66em;"><span class="stl_10 stl_11 stl_07">(</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">104 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;录</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;脏</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:12.03em;"><span class="stl_15 stl_16 stl_892" style="word-spacing:-0.334em;">i f</span><span class="stl_15 stl_16 stl_892" style="word-spacing:0.3724em;">&nbsp;</span><span class="stl_10 stl_11 stl_892" style="word-spacing:0.3724em;">(</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.275em;">&nbsp;private_dirty</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.274em;">&nbsp;)</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.274em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:13.9783em;"><span class="stl_10 stl_11 stl_98" style="word-spacing:-0.0678em;">redisLog (REDIS_NOTICE, &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:15.9217em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 8.7076em; left:16.2878em;"><span class="stl_10 stl_11 stl_608" style="word-spacing:-0.1256em;">AOF␣ rewrite : ␣%zu␣MB␣ of ␣memory␣used␣by␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:17.58em;z-index:115; "><span class="stl_10 stl_11 stl_930" style="word-spacing:-0.1382em;">copy</span><span class="stl_107 stl_108 stl_930" style="word-spacing:-0.1382em;">−</span><span class="stl_10 stl_11 stl_930" style="word-spacing:-0.1382em;">on</span><span class="stl_107 stl_108 stl_930" style="word-spacing:-0.1382em;">−</span><span class="stl_10 stl_11 stl_930" style="word-spacing:-0.1382em;">write ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:15.9758em;"><span class="stl_10 stl_11 stl_894" style="word-spacing:-0.2503em;">private_dirty /(1024*1024) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 12.6927em; left:11.9658em;"><span class="stl_10 stl_11 stl_463" style="word-spacing:-0.1974em;">exitFromChild (0) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:11.9658em;"><span class="stl_10 stl_11 stl_463" style="word-spacing:-0.1974em;">exitFromChild (1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6818em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 16.6785em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 16.6735em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:10.4132em;"><span class="stl_58 stl_59 stl_570" style="word-spacing:0.329em;">* Parent */ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:10.01em;"><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.1628em;">server .</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2028em;">&nbsp;stat_fork_time</span><span class="stl_10 stl_11 stl_895" style="word-spacing:0.1457em;">&nbsp;= ustime</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2258em;">&nbsp;()</span><span class="stl_107 stl_108 stl_895" style="word-spacing:-0.2258em;">−</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2258em;">s</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3118em;">&nbsp;t</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3118em;">&nbsp;a</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3118em;">&nbsp;r</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3118em;">&nbsp;t</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3118em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:10.0375em;z-index:258; "><span class="stl_15 stl_16 stl_737" style="word-spacing:-0.2632em;">i f</span><span class="stl_15 stl_16 stl_737" style="word-spacing:0.4432em;">&nbsp;</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.4432em;">(</span><span class="stl_10 stl_11 stl_737" style="word-spacing:-0.1902em;">&nbsp;childpid</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.1868em;">&nbsp;==</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.0945em;">&nbsp;</span><span class="stl_107 stl_108 stl_737" style="word-spacing:0.1868em;">−</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.0945em;">1)</span><span class="stl_10 stl_11 stl_737" style="word-spacing:0.0945em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:11.9858em;"><span class="stl_10 stl_11 stl_34" style="word-spacing:-0.0137em;">redisLog (REDIS_WARNING, &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:13.9292em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 21.6593em; left:14.3783em;"><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.2359em;">Can ’ t ␣ rewrite ␣append␣ only ␣ f i l e ␣ in ␣background &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:15.67em;"><span class="stl_10 stl_11 stl_494" style="word-spacing:-0.1561em;">: ␣ fork : ␣%s ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:14.0142em;"><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.2909em;">s t r e r r o r ( errno ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:11.9308em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.9933em;"><span class="stl_10 stl_11 stl_98" style="word-spacing:-0.0678em;">redisLog (REDIS_NOTICE, &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:12.4381em;"><span class="stl_10 stl_11 stl_556" style="word-spacing:-0.25em;">Background␣append␣ only ␣ f i l e ␣ rewriting ␣ started ␣by &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:14.1263em;"><span class="stl_10 stl_11 stl_932" style="word-spacing:-0.2002em;">pid ␣%d” , childpid ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:10.4132em;"><span class="stl_58 stl_59 stl_933" style="word-spacing:0.4092em;">/ AOF</span><span class="stl_58 stl_59 stl_933" style="word-spacing:0.4499em;">&nbsp;</span><span class="stl_17 stl_18 stl_933" style="word-spacing:0.4499em;">已</span><span class="stl_17 stl_18 stl_933" style="word-spacing:0.0409em;">&nbsp;经 开 始 执</span><span class="stl_17 stl_18 stl_933" style="word-spacing:0.0747em;">&nbsp;行， 取</span><span class="stl_17 stl_18 stl_933" style="word-spacing:0.0412em;">&nbsp;消</span><span class="stl_17 stl_18 stl_933" style="word-spacing:0.4507em;">&nbsp;</span><span class="stl_58 stl_59 stl_933" style="word-spacing:0.4507em;">AOF</span><span class="stl_58 stl_59 stl_933" style="word-spacing:0.4498em;">&nbsp;</span><span class="stl_17 stl_18 stl_933" style="word-spacing:0.4498em;">计</span><span class="stl_17 stl_18 stl_933" style="word-spacing:0.4498em;">&nbsp;划 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:10.01em;"><span class="stl_10 stl_11 stl_791" style="word-spacing:-0.1862em;">server .</span><span class="stl_10 stl_11 stl_791" style="word-spacing:-0.2162em;">&nbsp;aof_rewrite_scheduled</span><span class="stl_10 stl_11 stl_791" style="word-spacing:0.1338em;">&nbsp;=</span><span class="stl_10 stl_11 stl_791" style="word-spacing:0.1608em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:11.9367em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 28.6335em; left:13.585em;"><span class="stl_10 stl_11 stl_07">␣</span></div>
					<div class="stl_01" style="top: 29.631em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:10.4132em;"><span class="stl_58 stl_59 stl_934" style="word-spacing:0.498em;">/ AOF</span><span class="stl_58 stl_59 stl_934" style="word-spacing:0.5387em;">&nbsp;</span><span class="stl_17 stl_18 stl_934" style="word-spacing:0.5387em;">最</span><span class="stl_17 stl_18 stl_934" style="word-spacing:0.1299em;">&nbsp;近 一 次 执 行 的 起 始 时</span><span class="stl_17 stl_18 stl_934" style="word-spacing:0.1299em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:10.01em;"><span class="stl_10 stl_11 stl_935" style="word-spacing:-0.1335em;">server .</span><span class="stl_10 stl_11 stl_935" style="word-spacing:-0.1655em;">&nbsp;aof_rewrite_time_start</span><span class="stl_10 stl_11 stl_935" style="word-spacing:0.1845em;">&nbsp;=</span><span class="stl_10 stl_11 stl_935" style="word-spacing:-0.0789em;">&nbsp;time (NULL)</span><span class="stl_10 stl_11 stl_935" style="word-spacing:-0.0789em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:10.4132em;"><span class="stl_58 stl_59 stl_898">/</span><span class="stl_58 stl_59 stl_898" style="word-spacing:0.4718em;">&nbsp;</span><span class="stl_17 stl_18 stl_898" style="word-spacing:0.4718em;">子</span><span class="stl_17 stl_18 stl_898" style="word-spacing:-0.089em;">&nbsp;进</span><span class="stl_17 stl_18 stl_898" style="word-spacing:-0.088em;">&nbsp;程</span><span class="stl_17 stl_18 stl_898" style="word-spacing:0.4322em;">&nbsp;</span><span class="stl_58 stl_59 stl_898" style="word-spacing:0.4322em;">ID &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:10.01em;"><span class="stl_10 stl_11 stl_936" style="word-spacing:-0.1956em;">server .</span><span class="stl_10 stl_11 stl_936" style="word-spacing:-0.2336em;">&nbsp;aof_child_pid</span><span class="stl_10 stl_11 stl_936" style="word-spacing:0.1174em;">&nbsp;=</span><span class="stl_10 stl_11 stl_936" style="word-spacing:-0.0206em;">&nbsp;childpid</span><span class="stl_10 stl_11 stl_936" style="word-spacing:-0.0206em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:9.9942em;"><span class="stl_10 stl_11 stl_420" style="word-spacing:-0.2174em;">updateDictResizePolicy () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">因 为</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;更</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;都</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;将</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;写</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;文</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;件，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;要</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;强</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;制</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;产</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;生</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;选</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;择</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;集</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;指 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:11.6342em;"><span class="stl_17 stl_18 stl_937">令</span><span class="stl_17 stl_18 stl_937" style="word-spacing:0.4411em;">&nbsp;</span><span class="stl_58 stl_59 stl_937" style="word-spacing:0.4411em;">SELECT</span><span class="stl_58 stl_59 stl_937" style="word-spacing:0.4411em;">&nbsp;</span><span class="stl_17 stl_18 stl_937" style="word-spacing:0.4411em;">，</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.006em;">&nbsp;以</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.005em;">&nbsp;防</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.005em;">&nbsp;出</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.005em;">&nbsp;现</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.005em;">&nbsp;数</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.005em;">&nbsp;据</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.005em;">&nbsp;合</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.005em;">&nbsp;并</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.005em;">&nbsp;错</span><span class="stl_17 stl_18 stl_937" style="word-spacing:0.028em;">&nbsp;误。 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:10.4132em;"><span class="stl_58 stl_59 stl_662" style="word-spacing:0.1042em;">* We</span><span class="stl_58 stl_59 stl_662" style="word-spacing:-0.0623em;">&nbsp;s et</span><span class="stl_58 stl_59 stl_662" style="word-spacing:0.3857em;">&nbsp;appendseldb to</span><span class="stl_58 stl_59 stl_662" style="word-spacing:0.2127em;">&nbsp;</span><span class="stl_107 stl_108 stl_662" style="word-spacing:0.3857em;">−</span><span class="stl_58 stl_59 stl_662" style="word-spacing:0.2127em;">1 in</span><span class="stl_58 stl_59 stl_662" style="word-spacing:0.3587em;">&nbsp;order to</span><span class="stl_58 stl_59 stl_662" style="word-spacing:0.3927em;">&nbsp;force</span><span class="stl_58 stl_59 stl_662" style="word-spacing:0.3927em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:11.6475em;"><span class="stl_58 stl_59 stl_931" style="word-spacing:0.4113em;">next c</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3057em;">&nbsp;a</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3047em;">&nbsp;l</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3057em;">&nbsp;l</span><span class="stl_58 stl_59 stl_931" style="word-spacing:0.4133em;">&nbsp;to</span><span class="stl_58 stl_59 stl_931" style="word-spacing:0.3553em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 45.5718em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 43.5793em; left:11.4728em;"><span class="stl_58 stl_59 stl_938" style="word-spacing:-0.1624em;">feedAppendOnlyFile ()</span><span class="stl_58 stl_59 stl_938" style="word-spacing:0.4601em;">&nbsp;to issue</span><span class="stl_58 stl_59 stl_938" style="word-spacing:0.3956em;">&nbsp;a</span><span class="stl_58 stl_59 stl_938" style="word-spacing:0.1946em;">&nbsp;SELECT</span><span class="stl_58 stl_59 stl_938" style="word-spacing:0.1506em;">&nbsp;command,</span><span class="stl_58 stl_59 stl_938" style="word-spacing:0.4446em;">&nbsp;so &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:12.6508em;"><span class="stl_58 stl_59 stl_939" style="word-spacing:0.387em;">the d</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;i</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.336em;">&nbsp;f</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;f</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;e</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;r</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.336em;">&nbsp;e</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;n</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;c</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;e</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:11.4678em;"><span class="stl_58 stl_59 stl_451" style="word-spacing:0.3157em;">accumulated by the</span><span class="stl_58 stl_59 stl_451" style="word-spacing:0.3642em;">&nbsp;parent into</span><span class="stl_58 stl_59 stl_451" style="word-spacing:0.3942em;">&nbsp;server</span><span class="stl_58 stl_59 stl_451" style="word-spacing:0.3942em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:12.1433em;"><span class="stl_58 stl_59 stl_922" style="word-spacing:0.4203em;">aof_rewrite_buf w</span><span class="stl_58 stl_59 stl_922" style="word-spacing:-0.2937em;">&nbsp;i</span><span class="stl_58 stl_59 stl_922" style="word-spacing:-0.2937em;">&nbsp;l</span><span class="stl_58 stl_59 stl_922" style="word-spacing:-0.2927em;">&nbsp;l</span><span class="stl_58 stl_59 stl_922" style="word-spacing:0.4723em;">&nbsp;s</span><span class="stl_58 stl_59 stl_922" style="word-spacing:-0.3107em;">&nbsp;t</span><span class="stl_58 stl_59 stl_922" style="word-spacing:-0.3117em;">&nbsp;a</span><span class="stl_58 stl_59 stl_922" style="word-spacing:-0.3107em;">&nbsp;r</span><span class="stl_58 stl_59 stl_922" style="word-spacing:-0.3107em;">&nbsp;t &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_49" style="word-spacing:0.5305em;">13.3. AOF</span><span class="stl_21 stl_11 stl_49" style="word-spacing:0.0872em;">&nbsp;</span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0872em;">持久化运作机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">105 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:11.4819em;"><span class="stl_58 stl_59 stl_291" style="word-spacing:0.3561em;">with a</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.1861em;">&nbsp;SELECT</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.2581em;">&nbsp;statement</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.3671em;">&nbsp;and</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.4361em;">&nbsp;i</span><span class="stl_58 stl_59 stl_291" style="word-spacing:-0.2179em;">&nbsp;t</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.5651em;">&nbsp;w</span><span class="stl_58 stl_59 stl_291" style="word-spacing:-0.2209em;">&nbsp;i</span><span class="stl_58 stl_59 stl_291" style="word-spacing:-0.2219em;">&nbsp;l</span><span class="stl_58 stl_59 stl_291" style="word-spacing:-0.2209em;">&nbsp;l</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.4528em;">&nbsp;be safe</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.4528em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:12.1017em;"><span class="stl_58 stl_59 stl_437" style="word-spacing:-0.1648em;">merge .</span><span class="stl_58 stl_59 stl_437" style="word-spacing:0.4312em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:10.01em;"><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.1635em;">server .</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2025em;">&nbsp;aof_selected_db</span><span class="stl_10 stl_11 stl_447" style="word-spacing:0.1485em;">&nbsp;=</span><span class="stl_10 stl_11 stl_447" style="word-spacing:0.1398em;">&nbsp;</span><span class="stl_107 stl_108 stl_447" style="word-spacing:0.1485em;">−</span><span class="stl_10 stl_11 stl_447" style="word-spacing:0.1398em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:10.005em;"><span class="stl_10 stl_11 stl_863" style="word-spacing:-0.2359em;">replicationScriptCacheFlush () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:9.9383em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 12.6877em; left:7.9458em;"><span class="stl_15 stl_16 stl_489">return</span><span class="stl_15 stl_16 stl_489" style="word-spacing:0.2705em;">&nbsp;</span><span class="stl_10 stl_11 stl_489" style="word-spacing:0.2705em;">REDIS_OK;</span><span class="stl_10 stl_11 stl_489" style="word-spacing:0.5011em;">&nbsp;</span><span class="stl_58 stl_59 stl_489" style="word-spacing:0.5011em;">/*</span><span class="stl_58 stl_59 stl_489" style="word-spacing:0.4364em;">&nbsp;unreached</span><span class="stl_58 stl_59 stl_489" style="word-spacing:0.4364em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6835em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:6.4282em;"><span class="stl_58 stl_59 stl_233" style="word-spacing:0.1285em;">/ AOF</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.0714em;">&nbsp;</span><span class="stl_17 stl_18 stl_233" style="word-spacing:-0.0714em;">持 久</span><span class="stl_17 stl_18 stl_233" style="word-spacing:-0.2395em;">&nbsp;化</span><span class="stl_17 stl_18 stl_233" style="word-spacing:-0.2395em;">&nbsp;主</span><span class="stl_17 stl_18 stl_233" style="word-spacing:-0.2395em;">&nbsp;函</span><span class="stl_17 stl_18 stl_233" style="word-spacing:-0.2065em;">&nbsp;数。</span><span class="stl_17 stl_18 stl_233" style="word-spacing:-0.2065em;">&nbsp;只</span><span class="stl_17 stl_18 stl_233" style="word-spacing:-0.2395em;">&nbsp;在</span><span class="stl_17 stl_18 stl_233" style="word-spacing:0.3657em;">&nbsp;</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.3657em;">rewriteAppendOnlyFileBackground</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2075em;">&nbsp;() &nbsp;</span></div>
					<div class="stl_01" style="top: 16.9007em; left:7.6492em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">中 会 调 用 此 函 数 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:6.4282em;"><span class="stl_58 stl_59 stl_940" style="word-spacing:0.3157em;">* Write a sequence</span><span class="stl_58 stl_59 stl_940" style="word-spacing:0.4133em;">&nbsp;of</span><span class="stl_58 stl_59 stl_940" style="word-spacing:0.3333em;">&nbsp;commands able</span><span class="stl_58 stl_59 stl_940" style="word-spacing:0.4373em;">&nbsp;to</span><span class="stl_58 stl_59 stl_940" style="word-spacing:0.4883em;">&nbsp;f</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2307em;">&nbsp;u</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2307em;">&nbsp;l</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2307em;">&nbsp;l</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2307em;">&nbsp;y</span><span class="stl_58 stl_59 stl_940" style="word-spacing:0.5253em;">&nbsp;r</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2677em;">&nbsp;e</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2677em;">&nbsp;b</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2677em;">&nbsp;u</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2677em;">&nbsp;i</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2677em;">&nbsp;l</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2687em;">&nbsp;d</span><span class="stl_58 stl_59 stl_940" style="word-spacing:0.4573em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.6833em;"><span class="stl_58 stl_59 stl_941" style="word-spacing:0.3493em;">dataset into &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:6.9471em;"><span class="stl_58 stl_59 stl_942" style="word-spacing:-0.0568em;">” filename</span><span class="stl_58 stl_59 stl_942" style="word-spacing:0.0222em;">&nbsp;”.</span><span class="stl_58 stl_59 stl_942" style="word-spacing:0.5518em;">&nbsp;Used both by</span><span class="stl_58 stl_59 stl_942" style="word-spacing:0.3282em;">&nbsp;REWRITEAOF and</span><span class="stl_58 stl_59 stl_942" style="word-spacing:0.3282em;">&nbsp;BGREWRITEAOF. &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 20.6651em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 21.661em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 21.661em; left:6.9712em;"><span class="stl_58 stl_59 stl_798" style="word-spacing:0.4029em;">In order to minimize the</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.3568em;">&nbsp;number of commands</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.3034em;">&nbsp;needed</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.4089em;">&nbsp;in</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.4089em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.6858em;"><span class="stl_58 stl_59 stl_694">rewritten &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 25.646em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 27.6385em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 28.6285em; left:5.9875em;"><span class="stl_15 stl_16 stl_943">int</span><span class="stl_15 stl_16 stl_943" style="word-spacing:0.3431em;">&nbsp;</span><span class="stl_10 stl_11 stl_943" style="word-spacing:0.3431em;">rewriteAppendOnlyFile</span><span class="stl_10 stl_11 stl_943" style="word-spacing:0.3431em;">&nbsp;(</span><span class="stl_15 stl_16 stl_943" style="word-spacing:-0.2508em;">char</span><span class="stl_15 stl_16 stl_943" style="word-spacing:-0.0505em;">&nbsp;</span><span class="stl_10 stl_11 stl_943" style="word-spacing:-0.0505em;">* filename</span><span class="stl_10 stl_11 stl_943" style="word-spacing:-0.2278em;">&nbsp;)</span><span class="stl_10 stl_11 stl_943" style="word-spacing:-0.2278em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:8.0367em;"><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0852em;">d i</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0852em;">&nbsp;c</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;t</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;I</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0852em;">&nbsp;t</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;e</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;r</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0852em;">&nbsp;a</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;t</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0852em;">&nbsp;o</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0842em;">&nbsp;r</span><span class="stl_10 stl_11 stl_849" style="word-spacing:0.5658em;">&nbsp;*</span><span class="stl_10 stl_11 stl_849" style="word-spacing:-0.0792em;">&nbsp;di</span><span class="stl_10 stl_11 stl_849" style="word-spacing:0.3818em;">&nbsp;=</span><span class="stl_10 stl_11 stl_849" style="word-spacing:0.1898em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:7.9967em;"><span class="stl_10 stl_11 stl_606" style="word-spacing:0.2926em;">dictEntry *de</span><span class="stl_10 stl_11 stl_606" style="word-spacing:0.2926em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.0202em;"><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3747em;">log Redis uses</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.4107em;">&nbsp;variadic</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3157em;">&nbsp;commands</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.2107em;">&nbsp;when</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3357em;">&nbsp;possible</span><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.0103em;">&nbsp;,</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3907em;">&nbsp;such</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.3377em;">&nbsp;as &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.5117em;"><span class="stl_58 stl_59 stl_861" style="word-spacing:0.537em;">RPUSH, SADD &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:6.9463em;"><span class="stl_58 stl_59 stl_944" style="word-spacing:0.4196em;">and ZADD.</span><span class="stl_58 stl_59 stl_944" style="word-spacing:0.6511em;">&nbsp;However at</span><span class="stl_58 stl_59 stl_944" style="word-spacing:0.5796em;">&nbsp;max</span><span class="stl_58 stl_59 stl_944" style="word-spacing:0.3676em;">&nbsp;REDIS_AOF_REWRITE_ITEMS_PER_CMD &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:7.6592em;"><span class="stl_58 stl_59 stl_674" style="word-spacing:0.3464em;">items per time &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:6.9861em;"><span class="stl_58 stl_59 stl_507" style="word-spacing:0.4258em;">are inserted using</span><span class="stl_58 stl_59 stl_507" style="word-spacing:0.3313em;">&nbsp;a</span><span class="stl_58 stl_59 stl_507" style="word-spacing:0.3733em;">&nbsp;s</span><span class="stl_58 stl_59 stl_507" style="word-spacing:-0.2707em;">&nbsp;i</span><span class="stl_58 stl_59 stl_507" style="word-spacing:-0.2717em;">&nbsp;n</span><span class="stl_58 stl_59 stl_507" style="word-spacing:-0.2707em;">&nbsp;g</span><span class="stl_58 stl_59 stl_507" style="word-spacing:-0.2707em;">&nbsp;l</span><span class="stl_58 stl_59 stl_507" style="word-spacing:-0.2717em;">&nbsp;e</span><span class="stl_58 stl_59 stl_507" style="word-spacing:0.3303em;">&nbsp;command.</span><span class="stl_58 stl_59 stl_507" style="word-spacing:0.3713em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:8.0292em;"><span class="stl_10 stl_11 stl_454" style="word-spacing:-0.34em;">r i</span><span class="stl_10 stl_11 stl_454" style="word-spacing:-0.34em;">&nbsp;o</span><span class="stl_10 stl_11 stl_454" style="word-spacing:0.384em;">&nbsp;aof</span><span class="stl_10 stl_11 stl_454" style="word-spacing:0.384em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:7.9117em;"><span class="stl_10 stl_11 stl_945" style="word-spacing:0.3365em;">FILE *</span><span class="stl_10 stl_11 stl_945" style="word-spacing:-0.1665em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_945" style="word-spacing:-0.1665em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:7.9342em;"><span class="stl_15 stl_16 stl_850">char</span><span class="stl_15 stl_16 stl_850" style="word-spacing:0.3176em;">&nbsp;</span><span class="stl_10 stl_11 stl_850" style="word-spacing:0.3176em;">tmpfile</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.1449em;">&nbsp;[</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.2839em;">&nbsp;2</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.2839em;">&nbsp;5</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.2839em;">&nbsp;6</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.2839em;">&nbsp;]</span><span class="stl_10 stl_11 stl_850" style="word-spacing:-0.2839em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.3991em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">j</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:7.9467em;"><span class="stl_15 stl_16 stl_852" style="word-spacing:0.3506em;">long long</span><span class="stl_15 stl_16 stl_852" style="word-spacing:0.2986em;">&nbsp;</span><span class="stl_10 stl_11 stl_852" style="word-spacing:0.2986em;">now</span><span class="stl_10 stl_11 stl_852" style="word-spacing:0.1516em;">&nbsp;=</span><span class="stl_10 stl_11 stl_852" style="word-spacing:0.2066em;">&nbsp;mstime</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.1634em;">&nbsp;()</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.1634em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:8.4207em;"><span class="stl_58 stl_59 stl_204" style="word-spacing:0.3181em;">* Note</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.4021em;">&nbsp;that</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.3561em;">&nbsp;we</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.3051em;">&nbsp;have</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.4026em;">&nbsp;to use</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.3311em;">&nbsp;a</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.4051em;">&nbsp;d</span><span class="stl_58 stl_59 stl_204" style="word-spacing:-0.2379em;">&nbsp;i</span><span class="stl_58 stl_59 stl_204" style="word-spacing:-0.2389em;">&nbsp;f</span><span class="stl_58 stl_59 stl_204" style="word-spacing:-0.2389em;">&nbsp;f</span><span class="stl_58 stl_59 stl_204" style="word-spacing:-0.2389em;">&nbsp;e</span><span class="stl_58 stl_59 stl_204" style="word-spacing:-0.2389em;">&nbsp;r</span><span class="stl_58 stl_59 stl_204" style="word-spacing:-0.2379em;">&nbsp;e</span><span class="stl_58 stl_59 stl_204" style="word-spacing:-0.2389em;">&nbsp;n</span><span class="stl_58 stl_59 stl_204" style="word-spacing:-0.2389em;">&nbsp;t</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.4171em;">&nbsp;temp</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.2541em;">&nbsp;name</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.3071em;">&nbsp;here &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:9.6133em;"><span class="stl_58 stl_59 stl_239" style="word-spacing:0.37em;">compared to</span><span class="stl_58 stl_59 stl_239" style="word-spacing:0.427em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.4479em;"><span class="stl_58 stl_59 stl_850" style="word-spacing:0.3136em;">one used by rewriteAppendOnlyFileBackground</span><span class="stl_58 stl_59 stl_850" style="word-spacing:-0.2328em;">&nbsp;()</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.3982em;">&nbsp;function &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:10.1783em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:0.435em;">. */ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5793em; left:8.025em;z-index:821; "><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2853em;">s n</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2853em;">&nbsp;p</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2843em;">&nbsp;r</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2853em;">&nbsp;i</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2843em;">&nbsp;n</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2843em;">&nbsp;t</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2853em;">&nbsp;f</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.1793em;">&nbsp;(</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2073em;">&nbsp;tmpfile</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.0543em;">&nbsp;,256</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.1673em;">&nbsp;,</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2383em;">&nbsp;”temp</span><span class="stl_107 stl_108 stl_117" style="word-spacing:-0.2383em;">−</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2383em;">rewriteaof</span><span class="stl_107 stl_108 stl_117" style="word-spacing:-0.2383em;">−</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2383em;">%d</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2553em;">&nbsp;.</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.1533em;">&nbsp;aof</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2493em;">&nbsp;”</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.1593em;">&nbsp;,</span><span class="stl_10 stl_11 stl_117" style="word-spacing:0.3757em;">&nbsp;(</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2323em;">&nbsp;</span><span class="stl_15 stl_16 stl_117" style="word-spacing:-0.2323em;">int</span><span class="stl_15 stl_16 stl_117" style="word-spacing:-0.2326em;">&nbsp;</span><span class="stl_10 stl_11 stl_117" style="word-spacing:-0.2323em;">) &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:9.6625em;"><span class="stl_10 stl_11 stl_946" style="word-spacing:-0.2463em;">getpid () ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">打</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;开</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;文</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:7.9917em;"><span class="stl_10 stl_11 stl_855" style="word-spacing:0.1725em;">fp = fopen</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.236em;">&nbsp;(</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.218em;">&nbsp;tmpfile</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.039em;">&nbsp;,</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.223em;">&nbsp;”w”</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.279em;">&nbsp;)</span><span class="stl_10 stl_11 stl_855" style="word-spacing:-0.279em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.561em; left:8.045em;"><span class="stl_15 stl_16 stl_123" style="word-spacing:-0.3em;">i f</span><span class="stl_15 stl_16 stl_123" style="word-spacing:0.4787em;">&nbsp;</span><span class="stl_10 stl_11 stl_123" style="word-spacing:0.4787em;">(</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.299em;">&nbsp;!</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.186em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.258em;">&nbsp;)</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.258em;">&nbsp;{ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">106 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:9.9933em;"><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.086em;">redisLog (REDIS_WARNING,</span><span class="stl_10 stl_11 stl_114" style="word-spacing:0.509em;">&nbsp;”Opening␣</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.162em;">&nbsp;the</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.162em;">&nbsp;␣temp␣</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.046em;">&nbsp;f</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.096em;">&nbsp;i</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.097em;">&nbsp;l</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.096em;">&nbsp;e</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.046em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.114em;">&nbsp;fo</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.164em;">&nbsp;r</span><span class="stl_10 stl_11 stl_114" style="word-spacing:-0.164em;">&nbsp;␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:11.4717em;"><span class="stl_10 stl_11 stl_947" style="word-spacing:-0.2183em;">AOF␣ rewrite ␣ in ␣ rewriteAppendOnlyFile () : ␣%s ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:11.69em;"><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.291em;">s t r e r r o r ( errno ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:9.9383em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 11.6985em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.4207em;"><span class="stl_58 stl_59 stl_948">/</span><span class="stl_58 stl_59 stl_948" style="word-spacing:-0.0992em;">&nbsp;</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.0992em;">初 始</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.329em;">&nbsp;化</span><span class="stl_17 stl_18 stl_948" style="word-spacing:0.3117em;">&nbsp;</span><span class="stl_58 stl_59 stl_948" style="word-spacing:0.3117em;">rio</span><span class="stl_58 stl_59 stl_948" style="word-spacing:-0.0173em;">&nbsp;</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.0173em;">结 构</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.0173em;">&nbsp;体 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:8.02em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.2559em;">rioInitWithFile (&amp;aof , fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">如 果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;设</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;置</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;了</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;自</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;动</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;备</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;份</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;参</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;将</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;设</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;置 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:8.045em;"><span class="stl_15 stl_16 stl_668" style="word-spacing:-0.3122em;">i f</span><span class="stl_15 stl_16 stl_668" style="word-spacing:0.3942em;">&nbsp;</span><span class="stl_10 stl_11 stl_668" style="word-spacing:0.3942em;">(</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.2392em;">&nbsp;server</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.1832em;">&nbsp;.</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.2122em;">&nbsp;aof_rewrite_incremental_fsync</span><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.2122em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:9.9767em;"><span class="stl_10 stl_11 stl_949" style="word-spacing:0.1216em;">rioSetAutoSync(&amp;aof ,REDIS_AOF_AUTOSYNC_BYTES)</span><span class="stl_10 stl_11 stl_949" style="word-spacing:0.1216em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">备</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;份</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;每</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;集 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:7.9808em;"><span class="stl_15 stl_16 stl_379">for</span><span class="stl_15 stl_16 stl_379" style="word-spacing:0.4146em;">&nbsp;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.4146em;">(</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.1393em;">&nbsp;j</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.2637em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.4967em;">&nbsp;j</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.2367em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.2937em;">&nbsp;server</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.0863em;">&nbsp;.</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.2403em;">&nbsp;dbnum</span><span class="stl_10 stl_11 stl_379" style="word-spacing:-0.2403em;">&nbsp;;</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.5167em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_379" style="word-spacing:0.5167em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:9.9267em;"><span class="stl_15 stl_16 stl_852">char</span><span class="stl_15 stl_16 stl_852" style="word-spacing:0.3959em;">&nbsp;</span><span class="stl_10 stl_11 stl_852" style="word-spacing:0.3959em;">selectcmd</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.0334em;">&nbsp;[</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.1504em;">&nbsp;]</span><span class="stl_10 stl_11 stl_852" style="word-spacing:0.3606em;">&nbsp;=</span><span class="stl_10 stl_11 stl_852" style="word-spacing:0.2096em;">&nbsp;”*2\</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.1864em;">&nbsp;r</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.2114em;">&nbsp;\n$6\</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.2114em;">&nbsp;r</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.2114em;">&nbsp;\nSELECT\</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.2114em;">&nbsp;r</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.2114em;">&nbsp;\n”</span><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.2114em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:9.975em;"><span class="stl_10 stl_11 stl_760" style="word-spacing:0.3186em;">redisDb *db</span><span class="stl_10 stl_11 stl_760" style="word-spacing:0.1066em;">&nbsp;=</span><span class="stl_10 stl_11 stl_760" style="word-spacing:0.2216em;">&nbsp;server</span><span class="stl_10 stl_11 stl_760" style="word-spacing:-0.1284em;">&nbsp;.</span><span class="stl_10 stl_11 stl_760" style="word-spacing:-0.2434em;">&nbsp;db+j</span><span class="stl_10 stl_11 stl_760" style="word-spacing:-0.2434em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:10.0125em;z-index:402; "><span class="stl_10 stl_11 stl_864" style="word-spacing:0.4001em;">dict *d</span><span class="stl_10 stl_11 stl_864" style="word-spacing:0.1361em;">&nbsp;= db</span><span class="stl_107 stl_108 stl_864" style="word-spacing:0.1361em;">−</span><span class="stl_10 stl_11 stl_864" style="word-spacing:0.1361em;">&gt;dict</span><span class="stl_10 stl_11 stl_864" style="word-spacing:0.1361em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:10.0375em;"><span class="stl_15 stl_16 stl_395" style="word-spacing:-0.1891em;">i f</span><span class="stl_15 stl_16 stl_395" style="word-spacing:0.5173em;">&nbsp;</span><span class="stl_10 stl_11 stl_395" style="word-spacing:0.5173em;">(</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.1031em;">&nbsp;d</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2081em;">&nbsp;i</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2091em;">&nbsp;c</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2081em;">&nbsp;t</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2081em;">&nbsp;S</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2081em;">&nbsp;i</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2081em;">&nbsp;z</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.2091em;">&nbsp;e</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.1021em;">&nbsp;(d)</span><span class="stl_10 stl_11 stl_395" style="word-spacing:0.2204em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_395" style="word-spacing:0.3939em;">&nbsp;</span><span class="stl_15 stl_16 stl_395" style="word-spacing:0.3939em;">continue</span><span class="stl_15 stl_16 stl_395" style="word-spacing:-0.1479em;">&nbsp;</span><span class="stl_10 stl_11 stl_395" style="word-spacing:0.3939em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">获</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;集</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;迭</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;代</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;器 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.9917em;"><span class="stl_10 stl_11 stl_865" style="word-spacing:0.0949em;">di =</span><span class="stl_10 stl_11 stl_865" style="word-spacing:-0.1662em;">&nbsp;dictGetSafeIterator (d)</span><span class="stl_10 stl_11 stl_865" style="word-spacing:-0.1662em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:10.0375em;"><span class="stl_15 stl_16 stl_625" style="word-spacing:-0.318em;">i f</span><span class="stl_15 stl_16 stl_625" style="word-spacing:0.4607em;">&nbsp;</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.4607em;">(</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.317em;">&nbsp;!</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.194em;">&nbsp;di</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.267em;">&nbsp;)</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.267em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:12.0292em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2687em;">f c l o s e ( fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6243em; left:11.9308em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 32.6201em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:10.4132em;"><span class="stl_58 stl_59 stl_950">/</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.6908em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.6908em;">写</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.13em;">&nbsp;入</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5404em;">&nbsp;</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5404em;">AOF</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5406em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5406em;">操</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1305em;">&nbsp;作</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1305em;">&nbsp;码 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:10.4132em;"><span class="stl_58 stl_59 stl_663" style="word-spacing:0.3528em;">* SELECT</span><span class="stl_58 stl_59 stl_663" style="word-spacing:0.4168em;">&nbsp;the</span><span class="stl_58 stl_59 stl_663" style="word-spacing:0.5008em;">&nbsp;new</span><span class="stl_58 stl_59 stl_663" style="word-spacing:0.3048em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_663" style="word-spacing:0.3048em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:10.0375em;"><span class="stl_15 stl_16 stl_735" style="word-spacing:-0.2769em;">i f</span><span class="stl_15 stl_16 stl_735" style="word-spacing:0.4295em;">&nbsp;</span><span class="stl_10 stl_11 stl_735" style="word-spacing:0.4295em;">(</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2259em;">&nbsp;rioWrite(&amp;aof</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.0949em;">&nbsp;,</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.1849em;">&nbsp;selectcmd</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.0789em;">&nbsp;,</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.1684em;">&nbsp;</span><span class="stl_15 stl_16 stl_735" style="word-spacing:-0.1684em;">sizeof</span><span class="stl_15 stl_16 stl_735" style="word-spacing:-0.2237em;">&nbsp;</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2237em;">(</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2309em;">&nbsp;selectcmd</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2309em;">&nbsp;)</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2937em;">&nbsp;</span><span class="stl_107 stl_108 stl_735" style="word-spacing:-0.2309em;">−</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2937em;">1)</span><span class="stl_10 stl_11 stl_735" style="word-spacing:0.0551em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:11.6375em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 35.6018em; left:12.1381em;"><span class="stl_10 stl_11 stl_770">)</span><span class="stl_10 stl_11 stl_770" style="word-spacing:0.3641em;">&nbsp;</span><span class="stl_15 stl_16 stl_770" style="word-spacing:0.3641em;">goto</span><span class="stl_15 stl_16 stl_770" style="word-spacing:0.3509em;">&nbsp;</span><span class="stl_10 stl_11 stl_770" style="word-spacing:0.3509em;">werr</span><span class="stl_10 stl_11 stl_770" style="word-spacing:0.3509em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;集</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;序</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;号 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:10.0375em;"><span class="stl_15 stl_16 stl_418" style="word-spacing:-0.2302em;">i f</span><span class="stl_15 stl_16 stl_418" style="word-spacing:0.4761em;">&nbsp;</span><span class="stl_10 stl_11 stl_418" style="word-spacing:0.4761em;">(</span><span class="stl_10 stl_11 stl_418" style="word-spacing:-0.2123em;">&nbsp;rioWriteBulkLongLong(&amp;aof</span><span class="stl_10 stl_11 stl_418" style="word-spacing:-0.0483em;">&nbsp;,</span><span class="stl_10 stl_11 stl_418" style="word-spacing:-0.0982em;">&nbsp;j</span><span class="stl_10 stl_11 stl_418" style="word-spacing:-0.1532em;">&nbsp;)</span><span class="stl_10 stl_11 stl_418" style="word-spacing:0.1792em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_418" style="word-spacing:0.3424em;">&nbsp;</span><span class="stl_15 stl_16 stl_418" style="word-spacing:0.3424em;">goto</span><span class="stl_15 stl_16 stl_418" style="word-spacing:0.33em;">&nbsp;</span><span class="stl_10 stl_11 stl_418" style="word-spacing:0.33em;">werr</span><span class="stl_10 stl_11 stl_418" style="word-spacing:0.33em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5901em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;集</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;每</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;项 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:10.4132em;"><span class="stl_58 stl_59 stl_230" style="word-spacing:0.346em;">* I</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.313em;">&nbsp;t</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.313em;">&nbsp;e</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.312em;">&nbsp;r</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.313em;">&nbsp;a</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.313em;">&nbsp;t</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.313em;">&nbsp;e</span><span class="stl_58 stl_59 stl_230" style="word-spacing:0.455em;">&nbsp;t</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.306em;">&nbsp;h</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.307em;">&nbsp;i</span><span class="stl_58 stl_59 stl_230" style="word-spacing:-0.307em;">&nbsp;s</span><span class="stl_58 stl_59 stl_230" style="word-spacing:0.207em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_230" style="word-spacing:0.181em;">&nbsp;writing</span><span class="stl_58 stl_59 stl_230" style="word-spacing:0.3765em;">&nbsp;every entry</span><span class="stl_58 stl_59 stl_230" style="word-spacing:0.308em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:9.9408em;"><span class="stl_15 stl_16 stl_756">while</span><span class="stl_15 stl_16 stl_756" style="word-spacing:-0.1781em;">&nbsp;</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1781em;">((</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1735em;">&nbsp;de</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.1975em;">&nbsp;=</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.2435em;">&nbsp;dictNext</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1615em;">&nbsp;(</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1525em;">&nbsp;di</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1535em;">&nbsp;)</span><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1695em;">&nbsp;)</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.3735em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.1975em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_756" style="word-spacing:0.1975em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:11.9775em;"><span class="stl_10 stl_11 stl_272" style="word-spacing:0.342em;">sds keystr</span><span class="stl_10 stl_11 stl_272" style="word-spacing:0.342em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:11.9908em;"><span class="stl_10 stl_11 stl_951" style="word-spacing:0.3367em;">robj key</span><span class="stl_10 stl_11 stl_951" style="word-spacing:-0.1713em;">&nbsp;,</span><span class="stl_10 stl_11 stl_951" style="word-spacing:0.3587em;">&nbsp;*o</span><span class="stl_10 stl_11 stl_951" style="word-spacing:0.3587em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5652em; left:11.9317em;"><span class="stl_15 stl_16 stl_555" style="word-spacing:0.2662em;">long long</span><span class="stl_15 stl_16 stl_555" style="word-spacing:0.3367em;">&nbsp;</span><span class="stl_10 stl_11 stl_555" style="word-spacing:0.3367em;">expiretime</span><span class="stl_10 stl_11 stl_555" style="word-spacing:0.3367em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_49" style="word-spacing:0.5305em;">13.3. AOF</span><span class="stl_21 stl_11 stl_49" style="word-spacing:0.0872em;">&nbsp;</span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0872em;">持久化运作机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">107 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:11.9925em;"><span class="stl_10 stl_11 stl_499" style="word-spacing:0.1909em;">keystr =</span><span class="stl_10 stl_11 stl_499" style="word-spacing:-0.1123em;">&nbsp;dictGetKey (</span><span class="stl_10 stl_11 stl_499" style="word-spacing:-0.2791em;">&nbsp;de</span><span class="stl_10 stl_11 stl_499" style="word-spacing:-0.2801em;">&nbsp;)</span><span class="stl_10 stl_11 stl_499" style="word-spacing:-0.2801em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:11.925em;"><span class="stl_10 stl_11 stl_481" style="word-spacing:0.1024em;">o =</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.0822em;">&nbsp;dictGetVal (</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2856em;">&nbsp;de</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2856em;">&nbsp;)</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2856em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:12.4057em;"><span class="stl_58 stl_59 stl_870">/</span><span class="stl_58 stl_59 stl_870" style="word-spacing:0.2211em;">&nbsp;</span><span class="stl_17 stl_18 stl_870" style="word-spacing:0.2211em;">将</span><span class="stl_17 stl_18 stl_870" style="word-spacing:0.3081em;">&nbsp;</span><span class="stl_58 stl_59 stl_870" style="word-spacing:0.3081em;">keystr</span><span class="stl_58 stl_59 stl_870" style="word-spacing:-0.0301em;">&nbsp;</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.0301em;">封 装</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.3388em;">&nbsp;在</span><span class="stl_17 stl_18 stl_870" style="word-spacing:0.3019em;">&nbsp;</span><span class="stl_58 stl_59 stl_870" style="word-spacing:0.3019em;">robj</span><span class="stl_58 stl_59 stl_870" style="word-spacing:0.3022em;">&nbsp;</span><span class="stl_17 stl_18 stl_870" style="word-spacing:0.3019em;">里 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:12.0117em;"><span class="stl_10 stl_11 stl_145" style="word-spacing:-0.2973em;">i n i t S t a t i c S t r i n g O b j e c t ( key , keystr ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">获</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;过</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;期</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:11.99em;"><span class="stl_10 stl_11 stl_678" style="word-spacing:0.1626em;">expiretime = getExpire</span><span class="stl_10 stl_11 stl_678" style="word-spacing:-0.2484em;">&nbsp;(db,&amp;key</span><span class="stl_10 stl_11 stl_678" style="word-spacing:-0.2914em;">&nbsp;)</span><span class="stl_10 stl_11 stl_678" style="word-spacing:-0.2914em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:12.4057em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">如 果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;已</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;经</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;过</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;期，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;放</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;弃</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;储 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:12.4057em;"><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.0032em;">* I f</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.4353em;">&nbsp;t</span><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.3327em;">&nbsp;h</span><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.3337em;">&nbsp;i</span><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.3337em;">&nbsp;s</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.3618em;">&nbsp;key i</span><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.3407em;">&nbsp;s</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.3753em;">&nbsp;already expired skip</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.4273em;">&nbsp;i</span><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.3147em;">&nbsp;t</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.3453em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:12.03em;"><span class="stl_15 stl_16 stl_364" style="word-spacing:-0.2696em;">i f</span><span class="stl_15 stl_16 stl_364" style="word-spacing:0.4368em;">&nbsp;</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.4368em;">(</span><span class="stl_10 stl_11 stl_364" style="word-spacing:-0.2116em;">&nbsp;expiretime</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.3304em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.1642em;">&nbsp;</span><span class="stl_107 stl_108 stl_364" style="word-spacing:0.3304em;">−</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.1642em;">1</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.0164em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.1639em;">&nbsp;expiretime &lt;</span><span class="stl_10 stl_11 stl_364" style="word-spacing:0.1004em;">&nbsp;now) &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:13.59em;"><span class="stl_15 stl_16 stl_502" style="word-spacing:-0.1449em;">continue </span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.1449em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;键</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;值</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;对</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;应</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;操</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;作 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:12.4058em;"><span class="stl_58 stl_59 stl_828" style="word-spacing:0.2581em;">* Save</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.3321em;">&nbsp;the key</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.2701em;">&nbsp;and</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.3161em;">&nbsp;associated</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.3911em;">&nbsp;value</span><span class="stl_58 stl_59 stl_828" style="word-spacing:0.3071em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:12.03em;z-index:287; "><span class="stl_15 stl_16 stl_952" style="word-spacing:-0.045em;">i f</span><span class="stl_15 stl_16 stl_952" style="word-spacing:0.6614em;">&nbsp;</span><span class="stl_10 stl_11 stl_952" style="word-spacing:0.6614em;">(o</span><span class="stl_107 stl_108 stl_952" style="word-spacing:0.6614em;">−</span><span class="stl_10 stl_11 stl_952" style="word-spacing:0.6614em;">&gt;type</span><span class="stl_10 stl_11 stl_952" style="word-spacing:0.357em;">&nbsp;==</span><span class="stl_10 stl_11 stl_952" style="word-spacing:0.216em;">&nbsp;REDIS_STRING)</span><span class="stl_10 stl_11 stl_952" style="word-spacing:0.216em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:14.3983em;"><span class="stl_58 stl_59 stl_953" style="word-spacing:0.4303em;">* Emit a</span><span class="stl_58 stl_59 stl_953" style="word-spacing:0.3303em;">&nbsp;SET</span><span class="stl_58 stl_59 stl_953" style="word-spacing:0.2863em;">&nbsp;command</span><span class="stl_58 stl_59 stl_953" style="word-spacing:0.3863em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:13.9117em;"><span class="stl_15 stl_16 stl_502">char</span><span class="stl_15 stl_16 stl_502" style="word-spacing:0.273em;">&nbsp;</span><span class="stl_10 stl_11 stl_502" style="word-spacing:0.273em;">cmd[]=</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.1819em;">&nbsp;”*3\</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.1829em;">&nbsp;r</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.2079em;">&nbsp;\n$3\</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.2079em;">&nbsp;r</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.2079em;">&nbsp;\nSET\</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.2079em;">&nbsp;r</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.2079em;">&nbsp;\n”</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.2079em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:14.0225em;"><span class="stl_15 stl_16 stl_954" style="word-spacing:-0.2365em;">i f</span><span class="stl_15 stl_16 stl_954" style="word-spacing:0.4699em;">&nbsp;</span><span class="stl_10 stl_11 stl_954" style="word-spacing:0.4699em;">(</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.1855em;">&nbsp;rioWrite(&amp;aof</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.0545em;">&nbsp;,</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.2575em;">&nbsp;cmd,</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.1283em;">&nbsp;</span><span class="stl_15 stl_16 stl_954" style="word-spacing:-0.1283em;">sizeof</span><span class="stl_15 stl_16 stl_954" style="word-spacing:-0.1832em;">&nbsp;</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.1832em;">(cmd)</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.2536em;">&nbsp;</span><span class="stl_107 stl_108 stl_954" style="word-spacing:-0.1832em;">−</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.2536em;">1)</span><span class="stl_10 stl_11 stl_954" style="word-spacing:0.0955em;">&nbsp;==</span><span class="stl_10 stl_11 stl_954" style="word-spacing:0.1715em;">&nbsp;0) &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6393em; left:15.5742em;"><span class="stl_15 stl_16 stl_955">goto</span><span class="stl_15 stl_16 stl_955" style="word-spacing:0.3513em;">&nbsp;</span><span class="stl_10 stl_11 stl_955" style="word-spacing:0.3513em;">werr</span><span class="stl_10 stl_11 stl_955" style="word-spacing:0.3513em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:14.3982em;"><span class="stl_58 stl_59 stl_261" style="word-spacing:0.2659em;">* Key and</span><span class="stl_58 stl_59 stl_261" style="word-spacing:0.3749em;">&nbsp;value</span><span class="stl_58 stl_59 stl_261" style="word-spacing:0.3749em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:14.0225em;"><span class="stl_15 stl_16 stl_956" style="word-spacing:-0.253em;">i f</span><span class="stl_15 stl_16 stl_956" style="word-spacing:0.4534em;">&nbsp;</span><span class="stl_10 stl_11 stl_956" style="word-spacing:0.4534em;">(</span><span class="stl_10 stl_11 stl_956" style="word-spacing:-0.213em;">&nbsp;rioWriteBulkObject(&amp;aof</span><span class="stl_10 stl_11 stl_956" style="word-spacing:-0.184em;">&nbsp;,&amp;key</span><span class="stl_10 stl_11 stl_956" style="word-spacing:-0.248em;">&nbsp;)</span><span class="stl_10 stl_11 stl_956" style="word-spacing:0.1565em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_956" style="word-spacing:0.3199em;">&nbsp;</span><span class="stl_15 stl_16 stl_956" style="word-spacing:0.3199em;">goto &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:15.6108em;"><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.179em;">werr ; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6243em; left:14.0225em;"><span class="stl_15 stl_16 stl_825" style="word-spacing:-0.2557em;">i f</span><span class="stl_15 stl_16 stl_825" style="word-spacing:0.4507em;">&nbsp;</span><span class="stl_10 stl_11 stl_825" style="word-spacing:0.4507em;">(</span><span class="stl_10 stl_11 stl_825" style="word-spacing:-0.2157em;">&nbsp;rioWriteBulkObject(&amp;aof</span><span class="stl_10 stl_11 stl_825" style="word-spacing:-0.0737em;">&nbsp;,</span><span class="stl_10 stl_11 stl_825" style="word-spacing:-0.2207em;">&nbsp;o</span><span class="stl_10 stl_11 stl_825" style="word-spacing:-0.2757em;">&nbsp;)</span><span class="stl_10 stl_11 stl_825" style="word-spacing:0.1538em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_825" style="word-spacing:0.3176em;">&nbsp;</span><span class="stl_15 stl_16 stl_825" style="word-spacing:0.3176em;">goto &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:15.6108em;"><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.179em;">werr ; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.611em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.5993em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 40.5885em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 31.6168em; left:12.9742em;z-index:519; "><span class="stl_15 stl_16 stl_957" style="word-spacing:0.5966em;">else i</span><span class="stl_15 stl_16 stl_957" style="word-spacing:-0.1174em;">&nbsp;f</span><span class="stl_15 stl_16 stl_957" style="word-spacing:0.5884em;">&nbsp;</span><span class="stl_10 stl_11 stl_957" style="word-spacing:0.5884em;">(o</span><span class="stl_107 stl_108 stl_957" style="word-spacing:0.5884em;">−</span><span class="stl_10 stl_11 stl_957" style="word-spacing:0.5884em;">&gt;type</span><span class="stl_10 stl_11 stl_957" style="word-spacing:0.2836em;">&nbsp;==</span><span class="stl_10 stl_11 stl_957" style="word-spacing:0.1756em;">&nbsp;REDIS_LIST)</span><span class="stl_10 stl_11 stl_957" style="word-spacing:0.1756em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6135em; left:14.0225em;"><span class="stl_15 stl_16 stl_490" style="word-spacing:-0.2789em;">i f</span><span class="stl_15 stl_16 stl_490" style="word-spacing:0.4275em;">&nbsp;</span><span class="stl_10 stl_11 stl_490" style="word-spacing:0.4275em;">(</span><span class="stl_10 stl_11 stl_490" style="word-spacing:-0.2089em;">&nbsp;rewriteListObject</span><span class="stl_10 stl_11 stl_490" style="word-spacing:-0.3029em;">&nbsp;(&amp;aof</span><span class="stl_10 stl_11 stl_490" style="word-spacing:-0.2099em;">&nbsp;,&amp;key</span><span class="stl_10 stl_11 stl_490" style="word-spacing:-0.1739em;">&nbsp;,</span><span class="stl_10 stl_11 stl_490" style="word-spacing:-0.2439em;">&nbsp;o</span><span class="stl_10 stl_11 stl_490" style="word-spacing:-0.2989em;">&nbsp;)</span><span class="stl_10 stl_11 stl_490" style="word-spacing:0.1306em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_490" style="word-spacing:0.2942em;">&nbsp;</span><span class="stl_15 stl_16 stl_490" style="word-spacing:0.2942em;">goto &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:16.1092em;"><span class="stl_10 stl_11 stl_672" style="word-spacing:-0.1783em;">werr ; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:12.9742em;z-index:594; "><span class="stl_15 stl_16 stl_512" style="word-spacing:0.6209em;">else i</span><span class="stl_15 stl_16 stl_512" style="word-spacing:-0.0931em;">&nbsp;f</span><span class="stl_15 stl_16 stl_512" style="word-spacing:0.6126em;">&nbsp;</span><span class="stl_10 stl_11 stl_512" style="word-spacing:0.6126em;">(o</span><span class="stl_107 stl_108 stl_512" style="word-spacing:0.6126em;">−</span><span class="stl_10 stl_11 stl_512" style="word-spacing:0.6126em;">&gt;type</span><span class="stl_10 stl_11 stl_512" style="word-spacing:0.3079em;">&nbsp;==</span><span class="stl_10 stl_11 stl_512" style="word-spacing:0.1699em;">&nbsp;REDIS_SET)</span><span class="stl_10 stl_11 stl_512" style="word-spacing:0.1699em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:14.0225em;"><span class="stl_15 stl_16 stl_958" style="word-spacing:-0.2691em;">i f</span><span class="stl_15 stl_16 stl_958" style="word-spacing:0.4373em;">&nbsp;</span><span class="stl_10 stl_11 stl_958" style="word-spacing:0.4373em;">(</span><span class="stl_10 stl_11 stl_958" style="word-spacing:-0.2081em;">&nbsp;rewriteSetObject(&amp;aof</span><span class="stl_10 stl_11 stl_958" style="word-spacing:-0.2001em;">&nbsp;,&amp;key</span><span class="stl_10 stl_11 stl_958" style="word-spacing:-0.1641em;">&nbsp;,</span><span class="stl_10 stl_11 stl_958" style="word-spacing:-0.2341em;">&nbsp;o</span><span class="stl_10 stl_11 stl_958" style="word-spacing:-0.2891em;">&nbsp;)</span><span class="stl_10 stl_11 stl_958" style="word-spacing:0.1404em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_958" style="word-spacing:0.3038em;">&nbsp;</span><span class="stl_15 stl_16 stl_958" style="word-spacing:0.3038em;">goto &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:15.6108em;"><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.179em;">werr ; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:12.9742em;z-index:667; "><span class="stl_15 stl_16 stl_959" style="word-spacing:0.6232em;">else i</span><span class="stl_15 stl_16 stl_959" style="word-spacing:-0.0908em;">&nbsp;f</span><span class="stl_15 stl_16 stl_959" style="word-spacing:0.6149em;">&nbsp;</span><span class="stl_10 stl_11 stl_959" style="word-spacing:0.6149em;">(o</span><span class="stl_107 stl_108 stl_959" style="word-spacing:0.6149em;">−</span><span class="stl_10 stl_11 stl_959" style="word-spacing:0.6149em;">&gt;type</span><span class="stl_10 stl_11 stl_959" style="word-spacing:0.3102em;">&nbsp;==</span><span class="stl_10 stl_11 stl_959" style="word-spacing:0.1752em;">&nbsp;REDIS_ZSET)</span><span class="stl_10 stl_11 stl_959" style="word-spacing:0.1752em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:14.0225em;"><span class="stl_15 stl_16 stl_890" style="word-spacing:-0.2901em;">i f</span><span class="stl_15 stl_16 stl_890" style="word-spacing:0.4163em;">&nbsp;</span><span class="stl_10 stl_11 stl_890" style="word-spacing:0.4163em;">(</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.2301em;">&nbsp;rewriteSortedSetObject(&amp;aof</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.2211em;">&nbsp;,&amp;key</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.1851em;">&nbsp;,</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.2541em;">&nbsp;o</span><span class="stl_10 stl_11 stl_890" style="word-spacing:-0.3111em;">&nbsp;)</span><span class="stl_10 stl_11 stl_890" style="word-spacing:0.1194em;">&nbsp;==</span><span class="stl_10 stl_11 stl_890" style="word-spacing:0.1194em;">&nbsp;0) &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5868em; left:16.0725em;"><span class="stl_15 stl_16 stl_955">goto</span><span class="stl_15 stl_16 stl_955" style="word-spacing:0.3513em;">&nbsp;</span><span class="stl_10 stl_11 stl_955" style="word-spacing:0.3513em;">werr</span><span class="stl_10 stl_11 stl_955" style="word-spacing:0.3513em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5835em; left:12.9742em;z-index:747; "><span class="stl_15 stl_16 stl_446" style="word-spacing:0.6436em;">else i</span><span class="stl_15 stl_16 stl_446" style="word-spacing:-0.0704em;">&nbsp;f</span><span class="stl_15 stl_16 stl_446" style="word-spacing:0.6353em;">&nbsp;</span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.6353em;">(o</span><span class="stl_107 stl_108 stl_446" style="word-spacing:0.6353em;">−</span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.6353em;">&gt;type</span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.3306em;">&nbsp;==</span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.1736em;">&nbsp;REDIS_HASH)</span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.1736em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5793em; left:14.0225em;"><span class="stl_15 stl_16 stl_960" style="word-spacing:-0.2498em;">i f</span><span class="stl_15 stl_16 stl_960" style="word-spacing:0.4566em;">&nbsp;</span><span class="stl_10 stl_11 stl_960" style="word-spacing:0.4566em;">(</span><span class="stl_10 stl_11 stl_960" style="word-spacing:-0.2078em;">&nbsp;rewriteHashObject(&amp;aof</span><span class="stl_10 stl_11 stl_960" style="word-spacing:-0.1808em;">&nbsp;,&amp;key</span><span class="stl_10 stl_11 stl_960" style="word-spacing:-0.1448em;">&nbsp;,</span><span class="stl_10 stl_11 stl_960" style="word-spacing:-0.2148em;">&nbsp;o</span><span class="stl_10 stl_11 stl_960" style="word-spacing:-0.2698em;">&nbsp;)</span><span class="stl_10 stl_11 stl_960" style="word-spacing:0.1597em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_960" style="word-spacing:0.3233em;">&nbsp;</span><span class="stl_15 stl_16 stl_960" style="word-spacing:0.3233em;">goto &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:16.1092em;"><span class="stl_10 stl_11 stl_672" style="word-spacing:-0.1783em;">werr ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 45.5702em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.5727em; left:12.9742em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:13.9875em;"><span class="stl_10 stl_11 stl_222" style="word-spacing:-0.2434em;">redisPanic ( ”Unknown␣ object ␣type ” ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">108 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;过</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;期</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:12.4057em;"><span class="stl_58 stl_59 stl_961" style="word-spacing:0.27em;">* Save</span><span class="stl_58 stl_59 stl_961" style="word-spacing:0.335em;">&nbsp;the</span><span class="stl_58 stl_59 stl_961" style="word-spacing:0.38em;">&nbsp;expire time</span><span class="stl_58 stl_59 stl_961" style="word-spacing:0.286em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:12.03em;z-index:66; "><span class="stl_15 stl_16 stl_674" style="word-spacing:-0.2837em;">i f</span><span class="stl_15 stl_16 stl_674" style="word-spacing:0.4227em;">&nbsp;</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.4227em;">(</span><span class="stl_10 stl_11 stl_674" style="word-spacing:-0.2257em;">&nbsp;expiretime</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.3163em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.2424em;">&nbsp;</span><span class="stl_107 stl_108 stl_674" style="word-spacing:0.3163em;">−</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.2424em;">1)</span><span class="stl_10 stl_11 stl_674" style="word-spacing:0.2424em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:13.9117em;z-index:83; "><span class="stl_15 stl_16 stl_962">char</span><span class="stl_15 stl_16 stl_962" style="word-spacing:0.3315em;">&nbsp;</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.3315em;">cmd[]=</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1234em;">&nbsp;”*3\</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1244em;">&nbsp;r</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1494em;">&nbsp;\n$9\</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1494em;">&nbsp;r</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1494em;">&nbsp;\nPEXPIREAT\</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1504em;">&nbsp;r</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1494em;">&nbsp;\n”</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1494em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:14.0225em;"><span class="stl_15 stl_16 stl_954" style="word-spacing:-0.2365em;">i f</span><span class="stl_15 stl_16 stl_954" style="word-spacing:0.4699em;">&nbsp;</span><span class="stl_10 stl_11 stl_954" style="word-spacing:0.4699em;">(</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.1855em;">&nbsp;rioWrite(&amp;aof</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.0545em;">&nbsp;,</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.2575em;">&nbsp;cmd,</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.1283em;">&nbsp;</span><span class="stl_15 stl_16 stl_954" style="word-spacing:-0.1283em;">sizeof</span><span class="stl_15 stl_16 stl_954" style="word-spacing:-0.1832em;">&nbsp;</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.1832em;">(cmd)</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.2536em;">&nbsp;</span><span class="stl_107 stl_108 stl_954" style="word-spacing:-0.1832em;">−</span><span class="stl_10 stl_11 stl_954" style="word-spacing:-0.2536em;">1)</span><span class="stl_10 stl_11 stl_954" style="word-spacing:0.0955em;">&nbsp;==</span><span class="stl_10 stl_11 stl_954" style="word-spacing:0.1715em;">&nbsp;0) &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:15.5742em;"><span class="stl_15 stl_16 stl_955">goto</span><span class="stl_15 stl_16 stl_955" style="word-spacing:0.3513em;">&nbsp;</span><span class="stl_10 stl_11 stl_955" style="word-spacing:0.3513em;">werr</span><span class="stl_10 stl_11 stl_955" style="word-spacing:0.3513em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:14.0225em;"><span class="stl_15 stl_16 stl_956" style="word-spacing:-0.253em;">i f</span><span class="stl_15 stl_16 stl_956" style="word-spacing:0.4534em;">&nbsp;</span><span class="stl_10 stl_11 stl_956" style="word-spacing:0.4534em;">(</span><span class="stl_10 stl_11 stl_956" style="word-spacing:-0.213em;">&nbsp;rioWriteBulkObject(&amp;aof</span><span class="stl_10 stl_11 stl_956" style="word-spacing:-0.184em;">&nbsp;,&amp;key</span><span class="stl_10 stl_11 stl_956" style="word-spacing:-0.248em;">&nbsp;)</span><span class="stl_10 stl_11 stl_956" style="word-spacing:0.1565em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_956" style="word-spacing:0.32em;">&nbsp;</span><span class="stl_15 stl_16 stl_956" style="word-spacing:0.32em;">goto &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:15.6108em;"><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.179em;">werr ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:14.0225em;"><span class="stl_15 stl_16 stl_963" style="word-spacing:-0.2591em;">i f</span><span class="stl_15 stl_16 stl_963" style="word-spacing:0.4473em;">&nbsp;</span><span class="stl_10 stl_11 stl_963" style="word-spacing:0.4473em;">(</span><span class="stl_10 stl_11 stl_963" style="word-spacing:-0.2411em;">&nbsp;rioWriteBulkLongLong(&amp;aof</span><span class="stl_10 stl_11 stl_963" style="word-spacing:-0.0771em;">&nbsp;,</span><span class="stl_10 stl_11 stl_963" style="word-spacing:-0.1451em;">&nbsp;expiretime</span><span class="stl_10 stl_11 stl_963" style="word-spacing:-0.2011em;">&nbsp;)</span><span class="stl_10 stl_11 stl_963" style="word-spacing:0.1519em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:15.6225em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 14.681em; left:16.1231em;"><span class="stl_10 stl_11 stl_770">)</span><span class="stl_10 stl_11 stl_770" style="word-spacing:0.3641em;">&nbsp;</span><span class="stl_15 stl_16 stl_770" style="word-spacing:0.3641em;">goto</span><span class="stl_15 stl_16 stl_770" style="word-spacing:0.3509em;">&nbsp;</span><span class="stl_10 stl_11 stl_770" style="word-spacing:0.3509em;">werr</span><span class="stl_10 stl_11 stl_770" style="word-spacing:0.3509em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 16.6785em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">释</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;放</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;迭</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;代</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;器 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:10.02em;"><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.3214em;">d i c t R e l e a s e I t e r a t o r ( di ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;盘 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4207em;"><span class="stl_58 stl_59 stl_875" style="word-spacing:0.2528em;">* Make</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.3078em;">&nbsp;sure</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.4008em;">&nbsp;data</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.4698em;">&nbsp;w</span><span class="stl_58 stl_59 stl_875" style="word-spacing:-0.2362em;">&nbsp;i</span><span class="stl_58 stl_59 stl_875" style="word-spacing:-0.2372em;">&nbsp;l</span><span class="stl_58 stl_59 stl_875" style="word-spacing:-0.2362em;">&nbsp;l</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.4618em;">&nbsp;not</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.3528em;">&nbsp;remain</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.2968em;">&nbsp;on</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.3458em;">&nbsp;the</span><span class="stl_58 stl_59 stl_875" style="word-spacing:-0.0073em;">&nbsp;OS ’</span><span class="stl_58 stl_59 stl_875" style="word-spacing:-0.2272em;">&nbsp;s</span><span class="stl_58 stl_59 stl_875" style="word-spacing:0.3948em;">&nbsp;output &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:9.6933em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">b u</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">&nbsp;r</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.451em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:8.0408em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2716em;">f f l u s h ( fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:7.9908em;"><span class="stl_10 stl_11 stl_145" style="word-spacing:-0.258em;">aof_fsync ( f i l e n o ( fp ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:8.0442em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2687em;">f c l o s e ( fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.6276em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">重</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;文</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;名 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:8.4207em;"><span class="stl_58 stl_59 stl_876" style="word-spacing:0.392em;">* Use</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.209em;">&nbsp;RENAME</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.28em;">&nbsp;to</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.433em;">&nbsp;make sure</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.524em;">&nbsp;the</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.324em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.412em;">&nbsp;f</span><span class="stl_58 stl_59 stl_876" style="word-spacing:-0.1em;">&nbsp;i</span><span class="stl_58 stl_59 stl_876" style="word-spacing:-0.1em;">&nbsp;l</span><span class="stl_58 stl_59 stl_876" style="word-spacing:-0.1em;">&nbsp;e</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.662em;">&nbsp;i</span><span class="stl_58 stl_59 stl_876" style="word-spacing:-0.153em;">&nbsp;s</span><span class="stl_58 stl_59 stl_876" style="word-spacing:0.538em;">&nbsp;changed &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:9.6758em;"><span class="stl_58 stl_59 stl_877" style="word-spacing:0.338em;">atomically only &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 32.6201em; left:9.5542em;"><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2518em;">i f</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.4732em;">&nbsp;the</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.4032em;">&nbsp;generate</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.1932em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.2802em;">&nbsp;f</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2328em;">&nbsp;i</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2328em;">&nbsp;l</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2328em;">&nbsp;e</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.5282em;">&nbsp;i</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2848em;">&nbsp;s</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3902em;">&nbsp;ok</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2248em;">&nbsp;.</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3592em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:8.045em;z-index:505; "><span class="stl_15 stl_16 stl_878" style="word-spacing:-0.2541em;">i f</span><span class="stl_15 stl_16 stl_878" style="word-spacing:0.4523em;">&nbsp;</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.4523em;">(</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.2631em;">&nbsp;rename</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.2631em;">&nbsp;(</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.2011em;">&nbsp;tmpfile</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.0211em;">&nbsp;,</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.1401em;">&nbsp;filename</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.1951em;">&nbsp;)</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.1569em;">&nbsp;==</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.1031em;">&nbsp;</span><span class="stl_107 stl_108 stl_878" style="word-spacing:0.1569em;">−</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.1031em;">1)</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.1031em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:9.9933em;"><span class="stl_10 stl_11 stl_964" style="word-spacing:-0.1469em;">redisLog (REDIS_WARNING, ” Error ␣moving␣temp␣append␣ only &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:11.5925em;"><span class="stl_10 stl_11 stl_07">␣</span></div>
					<div class="stl_01" style="top: 35.6068em; left:12.2301em;"><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2472em;">f i</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2472em;">&nbsp;l</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2472em;">&nbsp;e</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.1972em;">&nbsp;␣on␣</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.3142em;">&nbsp;the</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.3132em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2362em;">&nbsp;f</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2862em;">&nbsp;i</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2852em;">&nbsp;n</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2862em;">&nbsp;a</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2862em;">&nbsp;l</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2352em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2702em;">&nbsp;destination</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.1582em;">&nbsp;:</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2552em;">&nbsp;␣%s</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.3002em;">&nbsp;”</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.1882em;">&nbsp;,</span><span class="stl_10 stl_11 stl_172" style="word-spacing:0.4088em;">&nbsp;s</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2992em;">&nbsp;t</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2982em;">&nbsp;r</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2992em;">&nbsp;e</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2992em;">&nbsp;r</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2992em;">&nbsp;r</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2992em;">&nbsp;o</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2982em;">&nbsp;r</span><span class="stl_10 stl_11 stl_172" style="word-spacing:-0.2982em;">&nbsp;( &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:11.65em;"><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.2545em;">errno ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:9.9908em;"><span class="stl_10 stl_11 stl_881" style="word-spacing:-0.2666em;">unlink ( tmpfile ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:9.9383em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 40.5885em; left:8.0008em;"><span class="stl_10 stl_11 stl_148" style="word-spacing:-0.1299em;">redisLog (REDIS_NOTICE, ”SYNC␣append␣ only ␣ f i l e ␣ rewrite ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:9.64em;"><span class="stl_10 stl_11 stl_958" style="word-spacing:-0.2463em;">performed ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:7.9458em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:5.98em;"><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.179em;">werr : &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5718em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">清</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;理</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;工</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;作 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:8.0442em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2687em;">f c l o s e ( fp ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_49" style="word-spacing:0.5305em;">13.3. AOF</span><span class="stl_21 stl_11 stl_49" style="word-spacing:0.0872em;">&nbsp;</span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0872em;">持久化运作机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">109 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.9983em;"><span class="stl_10 stl_11 stl_881" style="word-spacing:-0.2666em;">unlink ( tmpfile ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:8.0008em;"><span class="stl_10 stl_11 stl_634" style="word-spacing:-0.1755em;">redisLog (REDIS_WARNING, ”Write␣ error ␣ writing ␣append␣ only ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.74em;"><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2035em;">f i</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2025em;">&nbsp;l</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2025em;">&nbsp;e</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.1525em;">&nbsp;␣on␣</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2425em;">&nbsp;disk</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.1315em;">&nbsp;:</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2105em;">&nbsp;␣%s</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2555em;">&nbsp;”</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.1425em;">&nbsp;,</span><span class="stl_10 stl_11 stl_578" style="word-spacing:0.4525em;">&nbsp;s</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2545em;">&nbsp;t</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2535em;">&nbsp;r</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2545em;">&nbsp;e</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2545em;">&nbsp;r</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2545em;">&nbsp;r</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2535em;">&nbsp;o</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2545em;">&nbsp;r</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.1485em;">&nbsp;(</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.1975em;">&nbsp;errno</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.1965em;">&nbsp;)</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2105em;">&nbsp;)</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2105em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:8.045em;"><span class="stl_15 stl_16 stl_625" style="word-spacing:-0.318em;">i f</span><span class="stl_15 stl_16 stl_625" style="word-spacing:0.3884em;">&nbsp;</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.3884em;">(</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.267em;">&nbsp;di</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.266em;">&nbsp;)</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.367em;">&nbsp;d</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;i</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;c</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;t</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;R</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;e</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;l</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;e</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;a</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;s</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;e</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;I</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;t</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;e</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;r</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;a</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;t</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.337em;">&nbsp;o</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.338em;">&nbsp;r</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.232em;">&nbsp;(</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.267em;">&nbsp;di</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.266em;">&nbsp;)</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.266em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:7.9458em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 12.6943em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:6.4282em;"><span class="stl_58 stl_59 stl_965">/</span><span class="stl_58 stl_59 stl_965" style="word-spacing:-0.108em;">&nbsp;</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.108em;">后 台</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.3334em;">&nbsp;子</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.3334em;">&nbsp;进</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.3334em;">&nbsp;程</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.3334em;">&nbsp;结</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.3334em;">&nbsp;束</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.3004em;">&nbsp;后，</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.2513em;">&nbsp;</span><span class="stl_58 stl_59 stl_965" style="word-spacing:-0.2513em;">redis</span><span class="stl_58 stl_59 stl_965" style="word-spacing:-0.0187em;">&nbsp;</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.0187em;">更 新</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.3334em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_965" style="word-spacing:-0.3334em;">&nbsp;存</span><span class="stl_17 stl_18 stl_965" style="word-spacing:0.3057em;">&nbsp;</span><span class="stl_58 stl_59 stl_965" style="word-spacing:0.3057em;">server</span><span class="stl_58 stl_59 stl_965" style="word-spacing:0.3057em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.6642em;"><span class="stl_58 stl_59 stl_966">aof_rewrite_buf_blocks</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.3682em;">&nbsp;</span><span class="stl_17 stl_18 stl_966" style="word-spacing:0.3682em;">追</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.2497em;">&nbsp;加</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.2497em;">&nbsp;到</span><span class="stl_17 stl_18 stl_966" style="word-spacing:0.1601em;">&nbsp;</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.1601em;">AOF</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.0919em;">&nbsp;</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.0919em;">文 件</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.0919em;">&nbsp;中 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:6.4282em;"><span class="stl_58 stl_59 stl_795">/</span><span class="stl_58 stl_59 stl_795" style="word-spacing:0.5418em;">&nbsp;</span><span class="stl_17 stl_18 stl_795" style="word-spacing:0.5418em;">在</span><span class="stl_17 stl_18 stl_795" style="word-spacing:0.391em;">&nbsp;</span><span class="stl_58 stl_59 stl_795" style="word-spacing:0.391em;">AOF</span><span class="stl_58 stl_59 stl_795" style="word-spacing:0.3906em;">&nbsp;</span><span class="stl_17 stl_18 stl_795" style="word-spacing:0.3906em;">持</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.019em;">&nbsp;久</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;化</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;结</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;束</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;后</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;会</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;执</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;行</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.017em;">&nbsp;这</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;个</span><span class="stl_17 stl_18 stl_795" style="word-spacing:-0.018em;">&nbsp;函</span><span class="stl_17 stl_18 stl_795" style="word-spacing:0.015em;">&nbsp;数， &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.6458em;"><span class="stl_58 stl_59 stl_967" style="word-spacing:-0.2334em;">backgroundRewriteDoneHandler ()</span><span class="stl_58 stl_59 stl_967" style="word-spacing:0.3705em;">&nbsp;</span><span class="stl_17 stl_18 stl_967" style="word-spacing:0.3705em;">主</span><span class="stl_17 stl_18 stl_967" style="word-spacing:-0.2564em;">&nbsp;要</span><span class="stl_17 stl_18 stl_967" style="word-spacing:-0.2564em;">&nbsp;工</span><span class="stl_17 stl_18 stl_967" style="word-spacing:-0.2564em;">&nbsp;作</span><span class="stl_17 stl_18 stl_967" style="word-spacing:-0.2564em;">&nbsp;是</span><span class="stl_17 stl_18 stl_967" style="word-spacing:-0.2564em;">&nbsp;将</span><span class="stl_17 stl_18 stl_967" style="word-spacing:0.3816em;">&nbsp;</span><span class="stl_58 stl_59 stl_967" style="word-spacing:0.3816em;">server</span><span class="stl_58 stl_59 stl_967" style="word-spacing:0.3816em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:7.6642em;"><span class="stl_58 stl_59 stl_966">aof_rewrite_buf_blocks</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.231em;">&nbsp;</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.231em;">，</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.2507em;">&nbsp;即</span><span class="stl_17 stl_18 stl_966" style="word-spacing:0.1597em;">&nbsp;</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.1597em;">AOF</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.0909em;">&nbsp;</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.0909em;">缓 存</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.2497em;">&nbsp;写</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.2497em;">&nbsp;入</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.2497em;">&nbsp;文</span><span class="stl_17 stl_18 stl_966" style="word-spacing:-0.2497em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:6.4282em;"><span class="stl_58 stl_59 stl_552" style="word-spacing:0.2504em;">* A</span><span class="stl_58 stl_59 stl_552" style="word-spacing:0.2924em;">&nbsp;background</span><span class="stl_58 stl_59 stl_552" style="word-spacing:0.4484em;">&nbsp;append only</span><span class="stl_58 stl_59 stl_552" style="word-spacing:0.5944em;">&nbsp;f</span><span class="stl_58 stl_59 stl_552" style="word-spacing:-0.1226em;">&nbsp;i</span><span class="stl_58 stl_59 stl_552" style="word-spacing:-0.1226em;">&nbsp;l</span><span class="stl_58 stl_59 stl_552" style="word-spacing:-0.1226em;">&nbsp;e</span><span class="stl_58 stl_59 stl_552" style="word-spacing:0.6244em;">&nbsp;rewriting</span><span class="stl_58 stl_59 stl_552" style="word-spacing:0.5054em;">&nbsp;(BGREWRITEAOF) &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.6633em;"><span class="stl_58 stl_59 stl_968" style="word-spacing:0.4457em;">terminated i</span><span class="stl_58 stl_59 stl_968" style="word-spacing:-0.2713em;">&nbsp;t</span><span class="stl_58 stl_59 stl_968" style="word-spacing:-0.2713em;">&nbsp;s</span><span class="stl_58 stl_59 stl_968" style="word-spacing:0.3977em;">&nbsp;work</span><span class="stl_58 stl_59 stl_968" style="word-spacing:0.3977em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:6.4408em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.4654em;"><span class="stl_58 stl_59 stl_469" style="word-spacing:0.4457em;">Handle t</span><span class="stl_58 stl_59 stl_469" style="word-spacing:-0.2343em;">&nbsp;h</span><span class="stl_58 stl_59 stl_469" style="word-spacing:-0.2343em;">&nbsp;i</span><span class="stl_58 stl_59 stl_469" style="word-spacing:-0.2333em;">&nbsp;s</span><span class="stl_58 stl_59 stl_469" style="word-spacing:-0.0883em;">&nbsp;.</span><span class="stl_58 stl_59 stl_469" style="word-spacing:0.4037em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:5.9483em;"><span class="stl_15 stl_16 stl_73">void</span><span class="stl_15 stl_16 stl_73" style="word-spacing:0.2941em;">&nbsp;</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.2941em;">backgroundRewriteDoneHandler</span><span class="stl_10 stl_11 stl_73" style="word-spacing:-0.2531em;">&nbsp;(</span><span class="stl_10 stl_11 stl_73" style="word-spacing:-0.2427em;">&nbsp;</span><span class="stl_15 stl_16 stl_73" style="word-spacing:-0.2427em;">int</span><span class="stl_15 stl_16 stl_73" style="word-spacing:0.3738em;">&nbsp;</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.3738em;">exitcode</span><span class="stl_10 stl_11 stl_73" style="word-spacing:-0.0421em;">&nbsp;,</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.413em;">&nbsp;</span><span class="stl_15 stl_16 stl_73" style="word-spacing:0.413em;">int</span><span class="stl_15 stl_16 stl_73" style="word-spacing:0.3859em;">&nbsp;</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.3859em;">bysignal</span><span class="stl_10 stl_11 stl_73" style="word-spacing:0.3859em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:8.1058em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 22.656em; left:10.12em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 23.6535em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.656em; left:10.5791em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:10.4132em;"><span class="stl_58 stl_59 stl_117">/</span><span class="stl_58 stl_59 stl_117" style="word-spacing:0.3227em;">&nbsp;</span><span class="stl_17 stl_18 stl_117" style="word-spacing:0.3227em;">将</span><span class="stl_17 stl_18 stl_117" style="word-spacing:0.1718em;">&nbsp;</span><span class="stl_58 stl_59 stl_117" style="word-spacing:0.1718em;">AOF</span><span class="stl_58 stl_59 stl_117" style="word-spacing:-0.0328em;">&nbsp;</span><span class="stl_17 stl_18 stl_117" style="word-spacing:-0.0328em;">缓 存</span><span class="stl_17 stl_18 stl_117" style="word-spacing:0.4011em;">&nbsp;</span><span class="stl_58 stl_59 stl_117" style="word-spacing:0.4011em;">server</span><span class="stl_58 stl_59 stl_117" style="word-spacing:-0.1521em;">&nbsp;.</span><span class="stl_58 stl_59 stl_117" style="word-spacing:-0.1731em;">&nbsp;aof_rewrite_buf_blocks</span><span class="stl_58 stl_59 stl_117" style="word-spacing:0.3813em;">&nbsp;</span><span class="stl_17 stl_18 stl_117" style="word-spacing:0.3813em;">的</span><span class="stl_17 stl_18 stl_117" style="word-spacing:0.1718em;">&nbsp;</span><span class="stl_58 stl_59 stl_117" style="word-spacing:0.1718em;">AOF &nbsp;</span></div>
					<div class="stl_01" style="top: 24.8707em; left:11.6342em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0503em;">写 入 磁 盘 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6393em; left:10.0375em;"><span class="stl_15 stl_16 stl_361" style="word-spacing:-0.268em;">i f</span><span class="stl_15 stl_16 stl_361" style="word-spacing:0.4384em;">&nbsp;</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.4384em;">(</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.219em;">&nbsp;aofRewriteBufferWrite</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.218em;">&nbsp;(</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.269em;">&nbsp;newfd</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.269em;">&nbsp;)</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.143em;">&nbsp;==</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.0891em;">&nbsp;</span><span class="stl_107 stl_108 stl_361" style="word-spacing:0.143em;">−</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.0891em;">1)</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.0891em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:11.9858em;"><span class="stl_10 stl_11 stl_34" style="word-spacing:-0.0137em;">redisLog (REDIS_WARNING, &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:13.9292em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 27.6368em; left:14.4622em;"><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3044em;">Error ␣ trying ␣ to ␣ f l u s h ␣ the ␣ parent ␣ d i f f ␣ to ␣ the &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:15.5775em;"><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2103em;">␣ rewritten</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2093em;">&nbsp;␣AOF:</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1883em;">&nbsp;␣%s</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2333em;">&nbsp;”</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1213em;">&nbsp;,</span><span class="stl_10 stl_11 stl_786" style="word-spacing:0.4757em;">&nbsp;s</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2323em;">&nbsp;t</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2313em;">&nbsp;r</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2323em;">&nbsp;e</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2323em;">&nbsp;r</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2323em;">&nbsp;r</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2323em;">&nbsp;o</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.2313em;">&nbsp;r</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1273em;">&nbsp;(</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1743em;">&nbsp;errno</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1753em;">&nbsp;)</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1883em;">&nbsp;)</span><span class="stl_10 stl_11 stl_786" style="word-spacing:-0.1883em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:12.0133em;"><span class="stl_10 stl_11 stl_431" style="word-spacing:-0.2004em;">c l o s e ( newfd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:11.9208em;"><span class="stl_15 stl_16 stl_281">goto</span><span class="stl_15 stl_16 stl_281" style="word-spacing:0.3284em;">&nbsp;</span><span class="stl_10 stl_11 stl_281" style="word-spacing:0.3284em;">cleanup</span><span class="stl_10 stl_11 stl_281" style="word-spacing:0.3284em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 32.6185em; left:10.12em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 32.6185em; left:10.5791em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 35.6085em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:6.4282em;"><span class="stl_58 stl_59 stl_782">/</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.0287em;">&nbsp;</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.0287em;">将 累</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;积</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;的</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;更</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;新</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;存</span><span class="stl_17 stl_18 stl_782" style="word-spacing:0.3451em;">&nbsp;</span><span class="stl_58 stl_59 stl_782" style="word-spacing:0.3451em;">server</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.2098em;">&nbsp;.</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.2288em;">&nbsp;aof_rewrite_buf_blocks</span><span class="stl_58 stl_59 stl_782" style="word-spacing:0.3237em;">&nbsp;</span><span class="stl_17 stl_18 stl_782" style="word-spacing:0.3237em;">同</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;步</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;到</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;盘 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:6.4282em;"><span class="stl_58 stl_59 stl_970" style="word-spacing:0.2625em;">* Write</span><span class="stl_58 stl_59 stl_970" style="word-spacing:0.3275em;">&nbsp;the</span><span class="stl_58 stl_59 stl_970" style="word-spacing:0.4055em;">&nbsp;b</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3185em;">&nbsp;u</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3185em;">&nbsp;f</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3175em;">&nbsp;f</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3185em;">&nbsp;e</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3185em;">&nbsp;r</span><span class="stl_58 stl_59 stl_970" style="word-spacing:0.3775em;">&nbsp;(</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.2205em;">&nbsp;p</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3145em;">&nbsp;o</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3155em;">&nbsp;s</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3155em;">&nbsp;s</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3155em;">&nbsp;i</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3155em;">&nbsp;b</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3145em;">&nbsp;l</span><span class="stl_58 stl_59 stl_970" style="word-spacing:-0.3155em;">&nbsp;y</span><span class="stl_58 stl_59 stl_970" style="word-spacing:0.3525em;">&nbsp;composed</span><span class="stl_58 stl_59 stl_970" style="word-spacing:0.3185em;">&nbsp;of</span><span class="stl_58 stl_59 stl_970" style="word-spacing:0.4085em;">&nbsp;multiple blocks</span><span class="stl_58 stl_59 stl_970" style="word-spacing:0.4085em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.68em;"><span class="stl_58 stl_59 stl_971" style="word-spacing:0.3612em;">into the s</span><span class="stl_58 stl_59 stl_971" style="word-spacing:-0.3478em;">&nbsp;p</span><span class="stl_58 stl_59 stl_971" style="word-spacing:-0.3478em;">&nbsp;e</span><span class="stl_58 stl_59 stl_971" style="word-spacing:-0.3488em;">&nbsp;c</span><span class="stl_58 stl_59 stl_971" style="word-spacing:-0.3478em;">&nbsp;i</span><span class="stl_58 stl_59 stl_971" style="word-spacing:-0.3478em;">&nbsp;f</span><span class="stl_58 stl_59 stl_971" style="word-spacing:-0.3478em;">&nbsp;i</span><span class="stl_58 stl_59 stl_971" style="word-spacing:-0.3478em;">&nbsp;e</span><span class="stl_58 stl_59 stl_971" style="word-spacing:-0.3478em;">&nbsp;d &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 38.5976em; left:7.0069em;"><span class="stl_58 stl_59 stl_850" style="word-spacing:-0.1918em;">fd .</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.4512em;">&nbsp;I</span><span class="stl_58 stl_59 stl_850" style="word-spacing:-0.2958em;">&nbsp;f</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.3462em;">&nbsp;no</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.3132em;">&nbsp;short</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.4072em;">&nbsp;write</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.3602em;">&nbsp;or</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.2842em;">&nbsp;any</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.3232em;">&nbsp;other</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.3712em;">&nbsp;error happens</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.18em;">&nbsp;</span><span class="stl_107 stl_108 stl_850" style="word-spacing:0.3712em;">−</span><span class="stl_58 stl_59 stl_850" style="word-spacing:0.18em;">1</span><span class="stl_58 stl_59 stl_850" style="word-spacing:-0.0148em;">&nbsp;i</span><span class="stl_58 stl_59 stl_850" style="word-spacing:-0.0148em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:7.6567em;"><span class="stl_58 stl_59 stl_171" style="word-spacing:-0.1026em;">returned , &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:7.011em;"><span class="stl_58 stl_59 stl_407" style="word-spacing:0.3707em;">otherwise the</span><span class="stl_58 stl_59 stl_407" style="word-spacing:0.2892em;">&nbsp;number of</span><span class="stl_58 stl_59 stl_407" style="word-spacing:0.399em;">&nbsp;bytes written i</span><span class="stl_58 stl_59 stl_407" style="word-spacing:-0.3243em;">&nbsp;s</span><span class="stl_58 stl_59 stl_407" style="word-spacing:0.3977em;">&nbsp;returned</span><span class="stl_58 stl_59 stl_407" style="word-spacing:-0.2173em;">&nbsp;.</span><span class="stl_58 stl_59 stl_407" style="word-spacing:0.3207em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 41.5793em; left:6.02em;"><span class="stl_10 stl_11 stl_972" style="word-spacing:0.3645em;">ssize_t aofRewriteBufferWrite</span><span class="stl_10 stl_11 stl_972" style="word-spacing:-0.2695em;">&nbsp;(</span><span class="stl_10 stl_11 stl_972" style="word-spacing:-0.29em;">&nbsp;</span><span class="stl_15 stl_16 stl_972" style="word-spacing:-0.29em;">int</span><span class="stl_15 stl_16 stl_972" style="word-spacing:0.3174em;">&nbsp;</span><span class="stl_10 stl_11 stl_972" style="word-spacing:0.3174em;">fd</span><span class="stl_10 stl_11 stl_972" style="word-spacing:-0.2765em;">&nbsp;)</span><span class="stl_10 stl_11 stl_972" style="word-spacing:-0.2765em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:8.01em;"><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">listNode * ln</span><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:8.0708em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">l i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;I</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;r</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.773em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:8.0133em;"><span class="stl_10 stl_11 stl_780" style="word-spacing:0.3374em;">ssize_t count</span><span class="stl_10 stl_11 stl_780" style="word-spacing:0.1104em;">&nbsp;=</span><span class="stl_10 stl_11 stl_780" style="word-spacing:0.1574em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:8.0017em;"><span class="stl_10 stl_11 stl_679" style="word-spacing:-0.2117em;">listRewind ( server . aof_rewrite_buf_blocks ,&amp; l i ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">110 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:7.9483em;"><span class="stl_15 stl_16 stl_759">while</span><span class="stl_15 stl_16 stl_759" style="word-spacing:-0.2586em;">&nbsp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.2586em;">((</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.199em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_759" style="word-spacing:0.173em;">&nbsp;=</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.111em;">&nbsp;listN e</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.311em;">&nbsp;xt</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.3em;">&nbsp;(&amp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.236em;">&nbsp;l</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.246em;">&nbsp;i</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.141em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.9867em;"><span class="stl_10 stl_11 stl_973" style="word-spacing:-0.0201em;">aofrwblock * block</span><span class="stl_10 stl_11 stl_973" style="word-spacing:0.1429em;">&nbsp;= listNodeValue</span><span class="stl_10 stl_11 stl_973" style="word-spacing:-0.2601em;">&nbsp;(</span><span class="stl_10 stl_11 stl_973" style="word-spacing:-0.2591em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_973" style="word-spacing:-0.2581em;">&nbsp;)</span><span class="stl_10 stl_11 stl_973" style="word-spacing:-0.2581em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:10.0058em;"><span class="stl_10 stl_11 stl_974" style="word-spacing:0.352em;">ssize_t nwritten</span><span class="stl_10 stl_11 stl_974" style="word-spacing:0.352em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:10.0375em;z-index:107; "><span class="stl_15 stl_16 stl_132" style="word-spacing:-0.194em;">i f</span><span class="stl_15 stl_16 stl_132" style="word-spacing:0.5124em;">&nbsp;</span><span class="stl_10 stl_11 stl_132" style="word-spacing:0.5124em;">(</span><span class="stl_10 stl_11 stl_132" style="word-spacing:-0.166em;">&nbsp;block</span><span class="stl_107 stl_108 stl_132" style="word-spacing:-0.166em;">−</span><span class="stl_10 stl_11 stl_132" style="word-spacing:-0.166em;">&gt;used</span><span class="stl_10 stl_11 stl_132" style="word-spacing:-0.174em;">&nbsp;)</span><span class="stl_10 stl_11 stl_132" style="word-spacing:-0.174em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:11.9825em;z-index:149; "><span class="stl_10 stl_11 stl_261" style="word-spacing:0.2234em;">nwritten = write</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.1776em;">&nbsp;(</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.2216em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.0816em;">&nbsp;,</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.1516em;">&nbsp;block</span><span class="stl_107 stl_108 stl_261" style="word-spacing:-0.1516em;">−</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.1516em;">&gt;buf</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.0976em;">&nbsp;,</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.1516em;">&nbsp;block</span><span class="stl_107 stl_108 stl_261" style="word-spacing:-0.1516em;">−</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.1516em;">&gt;used</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.2166em;">&nbsp;)</span><span class="stl_10 stl_11 stl_261" style="word-spacing:-0.2166em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:12.03em;z-index:175; "><span class="stl_15 stl_16 stl_137" style="word-spacing:-0.2387em;">i f</span><span class="stl_15 stl_16 stl_137" style="word-spacing:0.4677em;">&nbsp;</span><span class="stl_10 stl_11 stl_137" style="word-spacing:0.4677em;">(</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.1897em;">&nbsp;nwritten</span><span class="stl_10 stl_11 stl_137" style="word-spacing:0.3423em;">&nbsp;!= block</span><span class="stl_107 stl_108 stl_137" style="word-spacing:0.3423em;">−</span><span class="stl_10 stl_11 stl_137" style="word-spacing:0.3423em;">&gt;used</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2187em;">&nbsp;)</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.2187em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:14.0225em;z-index:197; "><span class="stl_15 stl_16 stl_258" style="word-spacing:-0.2459em;">i f</span><span class="stl_15 stl_16 stl_258" style="word-spacing:0.4605em;">&nbsp;</span><span class="stl_10 stl_11 stl_258" style="word-spacing:0.4605em;">(</span><span class="stl_10 stl_11 stl_258" style="word-spacing:-0.1969em;">&nbsp;nwritten</span><span class="stl_10 stl_11 stl_258" style="word-spacing:0.1706em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_258" style="word-spacing:0.4011em;">&nbsp;errno</span><span class="stl_10 stl_11 stl_258" style="word-spacing:0.2081em;">&nbsp;=</span><span class="stl_10 stl_11 stl_258" style="word-spacing:-0.0914em;">&nbsp;EIO</span><span class="stl_10 stl_11 stl_258" style="word-spacing:-0.0914em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:13.9233em;"><span class="stl_15 stl_16 stl_975" style="word-spacing:0.3965em;">return </span><span class="stl_107 stl_108 stl_975" style="word-spacing:0.3965em;">−</span><span class="stl_10 stl_11 stl_975" style="word-spacing:0.3965em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.96em;"><span class="stl_10 stl_11 stl_236" style="word-spacing:0.1427em;">count +=</span><span class="stl_10 stl_11 stl_236" style="word-spacing:0.1677em;">&nbsp;nwritten</span><span class="stl_10 stl_11 stl_236" style="word-spacing:0.1677em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 17.6743em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 18.666em; left:7.9458em;"><span class="stl_15 stl_16 stl_976">return</span><span class="stl_15 stl_16 stl_976" style="word-spacing:0.3541em;">&nbsp;</span><span class="stl_10 stl_11 stl_976" style="word-spacing:0.3541em;">count</span><span class="stl_10 stl_11 stl_976" style="word-spacing:0.3541em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 21.1443em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 21.1443em; left:7.9808em;z-index:261; "><span class="stl_17 stl_18 stl_977">）边服务边备份的方式</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_978">，即</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.5774em;">&nbsp;</span><span class="stl_10 stl_11 stl_32" style="word-spacing:-0.0263em;">redis </span><span class="stl_17 stl_18 stl_32" style="word-spacing:-0.0263em;">服务器会把所有的数据变更存储在 </span><span class="stl_10 stl_11 stl_32" style="word-spacing:-0.0263em;">server.aof_buf &nbsp;</span></div>
					<div class="stl_01" style="top: 22.1401em; left:5.9058em;"><span class="stl_17 stl_18 stl_979">中，并在特定时机将更新缓存写入预设定的文件（</span><span class="stl_10 stl_11 stl_979">server.aof_ﬁlename</span><span class="stl_17 stl_18 stl_979">）。特定时机有 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.359em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">三种： &nbsp;</span></div>
					<div class="stl_01" style="top: 24.921em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 26.5643em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 28.2076em; left:6.92em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 24.921em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">进入事件循环之前 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.5643em; left:7.3351em;"><span class="stl_10 stl_11 stl_446" style="word-spacing:0.2524em;">. redis</span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.0855em;">&nbsp;</span><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0855em;">服务器定时程序</span><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0858em;">&nbsp;</span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.0858em;">serverCron()</span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.0853em;">&nbsp;</span><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0858em;">中 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.2076em; left:7.3351em;"><span class="stl_10 stl_11 stl_07">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2498em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2498em;">停止</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0837em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0837em;">AOF</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0823em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">策略的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0834em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0834em;">stopAppendOnly()</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0837em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0834em;">中 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.991em; left:7.5658em;"><span class="stl_10 stl_11 stl_710" style="word-spacing:0.0852em;">redis </span><span class="stl_17 stl_18 stl_710" style="word-spacing:0.0852em;">无非是不想服务器突然崩溃终止，导致过多的数据丢失。</span><span class="stl_10 stl_11 stl_710" style="word-spacing:0.0852em;">redis </span><span class="stl_17 stl_18 stl_710" style="word-spacing:0.0852em;">默认是每两 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.2098em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">秒钟进行一次边服务边备份，即隔两秒将累积的写入文件。 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.9801em; left:7.5658em;"><span class="stl_10 stl_11 stl_980" style="word-spacing:0.0883em;">redis </span><span class="stl_17 stl_18 stl_980" style="word-spacing:0.0883em;">为什么取消直接在本进程进行 </span><span class="stl_10 stl_11 stl_980" style="word-spacing:0.0883em;">AOF </span><span class="stl_17 stl_18 stl_980" style="word-spacing:0.0883em;">持久化的方法？原因可能是产生一个 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.976em; left:5.9058em;"><span class="stl_10 stl_11 stl_981" style="word-spacing:0.0821em;">AOF </span><span class="stl_17 stl_18 stl_981" style="word-spacing:0.0821em;">文件要比 </span><span class="stl_10 stl_11 stl_981" style="word-spacing:0.0821em;">RDB </span><span class="stl_17 stl_18 stl_981" style="word-spacing:0.0821em;">文件消耗更多的时间；如果在当前进程执行 </span><span class="stl_10 stl_11 stl_981" style="word-spacing:0.0821em;">AOF </span><span class="stl_17 stl_18 stl_981" style="word-spacing:0.0821em;">持久化，会占 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.1948em; left:5.9058em;z-index:579; "><span class="stl_17 stl_18 stl_982">用服务进程（主进程）较多的时间，停止服务的时间也更长（？） &nbsp;</span></div>
					<div class="stl_01" style="top: 37.1873em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">下面是边服务边备份的主要代码： &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.4326em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 42.4293em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 39.4401em; left:6.4282em;"><span class="stl_58 stl_59 stl_894">/</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.0219em;">&nbsp;</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.0219em;">同 步</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2903em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2573em;">&nbsp;盘；</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2573em;">&nbsp;将</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2903em;">&nbsp;所</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2903em;">&nbsp;有</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2903em;">&nbsp;累</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2903em;">&nbsp;积</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2903em;">&nbsp;的</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2903em;">&nbsp;更</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2903em;">&nbsp;新</span><span class="stl_17 stl_18 stl_894" style="word-spacing:0.3477em;">&nbsp;</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3477em;">server</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.2053em;">&nbsp;.</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.2403em;">&nbsp;aof_buf</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3128em;">&nbsp;</span><span class="stl_17 stl_18 stl_894" style="word-spacing:0.3128em;">写</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2913em;">&nbsp;入</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2903em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_894" style="word-spacing:-0.2903em;">&nbsp;盘 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:6.4282em;"><span class="stl_58 stl_59 stl_689" style="word-spacing:0.2921em;">* Write</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3521em;">&nbsp;the append only</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.4841em;">&nbsp;f</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2329em;">&nbsp;i</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2329em;">&nbsp;l</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2329em;">&nbsp;e</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.5251em;">&nbsp;b</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2889em;">&nbsp;u</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2879em;">&nbsp;f</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2889em;">&nbsp;f</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2889em;">&nbsp;e</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2889em;">&nbsp;r</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3461em;">&nbsp;on disk</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3461em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:6.9911em;"><span class="stl_58 stl_59 stl_983" style="word-spacing:0.2467em;">Since we are</span><span class="stl_58 stl_59 stl_983" style="word-spacing:0.3687em;">&nbsp;required to write the</span><span class="stl_58 stl_59 stl_983" style="word-spacing:0.1572em;">&nbsp;AOF before</span><span class="stl_58 stl_59 stl_983" style="word-spacing:0.3947em;">&nbsp;replying</span><span class="stl_58 stl_59 stl_983" style="word-spacing:0.3947em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:7.6692em;"><span class="stl_58 stl_59 stl_939" style="word-spacing:0.379em;">the c</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.345em;">&nbsp;l</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.345em;">&nbsp;i</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.345em;">&nbsp;e</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.345em;">&nbsp;n</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.346em;">&nbsp;t</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.346em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 46.4143em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 44.4218em; left:6.9463em;"><span class="stl_58 stl_59 stl_678" style="word-spacing:0.3057em;">and the</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.3687em;">&nbsp;only</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.2832em;">&nbsp;way the</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.4267em;">&nbsp;c</span><span class="stl_58 stl_59 stl_678" style="word-spacing:-0.2973em;">&nbsp;l</span><span class="stl_58 stl_59 stl_678" style="word-spacing:-0.2983em;">&nbsp;i</span><span class="stl_58 stl_59 stl_678" style="word-spacing:-0.2973em;">&nbsp;e</span><span class="stl_58 stl_59 stl_678" style="word-spacing:-0.2973em;">&nbsp;n</span><span class="stl_58 stl_59 stl_678" style="word-spacing:-0.2983em;">&nbsp;t</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.4407em;">&nbsp;socket</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.3204em;">&nbsp;can get a write</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.4257em;">&nbsp;i</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.4257em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:7.68em;"><span class="stl_58 stl_59 stl_571" style="word-spacing:0.2992em;">entering when the &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:7.0044em;"><span class="stl_58 stl_59 stl_563" style="word-spacing:0.3856em;">the event loop</span><span class="stl_58 stl_59 stl_563" style="word-spacing:-0.0974em;">&nbsp;,</span><span class="stl_58 stl_59 stl_563" style="word-spacing:0.3226em;">&nbsp;we</span><span class="stl_58 stl_59 stl_563" style="word-spacing:0.2786em;">&nbsp;accumulate</span><span class="stl_58 stl_59 stl_563" style="word-spacing:0.4466em;">&nbsp;a</span><span class="stl_58 stl_59 stl_563" style="word-spacing:-0.2534em;">&nbsp;l</span><span class="stl_58 stl_59 stl_563" style="word-spacing:-0.2544em;">&nbsp;l</span><span class="stl_58 stl_59 stl_563" style="word-spacing:0.4696em;">&nbsp;the</span><span class="stl_58 stl_59 stl_563" style="word-spacing:0.1941em;">&nbsp;AOF writes</span><span class="stl_58 stl_59 stl_563" style="word-spacing:0.4056em;">&nbsp;in</span><span class="stl_58 stl_59 stl_563" style="word-spacing:0.4056em;">&nbsp;a &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:7.5758em;"><span class="stl_58 stl_59 stl_984">memory &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_49" style="word-spacing:0.5305em;">13.3. AOF</span><span class="stl_21 stl_11 stl_49" style="word-spacing:0.0872em;">&nbsp;</span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0872em;">持久化运作机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">111 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.0326em;"><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3425em;">b u</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3425em;">&nbsp;f</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3415em;">&nbsp;f</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3425em;">&nbsp;e</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3425em;">&nbsp;r</span><span class="stl_58 stl_59 stl_985" style="word-spacing:0.3005em;">&nbsp;and write</span><span class="stl_58 stl_59 stl_985" style="word-spacing:0.4225em;">&nbsp;i</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3135em;">&nbsp;t</span><span class="stl_58 stl_59 stl_985" style="word-spacing:0.3285em;">&nbsp;on</span><span class="stl_58 stl_59 stl_985" style="word-spacing:0.2845em;">&nbsp;disk</span><span class="stl_58 stl_59 stl_985" style="word-spacing:0.3755em;">&nbsp;using t</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3315em;">&nbsp;h</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3325em;">&nbsp;i</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3325em;">&nbsp;s</span><span class="stl_58 stl_59 stl_985" style="word-spacing:0.4005em;">&nbsp;function j</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3375em;">&nbsp;u</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3375em;">&nbsp;s</span><span class="stl_58 stl_59 stl_985" style="word-spacing:-0.3375em;">&nbsp;t</span><span class="stl_58 stl_59 stl_985" style="word-spacing:0.4025em;">&nbsp;before &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.1783em;"><span class="stl_58 stl_59 stl_986">entering &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7093em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 9.706em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 10.7018em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 11.6985em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.0044em;"><span class="stl_58 stl_59 stl_921" style="word-spacing:0.3535em;">the event loop again</span><span class="stl_58 stl_59 stl_921" style="word-spacing:0.3535em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:6.9587em;"><span class="stl_58 stl_59 stl_987" style="word-spacing:0.3522em;">About the</span><span class="stl_58 stl_59 stl_987" style="word-spacing:0.4772em;">&nbsp;’</span><span class="stl_58 stl_59 stl_987" style="word-spacing:-0.2038em;">&nbsp;force</span><span class="stl_58 stl_59 stl_987" style="word-spacing:-0.1068em;">&nbsp;’</span><span class="stl_58 stl_59 stl_987" style="word-spacing:0.3342em;">&nbsp;argument</span><span class="stl_58 stl_59 stl_987" style="word-spacing:0.3342em;">&nbsp;: &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:6.8799em;"><span class="stl_58 stl_59 stl_290" style="word-spacing:0.25em;">When the</span><span class="stl_58 stl_59 stl_290" style="word-spacing:0.4205em;">&nbsp;fsync p</span><span class="stl_58 stl_59 stl_290" style="word-spacing:-0.294em;">&nbsp;o</span><span class="stl_58 stl_59 stl_290" style="word-spacing:-0.295em;">&nbsp;l</span><span class="stl_58 stl_59 stl_290" style="word-spacing:-0.294em;">&nbsp;i</span><span class="stl_58 stl_59 stl_290" style="word-spacing:-0.294em;">&nbsp;c</span><span class="stl_58 stl_59 stl_290" style="word-spacing:-0.295em;">&nbsp;y</span><span class="stl_58 stl_59 stl_290" style="word-spacing:0.467em;">&nbsp;i</span><span class="stl_58 stl_59 stl_290" style="word-spacing:-0.285em;">&nbsp;s</span><span class="stl_58 stl_59 stl_290" style="word-spacing:0.464em;">&nbsp;s</span><span class="stl_58 stl_59 stl_290" style="word-spacing:-0.297em;">&nbsp;et</span><span class="stl_58 stl_59 stl_290" style="word-spacing:0.445em;">&nbsp;to ’</span><span class="stl_58 stl_59 stl_290" style="word-spacing:-0.218em;">&nbsp;everysec</span><span class="stl_58 stl_59 stl_290" style="word-spacing:-0.12em;">&nbsp;’</span><span class="stl_58 stl_59 stl_290" style="word-spacing:0.276em;">&nbsp;we</span><span class="stl_58 stl_59 stl_290" style="word-spacing:0.175em;">&nbsp;may</span><span class="stl_58 stl_59 stl_290" style="word-spacing:0.278em;">&nbsp;delay</span><span class="stl_58 stl_59 stl_290" style="word-spacing:0.407em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.2em;"><span class="stl_58 stl_59 stl_988" style="word-spacing:-0.3595em;">f l</span><span class="stl_58 stl_59 stl_988" style="word-spacing:-0.3575em;">&nbsp;u</span><span class="stl_58 stl_59 stl_988" style="word-spacing:-0.3585em;">&nbsp;s</span><span class="stl_58 stl_59 stl_988" style="word-spacing:-0.3585em;">&nbsp;h</span><span class="stl_58 stl_59 stl_988" style="word-spacing:0.4375em;">&nbsp;i</span><span class="stl_58 stl_59 stl_988" style="word-spacing:-0.3255em;">&nbsp;f</span><span class="stl_58 stl_59 stl_988" style="word-spacing:0.4095em;">&nbsp;there &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 15.6835em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 17.676em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.0351em;"><span class="stl_58 stl_59 stl_989" style="word-spacing:-0.3019em;">i s</span><span class="stl_58 stl_59 stl_989" style="word-spacing:0.5371em;">&nbsp;s</span><span class="stl_58 stl_59 stl_989" style="word-spacing:-0.2239em;">&nbsp;t</span><span class="stl_58 stl_59 stl_989" style="word-spacing:-0.2239em;">&nbsp;i</span><span class="stl_58 stl_59 stl_989" style="word-spacing:-0.2239em;">&nbsp;l</span><span class="stl_58 stl_59 stl_989" style="word-spacing:-0.2239em;">&nbsp;l</span><span class="stl_58 stl_59 stl_989" style="word-spacing:0.4181em;">&nbsp;an</span><span class="stl_58 stl_59 stl_989" style="word-spacing:0.3071em;">&nbsp;fsync</span><span class="stl_58 stl_59 stl_989" style="word-spacing:-0.2079em;">&nbsp;()</span><span class="stl_58 stl_59 stl_989" style="word-spacing:0.3801em;">&nbsp;going</span><span class="stl_58 stl_59 stl_989" style="word-spacing:0.2921em;">&nbsp;on in</span><span class="stl_58 stl_59 stl_989" style="word-spacing:0.3581em;">&nbsp;the background thread</span><span class="stl_58 stl_59 stl_989" style="word-spacing:0.3581em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:7.6767em;"><span class="stl_58 stl_59 stl_990" style="word-spacing:0.3544em;">since for instance &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:6.9363em;"><span class="stl_58 stl_59 stl_679" style="word-spacing:0.2514em;">on Linux</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.3454em;">&nbsp;write</span><span class="stl_58 stl_59 stl_679" style="word-spacing:-0.2206em;">&nbsp;(2)</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.4264em;">&nbsp;w</span><span class="stl_58 stl_59 stl_679" style="word-spacing:-0.2906em;">&nbsp;i</span><span class="stl_58 stl_59 stl_679" style="word-spacing:-0.2916em;">&nbsp;l</span><span class="stl_58 stl_59 stl_679" style="word-spacing:-0.2906em;">&nbsp;l</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.4014em;">&nbsp;be</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.3476em;">&nbsp;blocked by the background</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.3476em;">&nbsp;fsync &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:7.6108em;"><span class="stl_58 stl_59 stl_991" style="word-spacing:-0.1574em;">anyway . &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:6.8799em;"><span class="stl_58 stl_59 stl_992" style="word-spacing:0.3398em;">When t</span><span class="stl_58 stl_59 stl_992" style="word-spacing:-0.2332em;">&nbsp;h</span><span class="stl_58 stl_59 stl_992" style="word-spacing:-0.2322em;">&nbsp;i</span><span class="stl_58 stl_59 stl_992" style="word-spacing:-0.2332em;">&nbsp;s</span><span class="stl_58 stl_59 stl_992" style="word-spacing:0.4578em;">&nbsp;happens</span><span class="stl_58 stl_59 stl_992" style="word-spacing:0.3148em;">&nbsp;we</span><span class="stl_58 stl_59 stl_992" style="word-spacing:0.2768em;">&nbsp;remember</span><span class="stl_58 stl_59 stl_992" style="word-spacing:0.3948em;">&nbsp;that</span><span class="stl_58 stl_59 stl_992" style="word-spacing:0.4873em;">&nbsp;there i</span><span class="stl_58 stl_59 stl_992" style="word-spacing:-0.2402em;">&nbsp;s</span><span class="stl_58 stl_59 stl_992" style="word-spacing:0.4008em;">&nbsp;some</span><span class="stl_58 stl_59 stl_992" style="word-spacing:0.3568em;">&nbsp;aof</span><span class="stl_58 stl_59 stl_992" style="word-spacing:0.4748em;">&nbsp;b</span><span class="stl_58 stl_59 stl_992" style="word-spacing:-0.2432em;">&nbsp;u</span><span class="stl_58 stl_59 stl_992" style="word-spacing:-0.2432em;">&nbsp;f</span><span class="stl_58 stl_59 stl_992" style="word-spacing:-0.2432em;">&nbsp;f</span><span class="stl_58 stl_59 stl_992" style="word-spacing:-0.2432em;">&nbsp;e</span><span class="stl_58 stl_59 stl_992" style="word-spacing:-0.2432em;">&nbsp;r &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.1625em;"><span class="stl_58 stl_59 stl_101" style="word-spacing:0.349em;">to be &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.0268em;"><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.2759em;">f l</span><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.2759em;">&nbsp;u</span><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.2759em;">&nbsp;s</span><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.2749em;">&nbsp;h</span><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.2759em;">&nbsp;e</span><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.2759em;">&nbsp;d</span><span class="stl_58 stl_59 stl_947" style="word-spacing:0.2701em;">&nbsp;ASAP,</span><span class="stl_58 stl_59 stl_947" style="word-spacing:0.3916em;">&nbsp;and w</span><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.2429em;">&nbsp;i</span><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.2439em;">&nbsp;l</span><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.2429em;">&nbsp;l</span><span class="stl_58 stl_59 stl_947" style="word-spacing:0.4961em;">&nbsp;try</span><span class="stl_58 stl_59 stl_947" style="word-spacing:0.4321em;">&nbsp;to</span><span class="stl_58 stl_59 stl_947" style="word-spacing:0.3636em;">&nbsp;do that</span><span class="stl_58 stl_59 stl_947" style="word-spacing:0.4124em;">&nbsp;in the serverCron</span><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.1939em;">&nbsp;() &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:7.6783em;"><span class="stl_58 stl_59 stl_993" style="word-spacing:-0.2384em;">function . &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 22.6576em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 22.6576em; left:6.9513em;"><span class="stl_58 stl_59 stl_101" style="word-spacing:0.3919em;">However i</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.2671em;">&nbsp;f</span><span class="stl_58 stl_59 stl_101" style="word-spacing:0.4549em;">&nbsp;force i</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3011em;">&nbsp;s</span><span class="stl_58 stl_59 stl_101" style="word-spacing:0.4479em;">&nbsp;s</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3131em;">&nbsp;et</span><span class="stl_58 stl_59 stl_101" style="word-spacing:0.4059em;">&nbsp;to</span><span class="stl_58 stl_59 stl_101" style="word-spacing:0.3009em;">&nbsp;1</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.0352em;">&nbsp;we ’</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.1361em;">&nbsp;l</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.2341em;">&nbsp;l</span><span class="stl_58 stl_59 stl_101" style="word-spacing:0.5019em;">&nbsp;write</span><span class="stl_58 stl_59 stl_101" style="word-spacing:0.4259em;">&nbsp;r</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3101em;">&nbsp;e</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3111em;">&nbsp;g</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3101em;">&nbsp;a</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3101em;">&nbsp;r</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3101em;">&nbsp;d</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3111em;">&nbsp;l</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3101em;">&nbsp;e</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3101em;">&nbsp;s</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.3101em;">&nbsp;s</span><span class="stl_58 stl_59 stl_101" style="word-spacing:0.4029em;">&nbsp;of</span><span class="stl_58 stl_59 stl_101" style="word-spacing:0.4029em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.6492em;"><span class="stl_58 stl_59 stl_702">background &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.0085em;"><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.2052em;">fsync .</span><span class="stl_58 stl_59 stl_369" style="word-spacing:0.3238em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 25.6393em; left:5.9483em;"><span class="stl_15 stl_16 stl_141">void</span><span class="stl_15 stl_16 stl_141" style="word-spacing:0.3123em;">&nbsp;</span><span class="stl_10 stl_11 stl_141" style="word-spacing:0.3123em;">flushAppendOnlyFile</span><span class="stl_10 stl_11 stl_141" style="word-spacing:-0.235em;">&nbsp;(</span><span class="stl_10 stl_11 stl_141" style="word-spacing:-0.2406em;">&nbsp;</span><span class="stl_15 stl_16 stl_141" style="word-spacing:-0.2406em;">int</span><span class="stl_15 stl_16 stl_141" style="word-spacing:0.4071em;">&nbsp;</span><span class="stl_10 stl_11 stl_141" style="word-spacing:0.4071em;">f</span><span class="stl_10 stl_11 stl_141" style="word-spacing:-0.294em;">&nbsp;o</span><span class="stl_10 stl_11 stl_141" style="word-spacing:-0.292em;">&nbsp;r</span><span class="stl_10 stl_11 stl_141" style="word-spacing:-0.293em;">&nbsp;c</span><span class="stl_10 stl_11 stl_141" style="word-spacing:-0.293em;">&nbsp;e</span><span class="stl_10 stl_11 stl_141" style="word-spacing:-0.187em;">&nbsp;)</span><span class="stl_10 stl_11 stl_141" style="word-spacing:-0.187em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:8.0133em;"><span class="stl_10 stl_11 stl_974" style="word-spacing:0.352em;">ssize_t nwritten</span><span class="stl_10 stl_11 stl_974" style="word-spacing:0.352em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:7.98em;"><span class="stl_15 stl_16 stl_603">int</span><span class="stl_15 stl_16 stl_603" style="word-spacing:0.3428em;">&nbsp;</span><span class="stl_10 stl_11 stl_603" style="word-spacing:0.3428em;">sync_in_progress</span><span class="stl_10 stl_11 stl_603" style="word-spacing:0.1539em;">&nbsp;=</span><span class="stl_10 stl_11 stl_603" style="word-spacing:0.1909em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">无 数</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;据，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;无</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;需</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;同</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;步</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;到</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;盘 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:8.045em;"><span class="stl_15 stl_16 stl_361" style="word-spacing:-0.268em;">i f</span><span class="stl_15 stl_16 stl_361" style="word-spacing:0.4384em;">&nbsp;</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.4384em;">(</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.199em;">&nbsp;sdslen</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.198em;">&nbsp;(</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.195em;">&nbsp;server</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.139em;">&nbsp;.</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.192em;">&nbsp;aof_buf</span><span class="stl_10 stl_11 stl_361" style="word-spacing:-0.247em;">&nbsp;)</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.1415em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.3164em;">&nbsp;</span><span class="stl_15 stl_16 stl_361" style="word-spacing:0.3164em;">return</span><span class="stl_15 stl_16 stl_361" style="word-spacing:-0.2253em;">&nbsp;</span><span class="stl_10 stl_11 stl_361" style="word-spacing:0.3164em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:8.4207em;"><span class="stl_58 stl_59 stl_684">/</span><span class="stl_58 stl_59 stl_684" style="word-spacing:-0.0599em;">&nbsp;</span><span class="stl_17 stl_18 stl_684" style="word-spacing:-0.0599em;">创 建</span><span class="stl_17 stl_18 stl_684" style="word-spacing:-0.3093em;">&nbsp;线</span><span class="stl_17 stl_18 stl_684" style="word-spacing:-0.3093em;">&nbsp;程</span><span class="stl_17 stl_18 stl_684" style="word-spacing:-0.3093em;">&nbsp;任</span><span class="stl_17 stl_18 stl_684" style="word-spacing:-0.2763em;">&nbsp;务，</span><span class="stl_17 stl_18 stl_684" style="word-spacing:-0.2763em;">&nbsp;主</span><span class="stl_17 stl_18 stl_684" style="word-spacing:-0.3093em;">&nbsp;要</span><span class="stl_17 stl_18 stl_684" style="word-spacing:-0.3093em;">&nbsp;调</span><span class="stl_17 stl_18 stl_684" style="word-spacing:-0.3093em;">&nbsp;用</span><span class="stl_17 stl_18 stl_684" style="word-spacing:0.3198em;">&nbsp;</span><span class="stl_58 stl_59 stl_684" style="word-spacing:0.3198em;">fsync</span><span class="stl_58 stl_59 stl_684" style="word-spacing:-0.2523em;">&nbsp;() &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:8.045em;"><span class="stl_15 stl_16 stl_994" style="word-spacing:-0.0632em;">i f</span><span class="stl_15 stl_16 stl_994" style="word-spacing:0.6431em;">&nbsp;</span><span class="stl_10 stl_11 stl_994" style="word-spacing:0.6431em;">(</span><span class="stl_10 stl_11 stl_994" style="word-spacing:0.0097em;">&nbsp;server</span><span class="stl_10 stl_11 stl_994" style="word-spacing:0.0658em;">&nbsp;.</span><span class="stl_10 stl_11 stl_994" style="word-spacing:0.0337em;">&nbsp;aof_fsync</span><span class="stl_10 stl_11 stl_994" style="word-spacing:0.3538em;">&nbsp;==</span><span class="stl_10 stl_11 stl_994" style="word-spacing:0.1428em;">&nbsp;AOF_FSYNC_EVERYSEC) &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:9.9775em;"><span class="stl_10 stl_11 stl_475" style="word-spacing:0.1774em;">sync_in_progress =</span><span class="stl_10 stl_11 stl_475" style="word-spacing:-0.0436em;">&nbsp;bioPendingJobsOfType</span><span class="stl_10 stl_11 stl_475" style="word-spacing:-0.0436em;">&nbsp;( &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:11.4925em;"><span class="stl_10 stl_11 stl_995" style="word-spacing:0.6202em;">REDIS_BIO_AOF_FSYNC) != 0; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">如 果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;没</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;设</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;置</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;强</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;制</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;步</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;选</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;项，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;能</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;立</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;即</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:8.045em;"><span class="stl_15 stl_16 stl_485" style="word-spacing:-0.0555em;">i f</span><span class="stl_15 stl_16 stl_485" style="word-spacing:0.6509em;">&nbsp;</span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.6509em;">(</span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.0175em;">&nbsp;server</span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.0735em;">&nbsp;.</span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.0415em;">&nbsp;aof_fsync</span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.3615em;">&nbsp;==</span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.1505em;">&nbsp;AOF_FSYNC_EVERYSEC &amp;&amp;</span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.4095em;">&nbsp;!</span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.0825em;">&nbsp;f</span><span class="stl_10 stl_11 stl_485" style="word-spacing:-0.0795em;">&nbsp;o</span><span class="stl_10 stl_11 stl_485" style="word-spacing:-0.0795em;">&nbsp;r</span><span class="stl_10 stl_11 stl_485" style="word-spacing:-0.0785em;">&nbsp;c</span><span class="stl_10 stl_11 stl_485" style="word-spacing:-0.0795em;">&nbsp;e</span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.0265em;">&nbsp;)</span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.0265em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5901em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:10.4132em;"><span class="stl_58 stl_59 stl_950">/</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.6908em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.6908em;">推</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1307em;">&nbsp;迟 执 行</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5413em;">&nbsp;</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5413em;">AOF &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:10.4132em;"><span class="stl_58 stl_59 stl_165" style="word-spacing:0.2816em;">* With</span><span class="stl_58 stl_59 stl_165" style="word-spacing:0.3906em;">&nbsp;t</span><span class="stl_58 stl_59 stl_165" style="word-spacing:-0.2594em;">&nbsp;h</span><span class="stl_58 stl_59 stl_165" style="word-spacing:-0.2584em;">&nbsp;i</span><span class="stl_58 stl_59 stl_165" style="word-spacing:-0.2594em;">&nbsp;s</span><span class="stl_58 stl_59 stl_165" style="word-spacing:0.3971em;">&nbsp;append fsync</span><span class="stl_58 stl_59 stl_165" style="word-spacing:0.4546em;">&nbsp;p</span><span class="stl_58 stl_59 stl_165" style="word-spacing:-0.2744em;">&nbsp;o</span><span class="stl_58 stl_59 stl_165" style="word-spacing:-0.2754em;">&nbsp;l</span><span class="stl_58 stl_59 stl_165" style="word-spacing:-0.2744em;">&nbsp;i</span><span class="stl_58 stl_59 stl_165" style="word-spacing:-0.2744em;">&nbsp;c</span><span class="stl_58 stl_59 stl_165" style="word-spacing:-0.2744em;">&nbsp;y</span><span class="stl_58 stl_59 stl_165" style="word-spacing:0.3506em;">&nbsp;we</span><span class="stl_58 stl_59 stl_165" style="word-spacing:0.2576em;">&nbsp;do</span><span class="stl_58 stl_59 stl_165" style="word-spacing:0.3326em;">&nbsp;background &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:11.6658em;"><span class="stl_58 stl_59 stl_740" style="word-spacing:-0.2421em;">fsyncing . &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 42.5826em; left:11.5251em;"><span class="stl_58 stl_59 stl_996" style="word-spacing:-0.3176em;">I f</span><span class="stl_58 stl_59 stl_996" style="word-spacing:0.4064em;">&nbsp;the</span><span class="stl_58 stl_59 stl_996" style="word-spacing:0.3849em;">&nbsp;fsync i</span><span class="stl_58 stl_59 stl_996" style="word-spacing:-0.3246em;">&nbsp;s</span><span class="stl_58 stl_59 stl_996" style="word-spacing:0.5144em;">&nbsp;s</span><span class="stl_58 stl_59 stl_996" style="word-spacing:-0.2466em;">&nbsp;t</span><span class="stl_58 stl_59 stl_996" style="word-spacing:-0.2466em;">&nbsp;i</span><span class="stl_58 stl_59 stl_996" style="word-spacing:-0.2466em;">&nbsp;l</span><span class="stl_58 stl_59 stl_996" style="word-spacing:-0.2466em;">&nbsp;l</span><span class="stl_58 stl_59 stl_996" style="word-spacing:0.4634em;">&nbsp;in</span><span class="stl_58 stl_59 stl_996" style="word-spacing:0.3564em;">&nbsp;progress</span><span class="stl_58 stl_59 stl_996" style="word-spacing:0.2714em;">&nbsp;we</span><span class="stl_58 stl_59 stl_996" style="word-spacing:0.2054em;">&nbsp;can</span><span class="stl_58 stl_59 stl_996" style="word-spacing:0.3204em;">&nbsp;try</span><span class="stl_58 stl_59 stl_996" style="word-spacing:0.3724em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:12.1567em;"><span class="stl_58 stl_59 stl_404">delay &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 44.5752em; left:11.4877em;"><span class="stl_58 stl_59 stl_997" style="word-spacing:0.3766em;">the write for</span><span class="stl_58 stl_59 stl_997" style="word-spacing:0.2851em;">&nbsp;a couple</span><span class="stl_58 stl_59 stl_997" style="word-spacing:0.3526em;">&nbsp;of seconds</span><span class="stl_58 stl_59 stl_997" style="word-spacing:-0.2344em;">&nbsp;.</span><span class="stl_58 stl_59 stl_997" style="word-spacing:0.3136em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5652em; left:10.0375em;"><span class="stl_15 stl_16 stl_998" style="word-spacing:-0.2825em;">i f</span><span class="stl_15 stl_16 stl_998" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_998" style="word-spacing:0.4239em;">(</span><span class="stl_10 stl_11 stl_998" style="word-spacing:-0.2495em;">&nbsp;sync_in_progress</span><span class="stl_10 stl_11 stl_998" style="word-spacing:-0.2485em;">&nbsp;)</span><span class="stl_10 stl_11 stl_998" style="word-spacing:-0.2485em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.561em; left:12.03em;"><span class="stl_15 stl_16 stl_792" style="word-spacing:-0.2886em;">i f</span><span class="stl_15 stl_16 stl_792" style="word-spacing:0.4178em;">&nbsp;</span><span class="stl_10 stl_11 stl_792" style="word-spacing:0.4178em;">(</span><span class="stl_10 stl_11 stl_792" style="word-spacing:-0.2156em;">&nbsp;server</span><span class="stl_10 stl_11 stl_792" style="word-spacing:-0.1606em;">&nbsp;.</span><span class="stl_10 stl_11 stl_792" style="word-spacing:-0.1946em;">&nbsp;aof_flush_postponed_start</span><span class="stl_10 stl_11 stl_792" style="word-spacing:0.1229em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_792" style="word-spacing:0.1229em;">&nbsp;{ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">112 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:14.3982em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">设</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;延</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;迟</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;冲</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;洗</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;选</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;项 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:14.3982em;"><span class="stl_58 stl_59 stl_603" style="word-spacing:0.1798em;">* No</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.2518em;">&nbsp;previous</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.4028em;">&nbsp;write postponinig</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.0662em;">&nbsp;,</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3388em;">&nbsp;remember &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:15.655em;"><span class="stl_58 stl_59 stl_579" style="word-spacing:0.299em;">that we</span><span class="stl_58 stl_59 stl_579" style="word-spacing:0.258em;">&nbsp;are &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7093em; left:15.4694em;"><span class="stl_58 stl_59 stl_999" style="word-spacing:0.3711em;">postponing the</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.4141em;">&nbsp;f</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.3089em;">&nbsp;l</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.3099em;">&nbsp;u</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.3099em;">&nbsp;s</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.3089em;">&nbsp;h</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.3441em;">&nbsp;and</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.3051em;">&nbsp;return</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.2029em;">&nbsp;.</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.3331em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:13.995em;"><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.1836em;">server .</span><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.2186em;">&nbsp;aof_flush_postponed_start</span><span class="stl_10 stl_11 stl_931" style="word-spacing:0.1314em;">&nbsp;=</span><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.0086em;">&nbsp;server</span><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.0086em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:15.6225em;"><span class="stl_10 stl_11 stl_806" style="word-spacing:-0.172em;">unixtime ;</span><span class="stl_10 stl_11 stl_806" style="word-spacing:0.382em;">&nbsp;</span><span class="stl_58 stl_59 stl_806" style="word-spacing:0.382em;">//</span><span class="stl_58 stl_59 stl_806" style="word-spacing:0.2835em;">&nbsp;/* Unix</span><span class="stl_58 stl_59 stl_806" style="word-spacing:0.336em;">&nbsp;time sampled</span><span class="stl_58 stl_59 stl_806" style="word-spacing:0.371em;">&nbsp;every &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:15.61em;"><span class="stl_58 stl_59 stl_969" style="word-spacing:0.3572em;">cron cycle</span><span class="stl_58 stl_59 stl_969" style="word-spacing:-0.1848em;">&nbsp;.</span><span class="stl_58 stl_59 stl_969" style="word-spacing:0.3283em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:13.9233em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:12.4057em;"><span class="stl_58 stl_59 stl_271">/</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.1012em;">&nbsp;</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.1012em;">没 有</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;超</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;过</span><span class="stl_17 stl_18 stl_271" style="word-spacing:0.2148em;">&nbsp;</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.2148em;">2s</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.3344em;">&nbsp;</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.3344em;">，</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;直</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;接</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;结</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;束 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6768em; left:12.9742em;z-index:239; "><span class="stl_15 stl_16 stl_1000" style="word-spacing:0.39em;">else i</span><span class="stl_15 stl_16 stl_1000" style="word-spacing:-0.324em;">&nbsp;f</span><span class="stl_15 stl_16 stl_1000" style="word-spacing:0.3817em;">&nbsp;</span><span class="stl_10 stl_11 stl_1000" style="word-spacing:0.3817em;">(</span><span class="stl_10 stl_11 stl_1000" style="word-spacing:-0.253em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1000" style="word-spacing:-0.196em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1000" style="word-spacing:-0.236em;">&nbsp;unixtime</span><span class="stl_10 stl_11 stl_1000" style="word-spacing:0.0849em;">&nbsp;</span><span class="stl_107 stl_108 stl_1000" style="word-spacing:0.0849em;">−</span><span class="stl_107 stl_108 stl_1000" style="word-spacing:-0.0058em;">&nbsp;</span><span class="stl_10 stl_11 stl_1000" style="word-spacing:-0.0058em;">server</span><span class="stl_10 stl_11 stl_1000" style="word-spacing:-0.0058em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:13.6342em;"><span class="stl_10 stl_11 stl_177" style="word-spacing:0.1231em;">aof_flush_postponed_start &lt;</span><span class="stl_10 stl_11 stl_177" style="word-spacing:0.1761em;">&nbsp;2)</span><span class="stl_10 stl_11 stl_177" style="word-spacing:0.1761em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:13.925em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:14.3982em;"><span class="stl_58 stl_59 stl_835" style="word-spacing:0.0933em;">* We</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.1123em;">&nbsp;were</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.3303em;">&nbsp;already</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.3833em;">&nbsp;waiting for fsync</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.3833em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:15.66em;"><span class="stl_58 stl_59 stl_1001" style="word-spacing:-0.3754em;">fin is</span><span class="stl_58 stl_59 stl_1001" style="word-spacing:-0.3754em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1001" style="word-spacing:-0.0794em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1001" style="word-spacing:0.3351em;">&nbsp;but for</span><span class="stl_58 stl_59 stl_1001" style="word-spacing:0.3886em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1001" style="word-spacing:-0.3524em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1001" style="word-spacing:-0.3524em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1001" style="word-spacing:-0.3524em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:14.4108em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:15.4503em;"><span class="stl_58 stl_59 stl_958" style="word-spacing:0.3313em;">than two seconds</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.4328em;">&nbsp;t</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2762em;">&nbsp;h</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2772em;">&nbsp;i</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2772em;">&nbsp;s</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.4838em;">&nbsp;i</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2832em;">&nbsp;s</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.5558em;">&nbsp;s</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2052em;">&nbsp;t</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2052em;">&nbsp;i</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2052em;">&nbsp;l</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2052em;">&nbsp;l</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.4718em;">&nbsp;ok</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.4718em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:16.1108em;"><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.3612em;">Postpone again</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:-0.1838em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.3672em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:13.9233em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.6501em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:12.4058em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0392em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0392em;">否 则，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;要</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;强</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;制</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;写</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;盘 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:12.4058em;"><span class="stl_58 stl_59 stl_1003" style="word-spacing:0.3034em;">* Otherwise</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:0.4584em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:-0.2486em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:-0.2486em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:-0.2486em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:0.4554em;">&nbsp;trough</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:-0.1086em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:0.3374em;">&nbsp;and</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:0.2684em;">&nbsp;go</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:0.3494em;">&nbsp;write</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:0.4064em;">&nbsp;since</span><span class="stl_58 stl_59 stl_1003" style="word-spacing:0.2964em;">&nbsp;we &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:13.5992em;"><span class="stl_58 stl_59 stl_143" style="word-spacing:-0.1816em;">can ’</span><span class="stl_58 stl_59 stl_143" style="word-spacing:-0.2116em;">&nbsp;t</span><span class="stl_58 stl_59 stl_143" style="word-spacing:0.4074em;">&nbsp;wait &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 27.6385em; left:13.4678em;"><span class="stl_58 stl_59 stl_1004" style="word-spacing:0.3335em;">over two seconds</span><span class="stl_58 stl_59 stl_1004" style="word-spacing:-0.192em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1004" style="word-spacing:0.356em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:12.0025em;"><span class="stl_10 stl_11 stl_140" style="word-spacing:-0.1697em;">server . aof_delayed_fsync++; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:11.9858em;"><span class="stl_10 stl_11 stl_1005" style="word-spacing:-0.1366em;">redisLog (REDIS_NOTICE, ”Asynchronous␣AOF␣ fsync ␣ i s ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:13.6442em;"><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.2838em;">taking ␣ too ␣ long ␣ ( disk ␣ i s ␣busy ?) . ␣Writing␣ the ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:13.4642em;"><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2775em;">AOF␣ buffer ␣ without ␣ waiting ␣ fo r ␣ fsync ␣ to ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:13.6192em;"><span class="stl_10 stl_11 stl_1007" style="word-spacing:-0.186em;">complete , ␣ t h i s ␣may␣ slow ␣down␣Redis . ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.611em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 36.6051em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;消</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;延</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;迟</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;冲</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;洗</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;设</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;置 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:8.4207em;"><span class="stl_58 stl_59 stl_233" style="word-spacing:0.3884em;">* I</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2706em;">&nbsp;f</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.3964em;">&nbsp;you</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.3284em;">&nbsp;are</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.4194em;">&nbsp;f</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2836em;">&nbsp;o</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2826em;">&nbsp;l</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2836em;">&nbsp;l</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2826em;">&nbsp;o</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2826em;">&nbsp;w</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2836em;">&nbsp;i</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2826em;">&nbsp;n</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2826em;">&nbsp;g</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.4844em;">&nbsp;t</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2706em;">&nbsp;h</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2716em;">&nbsp;i</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.2716em;">&nbsp;s</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.4204em;">&nbsp;code</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.3404em;">&nbsp;path</span><span class="stl_58 stl_59 stl_233" style="word-spacing:-0.1146em;">&nbsp;,</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.4134em;">&nbsp;then</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.2904em;">&nbsp;we are</span><span class="stl_58 stl_59 stl_233" style="word-spacing:0.3784em;">&nbsp;going &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:10.1558em;"><span class="stl_58 stl_59 stl_908" style="word-spacing:0.3403em;">to write so &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.5168em;"><span class="stl_58 stl_59 stl_835" style="word-spacing:0.4234em;">set r</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3276em;">&nbsp;e</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3266em;">&nbsp;s</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3266em;">&nbsp;e</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3266em;">&nbsp;t</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.3974em;">&nbsp;the</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.3719em;">&nbsp;postponed f</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3156em;">&nbsp;l</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3166em;">&nbsp;u</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3166em;">&nbsp;s</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3156em;">&nbsp;h</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.4444em;">&nbsp;s</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3176em;">&nbsp;e</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3186em;">&nbsp;n</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3186em;">&nbsp;t</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3176em;">&nbsp;i</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3186em;">&nbsp;n</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3186em;">&nbsp;e</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3176em;">&nbsp;l</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.4004em;">&nbsp;to</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.3594em;">&nbsp;zero</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.2136em;">&nbsp;.</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.3254em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:8.0175em;"><span class="stl_10 stl_11 stl_828" style="word-spacing:-0.1769em;">server .</span><span class="stl_10 stl_11 stl_828" style="word-spacing:-0.2119em;">&nbsp;aof_flush_postponed_start</span><span class="stl_10 stl_11 stl_828" style="word-spacing:0.1381em;">&nbsp;=</span><span class="stl_10 stl_11 stl_828" style="word-spacing:0.1701em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:8.4207em;"><span class="stl_58 stl_59 stl_1008" style="word-spacing:0.1326em;">* We want</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:0.3556em;">&nbsp;to perform</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:0.2956em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:0.3646em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:-0.2794em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:-0.2804em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:-0.2794em;">&nbsp;g</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:-0.2794em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:-0.2804em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:0.4566em;">&nbsp;write</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:-0.1604em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:0.3799em;">&nbsp;This should</span><span class="stl_58 stl_59 stl_1008" style="word-spacing:0.3799em;">&nbsp;be &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:9.6517em;"><span class="stl_58 stl_59 stl_85" style="word-spacing:0.3454em;">guaranteed atomic &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 44.5752em; left:9.4911em;"><span class="stl_58 stl_59 stl_1000" style="word-spacing:0.39em;">at l</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.329em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.329em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.329em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.329em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:0.466em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.305em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:0.4005em;">&nbsp;the f</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.342em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.341em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.342em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.341em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.341em;">&nbsp;y</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.342em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.341em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.341em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.342em;">&nbsp;m</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:0.284em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:0.226em;">&nbsp;are</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:0.344em;">&nbsp;writing</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:0.403em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.339em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:0.299em;">&nbsp;a r</span><span class="stl_58 stl_59 stl_1000" style="word-spacing:-0.35em;">&nbsp;eal &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:10.1808em;"><span class="stl_58 stl_59 stl_625" style="word-spacing:-0.344em;">p hys</span><span class="stl_58 stl_59 stl_625" style="word-spacing:-0.344em;">&nbsp;ic</span><span class="stl_58 stl_59 stl_625" style="word-spacing:-0.344em;">&nbsp;al</span><span class="stl_58 stl_59 stl_625" style="word-spacing:0.323em;">&nbsp;one</span><span class="stl_58 stl_59 stl_625" style="word-spacing:0.323em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 46.5676em; left:9.457em;"><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3557em;">While t</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3223em;">&nbsp;h</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3223em;">&nbsp;i</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3213em;">&nbsp;s</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.4607em;">&nbsp;w</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3063em;">&nbsp;i</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3073em;">&nbsp;l</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3073em;">&nbsp;l</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.4057em;">&nbsp;save</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3197em;">&nbsp;us against</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.372em;">&nbsp;the server</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.372em;">&nbsp;being &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_49" style="word-spacing:0.5305em;">13.3. AOF</span><span class="stl_21 stl_11 stl_49" style="word-spacing:0.0872em;">&nbsp;</span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0872em;">持久化运作机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">113 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:10.2167em;"><span class="stl_58 stl_59 stl_961" style="word-spacing:-0.278em;">k i</span><span class="stl_58 stl_59 stl_961" style="word-spacing:-0.277em;">&nbsp;l</span><span class="stl_58 stl_59 stl_961" style="word-spacing:-0.277em;">&nbsp;l</span><span class="stl_58 stl_59 stl_961" style="word-spacing:-0.277em;">&nbsp;e</span><span class="stl_58 stl_59 stl_961" style="word-spacing:-0.277em;">&nbsp;d</span><span class="stl_58 stl_59 stl_961" style="word-spacing:0.43em;">&nbsp;I</span><span class="stl_58 stl_59 stl_961" style="word-spacing:0.291em;">&nbsp;don</span><span class="stl_58 stl_59 stl_961" style="word-spacing:-0.221em;">&nbsp;’</span><span class="stl_58 stl_59 stl_961" style="word-spacing:-0.238em;">&nbsp;t</span><span class="stl_58 stl_59 stl_961" style="word-spacing:0.402em;">&nbsp;think &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 6.7168em; left:9.5052em;"><span class="stl_58 stl_59 stl_1009" style="word-spacing:0.4233em;">there i</span><span class="stl_58 stl_59 stl_1009" style="word-spacing:-0.3117em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1009" style="word-spacing:0.3023em;">&nbsp;much</span><span class="stl_58 stl_59 stl_1009" style="word-spacing:0.2603em;">&nbsp;to</span><span class="stl_58 stl_59 stl_1009" style="word-spacing:0.2988em;">&nbsp;do about</span><span class="stl_58 stl_59 stl_1009" style="word-spacing:0.3576em;">&nbsp;the whole server</span><span class="stl_58 stl_59 stl_1009" style="word-spacing:0.3973em;">&nbsp;stopping &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.1725em;"><span class="stl_58 stl_59 stl_63" style="word-spacing:0.3436em;">for power problems &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.4662em;"><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.457em;">or a</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.231em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.231em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.232em;">&nbsp;k</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.231em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.428em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4207em;"><span class="stl_58 stl_59 stl_432" style="word-spacing:0.1379em;">/ AOF</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.0526em;">&nbsp;</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.0526em;">文 件</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2301em;">&nbsp;已</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2301em;">&nbsp;经</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2301em;">&nbsp;打</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2301em;">&nbsp;开</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.1961em;">&nbsp;了。</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.1971em;">&nbsp;将</span><span class="stl_17 stl_18 stl_432" style="word-spacing:0.4082em;">&nbsp;</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.4082em;">server</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.1451em;">&nbsp;.</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.1801em;">&nbsp;aof_buf</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.373em;">&nbsp;</span><span class="stl_17 stl_18 stl_432" style="word-spacing:0.373em;">中</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2311em;">&nbsp;的</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2301em;">&nbsp;所</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2301em;">&nbsp;有</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2301em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2301em;">&nbsp;存</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2301em;">&nbsp;数</span><span class="stl_17 stl_18 stl_432" style="word-spacing:-0.2301em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.9223em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0503em;">写 入 文 件 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:7.9975em;"><span class="stl_10 stl_11 stl_1011" style="word-spacing:0.1479em;">nwritten = write</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.2536em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.2376em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.1826em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.2416em;">&nbsp;aof_fd</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.1556em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.1826em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.1826em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.2456em;">&nbsp;aof_buf</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.1656em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.1866em;">&nbsp;sdslen</span><span class="stl_10 stl_11 stl_1011" style="word-spacing:-0.1866em;">&nbsp;( &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:9.6775em;"><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2336em;">server . aof_buf ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:8.045em;"><span class="stl_15 stl_16 stl_447" style="word-spacing:-0.2923em;">i f</span><span class="stl_15 stl_16 stl_447" style="word-spacing:0.4141em;">&nbsp;</span><span class="stl_10 stl_11 stl_447" style="word-spacing:0.4141em;">(</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2443em;">&nbsp;nwritten</span><span class="stl_10 stl_11 stl_447" style="word-spacing:0.2922em;">&nbsp;!= (</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2994em;">&nbsp;</span><span class="stl_15 stl_16 stl_447" style="word-spacing:-0.2994em;">signed</span><span class="stl_15 stl_16 stl_447" style="word-spacing:-0.2989em;">&nbsp;</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2989em;">)</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2233em;">&nbsp;sdslen</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2233em;">&nbsp;(</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2193em;">&nbsp;server</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.1643em;">&nbsp;.</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2163em;">&nbsp;aof_buf</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2723em;">&nbsp;)</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2573em;">&nbsp;)</span><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.2573em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.4132em;"><span class="stl_58 stl_59 stl_138" style="word-spacing:0.2683em;">* Ooops</span><span class="stl_58 stl_59 stl_138" style="word-spacing:-0.2027em;">&nbsp;,</span><span class="stl_58 stl_59 stl_138" style="word-spacing:0.3383em;">&nbsp;we</span><span class="stl_58 stl_59 stl_138" style="word-spacing:0.2943em;">&nbsp;are</span><span class="stl_58 stl_59 stl_138" style="word-spacing:0.3793em;">&nbsp;in</span><span class="stl_58 stl_59 stl_138" style="word-spacing:0.4343em;">&nbsp;t</span><span class="stl_58 stl_59 stl_138" style="word-spacing:-0.2757em;">&nbsp;r</span><span class="stl_58 stl_59 stl_138" style="word-spacing:-0.2757em;">&nbsp;o</span><span class="stl_58 stl_59 stl_138" style="word-spacing:-0.2757em;">&nbsp;u</span><span class="stl_58 stl_59 stl_138" style="word-spacing:-0.2757em;">&nbsp;b</span><span class="stl_58 stl_59 stl_138" style="word-spacing:-0.2757em;">&nbsp;l</span><span class="stl_58 stl_59 stl_138" style="word-spacing:-0.2757em;">&nbsp;e</span><span class="stl_58 stl_59 stl_138" style="word-spacing:-0.2757em;">&nbsp;s</span><span class="stl_58 stl_59 stl_138" style="word-spacing:-0.1287em;">&nbsp;.</span><span class="stl_58 stl_59 stl_138" style="word-spacing:0.3423em;">&nbsp;The best</span><span class="stl_58 stl_59 stl_138" style="word-spacing:0.4388em;">&nbsp;thing to</span><span class="stl_58 stl_59 stl_138" style="word-spacing:0.3463em;">&nbsp;do &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:11.6675em;"><span class="stl_58 stl_59 stl_526" style="word-spacing:0.361em;">for now i</span><span class="stl_58 stl_59 stl_526" style="word-spacing:0.361em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 17.676em; left:11.4985em;"><span class="stl_58 stl_59 stl_558" style="word-spacing:0.3439em;">aborting instead of giving the</span><span class="stl_58 stl_59 stl_558" style="word-spacing:0.3794em;">&nbsp;i</span><span class="stl_58 stl_59 stl_558" style="word-spacing:-0.3446em;">&nbsp;l</span><span class="stl_58 stl_59 stl_558" style="word-spacing:-0.3446em;">&nbsp;l</span><span class="stl_58 stl_59 stl_558" style="word-spacing:-0.3446em;">&nbsp;u</span><span class="stl_58 stl_59 stl_558" style="word-spacing:-0.3446em;">&nbsp;s</span><span class="stl_58 stl_59 stl_558" style="word-spacing:-0.3456em;">&nbsp;i</span><span class="stl_58 stl_59 stl_558" style="word-spacing:-0.3446em;">&nbsp;o</span><span class="stl_58 stl_59 stl_558" style="word-spacing:-0.3446em;">&nbsp;n</span><span class="stl_58 stl_59 stl_558" style="word-spacing:0.3984em;">&nbsp;that &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:12.1658em;"><span class="stl_58 stl_59 stl_1012" style="word-spacing:0.3712em;">everything i</span><span class="stl_58 stl_59 stl_1012" style="word-spacing:0.3712em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:11.4695em;"><span class="stl_58 stl_59 stl_157" style="word-spacing:0.3372em;">working as expected</span><span class="stl_58 stl_59 stl_157" style="word-spacing:-0.1973em;">&nbsp;.</span><span class="stl_58 stl_59 stl_157" style="word-spacing:0.3357em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:10.0375em;z-index:391; "><span class="stl_15 stl_16 stl_832" style="word-spacing:-0.2284em;">i f</span><span class="stl_15 stl_16 stl_832" style="word-spacing:0.478em;">&nbsp;</span><span class="stl_10 stl_11 stl_832" style="word-spacing:0.478em;">(</span><span class="stl_10 stl_11 stl_832" style="word-spacing:-0.1804em;">&nbsp;nwritten</span><span class="stl_10 stl_11 stl_832" style="word-spacing:0.1966em;">&nbsp;==</span><span class="stl_10 stl_11 stl_832" style="word-spacing:0.1293em;">&nbsp;</span><span class="stl_107 stl_108 stl_832" style="word-spacing:0.1966em;">−</span><span class="stl_10 stl_11 stl_832" style="word-spacing:0.1293em;">1)</span><span class="stl_10 stl_11 stl_832" style="word-spacing:0.1293em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:11.9858em;"><span class="stl_10 stl_11 stl_852" style="word-spacing:-0.168em;">redisLog (REDIS_WARNING, ” Exiting ␣on␣ error ␣ writing ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:13.63em;"><span class="stl_10 stl_11 stl_374" style="word-spacing:-0.1855em;">to ␣ the ␣append</span><span class="stl_107 stl_108 stl_374" style="word-spacing:-0.1855em;">−</span><span class="stl_10 stl_11 stl_374" style="word-spacing:-0.1855em;">only ␣ f i l e : ␣%s ” , s t r e r r o r ( errno ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:11.9858em;"><span class="stl_10 stl_11 stl_1013" style="word-spacing:-0.1609em;">redisLog (REDIS_WARNING, ” Exiting ␣on␣ short ␣ write ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 25.6443em; left:13.6433em;"><span class="stl_10 stl_11 stl_1014" style="word-spacing:-0.3326em;">while ␣ writing ␣ to ␣” &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:23.3933em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 28.6335em; left:23.3933em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 26.641em; left:23.923em;z-index:572; "><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.145em;">the ␣append</span><span class="stl_107 stl_108 stl_395" style="word-spacing:-0.145em;">−</span><span class="stl_10 stl_11 stl_395" style="word-spacing:-0.145em;">only ␣ f i l e : ␣%s ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:25.5973em;"><span class="stl_10 stl_11 stl_514" style="word-spacing:-0.1127em;">nwritten=%ld , ␣” &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:23.9297em;"><span class="stl_10 stl_11 stl_756" style="word-spacing:-0.1555em;">expected=%ld ) ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:25.0883em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 29.6293em; left:23.4792em;"><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2873em;">s t r e r r o r ( errno ) , &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:23.4275em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 31.6218em; left:23.4275em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 30.621em; left:23.8867em;"><span class="stl_15 stl_16 stl_1015" style="word-spacing:-0.1847em;">long </span><span class="stl_10 stl_11 stl_1015" style="word-spacing:-0.1847em;">) nwritten , &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6168em; left:23.8867em;"><span class="stl_15 stl_16 stl_1016" style="word-spacing:-0.2537em;">long </span><span class="stl_10 stl_11 stl_1016" style="word-spacing:-0.2537em;">) sdslen ( server . &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:25.0758em;"><span class="stl_10 stl_11 stl_236" style="word-spacing:-0.2067em;">aof_buf ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:12.03em;"><span class="stl_15 stl_16 stl_334" style="word-spacing:-0.3351em;">i f</span><span class="stl_15 stl_16 stl_334" style="word-spacing:0.3713em;">&nbsp;</span><span class="stl_10 stl_11 stl_334" style="word-spacing:0.3713em;">(</span><span class="stl_10 stl_11 stl_334" style="word-spacing:-0.2631em;">&nbsp;ftruncate</span><span class="stl_10 stl_11 stl_334" style="word-spacing:-0.2631em;">&nbsp;(</span><span class="stl_10 stl_11 stl_334" style="word-spacing:-0.2621em;">&nbsp;server</span><span class="stl_10 stl_11 stl_334" style="word-spacing:-0.2071em;">&nbsp;.</span><span class="stl_10 stl_11 stl_334" style="word-spacing:-0.2641em;">&nbsp;aof_fd</span><span class="stl_10 stl_11 stl_334" style="word-spacing:-0.1801em;">&nbsp;,</span><span class="stl_10 stl_11 stl_334" style="word-spacing:0.3939em;">&nbsp;server</span><span class="stl_10 stl_11 stl_334" style="word-spacing:0.3939em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:13.6442em;z-index:733; "><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2179em;">aof_current_size )</span><span class="stl_10 stl_11 stl_550" style="word-spacing:0.1421em;">&nbsp;==</span><span class="stl_10 stl_11 stl_550" style="word-spacing:0.0885em;">&nbsp;</span><span class="stl_107 stl_108 stl_550" style="word-spacing:0.1421em;">−</span><span class="stl_10 stl_11 stl_550" style="word-spacing:0.0885em;">1)</span><span class="stl_10 stl_11 stl_550" style="word-spacing:0.0885em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:13.9783em;"><span class="stl_10 stl_11 stl_1017" style="word-spacing:-0.0967em;">redisLog (REDIS_WARNING,</span><span class="stl_10 stl_11 stl_1017" style="word-spacing:0.4983em;">&nbsp;”Could␣not␣remove␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:15.6425em;"><span class="stl_10 stl_11 stl_1018" style="word-spacing:-0.3248em;">short ␣ write ␣” &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:18.4117em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 40.5885em; left:18.4117em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 42.581em; left:18.4125em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 38.596em; left:18.9181em;"><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.2031em;">from␣ the ␣append</span><span class="stl_107 stl_108 stl_322" style="word-spacing:-0.2031em;">−</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.2031em;">only ␣ f i l e . ␣␣Redis␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:20.0067em;"><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.1427em;">may␣ r e f u s e ␣” &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:18.943em;"><span class="stl_10 stl_11 stl_526" style="word-spacing:-0.2332em;">to ␣ load ␣ the ␣AOF␣ the ␣next␣time␣ i t ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:20.155em;"><span class="stl_10 stl_11 stl_989" style="word-spacing:-0.2711em;">s t a r t s . ␣␣” &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:18.9746em;"><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.1667em;">ftruncate :</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.2587em;">&nbsp;␣%s</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.3037em;">&nbsp;”</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.1907em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:0.4043em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.3017em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.3027em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.3027em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.3027em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.3027em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.3017em;">&nbsp;o</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.3027em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.1967em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.2447em;">&nbsp;errno</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.2447em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.2587em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1006" style="word-spacing:-0.2587em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 44.5735em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 45.5702em; left:10.0167em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.3048em;">e x i t (1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">114 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_950">/</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.6908em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.6908em;">更</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.13em;">&nbsp;新</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5404em;">&nbsp;</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5404em;">AOF</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5396em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5396em;">文</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.131em;">&nbsp;件 的 大</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.131em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:8.0175em;"><span class="stl_10 stl_11 stl_547" style="word-spacing:-0.1775em;">server .</span><span class="stl_10 stl_11 stl_547" style="word-spacing:-0.2005em;">&nbsp;aof_current_size</span><span class="stl_10 stl_11 stl_547" style="word-spacing:0.1185em;">&nbsp;+= nwritten</span><span class="stl_10 stl_11 stl_547" style="word-spacing:0.1185em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4207em;"><span class="stl_58 stl_59 stl_174">*</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.3306em;">&nbsp;</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.3306em;">当</span><span class="stl_17 stl_18 stl_174" style="word-spacing:0.3476em;">&nbsp;</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.3476em;">server</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.2052em;">&nbsp;.</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.2402em;">&nbsp;aof_buf</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.313em;">&nbsp;</span><span class="stl_17 stl_18 stl_174" style="word-spacing:0.313em;">足</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2912em;">&nbsp;够</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.3232em;">&nbsp;小</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2097em;">&nbsp;</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.2097em;">,</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.2441em;">&nbsp;</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2441em;">重</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2912em;">&nbsp;新</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2902em;">&nbsp;利</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2902em;">&nbsp;用</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2902em;">&nbsp;空</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2562em;">&nbsp;间，</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2562em;">&nbsp;防</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2902em;">&nbsp;止</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2902em;">&nbsp;频</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2902em;">&nbsp;繁</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2902em;">&nbsp;的</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2902em;">&nbsp;内</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2902em;">&nbsp;存</span><span class="stl_17 stl_18 stl_174" style="word-spacing:-0.2902em;">&nbsp;分 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.9223em; left:9.6692em;"><span class="stl_17 stl_18 stl_79">配。 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:7.9808em;"><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2592em;">相 反，</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2582em;">&nbsp;当</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:0.346em;">&nbsp;</span><span class="stl_58 stl_59 stl_1019" style="word-spacing:0.346em;">server</span><span class="stl_58 stl_59 stl_1019" style="word-spacing:-0.2072em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1019" style="word-spacing:-0.2422em;">&nbsp;aof_buf</span><span class="stl_58 stl_59 stl_1019" style="word-spacing:0.311em;">&nbsp;</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:0.311em;">占</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2932em;">&nbsp;据</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;大</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;量</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;空</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2582em;">&nbsp;间，</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2592em;">&nbsp;采</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;取</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;策</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;略</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;是</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;释</span><span class="stl_17 stl_18 stl_1019" style="word-spacing:-0.2922em;">&nbsp;放 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.6417em;"><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.2793em;">空 间，</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.2793em;">&nbsp;可</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.3123em;">&nbsp;见</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:0.3373em;">&nbsp;</span><span class="stl_58 stl_59 stl_1020" style="word-spacing:0.3373em;">redis</span><span class="stl_58 stl_59 stl_1020" style="word-spacing:0.3369em;">&nbsp;</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:0.3369em;">对</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.3133em;">&nbsp;内</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.3123em;">&nbsp;存</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.3123em;">&nbsp;很</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.3123em;">&nbsp;敏</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.2783em;">&nbsp;感。</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.3194em;">&nbsp;</span><span class="stl_58 stl_59 stl_1020" style="word-spacing:-0.3194em;">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;z-index:163; "><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.3402em;">* Re</span><span class="stl_107 stl_108 stl_1021" style="word-spacing:0.3402em;">−</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.3402em;">use</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.2862em;">&nbsp;AOF</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.3452em;">&nbsp;b</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:-0.1638em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:-0.1638em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:-0.1638em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:-0.1638em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:-0.1638em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.4917em;">&nbsp;when i</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:-0.1348em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.6262em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:-0.1608em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.5652em;">&nbsp;small</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.4822em;">&nbsp;enough</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:-0.0958em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.4532em;">&nbsp;The</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.2982em;">&nbsp;maximum &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:10.1042em;"><span class="stl_58 stl_59 stl_992" style="word-spacing:0.3249em;">comes from</span><span class="stl_58 stl_59 stl_992" style="word-spacing:0.3919em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.4662em;"><span class="stl_58 stl_59 stl_93" style="word-spacing:0.4019em;">arena s</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.2871em;">&nbsp;i</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.2871em;">&nbsp;z</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.2871em;">&nbsp;e</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.4399em;">&nbsp;of</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.3209em;">&nbsp;4k</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.2809em;">&nbsp;minus</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.2509em;">&nbsp;some</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.2959em;">&nbsp;overhead</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.3519em;">&nbsp;(</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.2371em;">&nbsp;but</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.4289em;">&nbsp;i</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.2881em;">&nbsp;s</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.4439em;">&nbsp;otherwise &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:10.6817em;"><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.216em;">a r</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.215em;">&nbsp;b</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.216em;">&nbsp;i</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.215em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.215em;">&nbsp;r</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.215em;">&nbsp;a</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.216em;">&nbsp;r</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.215em;">&nbsp;y</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.12em;">&nbsp;)</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.126em;">&nbsp;.</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.438em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:8.045em;"><span class="stl_15 stl_16 stl_835" style="word-spacing:-0.3036em;">i f</span><span class="stl_15 stl_16 stl_835" style="word-spacing:0.4379em;">&nbsp;</span><span class="stl_10 stl_11 stl_835" style="word-spacing:0.4379em;">((</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.1986em;">&nbsp;sdslen</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2336em;">&nbsp;(</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2306em;">&nbsp;server</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.1746em;">&nbsp;.</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2276em;">&nbsp;aof_buf</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2826em;">&nbsp;)+s</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.3276em;">&nbsp;d</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.3276em;">&nbsp;s</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.3266em;">&nbsp;a</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.3276em;">&nbsp;v</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.3266em;">&nbsp;a</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.3276em;">&nbsp;i</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.3266em;">&nbsp;l</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2216em;">&nbsp;(</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2306em;">&nbsp;server</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.1756em;">&nbsp;.</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2276em;">&nbsp;aof_buf</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2836em;">&nbsp;)</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2686em;">&nbsp;)</span><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2686em;">&nbsp;&lt; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:9.6433em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 18.671em; left:10.1423em;"><span class="stl_10 stl_11 stl_433" style="word-spacing:0.297em;">000) { &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:10.0192em;"><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2783em;">s d s c l e a r ( server . aof_buf ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:10.0225em;"><span class="stl_10 stl_11 stl_835" style="word-spacing:-0.2726em;">s d s f r e e ( server . aof_buf ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 22.656em; left:10.01em;"><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.1504em;">server .</span><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.2034em;">&nbsp;aof_buf</span><span class="stl_10 stl_11 stl_178" style="word-spacing:0.1401em;">&nbsp;= sdsempty</span><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.2354em;">&nbsp;()</span><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.2354em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 25.646em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:8.4207em;"><span class="stl_58 stl_59 stl_672" style="word-spacing:-0.0197em;">* Don ’</span><span class="stl_58 stl_59 stl_672" style="word-spacing:-0.1973em;">&nbsp;t</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.4337em;">&nbsp;fsync</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.4947em;">&nbsp;i</span><span class="stl_58 stl_59 stl_672" style="word-spacing:-0.2333em;">&nbsp;f</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.3977em;">&nbsp;no</span><span class="stl_107 stl_108 stl_672" style="word-spacing:0.3977em;">−</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.3977em;">appendfsync</span><span class="stl_107 stl_108 stl_672" style="word-spacing:0.3977em;">−</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.3977em;">on</span><span class="stl_107 stl_108 stl_672" style="word-spacing:0.3977em;">−</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.3977em;">rewrite</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.4737em;">&nbsp;i</span><span class="stl_58 stl_59 stl_672" style="word-spacing:-0.2683em;">&nbsp;s</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.4602em;">&nbsp;set to</span><span class="stl_58 stl_59 stl_672" style="word-spacing:0.4017em;">&nbsp;yes &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:10.1017em;"><span class="stl_58 stl_59 stl_152" style="word-spacing:0.3265em;">and there</span><span class="stl_58 stl_59 stl_152" style="word-spacing:0.3745em;">&nbsp;are &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:9.5127em;"><span class="stl_58 stl_59 stl_131" style="word-spacing:0.3848em;">children doing</span><span class="stl_58 stl_59 stl_131" style="word-spacing:0.3458em;">&nbsp;I</span><span class="stl_58 stl_59 stl_131" style="word-spacing:-0.3182em;">&nbsp;/O</span><span class="stl_58 stl_59 stl_131" style="word-spacing:0.1568em;">&nbsp;in</span><span class="stl_58 stl_59 stl_131" style="word-spacing:0.3603em;">&nbsp;the background</span><span class="stl_58 stl_59 stl_131" style="word-spacing:-0.2222em;">&nbsp;.</span><span class="stl_58 stl_59 stl_131" style="word-spacing:0.3358em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 28.6285em; left:8.045em;"><span class="stl_15 stl_16 stl_878" style="word-spacing:-0.2539em;">i f</span><span class="stl_15 stl_16 stl_878" style="word-spacing:0.4525em;">&nbsp;</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.4525em;">(</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.1809em;">&nbsp;server</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.1249em;">&nbsp;.</span><span class="stl_10 stl_11 stl_878" style="word-spacing:-0.1819em;">&nbsp;aof_no_fsync_on_rewrite</span><span class="stl_10 stl_11 stl_878" style="word-spacing:0.1391em;">&nbsp;&amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:9.9783em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 29.6293em; left:10.508em;"><span class="stl_10 stl_11 stl_1022" style="word-spacing:-0.1592em;">server .</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:-0.1972em;">&nbsp;aof_child_pid</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:0.2908em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:0.1448em;">&nbsp;</span><span class="stl_107 stl_108 stl_1022" style="word-spacing:0.2908em;">−</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:0.1448em;">1</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:0.3298em;">&nbsp;|</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:-0.2492em;">&nbsp;|</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:0.4938em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:-0.1592em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:-0.2112em;">&nbsp;rdb_child_pid &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:11.5908em;z-index:597; "><span class="stl_10 stl_11 stl_1023" style="word-spacing:0.3352em;">!= </span><span class="stl_107 stl_108 stl_1023" style="word-spacing:0.3352em;">−</span><span class="stl_10 stl_11 stl_1023" style="word-spacing:0.3352em;">1)) &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6168em; left:11.9308em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:8.4207em;"><span class="stl_58 stl_59 stl_1024" style="word-spacing:0.3277em;">/ sync</span><span class="stl_58 stl_59 stl_1024" style="word-spacing:-0.1033em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1024" style="word-spacing:-0.1654em;">&nbsp;</span><span class="stl_17 stl_18 stl_1024" style="word-spacing:-0.1654em;">写</span><span class="stl_17 stl_18 stl_1024" style="word-spacing:-0.2113em;">&nbsp;入</span><span class="stl_17 stl_18 stl_1024" style="word-spacing:-0.2113em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_1024" style="word-spacing:-0.2113em;">&nbsp;盘 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:8.4207em;"><span class="stl_58 stl_59 stl_222" style="word-spacing:0.2913em;">* Perform</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3563em;">&nbsp;the</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.4123em;">&nbsp;fsync</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.4833em;">&nbsp;i</span><span class="stl_58 stl_59 stl_222" style="word-spacing:-0.2447em;">&nbsp;f</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.4453em;">&nbsp;needed</span><span class="stl_58 stl_59 stl_222" style="word-spacing:-0.2027em;">&nbsp;.</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3653em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:8.045em;"><span class="stl_15 stl_16 stl_1025" style="word-spacing:-0.057em;">i f</span><span class="stl_15 stl_16 stl_1025" style="word-spacing:0.6494em;">&nbsp;</span><span class="stl_10 stl_11 stl_1025" style="word-spacing:0.6494em;">(</span><span class="stl_10 stl_11 stl_1025" style="word-spacing:0.016em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1025" style="word-spacing:0.072em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1025" style="word-spacing:0.04em;">&nbsp;aof_fsync</span><span class="stl_10 stl_11 stl_1025" style="word-spacing:0.36em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1025" style="word-spacing:0.131em;">&nbsp;AOF_FSYNC_ALWAYS)</span><span class="stl_10 stl_11 stl_1025" style="word-spacing:0.131em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:10.4132em;"><span class="stl_58 stl_59 stl_668" style="word-spacing:0.2809em;">* aof_fsync</span><span class="stl_58 stl_59 stl_668" style="word-spacing:0.3829em;">&nbsp;i</span><span class="stl_58 stl_59 stl_668" style="word-spacing:-0.3261em;">&nbsp;s</span><span class="stl_58 stl_59 stl_668" style="word-spacing:0.4079em;">&nbsp;defined</span><span class="stl_58 stl_59 stl_668" style="word-spacing:0.3384em;">&nbsp;as fdatasync</span><span class="stl_58 stl_59 stl_668" style="word-spacing:-0.2291em;">&nbsp;()</span><span class="stl_58 stl_59 stl_668" style="word-spacing:0.3789em;">&nbsp;for</span><span class="stl_58 stl_59 stl_668" style="word-spacing:0.3209em;">&nbsp;Linux</span><span class="stl_58 stl_59 stl_668" style="word-spacing:0.3209em;">&nbsp;in &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:11.6442em;"><span class="stl_58 stl_59 stl_880" style="word-spacing:0.3535em;">order to avoid &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 38.5976em; left:11.5184em;"><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2625em;">f l</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2615em;">&nbsp;u</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2625em;">&nbsp;s</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2625em;">&nbsp;h</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2625em;">&nbsp;i</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2625em;">&nbsp;n</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.2615em;">&nbsp;g</span><span class="stl_58 stl_59 stl_940" style="word-spacing:0.4275em;">&nbsp;metadata</span><span class="stl_58 stl_59 stl_940" style="word-spacing:-0.1875em;">&nbsp;.</span><span class="stl_58 stl_59 stl_940" style="word-spacing:0.3825em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:9.9833em;"><span class="stl_10 stl_11 stl_547" style="word-spacing:-0.2654em;">aof_fsync (</span><span class="stl_10 stl_11 stl_547" style="word-spacing:-0.2324em;">&nbsp;server</span><span class="stl_10 stl_11 stl_547" style="word-spacing:-0.1774em;">&nbsp;.</span><span class="stl_10 stl_11 stl_547" style="word-spacing:-0.2244em;">&nbsp;aof_fd</span><span class="stl_10 stl_11 stl_547" style="word-spacing:-0.2804em;">&nbsp;)</span><span class="stl_10 stl_11 stl_547" style="word-spacing:-0.2154em;">&nbsp;;</span><span class="stl_10 stl_11 stl_547" style="word-spacing:0.3381em;">&nbsp;</span><span class="stl_58 stl_59 stl_547" style="word-spacing:0.3381em;">/*</span><span class="stl_58 stl_59 stl_547" style="word-spacing:0.2716em;">&nbsp;Let</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.1924em;">&nbsp;’</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.2894em;">&nbsp;s</span><span class="stl_58 stl_59 stl_547" style="word-spacing:0.3679em;">&nbsp;try to get</span><span class="stl_58 stl_59 stl_547" style="word-spacing:0.4226em;">&nbsp;t</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3144em;">&nbsp;h</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3134em;">&nbsp;i</span><span class="stl_58 stl_59 stl_547" style="word-spacing:-0.3134em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:11.64em;"><span class="stl_58 stl_59 stl_725" style="word-spacing:0.2891em;">data on the</span><span class="stl_58 stl_59 stl_725" style="word-spacing:0.3976em;">&nbsp;disk</span><span class="stl_58 stl_59 stl_725" style="word-spacing:0.3326em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:10.01em;"><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.1937em;">server .</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2177em;">&nbsp;aof_last_fsync</span><span class="stl_10 stl_11 stl_690" style="word-spacing:0.1323em;">&nbsp;=</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.0375em;">&nbsp;server .</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2337em;">&nbsp;unixtime</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2337em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:8.9892em;"><span class="stl_15 stl_16 stl_899" style="word-spacing:0.6304em;">else i</span><span class="stl_15 stl_16 stl_899" style="word-spacing:-0.0836em;">&nbsp;f</span><span class="stl_15 stl_16 stl_899" style="word-spacing:0.6563em;">&nbsp;</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.6563em;">((</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.0234em;">&nbsp;server</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.0434em;">&nbsp;.</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.0124em;">&nbsp;aof_fsync</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.3324em;">&nbsp;==</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.1214em;">&nbsp;AOF_FSYNC_EVERYSEC</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.1214em;">&nbsp;&amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:13.995em;"><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.1937em;">server .</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2337em;">&nbsp;unixtime</span><span class="stl_10 stl_11 stl_690" style="word-spacing:0.0863em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.0075em;">&nbsp;server .</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2177em;">&nbsp;aof_last_fsync</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2727em;">&nbsp;)</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2877em;">&nbsp;)</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2877em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5685em; left:10.0375em;"><span class="stl_15 stl_16 stl_140" style="word-spacing:-0.2782em;">i f</span><span class="stl_15 stl_16 stl_140" style="word-spacing:0.5005em;">&nbsp;</span><span class="stl_10 stl_11 stl_140" style="word-spacing:0.5005em;">(</span><span class="stl_10 stl_11 stl_140" style="word-spacing:-0.2772em;">&nbsp;!</span><span class="stl_10 stl_11 stl_140" style="word-spacing:-0.1722em;">&nbsp;sync_in_progress</span><span class="stl_10 stl_11 stl_140" style="word-spacing:-0.2452em;">&nbsp;)</span><span class="stl_10 stl_11 stl_140" style="word-spacing:0.3408em;">&nbsp;aof_background_fsync</span><span class="stl_10 stl_11 stl_140" style="word-spacing:-0.2592em;">&nbsp;(</span><span class="stl_10 stl_11 stl_140" style="word-spacing:-0.2052em;">&nbsp;server</span><span class="stl_10 stl_11 stl_140" style="word-spacing:-0.2052em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:11.6317em;"><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2103em;">aof_fd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.566em; left:10.01em;"><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.1937em;">server .</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2177em;">&nbsp;aof_last_fsync</span><span class="stl_10 stl_11 stl_690" style="word-spacing:0.1323em;">&nbsp;=</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.0375em;">&nbsp;server .</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2337em;">&nbsp;unixtime</span><span class="stl_10 stl_11 stl_690" style="word-spacing:-0.2337em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">13.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">细说更新缓存 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">115 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 6.7151em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.6716em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 9.6716em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">3.4 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">细说更新缓存 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.9493em; left:7.5658em;"><span class="stl_17 stl_18 stl_1026" style="word-spacing:0.119em;">上面两次提到了「更新缓存」，它即是 </span><span class="stl_10 stl_11 stl_1026" style="word-spacing:0.119em;">redis </span><span class="stl_17 stl_18 stl_1026" style="word-spacing:0.119em;">累积的数据变更。 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.9635em; left:7.5658em;z-index:82; "><span class="stl_17 stl_18 stl_446" style="word-spacing:-0.0257em;">更新缓存可以存储在 </span><span class="stl_10 stl_11 stl_446" style="word-spacing:-0.0257em;">server.aof_buf </span><span class="stl_17 stl_18 stl_446" style="word-spacing:-0.0257em;">中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_1027">，可</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.355em;">&nbsp;</span><span class="stl_17 stl_18 stl_22" style="word-spacing:-0.0256em;">以存储在 </span><span class="stl_10 stl_11 stl_22" style="word-spacing:-0.0256em;">server.server.aof_rewrite_buf_blocks &nbsp;</span></div>
					<div class="stl_01" style="top: 13.9601em; left:5.9058em;"><span class="stl_17 stl_18 stl_1028" style="word-spacing:0.0683em;">连表中。他们的关系是：每一次数据变更记录都会写入 </span><span class="stl_10 stl_11 stl_1028" style="word-spacing:0.0683em;">server.aof_buf </span><span class="stl_17 stl_18 stl_1028" style="word-spacing:0.0683em;">中，同时如果后 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.956em; left:5.9058em;"><span class="stl_17 stl_18 stl_1029" style="word-spacing:0.1158em;">台子进程在持久化，变更记录还会被写入 </span><span class="stl_10 stl_11 stl_1029" style="word-spacing:0.1158em;">server.server.aof_rewrite_buf_blocks </span><span class="stl_17 stl_18 stl_1029" style="word-spacing:0.1158em;">中。 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.9526em; left:5.9058em;z-index:250; "><span class="stl_10 stl_11 stl_1030" style="word-spacing:0.0389em;">server.aof_buf </span><span class="stl_17 stl_18 stl_1030" style="word-spacing:0.0389em;">会在特定时期写入指定文件，</span><span class="stl_10 stl_11 stl_1030" style="word-spacing:0.0389em;">server.server.aof_rewrite_buf_blocks </span><span class="stl_17 stl_18 stl_1030" style="word-spacing:0.0389em;">会 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.1707em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">在后台持久化结束后追加到文件。 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.9601em; left:7.5658em;z-index:317; "><span class="stl_10 stl_11 stl_533" style="word-spacing:-0.0123em;">redis </span><span class="stl_17 stl_18 stl_533" style="word-spacing:-0.0123em;">源码中是这么实现的：</span><span class="stl_10 stl_11 stl_533" style="word-spacing:-0.0123em;">propagrate()-&gt;feedAppendOnlyFile()-&gt;aofRewriteBuﬀerAppend() &nbsp;</span></div>
					<div class="stl_01" style="top: 20.971em; left:7.5658em;"><span class="stl_17 stl_18 stl_1031" style="word-spacing:0.0993em;">注释：</span><span class="stl_10 stl_11 stl_1031" style="word-spacing:0.0993em;">feedAppendOnlyFile() </span><span class="stl_17 stl_18 stl_1031" style="word-spacing:0.0993em;">会把更新添加到 </span><span class="stl_10 stl_11 stl_1031" style="word-spacing:0.0993em;">server.aof_buf</span><span class="stl_17 stl_18 stl_1031" style="word-spacing:0.0993em;">；接下来会有一个 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.9668em; left:5.9058em;"><span class="stl_17 stl_18 stl_24" style="word-spacing:0.1012em;">判断，如果存在 </span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.1012em;">AOF </span><span class="stl_17 stl_18 stl_24" style="word-spacing:0.1012em;">子进程，则调用 </span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.1012em;">aofRewriteBuﬀerAppend() </span><span class="stl_17 stl_18 stl_24" style="word-spacing:0.1012em;">将 </span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.1012em;">server.aof_buf &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9635em; left:5.9058em;"><span class="stl_17 stl_18 stl_156" style="word-spacing:0.084em;">中的所有数据插入到 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.084em;">server.aof_rewrite_buf_blocks </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.084em;">链表。 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4885em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.4851em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.4885em; left:6.4282em;"><span class="stl_58 stl_59 stl_950">/</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.6908em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.6908em;">向</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.54em;">&nbsp;</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.54em;">AOF</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5396em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5396em;">和</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1309em;">&nbsp;从 机 发 布 数 据 更</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1309em;">&nbsp;新 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4851em; left:6.4282em;"><span class="stl_58 stl_59 stl_671" style="word-spacing:0.3231em;">* Propagate</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.3881em;">&nbsp;the</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.4551em;">&nbsp;s</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;p</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2699em;">&nbsp;e</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;c</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;i</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;f</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;i</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2699em;">&nbsp;e</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;d</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.3321em;">&nbsp;command</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.2611em;">&nbsp;(</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2299em;">&nbsp;in</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.4161em;">&nbsp;the context of</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.4161em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 28.481em; left:7.7042em;"><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">s p</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3285em;">&nbsp;e</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">&nbsp;c</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">&nbsp;i</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">&nbsp;f</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">&nbsp;i</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3285em;">&nbsp;e</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">&nbsp;d</span><span class="stl_58 stl_59 stl_972" style="word-spacing:0.3945em;">&nbsp;database</span><span class="stl_58 stl_59 stl_972" style="word-spacing:0.3555em;">&nbsp;id</span><span class="stl_58 stl_59 stl_972" style="word-spacing:0.3555em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4776em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 30.4735em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 31.4701em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 32.466em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 33.4626em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 29.4776em; left:7.0002em;"><span class="stl_58 stl_59 stl_1032" style="word-spacing:0.234em;">to AOF</span><span class="stl_58 stl_59 stl_1032" style="word-spacing:0.168em;">&nbsp;and</span><span class="stl_58 stl_59 stl_1032" style="word-spacing:0.395em;">&nbsp;Slaves</span><span class="stl_58 stl_59 stl_1032" style="word-spacing:0.395em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4701em; left:7.0476em;"><span class="stl_58 stl_59 stl_1033" style="word-spacing:-0.2647em;">f l</span><span class="stl_58 stl_59 stl_1033" style="word-spacing:-0.2647em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1033" style="word-spacing:-0.2637em;">&nbsp;g</span><span class="stl_58 stl_59 stl_1033" style="word-spacing:-0.2647em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1033" style="word-spacing:0.4373em;">&nbsp;are</span><span class="stl_58 stl_59 stl_1033" style="word-spacing:0.3028em;">&nbsp;an xor</span><span class="stl_58 stl_59 stl_1033" style="word-spacing:0.3603em;">&nbsp;between</span><span class="stl_58 stl_59 stl_1033" style="word-spacing:0.3603em;">&nbsp;: &nbsp;</span></div>
					<div class="stl_01" style="top: 32.466em; left:6.8317em;"><span class="stl_58 stl_59 stl_774" style="word-spacing:0.1801em;">+ REDIS_PROPAGATE_NONE</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.3581em;">&nbsp;(no</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.5231em;">&nbsp;propagation</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.6091em;">&nbsp;of</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.4841em;">&nbsp;command at</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.6741em;">&nbsp;a</span><span class="stl_58 stl_59 stl_774" style="word-spacing:-0.0459em;">&nbsp;l</span><span class="stl_58 stl_59 stl_774" style="word-spacing:-0.046em;">&nbsp;l</span><span class="stl_58 stl_59 stl_774" style="word-spacing:-0.046em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:6.8317em;"><span class="stl_58 stl_59 stl_1034" style="word-spacing:0.1898em;">+ REDIS_PROPAGATE_AOF</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:0.3678em;">&nbsp;(</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:-0.0222em;">&nbsp;propagate</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:0.6238em;">&nbsp;into the</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:0.3998em;">&nbsp;AOF</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:0.4878em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:-0.0202em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:-0.0202em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:-0.0202em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:0.7758em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:-0.0392em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:0.7228em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1034" style="word-spacing:0.7228em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4593em; left:7.6675em;"><span class="stl_58 stl_59 stl_1016" style="word-spacing:-0.277em;">enabled ) &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4551em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 35.4551em; left:6.8317em;"><span class="stl_58 stl_59 stl_446" style="word-spacing:0.1836em;">+ REDIS_PROPAGATE_REPL</span><span class="stl_58 stl_59 stl_446" style="word-spacing:0.3616em;">&nbsp;(</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0354em;">&nbsp;propagate</span><span class="stl_58 stl_59 stl_446" style="word-spacing:0.6206em;">&nbsp;into the r</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;e</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0834em;">&nbsp;p</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;l</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;i</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0834em;">&nbsp;c</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;a</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0834em;">&nbsp;t</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;i</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;o</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0834em;">&nbsp;n</span><span class="stl_58 stl_59 stl_446" style="word-spacing:0.6786em;">&nbsp;l</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;i</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;n</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;k &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4518em; left:7.645em;"><span class="stl_58 stl_59 stl_07">)</span></div>
					<div class="stl_01" style="top: 37.4476em; left:5.955em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 38.4377em; left:5.9483em;"><span class="stl_15 stl_16 stl_469">void</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.3558em;">&nbsp;</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3558em;">propagate</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.1905em;">&nbsp;(</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.2074em;">&nbsp;</span><span class="stl_15 stl_16 stl_469" style="word-spacing:-0.2074em;">struct</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.3359em;">&nbsp;</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3359em;">redisCommand</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.2965em;">&nbsp;*cmd,</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.4569em;">&nbsp;</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.4569em;">int</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.3723em;">&nbsp;</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3723em;">dbid</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.0905em;">&nbsp;,</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.4875em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3935em;">&nbsp;** &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.4335em; left:7.6325em;"><span class="stl_10 stl_11 stl_672" style="word-spacing:-0.1085em;">argv ,</span><span class="stl_10 stl_11 stl_672" style="word-spacing:0.4309em;">&nbsp;</span><span class="stl_15 stl_16 stl_672" style="word-spacing:0.4309em;">int</span><span class="stl_15 stl_16 stl_672" style="word-spacing:0.3634em;">&nbsp;</span><span class="stl_10 stl_11 stl_672" style="word-spacing:0.3634em;">argc</span><span class="stl_10 stl_11 stl_672" style="word-spacing:0.3634em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4302em; left:13.4592em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.4231em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4231em;">f</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.277em;">&nbsp;l</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.277em;">&nbsp;a</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.277em;">&nbsp;g</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.276em;">&nbsp;s</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.276em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 41.431em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 42.4293em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4293em; left:8.4207em;"><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3497em;">/ AOF</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3904em;">&nbsp;</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.3904em;">策</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0193em;">&nbsp;略</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;需</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;要</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;打</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.0152em;">&nbsp;开， 且</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;设</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;置</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.3916em;">&nbsp;</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3916em;">AOF</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3902em;">&nbsp;</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.3902em;">传</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0193em;">&nbsp;播</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;标</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.0152em;">&nbsp;记， 将</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;更</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;新</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;发</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;布</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;给</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;本 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.6457em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">地 文 件 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4152em; left:8.045em;"><span class="stl_15 stl_16 stl_962" style="word-spacing:-0.1273em;">i f</span><span class="stl_15 stl_16 stl_962" style="word-spacing:0.5791em;">&nbsp;</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.5791em;">(</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.0543em;">&nbsp;server</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.0088em;">&nbsp;. aof_state</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.4677em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.2687em;">&nbsp;REDIS_AOF_OFF</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.1017em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.3477em;">&nbsp;f</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1333em;">&nbsp;l</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1333em;">&nbsp;a</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1323em;">&nbsp;g</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1333em;">&nbsp;s</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1333em;">&nbsp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:9.4775em;"><span class="stl_10 stl_11 stl_1036">REDIS_PROPAGATE_AOF) &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:9.9708em;"><span class="stl_10 stl_11 stl_1037" style="word-spacing:-0.1697em;">feedAppendOnlyFile (cmd, dbid , argv , argc ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 3.3893em; left:6.321em;"><span class="stl_10 stl_11 stl_07">16 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">设 置</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;了</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;传</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;播</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;标</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;记，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;将</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;更</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;发</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;布</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;给</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7102em; left:8.045em;"><span class="stl_15 stl_16 stl_1038" style="word-spacing:0.0949em;">i f</span><span class="stl_15 stl_16 stl_1038" style="word-spacing:0.8013em;">&nbsp;</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.8013em;">(</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.1939em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.0894em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.5999em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.3399em;">&nbsp;REDIS_PROPAGATE_REPL) &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:10.0108em;"><span class="stl_10 stl_11 stl_1039" style="word-spacing:-0.2277em;">replicationFeedSlaves ( server . slaves , dbid , argv , argc ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 10.7018em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:6.4282em;"><span class="stl_58 stl_59 stl_934">/</span><span class="stl_58 stl_59 stl_934" style="word-spacing:0.6898em;">&nbsp;</span><span class="stl_17 stl_18 stl_934" style="word-spacing:0.6898em;">将</span><span class="stl_17 stl_18 stl_934" style="word-spacing:0.1299em;">&nbsp;数 据 更 新 记 录 到</span><span class="stl_17 stl_18 stl_934" style="word-spacing:0.539em;">&nbsp;</span><span class="stl_58 stl_59 stl_934" style="word-spacing:0.539em;">AOF</span><span class="stl_58 stl_59 stl_934" style="word-spacing:0.5386em;">&nbsp;</span><span class="stl_17 stl_18 stl_934" style="word-spacing:0.5386em;">缓</span><span class="stl_17 stl_18 stl_934" style="word-spacing:0.1295em;">&nbsp;存</span><span class="stl_17 stl_18 stl_934" style="word-spacing:0.1295em;">&nbsp;中 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:5.9483em;"><span class="stl_15 stl_16 stl_582">void</span><span class="stl_15 stl_16 stl_582" style="word-spacing:0.3355em;">&nbsp;</span><span class="stl_10 stl_11 stl_582" style="word-spacing:0.3355em;">feedAppendOnlyFile</span><span class="stl_10 stl_11 stl_582" style="word-spacing:-0.2117em;">&nbsp;(</span><span class="stl_10 stl_11 stl_582" style="word-spacing:-0.2186em;">&nbsp;</span><span class="stl_15 stl_16 stl_582" style="word-spacing:-0.2186em;">struct</span><span class="stl_15 stl_16 stl_582" style="word-spacing:0.3256em;">&nbsp;</span><span class="stl_10 stl_11 stl_582" style="word-spacing:0.3256em;">redisCommand</span><span class="stl_10 stl_11 stl_582" style="word-spacing:0.2853em;">&nbsp;*cmd,</span><span class="stl_10 stl_11 stl_582" style="word-spacing:0.4456em;">&nbsp;</span><span class="stl_15 stl_16 stl_582" style="word-spacing:0.4456em;">int</span><span class="stl_15 stl_16 stl_582" style="word-spacing:0.4233em;">&nbsp;</span><span class="stl_10 stl_11 stl_582" style="word-spacing:0.4233em;">dictid</span><span class="stl_10 stl_11 stl_582" style="word-spacing:0.4233em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:8.1717em;"><span class="stl_10 stl_11 stl_85" style="word-spacing:0.3345em;">robj **argv</span><span class="stl_10 stl_11 stl_85" style="word-spacing:-0.1405em;">&nbsp;,</span><span class="stl_10 stl_11 stl_85" style="word-spacing:0.3982em;">&nbsp;</span><span class="stl_15 stl_16 stl_85" style="word-spacing:0.3982em;">int</span><span class="stl_15 stl_16 stl_85" style="word-spacing:0.3504em;">&nbsp;</span><span class="stl_10 stl_11 stl_85" style="word-spacing:0.3504em;">argc</span><span class="stl_10 stl_11 stl_85" style="word-spacing:-0.2425em;">&nbsp;)</span><span class="stl_10 stl_11 stl_85" style="word-spacing:-0.2425em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:7.9925em;"><span class="stl_10 stl_11 stl_507" style="word-spacing:0.3743em;">sds buf</span><span class="stl_10 stl_11 stl_507" style="word-spacing:0.1723em;">&nbsp;=</span><span class="stl_10 stl_11 stl_507" style="word-spacing:-0.0603em;">&nbsp;sdsempty ()</span><span class="stl_10 stl_11 stl_507" style="word-spacing:-0.0603em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.005em;"><span class="stl_10 stl_11 stl_831" style="word-spacing:0.3536em;">robj *tmpargv</span><span class="stl_10 stl_11 stl_831" style="word-spacing:-0.1494em;">&nbsp;[</span><span class="stl_10 stl_11 stl_831" style="word-spacing:-0.2124em;">&nbsp;3</span><span class="stl_10 stl_11 stl_831" style="word-spacing:-0.2124em;">&nbsp;]</span><span class="stl_10 stl_11 stl_831" style="word-spacing:-0.2124em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4207em;"><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.3585em;">* The</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.2135em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.3525em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1605em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1595em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1605em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.4405em;">&nbsp;command</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.3265em;">&nbsp;was</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.4815em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1735em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1735em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1725em;">&nbsp;g</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1735em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1725em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1735em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1735em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1725em;">&nbsp;g</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.5885em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:-0.1675em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.513em;">&nbsp;not the</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.421em;">&nbsp;same</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.421em;">&nbsp;as &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.6617em;"><span class="stl_58 stl_59 stl_1041" style="word-spacing:0.5892em;">the l</span><span class="stl_58 stl_59 stl_1041" style="word-spacing:-0.1357em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1041" style="word-spacing:-0.1357em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1041" style="word-spacing:-0.1347em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1041" style="word-spacing:0.4652em;">&nbsp;command &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.413em;"><span class="stl_58 stl_59 stl_1042" style="word-spacing:0.3594em;">we appendend</span><span class="stl_58 stl_59 stl_1042" style="word-spacing:-0.1206em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1042" style="word-spacing:0.3904em;">&nbsp;To issue</span><span class="stl_58 stl_59 stl_1042" style="word-spacing:0.4434em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1042" style="word-spacing:0.2444em;">&nbsp;SELECT</span><span class="stl_58 stl_59 stl_1042" style="word-spacing:0.1994em;">&nbsp;command</span><span class="stl_58 stl_59 stl_1042" style="word-spacing:0.4154em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1042" style="word-spacing:-0.1846em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1042" style="word-spacing:0.5054em;">&nbsp;needed</span><span class="stl_58 stl_59 stl_1042" style="word-spacing:-0.1086em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1042" style="word-spacing:0.4584em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:8.045em;"><span class="stl_15 stl_16 stl_841" style="word-spacing:-0.2984em;">i f</span><span class="stl_15 stl_16 stl_841" style="word-spacing:0.408em;">&nbsp;</span><span class="stl_10 stl_11 stl_841" style="word-spacing:0.408em;">(</span><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.2124em;">&nbsp;d</span><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.3174em;">&nbsp;i</span><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.3174em;">&nbsp;c</span><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.3174em;">&nbsp;t</span><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.3174em;">&nbsp;i</span><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.3174em;">&nbsp;d</span><span class="stl_10 stl_11 stl_841" style="word-spacing:0.3241em;">&nbsp;!= server</span><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.1694em;">&nbsp;.</span><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.2074em;">&nbsp;aof_selected_db</span><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.2634em;">&nbsp;)</span><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.2634em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:9.9267em;"><span class="stl_15 stl_16 stl_1043">char</span><span class="stl_15 stl_16 stl_1043" style="word-spacing:0.3384em;">&nbsp;</span><span class="stl_10 stl_11 stl_1043" style="word-spacing:0.3384em;">seldb</span><span class="stl_10 stl_11 stl_1043" style="word-spacing:-0.111em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1043" style="word-spacing:-0.24em;">&nbsp;6</span><span class="stl_10 stl_11 stl_1043" style="word-spacing:-0.239em;">&nbsp;4</span><span class="stl_10 stl_11 stl_1043" style="word-spacing:-0.24em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1043" style="word-spacing:-0.24em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:10.0175em;"><span class="stl_10 stl_11 stl_1002" style="word-spacing:-0.2286em;">s n p r i n t f ( seldb , </span><span class="stl_15 stl_16 stl_1002" style="word-spacing:-0.2286em;">sizeof </span><span class="stl_10 stl_11 stl_1002" style="word-spacing:-0.2286em;">( seldb ) , ”%d” , d i c t i d ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:9.97em;"><span class="stl_10 stl_11 stl_1044" style="word-spacing:0.2788em;">buf =</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:0.3398em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1702em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1712em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1712em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1702em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1712em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1702em;">&nbsp;p</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1712em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1712em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1702em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1712em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1702em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.0652em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1472em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.0142em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1032em;">&nbsp;”*2\</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1492em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1742em;">&nbsp;\n$6\</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1742em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1742em;">&nbsp;\nSELECT\</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1742em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1742em;">&nbsp;\n$%lu</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1562em;">&nbsp;\</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1742em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1742em;">&nbsp;\ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:11.5692em;"><span class="stl_10 stl_11 stl_1045" style="word-spacing:-0.091em;">n%s \ r \n” , &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:11.9708em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 25.6393em; left:12.415em;"><span class="stl_15 stl_16 stl_859" style="word-spacing:0.2831em;">unsigned long</span><span class="stl_15 stl_16 stl_859" style="word-spacing:-0.2518em;">&nbsp;</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.2518em;">)</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.1479em;">&nbsp;s</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.2519em;">&nbsp;t</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.2519em;">&nbsp;r</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.2519em;">&nbsp;l</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.2519em;">&nbsp;e</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.2519em;">&nbsp;n</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.1469em;">&nbsp;(</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.1819em;">&nbsp;seldb</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.1819em;">&nbsp;)</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.0959em;">&nbsp;,</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.1799em;">&nbsp;seldb</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.1819em;">&nbsp;)</span><span class="stl_10 stl_11 stl_859" style="word-spacing:-0.1819em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:10.01em;"><span class="stl_10 stl_11 stl_369" style="word-spacing:-0.1762em;">server .</span><span class="stl_10 stl_11 stl_369" style="word-spacing:-0.2152em;">&nbsp;aof_selected_db</span><span class="stl_10 stl_11 stl_369" style="word-spacing:0.1358em;">&nbsp;=</span><span class="stl_10 stl_11 stl_369" style="word-spacing:-0.1373em;">&nbsp;d i</span><span class="stl_10 stl_11 stl_369" style="word-spacing:-0.3242em;">&nbsp;c</span><span class="stl_10 stl_11 stl_369" style="word-spacing:-0.3242em;">&nbsp;t</span><span class="stl_10 stl_11 stl_369" style="word-spacing:-0.3242em;">&nbsp;i</span><span class="stl_10 stl_11 stl_369" style="word-spacing:-0.3242em;">&nbsp;d</span><span class="stl_10 stl_11 stl_369" style="word-spacing:-0.3242em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.6243em; left:8.045em;z-index:603; "><span class="stl_15 stl_16 stl_1046" style="word-spacing:-0.1047em;">i f</span><span class="stl_15 stl_16 stl_1046" style="word-spacing:0.6017em;">&nbsp;</span><span class="stl_10 stl_11 stl_1046" style="word-spacing:0.6017em;">(cmd</span><span class="stl_107 stl_108 stl_1046" style="word-spacing:0.6017em;">−</span><span class="stl_10 stl_11 stl_1046" style="word-spacing:0.6017em;">&gt;proc</span><span class="stl_10 stl_11 stl_1046" style="word-spacing:0.3023em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1046" style="word-spacing:0.2473em;">&nbsp;expireCommand</span><span class="stl_10 stl_11 stl_1046" style="word-spacing:0.5803em;">&nbsp;|</span><span class="stl_10 stl_11 stl_1046" style="word-spacing:-0.0657em;">&nbsp;|</span><span class="stl_10 stl_11 stl_1046" style="word-spacing:0.5273em;">&nbsp;cmd</span><span class="stl_107 stl_108 stl_1046" style="word-spacing:0.5273em;">−</span><span class="stl_10 stl_11 stl_1046" style="word-spacing:0.5273em;">&gt;proc</span><span class="stl_10 stl_11 stl_1046" style="word-spacing:0.3023em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:9.5975em;"><span class="stl_10 stl_11 stl_1047" style="word-spacing:0.5175em;">pexpireCommand |</span><span class="stl_10 stl_11 stl_1047" style="word-spacing:0.5175em;">&nbsp;| &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:9.885em;z-index:630; "><span class="stl_10 stl_11 stl_1048" style="word-spacing:0.2674em;">cmd</span><span class="stl_107 stl_108 stl_1048" style="word-spacing:0.2674em;">−</span><span class="stl_10 stl_11 stl_1048" style="word-spacing:0.2674em;">&gt;proc ==</span><span class="stl_10 stl_11 stl_1048" style="word-spacing:0.2254em;">&nbsp;expireatCommand</span><span class="stl_10 stl_11 stl_1048" style="word-spacing:-0.1496em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1048" style="word-spacing:-0.1496em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:10.4132em;"><span class="stl_58 stl_59 stl_287" style="word-spacing:0.5331em;">* Translate</span><span class="stl_58 stl_59 stl_287" style="word-spacing:0.4288em;">&nbsp;EXPIRE/PEXPIRE/EXPIREAT into</span><span class="stl_58 stl_59 stl_287" style="word-spacing:0.4288em;">&nbsp;PEXPIREAT &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:11.6em;"><span class="stl_58 stl_59 stl_71">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:9.97em;"><span class="stl_10 stl_11 stl_1049" style="word-spacing:0.2457em;">buf =</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.0096em;">&nbsp;catAppendOnlyExpireAtCommand (</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.1793em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.0473em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.2063em;">&nbsp;cmd,</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.1043em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.0873em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.1833em;">&nbsp;1</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.1843em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.1843em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:11.6308em;"><span class="stl_10 stl_11 stl_686" style="word-spacing:-0.1989em;">argv [ 2 ] ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.566em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 36.5985em; left:8.9892em;z-index:798; "><span class="stl_15 stl_16 stl_359" style="word-spacing:0.5997em;">else i</span><span class="stl_15 stl_16 stl_359" style="word-spacing:-0.1143em;">&nbsp;f</span><span class="stl_15 stl_16 stl_359" style="word-spacing:0.5905em;">&nbsp;</span><span class="stl_10 stl_11 stl_359" style="word-spacing:0.5905em;">(cmd</span><span class="stl_107 stl_108 stl_359" style="word-spacing:0.5905em;">−</span><span class="stl_10 stl_11 stl_359" style="word-spacing:0.5905em;">&gt;proc</span><span class="stl_10 stl_11 stl_359" style="word-spacing:0.2917em;">&nbsp;==</span><span class="stl_10 stl_11 stl_359" style="word-spacing:0.2277em;">&nbsp;setexCommand</span><span class="stl_10 stl_11 stl_359" style="word-spacing:0.5617em;">&nbsp;|</span><span class="stl_10 stl_11 stl_359" style="word-spacing:-0.0773em;">&nbsp;|</span><span class="stl_10 stl_11 stl_359" style="word-spacing:0.5177em;">&nbsp;cmd</span><span class="stl_107 stl_108 stl_359" style="word-spacing:0.5177em;">−</span><span class="stl_10 stl_11 stl_359" style="word-spacing:0.5177em;">&gt;proc</span><span class="stl_10 stl_11 stl_359" style="word-spacing:0.2917em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:9.5908em;"><span class="stl_10 stl_11 stl_1050" style="word-spacing:0.412em;">psetexCommand) { &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.5976em; left:10.4132em;"><span class="stl_58 stl_59 stl_428" style="word-spacing:0.5268em;">* Translate</span><span class="stl_58 stl_59 stl_428" style="word-spacing:0.4098em;">&nbsp;SETEX/PSETEX to SET</span><span class="stl_58 stl_59 stl_428" style="word-spacing:0.3461em;">&nbsp;and PEXPIREAT</span><span class="stl_58 stl_59 stl_428" style="word-spacing:0.3461em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:9.9425em;"><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.2027em;">tmpargv [</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.2657em;">&nbsp;0</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.2657em;">&nbsp;]</span><span class="stl_10 stl_11 stl_741" style="word-spacing:0.2453em;">&nbsp;=</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.0123em;">&nbsp;createStringObject (</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.2827em;">&nbsp;”SET”</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.1347em;">&nbsp;,3)</span><span class="stl_10 stl_11 stl_741" style="word-spacing:-0.1347em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:9.9425em;"><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1486em;">tmpargv [</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2116em;">&nbsp;1</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2116em;">&nbsp;]</span><span class="stl_10 stl_11 stl_611" style="word-spacing:0.2994em;">&nbsp;=</span><span class="stl_10 stl_11 stl_611" style="word-spacing:0.2094em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.0886em;">&nbsp;[</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1836em;">&nbsp;1</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1846em;">&nbsp;]</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1846em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:9.9425em;"><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1486em;">tmpargv [</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2116em;">&nbsp;2</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2116em;">&nbsp;]</span><span class="stl_10 stl_11 stl_611" style="word-spacing:0.2994em;">&nbsp;=</span><span class="stl_10 stl_11 stl_611" style="word-spacing:0.2094em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.0886em;">&nbsp;[</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1836em;">&nbsp;3</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1846em;">&nbsp;]</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1846em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:9.97em;"><span class="stl_10 stl_11 stl_492" style="word-spacing:0.2414em;">buf =</span><span class="stl_10 stl_11 stl_492" style="word-spacing:-0.0101em;">&nbsp;catAppendOnlyGenericCommand (</span><span class="stl_10 stl_11 stl_492" style="word-spacing:-0.1836em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_492" style="word-spacing:-0.0636em;">&nbsp;,</span><span class="stl_10 stl_11 stl_492" style="word-spacing:-0.2166em;">&nbsp;3</span><span class="stl_10 stl_11 stl_492" style="word-spacing:-0.0686em;">&nbsp;,</span><span class="stl_10 stl_11 stl_492" style="word-spacing:-0.1536em;">&nbsp;tmpargv</span><span class="stl_10 stl_11 stl_492" style="word-spacing:-0.1966em;">&nbsp;)</span><span class="stl_10 stl_11 stl_492" style="word-spacing:-0.1966em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:9.9642em;"><span class="stl_10 stl_11 stl_695" style="word-spacing:-0.1889em;">decrRefCount ( tmpargv [ 0 ] ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:9.97em;"><span class="stl_10 stl_11 stl_1049" style="word-spacing:0.2457em;">buf =</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.0096em;">&nbsp;catAppendOnlyExpireAtCommand (</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.1793em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.0473em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.2063em;">&nbsp;cmd,</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.1043em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.0873em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.1833em;">&nbsp;1</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.1843em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1049" style="word-spacing:-0.1843em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:11.6308em;"><span class="stl_10 stl_11 stl_686" style="word-spacing:-0.1989em;">argv [ 2 ] ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.561em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">13.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">细说更新缓存 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">117 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:10.4132em;"><span class="stl_58 stl_59 stl_1051" style="word-spacing:0.3899em;">* All</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:0.4504em;">&nbsp;the other</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:0.3439em;">&nbsp;commands</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:0.2709em;">&nbsp;don</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.1551em;">&nbsp;’</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.1741em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:0.4219em;">&nbsp;need t</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.2481em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.2471em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.2481em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.2481em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.2481em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.2481em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.2481em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.2481em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.2481em;">&nbsp;o</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:-0.2481em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1051" style="word-spacing:0.4409em;">&nbsp;or &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:11.6183em;"><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3592em;">need the &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:11.418em;"><span class="stl_58 stl_59 stl_925" style="word-spacing:0.379em;">same t</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.262em;">&nbsp;r</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.262em;">&nbsp;a</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.262em;">&nbsp;n</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.262em;">&nbsp;s</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.262em;">&nbsp;l</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.261em;">&nbsp;a</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.262em;">&nbsp;t</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.262em;">&nbsp;i</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.262em;">&nbsp;o</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.262em;">&nbsp;n</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.4495em;">&nbsp;already operated</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.413em;">&nbsp;in the</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.306em;">&nbsp;command &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:12.1625em;"><span class="stl_58 stl_59 stl_1052">vector &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 9.706em; left:11.501em;"><span class="stl_58 stl_59 stl_1053" style="word-spacing:0.3899em;">for the r</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3216em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3226em;">&nbsp;p</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3216em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3226em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3226em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3216em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3226em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3216em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3226em;">&nbsp;o</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3216em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:0.4954em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.2666em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.2676em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.2666em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.2676em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.2666em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.1206em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:0.3194em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:9.97em;"><span class="stl_10 stl_11 stl_1054" style="word-spacing:0.2307em;">buf =</span><span class="stl_10 stl_11 stl_1054" style="word-spacing:-0.0317em;">&nbsp;catAppendOnlyGenericCommand (</span><span class="stl_10 stl_11 stl_1054" style="word-spacing:-0.1943em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_1054" style="word-spacing:-0.0623em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1054" style="word-spacing:-0.1213em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_1054" style="word-spacing:-0.0273em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1054" style="word-spacing:-0.1193em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_1054" style="word-spacing:-0.1743em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1054" style="word-spacing:-0.1743em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_267">/</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.3045em;">&nbsp;</span><span class="stl_17 stl_18 stl_267" style="word-spacing:0.3045em;">将</span><span class="stl_17 stl_18 stl_267" style="word-spacing:-0.2563em;">&nbsp;生</span><span class="stl_17 stl_18 stl_267" style="word-spacing:-0.2553em;">&nbsp;成</span><span class="stl_17 stl_18 stl_267" style="word-spacing:-0.2553em;">&nbsp;的</span><span class="stl_17 stl_18 stl_267" style="word-spacing:0.154em;">&nbsp;</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.154em;">AOF</span><span class="stl_58 stl_59 stl_267" style="word-spacing:-0.1019em;">&nbsp;</span><span class="stl_17 stl_18 stl_267" style="word-spacing:-0.1019em;">追 加</span><span class="stl_17 stl_18 stl_267" style="word-spacing:-0.2553em;">&nbsp;到</span><span class="stl_17 stl_18 stl_267" style="word-spacing:0.3834em;">&nbsp;</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.3834em;">server</span><span class="stl_58 stl_59 stl_267" style="word-spacing:-0.1703em;">&nbsp;.</span><span class="stl_58 stl_59 stl_267" style="word-spacing:-0.2063em;">&nbsp;aof_buf</span><span class="stl_58 stl_59 stl_267" style="word-spacing:0.382em;">&nbsp;</span><span class="stl_17 stl_18 stl_267" style="word-spacing:0.382em;">中。</span><span class="stl_17 stl_18 stl_267" style="word-spacing:-0.1834em;">&nbsp;</span><span class="stl_58 stl_59 stl_267" style="word-spacing:-0.1834em;">server</span><span class="stl_58 stl_59 stl_267" style="word-spacing:-0.1713em;">&nbsp;.</span><span class="stl_58 stl_59 stl_267" style="word-spacing:-0.2079em;">&nbsp;</span><span class="stl_17 stl_18 stl_267" style="word-spacing:-0.2079em;">在</span><span class="stl_17 stl_18 stl_267" style="word-spacing:-0.2563em;">&nbsp;下</span><span class="stl_17 stl_18 stl_267" style="word-spacing:-0.2553em;">&nbsp;一</span><span class="stl_17 stl_18 stl_267" style="word-spacing:-0.2553em;">&nbsp;次 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:9.6417em;"><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2653em;">进 入</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;事</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;件</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;循</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;环</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;之</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2303em;">&nbsp;前，</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2273em;">&nbsp;</span><span class="stl_58 stl_59 stl_1022" style="word-spacing:-0.2273em;">aof_buf</span><span class="stl_58 stl_59 stl_1022" style="word-spacing:0.3395em;">&nbsp;</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:0.3395em;">中</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2653em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;内</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;容</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;将</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;会</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;写</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;到</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;盘</span><span class="stl_17 stl_18 stl_1022" style="word-spacing:-0.2643em;">&nbsp;上 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_612" style="word-spacing:0.3141em;">* Append</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.3741em;">&nbsp;to</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.4551em;">&nbsp;the</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.2451em;">&nbsp;AOF</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.2781em;">&nbsp;b</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2299em;">&nbsp;u</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2289em;">&nbsp;f</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2299em;">&nbsp;f</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2299em;">&nbsp;e</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2299em;">&nbsp;r</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.0829em;">&nbsp;.</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.4686em;">&nbsp;This w</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2049em;">&nbsp;i</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2049em;">&nbsp;l</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2039em;">&nbsp;l</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.4726em;">&nbsp;be f</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2359em;">&nbsp;l</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2369em;">&nbsp;u</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2369em;">&nbsp;s</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2369em;">&nbsp;h</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2369em;">&nbsp;e</span><span class="stl_58 stl_59 stl_612" style="word-spacing:-0.2369em;">&nbsp;d</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.4016em;">&nbsp;on</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.4016em;">&nbsp;disk &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:10.1917em;"><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.367em;">j u</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.367em;">&nbsp;s</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.367em;">&nbsp;t</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.373em;">&nbsp;before &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.4977em;"><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3166em;">of re</span><span class="stl_107 stl_108 stl_894" style="word-spacing:0.3166em;">−</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3166em;">entering</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3636em;">&nbsp;the event</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3326em;">&nbsp;loop</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.1404em;">&nbsp;,</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3556em;">&nbsp;so before the</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.4086em;">&nbsp;c</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3164em;">&nbsp;l</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3154em;">&nbsp;i</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3154em;">&nbsp;e</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3164em;">&nbsp;n</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3164em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:10.2092em;"><span class="stl_58 stl_59 stl_1055" style="word-spacing:-0.341em;">w i</span><span class="stl_58 stl_59 stl_1055" style="word-spacing:-0.341em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1055" style="word-spacing:-0.341em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1055" style="word-spacing:0.397em;">&nbsp;get</span><span class="stl_58 stl_59 stl_1055" style="word-spacing:0.397em;">&nbsp;a &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:9.5309em;"><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.3141em;">p o</span><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.3141em;">&nbsp;s</span><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.3141em;">&nbsp;i</span><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.3141em;">&nbsp;t</span><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.3141em;">&nbsp;i</span><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.3141em;">&nbsp;v</span><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.3141em;">&nbsp;e</span><span class="stl_58 stl_59 stl_369" style="word-spacing:0.4299em;">&nbsp;reply</span><span class="stl_58 stl_59 stl_369" style="word-spacing:0.3589em;">&nbsp;about the operation performed</span><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.2361em;">&nbsp;.</span><span class="stl_58 stl_59 stl_369" style="word-spacing:0.3239em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:8.045em;"><span class="stl_15 stl_16 stl_1056" style="word-spacing:-0.1252em;">i f</span><span class="stl_15 stl_16 stl_1056" style="word-spacing:0.5812em;">&nbsp;</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:0.5812em;">(</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:-0.0522em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:-0.0067em;">&nbsp;. aof_state</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:0.3038em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:0.0938em;">&nbsp;REDIS_AOF_ON) &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:10.01em;"><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.1867em;">server .</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.2397em;">&nbsp;aof_buf</span><span class="stl_10 stl_11 stl_401" style="word-spacing:0.1103em;">&nbsp;=</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.0784em;">&nbsp;sdscatlen (</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.2417em;">&nbsp;server</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.1867em;">&nbsp;.</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.2497em;">&nbsp;aof_buf</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.1697em;">&nbsp;,</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.2547em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.1777em;">&nbsp;,</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.1907em;">&nbsp;sdslen</span><span class="stl_10 stl_11 stl_401" style="word-spacing:-0.1907em;">&nbsp;( &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:11.63em;"><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.215em;">buf ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_305">/</span><span class="stl_58 stl_59 stl_305" style="word-spacing:0.3541em;">&nbsp;</span><span class="stl_17 stl_18 stl_305" style="word-spacing:0.3541em;">如</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2067em;">&nbsp;果</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;已</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;经</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;有</span><span class="stl_17 stl_18 stl_305" style="word-spacing:0.204em;">&nbsp;</span><span class="stl_58 stl_59 stl_305" style="word-spacing:0.204em;">AOF</span><span class="stl_58 stl_59 stl_305" style="word-spacing:-0.0028em;">&nbsp;</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.0028em;">子 进</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;程</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;运</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.1727em;">&nbsp;行，</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.1229em;">&nbsp;</span><span class="stl_58 stl_59 stl_305" style="word-spacing:-0.1229em;">redis</span><span class="stl_58 stl_59 stl_305" style="word-spacing:0.4434em;">&nbsp;</span><span class="stl_17 stl_18 stl_305" style="word-spacing:0.4434em;">采</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2067em;">&nbsp;取</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;的</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;策</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;略</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;是</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;累</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;积</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;子</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2057em;">&nbsp;进 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:9.6417em;"><span class="stl_17 stl_18 stl_1057">程</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:0.3903em;">&nbsp;</span><span class="stl_58 stl_59 stl_1057" style="word-spacing:0.3903em;">AOF</span><span class="stl_58 stl_59 stl_1057" style="word-spacing:0.3899em;">&nbsp;</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:0.3899em;">备</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;份</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;据</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;和</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;内</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;存</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;中</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;据</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;集</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;差</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:0.0143em;">&nbsp;异。 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:9.6475em;"><span class="stl_58 stl_59 stl_1058" style="word-spacing:-0.2434em;">aofRewriteBufferAppend ()</span><span class="stl_58 stl_59 stl_1058" style="word-spacing:0.3491em;">&nbsp;</span><span class="stl_17 stl_18 stl_1058" style="word-spacing:0.3491em;">把</span><span class="stl_17 stl_18 stl_1058" style="word-spacing:0.3453em;">&nbsp;</span><span class="stl_58 stl_59 stl_1058" style="word-spacing:0.3453em;">buf</span><span class="stl_58 stl_59 stl_1058" style="word-spacing:0.3454em;">&nbsp;</span><span class="stl_17 stl_18 stl_1058" style="word-spacing:0.3454em;">的</span><span class="stl_17 stl_18 stl_1058" style="word-spacing:-0.2784em;">&nbsp;内</span><span class="stl_17 stl_18 stl_1058" style="word-spacing:-0.2784em;">&nbsp;容</span><span class="stl_17 stl_18 stl_1058" style="word-spacing:-0.2784em;">&nbsp;追</span><span class="stl_17 stl_18 stl_1058" style="word-spacing:-0.2784em;">&nbsp;加</span><span class="stl_17 stl_18 stl_1058" style="word-spacing:-0.2784em;">&nbsp;到</span><span class="stl_17 stl_18 stl_1058" style="word-spacing:0.3596em;">&nbsp;</span><span class="stl_58 stl_59 stl_1058" style="word-spacing:0.3596em;">server</span><span class="stl_58 stl_59 stl_1058" style="word-spacing:0.3596em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:9.6567em;"><span class="stl_58 stl_59 stl_973">aof_rewrite_buf_blocks</span><span class="stl_58 stl_59 stl_973" style="word-spacing:0.332em;">&nbsp;</span><span class="stl_17 stl_18 stl_973" style="word-spacing:0.332em;">数</span><span class="stl_17 stl_18 stl_973" style="word-spacing:-0.286em;">&nbsp;组</span><span class="stl_17 stl_18 stl_973" style="word-spacing:-0.286em;">&nbsp;中 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_679" style="word-spacing:0.3535em;">* I</span><span class="stl_58 stl_59 stl_679" style="word-spacing:-0.3055em;">&nbsp;f</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.3385em;">&nbsp;a</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.2865em;">&nbsp;background append</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.3185em;">&nbsp;only</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.4565em;">&nbsp;f</span><span class="stl_58 stl_59 stl_679" style="word-spacing:-0.2605em;">&nbsp;i</span><span class="stl_58 stl_59 stl_679" style="word-spacing:-0.2605em;">&nbsp;l</span><span class="stl_58 stl_59 stl_679" style="word-spacing:-0.2605em;">&nbsp;e</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.4865em;">&nbsp;rewriting</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.4335em;">&nbsp;i</span><span class="stl_58 stl_59 stl_679" style="word-spacing:-0.3135em;">&nbsp;s</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.3975em;">&nbsp;in &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:9.6692em;"><span class="stl_58 stl_59 stl_417" style="word-spacing:0.297em;">progress we</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.229em;">&nbsp;want</span><span class="stl_58 stl_59 stl_417" style="word-spacing:0.323em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 32.6201em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 34.6126em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 30.6276em; left:9.4761em;"><span class="stl_58 stl_59 stl_963" style="word-spacing:0.3908em;">accumulate the</span><span class="stl_58 stl_59 stl_963" style="word-spacing:0.4498em;">&nbsp;d</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2742em;">&nbsp;i</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2732em;">&nbsp;f</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2742em;">&nbsp;f</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2742em;">&nbsp;e</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2742em;">&nbsp;r</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2732em;">&nbsp;e</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2742em;">&nbsp;n</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2742em;">&nbsp;c</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2742em;">&nbsp;e</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2732em;">&nbsp;s</span><span class="stl_58 stl_59 stl_963" style="word-spacing:0.4073em;">&nbsp;between the</span><span class="stl_58 stl_59 stl_963" style="word-spacing:0.4478em;">&nbsp;c</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2762em;">&nbsp;h</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2752em;">&nbsp;i</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2762em;">&nbsp;l</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2762em;">&nbsp;d</span><span class="stl_58 stl_59 stl_963" style="word-spacing:0.2378em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_963" style="word-spacing:0.1318em;">&nbsp;and &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:10.16em;"><span class="stl_58 stl_59 stl_922" style="word-spacing:0.3732em;">the current</span><span class="stl_58 stl_59 stl_922" style="word-spacing:0.3162em;">&nbsp;one &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:9.4836em;"><span class="stl_58 stl_59 stl_614" style="word-spacing:0.2901em;">in a buffer</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.0559em;">&nbsp;,</span><span class="stl_58 stl_59 stl_614" style="word-spacing:0.3591em;">&nbsp;so that</span><span class="stl_58 stl_59 stl_614" style="word-spacing:0.2956em;">&nbsp;when the</span><span class="stl_58 stl_59 stl_614" style="word-spacing:0.4041em;">&nbsp;c</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.3199em;">&nbsp;h</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.3189em;">&nbsp;i</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.3199em;">&nbsp;l</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.3199em;">&nbsp;d</span><span class="stl_58 stl_59 stl_614" style="word-spacing:0.4196em;">&nbsp;process w</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.2959em;">&nbsp;i</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.2959em;">&nbsp;l</span><span class="stl_58 stl_59 stl_614" style="word-spacing:-0.2949em;">&nbsp;l</span><span class="stl_58 stl_59 stl_614" style="word-spacing:0.3631em;">&nbsp;do &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:10.2125em;"><span class="stl_58 stl_59 stl_631" style="word-spacing:-0.178em;">i t</span><span class="stl_58 stl_59 stl_631" style="word-spacing:-0.178em;">&nbsp;s</span><span class="stl_58 stl_59 stl_631" style="word-spacing:0.49em;">&nbsp;work</span><span class="stl_58 stl_59 stl_631" style="word-spacing:0.328em;">&nbsp;we &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:9.4479em;"><span class="stl_58 stl_59 stl_281" style="word-spacing:0.3183em;">can append</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.3753em;">&nbsp;the</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.4603em;">&nbsp;d</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2637em;">&nbsp;i</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2627em;">&nbsp;f</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2637em;">&nbsp;f</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2637em;">&nbsp;e</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2637em;">&nbsp;r</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2627em;">&nbsp;e</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2637em;">&nbsp;n</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2637em;">&nbsp;c</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2637em;">&nbsp;e</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2627em;">&nbsp;s</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.4368em;">&nbsp;to the</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.3283em;">&nbsp;new</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.2793em;">&nbsp;append</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.3683em;">&nbsp;only</span><span class="stl_58 stl_59 stl_281" style="word-spacing:0.5063em;">&nbsp;f</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2107em;">&nbsp;i</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2107em;">&nbsp;l</span><span class="stl_58 stl_59 stl_281" style="word-spacing:-0.2107em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:10.1783em;"><span class="stl_58 stl_59 stl_07">.</span></div>
					<div class="stl_01" style="top: 35.6085em; left:11.1016em;"><span class="stl_58 stl_59 stl_132">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:8.045em;z-index:855; "><span class="stl_15 stl_16 stl_95" style="word-spacing:-0.2839em;">i f</span><span class="stl_15 stl_16 stl_95" style="word-spacing:0.4225em;">&nbsp;</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.4225em;">(</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.2109em;">&nbsp;server</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.1549em;">&nbsp;.</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.1919em;">&nbsp;aof_child_pid</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.2941em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.2414em;">&nbsp;</span><span class="stl_107 stl_108 stl_95" style="word-spacing:0.2941em;">−</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.2414em;">1) &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:9.9758em;"><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.1921em;">aofRewriteBufferAppend ((</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.254em;">&nbsp;</span><span class="stl_15 stl_16 stl_671" style="word-spacing:-0.254em;">unsigned</span><span class="stl_15 stl_16 stl_671" style="word-spacing:-0.0061em;">&nbsp;char</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.0061em;">*) buf</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.1221em;">&nbsp;,</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.135em;">&nbsp;sdslen</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.1901em;">&nbsp;(</span><span class="stl_10 stl_11 stl_671" style="word-spacing:-0.2351em;">&nbsp;buf &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:11.6383em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 38.596em; left:12.1365em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.016em;">) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:8.03em;"><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2525em;">s d s f r e e ( buf ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.5793em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5718em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:6.4282em;"><span class="stl_58 stl_59 stl_782">/</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.0287em;">&nbsp;</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.0287em;">将 数</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;据</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;更</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;新</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;记</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;录</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;写</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;入</span><span class="stl_17 stl_18 stl_782" style="word-spacing:0.3445em;">&nbsp;</span><span class="stl_58 stl_59 stl_782" style="word-spacing:0.3445em;">server</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.2088em;">&nbsp;.</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.2288em;">&nbsp;aof_rewrite_buf_blocks</span><span class="stl_58 stl_59 stl_782" style="word-spacing:-0.2765em;">&nbsp;</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2765em;">，</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;此</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;函</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;数</span><span class="stl_17 stl_18 stl_782" style="word-spacing:-0.2938em;">&nbsp;只 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:7.6492em;"><span class="stl_17 stl_18 stl_792">由</span><span class="stl_17 stl_18 stl_792" style="word-spacing:0.341em;">&nbsp;</span><span class="stl_58 stl_59 stl_792" style="word-spacing:0.341em;">feedAppendOnlyFile</span><span class="stl_58 stl_59 stl_792" style="word-spacing:-0.2317em;">&nbsp;()</span><span class="stl_58 stl_59 stl_792" style="word-spacing:0.3629em;">&nbsp;</span><span class="stl_17 stl_18 stl_792" style="word-spacing:0.3629em;">调</span><span class="stl_17 stl_18 stl_792" style="word-spacing:0.3629em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:6.4282em;"><span class="stl_58 stl_59 stl_804" style="word-spacing:0.2733em;">* Append</span><span class="stl_58 stl_59 stl_804" style="word-spacing:0.3213em;">&nbsp;data</span><span class="stl_58 stl_59 stl_804" style="word-spacing:0.4058em;">&nbsp;to the</span><span class="stl_58 stl_59 stl_804" style="word-spacing:0.2128em;">&nbsp;AOF rewrite</span><span class="stl_58 stl_59 stl_804" style="word-spacing:0.4513em;">&nbsp;buffer</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.0047em;">&nbsp;,</span><span class="stl_58 stl_59 stl_804" style="word-spacing:0.4843em;">&nbsp;a</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2617em;">&nbsp;l</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2627em;">&nbsp;l</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2617em;">&nbsp;o</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2617em;">&nbsp;c</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2617em;">&nbsp;a</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2627em;">&nbsp;t</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2617em;">&nbsp;i</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2617em;">&nbsp;n</span><span class="stl_58 stl_59 stl_804" style="word-spacing:-0.2617em;">&nbsp;g</span><span class="stl_58 stl_59 stl_804" style="word-spacing:0.3663em;">&nbsp;new &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5677em; left:7.69em;"><span class="stl_58 stl_59 stl_67" style="word-spacing:-0.3216em;">bl ocks</span><span class="stl_58 stl_59 stl_67" style="word-spacing:0.4724em;">&nbsp;i</span><span class="stl_58 stl_59 stl_67" style="word-spacing:-0.2756em;">&nbsp;f</span><span class="stl_58 stl_59 stl_67" style="word-spacing:0.4144em;">&nbsp;needed</span><span class="stl_58 stl_59 stl_67" style="word-spacing:-0.2336em;">&nbsp;.</span><span class="stl_58 stl_59 stl_67" style="word-spacing:0.3344em;">&nbsp;*/ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">118 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:5.9483em;"><span class="stl_15 stl_16 stl_468">void</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.3553em;">&nbsp;</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.3553em;">aofRewriteBufferAppend</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.3553em;">&nbsp;(</span><span class="stl_15 stl_16 stl_468" style="word-spacing:-0.192em;">unsigned</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.285em;">&nbsp;char</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.2941em;">&nbsp;</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.2941em;">*s</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.102em;">&nbsp;,</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.4028em;">&nbsp;</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.4028em;">unsigned</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.3em;">&nbsp;long &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:7.6742em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.275em;">len )</span><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.275em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">尾</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;插</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;法 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:8.01em;"><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.0087em;">listNode * ln</span><span class="stl_10 stl_11 stl_465" style="word-spacing:0.1458em;">&nbsp;=</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.1184em;">&nbsp;l i</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.3152em;">&nbsp;s</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.3142em;">&nbsp;t</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.3142em;">&nbsp;L</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.3152em;">&nbsp;a</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.3142em;">&nbsp;s</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.3152em;">&nbsp;t</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.2092em;">&nbsp;(</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.2372em;">&nbsp;server</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.1822em;">&nbsp;.</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.2192em;">&nbsp;aof_rewrite_buf_blocks</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.2742em;">&nbsp;)</span><span class="stl_10 stl_11 stl_465" style="word-spacing:-0.2742em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.9942em;z-index:160; "><span class="stl_10 stl_11 stl_438" style="word-spacing:0.3618em;">aofrwblock *</span><span class="stl_10 stl_11 stl_438" style="word-spacing:-0.2382em;">&nbsp;block</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.2258em;">&nbsp;= ln</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.3663em;">&nbsp;? ln</span><span class="stl_107 stl_108 stl_438" style="word-spacing:0.3663em;">−</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.3663em;">&gt;value</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.4728em;">&nbsp;:</span><span class="stl_10 stl_11 stl_438" style="word-spacing:0.2868em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:7.9483em;"><span class="stl_15 stl_16 stl_373">while</span><span class="stl_15 stl_16 stl_373" style="word-spacing:-0.2507em;">&nbsp;</span><span class="stl_10 stl_11 stl_373" style="word-spacing:-0.2507em;">(</span><span class="stl_10 stl_11 stl_373" style="word-spacing:-0.183em;">&nbsp;len</span><span class="stl_10 stl_11 stl_373" style="word-spacing:-0.182em;">&nbsp;)</span><span class="stl_10 stl_11 stl_373" style="word-spacing:-0.182em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:10.4132em;"><span class="stl_58 stl_59 stl_1059" style="word-spacing:0.3442em;">* I</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3148em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:0.3102em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:0.2712em;">&nbsp;already</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:0.3647em;">&nbsp;got at</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:0.4072em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3118em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3118em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3118em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3118em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:0.3242em;">&nbsp;an a</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3238em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3248em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3248em;">&nbsp;o</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3248em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3248em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3238em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3248em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.3248em;">&nbsp;d</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:0.3972em;">&nbsp;block</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:-0.0938em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1059" style="word-spacing:0.4022em;">&nbsp;try &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:12.1325em;"><span class="stl_58 stl_59 stl_350">appending &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 14.6876em; left:11.4836em;"><span class="stl_58 stl_59 stl_463" style="word-spacing:0.4332em;">at l</span><span class="stl_58 stl_59 stl_463" style="word-spacing:-0.2858em;">&nbsp;e</span><span class="stl_58 stl_59 stl_463" style="word-spacing:-0.2858em;">&nbsp;a</span><span class="stl_58 stl_59 stl_463" style="word-spacing:-0.2858em;">&nbsp;s</span><span class="stl_58 stl_59 stl_463" style="word-spacing:-0.2858em;">&nbsp;t</span><span class="stl_58 stl_59 stl_463" style="word-spacing:0.3542em;">&nbsp;some</span><span class="stl_58 stl_59 stl_463" style="word-spacing:0.3162em;">&nbsp;piece</span><span class="stl_58 stl_59 stl_463" style="word-spacing:0.4142em;">&nbsp;into</span><span class="stl_58 stl_59 stl_463" style="word-spacing:0.4672em;">&nbsp;i</span><span class="stl_58 stl_59 stl_463" style="word-spacing:-0.2708em;">&nbsp;t</span><span class="stl_58 stl_59 stl_463" style="word-spacing:-0.1238em;">&nbsp;.</span><span class="stl_58 stl_59 stl_463" style="word-spacing:0.3472em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:10.0375em;"><span class="stl_15 stl_16 stl_419" style="word-spacing:-0.3055em;">i f</span><span class="stl_15 stl_16 stl_419" style="word-spacing:0.4009em;">&nbsp;</span><span class="stl_10 stl_11 stl_419" style="word-spacing:0.4009em;">(</span><span class="stl_10 stl_11 stl_419" style="word-spacing:-0.2605em;">&nbsp;block</span><span class="stl_10 stl_11 stl_419" style="word-spacing:-0.2605em;">&nbsp;)</span><span class="stl_10 stl_11 stl_419" style="word-spacing:-0.2605em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:11.9175em;z-index:298; "><span class="stl_15 stl_16 stl_1060" style="word-spacing:0.3317em;">unsigned long</span><span class="stl_15 stl_16 stl_1060" style="word-spacing:0.4532em;">&nbsp;</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:0.4532em;">t</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.2053em;">&nbsp;h</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.2053em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.2053em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.2053em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.2053em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.2053em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:0.3057em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:0.2487em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.1633em;">&nbsp;block</span><span class="stl_107 stl_108 stl_1060" style="word-spacing:-0.1633em;">−</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.1633em;">&gt;f</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.2053em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.2053em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.2053em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:0.2892em;">&nbsp;&lt; len</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.1323em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1060" style="word-spacing:-0.1323em;">&nbsp;? &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:13.6258em;z-index:315; "><span class="stl_10 stl_11 stl_1061" style="word-spacing:-0.2355em;">block</span><span class="stl_107 stl_108 stl_1061" style="word-spacing:-0.2355em;">−</span><span class="stl_10 stl_11 stl_1061" style="word-spacing:-0.2355em;">&gt;f r</span><span class="stl_10 stl_11 stl_1061" style="word-spacing:-0.2345em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1061" style="word-spacing:-0.2345em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1061" style="word-spacing:0.51em;">&nbsp;: len</span><span class="stl_10 stl_11 stl_1061" style="word-spacing:0.51em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.666em; left:12.03em;z-index:334; "><span class="stl_15 stl_16 stl_177" style="word-spacing:-0.292em;">i f</span><span class="stl_15 stl_16 stl_177" style="word-spacing:0.4144em;">&nbsp;</span><span class="stl_10 stl_11 stl_177" style="word-spacing:0.4144em;">(</span><span class="stl_10 stl_11 stl_177" style="word-spacing:-0.2em;">&nbsp;t</span><span class="stl_10 stl_11 stl_177" style="word-spacing:-0.305em;">&nbsp;h</span><span class="stl_10 stl_11 stl_177" style="word-spacing:-0.304em;">&nbsp;i</span><span class="stl_10 stl_11 stl_177" style="word-spacing:-0.305em;">&nbsp;s</span><span class="stl_10 stl_11 stl_177" style="word-spacing:-0.305em;">&nbsp;l</span><span class="stl_10 stl_11 stl_177" style="word-spacing:-0.305em;">&nbsp;e</span><span class="stl_10 stl_11 stl_177" style="word-spacing:-0.305em;">&nbsp;n</span><span class="stl_10 stl_11 stl_177" style="word-spacing:-0.199em;">&nbsp;)</span><span class="stl_10 stl_11 stl_177" style="word-spacing:0.287em;">&nbsp;{</span><span class="stl_10 stl_11 stl_177" style="word-spacing:0.8417em;">&nbsp;</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.8417em;">/*</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.22em;">&nbsp;The</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.286em;">&nbsp;current</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.418em;">&nbsp;block i</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.307em;">&nbsp;s</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.392em;">&nbsp;not &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:13.6517em;"><span class="stl_58 stl_59 stl_174" style="word-spacing:0.4487em;">already f</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.2813em;">&nbsp;u</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.2813em;">&nbsp;l</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.2813em;">&nbsp;l</span><span class="stl_58 stl_59 stl_174" style="word-spacing:-0.1353em;">&nbsp;.</span><span class="stl_58 stl_59 stl_174" style="word-spacing:0.3157em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:13.8708em;z-index:397; "><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.1306em;">memcpy( block</span><span class="stl_107 stl_108 stl_1062" style="word-spacing:-0.1306em;">−</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.1306em;">&gt;buf+block</span><span class="stl_107 stl_108 stl_1062" style="word-spacing:-0.1306em;">−</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.1306em;">&gt;used</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.0246em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:0.4944em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.0376em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:0.5884em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.1726em;">&nbsp;h</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.1726em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.1716em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.1726em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.1726em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.1726em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.0666em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.0666em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:13.9583em;z-index:420; "><span class="stl_10 stl_11 stl_1063" style="word-spacing:0.2346em;">block</span><span class="stl_107 stl_108 stl_1063" style="word-spacing:0.2346em;">−</span><span class="stl_10 stl_11 stl_1063" style="word-spacing:0.2346em;">&gt;used +=</span><span class="stl_10 stl_11 stl_1063" style="word-spacing:0.3056em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1063" style="word-spacing:-0.1734em;">&nbsp;h</span><span class="stl_10 stl_11 stl_1063" style="word-spacing:-0.1744em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1063" style="word-spacing:-0.1744em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1063" style="word-spacing:-0.1744em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1063" style="word-spacing:-0.1744em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1063" style="word-spacing:-0.1744em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1063" style="word-spacing:-0.1744em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:13.9583em;z-index:447; "><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1653em;">block</span><span class="stl_107 stl_108 stl_1044" style="word-spacing:-0.1653em;">−</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1653em;">&gt;f r</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1653em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1663em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:0.2577em;">&nbsp;</span><span class="stl_107 stl_108 stl_1044" style="word-spacing:-0.1663em;">−</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:0.2577em;">=</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:0.3457em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1653em;">&nbsp;h</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1653em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1653em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1653em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1653em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1643em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1643em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:13.9608em;z-index:467; "><span class="stl_10 stl_11 stl_1064" style="word-spacing:0.5975em;">s += t</span><span class="stl_10 stl_11 stl_1064" style="word-spacing:0.1472em;">&nbsp;h i s l e n</span><span class="stl_10 stl_11 stl_1064" style="word-spacing:0.1472em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:13.9842em;"><span class="stl_10 stl_11 stl_127">len</span><span class="stl_10 stl_11 stl_127" style="word-spacing:0.1894em;">&nbsp;</span><span class="stl_107 stl_108 stl_127">−</span><span class="stl_10 stl_11 stl_127" style="word-spacing:0.1894em;">=</span><span class="stl_10 stl_11 stl_127" style="word-spacing:0.3096em;">&nbsp;t</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.2014em;">&nbsp;h</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.2014em;">&nbsp;i</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.2014em;">&nbsp;s</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.2014em;">&nbsp;l</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.2014em;">&nbsp;e</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.2014em;">&nbsp;n</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.2014em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.6285em; left:10.0375em;"><span class="stl_15 stl_16 stl_1065" style="word-spacing:-0.3239em;">i f</span><span class="stl_15 stl_16 stl_1065" style="word-spacing:0.3825em;">&nbsp;</span><span class="stl_10 stl_11 stl_1065" style="word-spacing:0.3825em;">(</span><span class="stl_10 stl_11 stl_1065" style="word-spacing:-0.2639em;">&nbsp;len</span><span class="stl_10 stl_11 stl_1065" style="word-spacing:-0.2639em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1065" style="word-spacing:0.2551em;">&nbsp;{</span><span class="stl_10 stl_11 stl_1065" style="word-spacing:0.2097em;">&nbsp;</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:0.2097em;">/*</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:0.3061em;">&nbsp;First</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:0.3734em;">&nbsp;block to al</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:-0.3499em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:-0.3489em;">&nbsp;oca</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:-0.3489em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:-0.3499em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:-0.0529em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:0.3361em;">&nbsp;or</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:0.2701em;">&nbsp;need &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:11.6433em;"><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.3685em;">another block</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.1965em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.3205em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:11.965em;"><span class="stl_15 stl_16 stl_273">int</span><span class="stl_15 stl_16 stl_273" style="word-spacing:0.3646em;">&nbsp;</span><span class="stl_10 stl_11 stl_273" style="word-spacing:0.3646em;">numblocks</span><span class="stl_10 stl_11 stl_273" style="word-spacing:0.3646em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:12.4057em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">创 建</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;节</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;点，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;插</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;到</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;尾</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;部 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:11.9792em;"><span class="stl_10 stl_11 stl_1067" style="word-spacing:0.1428em;">block = zmalloc</span><span class="stl_10 stl_11 stl_1067" style="word-spacing:-0.2637em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1067" style="word-spacing:-0.2542em;">&nbsp;</span><span class="stl_15 stl_16 stl_1067" style="word-spacing:-0.2542em;">sizeof</span><span class="stl_15 stl_16 stl_1067" style="word-spacing:-0.2565em;">&nbsp;</span><span class="stl_10 stl_11 stl_1067" style="word-spacing:-0.2565em;">(*</span><span class="stl_10 stl_11 stl_1067" style="word-spacing:-0.2647em;">&nbsp;block</span><span class="stl_10 stl_11 stl_1067" style="word-spacing:-0.2627em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1067" style="word-spacing:-0.2727em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1067" style="word-spacing:-0.2727em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:11.9658em;z-index:596; "><span class="stl_10 stl_11 stl_1068" style="word-spacing:0.0277em;">block</span><span class="stl_107 stl_108 stl_1068" style="word-spacing:0.0277em;">−</span><span class="stl_10 stl_11 stl_1068" style="word-spacing:0.0277em;">&gt;f r e e</span><span class="stl_10 stl_11 stl_1068" style="word-spacing:0.539em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1068" style="word-spacing:0.273em;">&nbsp;AOF_RW_BUF_BLOCK_SIZE; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:11.9658em;z-index:630; "><span class="stl_10 stl_11 stl_1069" style="word-spacing:0.2165em;">block</span><span class="stl_107 stl_108 stl_1069" style="word-spacing:0.2165em;">−</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:0.2165em;">&gt;used =</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:0.2675em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">尾</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;插</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;法 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:11.975em;"><span class="stl_10 stl_11 stl_826" style="word-spacing:-0.191em;">listAddNodeTail ( server . aof_rewrite_buf_blocks , &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:13.64em;"><span class="stl_10 stl_11 stl_703" style="word-spacing:-0.2375em;">block ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:12.4057em;"><span class="stl_58 stl_59 stl_282" style="word-spacing:0.2705em;">* Log</span><span class="stl_58 stl_59 stl_282" style="word-spacing:0.3295em;">&nbsp;every</span><span class="stl_58 stl_59 stl_282" style="word-spacing:0.3765em;">&nbsp;time</span><span class="stl_58 stl_59 stl_282" style="word-spacing:0.2825em;">&nbsp;we</span><span class="stl_58 stl_59 stl_282" style="word-spacing:0.3235em;">&nbsp;cross more</span><span class="stl_58 stl_59 stl_282" style="word-spacing:0.2585em;">&nbsp;10</span><span class="stl_58 stl_59 stl_282" style="word-spacing:0.3125em;">&nbsp;or 100</span><span class="stl_58 stl_59 stl_282" style="word-spacing:0.3575em;">&nbsp;blocks</span><span class="stl_58 stl_59 stl_282" style="word-spacing:0.3575em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:14.1808em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.0825em;">r e s p e c t i v e l y &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 43.5793em; left:13.4545em;"><span class="stl_58 stl_59 stl_95" style="word-spacing:0.2771em;">as a</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.3231em;">&nbsp;notice</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.3671em;">&nbsp;or</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.3181em;">&nbsp;warning</span><span class="stl_58 stl_59 stl_95" style="word-spacing:-0.2239em;">&nbsp;.</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.3451em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:11.9458em;"><span class="stl_10 stl_11 stl_931" style="word-spacing:0.0975em;">numblocks =</span><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.0711em;">&nbsp;listLength (</span><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.2395em;">&nbsp;server</span><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.2395em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:13.6325em;"><span class="stl_10 stl_11 stl_1022" style="word-spacing:-0.2243em;">aof_rewrite_buf_blocks ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.561em; left:12.03em;"><span class="stl_15 stl_16 stl_1070" style="word-spacing:-0.2035em;">i f</span><span class="stl_15 stl_16 stl_1070" style="word-spacing:0.5561em;">&nbsp;</span><span class="stl_10 stl_11 stl_1070" style="word-spacing:0.5561em;">(</span><span class="stl_10 stl_11 stl_1070" style="word-spacing:-0.2215em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1070" style="word-spacing:-0.2215em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1070" style="word-spacing:-0.1455em;">&nbsp;numblocks+1)</span><span class="stl_10 stl_11 stl_1070" style="word-spacing:0.1375em;">&nbsp;%</span><span class="stl_10 stl_11 stl_1070" style="word-spacing:0.2052em;">&nbsp;10) == 0)</span><span class="stl_10 stl_11 stl_1070" style="word-spacing:0.2052em;">&nbsp;{ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_29.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_29.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">13.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">细说更新缓存 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">119 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:13.9575em;"><span class="stl_15 stl_16 stl_938">int</span><span class="stl_15 stl_16 stl_938" style="word-spacing:0.4758em;">&nbsp;</span><span class="stl_10 stl_11 stl_938" style="word-spacing:0.4758em;">l</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.2253em;">&nbsp;e</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.2233em;">&nbsp;v</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.2243em;">&nbsp;e</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.2243em;">&nbsp;l</span><span class="stl_10 stl_11 stl_938" style="word-spacing:0.2877em;">&nbsp;=</span><span class="stl_10 stl_11 stl_938" style="word-spacing:0.2557em;">&nbsp;((</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.1793em;">&nbsp;numblocks+1)</span><span class="stl_10 stl_11 stl_938" style="word-spacing:0.1207em;">&nbsp;%</span><span class="stl_10 stl_11 stl_938" style="word-spacing:0.1892em;">&nbsp;100) ==</span><span class="stl_10 stl_11 stl_938" style="word-spacing:0.1347em;">&nbsp;0</span><span class="stl_10 stl_11 stl_938" style="word-spacing:0.1347em;">&nbsp;? &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:15.4642em;"><span class="stl_10 stl_11 stl_1071" style="word-spacing:0.5953em;">REDIS_WARNING : &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:34.2567em;"><span class="stl_10 stl_11 stl_546">REDIS_NOTICE &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:36.0933em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:13.9783em;"><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.1911em;">redisLog (</span><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.1671em;">&nbsp;level</span><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.1603em;">&nbsp;, ”Background␣AOF␣</span><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.2221em;">&nbsp;buffer</span><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.2221em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.2021em;">&nbsp;s</span><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.2521em;">&nbsp;i</span><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.2521em;">&nbsp;z</span><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.2521em;">&nbsp;e</span><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.0911em;">&nbsp;:</span><span class="stl_10 stl_11 stl_875" style="word-spacing:-0.2091em;">&nbsp;␣% &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:15.6375em;"><span class="stl_10 stl_11 stl_1072" style="word-spacing:0.0165em;">lu ␣MB”</span><span class="stl_10 stl_11 stl_1072" style="word-spacing:0.0165em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:15.9808em;"><span class="stl_10 stl_11 stl_403" style="word-spacing:-0.2514em;">aofRewriteBufferSize () /(1024*1024) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.6893em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 14.686em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6818em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 17.4768em; left:7.5658em;"><span class="stl_17 stl_18 stl_846" style="word-spacing:0.0893em;">一副可以缓解视力疲劳的图片——</span><span class="stl_10 stl_11 stl_846" style="word-spacing:0.0893em;">AOF </span><span class="stl_17 stl_18 stl_846" style="word-spacing:0.0893em;">持久化运作机制： &nbsp;</span></div>
					<div class="stl_01" style="top: 37.246em; left:7.5658em;"><span class="stl_17 stl_18 stl_1073" style="word-spacing:0.0907em;">两种数据落地的方式，就是 </span><span class="stl_10 stl_11 stl_1073" style="word-spacing:0.0907em;">AOF </span><span class="stl_17 stl_18 stl_1073" style="word-spacing:0.0907em;">的两个主线。因此，</span><span class="stl_10 stl_11 stl_1073" style="word-spacing:0.0907em;">redis AOF </span><span class="stl_17 stl_18 stl_1073" style="word-spacing:0.0907em;">持久化机制有 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.2418em; left:5.9058em;"><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0839em;">两条主线：后台执行和边服务边备份，抓住这两点就能理解 </span><span class="stl_10 stl_11 stl_659" style="word-spacing:0.0839em;">redis AOF </span><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0839em;">了。 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5565em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">这里有一个疑问，两条主 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.331em; left:5.9058em;"><span class="stl_17 stl_18 stl_1074" style="word-spacing:0.0839em;">线都会涉及文件的写：后台执行会写一个 </span><span class="stl_10 stl_11 stl_1074" style="word-spacing:0.0839em;">AOF </span><span class="stl_17 stl_18 stl_1074" style="word-spacing:0.0839em;">文件，边服务边备份也会写一个，以 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.549em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">哪个为准？ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:7.5658em;z-index:368; "><span class="stl_17 stl_18 stl_358">后台持久化的数据首先会被写入「</span><span class="stl_10 stl_11 stl_358">temp-rewriteaof-bg-%d.aof</span><span class="stl_17 stl_18 stl_358">」</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.749em;">&nbsp;</span><span class="stl_17 stl_18 stl_1075">，其</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.316em;">&nbsp;</span><span class="stl_17 stl_18 stl_1076" style="word-spacing:0.2411em;">中「</span><span class="stl_10 stl_11 stl_1076" style="word-spacing:0.2411em;">%d</span><span class="stl_17 stl_18 stl_1076" style="word-spacing:0.2411em;">」是 </span><span class="stl_10 stl_11 stl_1076" style="word-spacing:0.2411em;">AOF &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:5.9058em;z-index:389; "><span class="stl_17 stl_18 stl_1077" style="word-spacing:0.0519em;">子进程 </span><span class="stl_10 stl_11 stl_1077" style="word-spacing:0.0519em;">id</span><span class="stl_17 stl_18 stl_1077" style="word-spacing:0.0519em;">；待 </span><span class="stl_10 stl_11 stl_1077" style="word-spacing:0.0519em;">AOF </span><span class="stl_17 stl_18 stl_1077" style="word-spacing:0.0519em;">子进程结束后，「</span><span class="stl_10 stl_11 stl_1077" style="word-spacing:0.0519em;">temp-rewriteaof-bg-%d.aof</span><span class="stl_17 stl_18 stl_1077" style="word-spacing:0.0519em;">」会被以追加的方式打 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_1078" style="word-spacing:0.0686em;">开，继而写入 </span><span class="stl_10 stl_11 stl_1078" style="word-spacing:0.0686em;">server.aof_rewrite_buf_blocks </span><span class="stl_17 stl_18 stl_1078" style="word-spacing:0.0686em;">中的更新缓存，最后「</span><span class="stl_10 stl_11 stl_1078" style="word-spacing:0.0686em;">temp-rewriteaof- &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0806em;">bg-%d.aof</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0806em;">」文件被命名为 </span><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0806em;">server.aof_ﬁlename</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0806em;">，所以之前的名为 </span><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0806em;">server.aof_ﬁlename &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">的文件会被删除，也就是说边服务边备份写入的文件会被删除。边服务边备份的数据 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">120 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:5.9058em;"><span class="stl_17 stl_18 stl_287" style="word-spacing:0.084em;">会被一直写入到 </span><span class="stl_10 stl_11 stl_287" style="word-spacing:0.084em;">server.aof_ﬁlename </span><span class="stl_17 stl_18 stl_287" style="word-spacing:0.084em;">文件中。 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7801em; left:7.5658em;"><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0832em;">因此，确实会产生两个文件，但是最后都会变成 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0832em;">server.aof_ﬁlename </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0832em;">文件。 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.0623em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">这里还有一个疑问，既然有了后台持久化，为什么还要边服务边备份？边服务边 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.059em; left:5.9058em;"><span class="stl_17 stl_18 stl_1079">备份时间长了会产生数据冗余甚至备份过旧的数据，而后台持久化可以消除这些东 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.8326em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">西。看，这里是 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">的双保险。 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.5174em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 14.5174em; left:6.5789em;"><span class="stl_38 stl_13 stl_712" style="word-spacing:0.7576em;">3.5 AOF</span><span class="stl_38 stl_13 stl_712" style="word-spacing:0.1335em;">&nbsp;</span><span class="stl_39 stl_18 stl_712" style="word-spacing:0.1335em;">恢复过程 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.8868em; left:7.5658em;"><span class="stl_10 stl_11 stl_244" style="word-spacing:0.0849em;">AOF </span><span class="stl_17 stl_18 stl_244" style="word-spacing:0.0849em;">的数据恢复过程设计实在是棒极了，它模拟一个服务过程。</span><span class="stl_10 stl_11 stl_244" style="word-spacing:0.0849em;">redis </span><span class="stl_17 stl_18 stl_244" style="word-spacing:0.0849em;">首先虚拟 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.8826em; left:5.9058em;"><span class="stl_17 stl_18 stl_445" style="word-spacing:0.0872em;">一个客户端，读取 </span><span class="stl_10 stl_11 stl_445" style="word-spacing:0.0872em;">AOF </span><span class="stl_17 stl_18 stl_445" style="word-spacing:0.0872em;">文件恢复 </span><span class="stl_10 stl_11 stl_445" style="word-spacing:0.0872em;">redis </span><span class="stl_17 stl_18 stl_445" style="word-spacing:0.0872em;">命令和参数；然后就像服务客户端一样执行 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.8793em; left:5.9058em;"><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0809em;">命令相应的函数，从而恢复数据。这些过程主要在 </span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0809em;">loadAppendOnlyFile() </span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0809em;">中实现。 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.5076em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.5035em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.5076em; left:6.4282em;"><span class="stl_58 stl_59 stl_1057">/</span><span class="stl_58 stl_59 stl_1057" style="word-spacing:0.5411em;">&nbsp;</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:0.5411em;">加</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0197em;">&nbsp;载</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:0.3907em;">&nbsp;</span><span class="stl_58 stl_59 stl_1057" style="word-spacing:0.3907em;">AOF</span><span class="stl_58 stl_59 stl_1057" style="word-spacing:0.3899em;">&nbsp;</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:0.3899em;">文</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:0.0143em;">&nbsp;件， 恢</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;复</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1057" style="word-spacing:-0.0187em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.5035em; left:6.4282em;"><span class="stl_58 stl_59 stl_1080" style="word-spacing:0.3651em;">* Replay</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:0.4258em;">&nbsp;the append log</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:0.5711em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:-0.1719em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:-0.1719em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:-0.1719em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:-0.0249em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:0.3071em;">&nbsp;On error</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:0.2761em;">&nbsp;REDIS_OK</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:0.3091em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:-0.2249em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:0.4971em;">&nbsp;returned</span><span class="stl_58 stl_59 stl_1080" style="word-spacing:0.4971em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 23.5001em; left:8.0283em;"><span class="stl_58 stl_59 stl_915" style="word-spacing:0.3203em;">On non</span><span class="stl_58 stl_59 stl_915" style="word-spacing:0.5453em;">&nbsp;f</span><span class="stl_58 stl_59 stl_915" style="word-spacing:-0.0957em;">&nbsp;a</span><span class="stl_58 stl_59 stl_915" style="word-spacing:-0.0967em;">&nbsp;t</span><span class="stl_58 stl_59 stl_915" style="word-spacing:-0.0957em;">&nbsp;a</span><span class="stl_58 stl_59 stl_915" style="word-spacing:-0.0957em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 24.496em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 26.4885em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 24.496em; left:7.0069em;"><span class="stl_58 stl_59 stl_431" style="word-spacing:0.4346em;">error (</span><span class="stl_58 stl_59 stl_431" style="word-spacing:-0.1694em;">&nbsp;the</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.4081em;">&nbsp;append only</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.5426em;">&nbsp;f</span><span class="stl_58 stl_59 stl_431" style="word-spacing:-0.1744em;">&nbsp;i</span><span class="stl_58 stl_59 stl_431" style="word-spacing:-0.1744em;">&nbsp;l</span><span class="stl_58 stl_59 stl_431" style="word-spacing:-0.1744em;">&nbsp;e</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.5876em;">&nbsp;i</span><span class="stl_58 stl_59 stl_431" style="word-spacing:-0.2274em;">&nbsp;s</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.4726em;">&nbsp;zero</span><span class="stl_107 stl_108 stl_431" style="word-spacing:0.4726em;">−</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.4726em;">length</span><span class="stl_58 stl_59 stl_431" style="word-spacing:-0.1474em;">&nbsp;)</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.2486em;">&nbsp;REDIS_ERR</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.3126em;">&nbsp;i</span><span class="stl_58 stl_59 stl_431" style="word-spacing:0.3126em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 25.4926em; left:7.6667em;"><span class="stl_58 stl_59 stl_499" style="word-spacing:-0.1843em;">returned .</span><span class="stl_58 stl_59 stl_499" style="word-spacing:0.2507em;">&nbsp;On &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4885em; left:7.0509em;"><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.2693em;">f a</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.2703em;">&nbsp;t</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.2693em;">&nbsp;a</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.2703em;">&nbsp;l</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.4577em;">&nbsp;error</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.3187em;">&nbsp;an error</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.3782em;">&nbsp;message i</span><span class="stl_58 stl_59 stl_93" style="word-spacing:-0.2893em;">&nbsp;s</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.4457em;">&nbsp;logged</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.3361em;">&nbsp;and the</span><span class="stl_58 stl_59 stl_93" style="word-spacing:0.3361em;">&nbsp;program &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4851em; left:7.7108em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.197em;">e x</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.196em;">&nbsp;i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.195em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.196em;">&nbsp;t</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.196em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.049em;">&nbsp;.</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.435em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4743em; left:5.9875em;"><span class="stl_15 stl_16 stl_1081">int</span><span class="stl_15 stl_16 stl_1081" style="word-spacing:0.3453em;">&nbsp;</span><span class="stl_10 stl_11 stl_1081" style="word-spacing:0.3453em;">loadAppendOnlyFile</span><span class="stl_10 stl_11 stl_1081" style="word-spacing:0.3453em;">&nbsp;(</span><span class="stl_15 stl_16 stl_1081" style="word-spacing:-0.2496em;">char</span><span class="stl_15 stl_16 stl_1081" style="word-spacing:-0.0211em;">&nbsp;</span><span class="stl_10 stl_11 stl_1081" style="word-spacing:-0.0211em;">* filename</span><span class="stl_10 stl_11 stl_1081" style="word-spacing:-0.2116em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1081" style="word-spacing:-0.2116em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.471em; left:7.9725em;"><span class="stl_15 stl_16 stl_335">struct</span><span class="stl_15 stl_16 stl_335" style="word-spacing:0.3499em;">&nbsp;</span><span class="stl_10 stl_11 stl_335" style="word-spacing:0.3499em;">r</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3409em;">&nbsp;e</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3399em;">&nbsp;d</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3399em;">&nbsp;i</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3399em;">&nbsp;s</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3409em;">&nbsp;C</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3399em;">&nbsp;l</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3399em;">&nbsp;i</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3399em;">&nbsp;e</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3399em;">&nbsp;n</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3409em;">&nbsp;t</span><span class="stl_10 stl_11 stl_335" style="word-spacing:0.3101em;">&nbsp;*</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3049em;">&nbsp;fakeClient</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.3049em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4718em; left:7.9117em;"><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.0218em;">FILE * fp</span><span class="stl_10 stl_11 stl_274" style="word-spacing:0.1847em;">&nbsp;= fopen</span><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.2243em;">&nbsp;(</span><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.2153em;">&nbsp;filename</span><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.0433em;">&nbsp;,</span><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.2113em;">&nbsp;”</span><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.2683em;">&nbsp;r</span><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.2683em;">&nbsp;”</span><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.2663em;">&nbsp;)</span><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.2663em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4635em; left:7.9725em;"><span class="stl_15 stl_16 stl_973">struct</span><span class="stl_15 stl_16 stl_973" style="word-spacing:0.3384em;">&nbsp;</span><span class="stl_10 stl_11 stl_973" style="word-spacing:0.3384em;">redis_stat sb</span><span class="stl_10 stl_11 stl_973" style="word-spacing:0.3384em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4593em; left:7.98em;"><span class="stl_15 stl_16 stl_931">int</span><span class="stl_15 stl_16 stl_931" style="word-spacing:0.3214em;">&nbsp;</span><span class="stl_10 stl_11 stl_931" style="word-spacing:0.3214em;">old_aof_state</span><span class="stl_10 stl_11 stl_931" style="word-spacing:0.1325em;">&nbsp;=</span><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.017em;">&nbsp;server .</span><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.2045em;">&nbsp;aof_state</span><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.2045em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.456em; left:7.9467em;"><span class="stl_15 stl_16 stl_556">long</span><span class="stl_15 stl_16 stl_556" style="word-spacing:0.3299em;">&nbsp;</span><span class="stl_10 stl_11 stl_556" style="word-spacing:0.3299em;">loops</span><span class="stl_10 stl_11 stl_556" style="word-spacing:0.188em;">&nbsp;=</span><span class="stl_10 stl_11 stl_556" style="word-spacing:0.188em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4551em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.4551em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">文</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;不</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;能</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4951em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.05em;">0 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4452em; left:8.045em;"><span class="stl_15 stl_16 stl_800" style="word-spacing:-0.2209em;">i f</span><span class="stl_15 stl_16 stl_800" style="word-spacing:0.4855em;">&nbsp;</span><span class="stl_10 stl_11 stl_800" style="word-spacing:0.4855em;">(</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.1789em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_800" style="word-spacing:0.1971em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.0127em;">&nbsp;r e</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2459em;">&nbsp;d</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2459em;">&nbsp;i</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2468em;">&nbsp;s</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2459em;">&nbsp;_</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2459em;">&nbsp;f</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2469em;">&nbsp;s</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2459em;">&nbsp;t</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2459em;">&nbsp;a</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2459em;">&nbsp;t</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.1409em;">&nbsp;(</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.1149em;">&nbsp;f</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2199em;">&nbsp;i</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2199em;">&nbsp;l</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2199em;">&nbsp;e</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2199em;">&nbsp;n</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2209em;">&nbsp;o</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.1139em;">&nbsp;(</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.1789em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.1789em;">&nbsp;)</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2199em;">&nbsp;,&amp;sb</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.2078em;">&nbsp;)</span><span class="stl_10 stl_11 stl_800" style="word-spacing:0.3561em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_800" style="word-spacing:0.212em;">&nbsp;</span><span class="stl_107 stl_108 stl_800" style="word-spacing:0.3561em;">−</span><span class="stl_10 stl_11 stl_800" style="word-spacing:0.212em;">1</span><span class="stl_10 stl_11 stl_800" style="word-spacing:0.0641em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_800" style="word-spacing:0.1661em;">&nbsp;sb</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.1529em;">&nbsp;.</span><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.0979em;">&nbsp;st_size &nbsp;</span></div>
					<div class="stl_01" style="top: 37.446em; left:9.9583em;"><span class="stl_10 stl_11 stl_07">=</span></div>
					<div class="stl_01" style="top: 37.446em; left:10.5063em;"><span class="stl_10 stl_11 stl_265" style="word-spacing:0.128em;">= 0)</span><span class="stl_10 stl_11 stl_265" style="word-spacing:0.128em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4427em; left:10.01em;"><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.2em;">server .</span><span class="stl_10 stl_11 stl_729" style="word-spacing:-0.223em;">&nbsp;aof_current_size</span><span class="stl_10 stl_11 stl_729" style="word-spacing:0.127em;">&nbsp;=</span><span class="stl_10 stl_11 stl_729" style="word-spacing:0.147em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4385em; left:10.0367em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2687em;">f c l o s e ( fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4302em; left:9.9383em;"><span class="stl_15 stl_16 stl_857" style="word-spacing:0.3607em;">return </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.3607em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.431em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.4185em; left:8.045em;"><span class="stl_15 stl_16 stl_1082" style="word-spacing:-0.0143em;">i f</span><span class="stl_15 stl_16 stl_1082" style="word-spacing:0.6921em;">&nbsp;</span><span class="stl_10 stl_11 stl_1082" style="word-spacing:0.6921em;">(</span><span class="stl_10 stl_11 stl_1082" style="word-spacing:0.0277em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_1082" style="word-spacing:0.4037em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1082" style="word-spacing:0.2197em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_1082" style="word-spacing:0.2197em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:9.9933em;"><span class="stl_10 stl_11 stl_910" style="word-spacing:-0.1407em;">redisLog (REDIS_WARNING, ” Fatal ␣ error : ␣can ’ t ␣open␣ the ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:11.6025em;"><span class="stl_10 stl_11 stl_1083" style="word-spacing:-0.2238em;">append␣ log ␣ f i l e ␣ f o r ␣ reading : ␣%s ” , s t r e r r o r ( errno ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:10.0167em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.3048em;">e x i t (1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_27" style="word-spacing:0.532em;">13.5. AOF</span><span class="stl_21 stl_11 stl_27" style="word-spacing:0.0887em;">&nbsp;</span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0887em;">恢复过程 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">121 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_1035">/</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.5415em;">&nbsp;</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.5415em;">正</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0193em;">&nbsp;在</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;执</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;行</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.3909em;">&nbsp;</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3909em;">AOF</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3913em;">&nbsp;</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.3913em;">加</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0193em;">&nbsp;载</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;操</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.0147em;">&nbsp;作， 于</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;是</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;暂</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;时</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;禁</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;止</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.391em;">&nbsp;</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.391em;">AOF</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3903em;">&nbsp;</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.3903em;">的</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;所</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;有</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;操</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.0152em;">&nbsp;作，</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.0152em;">&nbsp;以 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.934em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">免 混 淆 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4207em;"><span class="stl_58 stl_59 stl_1084" style="word-spacing:0.3501em;">* Temporarily</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:0.4521em;">&nbsp;d</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:-0.2459em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:-0.2469em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:-0.2459em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:-0.2459em;">&nbsp;b</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:-0.2459em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:-0.2469em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:0.2821em;">&nbsp;AOF,</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:0.4471em;">&nbsp;to prevent</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:0.2341em;">&nbsp;EXEC</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:0.1781em;">&nbsp;from</span><span class="stl_58 stl_59 stl_1084" style="word-spacing:0.4031em;">&nbsp;feeding &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.5958em;"><span class="stl_58 stl_59 stl_1085" style="word-spacing:0.4545em;">a MULTI &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 10.7018em; left:9.4911em;"><span class="stl_58 stl_59 stl_432" style="word-spacing:0.4129em;">to the</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.3339em;">&nbsp;same</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.4249em;">&nbsp;f</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2161em;">&nbsp;i</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2161em;">&nbsp;l</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2161em;">&nbsp;e</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.4089em;">&nbsp;we</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2101em;">&nbsp;’</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.2261em;">&nbsp;re</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.3895em;">&nbsp;about to read</span><span class="stl_58 stl_59 stl_432" style="word-spacing:-0.1841em;">&nbsp;.</span><span class="stl_58 stl_59 stl_432" style="word-spacing:0.3749em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:8.0175em;"><span class="stl_10 stl_11 stl_1086" style="word-spacing:-0.0123em;">server .</span><span class="stl_10 stl_11 stl_1086" style="word-spacing:-0.0343em;">&nbsp;aof_state</span><span class="stl_10 stl_11 stl_1086" style="word-spacing:0.3167em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1086" style="word-spacing:0.1177em;">&nbsp;REDIS_AOF_OFF; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">虚 拟</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;出</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;客</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;户</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;端，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;即</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0222em;">&nbsp;</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0222em;">r e</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.362em;">&nbsp;d</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.361em;">&nbsp;i</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.361em;">&nbsp;s</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.361em;">&nbsp;C</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.361em;">&nbsp;l</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.361em;">&nbsp;i</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.361em;">&nbsp;e</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.362em;">&nbsp;n</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.362em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.0158em;"><span class="stl_10 stl_11 stl_1087" style="word-spacing:0.1352em;">fakeClient =</span><span class="stl_10 stl_11 stl_1087" style="word-spacing:-0.1257em;">&nbsp;createFakeClient ()</span><span class="stl_10 stl_11 stl_1087" style="word-spacing:-0.1257em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:8.0017em;"><span class="stl_10 stl_11 stl_372" style="word-spacing:-0.2641em;">startLoading ( fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:7.9483em;"><span class="stl_15 stl_16 stl_84">while</span><span class="stl_15 stl_16 stl_84" style="word-spacing:-0.2253em;">&nbsp;</span><span class="stl_10 stl_11 stl_84" style="word-spacing:-0.2253em;">(1)</span><span class="stl_10 stl_11 stl_84" style="word-spacing:-0.2253em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.666em; left:9.9725em;"><span class="stl_15 stl_16 stl_1088">int</span><span class="stl_15 stl_16 stl_1088" style="word-spacing:0.3513em;">&nbsp;</span><span class="stl_10 stl_11 stl_1088" style="word-spacing:0.3513em;">argc</span><span class="stl_10 stl_11 stl_1088" style="word-spacing:-0.0926em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1088" style="word-spacing:0.4664em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1088" style="word-spacing:0.4664em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:9.925em;"><span class="stl_15 stl_16 stl_824" style="word-spacing:0.3297em;">unsigned long</span><span class="stl_15 stl_16 stl_824" style="word-spacing:0.4181em;">&nbsp;</span><span class="stl_10 stl_11 stl_824" style="word-spacing:0.4181em;">len</span><span class="stl_10 stl_11 stl_824" style="word-spacing:0.4181em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:9.9975em;"><span class="stl_10 stl_11 stl_277" style="word-spacing:0.3327em;">robj **</span><span class="stl_10 stl_11 stl_277" style="word-spacing:-0.2993em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_277" style="word-spacing:-0.2993em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:9.9267em;"><span class="stl_15 stl_16 stl_164">char</span><span class="stl_15 stl_16 stl_164" style="word-spacing:0.3613em;">&nbsp;</span><span class="stl_10 stl_11 stl_164" style="word-spacing:0.3613em;">buf</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.101em;">&nbsp;[</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.198em;">&nbsp;1</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.197em;">&nbsp;2</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.197em;">&nbsp;8</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.197em;">&nbsp;]</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.197em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:9.985em;"><span class="stl_10 stl_11 stl_997" style="word-spacing:0.3456em;">sds argsds</span><span class="stl_10 stl_11 stl_997" style="word-spacing:0.3456em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:9.965em;"><span class="stl_15 stl_16 stl_1089">struct</span><span class="stl_15 stl_16 stl_1089" style="word-spacing:0.3829em;">&nbsp;</span><span class="stl_10 stl_11 stl_1089" style="word-spacing:0.3829em;">redisCommand</span><span class="stl_10 stl_11 stl_1089" style="word-spacing:0.3425em;">&nbsp;*cmd</span><span class="stl_10 stl_11 stl_1089" style="word-spacing:0.3425em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:10.4132em;"><span class="stl_58 stl_59 stl_1088">/</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:0.3182em;">&nbsp;</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:0.3182em;">每</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2426em;">&nbsp;循</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;环</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:0.3298em;">&nbsp;</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:0.3298em;">1000</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:0.3637em;">&nbsp;</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:0.3637em;">次，</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2086em;">&nbsp;在</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;恢</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;复</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;据</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;同</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2076em;">&nbsp;时，</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2086em;">&nbsp;服</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;务</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;器</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;也</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;为</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;客</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;户</span><span class="stl_17 stl_18 stl_1088" style="word-spacing:-0.2416em;">&nbsp;端 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:11.6342em;"><span class="stl_17 stl_18 stl_327" style="word-spacing:-0.2441em;">服 务。</span><span class="stl_17 stl_18 stl_327" style="word-spacing:-0.2318em;">&nbsp;</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.2318em;">aeProcessEvents</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.2391em;">&nbsp;()</span><span class="stl_58 stl_59 stl_327" style="word-spacing:0.3498em;">&nbsp;</span><span class="stl_17 stl_18 stl_327" style="word-spacing:0.3498em;">会</span><span class="stl_17 stl_18 stl_327" style="word-spacing:-0.2771em;">&nbsp;进</span><span class="stl_17 stl_18 stl_327" style="word-spacing:-0.2771em;">&nbsp;入</span><span class="stl_17 stl_18 stl_327" style="word-spacing:-0.2771em;">&nbsp;事</span><span class="stl_17 stl_18 stl_327" style="word-spacing:-0.2771em;">&nbsp;件</span><span class="stl_17 stl_18 stl_327" style="word-spacing:-0.2771em;">&nbsp;循</span><span class="stl_17 stl_18 stl_327" style="word-spacing:-0.2771em;">&nbsp;环 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6285em; left:10.0375em;"><span class="stl_15 stl_16 stl_1090" style="word-spacing:-0.2368em;">i f</span><span class="stl_15 stl_16 stl_1090" style="word-spacing:0.5499em;">&nbsp;</span><span class="stl_10 stl_11 stl_1090" style="word-spacing:0.5499em;">(</span><span class="stl_10 stl_11 stl_1090" style="word-spacing:-0.2268em;">&nbsp;!</span><span class="stl_10 stl_11 stl_1090" style="word-spacing:-0.2268em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1090" style="word-spacing:-0.0978em;">&nbsp;loops++</span><span class="stl_10 stl_11 stl_1090" style="word-spacing:-0.0498em;">&nbsp;%</span><span class="stl_10 stl_11 stl_1090" style="word-spacing:-0.0163em;">&nbsp;1000) )</span><span class="stl_10 stl_11 stl_1090" style="word-spacing:-0.0163em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:10.4132em;"><span class="stl_58 stl_59 stl_688" style="word-spacing:0.3225em;">* Serve</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.3875em;">&nbsp;the</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.4585em;">&nbsp;c</span><span class="stl_58 stl_59 stl_688" style="word-spacing:-0.2655em;">&nbsp;l</span><span class="stl_58 stl_59 stl_688" style="word-spacing:-0.2665em;">&nbsp;i</span><span class="stl_58 stl_59 stl_688" style="word-spacing:-0.2655em;">&nbsp;e</span><span class="stl_58 stl_59 stl_688" style="word-spacing:-0.2655em;">&nbsp;n</span><span class="stl_58 stl_59 stl_688" style="word-spacing:-0.2655em;">&nbsp;t</span><span class="stl_58 stl_59 stl_688" style="word-spacing:-0.2665em;">&nbsp;s</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.4035em;">&nbsp;from</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.3225em;">&nbsp;time</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.373em;">&nbsp;to time</span><span class="stl_58 stl_59 stl_688" style="word-spacing:0.3135em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:11.9942em;"><span class="stl_10 stl_11 stl_796" style="word-spacing:-0.283em;">loadingProgress ( f t e l l o ( fp ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:11.9775em;"><span class="stl_10 stl_11 stl_1091" style="word-spacing:-0.1297em;">aeProcessEvents (</span><span class="stl_10 stl_11 stl_1091" style="word-spacing:-0.0977em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1091" style="word-spacing:-0.0427em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1091" style="word-spacing:-0.0667em;">&nbsp;el</span><span class="stl_10 stl_11 stl_1091" style="word-spacing:0.0523em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1091" style="word-spacing:0.3473em;">&nbsp;AE_FILE_EVENTS| &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:13.4408em;"><span class="stl_10 stl_11 stl_1092" style="word-spacing:0.2443em;">AE_DONT_WAIT) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.6126em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:10.4132em;"><span class="stl_58 stl_59 stl_1093">/</span><span class="stl_58 stl_59 stl_1093" style="word-spacing:-0.0056em;">&nbsp;</span><span class="stl_17 stl_18 stl_1093" style="word-spacing:-0.0056em;">可 能</span><span class="stl_17 stl_18 stl_1093" style="word-spacing:0.3332em;">&nbsp;</span><span class="stl_58 stl_59 stl_1093" style="word-spacing:0.3332em;">aof</span><span class="stl_58 stl_59 stl_1093" style="word-spacing:0.3338em;">&nbsp;</span><span class="stl_17 stl_18 stl_1093" style="word-spacing:0.3338em;">文</span><span class="stl_17 stl_18 stl_1093" style="word-spacing:-0.286em;">&nbsp;件</span><span class="stl_17 stl_18 stl_1093" style="word-spacing:-0.285em;">&nbsp;到</span><span class="stl_17 stl_18 stl_1093" style="word-spacing:-0.285em;">&nbsp;了</span><span class="stl_17 stl_18 stl_1093" style="word-spacing:-0.285em;">&nbsp;结</span><span class="stl_17 stl_18 stl_1093" style="word-spacing:-0.285em;">&nbsp;尾 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:10.0375em;"><span class="stl_15 stl_16 stl_1094" style="word-spacing:-0.178em;">i f</span><span class="stl_15 stl_16 stl_1094" style="word-spacing:0.5284em;">&nbsp;</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:0.5284em;">(</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.088em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.193em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.192em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.193em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.193em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.087em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.172em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.04em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.0695em;">&nbsp;</span><span class="stl_15 stl_16 stl_1094" style="word-spacing:-0.0695em;">sizeof</span><span class="stl_15 stl_16 stl_1094" style="word-spacing:-0.1247em;">&nbsp;</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.1247em;">(</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.153em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.153em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.034em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.134em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.136em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:0.233em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:0.056em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:0.056em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:12.03em;"><span class="stl_15 stl_16 stl_123" style="word-spacing:-0.3em;">i f</span><span class="stl_15 stl_16 stl_123" style="word-spacing:0.4064em;">&nbsp;</span><span class="stl_10 stl_11 stl_123" style="word-spacing:0.4064em;">(</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.202em;">&nbsp;f</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.307em;">&nbsp;e</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.307em;">&nbsp;o</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.308em;">&nbsp;f</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.201em;">&nbsp;(</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.258em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.258em;">&nbsp;)</span><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.258em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:13.9025em;"><span class="stl_15 stl_16 stl_681" style="word-spacing:-0.1209em;">break </span><span class="stl_10 stl_11 stl_681" style="word-spacing:-0.1209em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:11.9783em;"><span class="stl_15 stl_16 stl_443">else &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5868em; left:13.9133em;"><span class="stl_15 stl_16 stl_497">goto</span><span class="stl_15 stl_16 stl_497" style="word-spacing:0.32em;">&nbsp;</span><span class="stl_10 stl_11 stl_497" style="word-spacing:0.32em;">readerr</span><span class="stl_10 stl_11 stl_497" style="word-spacing:0.32em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 42.5826em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:10.4132em;"><span class="stl_58 stl_59 stl_948">/</span><span class="stl_58 stl_59 stl_948" style="word-spacing:-0.0992em;">&nbsp;</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.0992em;">必 须</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.329em;">&nbsp;以</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.329em;">&nbsp;“</span><span class="stl_58 stl_59 stl_948" style="word-spacing:-0.329em;">*</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.329em;">”</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.33em;">&nbsp;开</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.296em;">&nbsp;头，</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.296em;">&nbsp;格</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.329em;">&nbsp;式</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.329em;">&nbsp;不</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.296em;">&nbsp;对，</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.296em;">&nbsp;退</span><span class="stl_17 stl_18 stl_948" style="word-spacing:-0.296em;">&nbsp;出 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5727em; left:10.0375em;"><span class="stl_15 stl_16 stl_1095" style="word-spacing:-0.2518em;">i f</span><span class="stl_15 stl_16 stl_1095" style="word-spacing:0.4546em;">&nbsp;</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.4546em;">(</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2268em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.1468em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2418em;">&nbsp;0</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2418em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.4207em;">&nbsp;!= ’</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2708em;">&nbsp;*</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.1628em;">&nbsp;’</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2148em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.3235em;">&nbsp;</span><span class="stl_15 stl_16 stl_1095" style="word-spacing:0.3235em;">goto</span><span class="stl_15 stl_16 stl_1095" style="word-spacing:0.3386em;">&nbsp;</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.3386em;">fmterr</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.3386em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5718em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:9.9842em;"><span class="stl_10 stl_11 stl_943" style="word-spacing:0.1622em;">argc =</span><span class="stl_10 stl_11 stl_943" style="word-spacing:-0.0146em;">&nbsp;atoi (</span><span class="stl_10 stl_11 stl_943" style="word-spacing:-0.2608em;">&nbsp;buf+1)</span><span class="stl_10 stl_11 stl_943" style="word-spacing:-0.2608em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">122 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;错</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;误 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:10.0375em;"><span class="stl_15 stl_16 stl_689" style="word-spacing:-0.2708em;">i f</span><span class="stl_15 stl_16 stl_689" style="word-spacing:0.4356em;">&nbsp;</span><span class="stl_10 stl_11 stl_689" style="word-spacing:0.4356em;">(</span><span class="stl_10 stl_11 stl_689" style="word-spacing:-0.2288em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_689" style="word-spacing:0.1482em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_689" style="word-spacing:0.1972em;">&nbsp;1)</span><span class="stl_10 stl_11 stl_689" style="word-spacing:0.3024em;">&nbsp;</span><span class="stl_15 stl_16 stl_689" style="word-spacing:0.3024em;">goto</span><span class="stl_15 stl_16 stl_689" style="word-spacing:0.3195em;">&nbsp;</span><span class="stl_10 stl_11 stl_689" style="word-spacing:0.3195em;">fmterr</span><span class="stl_10 stl_11 stl_689" style="word-spacing:0.3195em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;配</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:9.97em;"><span class="stl_10 stl_11 stl_703" style="word-spacing:0.126em;">argv =</span><span class="stl_10 stl_11 stl_703" style="word-spacing:-0.1161em;">&nbsp;zmalloc (</span><span class="stl_10 stl_11 stl_703" style="word-spacing:-0.2516em;">&nbsp;</span><span class="stl_15 stl_16 stl_703" style="word-spacing:-0.2516em;">sizeof</span><span class="stl_15 stl_16 stl_703" style="word-spacing:-0.2518em;">&nbsp;</span><span class="stl_10 stl_11 stl_703" style="word-spacing:-0.2518em;">(</span><span class="stl_10 stl_11 stl_703" style="word-spacing:-0.247em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_703" style="word-spacing:-0.248em;">&nbsp;*)</span><span class="stl_10 stl_11 stl_703" style="word-spacing:-0.327em;">&nbsp;*</span><span class="stl_10 stl_11 stl_703" style="word-spacing:-0.318em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_703" style="word-spacing:-0.263em;">&nbsp;)</span><span class="stl_10 stl_11 stl_703" style="word-spacing:-0.263em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">依</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;次</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;读</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:9.9733em;"><span class="stl_15 stl_16 stl_1096">for</span><span class="stl_15 stl_16 stl_1096" style="word-spacing:0.3966em;">&nbsp;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.3966em;">(</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:-0.1573em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2457em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.4787em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2187em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2447em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:-0.1353em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.4987em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.4987em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:12.03em;"><span class="stl_15 stl_16 stl_758" style="word-spacing:-0.1758em;">i f</span><span class="stl_15 stl_16 stl_758" style="word-spacing:0.5306em;">&nbsp;</span><span class="stl_10 stl_11 stl_758" style="word-spacing:0.5306em;">(</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.0858em;">&nbsp;f</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.1898em;">&nbsp;g</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.1908em;">&nbsp;e</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.1908em;">&nbsp;t</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.1908em;">&nbsp;s</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.0848em;">&nbsp;(</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.1698em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.0378em;">&nbsp;,</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.0673em;">&nbsp;</span><span class="stl_15 stl_16 stl_758" style="word-spacing:-0.0673em;">sizeof</span><span class="stl_15 stl_16 stl_758" style="word-spacing:-0.1225em;">&nbsp;</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.1225em;">(</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.1508em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.1508em;">&nbsp;)</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.0318em;">&nbsp;,</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.1318em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_758" style="word-spacing:-0.1338em;">&nbsp;)</span><span class="stl_10 stl_11 stl_758" style="word-spacing:0.2352em;">&nbsp;==</span><span class="stl_10 stl_11 stl_758" style="word-spacing:0.0582em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_758" style="word-spacing:0.3992em;">&nbsp;</span><span class="stl_15 stl_16 stl_758" style="word-spacing:0.3992em;">goto &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:13.6558em;"><span class="stl_10 stl_11 stl_1097" style="word-spacing:-0.2237em;">readerr ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:12.03em;"><span class="stl_15 stl_16 stl_1095" style="word-spacing:-0.2518em;">i f</span><span class="stl_15 stl_16 stl_1095" style="word-spacing:0.4546em;">&nbsp;</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.4546em;">(</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2268em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.1468em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2418em;">&nbsp;0</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2418em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.4207em;">&nbsp;!= ’</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2708em;">&nbsp;$</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.1628em;">&nbsp;’</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2148em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.3235em;">&nbsp;</span><span class="stl_15 stl_16 stl_1095" style="word-spacing:0.3235em;">goto</span><span class="stl_15 stl_16 stl_1095" style="word-spacing:0.3386em;">&nbsp;</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.3386em;">fmterr</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.3386em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:11.9917em;"><span class="stl_10 stl_11 stl_1098" style="word-spacing:0.2661em;">len =</span><span class="stl_10 stl_11 stl_1098" style="word-spacing:0.3151em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1098" style="word-spacing:-0.1969em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1098" style="word-spacing:-0.1959em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1098" style="word-spacing:-0.1959em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1098" style="word-spacing:-0.1969em;">&nbsp;o</span><span class="stl_10 stl_11 stl_1098" style="word-spacing:-0.1959em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1098" style="word-spacing:-0.0909em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1098" style="word-spacing:-0.1749em;">&nbsp;buf+1,NULL,</span><span class="stl_10 stl_11 stl_1098" style="word-spacing:-0.2299em;">&nbsp;10)</span><span class="stl_10 stl_11 stl_1098" style="word-spacing:-0.2299em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:11.9858em;"><span class="stl_10 stl_11 stl_582" style="word-spacing:0.2116em;">argsds = sdsnewlen</span><span class="stl_10 stl_11 stl_582" style="word-spacing:-0.2029em;">&nbsp;(NULL,</span><span class="stl_10 stl_11 stl_582" style="word-spacing:-0.1219em;">&nbsp;len</span><span class="stl_10 stl_11 stl_582" style="word-spacing:-0.1779em;">&nbsp;)</span><span class="stl_10 stl_11 stl_582" style="word-spacing:-0.1779em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:12.03em;"><span class="stl_15 stl_16 stl_214" style="word-spacing:-0.2402em;">i f</span><span class="stl_15 stl_16 stl_214" style="word-spacing:0.4662em;">&nbsp;</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.4662em;">(</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1802em;">&nbsp;len</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.1968em;">&nbsp;&amp;&amp; fread</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1772em;">&nbsp;(</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2032em;">&nbsp;argsds</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.0392em;">&nbsp;,</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1502em;">&nbsp;len</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.0592em;">&nbsp;,</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2672em;">&nbsp;1</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1182em;">&nbsp;,</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1552em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1982em;">&nbsp;)</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.1693em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.3327em;">&nbsp;</span><span class="stl_15 stl_16 stl_214" style="word-spacing:0.3327em;">goto &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:13.6433em;"><span class="stl_10 stl_11 stl_791" style="word-spacing:-0.2102em;">fmterr ; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:11.9625em;"><span class="stl_10 stl_11 stl_1099" style="word-spacing:-0.1197em;">argv [</span><span class="stl_10 stl_11 stl_1099" style="word-spacing:-0.0687em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1099" style="word-spacing:-0.0687em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1099" style="word-spacing:0.2953em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1099" style="word-spacing:0.2623em;">&nbsp;createObject</span><span class="stl_10 stl_11 stl_1099" style="word-spacing:-0.1427em;">&nbsp;(REDIS_STRING,</span><span class="stl_10 stl_11 stl_1099" style="word-spacing:-0.0917em;">&nbsp;argsds</span><span class="stl_10 stl_11 stl_1099" style="word-spacing:-0.1477em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1099" style="word-spacing:-0.1477em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:12.03em;"><span class="stl_15 stl_16 stl_635" style="word-spacing:-0.25em;">i f</span><span class="stl_15 stl_16 stl_635" style="word-spacing:0.4564em;">&nbsp;</span><span class="stl_10 stl_11 stl_635" style="word-spacing:0.4564em;">(</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.187em;">&nbsp;fread</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.187em;">&nbsp;(</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.244em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.127em;">&nbsp;,</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.28em;">&nbsp;2</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.135em;">&nbsp;,</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.28em;">&nbsp;1</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.134em;">&nbsp;,</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.168em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.208em;">&nbsp;)</span><span class="stl_10 stl_11 stl_635" style="word-spacing:0.1595em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_635" style="word-spacing:0.3233em;">&nbsp;</span><span class="stl_15 stl_16 stl_635" style="word-spacing:0.3233em;">goto</span><span class="stl_15 stl_16 stl_635" style="word-spacing:0.3404em;">&nbsp;</span><span class="stl_10 stl_11 stl_635" style="word-spacing:0.3404em;">fmterr</span><span class="stl_10 stl_11 stl_635" style="word-spacing:-0.145em;">&nbsp;;</span><span class="stl_10 stl_11 stl_635" style="word-spacing:0.3945em;">&nbsp;</span><span class="stl_58 stl_59 stl_635" style="word-spacing:0.3945em;">/* &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:13.6542em;"><span class="stl_58 stl_59 stl_1100" style="word-spacing:0.2846em;">discard CRLF</span><span class="stl_58 stl_59 stl_1100" style="word-spacing:0.2106em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 26.6426em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">找</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;相</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;应</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:10.4133em;"><span class="stl_58 stl_59 stl_677" style="word-spacing:0.3017em;">* Command</span><span class="stl_58 stl_59 stl_677" style="word-spacing:0.3577em;">&nbsp;lookup</span><span class="stl_58 stl_59 stl_677" style="word-spacing:0.4487em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:9.8842em;"><span class="stl_10 stl_11 stl_502" style="word-spacing:0.139em;">cmd =</span><span class="stl_10 stl_11 stl_502" style="word-spacing:0.177em;">&nbsp;lookupCommand(</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.161em;">&nbsp;argv[0]</span><span class="stl_107 stl_108 stl_502" style="word-spacing:-0.161em;">−</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.161em;">&gt;</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.198em;">&nbsp;ptr</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.141em;">&nbsp;)</span><span class="stl_10 stl_11 stl_502" style="word-spacing:-0.141em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6243em; left:10.0375em;"><span class="stl_15 stl_16 stl_962" style="word-spacing:-0.1273em;">i f</span><span class="stl_15 stl_16 stl_962" style="word-spacing:0.6513em;">&nbsp;</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.6513em;">(</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1263em;">&nbsp;!</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1333em;">&nbsp;cmd)</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1333em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:11.9858em;"><span class="stl_10 stl_11 stl_924" style="word-spacing:-0.0404em;">redisLog (REDIS_WARNING,</span><span class="stl_10 stl_11 stl_924" style="word-spacing:-0.0454em;">&nbsp;”Unknown␣command␣’%s</span><span class="stl_10 stl_11 stl_924" style="word-spacing:-0.032em;">&nbsp;’</span><span class="stl_10 stl_11 stl_924" style="word-spacing:-0.032em;">&nbsp;␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6168em; left:13.645em;"><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.2722em;">reading ␣</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.2902em;">&nbsp;the</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.2912em;">&nbsp;␣append␣</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.2852em;">&nbsp;only</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.2852em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.1752em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.2242em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.2242em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.2242em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.1602em;">&nbsp;”</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.1652em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.1652em;">&nbsp;(</span><span class="stl_15 stl_16 stl_1101" style="word-spacing:0.3698em;">char</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:0.3698em;">*)</span><span class="stl_10 stl_11 stl_1101" style="word-spacing:-0.2432em;">&nbsp;argv &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:13.5842em;"><span class="stl_10 stl_11 stl_07">[</span></div>
					<div class="stl_01" style="top: 32.6185em; left:13.8548em;z-index:541; "><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.2233em;">0]</span><span class="stl_107 stl_108 stl_789" style="word-spacing:-0.2233em;">−</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.2233em;">&gt; ptr ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:12.0092em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.3048em;">e x i t (1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 36.6051em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:10.4133em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">执 行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;命</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;令，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;模</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;拟</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;服</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;务</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;客</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;户</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;端</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;请</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;求</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;过</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;程，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;而</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;写</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:10.4133em;"><span class="stl_58 stl_59 stl_214" style="word-spacing:0.2357em;">* Run</span><span class="stl_58 stl_59 stl_214" style="word-spacing:0.3011em;">&nbsp;the command in</span><span class="stl_58 stl_59 stl_214" style="word-spacing:0.4357em;">&nbsp;the context of</span><span class="stl_58 stl_59 stl_214" style="word-spacing:0.3583em;">&nbsp;a fake</span><span class="stl_58 stl_59 stl_214" style="word-spacing:0.4907em;">&nbsp;c</span><span class="stl_58 stl_59 stl_214" style="word-spacing:-0.2412em;">&nbsp;l</span><span class="stl_58 stl_59 stl_214" style="word-spacing:-0.2423em;">&nbsp;i</span><span class="stl_58 stl_59 stl_214" style="word-spacing:-0.2413em;">&nbsp;e</span><span class="stl_58 stl_59 stl_214" style="word-spacing:-0.2412em;">&nbsp;n</span><span class="stl_58 stl_59 stl_214" style="word-spacing:-0.2412em;">&nbsp;t</span><span class="stl_58 stl_59 stl_214" style="word-spacing:0.4177em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:9.9983em;z-index:635; "><span class="stl_10 stl_11 stl_1102">fakeClient</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:-0.2782em;">&nbsp;</span><span class="stl_107 stl_108 stl_1102">−</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:-0.2782em;">&gt;argc</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:0.1754em;">&nbsp;= argc</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:0.1754em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:9.9983em;z-index:657; "><span class="stl_10 stl_11 stl_1103">fakeClient</span><span class="stl_10 stl_11 stl_1103" style="word-spacing:-0.2645em;">&nbsp;</span><span class="stl_107 stl_108 stl_1103">−</span><span class="stl_10 stl_11 stl_1103" style="word-spacing:-0.2645em;">&gt;argv</span><span class="stl_10 stl_11 stl_1103" style="word-spacing:0.1722em;">&nbsp;= argv</span><span class="stl_10 stl_11 stl_1103" style="word-spacing:0.1722em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:9.885em;z-index:672; "><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1605em;">cmd</span><span class="stl_107 stl_108 stl_323" style="word-spacing:-0.1605em;">−</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1605em;">&gt;proc ( fakeClient ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:10.4133em;"><span class="stl_58 stl_59 stl_177" style="word-spacing:0.2189em;">* The</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.2919em;">&nbsp;fake</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.4389em;">&nbsp;c</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2931em;">&nbsp;l</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2941em;">&nbsp;i</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2931em;">&nbsp;e</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2931em;">&nbsp;n</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2941em;">&nbsp;t</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.4309em;">&nbsp;should</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3384em;">&nbsp;not have</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.2679em;">&nbsp;a</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3279em;">&nbsp;reply</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3279em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:10.0133em;z-index:749; "><span class="stl_10 stl_11 stl_961" style="word-spacing:-0.2171em;">redisAssert (</span><span class="stl_10 stl_11 stl_961" style="word-spacing:-0.2351em;">&nbsp;fakeClient</span><span class="stl_10 stl_11 stl_961" style="word-spacing:-0.3001em;">&nbsp;</span><span class="stl_107 stl_108 stl_961" style="word-spacing:-0.2351em;">−</span><span class="stl_10 stl_11 stl_961" style="word-spacing:-0.3001em;">&gt;bufpos</span><span class="stl_10 stl_11 stl_961" style="word-spacing:0.1159em;">&nbsp;==</span><span class="stl_10 stl_11 stl_961" style="word-spacing:0.0609em;">&nbsp;0 &amp;&amp;</span><span class="stl_10 stl_11 stl_961" style="word-spacing:-0.0326em;">&nbsp;listLength</span><span class="stl_10 stl_11 stl_961" style="word-spacing:-0.0326em;">&nbsp;( &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:11.6583em;z-index:783; "><span class="stl_10 stl_11 stl_138">fakeClient</span><span class="stl_10 stl_11 stl_138" style="word-spacing:-0.2625em;">&nbsp;</span><span class="stl_107 stl_108 stl_138">−</span><span class="stl_10 stl_11 stl_138" style="word-spacing:-0.2625em;">&gt;reply</span><span class="stl_10 stl_11 stl_138" style="word-spacing:-0.1939em;">&nbsp;)</span><span class="stl_10 stl_11 stl_138" style="word-spacing:0.1526em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_138" style="word-spacing:0.1526em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.566em; left:10.0133em;z-index:857; "><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.0569em;">redisAssert ((</span><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.0749em;">&nbsp;fakeClient</span><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.1747em;">&nbsp;</span><span class="stl_107 stl_108 stl_873" style="word-spacing:-0.0749em;">−</span><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.1747em;">&gt;f</span><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.1739em;">&nbsp;l</span><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.1749em;">&nbsp;a</span><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.1749em;">&nbsp;g</span><span class="stl_10 stl_11 stl_873" style="word-spacing:-0.1739em;">&nbsp;s</span><span class="stl_10 stl_11 stl_873" style="word-spacing:0.3361em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_873" style="word-spacing:0.0871em;">&nbsp;REDIS_BLOCKED)</span><span class="stl_10 stl_11 stl_873" style="word-spacing:0.2401em;">&nbsp;==</span><span class="stl_10 stl_11 stl_873" style="word-spacing:0.2401em;">&nbsp;0) &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:10.4133em;z-index:807; "><span class="stl_58 stl_59 stl_835" style="word-spacing:0.2073em;">* The</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.2803em;">&nbsp;fake</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.4273em;">&nbsp;c</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3047em;">&nbsp;l</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3057em;">&nbsp;i</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3047em;">&nbsp;e</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3047em;">&nbsp;n</span><span class="stl_58 stl_59 stl_835" style="word-spacing:-0.3057em;">&nbsp;t</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.4193em;">&nbsp;should</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.3563em;">&nbsp;never get</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.3933em;">&nbsp;blocked</span><span class="stl_58 stl_59 stl_835" style="word-spacing:0.3153em;">&nbsp;*/ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_27" style="word-spacing:0.532em;">13.5. AOF</span><span class="stl_21 stl_11 stl_27" style="word-spacing:0.0887em;">&nbsp;</span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0887em;">恢复过程 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">123 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:11.685em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">释</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;放</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;虚</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;拟</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;客</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;户</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;端</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:10.4132em;"><span class="stl_58 stl_59 stl_1104" style="word-spacing:0.3623em;">* Clean up</span><span class="stl_58 stl_59 stl_1104" style="word-spacing:-0.1772em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1104" style="word-spacing:0.3398em;">&nbsp;Command</span><span class="stl_58 stl_59 stl_1104" style="word-spacing:0.3028em;">&nbsp;code may have</span><span class="stl_58 stl_59 stl_1104" style="word-spacing:0.4158em;">&nbsp;changed argv</span><span class="stl_58 stl_59 stl_1104" style="word-spacing:-0.2212em;">&nbsp;/</span><span class="stl_58 stl_59 stl_1104" style="word-spacing:-0.2212em;">&nbsp;argc &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:11.6283em;"><span class="stl_58 stl_59 stl_475" style="word-spacing:0.2838em;">so we use</span><span class="stl_58 stl_59 stl_475" style="word-spacing:0.3853em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 10.7018em; left:11.4753em;"><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3451em;">argv /</span><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3451em;">&nbsp;argc</span><span class="stl_58 stl_59 stl_260" style="word-spacing:0.3444em;">&nbsp;of the</span><span class="stl_58 stl_59 stl_260" style="word-spacing:0.3999em;">&nbsp;c</span><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3251em;">&nbsp;l</span><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3241em;">&nbsp;i</span><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3241em;">&nbsp;e</span><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3241em;">&nbsp;n</span><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3251em;">&nbsp;t</span><span class="stl_58 stl_59 stl_260" style="word-spacing:0.4149em;">&nbsp;instead</span><span class="stl_58 stl_59 stl_260" style="word-spacing:0.3589em;">&nbsp;of the</span><span class="stl_58 stl_59 stl_260" style="word-spacing:0.3929em;">&nbsp;l</span><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3321em;">&nbsp;o</span><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3311em;">&nbsp;c</span><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3311em;">&nbsp;a</span><span class="stl_58 stl_59 stl_260" style="word-spacing:-0.3311em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:12.1825em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.21em;">v a</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.21em;">&nbsp;r</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.209em;">&nbsp;i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.21em;">&nbsp;a</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.21em;">&nbsp;b</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.209em;">&nbsp;l</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.21em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.209em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.064em;">&nbsp;.</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.436em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:9.9733em;z-index:152; "><span class="stl_15 stl_16 stl_322">for</span><span class="stl_15 stl_16 stl_322" style="word-spacing:0.3829em;">&nbsp;</span><span class="stl_10 stl_11 stl_322" style="word-spacing:0.3829em;">(</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.171em;">&nbsp;j</span><span class="stl_10 stl_11 stl_322" style="word-spacing:0.232em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_322" style="word-spacing:0.465em;">&nbsp;j</span><span class="stl_10 stl_11 stl_322" style="word-spacing:0.205em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_322" style="word-spacing:0.248em;">&nbsp;fakeClient</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.2529em;">&nbsp;</span><span class="stl_107 stl_108 stl_322" style="word-spacing:0.248em;">−</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.2529em;">&gt;argc</span><span class="stl_10 stl_11 stl_322" style="word-spacing:-0.149em;">&nbsp;;</span><span class="stl_10 stl_11 stl_322" style="word-spacing:0.485em;">&nbsp;j++) &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:11.9567em;z-index:186; "><span class="stl_10 stl_11 stl_1105" style="word-spacing:-0.18em;">decrRefCount ( fakeClient </span><span class="stl_107 stl_108 stl_1105" style="word-spacing:-0.18em;">−</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:-0.18em;">&gt;argv [ j ] ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:10.025em;z-index:213; "><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.2352em;">z f r e e ( fakeClient </span><span class="stl_107 stl_108 stl_459" style="word-spacing:-0.2352em;">−</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.2352em;">&gt;argv ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 17.676em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.4207em;"><span class="stl_58 stl_59 stl_80" style="word-spacing:0.3238em;">* This</span><span class="stl_58 stl_59 stl_80" style="word-spacing:0.3762em;">&nbsp;point can only be reached</span><span class="stl_58 stl_59 stl_80" style="word-spacing:0.3228em;">&nbsp;when</span><span class="stl_58 stl_59 stl_80" style="word-spacing:0.1398em;">&nbsp;EOF</span><span class="stl_58 stl_59 stl_80" style="word-spacing:-0.0027em;">&nbsp;i s</span><span class="stl_58 stl_59 stl_80" style="word-spacing:0.4428em;">&nbsp;reached &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.6625em;"><span class="stl_58 stl_59 stl_72" style="word-spacing:0.3509em;">without errors</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.3509em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:9.5326em;"><span class="stl_58 stl_59 stl_453" style="word-spacing:-0.1735em;">I f</span><span class="stl_58 stl_59 stl_453" style="word-spacing:0.5535em;">&nbsp;the c</span><span class="stl_58 stl_59 stl_453" style="word-spacing:-0.1685em;">&nbsp;l</span><span class="stl_58 stl_59 stl_453" style="word-spacing:-0.1675em;">&nbsp;i</span><span class="stl_58 stl_59 stl_453" style="word-spacing:-0.1675em;">&nbsp;e</span><span class="stl_58 stl_59 stl_453" style="word-spacing:-0.1685em;">&nbsp;n</span><span class="stl_58 stl_59 stl_453" style="word-spacing:-0.1675em;">&nbsp;t</span><span class="stl_58 stl_59 stl_453" style="word-spacing:0.5935em;">&nbsp;i</span><span class="stl_58 stl_59 stl_453" style="word-spacing:-0.1805em;">&nbsp;s</span><span class="stl_58 stl_59 stl_453" style="word-spacing:0.499em;">&nbsp;in the middle of</span><span class="stl_58 stl_59 stl_453" style="word-spacing:0.4295em;">&nbsp;a</span><span class="stl_58 stl_59 stl_453" style="word-spacing:0.2405em;">&nbsp;MULTI/EXEC,</span><span class="stl_58 stl_59 stl_453" style="word-spacing:0.5465em;">&nbsp;log &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:10.1625em;"><span class="stl_58 stl_59 stl_1101" style="word-spacing:0.3509em;">error and q</span><span class="stl_58 stl_59 stl_1101" style="word-spacing:-0.2901em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1101" style="word-spacing:-0.2911em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1101" style="word-spacing:-0.2901em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1101" style="word-spacing:-0.1431em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1101" style="word-spacing:0.3619em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:8.045em;z-index:349; "><span class="stl_15 stl_16 stl_1106" style="word-spacing:-0.1741em;">i f</span><span class="stl_15 stl_16 stl_1106" style="word-spacing:0.5323em;">&nbsp;</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:0.5323em;">(</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:-0.1151em;">&nbsp;fakeClient</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:-0.1794em;">&nbsp;</span><span class="stl_107 stl_108 stl_1106" style="word-spacing:-0.1151em;">−</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:-0.1794em;">&gt;f</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:-0.1791em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:-0.1801em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:-0.1801em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:-0.1791em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:0.3309em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:0.1089em;">&nbsp;REDIS_MULTI)</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:0.4003em;">&nbsp;</span><span class="stl_15 stl_16 stl_1106" style="word-spacing:0.4003em;">goto</span><span class="stl_15 stl_16 stl_1106" style="word-spacing:0.4304em;">&nbsp;</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:0.4304em;">readerr</span><span class="stl_10 stl_11 stl_1106" style="word-spacing:0.4304em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">清</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;理</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;工</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;作 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:8.0442em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2687em;">f c l o s e ( fp ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:8.01em;"><span class="stl_10 stl_11 stl_1107" style="word-spacing:-0.2747em;">freeFakeClient ( fakeClient ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:8.4207em;"><span class="stl_58 stl_59 stl_950">/</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.6908em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.6908em;">恢</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1307em;">&nbsp;复 旧 的</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5403em;">&nbsp;</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5403em;">AOF</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5406em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5406em;">状</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5406em;">&nbsp;态 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:8.0175em;"><span class="stl_10 stl_11 stl_1108" style="word-spacing:-0.187em;">server .</span><span class="stl_10 stl_11 stl_1108" style="word-spacing:-0.209em;">&nbsp;aof_state</span><span class="stl_10 stl_11 stl_1108" style="word-spacing:0.1355em;">&nbsp;= old_aof_state</span><span class="stl_10 stl_11 stl_1108" style="word-spacing:0.1355em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:7.9842em;"><span class="stl_10 stl_11 stl_1022" style="word-spacing:-0.1907em;">stopLoading () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4207em;"><span class="stl_58 stl_59 stl_950">/</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.6908em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.6908em;">记</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1307em;">&nbsp;录 最 近</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5403em;">&nbsp;</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5403em;">AOF</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5406em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5406em;">操</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1308em;">&nbsp;作 的 文 件 大</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1308em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:7.99em;"><span class="stl_10 stl_11 stl_841" style="word-spacing:-0.1974em;">aofUpdateCurrentSize () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:8.0175em;"><span class="stl_10 stl_11 stl_809" style="word-spacing:-0.1918em;">server .</span><span class="stl_10 stl_11 stl_809" style="word-spacing:-0.2208em;">&nbsp;aof_rewrite_base_size</span><span class="stl_10 stl_11 stl_809" style="word-spacing:0.1292em;">&nbsp;=</span><span class="stl_10 stl_11 stl_809" style="word-spacing:-0.0337em;">&nbsp;server .</span><span class="stl_10 stl_11 stl_809" style="word-spacing:-0.2148em;">&nbsp;aof_current_size</span><span class="stl_10 stl_11 stl_809" style="word-spacing:-0.2148em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:7.9458em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:6.0175em;"><span class="stl_10 stl_11 stl_877" style="word-spacing:-0.224em;">readerr : &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0442em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0442em;">错 误，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;清</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;理</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;工</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;作 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:8.045em;"><span class="stl_15 stl_16 stl_1109" style="word-spacing:-0.298em;">i f</span><span class="stl_15 stl_16 stl_1109" style="word-spacing:0.4084em;">&nbsp;</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:0.4084em;">(</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.2em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.305em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.306em;">&nbsp;o</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.305em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.199em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.256em;">&nbsp;fp</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.255em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.263em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.263em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:9.9933em;"><span class="stl_10 stl_11 stl_1017" style="word-spacing:-0.1026em;">redisLog (REDIS_WARNING, ”Unexpected␣end␣ of ␣ f i l e ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:11.6525em;"><span class="stl_10 stl_11 stl_1004" style="word-spacing:-0.246em;">reading ␣ the ␣append␣ only ␣ f i l e ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.5843em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 41.5793em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:9.9933em;"><span class="stl_10 stl_11 stl_824" style="word-spacing:-0.1792em;">redisLog (REDIS_WARNING, ” Unrecoverable ␣ error ␣ reading ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:11.6367em;"><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.26em;">the ␣append␣</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.254em;">&nbsp;only</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.255em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.143em;">&nbsp;f</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.193em;">&nbsp;i</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.193em;">&nbsp;l</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.193em;">&nbsp;e</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.032em;">&nbsp;:</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.201em;">&nbsp;␣%s</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.246em;">&nbsp;”</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.134em;">&nbsp;,</span><span class="stl_10 stl_11 stl_204" style="word-spacing:0.463em;">&nbsp;s</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.245em;">&nbsp;t</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.245em;">&nbsp;r</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.245em;">&nbsp;e</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.244em;">&nbsp;r</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.245em;">&nbsp;r</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.245em;">&nbsp;o</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.245em;">&nbsp;r</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.139em;">&nbsp;(</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.187em;">&nbsp;errno</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.187em;">&nbsp;)</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.201em;">&nbsp;)</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.201em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 45.5702em; left:8.0242em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.3048em;">e x i t (1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:6.0058em;"><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2088em;">fmterr : &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">124 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2308em;"><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0859em;">CHAPTER 13.</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.5309em;">&nbsp;AOF</span><span class="stl_21 stl_11 stl_189" style="word-spacing:0.0865em;">&nbsp;</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0865em;">持久化策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:8.0008em;"><span class="stl_10 stl_11 stl_744" style="word-spacing:-0.1306em;">redisLog (REDIS_WARNING, ”Bad␣ f i l e ␣format␣ reading ␣ the ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.61em;"><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.2274em;">append␣ only</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.2264em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.1164em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.1654em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.1654em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.1654em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.0044em;">&nbsp;:</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.1734em;">&nbsp;␣make␣a␣backup␣</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.2034em;">&nbsp;of</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.2024em;">&nbsp;␣your␣AOF␣</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.1534em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.2024em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.2014em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.2024em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.0159em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1069" style="word-spacing:-0.0159em;">&nbsp;␣then &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.6em;"><span class="stl_10 stl_11 stl_07">␣</span></div>
					<div class="stl_01" style="top: 7.7118em; left:10.1405em;"><span class="stl_10 stl_11 stl_522" style="word-spacing:-0.2109em;">use ␣ . / redis </span><span class="stl_107 stl_108 stl_522" style="word-spacing:-0.2109em;">−</span><span class="stl_10 stl_11 stl_522" style="word-spacing:-0.2109em;">check</span><span class="stl_107 stl_108 stl_522" style="word-spacing:-0.2109em;">−</span><span class="stl_10 stl_11 stl_522" style="word-spacing:-0.2109em;">aof ␣</span><span class="stl_107 stl_108 stl_522" style="word-spacing:-0.2109em;">−−</span><span class="stl_10 stl_11 stl_522" style="word-spacing:-0.2109em;">f i x ␣&lt;filename&gt;” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:8.0242em;"><span class="stl_10 stl_11 stl_72" style="word-spacing:-0.3048em;">e x i t (1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 12.5257em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 12.5257em; left:6.5789em;"><span class="stl_38 stl_13 stl_34" style="word-spacing:0.7565em;">3.6 AOF</span><span class="stl_38 stl_13 stl_34" style="word-spacing:0.1324em;">&nbsp;</span><span class="stl_39 stl_18 stl_34" style="word-spacing:0.1324em;">的适用场景 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.7685em; left:7.5658em;"><span class="stl_17 stl_18 stl_1111" style="word-spacing:0.0891em;">如果对数据比较关心，分秒必争，可以用 </span><span class="stl_10 stl_11 stl_1111" style="word-spacing:0.0891em;">AOF </span><span class="stl_17 stl_18 stl_1111" style="word-spacing:0.0891em;">持久化，而且 </span><span class="stl_10 stl_11 stl_1111" style="word-spacing:0.0891em;">AOF </span><span class="stl_17 stl_18 stl_1111" style="word-spacing:0.0891em;">文件很容易 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.9865em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">进行分析。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_31.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_31.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 11.0439em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 14 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.4982em; left:5.9058em;"><span class="stl_37 stl_18 stl_07">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.7751em; left:7.5658em;z-index:39; "><span class="stl_10 stl_11 stl_1112" style="word-spacing:0.07em;">redis </span><span class="stl_17 stl_18 stl_1112" style="word-spacing:0.07em;">支持 </span><span class="stl_10 stl_11 stl_1112" style="word-spacing:0.07em;">master-slave</span><span class="stl_17 stl_18 stl_1112" style="word-spacing:0.07em;">（主从）模式，</span><span class="stl_10 stl_11 stl_1112" style="word-spacing:0.07em;">redis server </span><span class="stl_17 stl_18 stl_1112" style="word-spacing:0.07em;">可以设置为另一个 </span><span class="stl_10 stl_11 stl_1112" style="word-spacing:0.07em;">redis server &nbsp;</span></div>
					<div class="stl_01" style="top: 21.771em; left:5.9058em;"><span class="stl_17 stl_18 stl_1113" style="word-spacing:0.1061em;">的主机（从机），从机定期从主机拿数据。特殊的，一个从机同样可以设置为一个 </span><span class="stl_10 stl_11 stl_1113" style="word-spacing:0.1061em;">redis &nbsp;</span></div>
					<div class="stl_01" style="top: 22.7676em; left:5.9058em;"><span class="stl_10 stl_11 stl_899" style="word-spacing:0.1018em;">server </span><span class="stl_17 stl_18 stl_899" style="word-spacing:0.1018em;">的主机，这样一来 </span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.1018em;">master-slave </span><span class="stl_17 stl_18 stl_899" style="word-spacing:0.1018em;">的分布看起来就是一个有向无环图 </span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.1018em;">DAG</span><span class="stl_17 stl_18 stl_899" style="word-spacing:0.1018em;">，如 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.7635em; left:5.9058em;z-index:205; "><span class="stl_17 stl_18 stl_1114" style="word-spacing:0.1081em;">此形成 </span><span class="stl_10 stl_11 stl_1114" style="word-spacing:0.1081em;">redis server </span><span class="stl_17 stl_18 stl_1114" style="word-spacing:0.1081em;">集群，无论是主机还是从机都是 </span><span class="stl_10 stl_11 stl_1114" style="word-spacing:0.1081em;">redis server</span><span class="stl_17 stl_18 stl_1114" style="word-spacing:0.1081em;">，都可以提供服务）。 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:7.5658em;z-index:228; "><span class="stl_17 stl_18 stl_1115" style="word-spacing:0.0854em;">在配置后，主机可负责读写服务，从机只负责读。</span><span class="stl_10 stl_11 stl_1115" style="word-spacing:0.0854em;">redis </span><span class="stl_17 stl_18 stl_1115" style="word-spacing:0.0854em;">提高这种配置方式，为的 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.6382em; left:5.9058em;"><span class="stl_17 stl_18 stl_43">是让其支持数据的弱一致性，即最终一致性。在业务中，选择强一致性还是若已执行， &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">应该取决于具体的业务需求，像微博，完全可以使用弱一致性模型；像支付宝，可以 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">选用强一致性模型。 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">25 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">126 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4366em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.4366em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">4.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">积压空间 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7818em; left:7.5658em;"><span class="stl_10 stl_11 stl_1116" style="word-spacing:0.0923em;">binlog </span><span class="stl_17 stl_18 stl_1116" style="word-spacing:0.0923em;">是在 </span><span class="stl_10 stl_11 stl_1116" style="word-spacing:0.0923em;">mysql </span><span class="stl_17 stl_18 stl_1116" style="word-spacing:0.0923em;">中的一种日志类型，它记录了所有数据库自备份一来的所有 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7785em; left:5.9058em;"><span class="stl_17 stl_18 stl_959" style="word-spacing:0.0849em;">更新操作或潜在的更新操作，描述了数据的更改。因为 </span><span class="stl_10 stl_11 stl_959" style="word-spacing:0.0849em;">binlog </span><span class="stl_17 stl_18 stl_959" style="word-spacing:0.0849em;">只记录了数据的更新， &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7743em; left:5.9058em;"><span class="stl_17 stl_18 stl_483" style="word-spacing:0.0848em;">所以适合用来做实时备份和主从复制。同样，</span><span class="stl_10 stl_11 stl_483" style="word-spacing:0.0848em;">redis </span><span class="stl_17 stl_18 stl_483" style="word-spacing:0.0848em;">在主从复制上用的就是一种类似 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.771em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0821em;">binlog </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">的日志。</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0821em;">TODO &nbsp;</span></div>
					<div class="stl_01" style="top: 12.8177em; left:7.5658em;"><span class="stl_17 stl_18 stl_1117" style="word-spacing:0.0937em;">在《深入剖析 </span><span class="stl_10 stl_11 stl_1117" style="word-spacing:0.0937em;">redis AOF </span><span class="stl_17 stl_18 stl_1117" style="word-spacing:0.0937em;">持久化策略》中，介绍了更新缓存的概念，举一个例 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.8143em; left:5.9058em;"><span class="stl_17 stl_18 stl_1118" style="word-spacing:0.092em;">子：客户端发来命令：</span><span class="stl_10 stl_11 stl_1118" style="word-spacing:0.092em;">set name Jhon</span><span class="stl_17 stl_18 stl_1118" style="word-spacing:0.092em;">，这一数据更新被记录为：</span><span class="stl_10 stl_11 stl_1118" style="word-spacing:0.092em;">*3/r/n$3/r/nSET/ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.8101em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">r/n$4/r/nname/r/n$3/r/nJhon/r/n</span><span class="stl_17 stl_18 stl_07">，并存储在更新缓存中。 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.0798em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">同样，在主从连接中，也有更新缓存的概念。只是两者的用途不一样，前者被写 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.0765em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">入本地，后者被写入从机，这里我们把它成为积压空间。 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.9018em; left:7.5658em;z-index:372; "><span class="stl_17 stl_18 stl_317" style="word-spacing:0.074em;">更新缓存存储在 </span><span class="stl_10 stl_11 stl_317" style="word-spacing:0.074em;">server.repl_backlog</span><span class="stl_17 stl_18 stl_317" style="word-spacing:0.074em;">，</span><span class="stl_10 stl_11 stl_317" style="word-spacing:0.074em;">redis </span><span class="stl_17 stl_18 stl_317" style="word-spacing:0.074em;">将其作为一个环形空间来处理，这样 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.1198em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">做节省了空间，避免内存再分配的情况。 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.4935em; left:5.98em;"><span class="stl_15 stl_16 stl_718">struct</span><span class="stl_15 stl_16 stl_718" style="word-spacing:0.3313em;">&nbsp;</span><span class="stl_10 stl_11 stl_718" style="word-spacing:0.3313em;">redisServer</span><span class="stl_10 stl_11 stl_718" style="word-spacing:0.3313em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.496em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.4926em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.496em; left:8.4207em;"><span class="stl_58 stl_59 stl_1011" style="word-spacing:0.3094em;">* Replication</span><span class="stl_58 stl_59 stl_1011" style="word-spacing:0.3464em;">&nbsp;(</span><span class="stl_58 stl_59 stl_1011" style="word-spacing:-0.2996em;">&nbsp;master</span><span class="stl_58 stl_59 stl_1011" style="word-spacing:-0.2996em;">&nbsp;)</span><span class="stl_58 stl_59 stl_1011" style="word-spacing:0.2664em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.4926em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">最 近</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;次</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;使</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;（访</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.249em;">&nbsp;问）</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;集 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4818em; left:7.98em;"><span class="stl_15 stl_16 stl_1119">int</span><span class="stl_15 stl_16 stl_1119" style="word-spacing:0.3191em;">&nbsp;</span><span class="stl_10 stl_11 stl_1119" style="word-spacing:0.3191em;">slaveseldb</span><span class="stl_10 stl_11 stl_1119" style="word-spacing:0.3191em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4851em; left:9.6942em;"><span class="stl_58 stl_59 stl_871" style="word-spacing:-0.3067em;">r e</span><span class="stl_58 stl_59 stl_871" style="word-spacing:-0.3067em;">&nbsp;p</span><span class="stl_58 stl_59 stl_871" style="word-spacing:-0.3057em;">&nbsp;l</span><span class="stl_58 stl_59 stl_871" style="word-spacing:-0.3067em;">&nbsp;i</span><span class="stl_58 stl_59 stl_871" style="word-spacing:-0.3057em;">&nbsp;c</span><span class="stl_58 stl_59 stl_871" style="word-spacing:-0.3067em;">&nbsp;a</span><span class="stl_58 stl_59 stl_871" style="word-spacing:-0.3067em;">&nbsp;t</span><span class="stl_58 stl_59 stl_871" style="word-spacing:-0.3057em;">&nbsp;i</span><span class="stl_58 stl_59 stl_871" style="word-spacing:-0.3067em;">&nbsp;o</span><span class="stl_58 stl_59 stl_871" style="word-spacing:-0.3057em;">&nbsp;n</span><span class="stl_58 stl_59 stl_871" style="word-spacing:0.4133em;">&nbsp;output</span><span class="stl_58 stl_59 stl_871" style="word-spacing:0.3103em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4885em; left:23.8875em;"><span class="stl_58 stl_59 stl_1120" style="word-spacing:0.4706em;">/* Last</span><span class="stl_58 stl_59 stl_1120" style="word-spacing:0.3946em;">&nbsp;SELECTed</span><span class="stl_58 stl_59 stl_1120" style="word-spacing:0.2026em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_1120" style="word-spacing:0.3296em;">&nbsp;in &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4735em; left:23.8875em;"><span class="stl_58 stl_59 stl_177" style="word-spacing:0.31em;">/* Global</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.414em;">&nbsp;r</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.305em;">&nbsp;e</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.304em;">&nbsp;p</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.305em;">&nbsp;l</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.304em;">&nbsp;i</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.305em;">&nbsp;c</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.305em;">&nbsp;a</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.304em;">&nbsp;t</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.305em;">&nbsp;i</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.304em;">&nbsp;o</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.304em;">&nbsp;n &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4593em; left:23.8875em;"><span class="stl_58 stl_59 stl_674" style="word-spacing:0.2813em;">/* Master</span><span class="stl_58 stl_59 stl_674" style="word-spacing:0.3473em;">&nbsp;pings</span><span class="stl_58 stl_59 stl_674" style="word-spacing:0.4028em;">&nbsp;the s</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.3087em;">&nbsp;l</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.3087em;">&nbsp;av</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.3087em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4443em; left:23.8875em;"><span class="stl_58 stl_59 stl_1121" style="word-spacing:0.2824em;">/* Replication</span><span class="stl_58 stl_59 stl_1121" style="word-spacing:0.3584em;">&nbsp;backlog &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:23.8875em;"><span class="stl_58 stl_59 stl_1081" style="word-spacing:0.3174em;">/* Backlog</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:0.4164em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2886em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2876em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2886em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2886em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2876em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2886em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2886em;">&nbsp;r &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4776em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.4668em; left:7.9467em;"><span class="stl_15 stl_16 stl_1122" style="word-spacing:0.2536em;">long long</span><span class="stl_15 stl_16 stl_1122" style="word-spacing:0.319em;">&nbsp;</span><span class="stl_10 stl_11 stl_1122" style="word-spacing:0.319em;">master_repl_offset</span><span class="stl_10 stl_11 stl_1122" style="word-spacing:0.319em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4776em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">全</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;局</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;偏</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;移</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;量 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4701em; left:9.71em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.189em;">o f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.188em;">&nbsp;f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.188em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.188em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.188em;">&nbsp;t</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.471em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.4527em; left:7.98em;"><span class="stl_15 stl_16 stl_1123">int</span><span class="stl_15 stl_16 stl_1123" style="word-spacing:0.3418em;">&nbsp;</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:0.3418em;">repl_ping_slave_period</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:0.3418em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;连</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;心</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;跳</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;频</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;率 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4551em; left:10.155em;"><span class="stl_58 stl_59 stl_455" style="word-spacing:0.1763em;">every N seconds</span><span class="stl_58 stl_59 stl_455" style="word-spacing:0.3023em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.4377em; left:7.9342em;"><span class="stl_15 stl_16 stl_689">char</span><span class="stl_15 stl_16 stl_689" style="word-spacing:-0.0376em;">&nbsp;</span><span class="stl_10 stl_11 stl_689" style="word-spacing:-0.0376em;">* repl_backlog</span><span class="stl_10 stl_11 stl_689" style="word-spacing:-0.0376em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">积</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;压</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;针 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:9.675em;"><span class="stl_58 stl_59 stl_253" style="word-spacing:0.4341em;">for p</span><span class="stl_58 stl_59 stl_253" style="word-spacing:-0.3059em;">&nbsp;a</span><span class="stl_58 stl_59 stl_253" style="word-spacing:-0.3069em;">&nbsp;r</span><span class="stl_58 stl_59 stl_253" style="word-spacing:-0.3059em;">&nbsp;t</span><span class="stl_58 stl_59 stl_253" style="word-spacing:-0.3059em;">&nbsp;i</span><span class="stl_58 stl_59 stl_253" style="word-spacing:-0.3059em;">&nbsp;a</span><span class="stl_58 stl_59 stl_253" style="word-spacing:-0.3059em;">&nbsp;l</span><span class="stl_58 stl_59 stl_253" style="word-spacing:0.4061em;">&nbsp;syncs</span><span class="stl_58 stl_59 stl_253" style="word-spacing:0.2971em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4227em; left:7.9467em;"><span class="stl_15 stl_16 stl_805" style="word-spacing:0.2593em;">long long</span><span class="stl_15 stl_16 stl_805" style="word-spacing:0.3217em;">&nbsp;</span><span class="stl_10 stl_11 stl_805" style="word-spacing:0.3217em;">repl_backlog_size</span><span class="stl_10 stl_11 stl_805" style="word-spacing:0.3217em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">积</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;压</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:9.69em;"><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.211em;">b u</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.209em;">&nbsp;f</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.21em;">&nbsp;f</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.21em;">&nbsp;e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.21em;">&nbsp;r</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.553em;">&nbsp;s</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.205em;">&nbsp;i</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.205em;">&nbsp;z</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.205em;">&nbsp;e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.455em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">积</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;压</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;新</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4077em; left:7.9467em;"><span class="stl_15 stl_16 stl_678" style="word-spacing:0.2436em;">long long</span><span class="stl_15 stl_16 stl_678" style="word-spacing:0.311em;">&nbsp;</span><span class="stl_10 stl_11 stl_678" style="word-spacing:0.311em;">repl_backlog_histlen</span><span class="stl_10 stl_11 stl_678" style="word-spacing:-0.1864em;">&nbsp;;</span><span class="stl_10 stl_11 stl_678" style="word-spacing:0.3482em;">&nbsp;</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.3482em;">/*</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.2916em;">&nbsp;Backlog</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.3751em;">&nbsp;actual</span><span class="stl_58 stl_59 stl_678" style="word-spacing:0.3751em;">&nbsp;data &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:9.6792em;"><span class="stl_58 stl_59 stl_881" style="word-spacing:0.2927em;">length */ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.1. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">积压空间 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">127 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">下</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;次</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;向</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;积</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;压</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;起</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;始</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;位</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;置 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:23.8875em;"><span class="stl_58 stl_59 stl_1081" style="word-spacing:0.3174em;">/* Backlog</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:0.4164em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2886em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2876em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2886em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2886em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2876em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2886em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1081" style="word-spacing:-0.2886em;">&nbsp;r &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:7.9467em;"><span class="stl_15 stl_16 stl_236" style="word-spacing:0.2846em;">long long</span><span class="stl_15 stl_16 stl_236" style="word-spacing:0.3309em;">&nbsp;</span><span class="stl_10 stl_11 stl_236" style="word-spacing:0.3309em;">repl_backlog_idx</span><span class="stl_10 stl_11 stl_236" style="word-spacing:0.3309em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.69em;"><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3253em;">b u</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3233em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3243em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3243em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3243em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:0.4132em;">&nbsp;current o</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3003em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3003em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3003em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3003em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3003em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:0.3597em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">积 压</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;起</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;始</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;位</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;置，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;宏</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;观</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:23.8875em;"><span class="stl_58 stl_59 stl_1039" style="word-spacing:0.2862em;">/* Replication</span><span class="stl_58 stl_59 stl_1039" style="word-spacing:0.4092em;">&nbsp;o</span><span class="stl_58 stl_59 stl_1039" style="word-spacing:-0.3288em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1039" style="word-spacing:-0.3288em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1039" style="word-spacing:-0.3288em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1039" style="word-spacing:-0.3288em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1039" style="word-spacing:-0.3288em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1039" style="word-spacing:0.3982em;">&nbsp;of &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:25.445em;"><span class="stl_58 stl_59 stl_1125" style="word-spacing:0.3954em;">backlog b</span><span class="stl_58 stl_59 stl_1125" style="word-spacing:-0.3406em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1125" style="word-spacing:-0.3406em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1125" style="word-spacing:-0.3406em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1125" style="word-spacing:-0.3406em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1125" style="word-spacing:-0.3406em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1125" style="word-spacing:-0.1936em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1125" style="word-spacing:0.3074em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:7.9467em;"><span class="stl_15 stl_16 stl_951" style="word-spacing:0.2635em;">long long</span><span class="stl_15 stl_16 stl_951" style="word-spacing:0.3239em;">&nbsp;</span><span class="stl_10 stl_11 stl_951" style="word-spacing:0.3239em;">repl_backlog_off</span><span class="stl_10 stl_11 stl_951" style="word-spacing:0.3239em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.7275em;"><span class="stl_58 stl_59 stl_1126" style="word-spacing:-0.2987em;">f i</span><span class="stl_58 stl_59 stl_1126" style="word-spacing:-0.2997em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1126" style="word-spacing:-0.2987em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1126" style="word-spacing:-0.2987em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1126" style="word-spacing:0.4333em;">&nbsp;byte</span><span class="stl_58 stl_59 stl_1126" style="word-spacing:0.3353em;">&nbsp;in</span><span class="stl_58 stl_59 stl_1126" style="word-spacing:0.3353em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">积</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;压</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;效</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:7.9592em;"><span class="stl_10 stl_11 stl_550" style="word-spacing:0.3362em;">time_t repl_backlog_time_limit</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.1768em;">&nbsp;;</span><span class="stl_10 stl_11 stl_550" style="word-spacing:0.3752em;">&nbsp;</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.3752em;">/*</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.2342em;">&nbsp;Time</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.3002em;">&nbsp;without</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.4372em;">&nbsp;s</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2888em;">&nbsp;l</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2878em;">&nbsp;a</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2888em;">&nbsp;v</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2878em;">&nbsp;e</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2878em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.6925em;"><span class="stl_58 stl_59 stl_1127" style="word-spacing:-0.3542em;">a f</span><span class="stl_58 stl_59 stl_1127" style="word-spacing:-0.3543em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1127" style="word-spacing:-0.3542em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1127" style="word-spacing:-0.3532em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1127" style="word-spacing:0.3568em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1127" style="word-spacing:0.3568em;">&nbsp;backlog &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:25.4558em;"><span class="stl_58 stl_59 stl_1128" style="word-spacing:0.3663em;">gets released</span><span class="stl_58 stl_59 stl_1128" style="word-spacing:-0.2347em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1128" style="word-spacing:0.2793em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 21.0843em; left:7.5658em;"><span class="stl_17 stl_18 stl_1129" style="word-spacing:0.0784em;">积压空间中的数据变更记录是什么时候被写入的？在执行一个 </span><span class="stl_10 stl_11 stl_1129" style="word-spacing:0.0784em;">redis </span><span class="stl_17 stl_18 stl_1129" style="word-spacing:0.0784em;">命令的时候， &nbsp;</span></div>
					<div class="stl_01" style="top: 22.081em; left:5.9058em;"><span class="stl_17 stl_18 stl_1111" style="word-spacing:0.1167em;">如果存在数据的修改（写），那么就会把变更记录传播。</span><span class="stl_10 stl_11 stl_1111" style="word-spacing:0.1167em;">redis </span><span class="stl_17 stl_18 stl_1111" style="word-spacing:0.1167em;">源码中是这么实现的： &nbsp;</span></div>
					<div class="stl_01" style="top: 23.0768em; left:5.9058em;"><span class="stl_10 stl_11 stl_53">call()-&gt;propagate()-&gt;replicationFeedSlaves() &nbsp;</span></div>
					<div class="stl_01" style="top: 25.0693em; left:7.5658em;"><span class="stl_17 stl_18 stl_321" style="word-spacing:0.1082em;">注释：命令真正执行的地方在 </span><span class="stl_10 stl_11 stl_321" style="word-spacing:0.1082em;">call() </span><span class="stl_17 stl_18 stl_321" style="word-spacing:0.1082em;">中，</span><span class="stl_10 stl_11 stl_321" style="word-spacing:0.1082em;">call() </span><span class="stl_17 stl_18 stl_321" style="word-spacing:0.1082em;">如果发现数据被修改（</span><span class="stl_10 stl_11 stl_321" style="word-spacing:0.1082em;">dirty</span><span class="stl_17 stl_18 stl_321" style="word-spacing:0.1082em;">），则 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.066em; left:5.9058em;z-index:460; "><span class="stl_17 stl_18 stl_237" style="word-spacing:0.0621em;">传播 </span><span class="stl_10 stl_11 stl_237" style="word-spacing:0.0621em;">propagrate()</span><span class="stl_17 stl_18 stl_237" style="word-spacing:0.0621em;">，</span><span class="stl_10 stl_11 stl_237" style="word-spacing:0.0621em;">replicationFeedSlaves() </span><span class="stl_17 stl_18 stl_237" style="word-spacing:0.0621em;">将修改记录写入积压空间和所有已连接的 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.284em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">从机。 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.2765em; left:7.5658em;"><span class="stl_17 stl_18 stl_46">这里可能会有疑问：为什么把数据添加入积压空间，又把数据分发给所有的从 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.2732em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">机？为什么不仅仅将数据分发给所有从机呢？ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.269em; left:7.5658em;"><span class="stl_17 stl_18 stl_1130">因为有一些从机会因特殊情况（？？？）与主机断开连接，注意从机断开前有暂 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.0435em; left:5.9058em;"><span class="stl_17 stl_18 stl_813" style="word-spacing:0.0899em;">存主机的状态信息，因此这些断开的从机就没有及时收到更新的数据。</span><span class="stl_10 stl_11 stl_813" style="word-spacing:0.0899em;">redis </span><span class="stl_17 stl_18 stl_813" style="word-spacing:0.0899em;">为了 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.2615em; left:5.9058em;"><span class="stl_17 stl_18 stl_235">让断开的从机在下次连接后能够获取更新数据，将更新数据加入了积压空间。从 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.036em; left:5.9058em;"><span class="stl_10 stl_11 stl_512" style="word-spacing:0.1235em;">replicationFeedSlaves() </span><span class="stl_17 stl_18 stl_512" style="word-spacing:0.1235em;">实现来看，在线的 </span><span class="stl_10 stl_11 stl_512" style="word-spacing:0.1235em;">slave </span><span class="stl_17 stl_18 stl_512" style="word-spacing:0.1235em;">能马上收到数据更新记录；因某些 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.0318em; left:5.9058em;"><span class="stl_17 stl_18 stl_1131" style="word-spacing:0.0872em;">原因暂时断开连接的 </span><span class="stl_10 stl_11 stl_1131" style="word-spacing:0.0872em;">slave</span><span class="stl_17 stl_18 stl_1131" style="word-spacing:0.0872em;">，需要从积压空间中找回断开期间的数据更新记录。如果 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.0285em; left:5.9058em;z-index:765; "><span class="stl_17 stl_18 stl_1132" style="word-spacing:0.0548em;">断开的时间足够长，</span><span class="stl_10 stl_11 stl_1132" style="word-spacing:0.0548em;">master </span><span class="stl_17 stl_18 stl_1132" style="word-spacing:0.0548em;">会拒绝 </span><span class="stl_10 stl_11 stl_1132" style="word-spacing:0.0548em;">slave </span><span class="stl_17 stl_18 stl_1132" style="word-spacing:0.0548em;">的部分同步请求，从而 </span><span class="stl_10 stl_11 stl_1132" style="word-spacing:0.0548em;">slave </span><span class="stl_17 stl_18 stl_1132" style="word-spacing:0.0548em;">只能进行全同步。 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.2432em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">下面是源码注释： &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.4326em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:6.4282em;"><span class="stl_58 stl_59 stl_72" style="word-spacing:0.331em;">/ c</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.327em;">&nbsp;a</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.328em;">&nbsp;l</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.327em;">&nbsp;l</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.201em;">&nbsp;()</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.3163em;">&nbsp;</span><span class="stl_17 stl_18 stl_72" style="word-spacing:0.3163em;">函</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.312em;">&nbsp;数</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;是</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;执</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;行</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;命</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;令</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;的</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;核</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.31em;">&nbsp;心</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;函</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.278em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.277em;">&nbsp;真</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;正</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;执</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;行</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;命</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;令</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;的</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;地</span><span class="stl_17 stl_18 stl_72" style="word-spacing:-0.311em;">&nbsp;方 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:6.4282em;"><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3504em;">* Call</span><span class="stl_58 stl_59 stl_222" style="word-spacing:-0.1816em;">&nbsp;()</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.4474em;">&nbsp;i</span><span class="stl_58 stl_59 stl_222" style="word-spacing:-0.2786em;">&nbsp;s</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.4444em;">&nbsp;the</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3897em;">&nbsp;core of Redis execution</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.4184em;">&nbsp;of</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3314em;">&nbsp;a</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.2124em;">&nbsp;command</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.2124em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:5.9483em;"><span class="stl_15 stl_16 stl_223">void</span><span class="stl_15 stl_16 stl_223" style="word-spacing:0.4309em;">&nbsp;</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.4309em;">c</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2227em;">&nbsp;a</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2217em;">&nbsp;l</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2217em;">&nbsp;l</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1157em;">&nbsp;(</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1407em;">&nbsp;r</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;d</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2467em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;s</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;C</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;l</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2467em;">&nbsp;i</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;e</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;n</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2457em;">&nbsp;t</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.4033em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1367em;">&nbsp;,</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.4587em;">&nbsp;</span><span class="stl_15 stl_16 stl_223" style="word-spacing:0.4587em;">int</span><span class="stl_15 stl_16 stl_223" style="word-spacing:0.4675em;">&nbsp;</span><span class="stl_10 stl_11 stl_223" style="word-spacing:0.4675em;">f</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2317em;">&nbsp;l</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2317em;">&nbsp;a</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2307em;">&nbsp;g</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.2317em;">&nbsp;s</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1257em;">&nbsp;)</span><span class="stl_10 stl_11 stl_223" style="word-spacing:-0.1257em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 43.4235em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.4218em; left:8.4207em;"><span class="stl_58 stl_59 stl_811" style="word-spacing:0.4085em;">* Call</span><span class="stl_58 stl_59 stl_811" style="word-spacing:0.4735em;">&nbsp;the</span><span class="stl_58 stl_59 stl_811" style="word-spacing:0.3425em;">&nbsp;command.</span><span class="stl_58 stl_59 stl_811" style="word-spacing:0.4225em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:7.9408em;z-index:945; "><span class="stl_10 stl_11 stl_1133" style="word-spacing:0.0384em;">c</span><span class="stl_107 stl_108 stl_1133" style="word-spacing:0.0384em;">−</span><span class="stl_10 stl_11 stl_1133" style="word-spacing:0.0384em;">&gt;f l a g s</span><span class="stl_10 stl_11 stl_1133" style="word-spacing:0.5189em;">&nbsp;&amp;=</span><span class="stl_10 stl_11 stl_1133" style="word-spacing:0.4329em;">&nbsp;~(REDIS_FORCE_AOF|REDIS_FORCE_REPL)</span><span class="stl_10 stl_11 stl_1133" style="word-spacing:0.4329em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.9983em;"><span class="stl_10 stl_11 stl_254" style="word-spacing:-0.242em;">redisOpArrayInit(&amp; server . also_propagate ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">128 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">脏 数</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;据</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;标</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;记，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;数</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;据</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;是</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;否</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;被</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;修</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;改 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:8.0167em;"><span class="stl_10 stl_11 stl_394" style="word-spacing:0.1177em;">dirty = server</span><span class="stl_10 stl_11 stl_394" style="word-spacing:-0.2313em;">&nbsp;.</span><span class="stl_10 stl_11 stl_394" style="word-spacing:-0.2323em;">&nbsp;dirty</span><span class="stl_10 stl_11 stl_394" style="word-spacing:-0.2323em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;对</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;应</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.9408em;z-index:69; "><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0006em;">c</span><span class="stl_107 stl_108 stl_224" style="word-spacing:-0.0006em;">−</span><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0006em;">&gt;cmd</span><span class="stl_107 stl_108 stl_224" style="word-spacing:-0.0006em;">−</span><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0006em;">&gt;proc (</span><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0236em;">&nbsp;c</span><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0246em;">&nbsp;)</span><span class="stl_10 stl_11 stl_224" style="word-spacing:-0.0246em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:8.0167em;z-index:97; "><span class="stl_10 stl_11 stl_1134" style="word-spacing:0.1367em;">dirty = server</span><span class="stl_10 stl_11 stl_1134" style="word-spacing:-0.2123em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1134" style="word-spacing:-0.2343em;">&nbsp;dirty</span><span class="stl_10 stl_11 stl_1134" style="word-spacing:-0.3618em;">&nbsp;</span><span class="stl_107 stl_108 stl_1134" style="word-spacing:-0.2343em;">−</span><span class="stl_10 stl_11 stl_1134" style="word-spacing:-0.3618em;">dirty</span><span class="stl_10 stl_11 stl_1134" style="word-spacing:-0.3618em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.9967em;z-index:122; "><span class="stl_10 stl_11 stl_279" style="word-spacing:0.1669em;">duration =</span><span class="stl_10 stl_11 stl_279" style="word-spacing:-0.0723em;">&nbsp;ustime ()</span><span class="stl_107 stl_108 stl_279" style="word-spacing:-0.0723em;">−</span><span class="stl_10 stl_11 stl_279" style="word-spacing:-0.0723em;">s</span><span class="stl_10 stl_11 stl_279" style="word-spacing:-0.3071em;">&nbsp;t</span><span class="stl_10 stl_11 stl_279" style="word-spacing:-0.3071em;">&nbsp;a</span><span class="stl_10 stl_11 stl_279" style="word-spacing:-0.3071em;">&nbsp;r</span><span class="stl_10 stl_11 stl_279" style="word-spacing:-0.3071em;">&nbsp;t</span><span class="stl_10 stl_11 stl_279" style="word-spacing:-0.3071em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4207em;"><span class="stl_58 stl_59 stl_950">/</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.6908em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.6908em;">将</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1309em;">&nbsp;客 户 端 请 求 的 数 据 修 改 记 录 传 播 给</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5406em;">&nbsp;</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5406em;">AOF</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5396em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5396em;">和</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1305em;">&nbsp;从</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1305em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.4207em;"><span class="stl_58 stl_59 stl_1135" style="word-spacing:0.377em;">* Propagate</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:0.442em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:0.35em;">&nbsp;command into</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:0.479em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:0.251em;">&nbsp;AOF</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:0.18em;">&nbsp;and</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:0.436em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:-0.219em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:-0.218em;">&nbsp;p</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:-0.219em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:-0.219em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:-0.218em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:-0.219em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:-0.218em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:-0.219em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:-0.219em;">&nbsp;o</span><span class="stl_58 stl_59 stl_1135" style="word-spacing:-0.219em;">&nbsp;n &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.6942em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">l i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">&nbsp;n</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.207em;">&nbsp;k</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.452em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:8.045em;"><span class="stl_15 stl_16 stl_1038" style="word-spacing:0.0948em;">i f</span><span class="stl_15 stl_16 stl_1038" style="word-spacing:0.8012em;">&nbsp;</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.8012em;">(</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.1938em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.0893em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.5998em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.3398em;">&nbsp;REDIS_CALL_PROPAGATE)</span><span class="stl_10 stl_11 stl_1038" style="word-spacing:0.3398em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:9.9725em;"><span class="stl_15 stl_16 stl_1136">int</span><span class="stl_15 stl_16 stl_1136" style="word-spacing:0.7702em;">&nbsp;</span><span class="stl_10 stl_11 stl_1136" style="word-spacing:0.7702em;">f</span><span class="stl_10 stl_11 stl_1136" style="word-spacing:0.0713em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1136" style="word-spacing:0.5831em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1136" style="word-spacing:0.3111em;">&nbsp;REDIS_PROPAGATE_NONE; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">强</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;制</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;复</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;制 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:10.0375em;z-index:282; "><span class="stl_15 stl_16 stl_1137" style="word-spacing:0.0402em;">i f</span><span class="stl_15 stl_16 stl_1137" style="word-spacing:0.7466em;">&nbsp;</span><span class="stl_10 stl_11 stl_1137" style="word-spacing:0.7466em;">(</span><span class="stl_10 stl_11 stl_1137" style="word-spacing:0.7466em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1137" style="word-spacing:0.7466em;">−</span><span class="stl_10 stl_11 stl_1137" style="word-spacing:0.0212em;">&gt;f</span><span class="stl_10 stl_11 stl_1137" style="word-spacing:0.0347em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1137" style="word-spacing:0.5452em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1137" style="word-spacing:0.2992em;">&nbsp;REDIS_FORCE_REPL)</span><span class="stl_10 stl_11 stl_1137" style="word-spacing:0.7402em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1137" style="word-spacing:0.0345em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1137" style="word-spacing:0.6822em;">&nbsp;|= &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:11.4767em;"><span class="stl_10 stl_11 stl_1138">REDIS_PROPAGATE_REPL; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:10.4132em;"><span class="stl_58 stl_59 stl_950">/</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.6908em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.6908em;">强</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.13em;">&nbsp;制</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5404em;">&nbsp;</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5404em;">AOF</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5406em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5406em;">持</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1305em;">&nbsp;久</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1305em;">&nbsp;化 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:10.0375em;z-index:349; "><span class="stl_15 stl_16 stl_1139" style="word-spacing:0.0515em;">i f</span><span class="stl_15 stl_16 stl_1139" style="word-spacing:0.7579em;">&nbsp;</span><span class="stl_10 stl_11 stl_1139" style="word-spacing:0.7579em;">(</span><span class="stl_10 stl_11 stl_1139" style="word-spacing:0.7579em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1139" style="word-spacing:0.7579em;">−</span><span class="stl_10 stl_11 stl_1139" style="word-spacing:0.0325em;">&gt;f</span><span class="stl_10 stl_11 stl_1139" style="word-spacing:0.046em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1139" style="word-spacing:0.5565em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1139" style="word-spacing:0.3025em;">&nbsp;REDIS_FORCE_AOF)</span><span class="stl_10 stl_11 stl_1139" style="word-spacing:0.7515em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1139" style="word-spacing:0.0457em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1139" style="word-spacing:0.6935em;">&nbsp;|= &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:11.47em;"><span class="stl_10 stl_11 stl_1140">REDIS_PROPAGATE_AOF; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.6276em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;被</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;修</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;改 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6168em; left:10.0375em;"><span class="stl_15 stl_16 stl_1141" style="word-spacing:-0.3595em;">i f</span><span class="stl_15 stl_16 stl_1141" style="word-spacing:0.3469em;">&nbsp;</span><span class="stl_10 stl_11 stl_1141" style="word-spacing:0.3469em;">(</span><span class="stl_10 stl_11 stl_1141" style="word-spacing:-0.2875em;">&nbsp;dirty</span><span class="stl_10 stl_11 stl_1141" style="word-spacing:-0.2875em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:12.0242em;"><span class="stl_10 stl_11 stl_1142" style="word-spacing:0.0764em;">f l a g s</span><span class="stl_10 stl_11 stl_1142" style="word-spacing:0.6922em;">&nbsp;|= (REDIS_PROPAGATE_REPL</span><span class="stl_10 stl_11 stl_1142" style="word-spacing:0.6922em;">&nbsp;| &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:13.4633em;"><span class="stl_10 stl_11 stl_1036" style="word-spacing:0.1993em;">REDIS_PROPAGATE_AOF) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:10.4133em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">传</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;播</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;修</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;改</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;录 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:10.0375em;"><span class="stl_15 stl_16 stl_1143" style="word-spacing:0.1037em;">i f</span><span class="stl_15 stl_16 stl_1143" style="word-spacing:0.8101em;">&nbsp;</span><span class="stl_10 stl_11 stl_1143" style="word-spacing:0.8101em;">(</span><span class="stl_10 stl_11 stl_1143" style="word-spacing:0.2027em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1143" style="word-spacing:0.0982em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1143" style="word-spacing:0.7457em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_1143" style="word-spacing:0.4747em;">&nbsp;REDIS_PROPAGATE_NONE) &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:11.9717em;z-index:543; "><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.0734em;">propagate (</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.0734em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1144" style="word-spacing:-0.0734em;">−</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.1264em;">&gt;cmd,</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.1264em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1144" style="word-spacing:-0.1264em;">−</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.0714em;">&gt;db</span><span class="stl_107 stl_108 stl_1144" style="word-spacing:-0.0714em;">−</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.0714em;">&gt;id</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.0059em;">&nbsp;, c</span><span class="stl_107 stl_108 stl_1144" style="word-spacing:-0.0059em;">−</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.0059em;">&gt;argv</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.0174em;">&nbsp;, c</span><span class="stl_107 stl_108 stl_1144" style="word-spacing:-0.0174em;">−</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.0174em;">&gt;argc</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:0.0646em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.0669em;">&nbsp;f l</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.1144em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.1144em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.1134em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1144" style="word-spacing:-0.1134em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:13.6775em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 40.5885em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 40.5885em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.5793em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:6.4282em;"><span class="stl_58 stl_59 stl_950">/</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.6908em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.6908em;">向</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.54em;">&nbsp;</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.54em;">AOF</span><span class="stl_58 stl_59 stl_950" style="word-spacing:0.5396em;">&nbsp;</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.5396em;">和</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1309em;">&nbsp;从 机 发 布 数 据 更</span><span class="stl_17 stl_18 stl_950" style="word-spacing:0.1309em;">&nbsp;新 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:6.4282em;"><span class="stl_58 stl_59 stl_671" style="word-spacing:0.3231em;">* Propagate</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.3881em;">&nbsp;the</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.4551em;">&nbsp;s</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;p</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2699em;">&nbsp;e</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;c</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;i</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;f</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;i</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2699em;">&nbsp;e</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2689em;">&nbsp;d</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.3321em;">&nbsp;command</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.2611em;">&nbsp;(</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.2299em;">&nbsp;in</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.4161em;">&nbsp;the context of</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.4161em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:7.7042em;"><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">s p</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3285em;">&nbsp;e</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">&nbsp;c</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">&nbsp;i</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">&nbsp;f</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">&nbsp;i</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3285em;">&nbsp;e</span><span class="stl_58 stl_59 stl_972" style="word-spacing:-0.3275em;">&nbsp;d</span><span class="stl_58 stl_59 stl_972" style="word-spacing:0.3945em;">&nbsp;database</span><span class="stl_58 stl_59 stl_972" style="word-spacing:0.3555em;">&nbsp;id</span><span class="stl_58 stl_59 stl_972" style="word-spacing:0.3555em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5677em; left:6.4408em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 46.5677em; left:7.4986em;"><span class="stl_58 stl_59 stl_1032" style="word-spacing:0.234em;">to AOF</span><span class="stl_58 stl_59 stl_1032" style="word-spacing:0.168em;">&nbsp;and</span><span class="stl_58 stl_59 stl_1032" style="word-spacing:0.394em;">&nbsp;Slaves</span><span class="stl_58 stl_59 stl_1032" style="word-spacing:0.394em;">&nbsp;. &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.1. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">积压空间 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">129 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:6.4408em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 6.7168em; left:6.4408em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:6.4408em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7093em; left:6.4408em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.5459em;"><span class="stl_58 stl_59 stl_222" style="word-spacing:-0.2645em;">f l</span><span class="stl_58 stl_59 stl_222" style="word-spacing:-0.2645em;">&nbsp;a</span><span class="stl_58 stl_59 stl_222" style="word-spacing:-0.2645em;">&nbsp;g</span><span class="stl_58 stl_59 stl_222" style="word-spacing:-0.2635em;">&nbsp;s</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.4375em;">&nbsp;are</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3035em;">&nbsp;an xor</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3605em;">&nbsp;between</span><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3605em;">&nbsp;: &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.33em;"><span class="stl_58 stl_59 stl_774" style="word-spacing:0.1799em;">+ REDIS_PROPAGATE_NONE</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.3569em;">&nbsp;(no</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.5229em;">&nbsp;propagation</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.608em;">&nbsp;of</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.4839em;">&nbsp;command at</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.6729em;">&nbsp;a</span><span class="stl_58 stl_59 stl_774" style="word-spacing:-0.0451em;">&nbsp;l</span><span class="stl_58 stl_59 stl_774" style="word-spacing:-0.0461em;">&nbsp;l</span><span class="stl_58 stl_59 stl_774" style="word-spacing:-0.0461em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:7.33em;"><span class="stl_58 stl_59 stl_411" style="word-spacing:0.1887em;">+ REDIS_PROPAGATE_AOF</span><span class="stl_58 stl_59 stl_411" style="word-spacing:0.3667em;">&nbsp;(</span><span class="stl_58 stl_59 stl_411" style="word-spacing:-0.0213em;">&nbsp;propagate</span><span class="stl_58 stl_59 stl_411" style="word-spacing:0.6242em;">&nbsp;into the</span><span class="stl_58 stl_59 stl_411" style="word-spacing:0.3987em;">&nbsp;AOF</span><span class="stl_58 stl_59 stl_411" style="word-spacing:0.4877em;">&nbsp;f</span><span class="stl_58 stl_59 stl_411" style="word-spacing:-0.0203em;">&nbsp;i</span><span class="stl_58 stl_59 stl_411" style="word-spacing:-0.0203em;">&nbsp;l</span><span class="stl_58 stl_59 stl_411" style="word-spacing:-0.0203em;">&nbsp;e</span><span class="stl_58 stl_59 stl_411" style="word-spacing:0.7747em;">&nbsp;i</span><span class="stl_58 stl_59 stl_411" style="word-spacing:-0.0383em;">&nbsp;f</span><span class="stl_58 stl_59 stl_411" style="word-spacing:0.7217em;">&nbsp;i</span><span class="stl_58 stl_59 stl_411" style="word-spacing:0.7217em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.1658em;"><span class="stl_58 stl_59 stl_1145" style="word-spacing:-0.2757em;">enabled ) &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:6.4408em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 12.6943em; left:6.4525em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.33em;"><span class="stl_58 stl_59 stl_446" style="word-spacing:0.1826em;">+ REDIS_PROPAGATE_REPL</span><span class="stl_58 stl_59 stl_446" style="word-spacing:0.3606em;">&nbsp;(</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0344em;">&nbsp;propagate</span><span class="stl_58 stl_59 stl_446" style="word-spacing:0.6206em;">&nbsp;into the r</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0834em;">&nbsp;e</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;p</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0834em;">&nbsp;l</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;i</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0834em;">&nbsp;c</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;a</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;t</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0834em;">&nbsp;i</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;o</span><span class="stl_58 stl_59 stl_446" style="word-spacing:-0.0844em;">&nbsp;n &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.1992em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.0632em;">l i n k ) &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:6.9257em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.6843em; left:5.9483em;"><span class="stl_15 stl_16 stl_469">void</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.3558em;">&nbsp;</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3558em;">propagate</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.1905em;">&nbsp;(</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.2074em;">&nbsp;</span><span class="stl_15 stl_16 stl_469" style="word-spacing:-0.2074em;">struct</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.3359em;">&nbsp;</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3359em;">redisCommand</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.2965em;">&nbsp;*cmd,</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.4569em;">&nbsp;</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.4569em;">int</span><span class="stl_15 stl_16 stl_469" style="word-spacing:0.3723em;">&nbsp;</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3723em;">dbid</span><span class="stl_10 stl_11 stl_469" style="word-spacing:-0.0905em;">&nbsp;,</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.4875em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_469" style="word-spacing:0.3935em;">&nbsp;** &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:7.6325em;"><span class="stl_10 stl_11 stl_672" style="word-spacing:-0.1085em;">argv ,</span><span class="stl_10 stl_11 stl_672" style="word-spacing:0.4309em;">&nbsp;</span><span class="stl_15 stl_16 stl_672" style="word-spacing:0.4309em;">int</span><span class="stl_15 stl_16 stl_672" style="word-spacing:0.3634em;">&nbsp;</span><span class="stl_10 stl_11 stl_672" style="word-spacing:0.3634em;">argc</span><span class="stl_10 stl_11 stl_672" style="word-spacing:0.3634em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:13.4592em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.4231em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4231em;">f</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.277em;">&nbsp;l</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.277em;">&nbsp;a</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.277em;">&nbsp;g</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.276em;">&nbsp;s</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.276em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 17.676em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.4207em;"><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3497em;">/ AOF</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3904em;">&nbsp;</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.3904em;">策</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0193em;">&nbsp;略</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;需</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;要</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;打</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.0152em;">&nbsp;开， 且</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;设</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;置</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.3916em;">&nbsp;</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3916em;">AOF</span><span class="stl_58 stl_59 stl_1035" style="word-spacing:0.3903em;">&nbsp;</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.3903em;">传</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0193em;">&nbsp;播</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;标</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:0.0152em;">&nbsp;记， 将</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;更</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;新</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;发</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;布</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;给</span><span class="stl_17 stl_18 stl_1035" style="word-spacing:-0.0183em;">&nbsp;本 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.8932em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">地 文 件 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:8.045em;"><span class="stl_15 stl_16 stl_962" style="word-spacing:-0.1273em;">i f</span><span class="stl_15 stl_16 stl_962" style="word-spacing:0.5791em;">&nbsp;</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.5791em;">(</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.0543em;">&nbsp;server</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.0088em;">&nbsp;. aof_state</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.4677em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.2687em;">&nbsp;REDIS_AOF_OFF</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.1017em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_962" style="word-spacing:0.3477em;">&nbsp;f</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1333em;">&nbsp;l</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1333em;">&nbsp;a</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1323em;">&nbsp;g</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1333em;">&nbsp;s</span><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.1333em;">&nbsp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:9.4775em;"><span class="stl_10 stl_11 stl_1036">REDIS_PROPAGATE_AOF) &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:9.9708em;"><span class="stl_10 stl_11 stl_1037" style="word-spacing:-0.1697em;">feedAppendOnlyFile (cmd, dbid , argv , argc ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">设 置</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;了</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;传</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;播</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;标</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;记，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;将</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;更</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;发</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;布</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;给</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:8.045em;"><span class="stl_15 stl_16 stl_1146" style="word-spacing:0.0949em;">i f</span><span class="stl_15 stl_16 stl_1146" style="word-spacing:0.8013em;">&nbsp;</span><span class="stl_10 stl_11 stl_1146" style="word-spacing:0.8013em;">(</span><span class="stl_10 stl_11 stl_1146" style="word-spacing:0.1939em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1146" style="word-spacing:0.0894em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1146" style="word-spacing:0.5999em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1146" style="word-spacing:0.3399em;">&nbsp;REDIS_PROPAGATE_REPL) &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:10.0108em;"><span class="stl_10 stl_11 stl_1039" style="word-spacing:-0.2277em;">replicationFeedSlaves ( server . slaves , dbid , argv , argc ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.6351em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">向</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;积</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;压</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;和</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;送</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6243em; left:5.9483em;"><span class="stl_15 stl_16 stl_1147">void</span><span class="stl_15 stl_16 stl_1147" style="word-spacing:0.2882em;">&nbsp;</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:0.2882em;">replicationFeedSlaves</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:-0.2592em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:-0.1912em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:-0.2972em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:-0.2972em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:-0.2972em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:0.3538em;">&nbsp;*</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:-0.3272em;">&nbsp;slaves</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:-0.0822em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:0.3495em;">&nbsp;</span><span class="stl_15 stl_16 stl_1147" style="word-spacing:0.3495em;">int</span><span class="stl_15 stl_16 stl_1147" style="word-spacing:0.3278em;">&nbsp;</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:0.3278em;">dictid</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:-0.0732em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:0.3808em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_1147" style="word-spacing:0.2868em;">&nbsp;** &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:7.6325em;"><span class="stl_10 stl_11 stl_1008" style="word-spacing:-0.1225em;">argv ,</span><span class="stl_10 stl_11 stl_1008" style="word-spacing:0.4169em;">&nbsp;</span><span class="stl_15 stl_16 stl_1008" style="word-spacing:0.4169em;">int</span><span class="stl_15 stl_16 stl_1008" style="word-spacing:0.3684em;">&nbsp;</span><span class="stl_10 stl_11 stl_1008" style="word-spacing:0.3684em;">argc</span><span class="stl_10 stl_11 stl_1008" style="word-spacing:-0.2255em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1008" style="word-spacing:-0.2255em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:8.01em;"><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">listNode * ln</span><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:8.0708em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">l i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;I</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;r</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.773em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:7.98em;"><span class="stl_15 stl_16 stl_614">int</span><span class="stl_15 stl_16 stl_614" style="word-spacing:0.3179em;">&nbsp;</span><span class="stl_10 stl_11 stl_614" style="word-spacing:0.3179em;">j</span><span class="stl_10 stl_11 stl_614" style="word-spacing:-0.122em;">&nbsp;,</span><span class="stl_10 stl_11 stl_614" style="word-spacing:0.412em;">&nbsp;len</span><span class="stl_10 stl_11 stl_614" style="word-spacing:0.412em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:7.9342em;"><span class="stl_15 stl_16 stl_1148">char</span><span class="stl_15 stl_16 stl_1148" style="word-spacing:0.6634em;">&nbsp;</span><span class="stl_10 stl_11 stl_1148" style="word-spacing:0.6634em;">l</span><span class="stl_10 stl_11 stl_1148" style="word-spacing:0.0202em;">&nbsp;l s t r</span><span class="stl_10 stl_11 stl_1148" style="word-spacing:0.1807em;">&nbsp;[REDIS_LONGSTR_SIZE</span><span class="stl_10 stl_11 stl_1148" style="word-spacing:-0.0283em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1148" style="word-spacing:-0.0283em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">没 有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;积</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;压</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;且</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;没</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;机，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;直</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;退</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;出 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:8.4207em;"><span class="stl_58 stl_59 stl_797" style="word-spacing:0.3382em;">* I</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.3208em;">&nbsp;f</span><span class="stl_58 stl_59 stl_797" style="word-spacing:0.4152em;">&nbsp;there</span><span class="stl_58 stl_59 stl_797" style="word-spacing:0.3352em;">&nbsp;aren</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.2058em;">&nbsp;’</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.2578em;">&nbsp;t</span><span class="stl_58 stl_59 stl_797" style="word-spacing:0.3812em;">&nbsp;slaves</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.0688em;">&nbsp;,</span><span class="stl_58 stl_59 stl_797" style="word-spacing:0.3052em;">&nbsp;and there</span><span class="stl_58 stl_59 stl_797" style="word-spacing:0.4082em;">&nbsp;i</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.3288em;">&nbsp;s</span><span class="stl_58 stl_59 stl_797" style="word-spacing:0.3012em;">&nbsp;no backlog</span><span class="stl_58 stl_59 stl_797" style="word-spacing:0.4032em;">&nbsp;b</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.3308em;">&nbsp;u</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.3318em;">&nbsp;f</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.3318em;">&nbsp;f</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.3318em;">&nbsp;e</span><span class="stl_58 stl_59 stl_797" style="word-spacing:-0.3318em;">&nbsp;r &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:10.1558em;"><span class="stl_58 stl_59 stl_721" style="word-spacing:0.3515em;">to populate</span><span class="stl_58 stl_59 stl_721" style="word-spacing:0.3515em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.413em;"><span class="stl_58 stl_59 stl_139" style="word-spacing:0.3321em;">we can</span><span class="stl_58 stl_59 stl_139" style="word-spacing:0.4291em;">&nbsp;return</span><span class="stl_58 stl_59 stl_139" style="word-spacing:0.2981em;">&nbsp;ASAP.</span><span class="stl_58 stl_59 stl_139" style="word-spacing:0.4451em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5835em; left:8.045em;"><span class="stl_15 stl_16 stl_1149" style="word-spacing:-0.2485em;">i f</span><span class="stl_15 stl_16 stl_1149" style="word-spacing:0.4579em;">&nbsp;</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:0.4579em;">(</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.1755em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.1195em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.1495em;">&nbsp;repl_backlog</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:0.1705em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.0145em;">&nbsp;NULL</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.0135em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:0.2005em;">&nbsp;listLength</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.1745em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.1675em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.2725em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.2725em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.2735em;">&nbsp;v</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.2725em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.2725em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:-0.1675em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1149" style="word-spacing:0.1625em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5793em; left:10.1456em;"><span class="stl_10 stl_11 stl_127">)</span><span class="stl_10 stl_11 stl_127" style="word-spacing:0.3961em;">&nbsp;</span><span class="stl_15 stl_16 stl_127" style="word-spacing:0.3961em;">return</span><span class="stl_15 stl_16 stl_127" style="word-spacing:-0.1467em;">&nbsp;</span><span class="stl_10 stl_11 stl_127" style="word-spacing:0.3961em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:9.6442em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 43.5793em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:8.4207em;"><span class="stl_58 stl_59 stl_293" style="word-spacing:0.1306em;">* We can</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.1839em;">&nbsp;’</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.2139em;">&nbsp;t</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.3916em;">&nbsp;have s</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.2899em;">&nbsp;l</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.2899em;">&nbsp;a</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.2889em;">&nbsp;v</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.2899em;">&nbsp;e</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.2889em;">&nbsp;s</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.4401em;">&nbsp;attached</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.3381em;">&nbsp;and</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.2511em;">&nbsp;no</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.3321em;">&nbsp;backlog</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.1639em;">&nbsp;.</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.3601em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:8.0208em;"><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.1797em;">redisAssert (</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3277em;">&nbsp;!</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3277em;">&nbsp;(</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.1837em;">&nbsp;listLength</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.2637em;">&nbsp;(</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.2557em;">&nbsp;s</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3627em;">&nbsp;l</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3617em;">&nbsp;a</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3617em;">&nbsp;v</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3627em;">&nbsp;e</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.3617em;">&nbsp;s</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.2567em;">&nbsp;)</span><span class="stl_10 stl_11 stl_100" style="word-spacing:0.2403em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_100" style="word-spacing:0.1843em;">&nbsp;0</span><span class="stl_10 stl_11 stl_100" style="word-spacing:0.0173em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.0492em;">&nbsp;server</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.0492em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:9.6525em;"><span class="stl_10 stl_11 stl_1150" style="word-spacing:0.2256em;">repl_backlog ==</span><span class="stl_10 stl_11 stl_1150" style="word-spacing:-0.1177em;">&nbsp;NULL) )</span><span class="stl_10 stl_11 stl_1150" style="word-spacing:-0.1177em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">130 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_622" style="word-spacing:0.3877em;">* Send</span><span class="stl_58 stl_59 stl_622" style="word-spacing:0.2747em;">&nbsp;SELECT</span><span class="stl_58 stl_59 stl_622" style="word-spacing:0.2137em;">&nbsp;command</span><span class="stl_58 stl_59 stl_622" style="word-spacing:0.3877em;">&nbsp;to</span><span class="stl_58 stl_59 stl_622" style="word-spacing:0.5212em;">&nbsp;every s</span><span class="stl_58 stl_59 stl_622" style="word-spacing:-0.1813em;">&nbsp;l</span><span class="stl_58 stl_59 stl_622" style="word-spacing:-0.1823em;">&nbsp;a</span><span class="stl_58 stl_59 stl_622" style="word-spacing:-0.1813em;">&nbsp;v</span><span class="stl_58 stl_59 stl_622" style="word-spacing:-0.1813em;">&nbsp;e</span><span class="stl_58 stl_59 stl_622" style="word-spacing:0.6137em;">&nbsp;i</span><span class="stl_58 stl_59 stl_622" style="word-spacing:-0.1373em;">&nbsp;f</span><span class="stl_58 stl_59 stl_622" style="word-spacing:0.5537em;">&nbsp;needed</span><span class="stl_58 stl_59 stl_622" style="word-spacing:-0.0943em;">&nbsp;.</span><span class="stl_58 stl_59 stl_622" style="word-spacing:0.4737em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:8.045em;"><span class="stl_15 stl_16 stl_1012" style="word-spacing:-0.3537em;">i f</span><span class="stl_15 stl_16 stl_1012" style="word-spacing:0.3527em;">&nbsp;</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:0.3527em;">(</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:-0.2807em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:-0.2247em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:-0.2207em;">&nbsp;slaveseldb</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:0.2708em;">&nbsp;!= d</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:-0.3727em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:-0.3727em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:-0.3727em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:-0.3727em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:-0.3727em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:-0.2667em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1012" style="word-spacing:-0.2667em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9975em;"><span class="stl_10 stl_11 stl_791" style="word-spacing:-0.0365em;">robj * selectcmd</span><span class="stl_10 stl_11 stl_791" style="word-spacing:-0.0365em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.4132em;"><span class="stl_58 stl_59 stl_71">/</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.3918em;">&nbsp;</span><span class="stl_17 stl_18 stl_71" style="word-spacing:0.3918em;">小</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.169em;">&nbsp;于</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;等</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;于</span><span class="stl_17 stl_18 stl_71" style="word-spacing:0.3918em;">&nbsp;</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.3918em;">10</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.3918em;">&nbsp;</span><span class="stl_17 stl_18 stl_71" style="word-spacing:0.3918em;">的</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.169em;">&nbsp;可</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;以</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;用</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;共</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;享</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;对</span><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.168em;">&nbsp;象 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:10.4132em;"><span class="stl_58 stl_59 stl_1151" style="word-spacing:0.3941em;">* For a few</span><span class="stl_58 stl_59 stl_1151" style="word-spacing:0.3534em;">&nbsp;DBs</span><span class="stl_58 stl_59 stl_1151" style="word-spacing:0.2854em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1151" style="word-spacing:0.3954em;">&nbsp;have</span><span class="stl_58 stl_59 stl_1151" style="word-spacing:0.4514em;">&nbsp;pre</span><span class="stl_107 stl_108 stl_1151" style="word-spacing:0.4514em;">−</span><span class="stl_58 stl_59 stl_1151" style="word-spacing:0.4514em;">computed</span><span class="stl_58 stl_59 stl_1151" style="word-spacing:0.2974em;">&nbsp;SELECT</span><span class="stl_58 stl_59 stl_1151" style="word-spacing:0.2244em;">&nbsp;command. &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:12.0983em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 11.6985em; left:12.5716em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6877em; left:10.0375em;"><span class="stl_15 stl_16 stl_1152" style="word-spacing:0.0911em;">i f</span><span class="stl_15 stl_16 stl_1152" style="word-spacing:0.7975em;">&nbsp;</span><span class="stl_10 stl_11 stl_1152" style="word-spacing:0.7975em;">(</span><span class="stl_10 stl_11 stl_1152" style="word-spacing:0.1771em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1152" style="word-spacing:0.0721em;">&nbsp;i c t i d</span><span class="stl_10 stl_11 stl_1152" style="word-spacing:0.4846em;">&nbsp;&gt;= 0</span><span class="stl_10 stl_11 stl_1152" style="word-spacing:0.4471em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_1152" style="word-spacing:0.5521em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1152" style="word-spacing:0.0721em;">&nbsp;i c t i d</span><span class="stl_10 stl_11 stl_1152" style="word-spacing:0.5541em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_1152" style="word-spacing:0.3701em;">&nbsp;REDIS_SHARED_SELECT_CMDS) &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:12.0908em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 14.686em; left:11.9808em;"><span class="stl_10 stl_11 stl_969" style="word-spacing:0.1457em;">selectcmd = shared</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.2088em;">&nbsp;.</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.1448em;">&nbsp;s</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3048em;">&nbsp;e</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3058em;">&nbsp;l</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3048em;">&nbsp;e</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3058em;">&nbsp;c</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3048em;">&nbsp;t</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.1448em;">&nbsp;[</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.1598em;">&nbsp;d</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3208em;">&nbsp;i</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3208em;">&nbsp;c</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3208em;">&nbsp;t</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3208em;">&nbsp;i</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3208em;">&nbsp;d</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.1058em;">&nbsp;]</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.1058em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6768em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:10.4132em;"><span class="stl_58 stl_59 stl_440">/</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.4182em;">&nbsp;</span><span class="stl_17 stl_18 stl_440" style="word-spacing:0.4182em;">不</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1426em;">&nbsp;能</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1416em;">&nbsp;使</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1416em;">&nbsp;用</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1416em;">&nbsp;共</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1416em;">&nbsp;享</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1416em;">&nbsp;对</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1076em;">&nbsp;象，</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1086em;">&nbsp;生</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1416em;">&nbsp;成</span><span class="stl_17 stl_18 stl_440" style="word-spacing:0.3049em;">&nbsp;</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.3049em;">SELECT</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.3045em;">&nbsp;</span><span class="stl_17 stl_18 stl_440" style="word-spacing:0.3045em;">命</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1426em;">&nbsp;令</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1416em;">&nbsp;对</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1416em;">&nbsp;应</span><span class="stl_17 stl_18 stl_440" style="word-spacing:-0.1416em;">&nbsp;的</span><span class="stl_17 stl_18 stl_440" style="word-spacing:0.507em;">&nbsp;</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.507em;">redis</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.5075em;">&nbsp;</span><span class="stl_17 stl_18 stl_440" style="word-spacing:0.507em;">对 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.8965em; left:11.6342em;"><span class="stl_17 stl_18 stl_07">象</span></div>
					<div class="stl_01" style="top: 18.666em; left:11.965em;"><span class="stl_15 stl_16 stl_1153">int</span><span class="stl_15 stl_16 stl_1153" style="word-spacing:0.3285em;">&nbsp;</span><span class="stl_10 stl_11 stl_1153" style="word-spacing:0.3285em;">dictid_len</span><span class="stl_10 stl_11 stl_1153" style="word-spacing:0.3285em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:11.9942em;"><span class="stl_10 stl_11 stl_1154" style="word-spacing:0.1351em;">dictid_len =</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.1417em;">&nbsp;l l</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3269em;">&nbsp;2</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3259em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3269em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3259em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3269em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3259em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3269em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.2209em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.2229em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3279em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3289em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3289em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3289em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:0.0141em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.2255em;">&nbsp;</span><span class="stl_15 stl_16 stl_1154" style="word-spacing:-0.2255em;">sizeof</span><span class="stl_15 stl_16 stl_1154" style="word-spacing:-0.2806em;">&nbsp;</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.2806em;">(</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.1939em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.2979em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.2989em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.2979em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.2989em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.1929em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.1899em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.2449em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3529em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3529em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3529em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3529em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1154" style="word-spacing:-0.3529em;">&nbsp;d &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:13.6308em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 21.6593em; left:14.1747em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 22.656em; left:11.9808em;"><span class="stl_10 stl_11 stl_1155" style="word-spacing:0.2547em;">selectcmd = createObject</span><span class="stl_10 stl_11 stl_1155" style="word-spacing:-0.1448em;">&nbsp;(REDIS_STRING, &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:14.0067em;"><span class="stl_10 stl_11 stl_829" style="word-spacing:-0.2387em;">s d s c a t p r i n t f ( sdsempty () , &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:13.9292em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 24.6485em; left:14.4356em;"><span class="stl_10 stl_11 stl_1116" style="word-spacing:-0.1194em;">*2\ r \n$6\ r \nSELECT\ r \n$%d\ r \n%s \ r \n” , &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:13.9775em;"><span class="stl_10 stl_11 stl_1156" style="word-spacing:-0.0891em;">dictid_len ,</span><span class="stl_10 stl_11 stl_1156" style="word-spacing:0.4769em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1156" style="word-spacing:-0.2831em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1156" style="word-spacing:-0.2841em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1156" style="word-spacing:-0.2831em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1156" style="word-spacing:-0.2831em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1156" style="word-spacing:-0.1781em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1156" style="word-spacing:-0.2841em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1156" style="word-spacing:-0.2841em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.6351em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">这 里</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;能</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;疑</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;问：</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;为</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;什</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;么</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;把</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;添</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;加</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;积</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;压</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;空</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;间，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;又</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;把 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.8515em; left:11.6342em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3123em;">数 据 分 发 给 所 有 的 从 机？ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.6276em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">为 什</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;么</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;仅</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;仅</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;将</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;分</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;发</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;给</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;所</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;呢？ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">因</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;些</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;会</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;因</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;特</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;殊</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;情</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;况</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.066em;">&nbsp;（ ？</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.084em;">&nbsp;？</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.083em;">&nbsp;？</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.083em;">&nbsp;）</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.034em;">&nbsp;与 主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;断</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;开</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;连 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.8407em; left:11.6617em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3127em;">接， 注 意 从 机 断 开 前 有 暂 存 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">主 机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;状</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;态</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;信</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;息，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;因</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;此</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;这</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;些</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;断</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;开</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;就</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;没</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;及</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;收</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;到</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;更 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:11.6342em;"><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3414em;">新 的</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3064em;">&nbsp;据。</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.258em;">&nbsp;</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.258em;">redis</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.0317em;">&nbsp;</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.0317em;">为 了</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.0317em;">&nbsp;让 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">断 开</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;在</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;下</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;次</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;连</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;后</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;能</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;够</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;获</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;取</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;更</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;据，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;将</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;更</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.8257em; left:11.6342em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3105em;">加 入 了 积 压 空 间。 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.5976em; left:10.4132em;"><span class="stl_58 stl_59 stl_1158">/</span><span class="stl_58 stl_59 stl_1158" style="word-spacing:0.4376em;">&nbsp;</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:0.4376em;">将</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:0.3239em;">&nbsp;</span><span class="stl_58 stl_59 stl_1158" style="word-spacing:0.3239em;">SELECT</span><span class="stl_58 stl_59 stl_1158" style="word-spacing:0.3229em;">&nbsp;</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:0.3229em;">命</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;令</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;对</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;应</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:0.5264em;">&nbsp;</span><span class="stl_58 stl_59 stl_1158" style="word-spacing:0.5264em;">redis</span><span class="stl_58 stl_59 stl_1158" style="word-spacing:0.5259em;">&nbsp;</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:0.5259em;">对</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;象</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;据</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;添</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;加</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;到</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;积</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;压</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;空</span><span class="stl_17 stl_18 stl_1158" style="word-spacing:-0.1222em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:10.4132em;"><span class="stl_58 stl_59 stl_493" style="word-spacing:0.3041em;">* Add</span><span class="stl_58 stl_59 stl_493" style="word-spacing:0.3691em;">&nbsp;the</span><span class="stl_58 stl_59 stl_493" style="word-spacing:0.3061em;">&nbsp;SELECT</span><span class="stl_58 stl_59 stl_493" style="word-spacing:0.1821em;">&nbsp;command</span><span class="stl_58 stl_59 stl_493" style="word-spacing:0.3751em;">&nbsp;into</span><span class="stl_58 stl_59 stl_493" style="word-spacing:0.4966em;">&nbsp;the backlog</span><span class="stl_58 stl_59 stl_493" style="word-spacing:-0.0819em;">&nbsp;.</span><span class="stl_58 stl_59 stl_493" style="word-spacing:0.4421em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5835em; left:10.0375em;"><span class="stl_15 stl_16 stl_347" style="word-spacing:-0.3196em;">i f</span><span class="stl_15 stl_16 stl_347" style="word-spacing:0.3868em;">&nbsp;</span><span class="stl_10 stl_11 stl_347" style="word-spacing:0.3868em;">(</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2466em;">&nbsp;server</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.1906em;">&nbsp;.</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2206em;">&nbsp;repl_backlog</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2206em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:11.6483em;"><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.2503em;">feedReplicationBacklogWithObject ( selectcmd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">将</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;据</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;所</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:10.4132em;"><span class="stl_58 stl_59 stl_374" style="word-spacing:0.3256em;">* Send</span><span class="stl_58 stl_59 stl_374" style="word-spacing:0.4536em;">&nbsp;i</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.2074em;">&nbsp;t</span><span class="stl_58 stl_59 stl_374" style="word-spacing:0.4966em;">&nbsp;to s</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.2384em;">&nbsp;l</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.2384em;">&nbsp;a</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.2374em;">&nbsp;v</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.2384em;">&nbsp;e</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.2374em;">&nbsp;s</span><span class="stl_58 stl_59 stl_374" style="word-spacing:-0.0914em;">&nbsp;.</span><span class="stl_58 stl_59 stl_374" style="word-spacing:0.4116em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:9.9942em;"><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.2301em;">listRewind ( slaves ,&amp; l i ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.561em; left:9.9408em;"><span class="stl_15 stl_16 stl_759">while</span><span class="stl_15 stl_16 stl_759" style="word-spacing:-0.2586em;">&nbsp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.2586em;">((</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.198em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_759" style="word-spacing:0.172em;">&nbsp;=</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.111em;">&nbsp;lis tN</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.311em;">&nbsp;ext</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.3em;">&nbsp;(&amp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.236em;">&nbsp;l</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.246em;">&nbsp;i</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.141em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;{ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.1. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">积压空间 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">131 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:12.0125em;z-index:33; "><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2731em;">r e</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2731em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2731em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.3779em;">&nbsp;*</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2361em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.2259em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1739em;">&nbsp;ln</span><span class="stl_107 stl_108 stl_1159" style="word-spacing:0.1739em;">−</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1739em;">&gt;value</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1739em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:11.9425em;"><span class="stl_10 stl_11 stl_553" style="word-spacing:-0.1903em;">addReply ( slave , selectcmd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">销</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;毁</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;对</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;象 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:10.0375em;"><span class="stl_15 stl_16 stl_1160" style="word-spacing:0.0882em;">i f</span><span class="stl_15 stl_16 stl_1160" style="word-spacing:0.7946em;">&nbsp;</span><span class="stl_10 stl_11 stl_1160" style="word-spacing:0.7946em;">(</span><span class="stl_10 stl_11 stl_1160" style="word-spacing:0.1742em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1160" style="word-spacing:0.0692em;">&nbsp;i c t i d</span><span class="stl_10 stl_11 stl_1160" style="word-spacing:0.5267em;">&nbsp;&lt; 0</span><span class="stl_10 stl_11 stl_1160" style="word-spacing:0.7772em;">&nbsp;|</span><span class="stl_10 stl_11 stl_1160" style="word-spacing:0.1272em;">&nbsp;|</span><span class="stl_10 stl_11 stl_1160" style="word-spacing:0.8832em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1160" style="word-spacing:0.0692em;">&nbsp;i c t i d</span><span class="stl_10 stl_11 stl_1160" style="word-spacing:0.4912em;">&nbsp;&gt;=</span><span class="stl_10 stl_11 stl_1160" style="word-spacing:0.3372em;">&nbsp;REDIS_SHARED_SELECT_CMDS) &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:11.9567em;"><span class="stl_10 stl_11 stl_472" style="word-spacing:-0.2253em;">decrRefCount ( selectcmd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 14.6876em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">更 新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;最</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;近</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;次</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;使</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;（访</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.249em;">&nbsp;问）</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;集 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:8.0175em;"><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.2379em;">server .</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.2339em;">&nbsp;slaveseldb</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.1446em;">&nbsp;= d i</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.3859em;">&nbsp;c</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.3859em;">&nbsp;t</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.3859em;">&nbsp;i</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.3859em;">&nbsp;d</span><span class="stl_10 stl_11 stl_167" style="word-spacing:-0.3859em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">将</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;积</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;压</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4207em;"><span class="stl_58 stl_59 stl_362" style="word-spacing:0.326em;">* Write</span><span class="stl_58 stl_59 stl_362" style="word-spacing:0.391em;">&nbsp;the</span><span class="stl_58 stl_59 stl_362" style="word-spacing:0.3095em;">&nbsp;command to</span><span class="stl_58 stl_59 stl_362" style="word-spacing:0.4525em;">&nbsp;the r</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.25em;">&nbsp;e</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.25em;">&nbsp;p</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.249em;">&nbsp;l</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.25em;">&nbsp;i</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.249em;">&nbsp;c</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.25em;">&nbsp;a</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.249em;">&nbsp;t</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.25em;">&nbsp;i</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.25em;">&nbsp;o</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.249em;">&nbsp;n</span><span class="stl_58 stl_59 stl_362" style="word-spacing:0.502em;">&nbsp;backlog i</span><span class="stl_58 stl_59 stl_362" style="word-spacing:-0.218em;">&nbsp;f</span><span class="stl_58 stl_59 stl_362" style="word-spacing:0.443em;">&nbsp;any</span><span class="stl_58 stl_59 stl_362" style="word-spacing:0.443em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:9.6075em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:10.0807em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6585em; left:8.045em;"><span class="stl_15 stl_16 stl_347" style="word-spacing:-0.3196em;">i f</span><span class="stl_15 stl_16 stl_347" style="word-spacing:0.3868em;">&nbsp;</span><span class="stl_10 stl_11 stl_347" style="word-spacing:0.3868em;">(</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2466em;">&nbsp;server</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.1906em;">&nbsp;.</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2206em;">&nbsp;repl_backlog</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2766em;">&nbsp;)</span><span class="stl_10 stl_11 stl_347" style="word-spacing:-0.2766em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:9.9267em;"><span class="stl_15 stl_16 stl_33">char</span><span class="stl_15 stl_16 stl_33" style="word-spacing:0.4551em;">&nbsp;</span><span class="stl_10 stl_11 stl_33" style="word-spacing:0.4551em;">aux</span><span class="stl_10 stl_11 stl_33" style="word-spacing:-0.0271em;">&nbsp;[REDIS_LONGSTR_SIZE+3]; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:10.4132em;"><span class="stl_58 stl_59 stl_1108" style="word-spacing:0.1759em;">* Add</span><span class="stl_58 stl_59 stl_1108" style="word-spacing:0.2409em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1108" style="word-spacing:0.3787em;">&nbsp;multi bulk reply length</span><span class="stl_58 stl_59 stl_1108" style="word-spacing:-0.2001em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1108" style="word-spacing:0.3139em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:9.9358em;"><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.117em;">aux [</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.171em;">&nbsp;0</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.171em;">&nbsp;]</span><span class="stl_10 stl_11 stl_179" style="word-spacing:0.3545em;">&nbsp;= ’</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.2em;">&nbsp;*</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.092em;">&nbsp;’</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.092em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.636em; left:9.9992em;"><span class="stl_10 stl_11 stl_233" style="word-spacing:0.2024em;">len =</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.0012em;">&nbsp;l l</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2566em;">&nbsp;2</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2556em;">&nbsp;s</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2566em;">&nbsp;t</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2556em;">&nbsp;r</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2566em;">&nbsp;i</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2556em;">&nbsp;n</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2566em;">&nbsp;g</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.1506em;">&nbsp;(</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2796em;">&nbsp;aux+1,</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2678em;">&nbsp;</span><span class="stl_15 stl_16 stl_233" style="word-spacing:-0.2678em;">sizeof</span><span class="stl_15 stl_16 stl_233" style="word-spacing:-0.2103em;">&nbsp;</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2103em;">(</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2806em;">&nbsp;aux</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2796em;">&nbsp;)</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2526em;">&nbsp;</span><span class="stl_107 stl_108 stl_233" style="word-spacing:-0.2796em;">−</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2526em;">1,</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2856em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2206em;">&nbsp;)</span><span class="stl_10 stl_11 stl_233" style="word-spacing:-0.2206em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:9.9358em;"><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.1983em;">aux [</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.1213em;">&nbsp;len</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2223em;">&nbsp;+1]</span><span class="stl_10 stl_11 stl_289" style="word-spacing:0.1587em;">&nbsp;=</span><span class="stl_10 stl_11 stl_289" style="word-spacing:0.3127em;">&nbsp;’</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2563em;">&nbsp;\</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2593em;">&nbsp;r</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.0943em;">&nbsp;’</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.0943em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:9.9358em;"><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1956em;">aux [</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1186em;">&nbsp;len</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2196em;">&nbsp;+2]</span><span class="stl_10 stl_11 stl_338" style="word-spacing:0.1614em;">&nbsp;=</span><span class="stl_10 stl_11 stl_338" style="word-spacing:0.3154em;">&nbsp;’</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2536em;">&nbsp;\n</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1736em;">&nbsp;’</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1736em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:10em;"><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.2615em;">feedReplicationBacklog (aux , len +3) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">逐</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6135em; left:9.9733em;"><span class="stl_15 stl_16 stl_1096">for</span><span class="stl_15 stl_16 stl_1096" style="word-spacing:0.3966em;">&nbsp;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.3966em;">(</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:-0.1573em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2457em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.4787em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2187em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2447em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:-0.1353em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.4987em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.4987em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:11.9317em;"><span class="stl_15 stl_16 stl_1058">long</span><span class="stl_15 stl_16 stl_1058" style="word-spacing:0.3171em;">&nbsp;</span><span class="stl_10 stl_11 stl_1058" style="word-spacing:0.3171em;">objlen</span><span class="stl_10 stl_11 stl_1058" style="word-spacing:0.1707em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1058" style="word-spacing:-0.0976em;">&nbsp;stringObjectLen (</span><span class="stl_10 stl_11 stl_1058" style="word-spacing:-0.2763em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_1058" style="word-spacing:-0.2213em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1058" style="word-spacing:-0.1703em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1058" style="word-spacing:-0.1533em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1058" style="word-spacing:-0.3013em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1058" style="word-spacing:-0.3013em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:12.4057em;"><span class="stl_58 stl_59 stl_1161" style="word-spacing:0.121em;">* We</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:0.143em;">&nbsp;need</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:0.348em;">&nbsp;to</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:0.4113em;">&nbsp;feed the b</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:-0.293em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:-0.294em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:-0.294em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:-0.294em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:-0.294em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:0.4127em;">&nbsp;with the o</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:-0.299em;">&nbsp;b</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:-0.299em;">&nbsp;j</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:-0.299em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:-0.299em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:-0.299em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1161" style="word-spacing:0.394em;">&nbsp;as &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:13.5808em;"><span class="stl_58 stl_59 stl_687" style="word-spacing:0.2484em;">a bulk</span><span class="stl_58 stl_59 stl_687" style="word-spacing:0.3494em;">&nbsp;reply &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 37.601em; left:13.4595em;"><span class="stl_58 stl_59 stl_74" style="word-spacing:0.3543em;">not j</span><span class="stl_58 stl_59 stl_74" style="word-spacing:-0.3447em;">&nbsp;u</span><span class="stl_58 stl_59 stl_74" style="word-spacing:-0.3447em;">&nbsp;s</span><span class="stl_58 stl_59 stl_74" style="word-spacing:-0.3447em;">&nbsp;t</span><span class="stl_58 stl_59 stl_74" style="word-spacing:0.3483em;">&nbsp;as</span><span class="stl_58 stl_59 stl_74" style="word-spacing:0.2293em;">&nbsp;a</span><span class="stl_58 stl_59 stl_74" style="word-spacing:0.2793em;">&nbsp;plain</span><span class="stl_58 stl_59 stl_74" style="word-spacing:0.3733em;">&nbsp;string</span><span class="stl_58 stl_59 stl_74" style="word-spacing:-0.0837em;">&nbsp;,</span><span class="stl_58 stl_59 stl_74" style="word-spacing:0.3353em;">&nbsp;so create the</span><span class="stl_58 stl_59 stl_74" style="word-spacing:0.2663em;">&nbsp;$</span><span class="stl_58 stl_59 stl_74" style="word-spacing:-0.2617em;">&nbsp;.</span><span class="stl_58 stl_59 stl_74" style="word-spacing:-0.2617em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:13.9875em;"><span class="stl_58 stl_59 stl_106" style="word-spacing:0.2617em;">CRLF payload</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.4577em;">&nbsp;len &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 39.5935em; left:13.4263em;"><span class="stl_58 stl_59 stl_1162" style="word-spacing:0.4076em;">ad add</span><span class="stl_58 stl_59 stl_1162" style="word-spacing:0.4726em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1162" style="word-spacing:0.5816em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1162" style="word-spacing:-0.1424em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1162" style="word-spacing:-0.1414em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1162" style="word-spacing:-0.1424em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1162" style="word-spacing:-0.1424em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1162" style="word-spacing:0.3926em;">&nbsp;CRLF</span><span class="stl_58 stl_59 stl_1162" style="word-spacing:0.2746em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:11.9283em;"><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.117em;">aux [</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.171em;">&nbsp;0</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.171em;">&nbsp;]</span><span class="stl_10 stl_11 stl_179" style="word-spacing:0.3545em;">&nbsp;= ’</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.2em;">&nbsp;$</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.092em;">&nbsp;’</span><span class="stl_10 stl_11 stl_179" style="word-spacing:-0.092em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5793em; left:11.9917em;"><span class="stl_10 stl_11 stl_1163" style="word-spacing:0.1873em;">len =</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.0313em;">&nbsp;l l</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2717em;">&nbsp;2</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2707em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2717em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2707em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2717em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2707em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2717em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.1657em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2947em;">&nbsp;aux+1,</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2829em;">&nbsp;</span><span class="stl_15 stl_16 stl_1163" style="word-spacing:-0.2829em;">sizeof</span><span class="stl_15 stl_16 stl_1163" style="word-spacing:-0.2254em;">&nbsp;</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2254em;">(</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2957em;">&nbsp;aux</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2947em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2677em;">&nbsp;</span><span class="stl_107 stl_108 stl_1163" style="word-spacing:-0.2947em;">−</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2677em;">1,</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2767em;">&nbsp;objlen</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2117em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:-0.2117em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:11.9283em;"><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.1983em;">aux [</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.1213em;">&nbsp;len</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2223em;">&nbsp;+1]</span><span class="stl_10 stl_11 stl_289" style="word-spacing:0.1587em;">&nbsp;=</span><span class="stl_10 stl_11 stl_289" style="word-spacing:0.3127em;">&nbsp;’</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2563em;">&nbsp;\</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.2593em;">&nbsp;r</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.0943em;">&nbsp;’</span><span class="stl_10 stl_11 stl_289" style="word-spacing:-0.0943em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:11.9283em;"><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1956em;">aux [</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1186em;">&nbsp;len</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2196em;">&nbsp;+2]</span><span class="stl_10 stl_11 stl_338" style="word-spacing:0.1614em;">&nbsp;=</span><span class="stl_10 stl_11 stl_338" style="word-spacing:0.3154em;">&nbsp;’</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.2536em;">&nbsp;\n</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1736em;">&nbsp;’</span><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1736em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.5676em; left:11.9358em;"><span class="stl_58 stl_59 stl_07">$</span></div>
					<div class="stl_01" style="top: 45.5718em; left:12.4057em;"><span class="stl_58 stl_59 stl_79">*</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">每 个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;命</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;令</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;格</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;式</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;如</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;下： &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:12.4024em;"><span class="stl_58 stl_59 stl_07">3</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">132 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">3</span></div>
					<div class="stl_01" style="top: 6.7168em; left:11.8508em;"><span class="stl_58 stl_59 stl_1164">SET &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">4</span></div>
					<div class="stl_01" style="top: 8.7093em; left:11.7733em;"><span class="stl_58 stl_59 stl_536">NAME &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 9.706em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">4</span></div>
					<div class="stl_01" style="top: 10.7018em; left:11.9317em;"><span class="stl_58 stl_59 stl_627">Jhon*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:11.9925em;"><span class="stl_10 stl_11 stl_668" style="word-spacing:-0.2617em;">feedReplicationBacklog (aux , len +3) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.98em;"><span class="stl_10 stl_11 stl_675" style="word-spacing:-0.2191em;">feedReplicationBacklogWithObject ( argv [ j ] ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">换</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;行 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:11.9925em;"><span class="stl_10 stl_11 stl_488" style="word-spacing:-0.2748em;">feedReplicationBacklog ( aux+len +1 ,2) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.671em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 19.6668em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 21.661em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.661em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">立</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;即</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;给</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;每</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;送</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_1165" style="word-spacing:0.3524em;">* Write</span><span class="stl_58 stl_59 stl_1165" style="word-spacing:0.4174em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1165" style="word-spacing:0.3359em;">&nbsp;command to</span><span class="stl_58 stl_59 stl_1165" style="word-spacing:0.4669em;">&nbsp;every s</span><span class="stl_58 stl_59 stl_1165" style="word-spacing:-0.2356em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1165" style="word-spacing:-0.2366em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1165" style="word-spacing:-0.2356em;">&nbsp;v</span><span class="stl_58 stl_59 stl_1165" style="word-spacing:-0.2356em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1165" style="word-spacing:-0.0896em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1165" style="word-spacing:0.4194em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:8.0017em;"><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.2301em;">listRewind ( slaves ,&amp; l i ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:7.9483em;"><span class="stl_15 stl_16 stl_759">while</span><span class="stl_15 stl_16 stl_759" style="word-spacing:-0.2586em;">&nbsp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.2586em;">((</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.199em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_759" style="word-spacing:0.173em;">&nbsp;=</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.111em;">&nbsp;listN e</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.311em;">&nbsp;xt</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.3em;">&nbsp;(&amp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.236em;">&nbsp;l</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.246em;">&nbsp;i</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.141em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:10.02em;z-index:280; "><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2731em;">r e</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2731em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2731em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.3779em;">&nbsp;*</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2361em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.2259em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1739em;">&nbsp;ln</span><span class="stl_107 stl_108 stl_1159" style="word-spacing:0.1739em;">−</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1739em;">&gt;value</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1739em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">如 果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;要</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;求</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;全</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;步，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;则</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;对</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;此</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;发</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;送</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:10.4132em;"><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.1252em;">* Don ’</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.2501em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:0.3954em;">&nbsp;feed s</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3261em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3261em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3251em;">&nbsp;v</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3261em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.3251em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:0.4169em;">&nbsp;that</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:0.3629em;">&nbsp;are</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:0.4599em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.2421em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.2421em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.2421em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:-0.2421em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:0.4899em;">&nbsp;waiting</span><span class="stl_58 stl_59 stl_1124" style="word-spacing:0.3899em;">&nbsp;for &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:11.4792em;"><span class="stl_58 stl_59 stl_54" style="word-spacing:0.4543em;">BGSAVE to</span><span class="stl_58 stl_59 stl_54" style="word-spacing:0.7073em;">&nbsp;s</span><span class="stl_58 stl_59 stl_54" style="word-spacing:-0.0127em;">&nbsp;t</span><span class="stl_58 stl_59 stl_54" style="word-spacing:-0.0117em;">&nbsp;a</span><span class="stl_58 stl_59 stl_54" style="word-spacing:-0.0117em;">&nbsp;r</span><span class="stl_58 stl_59 stl_54" style="word-spacing:-0.0117em;">&nbsp;t</span><span class="stl_58 stl_59 stl_54" style="word-spacing:0.6473em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:10.0375em;z-index:372; "><span class="stl_15 stl_16 stl_891" style="word-spacing:0.048em;">i f</span><span class="stl_15 stl_16 stl_891" style="word-spacing:0.7544em;">&nbsp;</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.7544em;">(</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.099em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.0276em;">&nbsp;</span><span class="stl_107 stl_108 stl_891" style="word-spacing:0.099em;">−</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.0276em;">&gt;r</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.0334em;">&nbsp;e p l s t a t e</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.515em;">&nbsp;==</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.263em;">&nbsp;REDIS_REPL_WAIT_BGSAVE_START) &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6168em; left:12.0958em;"><span class="stl_15 stl_16 stl_1166" style="word-spacing:-0.1436em;">continue </span><span class="stl_10 stl_11 stl_1166" style="word-spacing:-0.1436em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:10.4132em;"><span class="stl_58 stl_59 stl_541" style="word-spacing:0.2888em;">* Feed</span><span class="stl_58 stl_59 stl_541" style="word-spacing:0.3868em;">&nbsp;s</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2772em;">&nbsp;l</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2772em;">&nbsp;a</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2762em;">&nbsp;v</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2772em;">&nbsp;e</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2762em;">&nbsp;s</span><span class="stl_58 stl_59 stl_541" style="word-spacing:0.4658em;">&nbsp;that</span><span class="stl_58 stl_59 stl_541" style="word-spacing:0.4208em;">&nbsp;are waiting for the</span><span class="stl_58 stl_59 stl_541" style="word-spacing:0.4938em;">&nbsp;i</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2312em;">&nbsp;n</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2312em;">&nbsp;i</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2312em;">&nbsp;t</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2302em;">&nbsp;i</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2312em;">&nbsp;a</span><span class="stl_58 stl_59 stl_541" style="word-spacing:-0.2312em;">&nbsp;l</span><span class="stl_58 stl_59 stl_541" style="word-spacing:0.2968em;">&nbsp;SYNC &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:11.63em;"><span class="stl_58 stl_59 stl_07">(</span></div>
					<div class="stl_01" style="top: 34.6126em; left:12.1265em;"><span class="stl_58 stl_59 stl_1100" style="word-spacing:0.4477em;">so these</span><span class="stl_58 stl_59 stl_1100" style="word-spacing:0.3777em;">&nbsp;commands &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 37.601em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 35.6085em; left:11.4695em;"><span class="stl_58 stl_59 stl_725" style="word-spacing:0.3276em;">are queued in</span><span class="stl_58 stl_59 stl_725" style="word-spacing:0.3696em;">&nbsp;the output</span><span class="stl_58 stl_59 stl_725" style="word-spacing:0.4086em;">&nbsp;b</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3114em;">&nbsp;u</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3114em;">&nbsp;f</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3104em;">&nbsp;f</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3114em;">&nbsp;e</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3114em;">&nbsp;r</span><span class="stl_58 stl_59 stl_725" style="word-spacing:0.4566em;">&nbsp;u</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3024em;">&nbsp;n</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3014em;">&nbsp;t</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3014em;">&nbsp;i</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3024em;">&nbsp;l</span><span class="stl_58 stl_59 stl_725" style="word-spacing:0.4396em;">&nbsp;the i</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.2664em;">&nbsp;n</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.2674em;">&nbsp;i</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.2674em;">&nbsp;t</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.2674em;">&nbsp;i</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.2664em;">&nbsp;a</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.2664em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:11.9892em;"><span class="stl_58 stl_59 stl_228" style="word-spacing:0.2615em;">SYNC completes</span><span class="stl_58 stl_59 stl_228" style="word-spacing:-0.1695em;">&nbsp;)</span><span class="stl_58 stl_59 stl_228" style="word-spacing:-0.1695em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:11.4587em;"><span class="stl_58 stl_59 stl_1167" style="word-spacing:0.3244em;">or are</span><span class="stl_58 stl_59 stl_1167" style="word-spacing:0.3694em;">&nbsp;already in</span><span class="stl_58 stl_59 stl_1167" style="word-spacing:0.3439em;">&nbsp;sync with</span><span class="stl_58 stl_59 stl_1167" style="word-spacing:0.3624em;">&nbsp;the master</span><span class="stl_58 stl_59 stl_1167" style="word-spacing:-0.2276em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1167" style="word-spacing:0.3384em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5901em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">向</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;长</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;度 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:10.4132em;"><span class="stl_58 stl_59 stl_369" style="word-spacing:0.1868em;">* Add</span><span class="stl_58 stl_59 stl_369" style="word-spacing:0.2518em;">&nbsp;the</span><span class="stl_58 stl_59 stl_369" style="word-spacing:0.3838em;">&nbsp;multi bulk length</span><span class="stl_58 stl_59 stl_369" style="word-spacing:-0.1892em;">&nbsp;.</span><span class="stl_58 stl_59 stl_369" style="word-spacing:0.3248em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:9.9592em;"><span class="stl_10 stl_11 stl_1168" style="word-spacing:-0.1711em;">addReplyMultiBulkLen ( slave , argc ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">向</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;送</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:10.4132em;"><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3512em;">* Finally any a</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.3038em;">&nbsp;d</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.3038em;">&nbsp;d</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.3048em;">&nbsp;i</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.3038em;">&nbsp;t</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.3038em;">&nbsp;i</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.3038em;">&nbsp;o</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.3038em;">&nbsp;n</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.3038em;">&nbsp;a</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.3048em;">&nbsp;l</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3687em;">&nbsp;argument that</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3402em;">&nbsp;was</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.2962em;">&nbsp;not &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:11.6642em;"><span class="stl_58 stl_59 stl_1169" style="word-spacing:-0.01em;">stored i nside</span><span class="stl_58 stl_59 stl_1169" style="word-spacing:0.3465em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 46.5676em; left:11.5326em;"><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.238em;">s t</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.239em;">&nbsp;a</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.238em;">&nbsp;t</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.239em;">&nbsp;i</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.239em;">&nbsp;c</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.52em;">&nbsp;b</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.259em;">&nbsp;u</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.259em;">&nbsp;f</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.259em;">&nbsp;f</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.258em;">&nbsp;e</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.259em;">&nbsp;r</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.536em;">&nbsp;i</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.221em;">&nbsp;f</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.438em;">&nbsp;any</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.339em;">&nbsp;(</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.254em;">&nbsp;from</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.398em;">&nbsp;j</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.4295em;">&nbsp;to argc</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.212em;">&nbsp;)</span><span class="stl_58 stl_59 stl_259" style="word-spacing:-0.175em;">&nbsp;.</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.388em;">&nbsp;*/ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.2. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">主从数据同步机制概述 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">133 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:9.9733em;"><span class="stl_15 stl_16 stl_1096">for</span><span class="stl_15 stl_16 stl_1096" style="word-spacing:0.3966em;">&nbsp;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.3966em;">(</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:-0.1573em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2457em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.4787em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2187em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2447em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:-0.1353em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.4987em;">&nbsp;j++) &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:11.9458em;"><span class="stl_10 stl_11 stl_1170" style="word-spacing:-0.153em;">addReplyBulk ( slave , argv [ j ] ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7076em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 32.1224em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 32.1224em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">4.2 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">主从数据同步机制概述 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.6101em; left:7.5658em;"><span class="stl_10 stl_11 stl_1171" style="word-spacing:0.1151em;">redis </span><span class="stl_17 stl_18 stl_1171" style="word-spacing:0.1151em;">主从同步有两种方式（或者所两个阶段）：全同步和部分同步。 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.6423em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">主从刚刚连接的时候，进行全同步；全同步结束后，进行部分同步。当然，如果 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;z-index:172; "><span class="stl_17 stl_18 stl_1172" style="word-spacing:0.0875em;">有需要，</span><span class="stl_10 stl_11 stl_1172" style="word-spacing:0.0875em;">slave </span><span class="stl_17 stl_18 stl_1172" style="word-spacing:0.0875em;">在任何时候都可以发起全同步。</span><span class="stl_10 stl_11 stl_1172" style="word-spacing:0.0875em;">redis </span><span class="stl_17 stl_18 stl_1172" style="word-spacing:0.0875em;">策略是，无论如何，首先会尝试进 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_17 stl_18 stl_33" style="word-spacing:0.096em;">行部分同步，如不成功，要求从机进行全同步，并启动 </span><span class="stl_10 stl_11 stl_33" style="word-spacing:0.096em;">BGSAVE</span><span class="stl_17 stl_18 stl_33" style="word-spacing:0.096em;">……</span><span class="stl_10 stl_11 stl_33" style="word-spacing:0.096em;">BGSAVE </span><span class="stl_17 stl_18 stl_33" style="word-spacing:0.096em;">结束 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;"><span class="stl_17 stl_18 stl_1030" style="word-spacing:0.0854em;">后，传输 </span><span class="stl_10 stl_11 stl_1030" style="word-spacing:0.0854em;">RDB </span><span class="stl_17 stl_18 stl_1030" style="word-spacing:0.0854em;">文件；如果成功，允许从机进行部分同步，并传输积压空间中的数据。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_33.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_33.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">134 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.731em; left:7.5658em;"><span class="stl_17 stl_18 stl_1173" style="word-spacing:0.087em;">如需设置 </span><span class="stl_10 stl_11 stl_1173" style="word-spacing:0.087em;">slave</span><span class="stl_17 stl_18 stl_1173" style="word-spacing:0.087em;">，</span><span class="stl_10 stl_11 stl_1173" style="word-spacing:0.087em;">master </span><span class="stl_17 stl_18 stl_1173" style="word-spacing:0.087em;">需要向 </span><span class="stl_10 stl_11 stl_1173" style="word-spacing:0.087em;">slave </span><span class="stl_17 stl_18 stl_1173" style="word-spacing:0.087em;">发送 </span><span class="stl_10 stl_11 stl_1173" style="word-spacing:0.087em;">SLAVEOF hostname port</span><span class="stl_17 stl_18 stl_1173" style="word-spacing:0.087em;">，从机接收 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.7276em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">到后会自动连接主机，注册相应读写事件（</span><span class="stl_10 stl_11 stl_07">syncWithMaster())</span><span class="stl_17 stl_18 stl_07">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.4326em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">修</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;改</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:5.9483em;"><span class="stl_15 stl_16 stl_262">void</span><span class="stl_15 stl_16 stl_262" style="word-spacing:0.336em;">&nbsp;</span><span class="stl_10 stl_11 stl_262" style="word-spacing:0.336em;">slaveofCommand</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2111em;">&nbsp;(</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.1181em;">&nbsp;r</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2251em;">&nbsp;e</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2241em;">&nbsp;d</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2241em;">&nbsp;i</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2241em;">&nbsp;s</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2251em;">&nbsp;C</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2241em;">&nbsp;l</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2241em;">&nbsp;i</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2241em;">&nbsp;e</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2251em;">&nbsp;n</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.2241em;">&nbsp;t</span><span class="stl_10 stl_11 stl_262" style="word-spacing:0.4259em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.1971em;">&nbsp;)</span><span class="stl_10 stl_11 stl_262" style="word-spacing:-0.1971em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4185em; left:8.045em;z-index:171; "><span class="stl_15 stl_16 stl_1174" style="word-spacing:-0.225em;">i f</span><span class="stl_15 stl_16 stl_1174" style="word-spacing:0.5536em;">&nbsp;</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:0.5536em;">(</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.224em;">&nbsp;!</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.113em;">&nbsp;strcasecmp</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.186em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.186em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1174" style="word-spacing:-0.186em;">−</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.243em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_1174" style="word-spacing:-0.243em;">−</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.243em;">&gt;ptr</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.054em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.176em;">&nbsp;”no”</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.232em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:0.186em;">&nbsp;&amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:10.0242em;"><span class="stl_10 stl_11 stl_07">!</span></div>
					<div class="stl_01" style="top: 44.4202em; left:10.48em;z-index:206; "><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2063em;">strcasecmp (</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2063em;">&nbsp;c</span><span class="stl_107 stl_108 stl_578" style="word-spacing:-0.2063em;">−</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2633em;">&gt;argv[2]</span><span class="stl_107 stl_108 stl_578" style="word-spacing:-0.2633em;">−</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2633em;">&gt;ptr</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.0743em;">&nbsp;,</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.1963em;">&nbsp;”one”</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2523em;">&nbsp;)</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2103em;">&nbsp;)</span><span class="stl_10 stl_11 stl_578" style="word-spacing:-0.2103em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:10.4132em;z-index:236; "><span class="stl_58 stl_59 stl_634" style="word-spacing:0.4527em;">/ s</span><span class="stl_58 stl_59 stl_634" style="word-spacing:-0.2063em;">&nbsp;l</span><span class="stl_58 stl_59 stl_634" style="word-spacing:-0.2073em;">&nbsp;a</span><span class="stl_58 stl_59 stl_634" style="word-spacing:-0.2063em;">&nbsp;v</span><span class="stl_58 stl_59 stl_634" style="word-spacing:-0.2063em;">&nbsp;e</span><span class="stl_58 stl_59 stl_634" style="word-spacing:-0.2063em;">&nbsp;o</span><span class="stl_58 stl_59 stl_634" style="word-spacing:-0.2073em;">&nbsp;f</span><span class="stl_58 stl_59 stl_634" style="word-spacing:0.4357em;">&nbsp;no</span><span class="stl_58 stl_59 stl_634" style="word-spacing:0.3417em;">&nbsp;one</span><span class="stl_58 stl_59 stl_634" style="word-spacing:0.3998em;">&nbsp;</span><span class="stl_17 stl_18 stl_634" style="word-spacing:0.3998em;">断</span><span class="stl_17 stl_18 stl_634" style="word-spacing:-0.1673em;">&nbsp;开</span><span class="stl_17 stl_18 stl_634" style="word-spacing:-0.1673em;">&nbsp;主</span><span class="stl_17 stl_18 stl_634" style="word-spacing:-0.1673em;">&nbsp;机</span><span class="stl_17 stl_18 stl_634" style="word-spacing:-0.1673em;">&nbsp;连</span><span class="stl_17 stl_18 stl_634" style="word-spacing:-0.1673em;">&nbsp;接 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4077em; left:10.0375em;"><span class="stl_15 stl_16 stl_782" style="word-spacing:-0.3179em;">i f</span><span class="stl_15 stl_16 stl_782" style="word-spacing:0.3885em;">&nbsp;</span><span class="stl_10 stl_11 stl_782" style="word-spacing:0.3885em;">(</span><span class="stl_10 stl_11 stl_782" style="word-spacing:-0.2449em;">&nbsp;server</span><span class="stl_10 stl_11 stl_782" style="word-spacing:-0.1889em;">&nbsp;.</span><span class="stl_10 stl_11 stl_782" style="word-spacing:-0.2229em;">&nbsp;masterhost</span><span class="stl_10 stl_11 stl_782" style="word-spacing:-0.2779em;">&nbsp;)</span><span class="stl_10 stl_11 stl_782" style="word-spacing:-0.2779em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:11.9917em;"><span class="stl_10 stl_11 stl_723" style="word-spacing:-0.2261em;">replicationUnsetMaster () ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.2. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">主从数据同步机制概述 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">135 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:11.9858em;"><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0703em;">redisLog (REDIS_NOTICE, ”MASTER␣MODE␣ enabled ␣ ( user ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:13.6525em;"><span class="stl_10 stl_11 stl_1176" style="word-spacing:-0.3028em;">request ) ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7027em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.6993em; left:9.9392em;"><span class="stl_15 stl_16 stl_257">long</span><span class="stl_15 stl_16 stl_257" style="word-spacing:0.3506em;">&nbsp;</span><span class="stl_10 stl_11 stl_257" style="word-spacing:0.3506em;">port</span><span class="stl_10 stl_11 stl_257" style="word-spacing:0.3506em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:10.0375em;z-index:127; "><span class="stl_15 stl_16 stl_911" style="word-spacing:-0.2086em;">i f</span><span class="stl_15 stl_16 stl_911" style="word-spacing:0.5329em;">&nbsp;</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.5329em;">((</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.1686em;">&nbsp;getLongFromObjectOrReply</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.2036em;">&nbsp;(</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.2276em;">&nbsp;c</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.1196em;">&nbsp;,</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.1196em;">&nbsp;c</span><span class="stl_107 stl_108 stl_911" style="word-spacing:-0.1196em;">−</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.4284em;">&gt;argv</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.1106em;">&nbsp;[</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.2066em;">&nbsp;2</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.2076em;">&nbsp;]</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.0286em;">&nbsp;,</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.3034em;">&nbsp;&amp;port</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.3034em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:11.4933em;"><span class="stl_10 stl_11 stl_1177" style="word-spacing:0.5888em;">NULL) !=</span><span class="stl_10 stl_11 stl_1177" style="word-spacing:0.4168em;">&nbsp;REDIS_OK)</span><span class="stl_10 stl_11 stl_1177" style="word-spacing:0.4168em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:11.9308em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">可</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;能</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;已</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;经</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;连</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;需</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;要</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;连</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:10.4132em;"><span class="stl_58 stl_59 stl_785" style="word-spacing:0.2531em;">* Check</span><span class="stl_58 stl_59 stl_785" style="word-spacing:0.3881em;">&nbsp;i</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.2759em;">&nbsp;f</span><span class="stl_58 stl_59 stl_785" style="word-spacing:0.3481em;">&nbsp;we</span><span class="stl_58 stl_59 stl_785" style="word-spacing:0.2551em;">&nbsp;are</span><span class="stl_58 stl_59 stl_785" style="word-spacing:0.3746em;">&nbsp;already attached to the</span><span class="stl_58 stl_59 stl_785" style="word-spacing:0.4191em;">&nbsp;s</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.3049em;">&nbsp;p</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.3049em;">&nbsp;e</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.3049em;">&nbsp;c</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.3059em;">&nbsp;i</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.3049em;">&nbsp;f</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.3049em;">&nbsp;i</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.3049em;">&nbsp;e</span><span class="stl_58 stl_59 stl_785" style="word-spacing:-0.3049em;">&nbsp;d &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:11.6758em;"><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.217em;">s l</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.218em;">&nbsp;a</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.217em;">&nbsp;v</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.217em;">&nbsp;e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.442em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.666em; left:10.0375em;"><span class="stl_15 stl_16 stl_1178" style="word-spacing:-0.3014em;">i f</span><span class="stl_15 stl_16 stl_1178" style="word-spacing:0.4049em;">&nbsp;</span><span class="stl_10 stl_11 stl_1178" style="word-spacing:0.4049em;">(</span><span class="stl_10 stl_11 stl_1178" style="word-spacing:-0.2284em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1178" style="word-spacing:-0.1724em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1178" style="word-spacing:-0.2064em;">&nbsp;masterhost</span><span class="stl_10 stl_11 stl_1178" style="word-spacing:0.1146em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_1178" style="word-spacing:-0.0429em;">&nbsp;! strcasecmp</span><span class="stl_10 stl_11 stl_1178" style="word-spacing:-0.2614em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1178" style="word-spacing:-0.2284em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1178" style="word-spacing:-0.2284em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:11.635em;z-index:294; "><span class="stl_10 stl_11 stl_1051" style="word-spacing:-0.1652em;">masterhost , c</span><span class="stl_107 stl_108 stl_1051" style="word-spacing:-0.1652em;">−</span><span class="stl_10 stl_11 stl_1051" style="word-spacing:-0.1652em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_1051" style="word-spacing:-0.1652em;">−</span><span class="stl_10 stl_11 stl_1051" style="word-spacing:-0.1652em;">&gt; ptr ) &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:11.785em;"><span class="stl_10 stl_11 stl_07">&amp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:12.3321em;z-index:318; "><span class="stl_10 stl_11 stl_685" style="word-spacing:0.1596em;">&amp; server</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.1594em;">&nbsp;.</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.1934em;">&nbsp;masterport</span><span class="stl_10 stl_11 stl_685" style="word-spacing:0.1276em;">&nbsp;== port</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.2464em;">&nbsp;)</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.2464em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:11.9858em;"><span class="stl_10 stl_11 stl_1179" style="word-spacing:-0.113em;">redisLog (REDIS_NOTICE, ”SLAVE␣OF␣would␣ r e s u l t ␣ into &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:14.1521em;"><span class="stl_10 stl_11 stl_606" style="word-spacing:-0.3123em;">synchronization ␣with␣ the ␣master␣we␣ are ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:13.6475em;"><span class="stl_10 stl_11 stl_943" style="word-spacing:-0.2749em;">already ␣ connected ␣with . ␣No␣ operation ␣performed &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:13.585em;"><span class="stl_10 stl_11 stl_07">␣</span></div>
					<div class="stl_01" style="top: 24.6485em; left:13.6775em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 24.6485em; left:14.0943em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.032em;">” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:11.9483em;"><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.2105em;">addReplySds ( c , sdsnew ( ”+OK␣Already␣ connected ␣ to ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:13.685em;"><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2703em;">s p e c i f i e d ␣master\ r \n” ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:11.9308em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 30.6276em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.6276em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">断 开</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;之</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;前</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;连</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;连</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;接，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;连</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:11.6683em;"><span class="stl_58 stl_59 stl_1181" style="word-spacing:-0.2623em;">replicationSetMaster ()</span><span class="stl_58 stl_59 stl_1181" style="word-spacing:-0.0358em;">&nbsp;</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.0358em;">并 不</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.3313em;">&nbsp;会</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.3313em;">&nbsp;真</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.3313em;">&nbsp;正</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.3313em;">&nbsp;连</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.3313em;">&nbsp;接</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.3313em;">&nbsp;主</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.2983em;">&nbsp;机，</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.2983em;">&nbsp;只</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.3313em;">&nbsp;是</span><span class="stl_17 stl_18 stl_1181" style="word-spacing:-0.3313em;">&nbsp;修 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:11.6342em;"><span class="stl_17 stl_18 stl_1182">改</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.0328em;">&nbsp;</span><span class="stl_58 stl_59 stl_1182" style="word-spacing:-0.0328em;">s t</span><span class="stl_58 stl_59 stl_1182" style="word-spacing:-0.3663em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1182" style="word-spacing:-0.3653em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1182" style="word-spacing:-0.3663em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1182" style="word-spacing:-0.3663em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1182" style="word-spacing:0.3727em;">&nbsp;server</span><span class="stl_58 stl_59 stl_1182" style="word-spacing:-0.0108em;">&nbsp;</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.0108em;">中 关</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;于</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;主</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;设</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.2903em;">&nbsp;置。</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.2903em;">&nbsp;真</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;正</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;主</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;连</span><span class="stl_17 stl_18 stl_1182" style="word-spacing:-0.3243em;">&nbsp;接 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:11.6342em;"><span class="stl_17 stl_18 stl_1087">在</span><span class="stl_17 stl_18 stl_1087" style="word-spacing:0.3161em;">&nbsp;</span><span class="stl_58 stl_59 stl_1087" style="word-spacing:0.3161em;">replicationCron</span><span class="stl_58 stl_59 stl_1087" style="word-spacing:-0.2557em;">&nbsp;()</span><span class="stl_58 stl_59 stl_1087" style="word-spacing:-0.0086em;">&nbsp;</span><span class="stl_17 stl_18 stl_1087" style="word-spacing:-0.0086em;">中 完</span><span class="stl_17 stl_18 stl_1087" style="word-spacing:-0.0086em;">&nbsp;成 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:10.4132em;"><span class="stl_58 stl_59 stl_726" style="word-spacing:0.2784em;">* There was</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.2459em;">&nbsp;no</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.3239em;">&nbsp;previous</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.3739em;">&nbsp;master</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.3474em;">&nbsp;or the</span><span class="stl_58 stl_59 stl_726" style="word-spacing:0.4099em;">&nbsp;user s</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.2831em;">&nbsp;p</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.2831em;">&nbsp;e</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.2831em;">&nbsp;c</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.2841em;">&nbsp;i</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.2831em;">&nbsp;f</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.2831em;">&nbsp;i</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.2831em;">&nbsp;e</span><span class="stl_58 stl_59 stl_726" style="word-spacing:-0.2831em;">&nbsp;d &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:12.0858em;"><span class="stl_58 stl_59 stl_179" style="word-spacing:0.461em;">a d</span><span class="stl_58 stl_59 stl_179" style="word-spacing:-0.184em;">&nbsp;i</span><span class="stl_58 stl_59 stl_179" style="word-spacing:-0.184em;">&nbsp;f</span><span class="stl_58 stl_59 stl_179" style="word-spacing:-0.184em;">&nbsp;f</span><span class="stl_58 stl_59 stl_179" style="word-spacing:-0.184em;">&nbsp;e</span><span class="stl_58 stl_59 stl_179" style="word-spacing:-0.183em;">&nbsp;r</span><span class="stl_58 stl_59 stl_179" style="word-spacing:-0.184em;">&nbsp;e</span><span class="stl_58 stl_59 stl_179" style="word-spacing:-0.184em;">&nbsp;n</span><span class="stl_58 stl_59 stl_179" style="word-spacing:-0.184em;">&nbsp;t</span><span class="stl_58 stl_59 stl_179" style="word-spacing:0.47em;">&nbsp;one</span><span class="stl_58 stl_59 stl_179" style="word-spacing:0.47em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 36.6051em; left:11.4055em;"><span class="stl_58 stl_59 stl_700" style="word-spacing:0.2511em;">we can</span><span class="stl_58 stl_59 stl_700" style="word-spacing:0.3451em;">&nbsp;continue</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.1759em;">&nbsp;.</span><span class="stl_58 stl_59 stl_700" style="word-spacing:0.3651em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:10.0075em;z-index:755; "><span class="stl_10 stl_11 stl_1123" style="word-spacing:-0.2213em;">replicationSetMaster (</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:-0.2213em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1123" style="word-spacing:-0.2213em;">−</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:-0.3093em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_1123" style="word-spacing:-0.3093em;">−</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:-0.3093em;">&gt;ptr</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:-0.1203em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:0.4057em;">&nbsp;port</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:-0.2493em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:-0.2493em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:9.9933em;"><span class="stl_10 stl_11 stl_1183" style="word-spacing:-0.1201em;">redisLog (REDIS_NOTICE, ”SLAVE␣OF␣%s:%d␣ enabled ␣ ( user ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:11.66em;"><span class="stl_10 stl_11 stl_1176" style="word-spacing:-0.285em;">request ) ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:12.0025em;"><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.1831em;">server .</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.2261em;">&nbsp;masterhost</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.1251em;">&nbsp;,</span><span class="stl_10 stl_11 stl_110" style="word-spacing:0.4169em;">&nbsp;server</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.1831em;">&nbsp;.</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.2171em;">&nbsp;masterport</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.2721em;">&nbsp;)</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.2721em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 42.581em; left:7.9575em;"><span class="stl_10 stl_11 stl_173" style="word-spacing:-0.1964em;">addReply ( c , shared . ok ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 45.5718em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.5676em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5718em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">设</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;新</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:6.4282em;"><span class="stl_58 stl_59 stl_568" style="word-spacing:0.3046em;">* Set</span><span class="stl_58 stl_59 stl_568" style="word-spacing:0.4096em;">&nbsp;r</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.3014em;">&nbsp;e</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.3024em;">&nbsp;p</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.3014em;">&nbsp;l</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.3024em;">&nbsp;i</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.3024em;">&nbsp;c</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.3014em;">&nbsp;a</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.3024em;">&nbsp;t</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.3014em;">&nbsp;i</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.3024em;">&nbsp;o</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.3014em;">&nbsp;n</span><span class="stl_58 stl_59 stl_568" style="word-spacing:0.4066em;">&nbsp;to the s</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.2984em;">&nbsp;p</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.2984em;">&nbsp;e</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.2994em;">&nbsp;c</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.2984em;">&nbsp;i</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.2984em;">&nbsp;f</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.2984em;">&nbsp;i</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.2984em;">&nbsp;e</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.2994em;">&nbsp;d</span><span class="stl_58 stl_59 stl_568" style="word-spacing:0.3946em;">&nbsp;master</span><span class="stl_58 stl_59 stl_568" style="word-spacing:0.3476em;">&nbsp;address</span><span class="stl_58 stl_59 stl_568" style="word-spacing:0.3116em;">&nbsp;and port</span><span class="stl_58 stl_59 stl_568" style="word-spacing:0.3116em;">&nbsp;. &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">136 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.615em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.0882em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7102em; left:5.9483em;"><span class="stl_15 stl_16 stl_407">void</span><span class="stl_15 stl_16 stl_407" style="word-spacing:0.3083em;">&nbsp;</span><span class="stl_10 stl_11 stl_407" style="word-spacing:0.3083em;">replicationSetMaster</span><span class="stl_10 stl_11 stl_407" style="word-spacing:0.3083em;">&nbsp;(</span><span class="stl_15 stl_16 stl_407" style="word-spacing:-0.2392em;">char</span><span class="stl_15 stl_16 stl_407" style="word-spacing:0.209em;">&nbsp;</span><span class="stl_10 stl_11 stl_407" style="word-spacing:0.209em;">*ip</span><span class="stl_10 stl_11 stl_407" style="word-spacing:-0.1412em;">&nbsp;,</span><span class="stl_10 stl_11 stl_407" style="word-spacing:0.3751em;">&nbsp;</span><span class="stl_15 stl_16 stl_407" style="word-spacing:0.3751em;">int</span><span class="stl_15 stl_16 stl_407" style="word-spacing:0.3258em;">&nbsp;</span><span class="stl_10 stl_11 stl_407" style="word-spacing:0.3258em;">port</span><span class="stl_10 stl_11 stl_407" style="word-spacing:-0.2672em;">&nbsp;)</span><span class="stl_10 stl_11 stl_407" style="word-spacing:-0.2672em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:8.03em;"><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.2837em;">s d s f r e e ( server . masterhost ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:8.0175em;"><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.1699em;">server .</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.2039em;">&nbsp;masterhost</span><span class="stl_10 stl_11 stl_230" style="word-spacing:0.1461em;">&nbsp;=</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.1658em;">&nbsp;sdsdup (</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.2469em;">&nbsp;ip</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.2479em;">&nbsp;)</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.2479em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:8.0175em;"><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.1858em;">server .</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2198em;">&nbsp;masterport</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:0.1312em;">&nbsp;= port</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:0.1312em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">断</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;开</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;之</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;前</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;连</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;接 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:8.045em;"><span class="stl_15 stl_16 stl_698" style="word-spacing:-0.3103em;">i f</span><span class="stl_15 stl_16 stl_698" style="word-spacing:0.3961em;">&nbsp;</span><span class="stl_10 stl_11 stl_698" style="word-spacing:0.3961em;">(</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.2373em;">&nbsp;server</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.1813em;">&nbsp;.</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.2323em;">&nbsp;master</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.2883em;">&nbsp;)</span><span class="stl_10 stl_11 stl_698" style="word-spacing:0.3777em;">&nbsp;f</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.3273em;">&nbsp;r</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.3273em;">&nbsp;e</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.3283em;">&nbsp;e</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.3273em;">&nbsp;C</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.3273em;">&nbsp;l</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.3273em;">&nbsp;i</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.3273em;">&nbsp;e</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.3273em;">&nbsp;n</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.3283em;">&nbsp;t</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.2213em;">&nbsp;(</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.2373em;">&nbsp;server</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.1823em;">&nbsp;.</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.2323em;">&nbsp;master</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.2883em;">&nbsp;)</span><span class="stl_10 stl_11 stl_698" style="word-spacing:-0.2883em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:8.0125em;"><span class="stl_10 stl_11 stl_1066" style="word-spacing:-0.2074em;">disconnectSlaves ()</span><span class="stl_10 stl_11 stl_1066" style="word-spacing:-0.1834em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1066" style="word-spacing:0.3347em;">&nbsp;</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.3347em;">/*</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.2681em;">&nbsp;Force our</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.3536em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3294em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3284em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3294em;">&nbsp;v</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3284em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3294em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.3896em;">&nbsp;to</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.3476em;">&nbsp;resync with</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.3166em;">&nbsp;us &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:10.1342em;"><span class="stl_58 stl_59 stl_280" style="word-spacing:0.444em;">as w</span><span class="stl_58 stl_59 stl_280" style="word-spacing:-0.249em;">&nbsp;e</span><span class="stl_58 stl_59 stl_280" style="word-spacing:-0.249em;">&nbsp;l</span><span class="stl_58 stl_59 stl_280" style="word-spacing:-0.25em;">&nbsp;l</span><span class="stl_58 stl_59 stl_280" style="word-spacing:-0.102em;">&nbsp;.</span><span class="stl_58 stl_59 stl_280" style="word-spacing:0.404em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;消</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:8em;"><span class="stl_10 stl_11 stl_897" style="word-spacing:-0.1759em;">replicationDiscardCachedMaster ()</span><span class="stl_10 stl_11 stl_897" style="word-spacing:-0.1379em;">&nbsp;;</span><span class="stl_10 stl_11 stl_897" style="word-spacing:0.3803em;">&nbsp;</span><span class="stl_58 stl_59 stl_897" style="word-spacing:0.3803em;">/*</span><span class="stl_58 stl_59 stl_897" style="word-spacing:-0.0408em;">&nbsp;Don ’</span><span class="stl_58 stl_59 stl_897" style="word-spacing:-0.2079em;">&nbsp;t</span><span class="stl_58 stl_59 stl_897" style="word-spacing:0.4341em;">&nbsp;try</span><span class="stl_58 stl_59 stl_897" style="word-spacing:0.3451em;">&nbsp;a</span><span class="stl_58 stl_59 stl_897" style="word-spacing:0.1301em;">&nbsp;PSYNC. &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.6075em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 18.6726em; left:10.0807em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">释</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;放</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;积</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;压</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:8.0133em;"><span class="stl_10 stl_11 stl_791" style="word-spacing:-0.2122em;">freeReplicationBacklog ()</span><span class="stl_10 stl_11 stl_791" style="word-spacing:-0.1892em;">&nbsp;;</span><span class="stl_10 stl_11 stl_791" style="word-spacing:0.3292em;">&nbsp;</span><span class="stl_58 stl_59 stl_791" style="word-spacing:0.3292em;">/*</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.1435em;">&nbsp;Don ’</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.2592em;">&nbsp;t</span><span class="stl_58 stl_59 stl_791" style="word-spacing:0.3768em;">&nbsp;allow</span><span class="stl_58 stl_59 stl_791" style="word-spacing:0.3133em;">&nbsp;our</span><span class="stl_58 stl_59 stl_791" style="word-spacing:0.3133em;">&nbsp;chained &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:9.6883em;"><span class="stl_58 stl_59 stl_949" style="word-spacing:-0.0814em;">s l</span><span class="stl_58 stl_59 stl_949" style="word-spacing:-0.0814em;">&nbsp;a</span><span class="stl_58 stl_59 stl_949" style="word-spacing:-0.0804em;">&nbsp;v</span><span class="stl_58 stl_59 stl_949" style="word-spacing:-0.0814em;">&nbsp;e</span><span class="stl_58 stl_59 stl_949" style="word-spacing:-0.0804em;">&nbsp;s</span><span class="stl_58 stl_59 stl_949" style="word-spacing:0.6376em;">&nbsp;to</span><span class="stl_58 stl_59 stl_949" style="word-spacing:0.4086em;">&nbsp;PSYNC.</span><span class="stl_58 stl_59 stl_949" style="word-spacing:0.5686em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_219" style="word-spacing:0.2875em;">/ cancelReplicationHandshake</span><span class="stl_58 stl_59 stl_219" style="word-spacing:-0.2435em;">&nbsp;()</span><span class="stl_58 stl_59 stl_219" style="word-spacing:0.3347em;">&nbsp;</span><span class="stl_17 stl_18 stl_219" style="word-spacing:0.3347em;">尝</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2935em;">&nbsp;试</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2925em;">&nbsp;断</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2925em;">&nbsp;开</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2925em;">&nbsp;数</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2925em;">&nbsp;据</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2925em;">&nbsp;传</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2925em;">&nbsp;输</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2925em;">&nbsp;和</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2925em;">&nbsp;主</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2925em;">&nbsp;机</span><span class="stl_17 stl_18 stl_219" style="word-spacing:-0.2925em;">&nbsp;连 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.8665em; left:9.6417em;"><span class="stl_17 stl_18 stl_07">接</span></div>
					<div class="stl_01" style="top: 26.641em; left:7.9958em;"><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.2076em;">cancelReplicationHandshake () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:8.0175em;"><span class="stl_10 stl_11 stl_1184" style="word-spacing:0.0226em;">server .</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:0.0116em;">&nbsp;repl_state</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:0.3616em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:0.1416em;">&nbsp;REDIS_REPL_CONNECT; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:8.0175em;"><span class="stl_10 stl_11 stl_1185" style="word-spacing:-0.2016em;">server .</span><span class="stl_10 stl_11 stl_1185" style="word-spacing:-0.2226em;">&nbsp;master_repl_offset</span><span class="stl_10 stl_11 stl_1185" style="word-spacing:0.1274em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1185" style="word-spacing:0.1454em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 31.6235em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:6.4282em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">管 理</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;连</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;定</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;程</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;序</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;定</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;程</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;序，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;每</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;秒</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;执</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;次 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:6.4282em;"><span class="stl_58 stl_59 stl_685">/</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.2954em;">&nbsp;</span><span class="stl_17 stl_18 stl_685" style="word-spacing:0.2954em;">在</span><span class="stl_17 stl_18 stl_685" style="word-spacing:0.3403em;">&nbsp;</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.3403em;">serverCorn</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2314em;">&nbsp;()</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.3634em;">&nbsp;</span><span class="stl_17 stl_18 stl_685" style="word-spacing:0.3634em;">中</span><span class="stl_17 stl_18 stl_685" style="word-spacing:-0.2654em;">&nbsp;调</span><span class="stl_17 stl_18 stl_685" style="word-spacing:-0.2654em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:6.4282em;z-index:592; "><span class="stl_58 stl_59 stl_1186" style="word-spacing:0.4865em;">* </span><span class="stl_107 stl_108 stl_1186" style="word-spacing:0.4865em;">−−−−−−−−−−−−−−−−−−−−−−−−−−− </span><span class="stl_58 stl_59 stl_1186" style="word-spacing:0.4865em;">REPLICATION CRON &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:7.4208em;z-index:636; "><span class="stl_107 stl_108 stl_1187" style="word-spacing:0.6529em;">−−−−−−−−−−−−−−−−−−−−−−−−−−−−− </span><span class="stl_58 stl_59 stl_1187" style="word-spacing:0.6529em;">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:6.4282em;"><span class="stl_58 stl_59 stl_443" style="word-spacing:0.333em;">* Replication cron funciton</span><span class="stl_58 stl_59 stl_443" style="word-spacing:-0.0876em;">&nbsp;,</span><span class="stl_58 stl_59 stl_443" style="word-spacing:0.4314em;">&nbsp;c</span><span class="stl_58 stl_59 stl_443" style="word-spacing:-0.3146em;">&nbsp;a</span><span class="stl_58 stl_59 stl_443" style="word-spacing:-0.3156em;">&nbsp;l</span><span class="stl_58 stl_59 stl_443" style="word-spacing:-0.3146em;">&nbsp;l</span><span class="stl_58 stl_59 stl_443" style="word-spacing:-0.3146em;">&nbsp;e</span><span class="stl_58 stl_59 stl_443" style="word-spacing:-0.3156em;">&nbsp;d</span><span class="stl_58 stl_59 stl_443" style="word-spacing:0.3304em;">&nbsp;1</span><span class="stl_58 stl_59 stl_443" style="word-spacing:0.2624em;">&nbsp;time</span><span class="stl_58 stl_59 stl_443" style="word-spacing:0.3204em;">&nbsp;per second</span><span class="stl_58 stl_59 stl_443" style="word-spacing:-0.2336em;">&nbsp;.</span><span class="stl_58 stl_59 stl_443" style="word-spacing:0.3274em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:5.9483em;"><span class="stl_15 stl_16 stl_230">void</span><span class="stl_15 stl_16 stl_230" style="word-spacing:0.3154em;">&nbsp;</span><span class="stl_10 stl_11 stl_230" style="word-spacing:0.3154em;">replicationCron</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.231em;">&nbsp;(</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.3178em;">&nbsp;</span><span class="stl_15 stl_16 stl_230" style="word-spacing:-0.3178em;">void</span><span class="stl_15 stl_16 stl_230" style="word-spacing:-0.3169em;">&nbsp;</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.3169em;">)</span><span class="stl_10 stl_11 stl_230" style="word-spacing:-0.3169em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 38.596em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:8.4207em;"><span class="stl_58 stl_59 stl_913">/</span><span class="stl_58 stl_59 stl_913" style="word-spacing:0.6202em;">&nbsp;</span><span class="stl_17 stl_18 stl_913" style="word-spacing:0.6202em;">如</span><span class="stl_17 stl_18 stl_913" style="word-spacing:0.0602em;">&nbsp;果 需 要 （</span><span class="stl_17 stl_18 stl_913" style="word-spacing:0.4772em;">&nbsp;</span><span class="stl_58 stl_59 stl_913" style="word-spacing:0.4772em;">REDIS_REPL_CONNECT</span><span class="stl_17 stl_18 stl_913" style="word-spacing:0.4772em;">），</span><span class="stl_17 stl_18 stl_913" style="word-spacing:0.0934em;">&nbsp;尝</span><span class="stl_17 stl_18 stl_913" style="word-spacing:0.0604em;">&nbsp;试 连 接 主</span><span class="stl_17 stl_18 stl_913" style="word-spacing:0.0939em;">&nbsp;机， 真</span><span class="stl_17 stl_18 stl_913" style="word-spacing:0.0604em;">&nbsp;正</span><span class="stl_17 stl_18 stl_913" style="word-spacing:0.0604em;">&nbsp;连 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.8107em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0501em;">接 主 机 的 操 作 在 这 里 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:8.4207em;"><span class="stl_58 stl_59 stl_1188" style="word-spacing:0.369em;">* Check</span><span class="stl_58 stl_59 stl_1188" style="word-spacing:0.505em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1188" style="word-spacing:-0.159em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1188" style="word-spacing:0.465em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1188" style="word-spacing:0.394em;">&nbsp;should</span><span class="stl_58 stl_59 stl_1188" style="word-spacing:0.4725em;">&nbsp;connect to</span><span class="stl_58 stl_59 stl_1188" style="word-spacing:0.409em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1188" style="word-spacing:0.193em;">&nbsp;MASTER</span><span class="stl_58 stl_59 stl_1188" style="word-spacing:0.193em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:8.045em;"><span class="stl_15 stl_16 stl_1189" style="word-spacing:-0.0948em;">i f</span><span class="stl_15 stl_16 stl_1189" style="word-spacing:0.6115em;">&nbsp;</span><span class="stl_10 stl_11 stl_1189" style="word-spacing:0.6115em;">(</span><span class="stl_10 stl_11 stl_1189" style="word-spacing:-0.0218em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1189" style="word-spacing:0.0342em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1189" style="word-spacing:0.0232em;">&nbsp;repl_state</span><span class="stl_10 stl_11 stl_1189" style="word-spacing:0.3442em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1189" style="word-spacing:0.1232em;">&nbsp;REDIS_REPL_CONNECT)</span><span class="stl_10 stl_11 stl_1189" style="word-spacing:0.1232em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:9.9933em;"><span class="stl_10 stl_11 stl_1179" style="word-spacing:-0.1016em;">redisLog (REDIS_NOTICE, ” Connecting␣ to ␣MASTER␣%s:%d” , &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:12.0025em;"><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.1831em;">server .</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.2261em;">&nbsp;masterhost</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.1251em;">&nbsp;,</span><span class="stl_10 stl_11 stl_110" style="word-spacing:0.4169em;">&nbsp;server</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.1831em;">&nbsp;.</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.2171em;">&nbsp;masterport</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.2721em;">&nbsp;)</span><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.2721em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5652em; left:10.0375em;"><span class="stl_15 stl_16 stl_1190" style="word-spacing:-0.1506em;">i f</span><span class="stl_15 stl_16 stl_1190" style="word-spacing:0.5558em;">&nbsp;</span><span class="stl_10 stl_11 stl_1190" style="word-spacing:0.5558em;">(</span><span class="stl_10 stl_11 stl_1190" style="word-spacing:-0.1336em;">&nbsp;connectWithMaster</span><span class="stl_10 stl_11 stl_1190" style="word-spacing:-0.0976em;">&nbsp;()</span><span class="stl_10 stl_11 stl_1190" style="word-spacing:0.2954em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1190" style="word-spacing:0.0864em;">&nbsp;REDIS_OK)</span><span class="stl_10 stl_11 stl_1190" style="word-spacing:0.0864em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:11.9858em;z-index:995; "><span class="stl_10 stl_11 stl_942" style="word-spacing:-0.0088em;">redisLog (REDIS_NOTICE, ”MASTER␣&lt;</span><span class="stl_107 stl_108 stl_942" style="word-spacing:-0.0088em;">−</span><span class="stl_10 stl_11 stl_942" style="word-spacing:-0.0088em;">&gt;␣SLAVE␣sync␣ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.3. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">全同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">137 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:13.6617em;"><span class="stl_10 stl_11 stl_1191" style="word-spacing:-0.3197em;">started ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7076em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7076em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 9.7043em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 12.6707em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 12.6707em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">4.3 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">全同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.951em; left:7.5658em;"><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0786em;">接着自动发起 </span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0786em;">PSYNC </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0786em;">请求 </span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0786em;">master </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0786em;">进行全同步。无论如何，</span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0786em;">redis </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0786em;">首先会尝试部 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.9468em; left:5.9058em;"><span class="stl_17 stl_18 stl_22" style="word-spacing:0.0846em;">分同步，如果失败才尝试全同步。而刚刚建立连接的 </span><span class="stl_10 stl_11 stl_22" style="word-spacing:0.0846em;">master-slave </span><span class="stl_17 stl_18 stl_22" style="word-spacing:0.0846em;">需要全同步。 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.9593em; left:7.5658em;"><span class="stl_17 stl_18 stl_1192" style="word-spacing:0.0612em;">从机连接主机后，会主动发起 </span><span class="stl_10 stl_11 stl_1192" style="word-spacing:0.0612em;">PSYNC </span><span class="stl_17 stl_18 stl_1192" style="word-spacing:0.0612em;">命令，从机会提供 </span><span class="stl_10 stl_11 stl_1192" style="word-spacing:0.0612em;">master_runid </span><span class="stl_17 stl_18 stl_1192" style="word-spacing:0.0612em;">和 </span><span class="stl_10 stl_11 stl_1192" style="word-spacing:0.0612em;">oﬀset</span><span class="stl_17 stl_18 stl_1192" style="word-spacing:0.0612em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 18.9551em; left:5.9058em;"><span class="stl_17 stl_18 stl_1193" style="word-spacing:0.112em;">主机验证 </span><span class="stl_10 stl_11 stl_1193" style="word-spacing:0.112em;">master_runid </span><span class="stl_17 stl_18 stl_1193" style="word-spacing:0.112em;">和 </span><span class="stl_10 stl_11 stl_1193" style="word-spacing:0.112em;">oﬀset </span><span class="stl_17 stl_18 stl_1193" style="word-spacing:0.112em;">是否有效？</span><span class="stl_10 stl_11 stl_1193" style="word-spacing:0.112em;">master_runid </span><span class="stl_17 stl_18 stl_1193" style="word-spacing:0.112em;">相当于主机身份验证码， &nbsp;</span></div>
					<div class="stl_01" style="top: 19.9518em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">用来验证从机上一次连接的主机，</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">oﬀset </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">是全局积压空间数据的偏移量。 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.9643em; left:7.5658em;"><span class="stl_17 stl_18 stl_391" style="word-spacing:0.0835em;">验证未通过则，则进行全同步：主机返回 </span><span class="stl_10 stl_11 stl_391" style="word-spacing:0.0835em;">+FULLRESYNC master_runid oﬀset &nbsp;</span></div>
					<div class="stl_01" style="top: 23.1823em; left:5.435em;"><span class="stl_17 stl_18 stl_07">（</span></div>
					<div class="stl_01" style="top: 22.9601em; left:6.2653em;"><span class="stl_17 stl_18 stl_1194" style="word-spacing:0.0486em;">从机接收并记录 </span><span class="stl_10 stl_11 stl_1194" style="word-spacing:0.0486em;">master_runid </span><span class="stl_17 stl_18 stl_1194" style="word-spacing:0.0486em;">和 </span><span class="stl_10 stl_11 stl_1194" style="word-spacing:0.0486em;">oﬀset</span><span class="stl_17 stl_18 stl_1194" style="word-spacing:0.0486em;">，并准备接收 </span><span class="stl_10 stl_11 stl_1194" style="word-spacing:0.0486em;">RDB </span><span class="stl_17 stl_18 stl_1194" style="word-spacing:0.0486em;">文件）接着启动 </span><span class="stl_10 stl_11 stl_1194" style="word-spacing:0.0486em;">BGSAVE &nbsp;</span></div>
					<div class="stl_01" style="top: 23.9568em; left:5.9058em;"><span class="stl_17 stl_18 stl_1195" style="word-spacing:0.0904em;">生成 </span><span class="stl_10 stl_11 stl_1195" style="word-spacing:0.0904em;">RDB </span><span class="stl_17 stl_18 stl_1195" style="word-spacing:0.0904em;">文件，</span><span class="stl_10 stl_11 stl_1195" style="word-spacing:0.0904em;">BGSAVE </span><span class="stl_17 stl_18 stl_1195" style="word-spacing:0.0904em;">结束后，向从机传输，从而完成全同步。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4851em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.4851em; left:6.4282em;"><span class="stl_58 stl_59 stl_549">/</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3156em;">&nbsp;</span><span class="stl_17 stl_18 stl_549" style="word-spacing:0.3156em;">连</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2452em;">&nbsp;接</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;主</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;机</span><span class="stl_17 stl_18 stl_549" style="word-spacing:0.3487em;">&nbsp;</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3487em;">connectWithMaster</span><span class="stl_58 stl_59 stl_549" style="word-spacing:-0.2242em;">&nbsp;()</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3832em;">&nbsp;</span><span class="stl_17 stl_18 stl_549" style="word-spacing:0.3832em;">的</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2452em;">&nbsp;时</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2102em;">&nbsp;候，</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2112em;">&nbsp;会</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;被</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;注</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;册</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;为</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;回</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;调</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;函</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4743em; left:5.9483em;"><span class="stl_15 stl_16 stl_1196">void</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.32em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.32em;">syncWithMaster</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2273em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2332em;">&nbsp;aeEventLoop</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.3108em;">&nbsp;*</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2433em;">&nbsp;el</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.0122em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.4469em;">&nbsp;</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.4469em;">int</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.3716em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.3716em;">fd</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.0823em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.4015em;">&nbsp;</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.4015em;">void</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.2908em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.2908em;">*</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2533em;">&nbsp;privdata</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2533em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 29.471em; left:7.6483em;"><span class="stl_15 stl_16 stl_151" style="word-spacing:0.3525em;">int </span><span class="stl_10 stl_11 stl_151" style="word-spacing:0.3525em;">mask) { &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4668em; left:7.9342em;"><span class="stl_15 stl_16 stl_969">char</span><span class="stl_15 stl_16 stl_969" style="word-spacing:0.3046em;">&nbsp;</span><span class="stl_10 stl_11 stl_969" style="word-spacing:0.3046em;">tmpfile</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.1798em;">&nbsp;[</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3198em;">&nbsp;2</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3198em;">&nbsp;5</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3188em;">&nbsp;6</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3198em;">&nbsp;]</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.1618em;">&nbsp;,</span><span class="stl_10 stl_11 stl_969" style="word-spacing:0.3312em;">&nbsp;*</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.2848em;">&nbsp;err</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.2848em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4635em; left:7.98em;"><span class="stl_15 stl_16 stl_301">int</span><span class="stl_15 stl_16 stl_301" style="word-spacing:0.3093em;">&nbsp;</span><span class="stl_10 stl_11 stl_301" style="word-spacing:0.3093em;">dfd</span><span class="stl_10 stl_11 stl_301" style="word-spacing:-0.1525em;">&nbsp;,</span><span class="stl_10 stl_11 stl_301" style="word-spacing:0.4105em;">&nbsp;maxtries</span><span class="stl_10 stl_11 stl_301" style="word-spacing:0.1605em;">&nbsp;=</span><span class="stl_10 stl_11 stl_301" style="word-spacing:0.1855em;">&nbsp;5; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4593em; left:7.98em;"><span class="stl_15 stl_16 stl_450">int</span><span class="stl_15 stl_16 stl_450" style="word-spacing:0.3437em;">&nbsp;</span><span class="stl_10 stl_11 stl_450" style="word-spacing:0.3437em;">sockerr</span><span class="stl_10 stl_11 stl_450" style="word-spacing:0.1556em;">&nbsp;=</span><span class="stl_10 stl_11 stl_450" style="word-spacing:-0.0799em;">&nbsp;0 ,</span><span class="stl_10 stl_11 stl_450" style="word-spacing:0.3296em;">&nbsp;psync_result</span><span class="stl_10 stl_11 stl_450" style="word-spacing:0.3296em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.456em; left:7.9908em;"><span class="stl_10 stl_11 stl_1197" style="word-spacing:0.3718em;">socklen_t e</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.3402em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.3392em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.3402em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.3402em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.3392em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:0.1708em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:0.138em;">&nbsp;</span><span class="stl_15 stl_16 stl_1197" style="word-spacing:0.138em;">sizeof</span><span class="stl_15 stl_16 stl_1197" style="word-spacing:-0.267em;">&nbsp;</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.267em;">(</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.2532em;">&nbsp;sockerr</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.2532em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.2532em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4535em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 35.4535em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.4476em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">这 里</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;尝</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;试</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;向</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;请</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;求</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;部</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;分</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;步，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;回</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;复</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;以</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;拒</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;绝</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;或</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;受</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;请 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4443em; left:9.6692em;"><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0539em;">求。 如</span><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0869em;">&nbsp;果</span><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0869em;">&nbsp;拒</span><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0869em;">&nbsp;绝</span><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0869em;">&nbsp;部</span><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0869em;">&nbsp;分</span><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0869em;">&nbsp;同</span><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0529em;">&nbsp;步，</span><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0539em;">&nbsp;会</span><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0869em;">&nbsp;返</span><span class="stl_17 stl_18 stl_186" style="word-spacing:-0.0869em;">&nbsp;回</span><span class="stl_17 stl_18 stl_186" style="word-spacing:0.3284em;">&nbsp;</span><span class="stl_58 stl_59 stl_186" style="word-spacing:0.3284em;">+FULLRESYNC</span><span class="stl_58 stl_59 stl_186" style="word-spacing:0.3284em;">&nbsp;master_runid &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:9.71em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.0682em;">o f f s e t &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;收</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;后</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;准</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;备</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;全</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:23.4433em;"><span class="stl_58 stl_59 stl_939" style="word-spacing:0.143em;">psync_result = &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:9.6692em;"><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.2877em;">slaveTryPartialResynchronization ( fd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:8.045em;"><span class="stl_15 stl_16 stl_192" style="word-spacing:-0.0769em;">i f</span><span class="stl_15 stl_16 stl_192" style="word-spacing:0.6295em;">&nbsp;</span><span class="stl_10 stl_11 stl_192" style="word-spacing:0.6295em;">(</span><span class="stl_10 stl_11 stl_192" style="word-spacing:-0.0309em;">&nbsp;psync_result</span><span class="stl_10 stl_11 stl_192" style="word-spacing:0.3461em;">&nbsp;==</span><span class="stl_10 stl_11 stl_192" style="word-spacing:0.1391em;">&nbsp;PSYNC_CONTINUE)</span><span class="stl_10 stl_11 stl_192" style="word-spacing:0.1391em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:9.9933em;z-index:779; "><span class="stl_10 stl_11 stl_24" style="word-spacing:-0.0248em;">redisLog (REDIS_NOTICE,</span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.5712em;">&nbsp;”MASTER␣&lt;</span><span class="stl_107 stl_108 stl_24" style="word-spacing:0.5712em;">−</span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.5712em;">&gt;␣SLAVE␣sync</span><span class="stl_10 stl_11 stl_24" style="word-spacing:-0.0198em;">&nbsp;:</span><span class="stl_10 stl_11 stl_24" style="word-spacing:-0.0198em;">&nbsp;␣Master &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:11.5925em;"><span class="stl_10 stl_11 stl_07">␣</span></div>
					<div class="stl_01" style="top: 44.4202em; left:12.143em;"><span class="stl_10 stl_11 stl_1198" style="word-spacing:-0.286em;">accepted ␣a␣ Partial ␣ Resynchronization . ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:9.9383em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">138 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;全</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_368" style="word-spacing:0.3709em;">* Fall</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.4009em;">&nbsp;back to</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.2129em;">&nbsp;SYNC</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.2879em;">&nbsp;i</span><span class="stl_58 stl_59 stl_368" style="word-spacing:-0.2371em;">&nbsp;f</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.4529em;">&nbsp;needed</span><span class="stl_58 stl_59 stl_368" style="word-spacing:-0.1951em;">&nbsp;.</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.4089em;">&nbsp;Otherwise psync_result</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.1799em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.9883em;"><span class="stl_58 stl_59 stl_1199">PSYNC_FULLRESYNC &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.4371em;"><span class="stl_58 stl_59 stl_951" style="word-spacing:0.3256em;">and the</span><span class="stl_58 stl_59 stl_951" style="word-spacing:0.4096em;">&nbsp;server</span><span class="stl_58 stl_59 stl_951" style="word-spacing:-0.1684em;">&nbsp;.</span><span class="stl_58 stl_59 stl_951" style="word-spacing:-0.2074em;">&nbsp;repl_master_runid</span><span class="stl_58 stl_59 stl_951" style="word-spacing:0.3006em;">&nbsp;and &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.175em;"><span class="stl_58 stl_59 stl_271" style="word-spacing:0.3151em;">repl_master_initial_offset are &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:9.5002em;"><span class="stl_58 stl_59 stl_626" style="word-spacing:0.3603em;">already populated</span><span class="stl_58 stl_59 stl_626" style="word-spacing:-0.2247em;">&nbsp;.</span><span class="stl_58 stl_59 stl_626" style="word-spacing:0.3093em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">未 知</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;结</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;果，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;进</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;行</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;出</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;错</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;处</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;理 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:8.045em;"><span class="stl_15 stl_16 stl_1200" style="word-spacing:-0.0239em;">i f</span><span class="stl_15 stl_16 stl_1200" style="word-spacing:0.6825em;">&nbsp;</span><span class="stl_10 stl_11 stl_1200" style="word-spacing:0.6825em;">(</span><span class="stl_10 stl_11 stl_1200" style="word-spacing:0.0221em;">&nbsp;psync_result</span><span class="stl_10 stl_11 stl_1200" style="word-spacing:0.3991em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1200" style="word-spacing:0.1721em;">&nbsp;PSYNC_NOT_SUPPORTED)</span><span class="stl_10 stl_11 stl_1200" style="word-spacing:0.1721em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:9.9933em;"><span class="stl_10 stl_11 stl_628" style="word-spacing:-0.1177em;">redisLog (REDIS_NOTICE, ” Retrying ␣with␣SYNC . . . ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:10.0375em;"><span class="stl_15 stl_16 stl_314" style="word-spacing:-0.2175em;">i f</span><span class="stl_15 stl_16 stl_314" style="word-spacing:0.4888em;">&nbsp;</span><span class="stl_10 stl_11 stl_314" style="word-spacing:0.4888em;">(</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.1935em;">&nbsp;syncWrite</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.1925em;">&nbsp;(</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.2035em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.0635em;">&nbsp;,</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.1685em;">&nbsp;”SYNC\</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.2405em;">&nbsp;r</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.2395em;">&nbsp;\n”</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.0815em;">&nbsp;,6</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.1455em;">&nbsp;,</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.1255em;">&nbsp;server</span><span class="stl_10 stl_11 stl_314" style="word-spacing:-0.1255em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:11.64em;z-index:333; "><span class="stl_10 stl_11 stl_1201" style="word-spacing:-0.2232em;">repl_syncio_timeout *1000)</span><span class="stl_10 stl_11 stl_1201" style="word-spacing:0.1508em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1201" style="word-spacing:0.102em;">&nbsp;</span><span class="stl_107 stl_108 stl_1201" style="word-spacing:0.1508em;">−</span><span class="stl_10 stl_11 stl_1201" style="word-spacing:0.102em;">1)</span><span class="stl_10 stl_11 stl_1201" style="word-spacing:0.102em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:11.9858em;"><span class="stl_10 stl_11 stl_1202" style="word-spacing:-0.1414em;">redisLog (REDIS_WARNING, ” I /O␣ error ␣ writing ␣ to ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:13.4533em;"><span class="stl_10 stl_11 stl_1203" style="word-spacing:0.104em;">MASTER: ␣%s</span><span class="stl_10 stl_11 stl_1203" style="word-spacing:0.059em;">&nbsp;”</span><span class="stl_10 stl_11 stl_1203" style="word-spacing:0.059em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:14.0142em;"><span class="stl_10 stl_11 stl_931" style="word-spacing:-0.2909em;">s t r e r r o r ( errno ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:11.9208em;"><span class="stl_15 stl_16 stl_1204">goto</span><span class="stl_15 stl_16 stl_1204" style="word-spacing:0.3359em;">&nbsp;</span><span class="stl_10 stl_11 stl_1204" style="word-spacing:0.3359em;">error</span><span class="stl_10 stl_11 stl_1204" style="word-spacing:0.3359em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 22.656em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;什</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;么</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;要</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;尝</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;试</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.4947em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.4947em;">5</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.0454em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0454em;">次</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.09em;">&nbsp;？</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.09em;">&nbsp;？</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.09em;">&nbsp;？ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:8.4207em;"><span class="stl_58 stl_59 stl_293" style="word-spacing:0.298em;">* Prepare a</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.368em;">&nbsp;s</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.276em;">&nbsp;u</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.277em;">&nbsp;i</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.276em;">&nbsp;t</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.276em;">&nbsp;a</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.276em;">&nbsp;b</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.276em;">&nbsp;l</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.277em;">&nbsp;e</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.38em;">&nbsp;temp</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.424em;">&nbsp;f</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.232em;">&nbsp;i</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.232em;">&nbsp;l</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.232em;">&nbsp;e</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.508em;">&nbsp;for</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.438em;">&nbsp;bulk t</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.293em;">&nbsp;r</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.293em;">&nbsp;a</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.294em;">&nbsp;n</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.293em;">&nbsp;s</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.293em;">&nbsp;f</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.293em;">&nbsp;e</span><span class="stl_58 stl_59 stl_293" style="word-spacing:-0.293em;">&nbsp;r</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.366em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.636em; left:7.9483em;z-index:494; "><span class="stl_15 stl_16 stl_594">while</span><span class="stl_15 stl_16 stl_594" style="word-spacing:-0.2191em;">&nbsp;</span><span class="stl_10 stl_11 stl_594" style="word-spacing:-0.2191em;">(</span><span class="stl_10 stl_11 stl_594" style="word-spacing:-0.1774em;">&nbsp;maxtries</span><span class="stl_10 stl_11 stl_594" style="word-spacing:-0.2059em;">&nbsp;</span><span class="stl_107 stl_108 stl_594" style="word-spacing:-0.2059em;">−−</span><span class="stl_10 stl_11 stl_594" style="word-spacing:-0.2059em;">)</span><span class="stl_10 stl_11 stl_594" style="word-spacing:-0.2059em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:10.0175em;"><span class="stl_10 stl_11 stl_1205" style="word-spacing:-0.3044em;">s n p r i n t f ( tmpfile ,256 , &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:11.9367em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 28.6285em; left:12.4058em;z-index:523; "><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.2444em;">temp</span><span class="stl_107 stl_108 stl_938" style="word-spacing:-0.2444em;">−</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.2444em;">%d.% ld</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.1124em;">&nbsp;.</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.1604em;">&nbsp;rdb”</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.0644em;">&nbsp;,(</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.1628em;">&nbsp;</span><span class="stl_15 stl_16 stl_938" style="word-spacing:-0.1628em;">int</span><span class="stl_15 stl_16 stl_938" style="word-spacing:-0.1907em;">&nbsp;</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.1907em;">)</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.1474em;">&nbsp;server</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.0904em;">&nbsp;.</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.1404em;">&nbsp;unixtime</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.0294em;">&nbsp;,</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.2184em;">&nbsp;(</span><span class="stl_10 stl_11 stl_938" style="word-spacing:-0.1586em;">&nbsp;</span><span class="stl_15 stl_16 stl_938" style="word-spacing:-0.1586em;">long</span><span class="stl_15 stl_16 stl_938" style="word-spacing:0.3616em;">&nbsp;int</span><span class="stl_15 stl_16 stl_938" style="word-spacing:-0.1905em;">&nbsp;</span><span class="stl_10 stl_11 stl_938" style="word-spacing:0.3616em;">) &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:13.6475em;"><span class="stl_10 stl_11 stl_946" style="word-spacing:-0.2463em;">getpid () ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:9.97em;"><span class="stl_10 stl_11 stl_1173" style="word-spacing:0.3583em;">dfd = open</span><span class="stl_10 stl_11 stl_1173" style="word-spacing:-0.0612em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1173" style="word-spacing:-0.0053em;">&nbsp;tmpfile</span><span class="stl_10 stl_11 stl_1173" style="word-spacing:0.1738em;">&nbsp;,O_CREAT|O_WRONLY|O_EXCL,0644)</span><span class="stl_10 stl_11 stl_1173" style="word-spacing:0.1738em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6168em; left:10.0375em;"><span class="stl_15 stl_16 stl_1206" style="word-spacing:-0.1678em;">i f</span><span class="stl_15 stl_16 stl_1206" style="word-spacing:0.5386em;">&nbsp;</span><span class="stl_10 stl_11 stl_1206" style="word-spacing:0.5386em;">(</span><span class="stl_10 stl_11 stl_1206" style="word-spacing:-0.1428em;">&nbsp;dfd</span><span class="stl_10 stl_11 stl_1206" style="word-spacing:0.3992em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_1206" style="word-spacing:0.3578em;">&nbsp;</span><span class="stl_107 stl_108 stl_1206" style="word-spacing:0.3992em;">−</span><span class="stl_10 stl_11 stl_1206" style="word-spacing:0.3578em;">1)</span><span class="stl_10 stl_11 stl_1206" style="word-spacing:0.315em;">&nbsp;</span><span class="stl_15 stl_16 stl_1206" style="word-spacing:0.315em;">break</span><span class="stl_15 stl_16 stl_1206" style="word-spacing:-0.1502em;">&nbsp;</span><span class="stl_10 stl_11 stl_1206" style="word-spacing:0.315em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:10.0133em;"><span class="stl_10 stl_11 stl_1207" style="word-spacing:-0.248em;">sleep (1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.606em; left:8.045em;z-index:658; "><span class="stl_15 stl_16 stl_1056" style="word-spacing:-0.1252em;">i f</span><span class="stl_15 stl_16 stl_1056" style="word-spacing:0.5812em;">&nbsp;</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:0.5812em;">(</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:-0.1002em;">&nbsp;dfd</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:0.2748em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:0.2324em;">&nbsp;</span><span class="stl_107 stl_108 stl_1056" style="word-spacing:0.2748em;">−</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:0.2324em;">1)</span><span class="stl_10 stl_11 stl_1056" style="word-spacing:0.2324em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:9.9933em;"><span class="stl_10 stl_11 stl_1208" style="word-spacing:-0.1145em;">redisLog (REDIS_WARNING, ”Opening␣ the ␣temp␣ f i l e ␣needed␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:11.6758em;z-index:726; "><span class="stl_10 stl_11 stl_07">f</span><sub><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.1em;">&nbsp;</span></sub><span class="stl_10 stl_11 stl_1209">o</span><sub><span class="stl_10 stl_11 stl_1209">e</span></sub><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2313em;">&nbsp;</span><span class="stl_10 stl_11 stl_1210">r</span><sub><span class="stl_10 stl_11 stl_1210">r</span></sub><sub><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2362em;">&nbsp;</span></sub><sub><span class="stl_10 stl_11 stl_1211">r</span></sub><span class="stl_10 stl_11 stl_1211">␣</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0278em;">&nbsp;</span><span class="stl_10 stl_11 stl_1212">M</span><sub><span class="stl_10 stl_11 stl_1212">n</span></sub><sub><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7722em;">&nbsp;</span></sub><sub><span class="stl_10 stl_11 stl_1213">o</span></sub><span class="stl_10 stl_11 stl_1213">A</span><sub><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0153em;">&nbsp;</span></sub><sub><span class="stl_10 stl_11 stl_1214">)</span></sub><span class="stl_10 stl_11 stl_1214">S</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0062em;">&nbsp;</span><span class="stl_10 stl_11 stl_1215">T</span><sub><span class="stl_10 stl_11 stl_1215">)</span></sub><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4623em;">&nbsp;</span><span class="stl_10 stl_11 stl_1216">E</span><sub><span class="stl_10 stl_11 stl_1216">;</span></sub><span class="stl_10 stl_11 stl_07" style="word-spacing:0.4073em;">&nbsp;</span><span class="stl_10 stl_11 stl_562" style="word-spacing:-0.1281em;">R␣&lt;</span><span class="stl_107 stl_108 stl_562" style="word-spacing:-0.1281em;">−</span><span class="stl_10 stl_11 stl_562" style="word-spacing:-0.1281em;">&gt;␣SLAVE␣ synchronization : ␣%s ” , s t r e r r o r &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:11.6383em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 38.591em; left:9.9283em;"><span class="stl_15 stl_16 stl_823">goto</span><span class="stl_15 stl_16 stl_823" style="word-spacing:0.3372em;">&nbsp;</span><span class="stl_10 stl_11 stl_823" style="word-spacing:0.3372em;">error</span><span class="stl_10 stl_11 stl_823" style="word-spacing:0.3372em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 41.586em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:8.4207em;"><span class="stl_58 stl_59 stl_1204">/</span><span class="stl_58 stl_59 stl_1204" style="word-spacing:0.3033em;">&nbsp;</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:0.3033em;">注</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2575em;">&nbsp;册</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2565em;">&nbsp;读</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2565em;">&nbsp;事</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2235em;">&nbsp;件，</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2235em;">&nbsp;回</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2565em;">&nbsp;调</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2565em;">&nbsp;函</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2565em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:0.3441em;">&nbsp;</span><span class="stl_58 stl_59 stl_1204" style="word-spacing:0.3441em;">readSyncBulkPayload</span><span class="stl_58 stl_59 stl_1204" style="word-spacing:-0.2285em;">&nbsp;()</span><span class="stl_58 stl_59 stl_1204" style="word-spacing:-0.2289em;">&nbsp;</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2289em;">，</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:0.3425em;">&nbsp;准</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2565em;">&nbsp;备</span><span class="stl_17 stl_18 stl_1204" style="word-spacing:-0.2565em;">&nbsp;读 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:9.4783em;"><span class="stl_58 stl_59 stl_639">RDB</span><span class="stl_58 stl_59 stl_639" style="word-spacing:0.5466em;">&nbsp;</span><span class="stl_17 stl_18 stl_639" style="word-spacing:0.5466em;">文</span><span class="stl_17 stl_18 stl_639" style="word-spacing:0.5466em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:8.4207em;"><span class="stl_58 stl_59 stl_1217" style="word-spacing:0.2883em;">* Setup</span><span class="stl_58 stl_59 stl_1217" style="word-spacing:0.3533em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1217" style="word-spacing:0.3058em;">&nbsp;non blocking</span><span class="stl_58 stl_59 stl_1217" style="word-spacing:0.3613em;">&nbsp;download of the</span><span class="stl_58 stl_59 stl_1217" style="word-spacing:0.3913em;">&nbsp;bulk</span><span class="stl_58 stl_59 stl_1217" style="word-spacing:0.4803em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1217" style="word-spacing:-0.2567em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1217" style="word-spacing:-0.2567em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1217" style="word-spacing:-0.2567em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1217" style="word-spacing:-0.1097em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1217" style="word-spacing:0.3353em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5685em; left:8.045em;"><span class="stl_15 stl_16 stl_1188" style="word-spacing:-0.179em;">i f</span><span class="stl_15 stl_16 stl_1188" style="word-spacing:0.5274em;">&nbsp;</span><span class="stl_10 stl_11 stl_1188" style="word-spacing:0.5274em;">(</span><span class="stl_10 stl_11 stl_1188" style="word-spacing:-0.132em;">&nbsp;aeCreateFileEvent</span><span class="stl_10 stl_11 stl_1188" style="word-spacing:-0.132em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1188" style="word-spacing:-0.106em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1188" style="word-spacing:-0.051em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1188" style="word-spacing:-0.074em;">&nbsp;el</span><span class="stl_10 stl_11 stl_1188" style="word-spacing:-0.064em;">&nbsp;, fd</span><span class="stl_10 stl_11 stl_1188" style="word-spacing:-0.025em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1188" style="word-spacing:0.308em;">&nbsp;AE_READABLE, &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:9.63em;"><span class="stl_10 stl_11 stl_1218" style="word-spacing:-0.0437em;">readSyncBulkPayload ,NULL) &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:11.785em;"><span class="stl_10 stl_11 stl_1219" style="word-spacing:0.3094em;">== AE_ERR) &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.3. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">全同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">139 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.9933em;"><span class="stl_10 stl_11 stl_34" style="word-spacing:-0.0137em;">redisLog (REDIS_WARNING, &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:12.3858em;"><span class="stl_10 stl_11 stl_1220" style="word-spacing:-0.1892em;">Can ’ t ␣ create ␣ readable ␣ event ␣ fo r ␣SYNC: ␣%s ␣ ( fd=%d) &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:11.9367em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 8.7076em; left:13.5967em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 8.7076em; left:14.2194em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 9.7043em; left:12.0217em;"><span class="stl_10 stl_11 stl_973" style="word-spacing:-0.2776em;">s t r e r r o r ( errno ) , fd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:9.9283em;"><span class="stl_15 stl_16 stl_823">goto</span><span class="stl_15 stl_16 stl_823" style="word-spacing:0.3372em;">&nbsp;</span><span class="stl_10 stl_11 stl_823" style="word-spacing:0.3372em;">error</span><span class="stl_10 stl_11 stl_823" style="word-spacing:0.3372em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_866">/</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.7028em;">&nbsp;</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.7028em;">设</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.1427em;">&nbsp;置 传 输</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5462em;">&nbsp;</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.5462em;">RDB</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.5456em;">&nbsp;</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5456em;">文</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.1428em;">&nbsp;件 数 据 的 选</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.1428em;">&nbsp;项 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">状</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">&nbsp;态 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:8.0175em;"><span class="stl_10 stl_11 stl_819" style="word-spacing:0.0158em;">server .</span><span class="stl_10 stl_11 stl_819" style="word-spacing:0.0048em;">&nbsp;repl_state</span><span class="stl_10 stl_11 stl_819" style="word-spacing:0.3548em;">&nbsp;=</span><span class="stl_10 stl_11 stl_819" style="word-spacing:0.1468em;">&nbsp;REDIS_REPL_TRANSFER; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4207em;"><span class="stl_58 stl_59 stl_866" style="word-spacing:0.505em;">/ RDB</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.5457em;">&nbsp;</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5457em;">文</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.1427em;">&nbsp;件 大</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.1427em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:8.0175em;"><span class="stl_10 stl_11 stl_564" style="word-spacing:-0.2141em;">server .</span><span class="stl_10 stl_11 stl_564" style="word-spacing:-0.2161em;">&nbsp;repl_transfer_size</span><span class="stl_10 stl_11 stl_564" style="word-spacing:0.1339em;">&nbsp;=</span><span class="stl_10 stl_11 stl_564" style="word-spacing:0.0889em;">&nbsp;</span><span class="stl_107 stl_108 stl_564" style="word-spacing:0.1339em;">−</span><span class="stl_10 stl_11 stl_564" style="word-spacing:0.0889em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">已</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;经</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;传</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;输</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:8.0175em;"><span class="stl_10 stl_11 stl_404" style="word-spacing:-0.2036em;">server .</span><span class="stl_10 stl_11 stl_404" style="word-spacing:-0.2236em;">&nbsp;repl_transfer_read</span><span class="stl_10 stl_11 stl_404" style="word-spacing:0.1274em;">&nbsp;=</span><span class="stl_10 stl_11 stl_404" style="word-spacing:0.1434em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">上 一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;次</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;步</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;偏</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;移，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;为</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;定</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;写</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;入</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;磁</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;盘 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:8.0175em;"><span class="stl_10 stl_11 stl_1097" style="word-spacing:-0.2146em;">server .</span><span class="stl_10 stl_11 stl_1097" style="word-spacing:-0.2256em;">&nbsp;repl_transfer_last_fsync_off</span><span class="stl_10 stl_11 stl_1097" style="word-spacing:0.1284em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1097" style="word-spacing:0.1284em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_866">/</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.7028em;">&nbsp;</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.7028em;">本</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.142em;">&nbsp;地</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5464em;">&nbsp;</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.5464em;">RDB</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.5446em;">&nbsp;</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5446em;">文</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.143em;">&nbsp;件 套 接</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.143em;">&nbsp;字 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:8.0175em;"><span class="stl_10 stl_11 stl_1221" style="word-spacing:-0.2037em;">server .</span><span class="stl_10 stl_11 stl_1221" style="word-spacing:-0.2187em;">&nbsp;repl_transfer_fd</span><span class="stl_10 stl_11 stl_1221" style="word-spacing:0.1313em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1221" style="word-spacing:-0.0772em;">&nbsp;dfd</span><span class="stl_10 stl_11 stl_1221" style="word-spacing:-0.0772em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_458">/</span><span class="stl_58 stl_59 stl_458" style="word-spacing:0.4798em;">&nbsp;</span><span class="stl_17 stl_18 stl_458" style="word-spacing:0.4798em;">上</span><span class="stl_17 stl_18 stl_458" style="word-spacing:-0.081em;">&nbsp;一</span><span class="stl_17 stl_18 stl_458" style="word-spacing:-0.08em;">&nbsp;次</span><span class="stl_17 stl_18 stl_458" style="word-spacing:-0.08em;">&nbsp;同</span><span class="stl_17 stl_18 stl_458" style="word-spacing:-0.08em;">&nbsp;步</span><span class="stl_17 stl_18 stl_458" style="word-spacing:0.4361em;">&nbsp;</span><span class="stl_58 stl_59 stl_458" style="word-spacing:0.4361em;">IO</span><span class="stl_58 stl_59 stl_458" style="word-spacing:0.436em;">&nbsp;</span><span class="stl_17 stl_18 stl_458" style="word-spacing:0.436em;">时</span><span class="stl_17 stl_18 stl_458" style="word-spacing:0.436em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:8.0175em;"><span class="stl_10 stl_11 stl_1222" style="word-spacing:-0.2221em;">server .</span><span class="stl_10 stl_11 stl_1222" style="word-spacing:-0.2181em;">&nbsp;repl_transfer_lastio</span><span class="stl_10 stl_11 stl_1222" style="word-spacing:0.1304em;">&nbsp;= server</span><span class="stl_10 stl_11 stl_1222" style="word-spacing:-0.2221em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1222" style="word-spacing:-0.2621em;">&nbsp;unixtime</span><span class="stl_10 stl_11 stl_1222" style="word-spacing:-0.2621em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6368em; left:8.0175em;"><span class="stl_10 stl_11 stl_1223" style="word-spacing:-0.2122em;">server .</span><span class="stl_10 stl_11 stl_1223" style="word-spacing:-0.2212em;">&nbsp;repl_transfer_tmpfile</span><span class="stl_10 stl_11 stl_1223" style="word-spacing:0.1288em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1223" style="word-spacing:-0.1904em;">&nbsp;zstrdup (</span><span class="stl_10 stl_11 stl_1223" style="word-spacing:-0.2722em;">&nbsp;tmpfile</span><span class="stl_10 stl_11 stl_1223" style="word-spacing:-0.2722em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1223" style="word-spacing:-0.2722em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">临</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;文</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;名 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6285em; left:7.9458em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:6.0275em;"><span class="stl_10 stl_11 stl_636" style="word-spacing:-0.235em;">error : &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:8.0283em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2771em;">c l o s e ( fd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:8.0175em;z-index:503; "><span class="stl_10 stl_11 stl_1224" style="word-spacing:-0.1946em;">server .</span><span class="stl_10 stl_11 stl_1224" style="word-spacing:-0.2096em;">&nbsp;repl_transfer_s</span><span class="stl_10 stl_11 stl_1224" style="word-spacing:0.1404em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1224" style="word-spacing:0.1087em;">&nbsp;</span><span class="stl_107 stl_108 stl_1224" style="word-spacing:0.1404em;">−</span><span class="stl_10 stl_11 stl_1224" style="word-spacing:0.1087em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:8.0175em;"><span class="stl_10 stl_11 stl_1184" style="word-spacing:0.0226em;">server .</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:0.0116em;">&nbsp;repl_state</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:0.3616em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:0.1416em;">&nbsp;REDIS_REPL_CONNECT; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:7.9458em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.0243em; left:7.5658em;"><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0789em;">全同步请求的数据是 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0789em;">RDB </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0789em;">数据文件和积压空间中的数据。关于 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0789em;">RDB </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0789em;">数据文件， &nbsp;</span></div>
					<div class="stl_01" style="top: 38.021em; left:5.9058em;"><span class="stl_17 stl_18 stl_1225" style="word-spacing:0.1098em;">请参看《深入剖析 </span><span class="stl_10 stl_11 stl_1225" style="word-spacing:0.1098em;">redis RDB </span><span class="stl_17 stl_18 stl_1225" style="word-spacing:0.1098em;">持久化策略》。如果没有后台持久化 </span><span class="stl_10 stl_11 stl_1225" style="word-spacing:0.1098em;">BGSAVE </span><span class="stl_17 stl_18 stl_1225" style="word-spacing:0.1098em;">进程，那 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.0176em; left:5.9058em;"><span class="stl_17 stl_18 stl_1226" style="word-spacing:0.0781em;">么 </span><span class="stl_10 stl_11 stl_1226" style="word-spacing:0.0781em;">BGSVAE </span><span class="stl_17 stl_18 stl_1226" style="word-spacing:0.0781em;">会被触发，否则所有请求全同步的 </span><span class="stl_10 stl_11 stl_1226" style="word-spacing:0.0781em;">slave </span><span class="stl_17 stl_18 stl_1226" style="word-spacing:0.0781em;">都会被标记为等待 </span><span class="stl_10 stl_11 stl_1226" style="word-spacing:0.0781em;">BGSAVE </span><span class="stl_17 stl_18 stl_1226" style="word-spacing:0.0781em;">结 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.0135em; left:5.9058em;"><span class="stl_17 stl_18 stl_34" style="word-spacing:0.0899em;">束。</span><span class="stl_10 stl_11 stl_34" style="word-spacing:0.0899em;">BGSAVE </span><span class="stl_17 stl_18 stl_34" style="word-spacing:0.0899em;">结束后，</span><span class="stl_10 stl_11 stl_34" style="word-spacing:0.0899em;">master </span><span class="stl_17 stl_18 stl_34" style="word-spacing:0.0899em;">会马上向所有的从机发送 </span><span class="stl_10 stl_11 stl_34" style="word-spacing:0.0899em;">RDB </span><span class="stl_17 stl_18 stl_34" style="word-spacing:0.0899em;">文件。 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.4218em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4293em; left:6.4282em;"><span class="stl_58 stl_59 stl_1227">/</span><span class="stl_58 stl_59 stl_1227" style="word-spacing:0.6046em;">&nbsp;</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.6046em;">主</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.0438em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.4722em;">&nbsp;</span><span class="stl_58 stl_59 stl_1227" style="word-spacing:0.4722em;">SYNC</span><span class="stl_58 stl_59 stl_1227" style="word-spacing:0.4715em;">&nbsp;</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.4715em;">和</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.4708em;">&nbsp;</span><span class="stl_58 stl_59 stl_1227" style="word-spacing:0.4708em;">PSYNC</span><span class="stl_58 stl_59 stl_1227" style="word-spacing:0.4707em;">&nbsp;</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.4707em;">命</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.0447em;">&nbsp;令 处 理 函</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.0783em;">&nbsp;数， 会</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.0447em;">&nbsp;尝 试 进 行 部 分 同 步 和 全</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.0447em;">&nbsp;同 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.6457em; left:7.6492em;"><span class="stl_17 stl_18 stl_07">步</span></div>
					<div class="stl_01" style="top: 44.4218em; left:6.4282em;"><span class="stl_58 stl_59 stl_767" style="word-spacing:0.2759em;">* SYNC ad PSYNC</span><span class="stl_58 stl_59 stl_767" style="word-spacing:0.2165em;">&nbsp;command</span><span class="stl_58 stl_59 stl_767" style="word-spacing:0.3905em;">&nbsp;implemenation</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.0635em;">&nbsp;.</span><span class="stl_58 stl_59 stl_767" style="word-spacing:0.4965em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:5.9483em;"><span class="stl_15 stl_16 stl_1228">void</span><span class="stl_15 stl_16 stl_1228" style="word-spacing:0.3434em;">&nbsp;</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:0.3434em;">syncCommand(</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.0616em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1686em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1686em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1686em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:0.4824em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1396em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1396em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 47.4101em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4127em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:8.4207em;"><span class="stl_58 stl_59 stl_1229">/</span><span class="stl_58 stl_59 stl_1229" style="word-spacing:0.6364em;">&nbsp;</span><span class="stl_17 stl_18 stl_1229" style="word-spacing:0.6364em;">主</span><span class="stl_17 stl_18 stl_1229" style="word-spacing:0.0764em;">&nbsp;机 尝 试 部 分 同</span><span class="stl_17 stl_18 stl_1229" style="word-spacing:0.11em;">&nbsp;步， 失</span><span class="stl_17 stl_18 stl_1229" style="word-spacing:0.0765em;">&nbsp;败 的 话 向 从 机 发 送</span><span class="stl_17 stl_18 stl_1229" style="word-spacing:0.493em;">&nbsp;</span><span class="stl_58 stl_59 stl_1229" style="word-spacing:0.493em;">+FULLRESYNC &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">140 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.6333em;"><span class="stl_58 stl_59 stl_1230" style="word-spacing:0.5516em;">master_runid o</span><span class="stl_58 stl_59 stl_1230" style="word-spacing:-0.1374em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1230" style="word-spacing:-0.1374em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1230" style="word-spacing:-0.1374em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1230" style="word-spacing:-0.1374em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1230" style="word-spacing:-0.1374em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1230" style="word-spacing:-0.0372em;">&nbsp;</span><span class="stl_17 stl_18 stl_1230" style="word-spacing:-0.0372em;">，</span><span class="stl_17 stl_18 stl_1230" style="word-spacing:-0.1194em;">&nbsp;接</span><span class="stl_17 stl_18 stl_1230" style="word-spacing:-0.1194em;">&nbsp;着</span><span class="stl_17 stl_18 stl_1230" style="word-spacing:-0.1194em;">&nbsp;启</span><span class="stl_17 stl_18 stl_1230" style="word-spacing:-0.1194em;">&nbsp;动</span><span class="stl_17 stl_18 stl_1230" style="word-spacing:0.2944em;">&nbsp;</span><span class="stl_58 stl_59 stl_1230" style="word-spacing:0.2944em;">BGSAVE &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">执 行</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;全</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;同</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;步： &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4207em;"><span class="stl_58 stl_59 stl_1231" style="word-spacing:0.2828em;">* Full</span><span class="stl_58 stl_59 stl_1231" style="word-spacing:0.3598em;">&nbsp;resynchronization</span><span class="stl_58 stl_59 stl_1231" style="word-spacing:-0.2332em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1231" style="word-spacing:0.2888em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:8.0175em;"><span class="stl_10 stl_11 stl_1059" style="word-spacing:-0.1878em;">server . stat_sync_full++; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.4207em;"><span class="stl_58 stl_59 stl_967" style="word-spacing:0.2656em;">* Here</span><span class="stl_58 stl_59 stl_967" style="word-spacing:0.2406em;">&nbsp;we need</span><span class="stl_58 stl_59 stl_967" style="word-spacing:0.3571em;">&nbsp;to check</span><span class="stl_58 stl_59 stl_967" style="word-spacing:0.4466em;">&nbsp;i</span><span class="stl_58 stl_59 stl_967" style="word-spacing:-0.2604em;">&nbsp;f</span><span class="stl_58 stl_59 stl_967" style="word-spacing:0.4581em;">&nbsp;there i</span><span class="stl_58 stl_59 stl_967" style="word-spacing:-0.2954em;">&nbsp;s</span><span class="stl_58 stl_59 stl_967" style="word-spacing:0.3496em;">&nbsp;a</span><span class="stl_58 stl_59 stl_967" style="word-spacing:0.2886em;">&nbsp;background</span><span class="stl_58 stl_59 stl_967" style="word-spacing:0.3716em;">&nbsp;saving &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.6642em;"><span class="stl_58 stl_59 stl_340">operation &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 13.691em; left:9.4836em;"><span class="stl_58 stl_59 stl_319" style="word-spacing:0.3502em;">in progress</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.0948em;">&nbsp;,</span><span class="stl_58 stl_59 stl_319" style="word-spacing:0.3562em;">&nbsp;or</span><span class="stl_58 stl_59 stl_319" style="word-spacing:0.4042em;">&nbsp;i</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.2838em;">&nbsp;f</span><span class="stl_58 stl_59 stl_319" style="word-spacing:0.5022em;">&nbsp;i</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.2928em;">&nbsp;t</span><span class="stl_58 stl_59 stl_319" style="word-spacing:0.4682em;">&nbsp;i</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.3178em;">&nbsp;s</span><span class="stl_58 stl_59 stl_319" style="word-spacing:0.4172em;">&nbsp;required</span><span class="stl_58 stl_59 stl_319" style="word-spacing:0.3902em;">&nbsp;to s</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.3148em;">&nbsp;t</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.3138em;">&nbsp;a</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.3138em;">&nbsp;r</span><span class="stl_58 stl_59 stl_319" style="word-spacing:-0.3148em;">&nbsp;t</span><span class="stl_58 stl_59 stl_319" style="word-spacing:0.3532em;">&nbsp;one</span><span class="stl_58 stl_59 stl_319" style="word-spacing:0.2462em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:8.045em;"><span class="stl_15 stl_16 stl_771" style="word-spacing:-0.2669em;">i f</span><span class="stl_15 stl_16 stl_771" style="word-spacing:0.4395em;">&nbsp;</span><span class="stl_10 stl_11 stl_771" style="word-spacing:0.4395em;">(</span><span class="stl_10 stl_11 stl_771" style="word-spacing:-0.1939em;">&nbsp;server</span><span class="stl_10 stl_11 stl_771" style="word-spacing:-0.1379em;">&nbsp;.</span><span class="stl_10 stl_11 stl_771" style="word-spacing:-0.1889em;">&nbsp;rdb_child_pid</span><span class="stl_10 stl_11 stl_771" style="word-spacing:0.2971em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_771" style="word-spacing:0.2584em;">&nbsp;</span><span class="stl_107 stl_108 stl_771" style="word-spacing:0.2971em;">−</span><span class="stl_10 stl_11 stl_771" style="word-spacing:0.2584em;">1)</span><span class="stl_10 stl_11 stl_771" style="word-spacing:0.2584em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.9733em;"><span class="stl_17 stl_18 stl_1232" style="word-spacing:0.049em;">存 在</span><span class="stl_17 stl_18 stl_1232" style="word-spacing:0.4634em;">&nbsp;</span><span class="stl_58 stl_59 stl_1232" style="word-spacing:0.4634em;">BGSAVE</span><span class="stl_58 stl_59 stl_1232" style="word-spacing:0.4622em;">&nbsp;</span><span class="stl_17 stl_18 stl_1232" style="word-spacing:0.4622em;">后</span><span class="stl_17 stl_18 stl_1232" style="word-spacing:0.0485em;">&nbsp;台 进</span><span class="stl_17 stl_18 stl_1232" style="word-spacing:0.082em;">&nbsp;程。 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.9967em;"><span class="stl_58 stl_59 stl_07">1</span></div>
					<div class="stl_01" style="top: 16.6801em; left:10.5255em;"><span class="stl_58 stl_59 stl_963">.</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2069em;">&nbsp;</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2069em;">如</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2362em;">&nbsp;果</span><span class="stl_17 stl_18 stl_963" style="word-spacing:0.3579em;">&nbsp;</span><span class="stl_58 stl_59 stl_963" style="word-spacing:0.3579em;">master</span><span class="stl_58 stl_59 stl_963" style="word-spacing:0.3574em;">&nbsp;</span><span class="stl_17 stl_18 stl_963" style="word-spacing:0.3574em;">现</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;有</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;所</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;连</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;接</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;的</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;所</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;有</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;从</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;机</span><span class="stl_17 stl_18 stl_963" style="word-spacing:0.4206em;">&nbsp;</span><span class="stl_58 stl_59 stl_963" style="word-spacing:0.4206em;">s</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2792em;">&nbsp;l</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2782em;">&nbsp;a</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2792em;">&nbsp;v</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2782em;">&nbsp;e</span><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.2792em;">&nbsp;s</span><span class="stl_58 stl_59 stl_963" style="word-spacing:0.4211em;">&nbsp;</span><span class="stl_17 stl_18 stl_963" style="word-spacing:0.4211em;">当</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;中</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;有</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;存</span><span class="stl_17 stl_18 stl_963" style="word-spacing:-0.2352em;">&nbsp;在 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:11.4767em;"><span class="stl_58 stl_59 stl_1233">REDIS_REPL_WAIT_BGSAVE_END</span><span class="stl_58 stl_59 stl_1233" style="word-spacing:0.5215em;">&nbsp;</span><span class="stl_17 stl_18 stl_1233" style="word-spacing:0.5215em;">的</span><span class="stl_17 stl_18 stl_1233" style="word-spacing:0.1108em;">&nbsp;从</span><span class="stl_17 stl_18 stl_1233" style="word-spacing:0.1448em;">&nbsp;机， 那</span><span class="stl_17 stl_18 stl_1233" style="word-spacing:0.1118em;">&nbsp;么 将 从 机</span><span class="stl_17 stl_18 stl_1233" style="word-spacing:0.6819em;">&nbsp;</span><span class="stl_58 stl_59 stl_1233" style="word-spacing:0.6819em;">c</span><span class="stl_58 stl_59 stl_1233" style="word-spacing:0.6824em;">&nbsp;</span><span class="stl_17 stl_18 stl_1233" style="word-spacing:0.6819em;">设 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:11.6342em;"><span class="stl_17 stl_18 stl_1234" style="word-spacing:0.1204em;">置 为</span><span class="stl_17 stl_18 stl_1234" style="word-spacing:0.5328em;">&nbsp;</span><span class="stl_58 stl_59 stl_1234" style="word-spacing:0.5328em;">REDIS_REPL_WAIT_BGSAVE_END</span><span class="stl_17 stl_18 stl_1234" style="word-spacing:0.5328em;">； &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:9.9967em;"><span class="stl_58 stl_59 stl_07">2</span></div>
					<div class="stl_01" style="top: 21.661em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:10.5255em;"><span class="stl_58 stl_59 stl_1235">.</span><span class="stl_58 stl_59 stl_1235" style="word-spacing:0.1261em;">&nbsp;</span><span class="stl_17 stl_18 stl_1235" style="word-spacing:0.1261em;">否 则， 设</span><span class="stl_17 stl_18 stl_1235" style="word-spacing:0.0947em;">&nbsp;置 为</span><span class="stl_17 stl_18 stl_1235" style="word-spacing:0.5088em;">&nbsp;</span><span class="stl_58 stl_59 stl_1235" style="word-spacing:0.5088em;">REDIS_REPL_WAIT_BGSAVE_START*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:10.4132em;"><span class="stl_58 stl_59 stl_685" style="word-spacing:0.1781em;">* Ok a</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.2806em;">&nbsp;background</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.3476em;">&nbsp;save</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.4096em;">&nbsp;i</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.3034em;">&nbsp;s</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.3931em;">&nbsp;in progress</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.1844em;">&nbsp;.</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.3776em;">&nbsp;Let</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.1734em;">&nbsp;’</span><span class="stl_58 stl_59 stl_685" style="word-spacing:-0.2714em;">&nbsp;s</span><span class="stl_58 stl_59 stl_685" style="word-spacing:0.3396em;">&nbsp;check &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:11.7133em;"><span class="stl_58 stl_59 stl_600" style="word-spacing:-0.2177em;">i f</span><span class="stl_58 stl_59 stl_600" style="word-spacing:0.5693em;">&nbsp;i</span><span class="stl_58 stl_59 stl_600" style="word-spacing:-0.2257em;">&nbsp;t</span><span class="stl_58 stl_59 stl_600" style="word-spacing:0.5353em;">&nbsp;i</span><span class="stl_58 stl_59 stl_600" style="word-spacing:-0.2507em;">&nbsp;s</span><span class="stl_58 stl_59 stl_600" style="word-spacing:0.3933em;">&nbsp;a</span><span class="stl_58 stl_59 stl_600" style="word-spacing:0.3133em;">&nbsp;good &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 23.6535em; left:11.4404em;"><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3165em;">one for</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.4005em;">&nbsp;r</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3395em;">&nbsp;ep</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3395em;">&nbsp;l</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3395em;">&nbsp;i</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3395em;">&nbsp;c</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3395em;">&nbsp;a</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3395em;">&nbsp;t</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3395em;">&nbsp;io</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3395em;">&nbsp;n</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.0425em;">&nbsp;,</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.4035em;">&nbsp;i</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.1975em;">&nbsp;.</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.2745em;">&nbsp;e</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.2735em;">&nbsp;.</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.4505em;">&nbsp;i</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.2945em;">&nbsp;f</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.4235em;">&nbsp;there i</span><span class="stl_58 stl_59 stl_894" style="word-spacing:-0.3285em;">&nbsp;s</span><span class="stl_58 stl_59 stl_894" style="word-spacing:0.3825em;">&nbsp;another &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:12.1742em;"><span class="stl_58 stl_59 stl_1141" style="word-spacing:-0.3853em;">s l</span><span class="stl_58 stl_59 stl_1141" style="word-spacing:-0.3843em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1141" style="word-spacing:-0.3843em;">&nbsp;v</span><span class="stl_58 stl_59 stl_1141" style="word-spacing:-0.3853em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1141" style="word-spacing:0.3637em;">&nbsp;that i</span><span class="stl_58 stl_59 stl_1141" style="word-spacing:0.3637em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 25.646em; left:11.5226em;"><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3484em;">r e</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3484em;">&nbsp;g</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3494em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3484em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3494em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3484em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3484em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3494em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3484em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3494em;">&nbsp;g</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:0.4126em;">&nbsp;d</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3544em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3534em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3544em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3544em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3544em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3534em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3544em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3544em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3534em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:-0.3544em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:0.3796em;">&nbsp;since</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:0.3453em;">&nbsp;the server forked</span><span class="stl_58 stl_59 stl_1236" style="word-spacing:0.3453em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:12.64em;"><span class="stl_58 stl_59 stl_855" style="word-spacing:0.323em;">save */ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:10.02em;"><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.3805em;">r e</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.3795em;">&nbsp;d</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.3795em;">&nbsp;i</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.3805em;">&nbsp;s</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.3795em;">&nbsp;C</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.3795em;">&nbsp;l</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.3795em;">&nbsp;i</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.3805em;">&nbsp;e</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.3795em;">&nbsp;n</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.3795em;">&nbsp;t</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.073em;">&nbsp;* slave</span><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.073em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:10.0025em;"><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">listNode * ln</span><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:10.0633em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">l i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;I</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;r</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.773em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">检</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;测</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;是</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;否</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;已</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;经</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;申</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;请</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;全</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:9.9942em;"><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2318em;">listRewind ( server . slaves ,&amp; l i ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:9.9408em;"><span class="stl_15 stl_16 stl_759">while</span><span class="stl_15 stl_16 stl_759" style="word-spacing:-0.2586em;">&nbsp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.2586em;">((</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.198em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_759" style="word-spacing:0.172em;">&nbsp;=</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.111em;">&nbsp;lis tN</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.311em;">&nbsp;ext</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.3em;">&nbsp;(&amp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.236em;">&nbsp;l</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.246em;">&nbsp;i</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.141em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:12.0017em;z-index:653; "><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.2261em;">slave =</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1741em;">&nbsp;ln</span><span class="stl_107 stl_108 stl_1159" style="word-spacing:0.1741em;">−</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1741em;">&gt;value</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1741em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:12.03em;z-index:669; "><span class="stl_15 stl_16 stl_677" style="word-spacing:-0.1503em;">i f</span><span class="stl_15 stl_16 stl_677" style="word-spacing:0.556em;">&nbsp;</span><span class="stl_10 stl_11 stl_677" style="word-spacing:0.556em;">(</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.0993em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1707em;">&nbsp;</span><span class="stl_107 stl_108 stl_677" style="word-spacing:-0.0993em;">−</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1707em;">&gt;r</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1653em;">&nbsp;e</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1653em;">&nbsp;p</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1643em;">&nbsp;l</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1653em;">&nbsp;s</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1643em;">&nbsp;t</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1653em;">&nbsp;a</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1643em;">&nbsp;t</span><span class="stl_10 stl_11 stl_677" style="word-spacing:-0.1654em;">&nbsp;e</span><span class="stl_10 stl_11 stl_677" style="word-spacing:0.3167em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:13.4667em;"><span class="stl_10 stl_11 stl_657">REDIS_REPL_WAIT_BGSAVE_END)</span><span class="stl_10 stl_11 stl_657" style="word-spacing:0.633em;">&nbsp;</span><span class="stl_15 stl_16 stl_657" style="word-spacing:0.633em;">break</span><span class="stl_15 stl_16 stl_657" style="word-spacing:0.0889em;">&nbsp;</span><span class="stl_10 stl_11 stl_657" style="word-spacing:0.633em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 39.5868em; left:10.0375em;"><span class="stl_15 stl_16 stl_625" style="word-spacing:-0.318em;">i f</span><span class="stl_15 stl_16 stl_625" style="word-spacing:0.3884em;">&nbsp;</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.3884em;">(</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.267em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.266em;">&nbsp;)</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.266em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5901em; left:10.4132em;"><span class="stl_58 stl_59 stl_1237">/</span><span class="stl_58 stl_59 stl_1237" style="word-spacing:0.6704em;">&nbsp;</span><span class="stl_17 stl_18 stl_1237" style="word-spacing:0.6704em;">存</span><span class="stl_17 stl_18 stl_1237" style="word-spacing:0.1104em;">&nbsp;在 状 态 为</span><span class="stl_17 stl_18 stl_1237" style="word-spacing:0.5213em;">&nbsp;</span><span class="stl_58 stl_59 stl_1237" style="word-spacing:0.5213em;">REDIS_REPL_WAIT_BGSAVE_END</span><span class="stl_58 stl_59 stl_1237" style="word-spacing:0.5203em;">&nbsp;</span><span class="stl_17 stl_18 stl_1237" style="word-spacing:0.5203em;">的</span><span class="stl_17 stl_18 stl_1237" style="word-spacing:0.1101em;">&nbsp;从 机</span><span class="stl_17 stl_18 stl_1237" style="word-spacing:0.7623em;">&nbsp;</span><span class="stl_58 stl_59 stl_1237" style="word-spacing:0.7623em;">sl</span><span class="stl_58 stl_59 stl_1237" style="word-spacing:0.0613em;">&nbsp;a v</span><span class="stl_58 stl_59 stl_1237" style="word-spacing:0.0613em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 41.8065em; left:11.6342em;"><span class="stl_17 stl_18 stl_07">，</span></div>
					<div class="stl_01" style="top: 42.5826em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:10.4132em;"><span class="stl_58 stl_59 stl_1238">/</span><span class="stl_58 stl_59 stl_1238" style="word-spacing:0.6889em;">&nbsp;</span><span class="stl_17 stl_18 stl_1238" style="word-spacing:0.6889em;">就</span><span class="stl_17 stl_18 stl_1238" style="word-spacing:0.1288em;">&nbsp;将 此 从 机</span><span class="stl_17 stl_18 stl_1238" style="word-spacing:0.6993em;">&nbsp;</span><span class="stl_58 stl_59 stl_1238" style="word-spacing:0.6993em;">c</span><span class="stl_58 stl_59 stl_1238" style="word-spacing:0.6996em;">&nbsp;</span><span class="stl_17 stl_18 stl_1238" style="word-spacing:0.6996em;">状</span><span class="stl_17 stl_18 stl_1238" style="word-spacing:0.1288em;">&nbsp;态 设 置 为</span><span class="stl_17 stl_18 stl_1238" style="word-spacing:0.5398em;">&nbsp;</span><span class="stl_58 stl_59 stl_1238" style="word-spacing:0.5398em;">REDIS_REPL_WAIT_BGSAVE_END &nbsp;</span></div>
					<div class="stl_01" style="top: 43.7998em; left:11.6342em;"><span class="stl_17 stl_18 stl_07">，</span></div>
					<div class="stl_01" style="top: 44.5752em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5718em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:10.4132em;"><span class="stl_58 stl_59 stl_1239">/</span><span class="stl_58 stl_59 stl_1239" style="word-spacing:0.5887em;">&nbsp;</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.5887em;">从</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.0284em;">&nbsp;而 在</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.4427em;">&nbsp;</span><span class="stl_58 stl_59 stl_1239" style="word-spacing:0.4427em;">BGSAVE</span><span class="stl_58 stl_59 stl_1239" style="word-spacing:0.4411em;">&nbsp;</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.4411em;">进</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.0289em;">&nbsp;程 结 束</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.0619em;">&nbsp;后， 可</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.0289em;">&nbsp;以 发 送</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.4318em;">&nbsp;</span><span class="stl_58 stl_59 stl_1239" style="word-spacing:0.4318em;">RDB</span><span class="stl_58 stl_59 stl_1239" style="word-spacing:0.4305em;">&nbsp;</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.4305em;">文</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.0619em;">&nbsp;件， &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;将</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6016em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6016em;">s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.1em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.1em;">&nbsp;a</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.099em;">&nbsp;v</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.099em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6011em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6011em;">中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;更</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;新</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;复</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;制</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;此</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5205em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5205em;">c</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.0807em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5205em;">。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.3. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">全同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">141 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:12.4057em;"><span class="stl_58 stl_59 stl_96" style="word-spacing:0.2718em;">* Perfect</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.1202em;">&nbsp;,</span><span class="stl_58 stl_59 stl_96" style="word-spacing:0.3588em;">&nbsp;the server</span><span class="stl_58 stl_59 stl_96" style="word-spacing:0.3928em;">&nbsp;i</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3462em;">&nbsp;s</span><span class="stl_58 stl_59 stl_96" style="word-spacing:0.3873em;">&nbsp;already r</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3412em;">&nbsp;e</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3402em;">&nbsp;g</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3402em;">&nbsp;i</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3412em;">&nbsp;s</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3402em;">&nbsp;t</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3412em;">&nbsp;e</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3402em;">&nbsp;r</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3402em;">&nbsp;i</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3412em;">&nbsp;n</span><span class="stl_58 stl_59 stl_96" style="word-spacing:-0.3412em;">&nbsp;g &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:13.6775em;"><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.369em;">d i</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.369em;">&nbsp;f</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.369em;">&nbsp;f</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.368em;">&nbsp;e</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.369em;">&nbsp;r</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.369em;">&nbsp;e</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.369em;">&nbsp;n</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.368em;">&nbsp;c</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.369em;">&nbsp;e</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.369em;">&nbsp;s</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.371em;">&nbsp;for &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:13.4694em;"><span class="stl_58 stl_59 stl_583" style="word-spacing:0.3916em;">another s</span><span class="stl_58 stl_59 stl_583" style="word-spacing:-0.3204em;">&nbsp;l</span><span class="stl_58 stl_59 stl_583" style="word-spacing:-0.3194em;">&nbsp;a</span><span class="stl_58 stl_59 stl_583" style="word-spacing:-0.3194em;">&nbsp;ve</span><span class="stl_58 stl_59 stl_583" style="word-spacing:-0.1724em;">&nbsp;.</span><span class="stl_58 stl_59 stl_583" style="word-spacing:0.3761em;">&nbsp;Set the</span><span class="stl_58 stl_59 stl_583" style="word-spacing:0.4146em;">&nbsp;r</span><span class="stl_58 stl_59 stl_583" style="word-spacing:-0.3084em;">&nbsp;i</span><span class="stl_58 stl_59 stl_583" style="word-spacing:-0.3094em;">&nbsp;g</span><span class="stl_58 stl_59 stl_583" style="word-spacing:-0.3094em;">&nbsp;h</span><span class="stl_58 stl_59 stl_583" style="word-spacing:-0.3084em;">&nbsp;t</span><span class="stl_58 stl_59 stl_583" style="word-spacing:0.4276em;">&nbsp;state</span><span class="stl_58 stl_59 stl_583" style="word-spacing:-0.0504em;">&nbsp;,</span><span class="stl_58 stl_59 stl_583" style="word-spacing:0.3296em;">&nbsp;and</span><span class="stl_58 stl_59 stl_583" style="word-spacing:0.2706em;">&nbsp;copy &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:14.145em;"><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.4273em;">the b</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.2967em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.2957em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.2967em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.2967em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.2967em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.1497em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.3513em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">将</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;其</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;他</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;上</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;待</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;回</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;复</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;复</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;制</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.52em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.05em;">c &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:11.9758em;"><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.24em;">copyClientOutputBuffer ( c , slave ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:12.4057em;"><span class="stl_58 stl_59 stl_385">/</span><span class="stl_58 stl_59 stl_385" style="word-spacing:0.5564em;">&nbsp;</span><span class="stl_17 stl_18 stl_385" style="word-spacing:0.5564em;">修</span><span class="stl_17 stl_18 stl_385" style="word-spacing:-0.0044em;">&nbsp;改</span><span class="stl_17 stl_18 stl_385" style="word-spacing:-0.0034em;">&nbsp;从</span><span class="stl_17 stl_18 stl_385" style="word-spacing:-0.0034em;">&nbsp;机</span><span class="stl_17 stl_18 stl_385" style="word-spacing:0.5674em;">&nbsp;</span><span class="stl_58 stl_59 stl_385" style="word-spacing:0.5674em;">c</span><span class="stl_58 stl_59 stl_385" style="word-spacing:0.5661em;">&nbsp;</span><span class="stl_17 stl_18 stl_385" style="word-spacing:0.5661em;">状</span><span class="stl_17 stl_18 stl_385" style="word-spacing:-0.0034em;">&nbsp;态</span><span class="stl_17 stl_18 stl_385" style="word-spacing:-0.0034em;">&nbsp;为</span><span class="stl_17 stl_18 stl_385" style="word-spacing:0.0301em;">&nbsp;「等 待</span><span class="stl_17 stl_18 stl_385" style="word-spacing:0.4097em;">&nbsp;</span><span class="stl_58 stl_59 stl_385" style="word-spacing:0.4097em;">BGSAVE</span><span class="stl_58 stl_59 stl_385" style="word-spacing:0.4088em;">&nbsp;</span><span class="stl_17 stl_18 stl_385" style="word-spacing:0.4088em;">进</span><span class="stl_17 stl_18 stl_385" style="word-spacing:-0.0034em;">&nbsp;程</span><span class="stl_17 stl_18 stl_385" style="word-spacing:-0.0034em;">&nbsp;结</span><span class="stl_17 stl_18 stl_385" style="word-spacing:0.0296em;">&nbsp;束」 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:11.9267em;z-index:193; "><span class="stl_10 stl_11 stl_1240" style="word-spacing:0.073em;">c</span><span class="stl_107 stl_108 stl_1240" style="word-spacing:0.073em;">−</span><span class="stl_10 stl_11 stl_1240" style="word-spacing:0.073em;">&gt;r e p l s t a t e</span><span class="stl_10 stl_11 stl_1240" style="word-spacing:0.5836em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1240" style="word-spacing:0.3296em;">&nbsp;REDIS_REPL_WAIT_BGSAVE_END; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.9858em;"><span class="stl_10 stl_11 stl_1241" style="word-spacing:-0.1204em;">redisLog (REDIS_NOTICE, ”Waiting␣ fo r ␣end␣ of ␣BGSAVE␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:13.6683em;"><span class="stl_10 stl_11 stl_1242" style="word-spacing:-0.0613em;">fo r</span><span class="stl_10 stl_11 stl_1242" style="word-spacing:-0.0123em;">&nbsp;␣SYNC”</span><span class="stl_10 stl_11 stl_1242" style="word-spacing:-0.0433em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1242" style="word-spacing:-0.0433em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:10.4132em;"><span class="stl_58 stl_59 stl_1243">/</span><span class="stl_58 stl_59 stl_1243" style="word-spacing:0.6717em;">&nbsp;</span><span class="stl_17 stl_18 stl_1243" style="word-spacing:0.6717em;">不</span><span class="stl_17 stl_18 stl_1243" style="word-spacing:0.1117em;">&nbsp;存 在 状 态 为</span><span class="stl_17 stl_18 stl_1243" style="word-spacing:0.5231em;">&nbsp;</span><span class="stl_58 stl_59 stl_1243" style="word-spacing:0.5231em;">REDIS_REPL_WAIT_BGSAVE_END</span><span class="stl_58 stl_59 stl_1243" style="word-spacing:0.5206em;">&nbsp;</span><span class="stl_17 stl_18 stl_1243" style="word-spacing:0.5206em;">的</span><span class="stl_17 stl_18 stl_1243" style="word-spacing:0.1119em;">&nbsp;从</span><span class="stl_17 stl_18 stl_1243" style="word-spacing:0.1454em;">&nbsp;机，</span><span class="stl_17 stl_18 stl_1243" style="word-spacing:0.1454em;">&nbsp;就 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:11.6342em;"><span class="stl_17 stl_18 stl_1244" style="word-spacing:0.1226em;">将 此 从 机</span><span class="stl_17 stl_18 stl_1244" style="word-spacing:0.6938em;">&nbsp;</span><span class="stl_58 stl_59 stl_1244" style="word-spacing:0.6938em;">c</span><span class="stl_58 stl_59 stl_1244" style="word-spacing:0.6924em;">&nbsp;</span><span class="stl_17 stl_18 stl_1244" style="word-spacing:0.6924em;">状</span><span class="stl_17 stl_18 stl_1244" style="word-spacing:0.1229em;">&nbsp;态 设 置 为</span><span class="stl_17 stl_18 stl_1244" style="word-spacing:0.5366em;">&nbsp;</span><span class="stl_58 stl_59 stl_1244" style="word-spacing:0.5366em;">REDIS_REPL_WAIT_BGSAVE_START &nbsp;</span></div>
					<div class="stl_01" style="top: 20.8857em; left:11.6342em;"><span class="stl_17 stl_18 stl_07">，</span></div>
					<div class="stl_01" style="top: 20.6651em; left:12.6296em;"><span class="stl_17 stl_18 stl_1245" style="word-spacing:0.0493em;">即 等 待 新 的</span><span class="stl_17 stl_18 stl_1245" style="word-spacing:0.4635em;">&nbsp;</span><span class="stl_58 stl_59 stl_1245" style="word-spacing:0.4635em;">BGSAVE</span><span class="stl_58 stl_59 stl_1245" style="word-spacing:0.4626em;">&nbsp;</span><span class="stl_17 stl_18 stl_1245" style="word-spacing:0.4626em;">进</span><span class="stl_17 stl_18 stl_1245" style="word-spacing:0.0493em;">&nbsp;程 的 开</span><span class="stl_17 stl_18 stl_1245" style="word-spacing:0.0823em;">&nbsp;启。 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:12.4057em;"><span class="stl_58 stl_59 stl_1246">/</span><span class="stl_58 stl_59 stl_1246" style="word-spacing:0.557em;">&nbsp;</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:0.557em;">修</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:-0.0039em;">&nbsp;改</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:-0.0029em;">&nbsp;状</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:-0.0029em;">&nbsp;态</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:-0.0029em;">&nbsp;为</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:0.0306em;">&nbsp;「等 待</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:0.4112em;">&nbsp;</span><span class="stl_58 stl_59 stl_1246" style="word-spacing:0.4112em;">BGSAVE</span><span class="stl_58 stl_59 stl_1246" style="word-spacing:0.4104em;">&nbsp;</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:0.4104em;">进</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:-0.0029em;">&nbsp;程</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:-0.0029em;">&nbsp;开</span><span class="stl_17 stl_18 stl_1246" style="word-spacing:0.0301em;">&nbsp;始」 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:12.4057em;"><span class="stl_58 stl_59 stl_194" style="word-spacing:0.2796em;">* No</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.2476em;">&nbsp;way</span><span class="stl_58 stl_59 stl_194" style="word-spacing:-0.1594em;">&nbsp;,</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.4096em;">&nbsp;we</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.3456em;">&nbsp;need</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.4566em;">&nbsp;to wait</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.4929em;">&nbsp;for the next</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.2651em;">&nbsp;BGSAVE</span><span class="stl_58 stl_59 stl_194" style="word-spacing:0.2651em;">&nbsp;in &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:14.135em;"><span class="stl_58 stl_59 stl_327" style="word-spacing:0.3538em;">order to &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 25.646em; left:13.5184em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.201em;">r e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.2em;">&nbsp;g</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.2em;">&nbsp;i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.2em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.2em;">&nbsp;t</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.201em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.2em;">&nbsp;r</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.561em;">&nbsp;d</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.209em;">&nbsp;i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.209em;">&nbsp;f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.209em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;r</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.209em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.209em;">&nbsp;n</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.209em;">&nbsp;c</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.208em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.209em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.45em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:11.9267em;z-index:482; "><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.0687em;">c</span><span class="stl_107 stl_108 stl_1247" style="word-spacing:0.0687em;">−</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.0687em;">&gt;r e p l s t a t e</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.5793em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.3293em;">&nbsp;REDIS_REPL_WAIT_BGSAVE_START; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:11.9858em;"><span class="stl_10 stl_11 stl_1248" style="word-spacing:-0.1199em;">redisLog (REDIS_NOTICE, ”Waiting␣ fo r ␣next␣BGSAVE␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:13.6683em;"><span class="stl_10 stl_11 stl_1249" style="word-spacing:0.0052em;">f o</span><span class="stl_10 stl_11 stl_1249" style="word-spacing:0.0062em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1249" style="word-spacing:0.0552em;">&nbsp;␣SYNC”</span><span class="stl_10 stl_11 stl_1249" style="word-spacing:0.0242em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1249" style="word-spacing:0.0242em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 30.626em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 31.6235em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.621em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4207em;"><span class="stl_58 stl_59 stl_1250">/</span><span class="stl_58 stl_59 stl_1250" style="word-spacing:0.6422em;">&nbsp;</span><span class="stl_17 stl_18 stl_1250" style="word-spacing:0.6422em;">不</span><span class="stl_17 stl_18 stl_1250" style="word-spacing:0.0819em;">&nbsp;存 在</span><span class="stl_17 stl_18 stl_1250" style="word-spacing:0.4962em;">&nbsp;</span><span class="stl_58 stl_59 stl_1250" style="word-spacing:0.4962em;">BGSAVE</span><span class="stl_58 stl_59 stl_1250" style="word-spacing:0.4956em;">&nbsp;</span><span class="stl_17 stl_18 stl_1250" style="word-spacing:0.4956em;">后</span><span class="stl_17 stl_18 stl_1250" style="word-spacing:0.0824em;">&nbsp;台 进</span><span class="stl_17 stl_18 stl_1250" style="word-spacing:0.1154em;">&nbsp;程， 启</span><span class="stl_17 stl_18 stl_1250" style="word-spacing:0.0824em;">&nbsp;动 一 个 新 的</span><span class="stl_17 stl_18 stl_1250" style="word-spacing:0.4957em;">&nbsp;</span><span class="stl_58 stl_59 stl_1250" style="word-spacing:0.4957em;">BGSAVE</span><span class="stl_58 stl_59 stl_1250" style="word-spacing:0.4956em;">&nbsp;</span><span class="stl_17 stl_18 stl_1250" style="word-spacing:0.4956em;">进</span><span class="stl_17 stl_18 stl_1250" style="word-spacing:0.4956em;">&nbsp;程 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:10.4133em;"><span class="stl_58 stl_59 stl_440" style="word-spacing:0.3083em;">* Ok</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.2733em;">&nbsp;we</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.3373em;">&nbsp;don</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.0927em;">&nbsp;’</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1097em;">&nbsp;t</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.4843em;">&nbsp;have</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.3943em;">&nbsp;a</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.2163em;">&nbsp;BGSAVE</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.2823em;">&nbsp;in</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.4883em;">&nbsp;progress</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.0443em;">&nbsp;,</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.5923em;">&nbsp;l</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1537em;">&nbsp;e</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1537em;">&nbsp;t</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.0532em;">&nbsp;’ s</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.5193em;">&nbsp;s</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1757em;">&nbsp;t</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1767em;">&nbsp;a</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1757em;">&nbsp;r</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1757em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:12.105em;"><span class="stl_58 stl_59 stl_164" style="word-spacing:0.348em;">one */ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:9.9933em;"><span class="stl_10 stl_11 stl_1251" style="word-spacing:-0.0862em;">redisLog (REDIS_NOTICE, ” Starting ␣BGSAVE␣ fo r ␣SYNC” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:10.0375em;"><span class="stl_15 stl_16 stl_789" style="word-spacing:-0.2645em;">i f</span><span class="stl_15 stl_16 stl_789" style="word-spacing:0.4419em;">&nbsp;</span><span class="stl_10 stl_11 stl_789" style="word-spacing:0.4419em;">(</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.2565em;">&nbsp;rdbSaveBackground</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.2555em;">&nbsp;(</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.1915em;">&nbsp;server</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.1365em;">&nbsp;.</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.1785em;">&nbsp;rdb_filename</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.2345em;">&nbsp;)</span><span class="stl_10 stl_11 stl_789" style="word-spacing:0.3125em;">&nbsp;!= &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:11.495em;"><span class="stl_10 stl_11 stl_1252" style="word-spacing:0.6128em;">REDIS_OK) { &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:11.9858em;"><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.1489em;">redisLog (REDIS_NOTICE,</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.1529em;">&nbsp;”</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.1769em;">&nbsp;Replication</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.1909em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.1729em;">&nbsp;f</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.2229em;">&nbsp;a</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.2239em;">&nbsp;i</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.2229em;">&nbsp;l</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.2229em;">&nbsp;e</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.2229em;">&nbsp;d</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.0748em;">&nbsp;, ␣can</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.0879em;">&nbsp;’</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.1649em;">&nbsp;t</span><span class="stl_10 stl_11 stl_884" style="word-spacing:-0.1649em;">&nbsp;␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:13.4692em;"><span class="stl_10 stl_11 stl_1253" style="word-spacing:0.0777em;">BGSAVE” )</span><span class="stl_10 stl_11 stl_1253" style="word-spacing:0.0777em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:11.96em;"><span class="stl_10 stl_11 stl_700" style="word-spacing:-0.2489em;">addReplyError ( c , ”Unable␣ to ␣perform␣background␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:13.6325em;"><span class="stl_10 stl_11 stl_152" style="word-spacing:-0.2613em;">save ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:11.9308em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 45.5718em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5718em; left:10.4132em;"><span class="stl_58 stl_59 stl_1254">/</span><span class="stl_58 stl_59 stl_1254" style="word-spacing:0.6813em;">&nbsp;</span><span class="stl_17 stl_18 stl_1254" style="word-spacing:0.6813em;">将</span><span class="stl_17 stl_18 stl_1254" style="word-spacing:0.1212em;">&nbsp;此 从 机</span><span class="stl_17 stl_18 stl_1254" style="word-spacing:0.6924em;">&nbsp;</span><span class="stl_58 stl_59 stl_1254" style="word-spacing:0.6924em;">c</span><span class="stl_58 stl_59 stl_1254" style="word-spacing:0.6911em;">&nbsp;</span><span class="stl_17 stl_18 stl_1254" style="word-spacing:0.6911em;">状</span><span class="stl_17 stl_18 stl_1254" style="word-spacing:0.1215em;">&nbsp;态 设 置 为</span><span class="stl_17 stl_18 stl_1254" style="word-spacing:0.5322em;">&nbsp;</span><span class="stl_58 stl_59 stl_1254" style="word-spacing:0.5322em;">REDIS_REPL_WAIT_BGSAVE_END</span><span class="stl_17 stl_18 stl_1254" style="word-spacing:0.5322em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:11.6342em;"><span class="stl_17 stl_18 stl_1255" style="word-spacing:0.0288em;">从 而 在</span><span class="stl_17 stl_18 stl_1255" style="word-spacing:0.4442em;">&nbsp;</span><span class="stl_58 stl_59 stl_1255" style="word-spacing:0.4442em;">BGSAVE</span><span class="stl_58 stl_59 stl_1255" style="word-spacing:0.4426em;">&nbsp;</span><span class="stl_17 stl_18 stl_1255" style="word-spacing:0.4426em;">进</span><span class="stl_17 stl_18 stl_1255" style="word-spacing:0.029em;">&nbsp;程 结 束</span><span class="stl_17 stl_18 stl_1255" style="word-spacing:0.0623em;">&nbsp;后， 可</span><span class="stl_17 stl_18 stl_1255" style="word-spacing:0.0293em;">&nbsp;以 发 送</span><span class="stl_17 stl_18 stl_1255" style="word-spacing:0.4322em;">&nbsp;</span><span class="stl_58 stl_59 stl_1255" style="word-spacing:0.4322em;">RDB</span><span class="stl_58 stl_59 stl_1255" style="word-spacing:0.4319em;">&nbsp;</span><span class="stl_17 stl_18 stl_1255" style="word-spacing:0.4319em;">文</span><span class="stl_17 stl_18 stl_1255" style="word-spacing:0.0623em;">&nbsp;件， 同</span><span class="stl_17 stl_18 stl_1255" style="word-spacing:0.0623em;">&nbsp;时 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">142 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:11.6342em;"><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.351em;">将 从</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.35em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.0983em;">&nbsp;</span><span class="stl_58 stl_59 stl_1256" style="word-spacing:-0.0983em;">s l</span><span class="stl_58 stl_59 stl_1256" style="word-spacing:-0.399em;">&nbsp;av</span><span class="stl_58 stl_59 stl_1256" style="word-spacing:-0.399em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1256" style="word-spacing:-0.0499em;">&nbsp;</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.0499em;">中 的</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.35em;">&nbsp;更</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.35em;">&nbsp;新</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.35em;">&nbsp;复</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.35em;">&nbsp;制</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.35em;">&nbsp;到</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.35em;">&nbsp;此</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.35em;">&nbsp;从</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:-0.35em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:0.2205em;">&nbsp;</span><span class="stl_58 stl_59 stl_1256" style="word-spacing:0.2205em;">c</span><span class="stl_58 stl_59 stl_1256" style="word-spacing:-0.3797em;">&nbsp;</span><span class="stl_17 stl_18 stl_1256" style="word-spacing:0.2205em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.9342em;z-index:39; "><span class="stl_10 stl_11 stl_1240" style="word-spacing:0.073em;">c</span><span class="stl_107 stl_108 stl_1240" style="word-spacing:0.073em;">−</span><span class="stl_10 stl_11 stl_1240" style="word-spacing:0.073em;">&gt;r e p l s t a t e</span><span class="stl_10 stl_11 stl_1240" style="word-spacing:0.5836em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1240" style="word-spacing:0.3296em;">&nbsp;REDIS_REPL_WAIT_BGSAVE_END; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">清</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;理</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;脚</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;本</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.08em;">&nbsp;存 ？</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.09em;">&nbsp;？</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.09em;">&nbsp;？ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.4133em;"><span class="stl_58 stl_59 stl_472" style="word-spacing:0.3132em;">* Flush</span><span class="stl_58 stl_59 stl_472" style="word-spacing:0.3782em;">&nbsp;the</span><span class="stl_58 stl_59 stl_472" style="word-spacing:0.4382em;">&nbsp;s</span><span class="stl_58 stl_59 stl_472" style="word-spacing:-0.2868em;">&nbsp;c</span><span class="stl_58 stl_59 stl_472" style="word-spacing:-0.2858em;">&nbsp;r</span><span class="stl_58 stl_59 stl_472" style="word-spacing:-0.2868em;">&nbsp;i</span><span class="stl_58 stl_59 stl_472" style="word-spacing:-0.2858em;">&nbsp;p</span><span class="stl_58 stl_59 stl_472" style="word-spacing:-0.2858em;">&nbsp;t</span><span class="stl_58 stl_59 stl_472" style="word-spacing:0.4042em;">&nbsp;cache for the</span><span class="stl_58 stl_59 stl_472" style="word-spacing:0.3142em;">&nbsp;new s</span><span class="stl_58 stl_59 stl_472" style="word-spacing:-0.3008em;">&nbsp;l</span><span class="stl_58 stl_59 stl_472" style="word-spacing:-0.3018em;">&nbsp;a</span><span class="stl_58 stl_59 stl_472" style="word-spacing:-0.3008em;">&nbsp;v</span><span class="stl_58 stl_59 stl_472" style="word-spacing:-0.3008em;">&nbsp;e</span><span class="stl_58 stl_59 stl_472" style="word-spacing:-0.1548em;">&nbsp;.</span><span class="stl_58 stl_59 stl_472" style="word-spacing:0.3542em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:10.005em;"><span class="stl_10 stl_11 stl_863" style="word-spacing:-0.2359em;">replicationScriptCacheFlush () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.6843em; left:8.045em;"><span class="stl_15 stl_16 stl_341" style="word-spacing:-0.3042em;">i f</span><span class="stl_15 stl_16 stl_341" style="word-spacing:0.4022em;">&nbsp;</span><span class="stl_10 stl_11 stl_341" style="word-spacing:0.4022em;">(</span><span class="stl_10 stl_11 stl_341" style="word-spacing:-0.2312em;">&nbsp;server</span><span class="stl_10 stl_11 stl_341" style="word-spacing:-0.1752em;">&nbsp;.</span><span class="stl_10 stl_11 stl_341" style="word-spacing:-0.2102em;">&nbsp;repl_disable_tcp_nodelay</span><span class="stl_10 stl_11 stl_341" style="word-spacing:-0.2102em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:9.9667em;z-index:221; "><span class="stl_10 stl_11 stl_135" style="word-spacing:-0.1636em;">anetDisableTcpNoDelay (NULL,</span><span class="stl_10 stl_11 stl_135" style="word-spacing:-0.1636em;">&nbsp;c</span><span class="stl_107 stl_108 stl_135" style="word-spacing:-0.1636em;">−</span><span class="stl_10 stl_11 stl_135" style="word-spacing:0.4524em;">&gt;fd</span><span class="stl_10 stl_11 stl_135" style="word-spacing:-0.1426em;">&nbsp;)</span><span class="stl_10 stl_11 stl_135" style="word-spacing:-0.0936em;">&nbsp;;</span><span class="stl_10 stl_11 stl_135" style="word-spacing:0.4592em;">&nbsp;</span><span class="stl_58 stl_59 stl_135" style="word-spacing:0.4592em;">/*</span><span class="stl_58 stl_59 stl_135" style="word-spacing:0.2954em;">&nbsp;Non</span><span class="stl_58 stl_59 stl_135" style="word-spacing:0.4274em;">&nbsp;c</span><span class="stl_58 stl_59 stl_135" style="word-spacing:-0.1666em;">&nbsp;r</span><span class="stl_58 stl_59 stl_135" style="word-spacing:-0.1666em;">&nbsp;i</span><span class="stl_58 stl_59 stl_135" style="word-spacing:-0.1666em;">&nbsp;t</span><span class="stl_58 stl_59 stl_135" style="word-spacing:-0.1666em;">&nbsp;i</span><span class="stl_58 stl_59 stl_135" style="word-spacing:-0.1666em;">&nbsp;c</span><span class="stl_58 stl_59 stl_135" style="word-spacing:-0.1666em;">&nbsp;a</span><span class="stl_58 stl_59 stl_135" style="word-spacing:-0.1666em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:11.7133em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.175em;">i f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.612em;">&nbsp;i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.183em;">&nbsp;t</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.619em;">&nbsp;f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.169em;">&nbsp;a</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.168em;">&nbsp;i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.168em;">&nbsp;l</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.169em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.021em;">&nbsp;.</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.435em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:7.9408em;z-index:264; "><span class="stl_10 stl_11 stl_1257" style="word-spacing:0.2432em;">c</span><span class="stl_107 stl_108 stl_1257" style="word-spacing:0.2432em;">−</span><span class="stl_10 stl_11 stl_1257" style="word-spacing:0.2432em;">&gt;repldbfd =</span><span class="stl_10 stl_11 stl_1257" style="word-spacing:0.2135em;">&nbsp;</span><span class="stl_107 stl_108 stl_1257" style="word-spacing:0.2432em;">−</span><span class="stl_10 stl_11 stl_1257" style="word-spacing:0.2135em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:7.9408em;z-index:268; "><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0215em;">c</span><span class="stl_107 stl_108 stl_1258" style="word-spacing:-0.0215em;">−</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0215em;">&gt;f l</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0225em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0225em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0215em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:0.6255em;">&nbsp;|=</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:0.4045em;">&nbsp;REDIS_SLAVE; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:8.0175em;"><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1211em;">server .</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1171em;">&nbsp;slaveseldb</span><span class="stl_10 stl_11 stl_80" style="word-spacing:0.2329em;">&nbsp;=</span><span class="stl_10 stl_11 stl_80" style="word-spacing:0.1821em;">&nbsp;</span><span class="stl_107 stl_108 stl_80" style="word-spacing:0.2329em;">−</span><span class="stl_10 stl_11 stl_80" style="word-spacing:0.1821em;">1;</span><span class="stl_10 stl_11 stl_80" style="word-spacing:0.2825em;">&nbsp;</span><span class="stl_58 stl_59 stl_80" style="word-spacing:0.2825em;">/*</span><span class="stl_58 stl_59 stl_80" style="word-spacing:0.3159em;">&nbsp;Force</span><span class="stl_58 stl_59 stl_80" style="word-spacing:0.3809em;">&nbsp;to re</span><span class="stl_107 stl_108 stl_80" style="word-spacing:0.3809em;">−</span><span class="stl_58 stl_59 stl_80" style="word-spacing:0.3809em;">emit the</span><span class="stl_58 stl_59 stl_80" style="word-spacing:0.2449em;">&nbsp;SELECT &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:9.5592em;"><span class="stl_58 stl_59 stl_354" style="word-spacing:0.5027em;">command. */ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:7.99em;"><span class="stl_10 stl_11 stl_1259" style="word-spacing:-0.2215em;">listAddNodeTail ( server . slaves , c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:8.045em;"><span class="stl_15 stl_16 stl_474" style="word-spacing:-0.3084em;">i f</span><span class="stl_15 stl_16 stl_474" style="word-spacing:0.398em;">&nbsp;</span><span class="stl_10 stl_11 stl_474" style="word-spacing:0.398em;">(</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.2344em;">&nbsp;listLength</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.2344em;">&nbsp;(</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.2354em;">&nbsp;server</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.1794em;">&nbsp;.</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.1714em;">&nbsp;s</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3324em;">&nbsp;l</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3334em;">&nbsp;a</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3324em;">&nbsp;v</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3324em;">&nbsp;e</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.3324em;">&nbsp;s</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.2274em;">&nbsp;)</span><span class="stl_10 stl_11 stl_474" style="word-spacing:0.1026em;">&nbsp;==</span><span class="stl_10 stl_11 stl_474" style="word-spacing:0.0466em;">&nbsp;1 &amp;&amp;</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.0408em;">&nbsp;server .</span><span class="stl_10 stl_11 stl_474" style="word-spacing:-0.2094em;">&nbsp;repl_backlog &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:9.9583em;"><span class="stl_10 stl_11 stl_07">=</span></div>
					<div class="stl_01" style="top: 22.656em; left:10.5063em;"><span class="stl_10 stl_11 stl_82" style="word-spacing:0.2475em;">= NULL) &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:10.0025em;"><span class="stl_10 stl_11 stl_877" style="word-spacing:-0.231em;">createReplicationBacklog () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:7.9458em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 27.6385em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:6.4282em;"><span class="stl_58 stl_59 stl_1245" style="word-spacing:0.4223em;">/ BGSAVE</span><span class="stl_58 stl_59 stl_1245" style="word-spacing:0.4627em;">&nbsp;</span><span class="stl_17 stl_18 stl_1245" style="word-spacing:0.4627em;">结</span><span class="stl_17 stl_18 stl_1245" style="word-spacing:0.0483em;">&nbsp;束</span><span class="stl_17 stl_18 stl_1245" style="word-spacing:0.0828em;">&nbsp;后， 会</span><span class="stl_17 stl_18 stl_1245" style="word-spacing:0.0493em;">&nbsp;调</span><span class="stl_17 stl_18 stl_1245" style="word-spacing:0.0493em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:6.4282em;"><span class="stl_58 stl_59 stl_588" style="word-spacing:0.1924em;">* A</span><span class="stl_58 stl_59 stl_588" style="word-spacing:0.2344em;">&nbsp;background</span><span class="stl_58 stl_59 stl_588" style="word-spacing:0.4334em;">&nbsp;saving</span><span class="stl_58 stl_59 stl_588" style="word-spacing:0.4914em;">&nbsp;c</span><span class="stl_58 stl_59 stl_588" style="word-spacing:-0.2356em;">&nbsp;h</span><span class="stl_58 stl_59 stl_588" style="word-spacing:-0.2346em;">&nbsp;i</span><span class="stl_58 stl_59 stl_588" style="word-spacing:-0.2356em;">&nbsp;l</span><span class="stl_58 stl_59 stl_588" style="word-spacing:-0.2356em;">&nbsp;d</span><span class="stl_58 stl_59 stl_588" style="word-spacing:0.4389em;">&nbsp;(BGSAVE) terminated</span><span class="stl_58 stl_59 stl_588" style="word-spacing:0.5104em;">&nbsp;i</span><span class="stl_58 stl_59 stl_588" style="word-spacing:-0.2066em;">&nbsp;t</span><span class="stl_58 stl_59 stl_588" style="word-spacing:-0.2066em;">&nbsp;s</span><span class="stl_58 stl_59 stl_588" style="word-spacing:0.4624em;">&nbsp;work</span><span class="stl_58 stl_59 stl_588" style="word-spacing:0.4624em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.6317em;"><span class="stl_58 stl_59 stl_469" style="word-spacing:0.4457em;">Handle t</span><span class="stl_58 stl_59 stl_469" style="word-spacing:-0.2343em;">&nbsp;h</span><span class="stl_58 stl_59 stl_469" style="word-spacing:-0.2343em;">&nbsp;i</span><span class="stl_58 stl_59 stl_469" style="word-spacing:-0.2343em;">&nbsp;s</span><span class="stl_58 stl_59 stl_469" style="word-spacing:-0.0873em;">&nbsp;.</span><span class="stl_58 stl_59 stl_469" style="word-spacing:0.4037em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:5.9483em;"><span class="stl_15 stl_16 stl_557">void</span><span class="stl_15 stl_16 stl_557" style="word-spacing:0.2932em;">&nbsp;</span><span class="stl_10 stl_11 stl_557" style="word-spacing:0.2932em;">backgroundSaveDoneHandler</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.254em;">&nbsp;(</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.2372em;">&nbsp;</span><span class="stl_15 stl_16 stl_557" style="word-spacing:-0.2372em;">int</span><span class="stl_15 stl_16 stl_557" style="word-spacing:0.379em;">&nbsp;</span><span class="stl_10 stl_11 stl_557" style="word-spacing:0.379em;">exitcode</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.038em;">&nbsp;,</span><span class="stl_10 stl_11 stl_557" style="word-spacing:0.4181em;">&nbsp;</span><span class="stl_15 stl_16 stl_557" style="word-spacing:0.4181em;">int</span><span class="stl_15 stl_16 stl_557" style="word-spacing:0.392em;">&nbsp;</span><span class="stl_10 stl_11 stl_557" style="word-spacing:0.392em;">bysignal</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.202em;">&nbsp;)</span><span class="stl_10 stl_11 stl_557" style="word-spacing:-0.202em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6185em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 33.616em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">其</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;他</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;操</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;作 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:8.4207em;"><span class="stl_58 stl_59 stl_1071">/</span><span class="stl_58 stl_59 stl_1071" style="word-spacing:0.6822em;">&nbsp;</span><span class="stl_17 stl_18 stl_1071" style="word-spacing:0.6822em;">可</span><span class="stl_17 stl_18 stl_1071" style="word-spacing:0.1223em;">&nbsp;能 从 机 正 在 等 待</span><span class="stl_17 stl_18 stl_1071" style="word-spacing:0.5365em;">&nbsp;</span><span class="stl_58 stl_59 stl_1071" style="word-spacing:0.5365em;">BGSAVE</span><span class="stl_58 stl_59 stl_1071" style="word-spacing:0.5356em;">&nbsp;</span><span class="stl_17 stl_18 stl_1071" style="word-spacing:0.5356em;">进</span><span class="stl_17 stl_18 stl_1071" style="word-spacing:0.1224em;">&nbsp;程 的 终</span><span class="stl_17 stl_18 stl_1071" style="word-spacing:0.1224em;">&nbsp;止 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:8.4207em;"><span class="stl_58 stl_59 stl_734" style="word-spacing:0.367em;">* Possibly</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.4237em;">&nbsp;there are s</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.279em;">&nbsp;l</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.279em;">&nbsp;a</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.278em;">&nbsp;v</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.279em;">&nbsp;e</span><span class="stl_58 stl_59 stl_734" style="word-spacing:-0.278em;">&nbsp;s</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.445em;">&nbsp;waiting for</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.35em;">&nbsp;a</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.123em;">&nbsp;BGSAVE</span><span class="stl_58 stl_59 stl_734" style="word-spacing:0.188em;">&nbsp;in &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:9.6517em;"><span class="stl_58 stl_59 stl_254" style="word-spacing:0.3368em;">order to be served &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 36.6051em; left:9.4711em;"><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.1791em;">( the</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.5289em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.1951em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.1961em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.1951em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.1951em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.5429em;">&nbsp;stage</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.4659em;">&nbsp;of</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.2549em;">&nbsp;SYNC</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.2879em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.2371em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.3944em;">&nbsp;a bulk</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.4909em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.2461em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.2471em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.2461em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.2461em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.2461em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.2461em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:-0.2471em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.4809em;">&nbsp;of</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.3329em;">&nbsp;dump</span><span class="stl_58 stl_59 stl_1010" style="word-spacing:0.3329em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:10.1408em;"><span class="stl_58 stl_59 stl_831" style="word-spacing:-0.2273em;">rdb )</span><span class="stl_58 stl_59 stl_831" style="word-spacing:0.3287em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:7.9842em;"><span class="stl_10 stl_11 stl_284" style="word-spacing:-0.1871em;">updateSlavesWaitingBgsave (</span><span class="stl_10 stl_11 stl_284" style="word-spacing:-0.1551em;">&nbsp;exitcode</span><span class="stl_10 stl_11 stl_284" style="word-spacing:0.2199em;">&nbsp;==</span><span class="stl_10 stl_11 stl_284" style="word-spacing:0.1339em;">&nbsp;0</span><span class="stl_10 stl_11 stl_284" style="word-spacing:0.3179em;">&nbsp;?</span><span class="stl_10 stl_11 stl_284" style="word-spacing:0.2009em;">&nbsp;REDIS_OK</span><span class="stl_10 stl_11 stl_284" style="word-spacing:0.2009em;">&nbsp;: &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:9.5083em;"><span class="stl_10 stl_11 stl_1260" style="word-spacing:0.1139em;">REDIS_ERR) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 42.5826em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:6.4282em;"><span class="stl_58 stl_59 stl_273">/</span><span class="stl_58 stl_59 stl_273" style="word-spacing:0.3495em;">&nbsp;</span><span class="stl_17 stl_18 stl_273" style="word-spacing:0.3495em;">当</span><span class="stl_17 stl_18 stl_273" style="word-spacing:0.1926em;">&nbsp;</span><span class="stl_58 stl_59 stl_273" style="word-spacing:0.1926em;">RDB</span><span class="stl_58 stl_59 stl_273" style="word-spacing:-0.019em;">&nbsp;</span><span class="stl_17 stl_18 stl_273" style="word-spacing:-0.019em;">持 久</span><span class="stl_17 stl_18 stl_273" style="word-spacing:-0.2103em;">&nbsp;化</span><span class="stl_17 stl_18 stl_273" style="word-spacing:-0.214em;">&nbsp;</span><span class="stl_58 stl_59 stl_273" style="word-spacing:-0.214em;">(</span><span class="stl_58 stl_59 stl_273" style="word-spacing:-0.2243em;">&nbsp;backgroundSaveDoneHandler</span><span class="stl_58 stl_59 stl_273" style="word-spacing:-0.1913em;">&nbsp;()</span><span class="stl_58 stl_59 stl_273" style="word-spacing:-0.1873em;">&nbsp;)</span><span class="stl_58 stl_59 stl_273" style="word-spacing:-0.2149em;">&nbsp;</span><span class="stl_17 stl_18 stl_273" style="word-spacing:-0.2149em;">结</span><span class="stl_17 stl_18 stl_273" style="word-spacing:-0.2113em;">&nbsp;束</span><span class="stl_17 stl_18 stl_273" style="word-spacing:-0.1763em;">&nbsp;后，</span><span class="stl_17 stl_18 stl_273" style="word-spacing:-0.1773em;">&nbsp;会</span><span class="stl_17 stl_18 stl_273" style="word-spacing:-0.2103em;">&nbsp;调</span><span class="stl_17 stl_18 stl_273" style="word-spacing:-0.2103em;">&nbsp;用</span><span class="stl_17 stl_18 stl_273" style="word-spacing:-0.2103em;">&nbsp;此 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.7998em; left:7.6492em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">函 数 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.5718em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:6.4282em;"><span class="stl_58 stl_59 stl_1261" style="word-spacing:0.4132em;">/ RDB</span><span class="stl_58 stl_59 stl_1261" style="word-spacing:0.4539em;">&nbsp;</span><span class="stl_17 stl_18 stl_1261" style="word-spacing:0.4539em;">文</span><span class="stl_17 stl_18 stl_1261" style="word-spacing:0.0507em;">&nbsp;件 就</span><span class="stl_17 stl_18 stl_1261" style="word-spacing:0.0842em;">&nbsp;绪， 给</span><span class="stl_17 stl_18 stl_1261" style="word-spacing:0.0512em;">&nbsp;所 有 的 从 机 发 送</span><span class="stl_17 stl_18 stl_1261" style="word-spacing:0.4544em;">&nbsp;</span><span class="stl_58 stl_59 stl_1261" style="word-spacing:0.4544em;">RDB</span><span class="stl_58 stl_59 stl_1261" style="word-spacing:0.4538em;">&nbsp;</span><span class="stl_17 stl_18 stl_1261" style="word-spacing:0.4538em;">文</span><span class="stl_17 stl_18 stl_1261" style="word-spacing:0.4538em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:6.4282em;"><span class="stl_58 stl_59 stl_999" style="word-spacing:0.277em;">* This</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.354em;">&nbsp;function</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.424em;">&nbsp;i</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.311em;">&nbsp;s</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.452em;">&nbsp;c</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.31em;">&nbsp;a</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.309em;">&nbsp;l</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.309em;">&nbsp;l</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.309em;">&nbsp;e</span><span class="stl_58 stl_59 stl_999" style="word-spacing:-0.31em;">&nbsp;d</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.41em;">&nbsp;at</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.37em;">&nbsp;the</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.32em;">&nbsp;end of</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.3595em;">&nbsp;every</span><span class="stl_58 stl_59 stl_999" style="word-spacing:0.3595em;">&nbsp;background &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:7.6717em;"><span class="stl_58 stl_59 stl_340" style="word-spacing:-0.2304em;">saving . &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.3. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">全同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">143 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:6.9247em;"><span class="stl_58 stl_59 stl_468" style="word-spacing:0.306em;">The argument</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.412em;">&nbsp;bgsaveerr</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.494em;">&nbsp;i</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.238em;">&nbsp;s</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.2959em;">&nbsp;REDIS_OK</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.329em;">&nbsp;i</span><span class="stl_58 stl_59 stl_468" style="word-spacing:-0.2051em;">&nbsp;f</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.5189em;">&nbsp;the</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.4264em;">&nbsp;background</span><span class="stl_58 stl_59 stl_468" style="word-spacing:0.4264em;">&nbsp;saving &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.1583em;"><span class="stl_58 stl_59 stl_1262">succeeded &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7093em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 9.706em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.011em;"><span class="stl_58 stl_59 stl_1096" style="word-spacing:0.2775em;">otherwise REDIS_ERR i</span><span class="stl_58 stl_59 stl_1096" style="word-spacing:-0.2475em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1096" style="word-spacing:0.4428em;">&nbsp;passed to the function</span><span class="stl_58 stl_59 stl_1096" style="word-spacing:0.4428em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:6.9247em;"><span class="stl_58 stl_59 stl_780" style="word-spacing:0.2664em;">The goal</span><span class="stl_58 stl_59 stl_780" style="word-spacing:0.3834em;">&nbsp;of t</span><span class="stl_58 stl_59 stl_780" style="word-spacing:-0.3256em;">&nbsp;h</span><span class="stl_58 stl_59 stl_780" style="word-spacing:-0.3246em;">&nbsp;i</span><span class="stl_58 stl_59 stl_780" style="word-spacing:-0.3256em;">&nbsp;s</span><span class="stl_58 stl_59 stl_780" style="word-spacing:0.4069em;">&nbsp;function i</span><span class="stl_58 stl_59 stl_780" style="word-spacing:-0.3316em;">&nbsp;s</span><span class="stl_58 stl_59 stl_780" style="word-spacing:0.3864em;">&nbsp;to</span><span class="stl_58 stl_59 stl_780" style="word-spacing:0.3569em;">&nbsp;handle s</span><span class="stl_58 stl_59 stl_780" style="word-spacing:-0.3376em;">&nbsp;l</span><span class="stl_58 stl_59 stl_780" style="word-spacing:-0.3366em;">&nbsp;a</span><span class="stl_58 stl_59 stl_780" style="word-spacing:-0.3376em;">&nbsp;v</span><span class="stl_58 stl_59 stl_780" style="word-spacing:-0.3376em;">&nbsp;e</span><span class="stl_58 stl_59 stl_780" style="word-spacing:-0.3366em;">&nbsp;s</span><span class="stl_58 stl_59 stl_780" style="word-spacing:0.3864em;">&nbsp;waiting for</span><span class="stl_58 stl_59 stl_780" style="word-spacing:0.3864em;">&nbsp;a &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.1967em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.0904em;">s u c c e s s f u l &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 11.6985em; left:6.9853em;"><span class="stl_58 stl_59 stl_85" style="word-spacing:0.3646em;">background saving in order to perform</span><span class="stl_58 stl_59 stl_85" style="word-spacing:0.2644em;">&nbsp;non</span><span class="stl_107 stl_108 stl_85" style="word-spacing:0.2644em;">−</span><span class="stl_58 stl_59 stl_85" style="word-spacing:0.2644em;">blocking &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.6767em;"><span class="stl_58 stl_59 stl_718" style="word-spacing:-0.2273em;">synchronization .</span><span class="stl_58 stl_59 stl_718" style="word-spacing:0.2987em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:5.9483em;"><span class="stl_15 stl_16 stl_481">void</span><span class="stl_15 stl_16 stl_481" style="word-spacing:0.2987em;">&nbsp;</span><span class="stl_10 stl_11 stl_481" style="word-spacing:0.2987em;">updateSlavesWaitingBgsave</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2486em;">&nbsp;(</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2529em;">&nbsp;</span><span class="stl_15 stl_16 stl_481" style="word-spacing:-0.2529em;">int</span><span class="stl_15 stl_16 stl_481" style="word-spacing:0.3664em;">&nbsp;</span><span class="stl_10 stl_11 stl_481" style="word-spacing:0.3664em;">bgsaveerr</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2266em;">&nbsp;)</span><span class="stl_10 stl_11 stl_481" style="word-spacing:-0.2266em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.01em;"><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">listNode * ln</span><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:7.98em;"><span class="stl_15 stl_16 stl_1221">int</span><span class="stl_15 stl_16 stl_1221" style="word-spacing:0.3252em;">&nbsp;</span><span class="stl_10 stl_11 stl_1221" style="word-spacing:0.3252em;">startbgsave</span><span class="stl_10 stl_11 stl_1221" style="word-spacing:0.1397em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1221" style="word-spacing:0.1397em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:8.0708em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">l i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;I</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;r</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.773em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:8.0017em;"><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2318em;">listRewind ( server . slaves ,&amp; l i ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:7.9483em;"><span class="stl_15 stl_16 stl_759">while</span><span class="stl_15 stl_16 stl_759" style="word-spacing:-0.2586em;">&nbsp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.2586em;">((</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.199em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_759" style="word-spacing:0.173em;">&nbsp;=</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.111em;">&nbsp;listN e</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.311em;">&nbsp;xt</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.3em;">&nbsp;(&amp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.236em;">&nbsp;l</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.246em;">&nbsp;i</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.141em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:10.02em;z-index:397; "><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2731em;">r e</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2731em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2731em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2721em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.3779em;">&nbsp;*</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:-0.2361em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.2259em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1739em;">&nbsp;ln</span><span class="stl_107 stl_108 stl_1159" style="word-spacing:0.1739em;">−</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1739em;">&gt;value</span><span class="stl_10 stl_11 stl_1159" style="word-spacing:0.1739em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:10.4132em;"><span class="stl_58 stl_59 stl_1263">/</span><span class="stl_58 stl_59 stl_1263" style="word-spacing:0.6424em;">&nbsp;</span><span class="stl_17 stl_18 stl_1263" style="word-spacing:0.6424em;">等</span><span class="stl_17 stl_18 stl_1263" style="word-spacing:0.0815em;">&nbsp;待</span><span class="stl_17 stl_18 stl_1263" style="word-spacing:0.497em;">&nbsp;</span><span class="stl_58 stl_59 stl_1263" style="word-spacing:0.497em;">BGSAVE</span><span class="stl_58 stl_59 stl_1263" style="word-spacing:0.4958em;">&nbsp;</span><span class="stl_17 stl_18 stl_1263" style="word-spacing:0.4958em;">开</span><span class="stl_17 stl_18 stl_1263" style="word-spacing:0.1155em;">&nbsp;始。 调</span><span class="stl_17 stl_18 stl_1263" style="word-spacing:0.0825em;">&nbsp;整 状 态 为 等 待 下 一 次</span><span class="stl_17 stl_18 stl_1263" style="word-spacing:0.4968em;">&nbsp;</span><span class="stl_58 stl_59 stl_1263" style="word-spacing:0.4968em;">BGSAVE</span><span class="stl_58 stl_59 stl_1263" style="word-spacing:0.4958em;">&nbsp;</span><span class="stl_17 stl_18 stl_1263" style="word-spacing:0.4958em;">进</span><span class="stl_17 stl_18 stl_1263" style="word-spacing:0.4958em;">&nbsp;程 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.874em; left:11.6342em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">的 结 束 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:10.0375em;z-index:447; "><span class="stl_15 stl_16 stl_891" style="word-spacing:0.048em;">i f</span><span class="stl_15 stl_16 stl_891" style="word-spacing:0.7544em;">&nbsp;</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.7544em;">(</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.099em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.0276em;">&nbsp;</span><span class="stl_107 stl_108 stl_891" style="word-spacing:0.099em;">−</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.0276em;">&gt;r</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.0334em;">&nbsp;e p l s t a t e</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.515em;">&nbsp;==</span><span class="stl_10 stl_11 stl_891" style="word-spacing:0.263em;">&nbsp;REDIS_REPL_WAIT_BGSAVE_START) &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:12.0908em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 26.641em; left:11.995em;"><span class="stl_10 stl_11 stl_1264" style="word-spacing:0.1292em;">startbgsave = 1; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:11.985em;z-index:509; "><span class="stl_10 stl_11 stl_1265">slave</span><span class="stl_10 stl_11 stl_1265" style="word-spacing:0.0232em;">&nbsp;</span><span class="stl_107 stl_108 stl_1265">−</span><span class="stl_10 stl_11 stl_1265" style="word-spacing:0.0232em;">&gt;r</span><span class="stl_10 stl_11 stl_1265" style="word-spacing:0.0282em;">&nbsp;e p l s t a t e</span><span class="stl_10 stl_11 stl_1265" style="word-spacing:0.5389em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1265" style="word-spacing:0.2849em;">&nbsp;REDIS_REPL_WAIT_BGSAVE_END; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6218em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 30.6276em; left:10.4132em;"><span class="stl_58 stl_59 stl_121">/</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.5858em;">&nbsp;</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.5858em;">等</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.025em;">&nbsp;待</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.4404em;">&nbsp;</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.4404em;">BGSAVE</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.4392em;">&nbsp;</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.4392em;">结</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.059em;">&nbsp;束。 准</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.026em;">&nbsp;备 向</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.677em;">&nbsp;</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.677em;">s</span><span class="stl_58 stl_59 stl_121" style="word-spacing:-0.024em;">&nbsp;l</span><span class="stl_58 stl_59 stl_121" style="word-spacing:-0.023em;">&nbsp;a</span><span class="stl_58 stl_59 stl_121" style="word-spacing:-0.023em;">&nbsp;ve</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.6771em;">&nbsp;</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.6771em;">发</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.026em;">&nbsp;送</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.4294em;">&nbsp;</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.4294em;">RDB</span><span class="stl_58 stl_59 stl_121" style="word-spacing:0.4286em;">&nbsp;</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.4286em;">文</span><span class="stl_17 stl_18 stl_121" style="word-spacing:0.4286em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6168em; left:10.9817em;z-index:589; "><span class="stl_15 stl_16 stl_851" style="word-spacing:0.519em;">else i</span><span class="stl_15 stl_16 stl_851" style="word-spacing:-0.195em;">&nbsp;f</span><span class="stl_15 stl_16 stl_851" style="word-spacing:0.5097em;">&nbsp;</span><span class="stl_10 stl_11 stl_851" style="word-spacing:0.5097em;">(</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.144em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.2164em;">&nbsp;</span><span class="stl_107 stl_108 stl_851" style="word-spacing:-0.144em;">−</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.2164em;">&gt;r</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.211em;">&nbsp;e</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.21em;">&nbsp;p</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.211em;">&nbsp;l</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.21em;">&nbsp;s</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.211em;">&nbsp;t</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.211em;">&nbsp;a</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.21em;">&nbsp;t</span><span class="stl_10 stl_11 stl_851" style="word-spacing:-0.211em;">&nbsp;e</span><span class="stl_10 stl_11 stl_851" style="word-spacing:0.271em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:11.4742em;"><span class="stl_10 stl_11 stl_1266" style="word-spacing:0.6826em;">REDIS_REPL_WAIT_BGSAVE_END) { &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:11.9575em;"><span class="stl_15 stl_16 stl_833">struct</span><span class="stl_15 stl_16 stl_833" style="word-spacing:0.3456em;">&nbsp;</span><span class="stl_10 stl_11 stl_833" style="word-spacing:0.3456em;">redis_stat buf</span><span class="stl_10 stl_11 stl_833" style="word-spacing:0.3456em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:12.4057em;"><span class="stl_58 stl_59 stl_760">/</span><span class="stl_58 stl_59 stl_760" style="word-spacing:0.3264em;">&nbsp;</span><span class="stl_17 stl_18 stl_760" style="word-spacing:0.3264em;">如</span><span class="stl_17 stl_18 stl_760" style="word-spacing:-0.2345em;">&nbsp;果</span><span class="stl_17 stl_18 stl_760" style="word-spacing:0.1699em;">&nbsp;</span><span class="stl_58 stl_59 stl_760" style="word-spacing:0.1699em;">RDB</span><span class="stl_58 stl_59 stl_760" style="word-spacing:-0.0653em;">&nbsp;</span><span class="stl_17 stl_18 stl_760" style="word-spacing:-0.0653em;">持 久</span><span class="stl_17 stl_18 stl_760" style="word-spacing:-0.2335em;">&nbsp;化</span><span class="stl_17 stl_18 stl_760" style="word-spacing:-0.2335em;">&nbsp;失</span><span class="stl_17 stl_18 stl_760" style="word-spacing:-0.2005em;">&nbsp;败，</span><span class="stl_17 stl_18 stl_760" style="word-spacing:0.4335em;">&nbsp;</span><span class="stl_58 stl_59 stl_760" style="word-spacing:0.4335em;">bgsaveerr</span><span class="stl_58 stl_59 stl_760" style="word-spacing:0.4006em;">&nbsp;</span><span class="stl_17 stl_18 stl_760" style="word-spacing:0.4006em;">会</span><span class="stl_17 stl_18 stl_760" style="word-spacing:-0.2335em;">&nbsp;被</span><span class="stl_17 stl_18 stl_760" style="word-spacing:-0.2335em;">&nbsp;设</span><span class="stl_17 stl_18 stl_760" style="word-spacing:-0.2335em;">&nbsp;置</span><span class="stl_17 stl_18 stl_760" style="word-spacing:-0.2335em;">&nbsp;为 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:13.495em;"><span class="stl_58 stl_59 stl_1133">REDIS_ERR &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:12.03em;"><span class="stl_15 stl_16 stl_1267" style="word-spacing:-0.1466em;">i f</span><span class="stl_15 stl_16 stl_1267" style="word-spacing:0.5598em;">&nbsp;</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:0.5598em;">(</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:-0.0926em;">&nbsp;bgsaveerr</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:0.4504em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:0.2584em;">&nbsp;REDIS_OK)</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:0.2584em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:14.0075em;"><span class="stl_10 stl_11 stl_1268" style="word-spacing:-0.346em;">f r e e C l i e n t ( slave ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:13.9783em;"><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.0317em;">redisLog (REDIS_WARNING,</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.0277em;">&nbsp;”SYNC␣ f</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:-0.0203em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:-0.0203em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:-0.0203em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:-0.0213em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:-0.0203em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.1407em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.0137em;">&nbsp;␣BGSAVE␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:15.6592em;"><span class="stl_10 stl_11 stl_936" style="word-spacing:-0.3034em;">child ␣ returned ␣an␣ error ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5793em; left:13.9225em;"><span class="stl_15 stl_16 stl_1166" style="word-spacing:-0.1446em;">continue </span><span class="stl_10 stl_11 stl_1166" style="word-spacing:-0.1446em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 44.5752em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.5752em; left:12.4057em;"><span class="stl_58 stl_59 stl_866">/</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.7028em;">&nbsp;</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.7028em;">打</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.142em;">&nbsp;开</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5464em;">&nbsp;</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.5464em;">RDB</span><span class="stl_58 stl_59 stl_866" style="word-spacing:0.5456em;">&nbsp;</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5456em;">文</span><span class="stl_17 stl_18 stl_866" style="word-spacing:0.5456em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5652em; left:12.03em;z-index:826; "><span class="stl_15 stl_16 stl_479" style="word-spacing:-0.2766em;">i f</span><span class="stl_15 stl_16 stl_479" style="word-spacing:0.465em;">&nbsp;</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.465em;">((</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.1896em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.2969em;">&nbsp;</span><span class="stl_107 stl_108 stl_479" style="word-spacing:-0.1896em;">−</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.2969em;">&gt;repldbfd</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.1864em;">&nbsp;=</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.1501em;">&nbsp;open (</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.2036em;">&nbsp;server</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.1476em;">&nbsp;.</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.1976em;">&nbsp;rdb_filename</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.1976em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:13.4392em;"><span class="stl_10 stl_11 stl_1270" style="word-spacing:0.167em;">O_RDONLY) )</span><span class="stl_10 stl_11 stl_1270" style="word-spacing:0.544em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1270" style="word-spacing:0.3984em;">&nbsp;</span><span class="stl_107 stl_108 stl_1270" style="word-spacing:0.544em;">−</span><span class="stl_10 stl_11 stl_1270" style="word-spacing:0.3984em;">1</span><span class="stl_10 stl_11 stl_1270" style="word-spacing:0.752em;">&nbsp;|</span><span class="stl_10 stl_11 stl_1270" style="word-spacing:0.752em;">&nbsp;| &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">144 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:14.0008em;z-index:35; "><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2655em;">re di</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2655em;">&nbsp;s</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2655em;">&nbsp;_f</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2655em;">&nbsp;s</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2655em;">&nbsp;t</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2655em;">&nbsp;a</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2665em;">&nbsp;t</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.1605em;">&nbsp;(</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.1885em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2607em;">&nbsp;</span><span class="stl_107 stl_108 stl_827" style="word-spacing:-0.1885em;">−</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2607em;">&gt;repldbfd</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.1365em;">&nbsp;,&amp;buf</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2155em;">&nbsp;)</span><span class="stl_10 stl_11 stl_827" style="word-spacing:0.1705em;">&nbsp;==</span><span class="stl_10 stl_11 stl_827" style="word-spacing:0.1172em;">&nbsp;</span><span class="stl_107 stl_108 stl_827" style="word-spacing:0.1705em;">−</span><span class="stl_10 stl_11 stl_827" style="word-spacing:0.1172em;">1)</span><span class="stl_10 stl_11 stl_827" style="word-spacing:0.1172em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:14.0075em;z-index:74; "><span class="stl_10 stl_11 stl_1268" style="word-spacing:-0.346em;">f r e e C l i e n t ( slave ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:13.9783em;"><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0022em;">redisLog (REDIS_WARNING,</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0072em;">&nbsp;”SYNC␣</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0052em;">&nbsp;f</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0542em;">&nbsp;a</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0542em;">&nbsp;i</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0542em;">&nbsp;l</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0552em;">&nbsp;e</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0542em;">&nbsp;d</span><span class="stl_10 stl_11 stl_713" style="word-spacing:0.1068em;">&nbsp;.</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0202em;">&nbsp;␣Can</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0112em;">&nbsp;’</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0182em;">&nbsp;t</span><span class="stl_10 stl_11 stl_713" style="word-spacing:-0.0182em;">&nbsp;␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:15.5933em;"><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0648em;">open/ stat</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0638em;">&nbsp;␣DB␣</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0498em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0978em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0988em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0978em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0988em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0478em;">&nbsp;␣BGSAVE:</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0488em;">&nbsp;␣%s</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0938em;">&nbsp;”</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:0.0182em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:0.6152em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0928em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0918em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0928em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0928em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0928em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0928em;">&nbsp;o</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0918em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1175" style="word-spacing:-0.0918em;">&nbsp;( &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:15.635em;"><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2545em;">errno ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:13.9225em;"><span class="stl_15 stl_16 stl_1166" style="word-spacing:-0.1446em;">continue </span><span class="stl_10 stl_11 stl_1166" style="word-spacing:-0.1446em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.6893em; left:11.985em;z-index:181; "><span class="stl_10 stl_11 stl_1105">slave</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:-0.2744em;">&nbsp;</span><span class="stl_107 stl_108 stl_1105">−</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:-0.2744em;">&gt;r</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:-0.2807em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:-0.2797em;">&nbsp;p</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:-0.2797em;">&nbsp;ld</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:-0.2797em;">&nbsp;bo</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:-0.2797em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:-0.2797em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:0.2258em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1105" style="word-spacing:0.2258em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:11.985em;z-index:200; "><span class="stl_10 stl_11 stl_86">slave</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2994em;">&nbsp;</span><span class="stl_107 stl_108 stl_86">−</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2994em;">&gt;r</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.3048em;">&nbsp;e</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.3058em;">&nbsp;p</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.3048em;">&nbsp;l</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.3048em;">&nbsp;d</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.3048em;">&nbsp;bs</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.3048em;">&nbsp;i</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.3048em;">&nbsp;z</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.3048em;">&nbsp;e</span><span class="stl_10 stl_11 stl_86" style="word-spacing:0.2052em;">&nbsp;=</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.0485em;">&nbsp;buf .</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.1558em;">&nbsp;st_size</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.1558em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.985em;z-index:230; "><span class="stl_10 stl_11 stl_1271">slave</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:-0.0122em;">&nbsp;</span><span class="stl_107 stl_108 stl_1271">−</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:-0.0122em;">&gt;r</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:-0.0076em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:-0.0076em;">&nbsp;p</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:-0.0066em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:-0.0076em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:-0.0066em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:-0.0076em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:-0.0076em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:-0.0066em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:0.5034em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1271" style="word-spacing:0.2624em;">&nbsp;REDIS_REPL_SEND_BULK; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:12.4057em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">如 果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;之</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;前</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;注</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;册</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;写</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;事</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;件，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;取</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;消 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:11.9867em;z-index:311; "><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.1345em;">aeDeleteFileEvent (</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.1145em;">&nbsp;server</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.0595em;">&nbsp;.</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.0835em;">&nbsp;el</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.046em;">&nbsp;, slave</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.209em;">&nbsp;</span><span class="stl_107 stl_108 stl_199" style="word-spacing:-0.046em;">−</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.209em;">&gt;fd</span><span class="stl_10 stl_11 stl_199" style="word-spacing:-0.0345em;">&nbsp;,AE_WRITABLE &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:13.6308em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 19.6668em; left:14.1746em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 21.661em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.661em; left:12.4057em;"><span class="stl_58 stl_59 stl_798">/</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.3502em;">&nbsp;</span><span class="stl_17 stl_18 stl_798" style="word-spacing:0.3502em;">注</span><span class="stl_17 stl_18 stl_798" style="word-spacing:-0.2106em;">&nbsp;册</span><span class="stl_17 stl_18 stl_798" style="word-spacing:-0.2096em;">&nbsp;新</span><span class="stl_17 stl_18 stl_798" style="word-spacing:-0.2096em;">&nbsp;的</span><span class="stl_17 stl_18 stl_798" style="word-spacing:-0.2096em;">&nbsp;写</span><span class="stl_17 stl_18 stl_798" style="word-spacing:-0.2096em;">&nbsp;事</span><span class="stl_17 stl_18 stl_798" style="word-spacing:-0.2426em;">&nbsp;件</span><span class="stl_17 stl_18 stl_798" style="word-spacing:-0.1294em;">&nbsp;</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.1294em;">,</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.1626em;">&nbsp;sendBulkToSlave</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.1806em;">&nbsp;()</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.4174em;">&nbsp;</span><span class="stl_17 stl_18 stl_798" style="word-spacing:0.4174em;">传</span><span class="stl_17 stl_18 stl_798" style="word-spacing:-0.2106em;">&nbsp;输</span><span class="stl_17 stl_18 stl_798" style="word-spacing:0.1937em;">&nbsp;</span><span class="stl_58 stl_59 stl_798" style="word-spacing:0.1937em;">RDB</span><span class="stl_58 stl_59 stl_798" style="word-spacing:-0.0088em;">&nbsp;</span><span class="stl_17 stl_18 stl_798" style="word-spacing:-0.0088em;">文</span><span class="stl_17 stl_18 stl_798" style="word-spacing:-0.0088em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:12.03em;z-index:399; "><span class="stl_15 stl_16 stl_685" style="word-spacing:-0.2884em;">i f</span><span class="stl_15 stl_16 stl_685" style="word-spacing:0.418em;">&nbsp;</span><span class="stl_10 stl_11 stl_685" style="word-spacing:0.418em;">(</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.2414em;">&nbsp;aeCreateFileEvent</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.2414em;">&nbsp;(</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.2154em;">&nbsp;server</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.1604em;">&nbsp;.</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.1834em;">&nbsp;el</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.0644em;">&nbsp;,</span><span class="stl_10 stl_11 stl_685" style="word-spacing:0.4196em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.3094em;">&nbsp;</span><span class="stl_107 stl_108 stl_685" style="word-spacing:0.4196em;">−</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.3094em;">&gt;fd</span><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.3094em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:13.4675em;z-index:437; "><span class="stl_10 stl_11 stl_899" style="word-spacing:0.5854em;">AE_WRITABLE, sendBulkToSlave</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.0704em;">&nbsp;,</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.6434em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_899" style="word-spacing:-0.0126em;">&nbsp;)</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.3264em;">&nbsp;==</span><span class="stl_10 stl_11 stl_899" style="word-spacing:0.1154em;">&nbsp;AE_ERR &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:13.6308em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 24.6485em; left:14.5806em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 25.6443em; left:14.0075em;"><span class="stl_10 stl_11 stl_1268" style="word-spacing:-0.346em;">f r e e C l i e n t ( slave ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.636em; left:13.9225em;"><span class="stl_15 stl_16 stl_1166" style="word-spacing:-0.1446em;">continue </span><span class="stl_10 stl_11 stl_1166" style="word-spacing:-0.1446em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.6335em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.6293em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 31.6235em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4207em;"><span class="stl_58 stl_59 stl_1272" style="word-spacing:0.6792em;">/ s</span><span class="stl_58 stl_59 stl_1272" style="word-spacing:0.02em;">&nbsp;t a r t b g s a v e</span><span class="stl_58 stl_59 stl_1272" style="word-spacing:0.5092em;">&nbsp;==</span><span class="stl_58 stl_59 stl_1272" style="word-spacing:0.2962em;">&nbsp;REDIS_ERR</span><span class="stl_58 stl_59 stl_1272" style="word-spacing:0.5075em;">&nbsp;</span><span class="stl_17 stl_18 stl_1272" style="word-spacing:0.5075em;">表</span><span class="stl_17 stl_18 stl_1272" style="word-spacing:0.0662em;">&nbsp;示</span><span class="stl_17 stl_18 stl_1272" style="word-spacing:0.4816em;">&nbsp;</span><span class="stl_58 stl_59 stl_1272" style="word-spacing:0.4816em;">BGSAVE</span><span class="stl_58 stl_59 stl_1272" style="word-spacing:0.4804em;">&nbsp;</span><span class="stl_17 stl_18 stl_1272" style="word-spacing:0.4804em;">失</span><span class="stl_17 stl_18 stl_1272" style="word-spacing:0.1002em;">&nbsp;败， 再</span><span class="stl_17 stl_18 stl_1272" style="word-spacing:0.0672em;">&nbsp;一 次 进</span><span class="stl_17 stl_18 stl_1272" style="word-spacing:0.0672em;">&nbsp;行 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:9.4867em;"><span class="stl_58 stl_59 stl_1071">BGSAVE</span><span class="stl_58 stl_59 stl_1071" style="word-spacing:0.5356em;">&nbsp;</span><span class="stl_17 stl_18 stl_1071" style="word-spacing:0.5356em;">尝</span><span class="stl_17 stl_18 stl_1071" style="word-spacing:0.5356em;">&nbsp;试 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:8.045em;"><span class="stl_15 stl_16 stl_564" style="word-spacing:-0.343em;">i f</span><span class="stl_15 stl_16 stl_564" style="word-spacing:0.3634em;">&nbsp;</span><span class="stl_10 stl_11 stl_564" style="word-spacing:0.3634em;">(</span><span class="stl_10 stl_11 stl_564" style="word-spacing:-0.279em;">&nbsp;startbgsave</span><span class="stl_10 stl_11 stl_564" style="word-spacing:-0.279em;">&nbsp;)</span><span class="stl_10 stl_11 stl_564" style="word-spacing:-0.279em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:10.4132em;"><span class="stl_58 stl_59 stl_550" style="word-spacing:0.3222em;">* Since</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.2852em;">&nbsp;we are</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.4202em;">&nbsp;s</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2818em;">&nbsp;t</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2828em;">&nbsp;a</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2818em;">&nbsp;r</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2818em;">&nbsp;t</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2818em;">&nbsp;i</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2818em;">&nbsp;n</span><span class="stl_58 stl_59 stl_550" style="word-spacing:-0.2828em;">&nbsp;g</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.3632em;">&nbsp;a</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.2282em;">&nbsp;new</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.2842em;">&nbsp;background</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.3872em;">&nbsp;save</span><span class="stl_58 stl_59 stl_550" style="word-spacing:0.3872em;">&nbsp;for &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:11.6067em;"><span class="stl_58 stl_59 stl_927" style="word-spacing:0.3054em;">one or more</span><span class="stl_58 stl_59 stl_927" style="word-spacing:0.3384em;">&nbsp;slaves</span><span class="stl_58 stl_59 stl_927" style="word-spacing:0.3384em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 38.5976em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 40.5901em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 36.6051em; left:11.4055em;"><span class="stl_58 stl_59 stl_1088" style="word-spacing:0.3465em;">we f</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:-0.2775em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:-0.2785em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:-0.2785em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:-0.2775em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:0.4355em;">&nbsp;the Replication Script</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:0.347em;">&nbsp;Cache to</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:0.3765em;">&nbsp;use</span><span class="stl_58 stl_59 stl_1088" style="word-spacing:0.1785em;">&nbsp;EVAL &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:12.1483em;"><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.3506em;">to propagate every &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:11.408em;"><span class="stl_58 stl_59 stl_1273" style="word-spacing:0.1956em;">new EVALSHA</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:0.3056em;">&nbsp;for</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:0.5106em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:0.5746em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:-0.1494em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:-0.1504em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:-0.1494em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:-0.1494em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:0.5316em;">&nbsp;time</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:-0.0454em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:0.5506em;">&nbsp;since a</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:-0.1584em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:-0.1594em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:0.5646em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1273" style="word-spacing:0.3996em;">&nbsp;new &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:12.1792em;"><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1856em;">s l</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1856em;">&nbsp;a</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1846em;">&nbsp;v</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1856em;">&nbsp;e</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1846em;">&nbsp;s</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.4684em;">&nbsp;don</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.0926em;">&nbsp;’</span><span class="stl_58 stl_59 stl_440" style="word-spacing:-0.1096em;">&nbsp;t</span><span class="stl_58 stl_59 stl_440" style="word-spacing:0.4334em;">&nbsp;know &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:11.4744em;"><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.3535em;">about previous</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.4155em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3175em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3165em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3165em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3165em;">&nbsp;p</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3175em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.3165em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:-0.1695em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1066" style="word-spacing:0.3195em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:10.005em;"><span class="stl_10 stl_11 stl_863" style="word-spacing:-0.2359em;">replicationScriptCacheFlush () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5727em; left:10.0375em;"><span class="stl_15 stl_16 stl_789" style="word-spacing:-0.2645em;">i f</span><span class="stl_15 stl_16 stl_789" style="word-spacing:0.4419em;">&nbsp;</span><span class="stl_10 stl_11 stl_789" style="word-spacing:0.4419em;">(</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.2565em;">&nbsp;rdbSaveBackground</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.2555em;">&nbsp;(</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.1915em;">&nbsp;server</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.1365em;">&nbsp;.</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.1785em;">&nbsp;rdb_filename</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.2345em;">&nbsp;)</span><span class="stl_10 stl_11 stl_789" style="word-spacing:0.3125em;">&nbsp;!= &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:11.495em;"><span class="stl_10 stl_11 stl_1252" style="word-spacing:0.6128em;">REDIS_OK) { &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:10.4132em;"><span class="stl_58 stl_59 stl_937">*BGSAVE</span><span class="stl_58 stl_59 stl_937" style="word-spacing:0.4081em;">&nbsp;</span><span class="stl_17 stl_18 stl_937" style="word-spacing:0.4081em;">可</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.0051em;">&nbsp;能</span><span class="stl_17 stl_18 stl_937" style="word-spacing:0.6352em;">&nbsp;</span><span class="stl_58 stl_59 stl_937" style="word-spacing:0.6352em;">fork</span><span class="stl_58 stl_59 stl_937" style="word-spacing:0.6359em;">&nbsp;</span><span class="stl_17 stl_18 stl_937" style="word-spacing:0.6359em;">失</span><span class="stl_17 stl_18 stl_937" style="word-spacing:0.0279em;">&nbsp;败， 所</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.0051em;">&nbsp;有</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.0051em;">&nbsp;等</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.0051em;">&nbsp;待</span><span class="stl_17 stl_18 stl_937" style="word-spacing:0.4095em;">&nbsp;</span><span class="stl_58 stl_59 stl_937" style="word-spacing:0.4095em;">BGSAVE</span><span class="stl_58 stl_59 stl_937" style="word-spacing:0.4082em;">&nbsp;</span><span class="stl_17 stl_18 stl_937" style="word-spacing:0.4082em;">的</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.0061em;">&nbsp;从</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.0051em;">&nbsp;机</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.0051em;">&nbsp;都</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.0051em;">&nbsp;将</span><span class="stl_17 stl_18 stl_937" style="word-spacing:-0.0051em;">&nbsp;结 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5677em; left:11.6342em;"><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3357em;">束 连</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3007em;">&nbsp;接。</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3017em;">&nbsp;这</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3347em;">&nbsp;是</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:0.3144em;">&nbsp;</span><span class="stl_58 stl_59 stl_1274" style="word-spacing:0.3144em;">redis</span><span class="stl_58 stl_59 stl_1274" style="word-spacing:-0.0212em;">&nbsp;</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.0212em;">自 我</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3347em;">&nbsp;保</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3347em;">&nbsp;护</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3347em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3347em;">&nbsp;措</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3017em;">&nbsp;施，</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.262em;">&nbsp;</span><span class="stl_58 stl_59 stl_1274" style="word-spacing:-0.262em;">fork</span><span class="stl_58 stl_59 stl_1274" style="word-spacing:-0.0294em;">&nbsp;</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.0294em;">失 败</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3347em;">&nbsp;很</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3347em;">&nbsp;可</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3347em;">&nbsp;能 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">部分同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">145 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:11.6342em;"><span class="stl_17 stl_18 stl_71" style="word-spacing:-0.1762em;">是 内 存 紧 张 </span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.1762em;">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:12.0558em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">l i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;I</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;r</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.773em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:11.9867em;"><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2318em;">listRewind ( server . slaves ,&amp; l i ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:11.9858em;"><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.0317em;">redisLog (REDIS_WARNING,</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.0277em;">&nbsp;”SYNC␣ f</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:-0.0203em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:-0.0203em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:-0.0213em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:-0.0203em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:-0.0203em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.1407em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.0137em;">&nbsp;␣BGSAVE␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:13.6908em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.055em;">f a i l e d ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:11.9333em;"><span class="stl_15 stl_16 stl_735">while</span><span class="stl_15 stl_16 stl_735" style="word-spacing:-0.2505em;">&nbsp;</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2505em;">((</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.1899em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_735" style="word-spacing:0.1801em;">&nbsp;=</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.0948em;">&nbsp;lis tN</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.3029em;">&nbsp;e</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.3029em;">&nbsp;xt</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2919em;">&nbsp;(&amp;</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2279em;">&nbsp;l</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2379em;">&nbsp;i</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.1329em;">&nbsp;)</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2419em;">&nbsp;)</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2419em;">&nbsp;)</span><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2419em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:14.005em;z-index:160; "><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2729em;">r e</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2719em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2719em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2719em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2729em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2719em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2719em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2719em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2729em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2719em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.3781em;">&nbsp;*</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:-0.2349em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.2261em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.1741em;">&nbsp;ln</span><span class="stl_107 stl_108 stl_1095" style="word-spacing:0.1741em;">−</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.1741em;">&gt;value</span><span class="stl_10 stl_11 stl_1095" style="word-spacing:0.1741em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:14.0225em;z-index:176; "><span class="stl_15 stl_16 stl_1275" style="word-spacing:-0.1501em;">i f</span><span class="stl_15 stl_16 stl_1275" style="word-spacing:0.5563em;">&nbsp;</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:0.5563em;">(</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.0981em;">&nbsp;slave</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1705em;">&nbsp;</span><span class="stl_107 stl_108 stl_1275" style="word-spacing:-0.0981em;">−</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1705em;">&gt;r</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1651em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1641em;">&nbsp;p</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1651em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1651em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1641em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1651em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1641em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1651em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:0.3169em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:15.4617em;"><span class="stl_10 stl_11 stl_1254">REDIS_REPL_WAIT_BGSAVE_START) &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:16em;"><span class="stl_10 stl_11 stl_1268" style="word-spacing:-0.346em;">f r e e C l i e n t ( slave ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 19.6668em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 20.6635em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 21.6593em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.6382em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 24.6382em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">4.4 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">部分同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.921em; left:7.5658em;z-index:257; "><span class="stl_17 stl_18 stl_1276" style="word-spacing:0.0791em;">如上所说，无论如何，</span><span class="stl_10 stl_11 stl_1276" style="word-spacing:0.0791em;">redis </span><span class="stl_17 stl_18 stl_1276" style="word-spacing:0.0791em;">首先会尝试部分同步。部分同步即把积压空间缓存的 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.139em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">数据，即更新记录发送给从机。 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.9351em; left:7.5658em;"><span class="stl_17 stl_18 stl_1192" style="word-spacing:0.0612em;">从机连接主机后，会主动发起 </span><span class="stl_10 stl_11 stl_1192" style="word-spacing:0.0612em;">PSYNC </span><span class="stl_17 stl_18 stl_1192" style="word-spacing:0.0612em;">命令，从机会提供 </span><span class="stl_10 stl_11 stl_1192" style="word-spacing:0.0612em;">master_runid </span><span class="stl_17 stl_18 stl_1192" style="word-spacing:0.0612em;">和 </span><span class="stl_10 stl_11 stl_1192" style="word-spacing:0.0612em;">oﬀset</span><span class="stl_17 stl_18 stl_1192" style="word-spacing:0.0612em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 29.931em; left:5.9058em;"><span class="stl_17 stl_18 stl_1277" style="word-spacing:0.0911em;">主机验证 </span><span class="stl_10 stl_11 stl_1277" style="word-spacing:0.0911em;">master_runid </span><span class="stl_17 stl_18 stl_1277" style="word-spacing:0.0911em;">和 </span><span class="stl_10 stl_11 stl_1277" style="word-spacing:0.0911em;">oﬀset </span><span class="stl_17 stl_18 stl_1277" style="word-spacing:0.0911em;">是否有效？验证通过则，进行部分同步：主机返回 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.9276em; left:5.9058em;"><span class="stl_10 stl_11 stl_1278">+CONTINUE</span><span class="stl_17 stl_18 stl_1278">（从机接收后会注册积压数据接收事件），接着发送积压空间数据。 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.4626em; left:6.4282em;"><span class="stl_58 stl_59 stl_549">/</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3156em;">&nbsp;</span><span class="stl_17 stl_18 stl_549" style="word-spacing:0.3156em;">连</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2452em;">&nbsp;接</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;主</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;机</span><span class="stl_17 stl_18 stl_549" style="word-spacing:0.3487em;">&nbsp;</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3487em;">connectWithMaster</span><span class="stl_58 stl_59 stl_549" style="word-spacing:-0.2242em;">&nbsp;()</span><span class="stl_58 stl_59 stl_549" style="word-spacing:0.3832em;">&nbsp;</span><span class="stl_17 stl_18 stl_549" style="word-spacing:0.3832em;">的</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2452em;">&nbsp;时</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2102em;">&nbsp;候，</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2112em;">&nbsp;会</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;被</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;注</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;册</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;为</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;回</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;调</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;函</span><span class="stl_17 stl_18 stl_549" style="word-spacing:-0.2442em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4527em; left:5.9483em;"><span class="stl_15 stl_16 stl_1196">void</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.32em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.32em;">syncWithMaster</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2273em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2332em;">&nbsp;aeEventLoop</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.3108em;">&nbsp;*</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2433em;">&nbsp;el</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.0122em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.4469em;">&nbsp;</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.4469em;">int</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.3716em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.3716em;">fd</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.0823em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.4015em;">&nbsp;</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.4015em;">void</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.2908em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.2908em;">*</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2533em;">&nbsp;privdata</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2533em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4485em; left:7.6483em;"><span class="stl_15 stl_16 stl_151" style="word-spacing:0.3525em;">int </span><span class="stl_10 stl_11 stl_151" style="word-spacing:0.3525em;">mask) { &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4452em; left:7.9342em;"><span class="stl_15 stl_16 stl_969">char</span><span class="stl_15 stl_16 stl_969" style="word-spacing:0.3046em;">&nbsp;</span><span class="stl_10 stl_11 stl_969" style="word-spacing:0.3046em;">tmpfile</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.1798em;">&nbsp;[</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3198em;">&nbsp;2</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3198em;">&nbsp;5</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3188em;">&nbsp;6</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.3198em;">&nbsp;]</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.1618em;">&nbsp;,</span><span class="stl_10 stl_11 stl_969" style="word-spacing:0.3312em;">&nbsp;*</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.2848em;">&nbsp;err</span><span class="stl_10 stl_11 stl_969" style="word-spacing:-0.2848em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.441em; left:7.98em;"><span class="stl_15 stl_16 stl_301">int</span><span class="stl_15 stl_16 stl_301" style="word-spacing:0.3093em;">&nbsp;</span><span class="stl_10 stl_11 stl_301" style="word-spacing:0.3093em;">dfd</span><span class="stl_10 stl_11 stl_301" style="word-spacing:-0.1525em;">&nbsp;,</span><span class="stl_10 stl_11 stl_301" style="word-spacing:0.4105em;">&nbsp;maxtries</span><span class="stl_10 stl_11 stl_301" style="word-spacing:0.1605em;">&nbsp;=</span><span class="stl_10 stl_11 stl_301" style="word-spacing:0.1855em;">&nbsp;5; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4377em; left:7.98em;"><span class="stl_15 stl_16 stl_450">int</span><span class="stl_15 stl_16 stl_450" style="word-spacing:0.3437em;">&nbsp;</span><span class="stl_10 stl_11 stl_450" style="word-spacing:0.3437em;">sockerr</span><span class="stl_10 stl_11 stl_450" style="word-spacing:0.1556em;">&nbsp;=</span><span class="stl_10 stl_11 stl_450" style="word-spacing:-0.0799em;">&nbsp;0 ,</span><span class="stl_10 stl_11 stl_450" style="word-spacing:0.3296em;">&nbsp;psync_result</span><span class="stl_10 stl_11 stl_450" style="word-spacing:0.3296em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4335em; left:7.9908em;"><span class="stl_10 stl_11 stl_1197" style="word-spacing:0.3718em;">socklen_t e</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.3402em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.3392em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.3402em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.3402em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.3392em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:0.1708em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:0.138em;">&nbsp;</span><span class="stl_15 stl_16 stl_1197" style="word-spacing:0.138em;">sizeof</span><span class="stl_15 stl_16 stl_1197" style="word-spacing:-0.267em;">&nbsp;</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.267em;">(</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.2532em;">&nbsp;sockerr</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.2532em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.2532em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.431em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 41.431em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.4251em; left:8.4207em;"><span class="stl_58 stl_59 stl_1279">/</span><span class="stl_58 stl_59 stl_1279" style="word-spacing:0.6181em;">&nbsp;</span><span class="stl_17 stl_18 stl_1279" style="word-spacing:0.6181em;">尝</span><span class="stl_17 stl_18 stl_1279" style="word-spacing:0.058em;">&nbsp;试 部 分 同</span><span class="stl_17 stl_18 stl_1279" style="word-spacing:0.0913em;">&nbsp;步， 主</span><span class="stl_17 stl_18 stl_1279" style="word-spacing:0.0583em;">&nbsp;机 允 许 进 行 部 分 同 步 会 返 回</span><span class="stl_17 stl_18 stl_1279" style="word-spacing:0.4746em;">&nbsp;</span><span class="stl_58 stl_59 stl_1279" style="word-spacing:0.4746em;">+CONTINUE</span><span class="stl_17 stl_18 stl_1279" style="word-spacing:0.4746em;">，</span><span class="stl_17 stl_18 stl_1279" style="word-spacing:0.4746em;">&nbsp;从 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.6423em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0501em;">机 接 收 后 注 册 相 应 的 事 件 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:8.4207em;"><span class="stl_58 stl_59 stl_177" style="word-spacing:0.2281em;">* Try a</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3451em;">&nbsp;p</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2989em;">&nbsp;a</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2999em;">&nbsp;r</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2989em;">&nbsp;t</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2989em;">&nbsp;i</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2989em;">&nbsp;a</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2999em;">&nbsp;l</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.4351em;">&nbsp;resynchonization</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.1869em;">&nbsp;.</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.4471em;">&nbsp;I</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2989em;">&nbsp;f</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3271em;">&nbsp;we</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.0068em;">&nbsp;don ’</span><span class="stl_58 stl_59 stl_177" style="word-spacing:-0.2369em;">&nbsp;t</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3581em;">&nbsp;have</span><span class="stl_58 stl_59 stl_177" style="word-spacing:0.3581em;">&nbsp;a &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:9.64em;"><span class="stl_58 stl_59 stl_222" style="word-spacing:0.3504em;">cached master &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">146 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.5027em;"><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.256em;">slaveTryPartialResynchronization ()</span><span class="stl_58 stl_59 stl_581" style="word-spacing:0.393em;">&nbsp;w</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.333em;">&nbsp;i</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.334em;">&nbsp;l</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.333em;">&nbsp;l</span><span class="stl_58 stl_59 stl_581" style="word-spacing:0.3795em;">&nbsp;at l</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.345em;">&nbsp;e</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.345em;">&nbsp;a</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.345em;">&nbsp;s</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.345em;">&nbsp;t</span><span class="stl_58 stl_59 stl_581" style="word-spacing:0.395em;">&nbsp;try &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:10.1558em;"><span class="stl_58 stl_59 stl_191" style="word-spacing:0.5617em;">to use</span><span class="stl_58 stl_59 stl_191" style="word-spacing:0.3677em;">&nbsp;PSYNC &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.4911em;"><span class="stl_58 stl_59 stl_1280" style="word-spacing:0.3745em;">to s</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:-0.3435em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:-0.3435em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:-0.3445em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:-0.3435em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:0.3005em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:0.3445em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:-0.3015em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:-0.3005em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:-0.3005em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:0.4355em;">&nbsp;resynchronization</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:0.323em;">&nbsp;so that</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:0.2555em;">&nbsp;we get</span><span class="stl_58 stl_59 stl_1280" style="word-spacing:0.3515em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:10.1333em;"><span class="stl_58 stl_59 stl_1201" style="word-spacing:0.3478em;">master run</span><span class="stl_58 stl_59 stl_1201" style="word-spacing:0.3478em;">&nbsp;id &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.4371em;"><span class="stl_58 stl_59 stl_1262" style="word-spacing:0.3019em;">and the</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:0.4119em;">&nbsp;g</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3131em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3121em;">&nbsp;o</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3121em;">&nbsp;b</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3131em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3121em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:0.4469em;">&nbsp;o</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3171em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3161em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3171em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3171em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3171em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.0111em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:0.3864em;">&nbsp;to try</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:0.3229em;">&nbsp;a p</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3071em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3081em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3071em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3071em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3071em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:-0.3081em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:0.4079em;">&nbsp;resync</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:0.3619em;">&nbsp;at</span><span class="stl_58 stl_59 stl_1262" style="word-spacing:0.3619em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:10.1533em;"><span class="stl_58 stl_59 stl_367">next &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:9.4936em;"><span class="stl_58 stl_59 stl_339" style="word-spacing:0.3544em;">reconnection attempt</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2226em;">&nbsp;.</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.3244em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">函 数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;返</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;回</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;三</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;种</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;状</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;态： &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4207em;"><span class="stl_58 stl_59 stl_1281" style="word-spacing:0.4517em;">/ PSYNC_CONTINUE</span><span class="stl_17 stl_18 stl_1281" style="word-spacing:0.4517em;">：</span><span class="stl_17 stl_18 stl_1281" style="word-spacing:0.0777em;">&nbsp;表 示 会 进 行 部 分 同</span><span class="stl_17 stl_18 stl_1281" style="word-spacing:0.1107em;">&nbsp;步，</span><span class="stl_17 stl_18 stl_1281" style="word-spacing:0.1107em;">&nbsp;在 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.6692em;"><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.256em;">slaveTryPartialResynchronization () &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:16.4158em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:16.8891em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;已</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;经</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;设</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;回</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:18.1008em;"><span class="stl_58 stl_59 stl_885" style="word-spacing:-0.2156em;">readQueryFromClient () &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6635em; left:7.995em;"><span class="stl_10 stl_11 stl_746" style="word-spacing:0.1232em;">psync_result =</span><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.1286em;">&nbsp;slaveTryPartialResynchronization (</span><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2868em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2858em;">&nbsp;)</span><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2858em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:8.045em;"><span class="stl_15 stl_16 stl_192" style="word-spacing:-0.0769em;">i f</span><span class="stl_15 stl_16 stl_192" style="word-spacing:0.6295em;">&nbsp;</span><span class="stl_10 stl_11 stl_192" style="word-spacing:0.6295em;">(</span><span class="stl_10 stl_11 stl_192" style="word-spacing:-0.0309em;">&nbsp;psync_result</span><span class="stl_10 stl_11 stl_192" style="word-spacing:0.3461em;">&nbsp;==</span><span class="stl_10 stl_11 stl_192" style="word-spacing:0.1391em;">&nbsp;PSYNC_CONTINUE)</span><span class="stl_10 stl_11 stl_192" style="word-spacing:0.1391em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4207em;"><span class="stl_58 stl_59 stl_1282" style="word-spacing:0.4611em;">/ PSYNC_FULLRESYNC</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.4611em;">：</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.0846em;">&nbsp;全 同</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.1186em;">&nbsp;步， 会</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.0851em;">&nbsp;下 载</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.4891em;">&nbsp;</span><span class="stl_58 stl_59 stl_1282" style="word-spacing:0.4891em;">RDB</span><span class="stl_58 stl_59 stl_1282" style="word-spacing:0.4877em;">&nbsp;</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.4877em;">文</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.4877em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4207em;"><span class="stl_58 stl_59 stl_638" style="word-spacing:0.5015em;">/ PSYNC_NOT_SUPPORTED</span><span class="stl_17 stl_18 stl_638" style="word-spacing:0.5015em;">：</span><span class="stl_17 stl_18 stl_638" style="word-spacing:0.1455em;">&nbsp;未</span><span class="stl_17 stl_18 stl_638" style="word-spacing:0.1455em;">&nbsp;知 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:9.9933em;z-index:477; "><span class="stl_10 stl_11 stl_24" style="word-spacing:-0.0248em;">redisLog (REDIS_NOTICE,</span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.5712em;">&nbsp;”MASTER␣&lt;</span><span class="stl_107 stl_108 stl_24" style="word-spacing:0.5712em;">−</span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.5712em;">&gt;␣SLAVE␣sync</span><span class="stl_10 stl_11 stl_24" style="word-spacing:-0.0198em;">&nbsp;:</span><span class="stl_10 stl_11 stl_24" style="word-spacing:-0.0198em;">&nbsp;␣Master &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:11.5925em;"><span class="stl_10 stl_11 stl_07">␣</span></div>
					<div class="stl_01" style="top: 23.6518em; left:12.143em;"><span class="stl_10 stl_11 stl_1198" style="word-spacing:-0.286em;">accepted ␣a␣ Partial ␣ Resynchronization . ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:9.9383em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 27.6385em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6335em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 27.6385em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;全</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 31.6235em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:6.4282em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">函 数</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;返</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;回</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;三</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;种</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;状</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;态： &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:6.4282em;"><span class="stl_58 stl_59 stl_1281" style="word-spacing:0.4517em;">/ PSYNC_CONTINUE</span><span class="stl_17 stl_18 stl_1281" style="word-spacing:0.4517em;">：</span><span class="stl_17 stl_18 stl_1281" style="word-spacing:0.0777em;">&nbsp;表 示 会 进 行 部 分 同</span><span class="stl_17 stl_18 stl_1281" style="word-spacing:0.1107em;">&nbsp;步， 已</span><span class="stl_17 stl_18 stl_1281" style="word-spacing:0.0777em;">&nbsp;经 设 置 回 调 函</span><span class="stl_17 stl_18 stl_1281" style="word-spacing:0.0777em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:6.4282em;"><span class="stl_58 stl_59 stl_1282" style="word-spacing:0.4611em;">/ PSYNC_FULLRESYNC</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.4611em;">：</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.0846em;">&nbsp;全 同</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.1186em;">&nbsp;步， 会</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.0851em;">&nbsp;下 载</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.4891em;">&nbsp;</span><span class="stl_58 stl_59 stl_1282" style="word-spacing:0.4891em;">RDB</span><span class="stl_58 stl_59 stl_1282" style="word-spacing:0.4877em;">&nbsp;</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.4877em;">文</span><span class="stl_17 stl_18 stl_1282" style="word-spacing:0.4877em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:6.4282em;"><span class="stl_58 stl_59 stl_638" style="word-spacing:0.5015em;">/ PSYNC_NOT_SUPPORTED</span><span class="stl_17 stl_18 stl_638" style="word-spacing:0.5015em;">：</span><span class="stl_17 stl_18 stl_638" style="word-spacing:0.1455em;">&nbsp;未</span><span class="stl_17 stl_18 stl_638" style="word-spacing:0.1455em;">&nbsp;知 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 35.6018em; left:6.4748em;"><span class="stl_15 stl_16 stl_1283" style="word-spacing:0.4095em;">define </span><span class="stl_10 stl_11 stl_1283" style="word-spacing:0.4095em;">PSYNC_CONTINUE 0 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:6.4748em;"><span class="stl_15 stl_16 stl_1177" style="word-spacing:0.418em;">define </span><span class="stl_10 stl_11 stl_1177" style="word-spacing:0.418em;">PSYNC_FULLRESYNC 1 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:6.4748em;"><span class="stl_15 stl_16 stl_1284" style="word-spacing:0.4413em;">define </span><span class="stl_10 stl_11 stl_1284" style="word-spacing:0.4413em;">PSYNC_NOT_SUPPORTED 2 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 37.5943em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 38.591em; left:5.9875em;"><span class="stl_15 stl_16 stl_746">int</span><span class="stl_15 stl_16 stl_746" style="word-spacing:0.3262em;">&nbsp;</span><span class="stl_10 stl_11 stl_746" style="word-spacing:0.3262em;">slaveTryPartialResynchronization</span><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2678em;">&nbsp;(</span><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.3007em;">&nbsp;</span><span class="stl_15 stl_16 stl_746" style="word-spacing:-0.3007em;">int</span><span class="stl_15 stl_16 stl_746" style="word-spacing:0.3071em;">&nbsp;</span><span class="stl_10 stl_11 stl_746" style="word-spacing:0.3071em;">fd</span><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2858em;">&nbsp;)</span><span class="stl_10 stl_11 stl_746" style="word-spacing:-0.2858em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5868em; left:7.9342em;"><span class="stl_15 stl_16 stl_1285">char</span><span class="stl_15 stl_16 stl_1285" style="word-spacing:0.282em;">&nbsp;</span><span class="stl_10 stl_11 stl_1285" style="word-spacing:0.282em;">*psync_runid</span><span class="stl_10 stl_11 stl_1285" style="word-spacing:0.282em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5835em; left:7.9342em;"><span class="stl_15 stl_16 stl_464">char</span><span class="stl_15 stl_16 stl_464" style="word-spacing:0.3035em;">&nbsp;</span><span class="stl_10 stl_11 stl_464" style="word-spacing:0.3035em;">psync_offset</span><span class="stl_10 stl_11 stl_464" style="word-spacing:-0.1459em;">&nbsp;[</span><span class="stl_10 stl_11 stl_464" style="word-spacing:-0.2719em;">&nbsp;3</span><span class="stl_10 stl_11 stl_464" style="word-spacing:-0.2709em;">&nbsp;2</span><span class="stl_10 stl_11 stl_464" style="word-spacing:-0.2719em;">&nbsp;]</span><span class="stl_10 stl_11 stl_464" style="word-spacing:-0.2719em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:7.9925em;"><span class="stl_10 stl_11 stl_340" style="word-spacing:0.3427em;">sds reply</span><span class="stl_10 stl_11 stl_340" style="word-spacing:0.3427em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:8.4207em;"><span class="stl_58 stl_59 stl_403" style="word-spacing:0.3555em;">* I</span><span class="stl_58 stl_59 stl_403" style="word-spacing:-0.3045em;">&nbsp;n</span><span class="stl_58 stl_59 stl_403" style="word-spacing:-0.3035em;">&nbsp;i</span><span class="stl_58 stl_59 stl_403" style="word-spacing:-0.3035em;">&nbsp;t</span><span class="stl_58 stl_59 stl_403" style="word-spacing:-0.3035em;">&nbsp;i</span><span class="stl_58 stl_59 stl_403" style="word-spacing:-0.3045em;">&nbsp;a</span><span class="stl_58 stl_59 stl_403" style="word-spacing:-0.3035em;">&nbsp;l</span><span class="stl_58 stl_59 stl_403" style="word-spacing:-0.3035em;">&nbsp;l</span><span class="stl_58 stl_59 stl_403" style="word-spacing:-0.3045em;">&nbsp;y</span><span class="stl_58 stl_59 stl_403" style="word-spacing:0.4465em;">&nbsp;s</span><span class="stl_58 stl_59 stl_403" style="word-spacing:-0.3535em;">&nbsp;et</span><span class="stl_58 stl_59 stl_403" style="word-spacing:0.374em;">&nbsp;repl_master_initial_offset to</span><span class="stl_58 stl_59 stl_403" style="word-spacing:0.1705em;">&nbsp;</span><span class="stl_107 stl_108 stl_403" style="word-spacing:0.374em;">−</span><span class="stl_58 stl_59 stl_403" style="word-spacing:0.1705em;">1</span><span class="stl_58 stl_59 stl_403" style="word-spacing:0.1925em;">&nbsp;to</span><span class="stl_58 stl_59 stl_403" style="word-spacing:0.2535em;">&nbsp;mark &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:10.16em;"><span class="stl_58 stl_59 stl_1286" style="word-spacing:0.3498em;">the current &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 45.5718em; left:9.4687em;"><span class="stl_58 stl_59 stl_925" style="word-spacing:0.348em;">master run_id</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.309em;">&nbsp;and</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.417em;">&nbsp;o</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.237em;">&nbsp;f</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.237em;">&nbsp;f</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.237em;">&nbsp;s</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.237em;">&nbsp;e</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.237em;">&nbsp;t</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.456em;">&nbsp;as</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.373em;">&nbsp;not</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.439em;">&nbsp;v</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.26em;">&nbsp;a</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.259em;">&nbsp;l</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.26em;">&nbsp;i</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.26em;">&nbsp;d</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.113em;">&nbsp;.</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.435em;">&nbsp;Later</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.484em;">&nbsp;i</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.223em;">&nbsp;f</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.401em;">&nbsp;we</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.199em;">&nbsp;’</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.091em;">&nbsp;l</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.091em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5677em; left:10.1342em;"><span class="stl_58 stl_59 stl_1287" style="word-spacing:0.3655em;">be able to</span><span class="stl_58 stl_59 stl_1287" style="word-spacing:0.296em;">&nbsp;do &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">部分同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">147 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.4288em;"><span class="stl_58 stl_59 stl_376" style="word-spacing:0.2455em;">a FULL</span><span class="stl_58 stl_59 stl_376" style="word-spacing:0.3135em;">&nbsp;resync</span><span class="stl_58 stl_59 stl_376" style="word-spacing:0.491em;">&nbsp;using the</span><span class="stl_58 stl_59 stl_376" style="word-spacing:0.3005em;">&nbsp;PSYNC</span><span class="stl_58 stl_59 stl_376" style="word-spacing:0.1765em;">&nbsp;command</span><span class="stl_58 stl_59 stl_376" style="word-spacing:0.2765em;">&nbsp;we</span><span class="stl_58 stl_59 stl_376" style="word-spacing:-0.1295em;">&nbsp;’</span><span class="stl_58 stl_59 stl_376" style="word-spacing:-0.0225em;">&nbsp;l</span><span class="stl_58 stl_59 stl_376" style="word-spacing:-0.1195em;">&nbsp;l</span><span class="stl_58 stl_59 stl_376" style="word-spacing:0.6295em;">&nbsp;set</span><span class="stl_58 stl_59 stl_376" style="word-spacing:0.5245em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:10.2075em;"><span class="stl_58 stl_59 stl_1288" style="word-spacing:-0.3133em;">o f</span><span class="stl_58 stl_59 stl_1288" style="word-spacing:-0.3133em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1288" style="word-spacing:-0.3133em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1288" style="word-spacing:-0.3133em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1288" style="word-spacing:-0.3133em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1288" style="word-spacing:0.4057em;">&nbsp;at</span><span class="stl_58 stl_59 stl_1288" style="word-spacing:0.3477em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.5259em;"><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3276em;">r i</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3266em;">&nbsp;g</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3276em;">&nbsp;h</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3276em;">&nbsp;t</span><span class="stl_58 stl_59 stl_931" style="word-spacing:0.3844em;">&nbsp;value</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.1206em;">&nbsp;,</span><span class="stl_58 stl_59 stl_931" style="word-spacing:0.3494em;">&nbsp;so that</span><span class="stl_58 stl_59 stl_931" style="word-spacing:0.4224em;">&nbsp;t</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3206em;">&nbsp;h</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3196em;">&nbsp;i</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3206em;">&nbsp;s</span><span class="stl_58 stl_59 stl_931" style="word-spacing:0.4079em;">&nbsp;information w</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3046em;">&nbsp;i</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3056em;">&nbsp;l</span><span class="stl_58 stl_59 stl_931" style="word-spacing:-0.3046em;">&nbsp;l</span><span class="stl_58 stl_59 stl_931" style="word-spacing:0.3874em;">&nbsp;be &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:10.1517em;"><span class="stl_58 stl_59 stl_83" style="word-spacing:0.3548em;">propagated to the &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.5376em;"><span class="stl_58 stl_59 stl_1289" style="word-spacing:-0.3441em;">c l</span><span class="stl_58 stl_59 stl_1289" style="word-spacing:-0.3431em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1289" style="word-spacing:-0.3431em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1289" style="word-spacing:-0.3441em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1289" style="word-spacing:-0.3431em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1289" style="word-spacing:0.3889em;">&nbsp;structure representing</span><span class="stl_58 stl_59 stl_1289" style="word-spacing:0.3469em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1289" style="word-spacing:0.3054em;">&nbsp;master into</span><span class="stl_58 stl_59 stl_1289" style="word-spacing:0.3569em;">&nbsp;server</span><span class="stl_58 stl_59 stl_1289" style="word-spacing:0.3569em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:10.1333em;"><span class="stl_58 stl_59 stl_707" style="word-spacing:-0.185em;">master .</span><span class="stl_58 stl_59 stl_707" style="word-spacing:0.382em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:8.0175em;"><span class="stl_10 stl_11 stl_1290" style="word-spacing:-0.2177em;">server .</span><span class="stl_10 stl_11 stl_1290" style="word-spacing:-0.2197em;">&nbsp;repl_master_initial_offset</span><span class="stl_10 stl_11 stl_1290" style="word-spacing:0.1303em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1290" style="word-spacing:0.0861em;">&nbsp;</span><span class="stl_107 stl_108 stl_1290" style="word-spacing:0.1303em;">−</span><span class="stl_10 stl_11 stl_1290" style="word-spacing:0.0861em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:8.045em;"><span class="stl_15 stl_16 stl_555" style="word-spacing:-0.2748em;">i f</span><span class="stl_15 stl_16 stl_555" style="word-spacing:0.4316em;">&nbsp;</span><span class="stl_10 stl_11 stl_555" style="word-spacing:0.4316em;">(</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.2018em;">&nbsp;server</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.1458em;">&nbsp;.</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.2068em;">&nbsp;cached_master</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.2628em;">&nbsp;)</span><span class="stl_10 stl_11 stl_555" style="word-spacing:-0.2628em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">缓 存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;了</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;上</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;次</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;与</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;连</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;信</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;息，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;以</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;尝</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;试</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;部</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;分</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;步，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;减 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.904em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">少 数 据 传 输 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:9.9625em;z-index:306; "><span class="stl_10 stl_11 stl_1291" style="word-spacing:0.16em;">psync_runid =</span><span class="stl_10 stl_11 stl_1291" style="word-spacing:0.218em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1291" style="word-spacing:-0.132em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1291" style="word-spacing:-0.199em;">&nbsp;cached_master</span><span class="stl_107 stl_108 stl_1291" style="word-spacing:-0.199em;">−</span><span class="stl_10 stl_11 stl_1291" style="word-spacing:-0.199em;">&gt;replrunid</span><span class="stl_10 stl_11 stl_1291" style="word-spacing:-0.199em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:10.0175em;"><span class="stl_10 stl_11 stl_970" style="word-spacing:-0.2633em;">s n p r i n t f ( psync_offset , </span><span class="stl_15 stl_16 stl_970" style="word-spacing:-0.2633em;">sizeof </span><span class="stl_10 stl_11 stl_970" style="word-spacing:-0.2633em;">( psync_offset ) , ”%l l d ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:11.67em;z-index:388; "><span class="stl_10 stl_11 stl_1292" style="word-spacing:-0.2022em;">server . cached_master</span><span class="stl_107 stl_108 stl_1292" style="word-spacing:-0.2022em;">−</span><span class="stl_10 stl_11 stl_1292" style="word-spacing:-0.2022em;">&gt;r e p l o f f +1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:9.9933em;"><span class="stl_10 stl_11 stl_744" style="word-spacing:-0.1564em;">redisLog (REDIS_NOTICE, ” Trying␣a␣ p a r t i a l ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:11.6658em;"><span class="stl_10 stl_11 stl_421" style="word-spacing:-0.2791em;">resynchronization ␣</span><span class="stl_10 stl_11 stl_421" style="word-spacing:-0.3111em;">&nbsp;(</span><span class="stl_10 stl_11 stl_421" style="word-spacing:-0.2301em;">&nbsp;request</span><span class="stl_10 stl_11 stl_421" style="word-spacing:-0.2861em;">&nbsp;␣%s:%s</span><span class="stl_10 stl_11 stl_421" style="word-spacing:-0.2581em;">&nbsp;)</span><span class="stl_10 stl_11 stl_421" style="word-spacing:-0.2011em;">&nbsp;.</span><span class="stl_10 stl_11 stl_421" style="word-spacing:-0.2421em;">&nbsp;”</span><span class="stl_10 stl_11 stl_421" style="word-spacing:-0.1881em;">&nbsp;,</span><span class="stl_10 stl_11 stl_421" style="word-spacing:0.3199em;">&nbsp;psync_runid</span><span class="stl_10 stl_11 stl_421" style="word-spacing:0.3199em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:11.655em;"><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.2528em;">psync_offset ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.651em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">未 缓</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;上</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;次</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;与</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;连</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;信</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;息，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;全</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;z-index:539; "><span class="stl_58 stl_59 stl_807" style="word-spacing:0.3287em;">/ psync ?</span><span class="stl_58 stl_59 stl_807" style="word-spacing:0.1817em;">&nbsp;</span><span class="stl_107 stl_108 stl_807" style="word-spacing:0.3287em;">−</span><span class="stl_58 stl_59 stl_807" style="word-spacing:0.1817em;">1</span><span class="stl_58 stl_59 stl_807" style="word-spacing:0.259em;">&nbsp;</span><span class="stl_17 stl_18 stl_807" style="word-spacing:0.259em;">可</span><span class="stl_17 stl_18 stl_807" style="word-spacing:-0.2183em;">&nbsp;以</span><span class="stl_17 stl_18 stl_807" style="word-spacing:-0.2183em;">&nbsp;获</span><span class="stl_17 stl_18 stl_807" style="word-spacing:-0.2183em;">&nbsp;取</span><span class="stl_17 stl_18 stl_807" style="word-spacing:-0.2183em;">&nbsp;主</span><span class="stl_17 stl_18 stl_807" style="word-spacing:-0.2183em;">&nbsp;机</span><span class="stl_17 stl_18 stl_807" style="word-spacing:-0.2183em;">&nbsp;的</span><span class="stl_17 stl_18 stl_807" style="word-spacing:0.3709em;">&nbsp;</span><span class="stl_58 stl_59 stl_807" style="word-spacing:0.3709em;">master_runid &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:9.9933em;"><span class="stl_10 stl_11 stl_264" style="word-spacing:-0.2184em;">redisLog (REDIS_NOTICE, ” Partial ␣ resynchronization ␣not␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:11.68em;"><span class="stl_10 stl_11 stl_350" style="word-spacing:-0.2792em;">p o s s i b l e ␣ ( no␣cached␣master ) ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:9.9625em;"><span class="stl_10 stl_11 stl_274" style="word-spacing:0.1608em;">psync_runid =</span><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.0362em;">&nbsp;”?”</span><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.0362em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:9.8858em;"><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.1117em;">memcpy( psync_offset , ”</span><span class="stl_107 stl_108 stl_1174" style="word-spacing:-0.1117em;">−</span><span class="stl_10 stl_11 stl_1174" style="word-spacing:-0.1117em;">1” ,3) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 31.6235em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">向 主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;发</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;送</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;命</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;令，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;并</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;收</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;回</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;复 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:8.4207em;"><span class="stl_58 stl_59 stl_1293" style="word-spacing:0.4766em;">* Issue</span><span class="stl_58 stl_59 stl_1293" style="word-spacing:0.5416em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1293" style="word-spacing:0.3346em;">&nbsp;PSYNC</span><span class="stl_58 stl_59 stl_1293" style="word-spacing:0.2106em;">&nbsp;command</span><span class="stl_58 stl_59 stl_1293" style="word-spacing:0.3446em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:8.0092em;"><span class="stl_10 stl_11 stl_1294" style="word-spacing:0.2907em;">reply =</span><span class="stl_10 stl_11 stl_1294" style="word-spacing:0.2087em;">&nbsp;sendSynchronousCommand</span><span class="stl_10 stl_11 stl_1294" style="word-spacing:-0.1963em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1294" style="word-spacing:-0.1643em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_1294" style="word-spacing:-0.0243em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1294" style="word-spacing:-0.1293em;">&nbsp;”PSYNC”</span><span class="stl_10 stl_11 stl_1294" style="word-spacing:-0.0763em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1294" style="word-spacing:-0.1673em;">&nbsp;psync_runid</span><span class="stl_10 stl_11 stl_1294" style="word-spacing:-0.1673em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:9.655em;"><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.07em;">psync_offset ,NULL) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6051em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6051em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">全</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:8.045em;"><span class="stl_15 stl_16 stl_1184" style="word-spacing:-0.1065em;">i f</span><span class="stl_15 stl_16 stl_1184" style="word-spacing:0.6722em;">&nbsp;</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:0.6722em;">(</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:-0.1055em;">&nbsp;!</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:-0.0255em;">&nbsp;strncmp</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:-0.0975em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:-0.0625em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:0.1075em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:-0.0575em;">&nbsp;”+FULLRESYNC”</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:-0.015em;">&nbsp;,11) )</span><span class="stl_10 stl_11 stl_1184" style="word-spacing:-0.015em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:9.9267em;"><span class="stl_15 stl_16 stl_1295">char</span><span class="stl_15 stl_16 stl_1295" style="word-spacing:0.4002em;">&nbsp;</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:0.4002em;">*</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:-0.1329em;">&nbsp;runid</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:0.3281em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:0.1601em;">&nbsp;NULL,</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:0.5181em;">&nbsp;*</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:-0.0629em;">&nbsp;o</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:-0.1129em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:-0.1129em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:-0.1119em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:-0.1129em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:-0.1129em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:0.3981em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:0.1481em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5901em; left:10.4132em;"><span class="stl_58 stl_59 stl_1296" style="word-spacing:0.2422em;">* FULL</span><span class="stl_58 stl_59 stl_1296" style="word-spacing:0.1112em;">&nbsp;RESYNC,</span><span class="stl_58 stl_59 stl_1296" style="word-spacing:0.4887em;">&nbsp;parse the reply in</span><span class="stl_58 stl_59 stl_1296" style="word-spacing:0.4602em;">&nbsp;order to</span><span class="stl_58 stl_59 stl_1296" style="word-spacing:0.5052em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1296" style="word-spacing:-0.2148em;">&nbsp;x</span><span class="stl_58 stl_59 stl_1296" style="word-spacing:-0.2148em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1296" style="word-spacing:-0.2138em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1296" style="word-spacing:-0.2148em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1296" style="word-spacing:-0.2138em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1296" style="word-spacing:-0.2138em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:11.6542em;"><span class="stl_58 stl_59 stl_265" style="word-spacing:0.3395em;">the run id &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 42.5826em; left:11.4296em;"><span class="stl_58 stl_59 stl_854" style="word-spacing:0.3612em;">and the</span><span class="stl_58 stl_59 stl_854" style="word-spacing:0.4702em;">&nbsp;r</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2528em;">&nbsp;e</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2538em;">&nbsp;p</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2528em;">&nbsp;l</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2538em;">&nbsp;i</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2538em;">&nbsp;c</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2528em;">&nbsp;a</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2538em;">&nbsp;t</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2528em;">&nbsp;i</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2538em;">&nbsp;o</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2528em;">&nbsp;n</span><span class="stl_58 stl_59 stl_854" style="word-spacing:0.5282em;">&nbsp;o</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2348em;">&nbsp;f</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2348em;">&nbsp;f</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2348em;">&nbsp;s</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2348em;">&nbsp;e</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.2348em;">&nbsp;t</span><span class="stl_58 stl_59 stl_854" style="word-spacing:-0.0878em;">&nbsp;.</span><span class="stl_58 stl_59 stl_854" style="word-spacing:0.3882em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:9.9825em;"><span class="stl_10 stl_11 stl_251" style="word-spacing:0.119em;">runid =</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.093em;">&nbsp;strchr (</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.282em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.112em;">&nbsp;,</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.126em;">&nbsp;’</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.345em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.237em;">&nbsp;’</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.29em;">&nbsp;)</span><span class="stl_10 stl_11 stl_251" style="word-spacing:-0.29em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5685em; left:10.0375em;"><span class="stl_15 stl_16 stl_1297" style="word-spacing:-0.295em;">i f</span><span class="stl_15 stl_16 stl_1297" style="word-spacing:0.4114em;">&nbsp;</span><span class="stl_10 stl_11 stl_1297" style="word-spacing:0.4114em;">(</span><span class="stl_10 stl_11 stl_1297" style="word-spacing:-0.256em;">&nbsp;runid</span><span class="stl_10 stl_11 stl_1297" style="word-spacing:-0.255em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1297" style="word-spacing:-0.255em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:11.975em;"><span class="stl_10 stl_11 stl_434">runid++; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:12.0325em;"><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.3182em;">o f</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.3182em;">&nbsp;f</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.3182em;">&nbsp;s</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.3182em;">&nbsp;e</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.3172em;">&nbsp;t</span><span class="stl_10 stl_11 stl_87" style="word-spacing:0.1928em;">&nbsp;=</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.0854em;">&nbsp;strchr (</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.2982em;">&nbsp;runid</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.1482em;">&nbsp;,</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.1232em;">&nbsp;’</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.3402em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.2342em;">&nbsp;’</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.2852em;">&nbsp;)</span><span class="stl_10 stl_11 stl_87" style="word-spacing:-0.2852em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">148 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:12.03em;"><span class="stl_15 stl_16 stl_43" style="word-spacing:-0.058em;">i f</span><span class="stl_15 stl_16 stl_43" style="word-spacing:0.6484em;">&nbsp;</span><span class="stl_10 stl_11 stl_43" style="word-spacing:0.6484em;">(</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.003em;">&nbsp;o f</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.053em;">&nbsp;f</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.054em;">&nbsp;s</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.054em;">&nbsp;e</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.054em;">&nbsp;t</span><span class="stl_10 stl_11 stl_43" style="word-spacing:0.052em;">&nbsp;)</span><span class="stl_10 stl_11 stl_43" style="word-spacing:0.651em;">&nbsp;o</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.053em;">&nbsp;f</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.054em;">&nbsp;f</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.054em;">&nbsp;s</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.054em;">&nbsp;e</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.054em;">&nbsp;t</span><span class="stl_10 stl_11 stl_43" style="word-spacing:-0.062em;">&nbsp;++; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 7.7068em; left:10.0375em;"><span class="stl_15 stl_16 stl_682" style="word-spacing:-0.2308em;">i f</span><span class="stl_15 stl_16 stl_682" style="word-spacing:0.5478em;">&nbsp;</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.5478em;">(</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2298em;">&nbsp;!</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1188em;">&nbsp;runid</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.5182em;">&nbsp;|</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1928em;">&nbsp;|</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.5692em;">&nbsp;!</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.0658em;">&nbsp;o</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2268em;">&nbsp;f</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2268em;">&nbsp;f</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2258em;">&nbsp;s</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2268em;">&nbsp;e</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2268em;">&nbsp;t</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.5882em;">&nbsp;|</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1928em;">&nbsp;|</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.5142em;">&nbsp;(</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1438em;">&nbsp;o</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2498em;">&nbsp;f</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2488em;">&nbsp;f</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2488em;">&nbsp;s</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2498em;">&nbsp;e</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2488em;">&nbsp;t</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1804em;">&nbsp;</span><span class="stl_107 stl_108 stl_682" style="word-spacing:-0.2488em;">−</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1804em;">runid</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1839em;">&nbsp;</span><span class="stl_107 stl_108 stl_682" style="word-spacing:-0.1804em;">−</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1839em;">1)</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.2742em;">&nbsp;!= &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:11.5183em;"><span class="stl_10 stl_11 stl_1298" style="word-spacing:0.5724em;">REDIS_RUN_ID_SIZE) { &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:11.9858em;"><span class="stl_10 stl_11 stl_34" style="word-spacing:-0.0137em;">redisLog (REDIS_WARNING, &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:13.9292em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 10.7001em; left:14.4406em;"><span class="stl_10 stl_11 stl_524" style="word-spacing:-0.1476em;">Master␣ r e p l i e d ␣with␣wrong␣+FULLRESYNC␣ syntax &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:15.67em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 11.6968em; left:16.0868em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.032em;">” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:12.4057em;"><span class="stl_58 stl_59 stl_1299" style="word-spacing:0.2778em;">* This</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:0.3798em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:-0.3102em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:0.3308em;">&nbsp;an</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:0.2828em;">&nbsp;unexpected</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:0.3628em;">&nbsp;condition</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:-0.0822em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:0.4358em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:-0.3112em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:-0.3112em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:-0.3112em;">&nbsp;u</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:-0.3112em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:-0.3102em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:-0.3112em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:-0.3112em;">&nbsp;y</span><span class="stl_58 stl_59 stl_1299" style="word-spacing:0.4138em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:13.4742em;z-index:208; "><span class="stl_58 stl_59 stl_07">+</span></div>
					<div class="stl_01" style="top: 13.691em; left:13.9806em;"><span class="stl_58 stl_59 stl_1300">FULLRESYNC &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 16.6801em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 18.6726em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 14.6876em; left:13.4968em;"><span class="stl_58 stl_59 stl_173" style="word-spacing:0.3638em;">reply means that</span><span class="stl_58 stl_59 stl_173" style="word-spacing:0.4473em;">&nbsp;the</span><span class="stl_58 stl_59 stl_173" style="word-spacing:0.3993em;">&nbsp;master supports</span><span class="stl_58 stl_59 stl_173" style="word-spacing:0.2463em;">&nbsp;PSYNC, &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:14.1392em;"><span class="stl_58 stl_59 stl_1127" style="word-spacing:0.3398em;">but the reply &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:13.4603em;"><span class="stl_58 stl_59 stl_1301" style="word-spacing:0.3282em;">format seems</span><span class="stl_58 stl_59 stl_1301" style="word-spacing:0.2922em;">&nbsp;wrong</span><span class="stl_58 stl_59 stl_1301" style="word-spacing:-0.2358em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1301" style="word-spacing:0.2837em;">&nbsp;To stay</span><span class="stl_58 stl_59 stl_1301" style="word-spacing:0.4292em;">&nbsp;safe</span><span class="stl_58 stl_59 stl_1301" style="word-spacing:0.3127em;">&nbsp;we blank</span><span class="stl_58 stl_59 stl_1301" style="word-spacing:0.4032em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:14.1183em;"><span class="stl_58 stl_59 stl_963">master &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:13.4686em;"><span class="stl_58 stl_59 stl_1302" style="word-spacing:0.4564em;">runid to</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:0.3739em;">&nbsp;make sure</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:0.4574em;">&nbsp;next</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:0.3074em;">&nbsp;PSYNCs</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:0.3744em;">&nbsp;w</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:-0.1896em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:-0.1896em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:-0.1886em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:0.6144em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:-0.1686em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:-0.1686em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:-0.1696em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:-0.0216em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1302" style="word-spacing:0.4334em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:11.9142em;"><span class="stl_10 stl_11 stl_274" style="word-spacing:-0.1721em;">memset( server . repl_master_runid , 0 , &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:13.5108em;"><span class="stl_10 stl_11 stl_1303" style="word-spacing:0.0049em;">REDIS_RUN_ID_SIZE+1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 21.6543em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:12.4057em;"><span class="stl_58 stl_59 stl_961">/</span><span class="stl_58 stl_59 stl_961" style="word-spacing:0.2898em;">&nbsp;</span><span class="stl_17 stl_18 stl_961" style="word-spacing:0.2898em;">拷</span><span class="stl_17 stl_18 stl_961" style="word-spacing:-0.271em;">&nbsp;贝</span><span class="stl_17 stl_18 stl_961" style="word-spacing:0.3411em;">&nbsp;</span><span class="stl_58 stl_59 stl_961" style="word-spacing:0.3411em;">runid &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6518em; left:11.8783em;"><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.171em;">memcpy( server</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.116em;">&nbsp;.</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.167em;">&nbsp;repl_master_runid</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.075em;">&nbsp;,</span><span class="stl_10 stl_11 stl_676" style="word-spacing:0.435em;">&nbsp;runid</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.069em;">&nbsp;,</span><span class="stl_10 stl_11 stl_676" style="word-spacing:0.498em;">&nbsp;o</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.262em;">&nbsp;f</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.263em;">&nbsp;f</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.262em;">&nbsp;s</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.262em;">&nbsp;e</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.263em;">&nbsp;t</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.1942em;">&nbsp;</span><span class="stl_107 stl_108 stl_676" style="word-spacing:-0.263em;">− &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:13.6225em;z-index:469; "><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.1891em;">runid </span><span class="stl_107 stl_108 stl_105" style="word-spacing:-0.1891em;">−</span><span class="stl_10 stl_11 stl_105" style="word-spacing:-0.1891em;">1) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:12.0025em;"><span class="stl_10 stl_11 stl_910" style="word-spacing:-0.0417em;">server .</span><span class="stl_10 stl_11 stl_910" style="word-spacing:-0.0897em;">&nbsp;repl_master_runid</span><span class="stl_10 stl_11 stl_910" style="word-spacing:-0.0888em;">&nbsp;[REDIS_RUN_ID_SIZE]</span><span class="stl_10 stl_11 stl_910" style="word-spacing:0.3252em;">&nbsp;=</span><span class="stl_10 stl_11 stl_910" style="word-spacing:0.3792em;">&nbsp;’</span><span class="stl_10 stl_11 stl_910" style="word-spacing:-0.1728em;">&nbsp;\0 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:13.7217em;"><span class="stl_10 stl_11 stl_07">’</span></div>
					<div class="stl_01" style="top: 26.641em; left:14.175em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:12.0025em;"><span class="stl_10 stl_11 stl_605" style="word-spacing:-0.2294em;">server .</span><span class="stl_10 stl_11 stl_605" style="word-spacing:-0.2314em;">&nbsp;repl_master_initial_offset</span><span class="stl_10 stl_11 stl_605" style="word-spacing:0.1186em;">&nbsp;=</span><span class="stl_10 stl_11 stl_605" style="word-spacing:-0.1628em;">&nbsp;s t</span><span class="stl_10 stl_11 stl_605" style="word-spacing:-0.3364em;">&nbsp;r</span><span class="stl_10 stl_11 stl_605" style="word-spacing:-0.3374em;">&nbsp;t</span><span class="stl_10 stl_11 stl_605" style="word-spacing:-0.3364em;">&nbsp;o</span><span class="stl_10 stl_11 stl_605" style="word-spacing:-0.3374em;">&nbsp;l</span><span class="stl_10 stl_11 stl_605" style="word-spacing:-0.3364em;">&nbsp;l</span><span class="stl_10 stl_11 stl_605" style="word-spacing:-0.3364em;">&nbsp;( &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:13.6742em;"><span class="stl_10 stl_11 stl_1021" style="word-spacing:-0.1647em;">o f</span><span class="stl_10 stl_11 stl_1021" style="word-spacing:-0.1637em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1021" style="word-spacing:-0.1637em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1021" style="word-spacing:-0.1647em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1021" style="word-spacing:-0.1637em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1021" style="word-spacing:-0.0204em;">&nbsp;,NULL, 10)</span><span class="stl_10 stl_11 stl_1021" style="word-spacing:-0.0204em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:11.9858em;"><span class="stl_10 stl_11 stl_1304" style="word-spacing:-0.1698em;">redisLog (REDIS_NOTICE, ” Full ␣ resync ␣from␣master : ␣% &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:13.6292em;"><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.2em;">s:% l l d ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:13.995em;"><span class="stl_10 stl_11 stl_521" style="word-spacing:-0.1577em;">server . repl_master_runid , &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:13.995em;"><span class="stl_10 stl_11 stl_605" style="word-spacing:-0.2539em;">server . repl_master_initial_offset ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.6126em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:10.4132em;"><span class="stl_58 stl_59 stl_759" style="word-spacing:0.1119em;">* We</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.1539em;">&nbsp;are</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.3664em;">&nbsp;going to</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.4669em;">&nbsp;f</span><span class="stl_58 stl_59 stl_759" style="word-spacing:-0.2521em;">&nbsp;u</span><span class="stl_58 stl_59 stl_759" style="word-spacing:-0.2521em;">&nbsp;l</span><span class="stl_58 stl_59 stl_759" style="word-spacing:-0.2531em;">&nbsp;l</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.4479em;">&nbsp;resync</span><span class="stl_58 stl_59 stl_759" style="word-spacing:-0.1141em;">&nbsp;,</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.4079em;">&nbsp;discard the</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.3609em;">&nbsp;cached &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:11.6275em;"><span class="stl_58 stl_59 stl_1198" style="word-spacing:0.3461em;">master structure</span><span class="stl_58 stl_59 stl_1198" style="word-spacing:-0.1999em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1198" style="word-spacing:0.3111em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:9.9925em;"><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.2132em;">replicationDiscardCachedMaster () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:10.0225em;"><span class="stl_10 stl_11 stl_1305" style="word-spacing:-0.3214em;">s d s f r e e ( reply ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:9.9383em;"><span class="stl_15 stl_16 stl_1306" style="word-spacing:0.4102em;">return </span><span class="stl_10 stl_11 stl_1306" style="word-spacing:0.4102em;">PSYNC_FULLRESYNC; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 41.586em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">部</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:8.045em;"><span class="stl_15 stl_16 stl_505" style="word-spacing:-0.1127em;">i f</span><span class="stl_15 stl_16 stl_505" style="word-spacing:0.6659em;">&nbsp;</span><span class="stl_10 stl_11 stl_505" style="word-spacing:0.6659em;">(</span><span class="stl_10 stl_11 stl_505" style="word-spacing:-0.1117em;">&nbsp;!</span><span class="stl_10 stl_11 stl_505" style="word-spacing:-0.0317em;">&nbsp;strncmp</span><span class="stl_10 stl_11 stl_505" style="word-spacing:-0.1037em;">&nbsp;(</span><span class="stl_10 stl_11 stl_505" style="word-spacing:-0.0687em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_505" style="word-spacing:0.1013em;">&nbsp;,</span><span class="stl_10 stl_11 stl_505" style="word-spacing:-0.0637em;">&nbsp;”+CONTINUE”</span><span class="stl_10 stl_11 stl_505" style="word-spacing:-0.0142em;">&nbsp;,9) )</span><span class="stl_10 stl_11 stl_505" style="word-spacing:-0.0142em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:10.4132em;"><span class="stl_58 stl_59 stl_888" style="word-spacing:0.3169em;">* Partial</span><span class="stl_58 stl_59 stl_888" style="word-spacing:0.3729em;">&nbsp;resync</span><span class="stl_58 stl_59 stl_888" style="word-spacing:0.2759em;">&nbsp;was accepted</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.1241em;">&nbsp;,</span><span class="stl_58 stl_59 stl_888" style="word-spacing:0.3959em;">&nbsp;set the r</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.3271em;">&nbsp;e</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.3261em;">&nbsp;p</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.3271em;">&nbsp;l</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.3271em;">&nbsp;i</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.3261em;">&nbsp;c</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.3271em;">&nbsp;a</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.3261em;">&nbsp;t</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.3271em;">&nbsp;i</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.3261em;">&nbsp;o</span><span class="stl_58 stl_59 stl_888" style="word-spacing:-0.3261em;">&nbsp;n &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:11.6833em;"><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.3523em;">s t</span><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.3523em;">&nbsp;a</span><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.3513em;">&nbsp;t</span><span class="stl_58 stl_59 stl_334" style="word-spacing:-0.3523em;">&nbsp;e</span><span class="stl_58 stl_59 stl_334" style="word-spacing:0.3857em;">&nbsp;accordingly</span><span class="stl_58 stl_59 stl_334" style="word-spacing:0.2867em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:9.9933em;"><span class="stl_10 stl_11 stl_98" style="word-spacing:-0.0678em;">redisLog (REDIS_NOTICE, &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:11.9367em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 46.566em; left:12.5037em;"><span class="stl_10 stl_11 stl_569" style="word-spacing:-0.3314em;">Successful ␣ p a r t i a l ␣ resynchronization ␣with␣master &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">部分同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">149 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:13.6775em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 5.7193em; left:14.0943em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.032em;">” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:10.0225em;"><span class="stl_10 stl_11 stl_1305" style="word-spacing:-0.3214em;">s d s f r e e ( reply ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:10.4132em;"><span class="stl_58 stl_59 stl_1307">/</span><span class="stl_58 stl_59 stl_1307" style="word-spacing:0.4688em;">&nbsp;</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:0.4688em;">缓</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.092em;">&nbsp;存</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.091em;">&nbsp;主</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.091em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.091em;">&nbsp;替</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.091em;">&nbsp;代</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.091em;">&nbsp;现</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.091em;">&nbsp;有</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.091em;">&nbsp;主</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.057em;">&nbsp;机，</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.058em;">&nbsp;且</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.091em;">&nbsp;为</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:0.3353em;">&nbsp;</span><span class="stl_58 stl_59 stl_1307" style="word-spacing:0.3353em;">PSYNC</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:0.3353em;">（部</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.057em;">&nbsp;分</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.091em;">&nbsp;同</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:-0.058em;">&nbsp;步）</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:0.543em;">&nbsp;做</span><span class="stl_17 stl_18 stl_1307" style="word-spacing:0.543em;">&nbsp;好 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:11.6342em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0651em;">准 备 </span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.0651em;">c &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:9.995em;"><span class="stl_10 stl_11 stl_1065" style="word-spacing:-0.2663em;">replicationResurrectCachedMaster ( fd ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:9.9383em;"><span class="stl_15 stl_16 stl_425" style="word-spacing:0.4021em;">return </span><span class="stl_10 stl_11 stl_425" style="word-spacing:0.4021em;">PSYNC_CONTINUE; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_327" style="word-spacing:0.3509em;">* I</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.3081em;">&nbsp;f</span><span class="stl_58 stl_59 stl_327" style="word-spacing:0.3169em;">&nbsp;we</span><span class="stl_58 stl_59 stl_327" style="word-spacing:0.2539em;">&nbsp;reach</span><span class="stl_58 stl_59 stl_327" style="word-spacing:0.3969em;">&nbsp;t</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.3091em;">&nbsp;h</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.3081em;">&nbsp;i</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.3091em;">&nbsp;s</span><span class="stl_58 stl_59 stl_327" style="word-spacing:0.4209em;">&nbsp;point</span><span class="stl_58 stl_59 stl_327" style="word-spacing:0.2824em;">&nbsp;we receied</span><span class="stl_58 stl_59 stl_327" style="word-spacing:0.4219em;">&nbsp;e</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.3191em;">&nbsp;i</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.3191em;">&nbsp;t</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.3191em;">&nbsp;h</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.3181em;">&nbsp;e</span><span class="stl_58 stl_59 stl_327" style="word-spacing:-0.3191em;">&nbsp;r</span><span class="stl_58 stl_59 stl_327" style="word-spacing:0.3239em;">&nbsp;an</span><span class="stl_58 stl_59 stl_327" style="word-spacing:0.2919em;">&nbsp;error &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.6692em;"><span class="stl_58 stl_59 stl_571" style="word-spacing:0.3863em;">since the</span><span class="stl_58 stl_59 stl_571" style="word-spacing:0.3338em;">&nbsp;master</span><span class="stl_58 stl_59 stl_571" style="word-spacing:0.3338em;">&nbsp;does &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.4745em;"><span class="stl_58 stl_59 stl_1308" style="word-spacing:0.3831em;">not understand</span><span class="stl_58 stl_59 stl_1308" style="word-spacing:0.2221em;">&nbsp;PSYNC,</span><span class="stl_58 stl_59 stl_1308" style="word-spacing:0.4131em;">&nbsp;or</span><span class="stl_58 stl_59 stl_1308" style="word-spacing:0.3201em;">&nbsp;an unexpected</span><span class="stl_58 stl_59 stl_1308" style="word-spacing:0.4341em;">&nbsp;reply</span><span class="stl_58 stl_59 stl_1308" style="word-spacing:0.3796em;">&nbsp;from</span><span class="stl_58 stl_59 stl_1308" style="word-spacing:0.3796em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:10.1333em;"><span class="stl_58 stl_59 stl_963" style="word-spacing:-0.1962em;">master . &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:9.4695em;"><span class="stl_58 stl_59 stl_1309" style="word-spacing:0.5662em;">Reply with</span><span class="stl_58 stl_59 stl_1309" style="word-spacing:0.3662em;">&nbsp;PSYNC_NOT_SUPPORTED in</span><span class="stl_58 stl_59 stl_1309" style="word-spacing:0.5907em;">&nbsp;both cases</span><span class="stl_58 stl_59 stl_1309" style="word-spacing:0.0282em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1309" style="word-spacing:0.5612em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.661em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.661em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;收</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;发</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;出</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;错</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;误</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;信</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;息 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:8.045em;z-index:310; "><span class="stl_15 stl_16 stl_453" style="word-spacing:-0.1666em;">i f</span><span class="stl_15 stl_16 stl_453" style="word-spacing:0.5398em;">&nbsp;</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.5398em;">(</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.1576em;">&nbsp;strncmp</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.1576em;">&nbsp;(</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.1226em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.0702em;">&nbsp;, ”</span><span class="stl_107 stl_108 stl_453" style="word-spacing:-0.0702em;">−</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.0702em;">ERR”</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.0266em;">&nbsp;,4)</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.1106em;">&nbsp;)</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.1106em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:10.4133em;"><span class="stl_58 stl_59 stl_571" style="word-spacing:0.3562em;">* I</span><span class="stl_58 stl_59 stl_571" style="word-spacing:-0.3028em;">&nbsp;f</span><span class="stl_58 stl_59 stl_571" style="word-spacing:0.4842em;">&nbsp;i</span><span class="stl_58 stl_59 stl_571" style="word-spacing:-0.2848em;">&nbsp;t</span><span class="stl_58 stl_59 stl_571" style="word-spacing:-0.0898em;">&nbsp;’</span><span class="stl_58 stl_59 stl_571" style="word-spacing:-0.2778em;">&nbsp;s</span><span class="stl_58 stl_59 stl_571" style="word-spacing:0.3222em;">&nbsp;not</span><span class="stl_58 stl_59 stl_571" style="word-spacing:0.2742em;">&nbsp;an error</span><span class="stl_58 stl_59 stl_571" style="word-spacing:-0.1068em;">&nbsp;,</span><span class="stl_58 stl_59 stl_571" style="word-spacing:0.4062em;">&nbsp;log the</span><span class="stl_58 stl_59 stl_571" style="word-spacing:0.3637em;">&nbsp;unexpected event</span><span class="stl_58 stl_59 stl_571" style="word-spacing:-0.2038em;">&nbsp;.</span><span class="stl_58 stl_59 stl_571" style="word-spacing:0.3342em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:9.9933em;"><span class="stl_10 stl_11 stl_34" style="word-spacing:-0.0137em;">redisLog (REDIS_WARNING, &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:11.9367em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 25.6443em; left:12.4481em;"><span class="stl_10 stl_11 stl_1310" style="word-spacing:-0.1777em;">Unexpected␣ reply ␣ to ␣PSYNC␣from␣master : ␣%s ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:13.6542em;"><span class="stl_10 stl_11 stl_1305" style="word-spacing:-0.265em;">reply ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 31.6218em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 27.6318em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:9.9933em;"><span class="stl_10 stl_11 stl_98" style="word-spacing:-0.0678em;">redisLog (REDIS_NOTICE, &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:11.9367em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 30.626em; left:11.9367em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 29.6293em; left:12.4481em;"><span class="stl_10 stl_11 stl_396" style="word-spacing:-0.2149em;">Master␣ does ␣not␣ support ␣PSYNC␣ or ␣ i s ␣ in ␣” &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:12.5029em;"><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2938em;">error ␣</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2938em;">&nbsp;state</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2938em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.3348em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2518em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.1968em;">&nbsp;:</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2798em;">&nbsp;␣%s</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2828em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.3218em;">&nbsp;”</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2118em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:0.3502em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2518em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:-0.2518em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:8.03em;"><span class="stl_10 stl_11 stl_1305" style="word-spacing:-0.3214em;">s d s f r e e ( reply ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:8em;"><span class="stl_10 stl_11 stl_1197" style="word-spacing:-0.2132em;">replicationDiscardCachedMaster () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:7.9458em;"><span class="stl_15 stl_16 stl_1311" style="word-spacing:0.4337em;">return </span><span class="stl_10 stl_11 stl_1311" style="word-spacing:0.4337em;">PSYNC_NOT_SUPPORTED; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.601em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:6.4282em;"><span class="stl_58 stl_59 stl_1227">/</span><span class="stl_58 stl_59 stl_1227" style="word-spacing:0.6046em;">&nbsp;</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.6046em;">主</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.0437em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.4722em;">&nbsp;</span><span class="stl_58 stl_59 stl_1227" style="word-spacing:0.4722em;">SYNC</span><span class="stl_58 stl_59 stl_1227" style="word-spacing:0.4715em;">&nbsp;</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.4715em;">和</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.4708em;">&nbsp;</span><span class="stl_58 stl_59 stl_1227" style="word-spacing:0.4708em;">PSYNC</span><span class="stl_58 stl_59 stl_1227" style="word-spacing:0.4707em;">&nbsp;</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.4707em;">命</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.0447em;">&nbsp;令 处 理 函</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.0782em;">&nbsp;数， 会</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.0447em;">&nbsp;尝 试 进 行 部 分 同 步 和 全</span><span class="stl_17 stl_18 stl_1227" style="word-spacing:0.0447em;">&nbsp;同 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.8182em; left:7.6492em;"><span class="stl_17 stl_18 stl_07">步</span></div>
					<div class="stl_01" style="top: 39.5935em; left:6.4282em;"><span class="stl_58 stl_59 stl_767" style="word-spacing:0.2759em;">* SYNC ad PSYNC</span><span class="stl_58 stl_59 stl_767" style="word-spacing:0.2165em;">&nbsp;command</span><span class="stl_58 stl_59 stl_767" style="word-spacing:0.3905em;">&nbsp;implemenation</span><span class="stl_58 stl_59 stl_767" style="word-spacing:-0.0635em;">&nbsp;.</span><span class="stl_58 stl_59 stl_767" style="word-spacing:0.4965em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5835em; left:5.9483em;"><span class="stl_15 stl_16 stl_1228">void</span><span class="stl_15 stl_16 stl_1228" style="word-spacing:0.3434em;">&nbsp;</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:0.3434em;">syncCommand(</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.0616em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1686em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1686em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1676em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1686em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:0.4824em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1396em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1228" style="word-spacing:-0.1396em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 41.5843em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:8.4207em;"><span class="stl_58 stl_59 stl_1312">/</span><span class="stl_58 stl_59 stl_1312" style="word-spacing:0.5962em;">&nbsp;</span><span class="stl_17 stl_18 stl_1312" style="word-spacing:0.5962em;">主</span><span class="stl_17 stl_18 stl_1312" style="word-spacing:0.0362em;">&nbsp;机 尝 试 部 分 同</span><span class="stl_17 stl_18 stl_1312" style="word-spacing:0.0699em;">&nbsp;步， 允</span><span class="stl_17 stl_18 stl_1312" style="word-spacing:0.0364em;">&nbsp;许 则 进 行 部 分 同</span><span class="stl_17 stl_18 stl_1312" style="word-spacing:0.0699em;">&nbsp;步， 会</span><span class="stl_17 stl_18 stl_1312" style="word-spacing:0.0364em;">&nbsp;返 回</span><span class="stl_17 stl_18 stl_1312" style="word-spacing:0.4526em;">&nbsp;</span><span class="stl_58 stl_59 stl_1312" style="word-spacing:0.4526em;">+CONTINUE &nbsp;</span></div>
					<div class="stl_01" style="top: 44.7957em; left:9.6417em;"><span class="stl_17 stl_18 stl_07">，</span></div>
					<div class="stl_01" style="top: 44.7957em; left:10.6371em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">接 着 发 送 积 压 空 间 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5677em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.5677em; left:8.4207em;"><span class="stl_58 stl_59 stl_814" style="word-spacing:0.2663em;">* Try a</span><span class="stl_58 stl_59 stl_814" style="word-spacing:0.3833em;">&nbsp;p</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2607em;">&nbsp;a</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2617em;">&nbsp;r</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2607em;">&nbsp;t</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2607em;">&nbsp;i</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2607em;">&nbsp;a</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2617em;">&nbsp;l</span><span class="stl_58 stl_59 stl_814" style="word-spacing:0.4893em;">&nbsp;resynchronization i</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2347em;">&nbsp;f</span><span class="stl_58 stl_59 stl_814" style="word-spacing:0.5333em;">&nbsp;t</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2607em;">&nbsp;h</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2617em;">&nbsp;i</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2617em;">&nbsp;s</span><span class="stl_58 stl_59 stl_814" style="word-spacing:0.5003em;">&nbsp;i</span><span class="stl_58 stl_59 stl_814" style="word-spacing:-0.2687em;">&nbsp;s</span><span class="stl_58 stl_59 stl_814" style="word-spacing:0.3763em;">&nbsp;a</span><span class="stl_58 stl_59 stl_814" style="word-spacing:0.1413em;">&nbsp;PSYNC &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">150 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.5592em;"><span class="stl_58 stl_59 stl_491">command. &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 6.7168em; left:9.5326em;"><span class="stl_58 stl_59 stl_969" style="word-spacing:-0.3089em;">I f</span><span class="stl_58 stl_59 stl_969" style="word-spacing:0.4781em;">&nbsp;i</span><span class="stl_58 stl_59 stl_969" style="word-spacing:-0.2909em;">&nbsp;t</span><span class="stl_58 stl_59 stl_969" style="word-spacing:0.4821em;">&nbsp;f</span><span class="stl_58 stl_59 stl_969" style="word-spacing:-0.3049em;">&nbsp;a</span><span class="stl_58 stl_59 stl_969" style="word-spacing:-0.3059em;">&nbsp;i</span><span class="stl_58 stl_59 stl_969" style="word-spacing:-0.3049em;">&nbsp;l</span><span class="stl_58 stl_59 stl_969" style="word-spacing:-0.3049em;">&nbsp;s</span><span class="stl_58 stl_59 stl_969" style="word-spacing:0.0141em;">&nbsp;,</span><span class="stl_58 stl_59 stl_969" style="word-spacing:0.2801em;">&nbsp;we continue</span><span class="stl_58 stl_59 stl_969" style="word-spacing:0.3611em;">&nbsp;with usual</span><span class="stl_58 stl_59 stl_969" style="word-spacing:0.4561em;">&nbsp;f</span><span class="stl_58 stl_59 stl_969" style="word-spacing:-0.2689em;">&nbsp;u</span><span class="stl_58 stl_59 stl_969" style="word-spacing:-0.2699em;">&nbsp;l</span><span class="stl_58 stl_59 stl_969" style="word-spacing:-0.2699em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.1642em;"><span class="stl_58 stl_59 stl_996" style="word-spacing:-0.0815em;">resynchronization ,</span><span class="stl_58 stl_59 stl_996" style="word-spacing:0.3485em;">&nbsp;however &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.4255em;"><span class="stl_58 stl_59 stl_1109" style="word-spacing:0.335em;">when t</span><span class="stl_58 stl_59 stl_1109" style="word-spacing:-0.306em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1109" style="word-spacing:-0.306em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1109" style="word-spacing:-0.305em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1109" style="word-spacing:0.384em;">&nbsp;happens</span><span class="stl_58 stl_59 stl_1109" style="word-spacing:0.339em;">&nbsp;masterTryPartialResynchronization</span><span class="stl_58 stl_59 stl_1109" style="word-spacing:-0.224em;">&nbsp;() &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.165em;"><span class="stl_58 stl_59 stl_1313">already &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 10.7018em; left:9.5243em;"><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3257em;">r e</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3257em;">&nbsp;p</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3257em;">&nbsp;l</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3257em;">&nbsp;i</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3247em;">&nbsp;e</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3257em;">&nbsp;d</span><span class="stl_58 stl_59 stl_721" style="word-spacing:0.3913em;">&nbsp;with</span><span class="stl_58 stl_59 stl_721" style="word-spacing:0.3913em;">&nbsp;: &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.3225em;"><span class="stl_58 stl_59 stl_1314" style="word-spacing:0.1744em;">+FULLRESYNC &lt;runid&gt; &lt;o</span><span class="stl_58 stl_59 stl_1314" style="word-spacing:-0.0656em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1314" style="word-spacing:-0.0646em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1314" style="word-spacing:-0.0656em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1314" style="word-spacing:-0.0656em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1314" style="word-spacing:-0.0656em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1314" style="word-spacing:-0.0656em;">&nbsp;&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:9.4271em;"><span class="stl_58 stl_59 stl_1105" style="word-spacing:0.3363em;">So the</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:0.4443em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:-0.2807em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:-0.2797em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:-0.2797em;">&nbsp;v</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:-0.2807em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:0.3728em;">&nbsp;knows the</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:0.321em;">&nbsp;new runid and</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:0.4053em;">&nbsp;o</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:-0.2487em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:-0.2487em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:-0.2487em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:-0.2487em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:-0.2487em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:0.4493em;">&nbsp;to try</span><span class="stl_58 stl_59 stl_1105" style="word-spacing:0.4493em;">&nbsp;a &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.9958em;"><span class="stl_58 stl_59 stl_1315" style="word-spacing:0.5935em;">PSYNC l</span><span class="stl_58 stl_59 stl_1315" style="word-spacing:0.0673em;">&nbsp;a t e</span><span class="stl_58 stl_59 stl_1315" style="word-spacing:0.0673em;">&nbsp;r &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.5542em;"><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.2744em;">i f</span><span class="stl_58 stl_59 stl_725" style="word-spacing:0.4506em;">&nbsp;the</span><span class="stl_58 stl_59 stl_725" style="word-spacing:0.3676em;">&nbsp;connection with the master i</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.3074em;">&nbsp;s</span><span class="stl_58 stl_59 stl_725" style="word-spacing:0.4696em;">&nbsp;l</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.2904em;">&nbsp;o</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.2914em;">&nbsp;s</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.2904em;">&nbsp;t</span><span class="stl_58 stl_59 stl_725" style="word-spacing:-0.1444em;">&nbsp;.</span><span class="stl_58 stl_59 stl_725" style="word-spacing:0.3356em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:8.045em;z-index:291; "><span class="stl_15 stl_16 stl_1316" style="word-spacing:-0.2394em;">i f</span><span class="stl_15 stl_16 stl_1316" style="word-spacing:0.5393em;">&nbsp;</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:0.5393em;">(</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.2384em;">&nbsp;!</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.1274em;">&nbsp;strcasecmp</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.2004em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.2004em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1316" style="word-spacing:-0.2004em;">−</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.2574em;">&gt;argv[0]</span><span class="stl_107 stl_108 stl_1316" style="word-spacing:-0.2574em;">−</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.2574em;">&gt;ptr</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.0684em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.1904em;">&nbsp;”</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.2644em;">&nbsp;psync</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.2644em;">&nbsp;”</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.2464em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.2044em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.2044em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">部</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:10.0375em;"><span class="stl_15 stl_16 stl_1317" style="word-spacing:-0.2372em;">i f</span><span class="stl_15 stl_16 stl_1317" style="word-spacing:0.4692em;">&nbsp;</span><span class="stl_10 stl_11 stl_1317" style="word-spacing:0.4692em;">(</span><span class="stl_10 stl_11 stl_1317" style="word-spacing:-0.1862em;">&nbsp;masterTryPartialResynchronization</span><span class="stl_10 stl_11 stl_1317" style="word-spacing:-0.1862em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1317" style="word-spacing:-0.2302em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1317" style="word-spacing:-0.2292em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1317" style="word-spacing:0.1738em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1317" style="word-spacing:-0.0002em;">&nbsp;REDIS_OK) &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:12.0908em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 21.6593em; left:12.0025em;"><span class="stl_10 stl_11 stl_1318" style="word-spacing:-0.173em;">server . stat_sync_partial_ok++; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:11.9308em;"><span class="stl_15 stl_16 stl_313">return</span><span class="stl_15 stl_16 stl_313" style="word-spacing:-0.2029em;">&nbsp;</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2029em;">;</span><span class="stl_10 stl_11 stl_313" style="word-spacing:0.3985em;">&nbsp;</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.3985em;">/*</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.2194em;">&nbsp;No</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.3684em;">&nbsp;f</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2126em;">&nbsp;u</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2126em;">&nbsp;l</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.2136em;">&nbsp;l</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.5024em;">&nbsp;resync</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.3724em;">&nbsp;needed</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.1156em;">&nbsp;,</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.4484em;">&nbsp;return</span><span class="stl_58 stl_59 stl_313" style="word-spacing:-0.1516em;">&nbsp;.</span><span class="stl_58 stl_59 stl_313" style="word-spacing:0.3844em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.6501em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6468em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">部 分</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;步</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;失</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;败，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;全</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;步，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;这</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;收</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;到</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;来</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;自</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;客</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;户</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;端</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:12.1408em;"><span class="stl_58 stl_59 stl_961">runid &nbsp;</span></div>
					<div class="stl_01" style="top: 26.636em; left:11.9192em;z-index:497; "><span class="stl_15 stl_16 stl_299">char</span><span class="stl_15 stl_16 stl_299" style="word-spacing:0.2965em;">&nbsp;</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2965em;">*master_runid</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2034em;">&nbsp;=</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2034em;">&nbsp;c</span><span class="stl_107 stl_108 stl_299" style="word-spacing:0.2034em;">−</span><span class="stl_10 stl_11 stl_299" style="word-spacing:-0.0673em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_299" style="word-spacing:-0.0673em;">−</span><span class="stl_10 stl_11 stl_299" style="word-spacing:-0.0673em;">&gt; ptr</span><span class="stl_10 stl_11 stl_299" style="word-spacing:-0.0673em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:12.4057em;"><span class="stl_58 stl_59 stl_864" style="word-spacing:0.356em;">* Increment</span><span class="stl_58 stl_59 stl_864" style="word-spacing:0.465em;">&nbsp;s</span><span class="stl_58 stl_59 stl_864" style="word-spacing:-0.229em;">&nbsp;t</span><span class="stl_58 stl_59 stl_864" style="word-spacing:-0.229em;">&nbsp;a</span><span class="stl_58 stl_59 stl_864" style="word-spacing:-0.229em;">&nbsp;t</span><span class="stl_58 stl_59 stl_864" style="word-spacing:-0.23em;">&nbsp;s</span><span class="stl_58 stl_59 stl_864" style="word-spacing:0.5165em;">&nbsp;for f</span><span class="stl_58 stl_59 stl_864" style="word-spacing:-0.219em;">&nbsp;a</span><span class="stl_58 stl_59 stl_864" style="word-spacing:-0.219em;">&nbsp;i</span><span class="stl_58 stl_59 stl_864" style="word-spacing:-0.219em;">&nbsp;l</span><span class="stl_58 stl_59 stl_864" style="word-spacing:-0.218em;">&nbsp;e</span><span class="stl_58 stl_59 stl_864" style="word-spacing:-0.219em;">&nbsp;d</span><span class="stl_58 stl_59 stl_864" style="word-spacing:0.35em;">&nbsp;PSYNCs,</span><span class="stl_58 stl_59 stl_864" style="word-spacing:0.452em;">&nbsp;but only</span><span class="stl_58 stl_59 stl_864" style="word-spacing:0.516em;">&nbsp;i</span><span class="stl_58 stl_59 stl_864" style="word-spacing:0.516em;">&nbsp;f &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:14.145em;"><span class="stl_58 stl_59 stl_939">the &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 32.6201em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 34.6126em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 30.6276em; left:13.4686em;"><span class="stl_58 stl_59 stl_1319" style="word-spacing:0.4173em;">runid i</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2917em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:0.4063em;">&nbsp;not</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:0.3453em;">&nbsp;”?”</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2527em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:0.3393em;">&nbsp;as</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:0.4073em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2857em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2847em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2857em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:0.4753em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2917em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:0.4043em;">&nbsp;used</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:0.3273em;">&nbsp;by</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:0.3883em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2977em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2977em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2967em;">&nbsp;v</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2977em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:-0.2967em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1319" style="word-spacing:0.4213em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:14.6558em;"><span class="stl_58 stl_59 stl_271" style="word-spacing:0.254em;">force a</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.324em;">&nbsp;f</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.322em;">&nbsp;u</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.321em;">&nbsp;l</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.321em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:13.4719em;"><span class="stl_58 stl_59 stl_823" style="word-spacing:0.2968em;">resync on purpose when they</span><span class="stl_58 stl_59 stl_823" style="word-spacing:0.3563em;">&nbsp;are not</span><span class="stl_58 stl_59 stl_823" style="word-spacing:0.3953em;">&nbsp;albe</span><span class="stl_58 stl_59 stl_823" style="word-spacing:0.3953em;">&nbsp;to &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:14.1917em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.0693em;">p a r t i a l l y &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:13.4719em;"><span class="stl_58 stl_59 stl_759" style="word-spacing:-0.201em;">resync .</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.345em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:12.03em;"><span class="stl_15 stl_16 stl_86" style="word-spacing:-0.2798em;">i f</span><span class="stl_15 stl_16 stl_86" style="word-spacing:0.4266em;">&nbsp;</span><span class="stl_10 stl_11 stl_86" style="word-spacing:0.4266em;">(</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2618em;">&nbsp;master_runid</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.1808em;">&nbsp;[</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2698em;">&nbsp;0</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2698em;">&nbsp;]</span><span class="stl_10 stl_11 stl_86" style="word-spacing:0.3927em;">&nbsp;!= ’</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2848em;">&nbsp;?</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.1768em;">&nbsp;’</span><span class="stl_10 stl_11 stl_86" style="word-spacing:-0.2428em;">&nbsp;)</span><span class="stl_10 stl_11 stl_86" style="word-spacing:0.3932em;">&nbsp;server</span><span class="stl_10 stl_11 stl_86" style="word-spacing:0.3932em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:13.6433em;"><span class="stl_10 stl_11 stl_1167">stat_sync_partial_err++; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.596em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.566em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.591em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:10.4132em;"><span class="stl_58 stl_59 stl_1320" style="word-spacing:0.4027em;">* I</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:-0.2563em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:0.3792em;">&nbsp;a s</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:-0.2753em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:-0.2743em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:-0.2743em;">&nbsp;v</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:-0.2753em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:0.4427em;">&nbsp;uses</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:0.2307em;">&nbsp;SYNC,</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:0.3467em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:0.3017em;">&nbsp;are</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:0.4257em;">&nbsp;dealing with</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:0.3412em;">&nbsp;an</span><span class="stl_58 stl_59 stl_1320" style="word-spacing:0.3412em;">&nbsp;old &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:11.6425em;"><span class="stl_58 stl_59 stl_583">implementation &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 41.586em; left:11.4902em;"><span class="stl_58 stl_59 stl_339" style="word-spacing:0.3875em;">of the r</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3175em;">&nbsp;e</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3185em;">&nbsp;p</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3175em;">&nbsp;l</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3185em;">&nbsp;i</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3185em;">&nbsp;c</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3175em;">&nbsp;a</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3185em;">&nbsp;t</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3175em;">&nbsp;i</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3185em;">&nbsp;o</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3175em;">&nbsp;n</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.4245em;">&nbsp;protocol</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.3575em;">&nbsp;(</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2035em;">&nbsp;l</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2975em;">&nbsp;i</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2985em;">&nbsp;k</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2975em;">&nbsp;e</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.4285em;">&nbsp;redis</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.317em;">&nbsp;</span><span class="stl_107 stl_108 stl_339" style="word-spacing:0.4285em;">−</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.317em;">c</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2875em;">&nbsp;l</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.2875em;">&nbsp;i</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.1711em;">&nbsp;</span><span class="stl_107 stl_108 stl_339" style="word-spacing:0.1711em;">−− &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:12.1742em;"><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.3244em;">s l</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.3234em;">&nbsp;a</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.3234em;">&nbsp;v</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.3244em;">&nbsp;e</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.2274em;">&nbsp;)</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.2324em;">&nbsp;.</span><span class="stl_58 stl_59 stl_841" style="word-spacing:0.3646em;">&nbsp;Flag the</span><span class="stl_58 stl_59 stl_841" style="word-spacing:0.4246em;">&nbsp;c</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.2994em;">&nbsp;l</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.3004em;">&nbsp;i</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.2994em;">&nbsp;e</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.2994em;">&nbsp;n</span><span class="stl_58 stl_59 stl_841" style="word-spacing:-0.2994em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 43.5793em; left:11.462em;"><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.4803em;">so that</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.4123em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.3233em;">&nbsp;don</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.1067em;">&nbsp;’</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.1237em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.5036em;">&nbsp;expect to receive</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.3023em;">&nbsp;REPLCONF</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.0483em;">&nbsp;ACK &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:12.1625em;"><span class="stl_58 stl_59 stl_1322" style="word-spacing:-0.2223em;">feedbacks .</span><span class="stl_58 stl_59 stl_1322" style="word-spacing:0.2997em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:9.9342em;z-index:888; "><span class="stl_10 stl_11 stl_1272" style="word-spacing:0.0376em;">c</span><span class="stl_107 stl_108 stl_1272" style="word-spacing:0.0376em;">−</span><span class="stl_10 stl_11 stl_1272" style="word-spacing:0.0376em;">&gt;f l a g s</span><span class="stl_10 stl_11 stl_1272" style="word-spacing:0.6851em;">&nbsp;|=</span><span class="stl_10 stl_11 stl_1272" style="word-spacing:0.4391em;">&nbsp;REDIS_PRE_PSYNC_SLAVE; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">部分同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">151 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7118em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">执 行</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;全</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;同</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;步： &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 10.7018em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;尝</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;试</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;是</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;否</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;能</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;部</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:6.4282em;"><span class="stl_58 stl_59 stl_1323" style="word-spacing:0.341em;">* This</span><span class="stl_58 stl_59 stl_1323" style="word-spacing:0.435em;">&nbsp;function handles the</span><span class="stl_58 stl_59 stl_1323" style="word-spacing:0.241em;">&nbsp;PSYNC</span><span class="stl_58 stl_59 stl_1323" style="word-spacing:0.117em;">&nbsp;command</span><span class="stl_58 stl_59 stl_1323" style="word-spacing:0.261em;">&nbsp;from</span><span class="stl_58 stl_59 stl_1323" style="word-spacing:0.384em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1323" style="word-spacing:0.4465em;">&nbsp;point</span><span class="stl_58 stl_59 stl_1323" style="word-spacing:0.4465em;">&nbsp;of &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.6508em;"><span class="stl_58 stl_59 stl_802" style="word-spacing:0.3645em;">view of</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.3645em;">&nbsp;a &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 14.6876em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 15.6835em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 13.691em; left:6.9787em;"><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.029em;">master r e</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.36em;">&nbsp;c</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.361em;">&nbsp;e</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.361em;">&nbsp;iv</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.361em;">&nbsp;i</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.36em;">&nbsp;n</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.361em;">&nbsp;g</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.2785em;">&nbsp;a request</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.3835em;">&nbsp;for p</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.342em;">&nbsp;a</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.343em;">&nbsp;r</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.342em;">&nbsp;t</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.342em;">&nbsp;i</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.342em;">&nbsp;a</span><span class="stl_58 stl_59 stl_72" style="word-spacing:-0.343em;">&nbsp;l</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.395em;">&nbsp;resynchronization</span><span class="stl_58 stl_59 stl_72" style="word-spacing:0.395em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:6.8657em;"><span class="stl_58 stl_59 stl_1324" style="word-spacing:0.3252em;">On success</span><span class="stl_58 stl_59 stl_1324" style="word-spacing:0.4932em;">&nbsp;return</span><span class="stl_58 stl_59 stl_1324" style="word-spacing:0.3012em;">&nbsp;REDIS_OK,</span><span class="stl_58 stl_59 stl_1324" style="word-spacing:0.5162em;">&nbsp;otherwise</span><span class="stl_58 stl_59 stl_1324" style="word-spacing:0.3247em;">&nbsp;REDIS_ERR i</span><span class="stl_58 stl_59 stl_1324" style="word-spacing:-0.2018em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1324" style="word-spacing:0.5202em;">&nbsp;returned &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.1092em;"><span class="stl_58 stl_59 stl_940" style="word-spacing:0.2564em;">and we</span><span class="stl_58 stl_59 stl_940" style="word-spacing:0.3094em;">&nbsp;proceed &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:6.9986em;"><span class="stl_58 stl_59 stl_703" style="word-spacing:0.3639em;">with the usual</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.4529em;">&nbsp;f</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.2721em;">&nbsp;u</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.2731em;">&nbsp;l</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.2721em;">&nbsp;l</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.4429em;">&nbsp;resync</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.2201em;">&nbsp;.</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.3239em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 18.666em; left:5.9875em;"><span class="stl_15 stl_16 stl_276">int</span><span class="stl_15 stl_16 stl_276" style="word-spacing:0.3299em;">&nbsp;</span><span class="stl_10 stl_11 stl_276" style="word-spacing:0.3299em;">masterTryPartialResynchronization</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.264em;">&nbsp;(</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.229em;">&nbsp;r</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.336em;">&nbsp;e</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.335em;">&nbsp;d</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.335em;">&nbsp;i</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.335em;">&nbsp;s</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.335em;">&nbsp;C</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.336em;">&nbsp;l</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.335em;">&nbsp;i</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.335em;">&nbsp;e</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.335em;">&nbsp;n</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.336em;">&nbsp;t</span><span class="stl_10 stl_11 stl_276" style="word-spacing:0.315em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.307em;">&nbsp;)</span><span class="stl_10 stl_11 stl_276" style="word-spacing:-0.307em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:7.9467em;"><span class="stl_15 stl_16 stl_752" style="word-spacing:0.2782em;">long long</span><span class="stl_15 stl_16 stl_752" style="word-spacing:0.3376em;">&nbsp;</span><span class="stl_10 stl_11 stl_752" style="word-spacing:0.3376em;">psync_offset</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.0438em;">&nbsp;,</span><span class="stl_10 stl_11 stl_752" style="word-spacing:0.4132em;">&nbsp;psync_len</span><span class="stl_10 stl_11 stl_752" style="word-spacing:0.4132em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:7.9342em;z-index:346; "><span class="stl_15 stl_16 stl_299">char</span><span class="stl_15 stl_16 stl_299" style="word-spacing:0.2966em;">&nbsp;</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2966em;">*master_runid</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2034em;">&nbsp;=</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2034em;">&nbsp;c</span><span class="stl_107 stl_108 stl_299" style="word-spacing:0.2034em;">−</span><span class="stl_10 stl_11 stl_299" style="word-spacing:-0.0661em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_299" style="word-spacing:-0.0661em;">−</span><span class="stl_10 stl_11 stl_299" style="word-spacing:-0.0661em;">&gt; ptr</span><span class="stl_10 stl_11 stl_299" style="word-spacing:-0.0661em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:7.9342em;"><span class="stl_15 stl_16 stl_164">char</span><span class="stl_15 stl_16 stl_164" style="word-spacing:0.3613em;">&nbsp;</span><span class="stl_10 stl_11 stl_164" style="word-spacing:0.3613em;">buf</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.101em;">&nbsp;[</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.198em;">&nbsp;1</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.197em;">&nbsp;2</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.197em;">&nbsp;8</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.197em;">&nbsp;]</span><span class="stl_10 stl_11 stl_164" style="word-spacing:-0.197em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:7.98em;"><span class="stl_15 stl_16 stl_1110">int</span><span class="stl_15 stl_16 stl_1110" style="word-spacing:0.3371em;">&nbsp;</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:0.3371em;">buflen</span><span class="stl_10 stl_11 stl_1110" style="word-spacing:0.3371em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_217" style="word-spacing:0.3145em;">* Is</span><span class="stl_58 stl_59 stl_217" style="word-spacing:0.3639em;">&nbsp;the runid of</span><span class="stl_58 stl_59 stl_217" style="word-spacing:0.4155em;">&nbsp;t</span><span class="stl_58 stl_59 stl_217" style="word-spacing:-0.3105em;">&nbsp;h</span><span class="stl_58 stl_59 stl_217" style="word-spacing:-0.3115em;">&nbsp;i</span><span class="stl_58 stl_59 stl_217" style="word-spacing:-0.3115em;">&nbsp;s</span><span class="stl_58 stl_59 stl_217" style="word-spacing:0.3815em;">&nbsp;master</span><span class="stl_58 stl_59 stl_217" style="word-spacing:0.3365em;">&nbsp;the</span><span class="stl_58 stl_59 stl_217" style="word-spacing:0.2965em;">&nbsp;same advertised</span><span class="stl_58 stl_59 stl_217" style="word-spacing:0.341em;">&nbsp;by</span><span class="stl_58 stl_59 stl_217" style="word-spacing:0.341em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:10.1058em;"><span class="stl_58 stl_59 stl_634" style="word-spacing:0.4417em;">wannabe s</span><span class="stl_58 stl_59 stl_634" style="word-spacing:-0.2163em;">&nbsp;l</span><span class="stl_58 stl_59 stl_634" style="word-spacing:-0.2173em;">&nbsp;a</span><span class="stl_58 stl_59 stl_634" style="word-spacing:-0.2163em;">&nbsp;v</span><span class="stl_58 stl_59 stl_634" style="word-spacing:-0.2163em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 26.6426em; left:9.5002em;"><span class="stl_58 stl_59 stl_1098" style="word-spacing:0.2812em;">via PSYNC?</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:0.4372em;">&nbsp;I</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2068em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:0.5032em;">&nbsp;runid</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:0.4252em;">&nbsp;changed</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:0.4832em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2078em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2068em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2078em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:0.4817em;">&nbsp;master i</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2138em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:0.4357em;">&nbsp;a d</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2018em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2028em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2028em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2028em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2028em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2018em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2028em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1098" style="word-spacing:-0.2028em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:10.665em;"><span class="stl_58 stl_59 stl_1325" style="word-spacing:0.3061em;">instance and &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 28.6351em; left:9.5052em;"><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.4389em;">there i</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.2961em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.3449em;">&nbsp;no</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.2189em;">&nbsp;way</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.2959em;">&nbsp;to</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.3799em;">&nbsp;continue</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.1931em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.3479em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6243em; left:8.045em;"><span class="stl_15 stl_16 stl_603" style="word-spacing:-0.2852em;">i f</span><span class="stl_15 stl_16 stl_603" style="word-spacing:0.4212em;">&nbsp;</span><span class="stl_10 stl_11 stl_603" style="word-spacing:0.4212em;">(</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2462em;">&nbsp;strcasecmp</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2452em;">&nbsp;(</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2732em;">&nbsp;master_runid</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.1352em;">&nbsp;,</span><span class="stl_10 stl_11 stl_603" style="word-spacing:0.4438em;">&nbsp;server</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.1572em;">&nbsp;.</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.1892em;">&nbsp;runid</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2452em;">&nbsp;)</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2502em;">&nbsp;)</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2502em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.6276em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">当 因</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;为</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;异</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;常</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;需</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;要</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;与</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;断</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;开</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;连</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;候，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;暂</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;状 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.844em; left:9.6417em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.2995em;">态 信 息， 以 便 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 35.6085em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">下 一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;次</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;部</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;分</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;步。 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:8.4207em;"><span class="stl_58 stl_59 stl_808" style="word-spacing:0.2566em;">/ 1</span><span class="stl_17 stl_18 stl_808" style="word-spacing:0.2566em;">）</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.256em;">&nbsp;</span><span class="stl_58 stl_59 stl_808" style="word-spacing:-0.256em;">master_runid</span><span class="stl_58 stl_59 stl_808" style="word-spacing:0.3435em;">&nbsp;</span><span class="stl_17 stl_18 stl_808" style="word-spacing:0.3435em;">是</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2474em;">&nbsp;从</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;机</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;提</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;供</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;一</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;个</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;因</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;存</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;主</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;机</span><span class="stl_17 stl_18 stl_808" style="word-spacing:-0.2464em;">&nbsp;的</span><span class="stl_17 stl_18 stl_808" style="word-spacing:0.3646em;">&nbsp;</span><span class="stl_58 stl_59 stl_808" style="word-spacing:0.3646em;">runid</span><span class="stl_58 stl_59 stl_808" style="word-spacing:-0.2363em;">&nbsp;</span><span class="stl_17 stl_18 stl_808" style="word-spacing:0.3646em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:8.4207em;"><span class="stl_58 stl_59 stl_692" style="word-spacing:0.2052em;">/ 2</span><span class="stl_17 stl_18 stl_692" style="word-spacing:0.2052em;">）</span><span class="stl_17 stl_18 stl_692" style="word-spacing:-0.2592em;">&nbsp;</span><span class="stl_58 stl_59 stl_692" style="word-spacing:-0.2592em;">server</span><span class="stl_58 stl_59 stl_692" style="word-spacing:-0.2128em;">&nbsp;.</span><span class="stl_58 stl_59 stl_692" style="word-spacing:-0.2418em;">&nbsp;runid</span><span class="stl_58 stl_59 stl_692" style="word-spacing:0.313em;">&nbsp;</span><span class="stl_17 stl_18 stl_692" style="word-spacing:0.313em;">是</span><span class="stl_17 stl_18 stl_692" style="word-spacing:-0.2988em;">&nbsp;本</span><span class="stl_17 stl_18 stl_692" style="word-spacing:-0.2978em;">&nbsp;机</span><span class="stl_17 stl_18 stl_692" style="word-spacing:-0.2638em;">&nbsp;（主</span><span class="stl_17 stl_18 stl_692" style="word-spacing:-0.2308em;">&nbsp;机）</span><span class="stl_17 stl_18 stl_692" style="word-spacing:-0.2648em;">&nbsp;的</span><span class="stl_17 stl_18 stl_692" style="word-spacing:0.313em;">&nbsp;</span><span class="stl_58 stl_59 stl_692" style="word-spacing:0.313em;">runid</span><span class="stl_58 stl_59 stl_692" style="word-spacing:-0.2867em;">&nbsp;</span><span class="stl_17 stl_18 stl_692" style="word-spacing:0.313em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:8.4207em;"><span class="stl_58 stl_59 stl_216">/</span><span class="stl_58 stl_59 stl_216" style="word-spacing:-0.0742em;">&nbsp;</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.0742em;">匹 配</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;失</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2835em;">&nbsp;败，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2835em;">&nbsp;说</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;明</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;是</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;本</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;机</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2825em;">&nbsp;（主</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2495em;">&nbsp;机）</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2835em;">&nbsp;不</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;是</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;从</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;机</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;存</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;的</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;主</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2825em;">&nbsp;机，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2835em;">&nbsp;这</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;时</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3165em;">&nbsp;候 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.8257em; left:9.6417em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3113em;">不 能 进 行 部 分 同 步， &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">只</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;能</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;全</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5901em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.586em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:10.4132em;"><span class="stl_58 stl_59 stl_1327" style="word-spacing:0.331em;">/ ”?”</span><span class="stl_58 stl_59 stl_1327" style="word-spacing:0.3727em;">&nbsp;</span><span class="stl_17 stl_18 stl_1327" style="word-spacing:0.3727em;">表</span><span class="stl_17 stl_18 stl_1327" style="word-spacing:-0.206em;">&nbsp;示</span><span class="stl_17 stl_18 stl_1327" style="word-spacing:-0.205em;">&nbsp;从</span><span class="stl_17 stl_18 stl_1327" style="word-spacing:-0.205em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1327" style="word-spacing:-0.205em;">&nbsp;要</span><span class="stl_17 stl_18 stl_1327" style="word-spacing:-0.205em;">&nbsp;求</span><span class="stl_17 stl_18 stl_1327" style="word-spacing:-0.205em;">&nbsp;全</span><span class="stl_17 stl_18 stl_1327" style="word-spacing:-0.205em;">&nbsp;同</span><span class="stl_17 stl_18 stl_1327" style="word-spacing:-0.205em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">什</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;么</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;候</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;会</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;要</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;求</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;全</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.08em;">&nbsp;步 ？</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.09em;">&nbsp;？</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.09em;">&nbsp;？ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:10.4132em;"><span class="stl_58 stl_59 stl_958" style="word-spacing:0.2069em;">* Run</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.2739em;">&nbsp;id</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.3759em;">&nbsp;”?” i</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2831em;">&nbsp;s</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.4129em;">&nbsp;used</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.3359em;">&nbsp;by</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.3959em;">&nbsp;s</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2891em;">&nbsp;l</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2891em;">&nbsp;a</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2881em;">&nbsp;v</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2891em;">&nbsp;e</span><span class="stl_58 stl_59 stl_958" style="word-spacing:-0.2881em;">&nbsp;s</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.4539em;">&nbsp;that</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.3519em;">&nbsp;want to</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.4139em;">&nbsp;force</span><span class="stl_58 stl_59 stl_958" style="word-spacing:0.4139em;">&nbsp;a &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:11.7242em;"><span class="stl_58 stl_59 stl_759" style="word-spacing:-0.252em;">f u</span><span class="stl_58 stl_59 stl_759" style="word-spacing:-0.253em;">&nbsp;l</span><span class="stl_58 stl_59 stl_759" style="word-spacing:-0.252em;">&nbsp;l</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.462em;">&nbsp;resync</span><span class="stl_58 stl_59 stl_759" style="word-spacing:-0.2em;">&nbsp;.</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.344em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5727em; left:10.0375em;"><span class="stl_15 stl_16 stl_313" style="word-spacing:-0.2457em;">i f</span><span class="stl_15 stl_16 stl_313" style="word-spacing:0.4607em;">&nbsp;</span><span class="stl_10 stl_11 stl_313" style="word-spacing:0.4607em;">(</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2277em;">&nbsp;master_runid</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.1467em;">&nbsp;[</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2357em;">&nbsp;0</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2357em;">&nbsp;]</span><span class="stl_10 stl_11 stl_313" style="word-spacing:0.4268em;">&nbsp;!= ’</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2507em;">&nbsp;?</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.1427em;">&nbsp;’</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2087em;">&nbsp;)</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2087em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:11.9858em;"><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.2132em;">redisLog (REDIS_NOTICE, ” Partial ␣ resynchronization ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:13.6175em;"><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.2566em;">not␣ accepted : ␣” &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:13.9292em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 46.566em; left:14.4174em;"><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.1999em;">Runid␣mismatch␣ ( Client ␣asked␣ fo r ␣’%s ’ , ␣ I ’m␣ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">152 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:15.5733em;"><span class="stl_10 stl_11 stl_07">’</span></div>
					<div class="stl_01" style="top: 5.7193em; left:15.8216em;"><span class="stl_10 stl_11 stl_168" style="word-spacing:-0.2273em;">%s ’) ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:13.9442em;"><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.13em;">master_runid ,</span><span class="stl_10 stl_11 stl_722" style="word-spacing:0.448em;">&nbsp;server</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.152em;">&nbsp;.</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.185em;">&nbsp;runid</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.241em;">&nbsp;)</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.241em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:11.9858em;"><span class="stl_10 stl_11 stl_1328" style="word-spacing:-0.1979em;">redisLog (REDIS_NOTICE, ” Full ␣ resync ␣ requested ␣by␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:13.6617em;"><span class="stl_10 stl_11 stl_717" style="word-spacing:-0.2945em;">slave . ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 10.7001em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 11.6918em; left:9.9283em;"><span class="stl_15 stl_16 stl_1319">goto</span><span class="stl_15 stl_16 stl_1319" style="word-spacing:0.3056em;">&nbsp;</span><span class="stl_10 stl_11 stl_1319" style="word-spacing:0.3056em;">need_full_resync</span><span class="stl_10 stl_11 stl_1319" style="word-spacing:0.3056em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 14.6876em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">从 参</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;中</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;解</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;析</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;整</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;整</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;指</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;定</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;偏</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;移</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;量 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_966" style="word-spacing:0.1232em;">* We</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.3032em;">&nbsp;s</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.2098em;">&nbsp;t</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.2098em;">&nbsp;i</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.2098em;">&nbsp;l</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.2098em;">&nbsp;l</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.4822em;">&nbsp;have</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.3737em;">&nbsp;the data</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.3402em;">&nbsp;our</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.3832em;">&nbsp;s</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.2988em;">&nbsp;l</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.2998em;">&nbsp;a</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.2988em;">&nbsp;v</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.2988em;">&nbsp;e</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.4622em;">&nbsp;i</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.2888em;">&nbsp;s</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.4282em;">&nbsp;asking for</span><span class="stl_58 stl_59 stl_966" style="word-spacing:-0.2648em;">&nbsp;?</span><span class="stl_58 stl_59 stl_966" style="word-spacing:0.2542em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:8.045em;z-index:237; "><span class="stl_15 stl_16 stl_1328" style="word-spacing:-0.211em;">i f</span><span class="stl_15 stl_16 stl_1328" style="word-spacing:0.4954em;">&nbsp;</span><span class="stl_10 stl_11 stl_1328" style="word-spacing:0.4954em;">(</span><span class="stl_10 stl_11 stl_1328" style="word-spacing:-0.21em;">&nbsp;getLongLongFromObjectOrReply</span><span class="stl_10 stl_11 stl_1328" style="word-spacing:-0.209em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1328" style="word-spacing:-0.23em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1328" style="word-spacing:-0.122em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1328" style="word-spacing:-0.122em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1328" style="word-spacing:-0.122em;">−</span><span class="stl_10 stl_11 stl_1328" style="word-spacing:-0.174em;">&gt;argv</span><span class="stl_10 stl_11 stl_1328" style="word-spacing:-0.164em;">&nbsp;[2]</span><span class="stl_10 stl_11 stl_1328" style="word-spacing:-0.133em;">&nbsp;,&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:9.655em;"><span class="stl_10 stl_11 stl_800" style="word-spacing:-0.0028em;">psync_offset ,NULL)</span><span class="stl_10 stl_11 stl_800" style="word-spacing:0.3562em;">&nbsp;!= &nbsp;</span></div>
					<div class="stl_01" style="top: 18.666em; left:9.3367em;"><span class="stl_10 stl_11 stl_886">REDIS_OK)</span><span class="stl_10 stl_11 stl_886" style="word-spacing:0.3938em;">&nbsp;</span><span class="stl_15 stl_16 stl_886" style="word-spacing:0.3938em;">goto</span><span class="stl_15 stl_16 stl_886" style="word-spacing:0.4016em;">&nbsp;</span><span class="stl_10 stl_11 stl_886" style="word-spacing:0.4016em;">need_full_resync</span><span class="stl_10 stl_11 stl_886" style="word-spacing:0.4016em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">部</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;失</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;败</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;情</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;况 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:8.045em;"><span class="stl_15 stl_16 stl_339" style="word-spacing:-0.3056em;">i f</span><span class="stl_15 stl_16 stl_339" style="word-spacing:0.4731em;">&nbsp;</span><span class="stl_10 stl_11 stl_339" style="word-spacing:0.4731em;">(</span><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.3046em;">&nbsp;!</span><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.1596em;">&nbsp;server</span><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.1766em;">&nbsp;.</span><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.2076em;">&nbsp;repl_backlog</span><span class="stl_10 stl_11 stl_339" style="word-spacing:0.4464em;">&nbsp;|</span><span class="stl_10 stl_11 stl_339" style="word-spacing:-0.2676em;">&nbsp;|</span><span class="stl_10 stl_11 stl_339" style="word-spacing:0.3925em;">&nbsp;</span><span class="stl_58 stl_59 stl_339" style="word-spacing:0.3925em;">/*</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.322em;">&nbsp;</span><span class="stl_17 stl_18 stl_339" style="word-spacing:-0.322em;">不</span><span class="stl_17 stl_18 stl_339" style="word-spacing:-0.2816em;">&nbsp;存</span><span class="stl_17 stl_18 stl_339" style="word-spacing:-0.2816em;">&nbsp;在</span><span class="stl_17 stl_18 stl_339" style="word-spacing:-0.2816em;">&nbsp;积</span><span class="stl_17 stl_18 stl_339" style="word-spacing:-0.2816em;">&nbsp;压</span><span class="stl_17 stl_18 stl_339" style="word-spacing:-0.2816em;">&nbsp;空</span><span class="stl_17 stl_18 stl_339" style="word-spacing:-0.2816em;">&nbsp;间</span><span class="stl_17 stl_18 stl_339" style="word-spacing:-0.3226em;">&nbsp;</span><span class="stl_58 stl_59 stl_339" style="word-spacing:-0.3226em;">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:9.995em;"><span class="stl_10 stl_11 stl_335" style="word-spacing:0.1111em;">psync_offset &lt;</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.0018em;">&nbsp;server .</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.2169em;">&nbsp;repl_backlog_off</span><span class="stl_10 stl_11 stl_335" style="word-spacing:0.4371em;">&nbsp;|</span><span class="stl_10 stl_11 stl_335" style="word-spacing:-0.2819em;">&nbsp;|</span><span class="stl_10 stl_11 stl_335" style="word-spacing:0.9783em;">&nbsp;</span><span class="stl_58 stl_59 stl_335" style="word-spacing:0.9783em;">/* &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6535em; left:11.66em;"><span class="stl_58 stl_59 stl_1020">psync_offset</span><span class="stl_58 stl_59 stl_1020" style="word-spacing:0.3196em;">&nbsp;</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:0.3196em;">太</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.3132em;">&nbsp;过</span><span class="stl_17 stl_18 stl_1020" style="word-spacing:-0.2782em;">&nbsp;小， &nbsp;</span></div>
					<div class="stl_01" style="top: 24.8707em; left:31.8917em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">即 从 机 错 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.8665em; left:33.5525em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">过 太 多 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.8632em; left:33.5525em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">更 新 记 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.859em; left:33.58em;"><span class="stl_17 stl_18 stl_79">录， &nbsp;</span></div>
					<div class="stl_01" style="top: 28.8557em; left:31.8917em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">安 全 起 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.8515em; left:33.58em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">见， 实 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.8482em; left:33.5525em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">行 全 同 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:33.5525em;"><span class="stl_17 stl_18 stl_631" style="word-spacing:-0.2067em;">步 </span><span class="stl_58 stl_59 stl_631" style="word-spacing:-0.2067em;">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:31.8575em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:32.3307em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 33.616em; left:33.5775em;"><span class="stl_58 stl_59 stl_1329">psync_offset &nbsp;</span></div>
					<div class="stl_01" style="top: 34.8332em; left:34.05em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">越 界 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6085em; left:33.5183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 35.6085em; left:33.9916em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.6035em; left:9.995em;"><span class="stl_10 stl_11 stl_1205" style="word-spacing:0.1018em;">psync_offset &gt;</span><span class="stl_10 stl_11 stl_1205" style="word-spacing:-0.1143em;">&nbsp;( server</span><span class="stl_10 stl_11 stl_1205" style="word-spacing:-0.2002em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1205" style="word-spacing:-0.2262em;">&nbsp;repl_backlog_off</span><span class="stl_10 stl_11 stl_1205" style="word-spacing:0.1238em;">&nbsp;+</span><span class="stl_10 stl_11 stl_1205" style="word-spacing:-0.0252em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1205" style="word-spacing:-0.0252em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:11.655em;"><span class="stl_10 stl_11 stl_985" style="word-spacing:-0.2793em;">repl_backlog_histlen ) ) &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5918em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 38.5976em; left:8.4207em;"><span class="stl_58 stl_59 stl_581">/</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.0752em;">&nbsp;</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.0752em;">经 检</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;测，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;不</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;满</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;足</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;部</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;分</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;同</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;步</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;的</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;条</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.283em;">&nbsp;件，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;转</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;而</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;进</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;行</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;全</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;同</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:9.9933em;"><span class="stl_10 stl_11 stl_98" style="word-spacing:-0.0678em;">redisLog (REDIS_NOTICE, &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:11.9367em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 41.5843em; left:12.4423em;"><span class="stl_10 stl_11 stl_1178" style="word-spacing:-0.3035em;">Unable␣ to ␣ p a r t i a l ␣ resync ␣with␣ the ␣ slave ␣ fo r ␣ lack &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:13.585em;"><span class="stl_10 stl_11 stl_735" style="word-spacing:-0.2529em;">␣ of ␣ backlog ␣ ( Slave ␣ request ␣was : ␣%l l d ) . ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:13.6475em;"><span class="stl_10 stl_11 stl_747" style="word-spacing:-0.2528em;">psync_offset ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5685em; left:10.0375em;"><span class="stl_15 stl_16 stl_128" style="word-spacing:-0.3282em;">i f</span><span class="stl_15 stl_16 stl_128" style="word-spacing:0.3782em;">&nbsp;</span><span class="stl_10 stl_11 stl_128" style="word-spacing:0.3782em;">(</span><span class="stl_10 stl_11 stl_128" style="word-spacing:-0.2732em;">&nbsp;psync_offset</span><span class="stl_10 stl_11 stl_128" style="word-spacing:0.1028em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_128" style="word-spacing:-0.0204em;">&nbsp;server .</span><span class="stl_10 stl_11 stl_128" style="word-spacing:-0.2202em;">&nbsp;master_repl_offset</span><span class="stl_10 stl_11 stl_128" style="word-spacing:-0.2752em;">&nbsp;)</span><span class="stl_10 stl_11 stl_128" style="word-spacing:-0.2752em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:11.9858em;"><span class="stl_10 stl_11 stl_34" style="word-spacing:-0.0137em;">redisLog (REDIS_WARNING, &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:13.9292em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 46.566em; left:14.414em;"><span class="stl_10 stl_11 stl_477" style="word-spacing:-0.1801em;">Warning : ␣ slave ␣ t r i e d ␣ to ␣PSYNC␣with␣an␣ o f f s e t &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">部分同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">153 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:15.5775em;"><span class="stl_10 stl_11 stl_07">␣</span></div>
					<div class="stl_01" style="top: 5.7193em; left:16.128em;"><span class="stl_10 stl_11 stl_880" style="word-spacing:-0.2948em;">that ␣ i s ␣ greater ␣than␣ the ␣master␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:15.6733em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.085em;">r e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.084em;">&nbsp;p</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.085em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.085em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.084em;">&nbsp;c</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.085em;">&nbsp;a</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.084em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.085em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.085em;">&nbsp;o</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.084em;">&nbsp;n</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.02em;">&nbsp;o</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.069em;">&nbsp;f</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.07em;">&nbsp;f</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.07em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.07em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.07em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.091em;">&nbsp;.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.025em;">&nbsp;”</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.08em;">&nbsp;)</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.08em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7027em; left:9.9283em;"><span class="stl_15 stl_16 stl_1319">goto</span><span class="stl_15 stl_16 stl_1319" style="word-spacing:0.3056em;">&nbsp;</span><span class="stl_10 stl_11 stl_1319" style="word-spacing:0.3056em;">need_full_resync</span><span class="stl_10 stl_11 stl_1319" style="word-spacing:0.3056em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 11.6985em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">执 行</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;部</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;分</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;同</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;步： &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4207em;"><span class="stl_58 stl_59 stl_1330" style="word-spacing:-0.1771em;">/ 1</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.1771em;">） 标</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;记</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;客</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;户</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;端</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;为</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;从</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_1331" style="word-spacing:0.5368em;">/ 2</span><span class="stl_17 stl_18 stl_1331" style="word-spacing:0.5368em;">）</span><span class="stl_17 stl_18 stl_1331" style="word-spacing:0.0338em;">&nbsp;通 知 从 机 准 备 接 收 数</span><span class="stl_17 stl_18 stl_1331" style="word-spacing:0.0668em;">&nbsp;据。 从</span><span class="stl_17 stl_18 stl_1331" style="word-spacing:0.0338em;">&nbsp;机 收 到</span><span class="stl_17 stl_18 stl_1331" style="word-spacing:0.4504em;">&nbsp;</span><span class="stl_58 stl_59 stl_1331" style="word-spacing:0.4504em;">+CONTINUE</span><span class="stl_58 stl_59 stl_1331" style="word-spacing:0.4557em;">&nbsp;</span><span class="stl_17 stl_18 stl_1331" style="word-spacing:0.4557em;">会</span><span class="stl_17 stl_18 stl_1331" style="word-spacing:0.0338em;">&nbsp;做 好 准</span><span class="stl_17 stl_18 stl_1331" style="word-spacing:0.0338em;">&nbsp;备 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4207em;"><span class="stl_58 stl_59 stl_1330" style="word-spacing:-0.1771em;">/ 3</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.1771em;">） 开</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;发</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;发</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;送</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1330" style="word-spacing:-0.3401em;">&nbsp;据 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.3733em;">* I</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.2857em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.3393em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.2783em;">&nbsp;reached</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.4213em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.2867em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.2857em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.2867em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.4243em;">&nbsp;point</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:-0.0857em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.3173em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.2723em;">&nbsp;are</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.3983em;">&nbsp;able to</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.3583em;">&nbsp;perform</span><span class="stl_58 stl_59 stl_1163" style="word-spacing:0.3583em;">&nbsp;a &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.6983em;"><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3098em;">p a</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3108em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3098em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3098em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3098em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3108em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:0.4052em;">&nbsp;resync</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:0.4052em;">&nbsp;: &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.4695em;"><span class="stl_58 stl_59 stl_925" style="word-spacing:0.386em;">1) Set</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.468em;">&nbsp;c</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.245em;">&nbsp;l</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.244em;">&nbsp;i</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.244em;">&nbsp;e</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.245em;">&nbsp;n</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.244em;">&nbsp;t</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.515em;">&nbsp;s</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.259em;">&nbsp;t</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.26em;">&nbsp;a</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.26em;">&nbsp;t</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.259em;">&nbsp;e</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.459em;">&nbsp;to</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.33em;">&nbsp;make</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.398em;">&nbsp;i</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.232em;">&nbsp;t</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.3945em;">&nbsp;a s</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.269em;">&nbsp;l</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.268em;">&nbsp;a</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.268em;">&nbsp;ve</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.268em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.4695em;"><span class="stl_58 stl_59 stl_160" style="word-spacing:0.4468em;">2) Inform the</span><span class="stl_58 stl_59 stl_160" style="word-spacing:0.5518em;">&nbsp;c</span><span class="stl_58 stl_59 stl_160" style="word-spacing:-0.1732em;">&nbsp;l</span><span class="stl_58 stl_59 stl_160" style="word-spacing:-0.1722em;">&nbsp;i</span><span class="stl_58 stl_59 stl_160" style="word-spacing:-0.1722em;">&nbsp;e</span><span class="stl_58 stl_59 stl_160" style="word-spacing:-0.1732em;">&nbsp;n</span><span class="stl_58 stl_59 stl_160" style="word-spacing:-0.1722em;">&nbsp;t</span><span class="stl_58 stl_59 stl_160" style="word-spacing:0.4528em;">&nbsp;we</span><span class="stl_58 stl_59 stl_160" style="word-spacing:0.3448em;">&nbsp;can</span><span class="stl_58 stl_59 stl_160" style="word-spacing:0.4388em;">&nbsp;continue</span><span class="stl_58 stl_59 stl_160" style="word-spacing:0.4888em;">&nbsp;with</span><span class="stl_58 stl_59 stl_160" style="word-spacing:0.2868em;">&nbsp;+CONTINUE &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:9.4695em;"><span class="stl_58 stl_59 stl_528" style="word-spacing:0.3109em;">3) Send the</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.3914em;">&nbsp;backlog data</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.3429em;">&nbsp;(</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.2951em;">&nbsp;from</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.3329em;">&nbsp;the</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.4469em;">&nbsp;o</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.2771em;">&nbsp;f</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.2771em;">&nbsp;f</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.2771em;">&nbsp;s</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.2771em;">&nbsp;e</span><span class="stl_58 stl_59 stl_528" style="word-spacing:-0.2771em;">&nbsp;t</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.4419em;">&nbsp;to</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.3839em;">&nbsp;the</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.3319em;">&nbsp;end</span><span class="stl_58 stl_59 stl_528" style="word-spacing:0.3319em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:10.1558em;"><span class="stl_58 stl_59 stl_1325" style="word-spacing:0.3782em;">to the s</span><span class="stl_58 stl_59 stl_1325" style="word-spacing:-0.3308em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1325" style="word-spacing:-0.3298em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1325" style="word-spacing:-0.3298em;">&nbsp;ve</span><span class="stl_58 stl_59 stl_1325" style="word-spacing:-0.1828em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1325" style="word-spacing:0.3242em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">将</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;连</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;客</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;户</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;端</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;标</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;为</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:7.9408em;z-index:359; "><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0215em;">c</span><span class="stl_107 stl_108 stl_1258" style="word-spacing:-0.0215em;">−</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0215em;">&gt;f l</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0225em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0225em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0215em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:0.6255em;">&nbsp;|=</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:0.4045em;">&nbsp;REDIS_SLAVE; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.646em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;示</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;部</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;分</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;同</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;步 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:8.4207em;"><span class="stl_58 stl_59 stl_1333" style="word-spacing:0.2481em;">/ #define</span><span class="stl_58 stl_59 stl_1333" style="word-spacing:0.3821em;">&nbsp;REDIS_REPL_ONLINE</span><span class="stl_58 stl_59 stl_1333" style="word-spacing:0.2831em;">&nbsp;9</span><span class="stl_58 stl_59 stl_1333" style="word-spacing:0.4011em;">&nbsp;/*</span><span class="stl_58 stl_59 stl_1333" style="word-spacing:0.2601em;">&nbsp;RDB</span><span class="stl_58 stl_59 stl_1333" style="word-spacing:0.4141em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1333" style="word-spacing:-0.0879em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1333" style="word-spacing:-0.0879em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1333" style="word-spacing:-0.0879em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1333" style="word-spacing:0.6361em;">&nbsp;transmitted</span><span class="stl_58 stl_59 stl_1333" style="word-spacing:0.6361em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:9.655em;"><span class="stl_58 stl_59 stl_828" style="word-spacing:0.397em;">sending j</span><span class="stl_58 stl_59 stl_828" style="word-spacing:-0.319em;">&nbsp;u</span><span class="stl_58 stl_59 stl_828" style="word-spacing:-0.319em;">&nbsp;s</span><span class="stl_58 stl_59 stl_828" style="word-spacing:-0.319em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_172" style="word-spacing:0.3087em;">/ updates</span><span class="stl_58 stl_59 stl_172" style="word-spacing:-0.2033em;">&nbsp;.</span><span class="stl_58 stl_59 stl_172" style="word-spacing:0.3387em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.6293em; left:7.9408em;z-index:462; "><span class="stl_10 stl_11 stl_977" style="word-spacing:0.0056em;">c</span><span class="stl_107 stl_108 stl_977" style="word-spacing:0.0056em;">−</span><span class="stl_10 stl_11 stl_977" style="word-spacing:0.0056em;">&gt;r e</span><span class="stl_10 stl_11 stl_977" style="word-spacing:0.0046em;">&nbsp;p</span><span class="stl_10 stl_11 stl_977" style="word-spacing:0.0056em;">&nbsp;l</span><span class="stl_10 stl_11 stl_977" style="word-spacing:0.0046em;">&nbsp;s t</span><span class="stl_10 stl_11 stl_977" style="word-spacing:0.0056em;">&nbsp;a</span><span class="stl_10 stl_11 stl_977" style="word-spacing:0.0046em;">&nbsp;t</span><span class="stl_10 stl_11 stl_977" style="word-spacing:0.0056em;">&nbsp;e</span><span class="stl_10 stl_11 stl_977" style="word-spacing:0.5156em;">&nbsp;=</span><span class="stl_10 stl_11 stl_977" style="word-spacing:0.2956em;">&nbsp;REDIS_REPL_ONLINE; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4207em;"><span class="stl_58 stl_59 stl_1043">/</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:0.3258em;">&nbsp;</span><span class="stl_17 stl_18 stl_1043" style="word-spacing:0.3258em;">更</span><span class="stl_17 stl_18 stl_1043" style="word-spacing:-0.235em;">&nbsp;新</span><span class="stl_17 stl_18 stl_1043" style="word-spacing:0.3591em;">&nbsp;</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:0.3591em;">ack</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:0.3579em;">&nbsp;</span><span class="stl_17 stl_18 stl_1043" style="word-spacing:0.3579em;">的</span><span class="stl_17 stl_18 stl_1043" style="word-spacing:-0.234em;">&nbsp;时</span><span class="stl_17 stl_18 stl_1043" style="word-spacing:-0.234em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:7.9408em;z-index:503; "><span class="stl_10 stl_11 stl_829" style="word-spacing:0.1759em;">c</span><span class="stl_107 stl_108 stl_829" style="word-spacing:0.1759em;">−</span><span class="stl_10 stl_11 stl_829" style="word-spacing:0.1759em;">&gt;repl_ack_time =</span><span class="stl_10 stl_11 stl_829" style="word-spacing:0.2329em;">&nbsp;server</span><span class="stl_10 stl_11 stl_829" style="word-spacing:-0.1171em;">&nbsp;.</span><span class="stl_10 stl_11 stl_829" style="word-spacing:-0.1571em;">&nbsp;unixtime</span><span class="stl_10 stl_11 stl_829" style="word-spacing:-0.1571em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">添</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;加</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;链</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:7.99em;"><span class="stl_10 stl_11 stl_1259" style="word-spacing:-0.2215em;">listAddNodeTail ( server . slaves , c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">告 诉</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;以</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;部</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;分</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;步，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;收</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;到</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;后</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;做</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;相</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;关</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;准</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;备</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;（注 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.8182em; left:9.6417em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3077em;">册 回 调 函 数） &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:8.4207em;"><span class="stl_58 stl_59 stl_603" style="word-spacing:0.1153em;">* We can</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.1992em;">&nbsp;’</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2292em;">&nbsp;t</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3705em;">&nbsp;use the connection</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.4168em;">&nbsp;b</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2982em;">&nbsp;u</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2992em;">&nbsp;f</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2992em;">&nbsp;f</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2992em;">&nbsp;e</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2982em;">&nbsp;r</span><span class="stl_58 stl_59 stl_603" style="word-spacing:-0.2992em;">&nbsp;s</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.4143em;">&nbsp;since they</span><span class="stl_58 stl_59 stl_603" style="word-spacing:0.3628em;">&nbsp;are &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:9.6383em;"><span class="stl_58 stl_59 stl_183" style="word-spacing:0.3643em;">used to accumulate &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 41.586em; left:9.4155em;"><span class="stl_58 stl_59 stl_554" style="word-spacing:0.2278em;">new commands</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.3178em;">&nbsp;at</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.4638em;">&nbsp;t</span><span class="stl_58 stl_59 stl_554" style="word-spacing:-0.2552em;">&nbsp;h</span><span class="stl_58 stl_59 stl_554" style="word-spacing:-0.2542em;">&nbsp;i</span><span class="stl_58 stl_59 stl_554" style="word-spacing:-0.2552em;">&nbsp;s</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.4828em;">&nbsp;stage</span><span class="stl_58 stl_59 stl_554" style="word-spacing:-0.1392em;">&nbsp;.</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.3808em;">&nbsp;But</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.2588em;">&nbsp;we</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.3038em;">&nbsp;are</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.4038em;">&nbsp;sure the</span><span class="stl_58 stl_59 stl_554" style="word-spacing:0.4388em;">&nbsp;socket &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:10.6308em;"><span class="stl_58 stl_59 stl_885" style="word-spacing:0.4173em;">send b</span><span class="stl_58 stl_59 stl_885" style="word-spacing:-0.2747em;">&nbsp;u</span><span class="stl_58 stl_59 stl_885" style="word-spacing:-0.2747em;">&nbsp;f</span><span class="stl_58 stl_59 stl_885" style="word-spacing:-0.2737em;">&nbsp;f</span><span class="stl_58 stl_59 stl_885" style="word-spacing:-0.2747em;">&nbsp;e</span><span class="stl_58 stl_59 stl_885" style="word-spacing:-0.2747em;">&nbsp;r</span><span class="stl_58 stl_59 stl_885" style="word-spacing:0.4863em;">&nbsp;i</span><span class="stl_58 stl_59 stl_885" style="word-spacing:0.4863em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:9.4462em;"><span class="stl_58 stl_59 stl_815" style="word-spacing:0.3114em;">emtpy so</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.4134em;">&nbsp;t</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2796em;">&nbsp;h</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2796em;">&nbsp;i</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2786em;">&nbsp;s</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.4639em;">&nbsp;write w</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2636em;">&nbsp;i</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2646em;">&nbsp;l</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2636em;">&nbsp;l</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.4519em;">&nbsp;never f</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2436em;">&nbsp;a</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2446em;">&nbsp;i</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2436em;">&nbsp;l</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.5174em;">&nbsp;a</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2856em;">&nbsp;c</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2866em;">&nbsp;t</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2866em;">&nbsp;u</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2866em;">&nbsp;a</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2866em;">&nbsp;l</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2856em;">&nbsp;l</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.2866em;">&nbsp;y</span><span class="stl_58 stl_59 stl_815" style="word-spacing:-0.1396em;">&nbsp;.</span><span class="stl_58 stl_59 stl_815" style="word-spacing:0.3574em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 44.5685em; left:8.005em;"><span class="stl_10 stl_11 stl_1275" style="word-spacing:0.3256em;">buflen = s</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1729em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1739em;">&nbsp;p</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1729em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1729em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1739em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1729em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1739em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.0679em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1439em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.0119em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.0421em;">&nbsp;</span><span class="stl_15 stl_16 stl_1275" style="word-spacing:-0.0421em;">sizeof</span><span class="stl_15 stl_16 stl_1275" style="word-spacing:-0.0967em;">&nbsp;</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.0967em;">(</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1249em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1249em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.0059em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1549em;">&nbsp;”+CONTINUE\</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1729em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1719em;">&nbsp;\n”</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1559em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1275" style="word-spacing:-0.1559em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5652em; left:8.045em;z-index:829; "><span class="stl_15 stl_16 stl_459" style="word-spacing:-0.2576em;">i f</span><span class="stl_15 stl_16 stl_459" style="word-spacing:0.4488em;">&nbsp;</span><span class="stl_10 stl_11 stl_459" style="word-spacing:0.4488em;">(</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.1996em;">&nbsp;write</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.1986em;">&nbsp;(</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.1986em;">&nbsp;c</span><span class="stl_107 stl_108 stl_459" style="word-spacing:-0.1986em;">−</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.2766em;">&gt;fd</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.1036em;">&nbsp;,</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.1966em;">&nbsp;buf</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.1196em;">&nbsp;,</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.1436em;">&nbsp;buflen</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.1996em;">&nbsp;)</span><span class="stl_10 stl_11 stl_459" style="word-spacing:0.3319em;">&nbsp;!= buflen</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.1996em;">&nbsp;)</span><span class="stl_10 stl_11 stl_459" style="word-spacing:-0.1996em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:9.9983em;"><span class="stl_10 stl_11 stl_1147" style="word-spacing:-0.292em;">freeClientAsync ( c ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">154 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:9.9383em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7093em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">向 从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;写</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;积</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;压</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;空</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;间</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;中</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;据，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;积</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;压</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;空</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;间</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;储</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;「更</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;存」 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.9725em;"><span class="stl_10 stl_11 stl_1334" style="word-spacing:0.1282em;">psync_len =</span><span class="stl_10 stl_11 stl_1334" style="word-spacing:-0.1045em;">&nbsp;addReplyReplicationBacklog (</span><span class="stl_10 stl_11 stl_1334" style="word-spacing:-0.3158em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1334" style="word-spacing:-0.2078em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1334" style="word-spacing:-0.1858em;">&nbsp;psync_offset</span><span class="stl_10 stl_11 stl_1334" style="word-spacing:-0.2418em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1334" style="word-spacing:-0.2418em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:8.0008em;"><span class="stl_10 stl_11 stl_98" style="word-spacing:-0.0678em;">redisLog (REDIS_NOTICE, &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:9.9433em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 12.6927em; left:10.5112em;"><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3094em;">Partial ␣ resynchronization ␣ request ␣ accepted . ␣Sending␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:11.4542em;"><span class="stl_10 stl_11 stl_784" style="word-spacing:-0.2493em;">%l l d ␣ bytes ␣ of ␣ backlog ␣ s t a r t i n g ␣from␣ o f f s e t ␣%l l d . ” , &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:12.1167em;"><span class="stl_10 stl_11 stl_275" style="word-spacing:-0.1409em;">psync_len ,</span><span class="stl_10 stl_11 stl_275" style="word-spacing:0.4231em;">&nbsp;psync_offset</span><span class="stl_10 stl_11 stl_275" style="word-spacing:-0.2329em;">&nbsp;)</span><span class="stl_10 stl_11 stl_275" style="word-spacing:-0.2329em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_793" style="word-spacing:0.2991em;">* Note</span><span class="stl_58 stl_59 stl_793" style="word-spacing:0.3831em;">&nbsp;that</span><span class="stl_58 stl_59 stl_793" style="word-spacing:0.3371em;">&nbsp;we</span><span class="stl_58 stl_59 stl_793" style="word-spacing:0.2481em;">&nbsp;don</span><span class="stl_58 stl_59 stl_793" style="word-spacing:-0.1819em;">&nbsp;’</span><span class="stl_58 stl_59 stl_793" style="word-spacing:-0.1989em;">&nbsp;t</span><span class="stl_58 stl_59 stl_793" style="word-spacing:0.3771em;">&nbsp;need to</span><span class="stl_58 stl_59 stl_793" style="word-spacing:0.4454em;">&nbsp;set the s</span><span class="stl_58 stl_59 stl_793" style="word-spacing:-0.2699em;">&nbsp;e</span><span class="stl_58 stl_59 stl_793" style="word-spacing:-0.2699em;">&nbsp;l</span><span class="stl_58 stl_59 stl_793" style="word-spacing:-0.2689em;">&nbsp;e</span><span class="stl_58 stl_59 stl_793" style="word-spacing:-0.2699em;">&nbsp;c</span><span class="stl_58 stl_59 stl_793" style="word-spacing:-0.2699em;">&nbsp;t</span><span class="stl_58 stl_59 stl_793" style="word-spacing:-0.2689em;">&nbsp;e</span><span class="stl_58 stl_59 stl_793" style="word-spacing:-0.2699em;">&nbsp;d</span><span class="stl_58 stl_59 stl_793" style="word-spacing:0.2441em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_793" style="word-spacing:0.2001em;">&nbsp;at &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.6733em;"><span class="stl_58 stl_59 stl_1335" style="word-spacing:-0.3374em;">server . s l a v e s e l d b &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.4911em;z-index:325; "><span class="stl_58 stl_59 stl_827">to</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.2689em;">&nbsp;</span><span class="stl_107 stl_108 stl_827">−</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.2689em;">1 to</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.445em;">&nbsp;force the</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.3981em;">&nbsp;master to emit</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.2325em;">&nbsp;SELECT,</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.4525em;">&nbsp;since</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.4525em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:10.1817em;z-index:366; "><span class="stl_58 stl_59 stl_216" style="word-spacing:-0.3656em;">sl a</span><span class="stl_58 stl_59 stl_216" style="word-spacing:-0.3656em;">&nbsp;v</span><span class="stl_58 stl_59 stl_216" style="word-spacing:-0.3666em;">&nbsp;e</span><span class="stl_58 stl_59 stl_216" style="word-spacing:0.3644em;">&nbsp;already &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 19.6685em; left:9.4687em;"><span class="stl_58 stl_59 stl_1332" style="word-spacing:0.3812em;">has t</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3108em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3108em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3098em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:0.4482em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3188em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3198em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3198em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:-0.3188em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:0.3482em;">&nbsp;from</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:0.3132em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:0.3652em;">&nbsp;previous connection with</span><span class="stl_58 stl_59 stl_1332" style="word-spacing:0.3652em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:10.1333em;"><span class="stl_58 stl_59 stl_707" style="word-spacing:-0.185em;">master .</span><span class="stl_58 stl_59 stl_707" style="word-spacing:0.382em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:7.9883em;"><span class="stl_10 stl_11 stl_1297" style="word-spacing:-0.1949em;">refreshGoodSlavesCount () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:7.9458em;"><span class="stl_15 stl_16 stl_386">return</span><span class="stl_15 stl_16 stl_386" style="word-spacing:0.2495em;">&nbsp;</span><span class="stl_10 stl_11 stl_386" style="word-spacing:0.2495em;">REDIS_OK;</span><span class="stl_10 stl_11 stl_386" style="word-spacing:0.48em;">&nbsp;</span><span class="stl_58 stl_59 stl_386" style="word-spacing:0.48em;">/*</span><span class="stl_58 stl_59 stl_386" style="word-spacing:0.3464em;">&nbsp;The</span><span class="stl_58 stl_59 stl_386" style="word-spacing:0.4634em;">&nbsp;c</span><span class="stl_58 stl_59 stl_386" style="word-spacing:-0.1636em;">&nbsp;a</span><span class="stl_58 stl_59 stl_386" style="word-spacing:-0.1646em;">&nbsp;l</span><span class="stl_58 stl_59 stl_386" style="word-spacing:-0.1636em;">&nbsp;l</span><span class="stl_58 stl_59 stl_386" style="word-spacing:-0.1646em;">&nbsp;e</span><span class="stl_58 stl_59 stl_386" style="word-spacing:-0.1636em;">&nbsp;r</span><span class="stl_58 stl_59 stl_386" style="word-spacing:0.5024em;">&nbsp;can</span><span class="stl_58 stl_59 stl_386" style="word-spacing:0.4344em;">&nbsp;return</span><span class="stl_58 stl_59 stl_386" style="word-spacing:0.0224em;">&nbsp;,</span><span class="stl_58 stl_59 stl_386" style="word-spacing:0.4474em;">&nbsp;no</span><span class="stl_58 stl_59 stl_386" style="word-spacing:0.5104em;">&nbsp;f</span><span class="stl_58 stl_59 stl_386" style="word-spacing:-0.1316em;">&nbsp;u</span><span class="stl_58 stl_59 stl_386" style="word-spacing:-0.1316em;">&nbsp;l</span><span class="stl_58 stl_59 stl_386" style="word-spacing:-0.1326em;">&nbsp;l</span><span class="stl_58 stl_59 stl_386" style="word-spacing:0.5834em;">&nbsp;resync &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:10.1317em;"><span class="stl_58 stl_59 stl_570" style="word-spacing:-0.183em;">needed .</span><span class="stl_58 stl_59 stl_570" style="word-spacing:0.385em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:5.9992em;"><span class="stl_10 stl_11 stl_606" style="word-spacing:-0.2024em;">need_full_resync : &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6368em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_715">/</span><span class="stl_58 stl_59 stl_715" style="word-spacing:0.5652em;">&nbsp;</span><span class="stl_17 stl_18 stl_715" style="word-spacing:0.5652em;">向</span><span class="stl_17 stl_18 stl_715" style="word-spacing:0.0044em;">&nbsp;从</span><span class="stl_17 stl_18 stl_715" style="word-spacing:0.0054em;">&nbsp;机 发 送</span><span class="stl_17 stl_18 stl_715" style="word-spacing:0.4308em;">&nbsp;</span><span class="stl_58 stl_59 stl_715" style="word-spacing:0.4308em;">+FULLRESYNC runid</span><span class="stl_58 stl_59 stl_715" style="word-spacing:0.6724em;">&nbsp;r</span><span class="stl_58 stl_59 stl_715" style="word-spacing:-0.0376em;">&nbsp;e</span><span class="stl_58 stl_59 stl_715" style="word-spacing:-0.0376em;">&nbsp;p</span><span class="stl_58 stl_59 stl_715" style="word-spacing:-0.0376em;">&nbsp;l</span><span class="stl_58 stl_59 stl_715" style="word-spacing:-0.0376em;">&nbsp;_</span><span class="stl_58 stl_59 stl_715" style="word-spacing:-0.0386em;">&nbsp;o</span><span class="stl_58 stl_59 stl_715" style="word-spacing:-0.0376em;">&nbsp;f</span><span class="stl_58 stl_59 stl_715" style="word-spacing:-0.0376em;">&nbsp;f</span><span class="stl_58 stl_59 stl_715" style="word-spacing:-0.0376em;">&nbsp;s</span><span class="stl_58 stl_59 stl_715" style="word-spacing:-0.0376em;">&nbsp;e</span><span class="stl_58 stl_59 stl_715" style="word-spacing:-0.0376em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 31.6218em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">\</span></div>
					<div class="stl_01" style="top: 31.6218em; left:6.527em;"><span class="stl_10 stl_11 stl_1336" style="word-spacing:-0.3702em;">s ectio n { </span><span class="stl_17 stl_18 stl_1336" style="word-spacing:-0.3702em;">暂 缓 主 机</span><span class="stl_10 stl_11 stl_1336" style="word-spacing:-0.3702em;">} &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:5.9883em;"><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">从 机</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;因</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;为</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;某</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;些</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;原</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0221em;">&nbsp;因，</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0221em;">&nbsp;譬</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;如</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;网</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;络</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;延</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;迟</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;（</span><span class="stl_10 stl_11 stl_818" style="word-spacing:-0.0551em;">PING</span><span class="stl_10 stl_11 stl_818" style="word-spacing:0.4095em;">&nbsp;</span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.4095em;">超</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0231em;">&nbsp;时，</span><span class="stl_10 stl_11 stl_818" style="word-spacing:-0.0231em;">ACK</span><span class="stl_10 stl_11 stl_818" style="word-spacing:0.3315em;">&nbsp;</span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.3315em;">超</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0551em;">&nbsp;时</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0051em;">&nbsp;等</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.1051em;">&nbsp;）</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.1051em;">&nbsp;，</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0051em;">&nbsp;可</span><span class="stl_17 stl_18 stl_818" style="word-spacing:-0.0051em;">&nbsp;能 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.8332em; left:7.6492em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3106em;">会 断 开 与 主 机 的 连 接。 这 时 候， 从 机 会 尝 试 保 存 与 主 机 连 接 的 信 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.829em; left:7.6767em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3093em;">息， 譬 如 全 局 积 压 空 间 数 据 偏 移 量 等， 以 便 下 一 次 的 部 分 同 步， 并 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.8257em; left:7.6492em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3106em;">且 从 机 会 再 一 次 尝 试 连 接 主 机。 注 意 一 点， 如 果 断 开 的 时 间 足 够 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.8215em; left:7.6767em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:0.317em;">长， 部</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;分</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;步</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;肯</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;定</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;会</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;失</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;败</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5868em; left:5.9483em;"><span class="stl_15 stl_16 stl_1180">void</span><span class="stl_15 stl_16 stl_1180" style="word-spacing:0.4195em;">&nbsp;</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:0.4195em;">f</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.234em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.233em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.233em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.234em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.233em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.233em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.233em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.233em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.233em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.128em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.131em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.236em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.236em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.237em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.236em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.236em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.236em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.237em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.236em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.236em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.236em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:0.414em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.209em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1180" style="word-spacing:-0.209em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:8.01em;"><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">listNode * ln</span><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:8.4207em;"><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3813em;">* I</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2777em;">&nbsp;f</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.4903em;">&nbsp;t</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2787em;">&nbsp;h</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2777em;">&nbsp;i</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2787em;">&nbsp;s</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.4823em;">&nbsp;i</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2847em;">&nbsp;s</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3743em;">&nbsp;marked</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3063em;">&nbsp;as</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.3723em;">&nbsp;current</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.4533em;">&nbsp;c</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2717em;">&nbsp;l</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2727em;">&nbsp;i</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2717em;">&nbsp;e</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2717em;">&nbsp;n</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2717em;">&nbsp;t</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.4503em;">&nbsp;unset i</span><span class="stl_58 stl_59 stl_689" style="word-spacing:-0.2597em;">&nbsp;t</span><span class="stl_58 stl_59 stl_689" style="word-spacing:0.4003em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5727em; left:8.045em;"><span class="stl_15 stl_16 stl_581" style="word-spacing:-0.3409em;">i f</span><span class="stl_15 stl_16 stl_581" style="word-spacing:0.3655em;">&nbsp;</span><span class="stl_10 stl_11 stl_581" style="word-spacing:0.3655em;">(</span><span class="stl_10 stl_11 stl_581" style="word-spacing:-0.2679em;">&nbsp;server</span><span class="stl_10 stl_11 stl_581" style="word-spacing:-0.2119em;">&nbsp;.</span><span class="stl_10 stl_11 stl_581" style="word-spacing:-0.2169em;">&nbsp;current_client</span><span class="stl_10 stl_11 stl_581" style="word-spacing:0.1041em;">&nbsp;==</span><span class="stl_10 stl_11 stl_581" style="word-spacing:-0.1459em;">&nbsp;c )</span><span class="stl_10 stl_11 stl_581" style="word-spacing:0.3321em;">&nbsp;server</span><span class="stl_10 stl_11 stl_581" style="word-spacing:-0.2129em;">&nbsp;.</span><span class="stl_10 stl_11 stl_581" style="word-spacing:-0.2159em;">&nbsp;current_client</span><span class="stl_10 stl_11 stl_581" style="word-spacing:-0.2159em;">&nbsp;= &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:9.5em;"><span class="stl_10 stl_11 stl_1082">NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.5676em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">如 果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;此</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;为</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;机，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;已</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;经</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;连</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;机，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;能</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;需</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;要</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;保</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;状</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;态</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;信 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">14.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">部分同步 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">155 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.6692em;"><span class="stl_17 stl_18 stl_1337" style="word-spacing:0.0474em;">息， 以</span><span class="stl_17 stl_18 stl_1337" style="word-spacing:0.0144em;">&nbsp;便 进 行</span><span class="stl_17 stl_18 stl_1337" style="word-spacing:0.4415em;">&nbsp;</span><span class="stl_58 stl_59 stl_1337" style="word-spacing:0.4415em;">PSYNC &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_703" style="word-spacing:0.347em;">* I</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.312em;">&nbsp;f</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.475em;">&nbsp;i</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.294em;">&nbsp;t</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.467em;">&nbsp;i</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.319em;">&nbsp;s</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.363em;">&nbsp;our</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.294em;">&nbsp;master</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.354em;">&nbsp;that</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.143em;">&nbsp;’</span><span class="stl_58 stl_59 stl_703" style="word-spacing:-0.287em;">&nbsp;s</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.3575em;">&nbsp;beging disconnected</span><span class="stl_58 stl_59 stl_703" style="word-spacing:0.272em;">&nbsp;we &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.6608em;"><span class="stl_58 stl_59 stl_423" style="word-spacing:0.3077em;">should make sure &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.4911em;"><span class="stl_58 stl_59 stl_1338" style="word-spacing:0.3134em;">to cache the</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:0.3754em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:-0.3476em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:-0.3486em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:-0.3486em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:-0.3476em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:0.3609em;">&nbsp;to try</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:0.2914em;">&nbsp;a p</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:-0.3386em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:-0.3396em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:-0.3386em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:-0.3386em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:-0.3386em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:-0.3396em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1338" style="word-spacing:0.3984em;">&nbsp;resynchronization &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.1975em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.08em;">l a</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.081em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.08em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.08em;">&nbsp;r</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.08em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 11.6985em; left:9.4512em;"><span class="stl_58 stl_59 stl_802" style="word-spacing:0.3484em;">Note that</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.4034em;">&nbsp;before doing t</span><span class="stl_58 stl_59 stl_802" style="word-spacing:-0.2976em;">&nbsp;h</span><span class="stl_58 stl_59 stl_802" style="word-spacing:-0.2966em;">&nbsp;i</span><span class="stl_58 stl_59 stl_802" style="word-spacing:-0.2976em;">&nbsp;s</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.3274em;">&nbsp;we</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.1894em;">&nbsp;make</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.2784em;">&nbsp;sure</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.3964em;">&nbsp;that</span><span class="stl_58 stl_59 stl_802" style="word-spacing:0.3964em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:10.2017em;"><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2813em;">c l</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2803em;">&nbsp;i</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2803em;">&nbsp;e</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2813em;">&nbsp;n</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2803em;">&nbsp;t</span><span class="stl_58 stl_59 stl_178" style="word-spacing:0.4807em;">&nbsp;i</span><span class="stl_58 stl_59 stl_178" style="word-spacing:-0.2933em;">&nbsp;s</span><span class="stl_58 stl_59 stl_178" style="word-spacing:0.4047em;">&nbsp;not</span><span class="stl_58 stl_59 stl_178" style="word-spacing:0.3537em;">&nbsp;in &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 13.691em; left:9.4255em;"><span class="stl_58 stl_59 stl_890" style="word-spacing:0.2879em;">some unexpected</span><span class="stl_58 stl_59 stl_890" style="word-spacing:0.3829em;">&nbsp;state</span><span class="stl_58 stl_59 stl_890" style="word-spacing:-0.0471em;">&nbsp;,</span><span class="stl_58 stl_59 stl_890" style="word-spacing:0.3544em;">&nbsp;by checking</span><span class="stl_58 stl_59 stl_890" style="word-spacing:0.4459em;">&nbsp;i</span><span class="stl_58 stl_59 stl_890" style="word-spacing:-0.2781em;">&nbsp;t</span><span class="stl_58 stl_59 stl_890" style="word-spacing:-0.2781em;">&nbsp;s</span><span class="stl_58 stl_59 stl_890" style="word-spacing:0.4979em;">&nbsp;f</span><span class="stl_58 stl_59 stl_890" style="word-spacing:-0.2901em;">&nbsp;l</span><span class="stl_58 stl_59 stl_890" style="word-spacing:-0.2891em;">&nbsp;a</span><span class="stl_58 stl_59 stl_890" style="word-spacing:-0.2901em;">&nbsp;g</span><span class="stl_58 stl_59 stl_890" style="word-spacing:-0.2901em;">&nbsp;s</span><span class="stl_58 stl_59 stl_890" style="word-spacing:-0.1431em;">&nbsp;.</span><span class="stl_58 stl_59 stl_890" style="word-spacing:0.3389em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:8.045em;z-index:249; "><span class="stl_15 stl_16 stl_410" style="word-spacing:-0.086em;">i f</span><span class="stl_15 stl_16 stl_410" style="word-spacing:0.6204em;">&nbsp;</span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.6204em;">(</span><span class="stl_10 stl_11 stl_410" style="word-spacing:-0.013em;">&nbsp;server</span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.043em;">&nbsp;.</span><span class="stl_10 stl_11 stl_410" style="word-spacing:-0.008em;">&nbsp;master</span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.312em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.312em;">&nbsp;c</span><span class="stl_107 stl_108 stl_410" style="word-spacing:0.312em;">−</span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.27em;">&gt;f</span><span class="stl_10 stl_11 stl_410" style="word-spacing:-0.091em;">&nbsp;l</span><span class="stl_10 stl_11 stl_410" style="word-spacing:-0.092em;">&nbsp;a</span><span class="stl_10 stl_11 stl_410" style="word-spacing:-0.092em;">&nbsp;g</span><span class="stl_10 stl_11 stl_410" style="word-spacing:-0.091em;">&nbsp;s</span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.419em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.171em;">&nbsp;REDIS_MASTER)</span><span class="stl_10 stl_11 stl_410" style="word-spacing:0.171em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:9.9933em;"><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.1442em;">redisLog (REDIS_WARNING, ” Connection␣with␣master␣ l o s t . ” &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:11.6383em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 16.6785em; left:12.1822em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:10.0375em;z-index:332; "><span class="stl_15 stl_16 stl_1339" style="word-spacing:0.0548em;">i f</span><span class="stl_15 stl_16 stl_1339" style="word-spacing:0.8415em;">&nbsp;</span><span class="stl_10 stl_11 stl_1339" style="word-spacing:0.8415em;">(</span><span class="stl_10 stl_11 stl_1339" style="word-spacing:0.0648em;">&nbsp;! (</span><span class="stl_10 stl_11 stl_1339" style="word-spacing:0.0648em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1339" style="word-spacing:0.0648em;">−</span><span class="stl_10 stl_11 stl_1339" style="word-spacing:0.1168em;">&gt;f</span><span class="stl_10 stl_11 stl_1339" style="word-spacing:0.0491em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1339" style="word-spacing:0.5608em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1339" style="word-spacing:0.4948em;">&nbsp;(REDIS_CLOSE_AFTER_REPLY| &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:18.8033em;"><span class="stl_10 stl_11 stl_1340">REDIS_CLOSE_ASAP| &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:18.7917em;"><span class="stl_10 stl_11 stl_1341">REDIS_BLOCKED| &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:18.7842em;"><span class="stl_10 stl_11 stl_1342" style="word-spacing:0.1225em;">REDIS_UNBLOCKED) ) ) &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 22.656em; left:11.9875em;"><span class="stl_10 stl_11 stl_936" style="word-spacing:-0.2847em;">replicationCacheMaster ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:11.9308em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 26.641em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 26.641em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.631em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:6.4282em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">为 了</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;实</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;现</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;部</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;分</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;同</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;步，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;从</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;机</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;会</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;保</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;存</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;主</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;机</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;的</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;状</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;态</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;信</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;息</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;后</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;才</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;会</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;断</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;开</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;主</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;机</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;的 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.8482em; left:7.6492em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3066em;">连 接， 主 机 状 态 信 息 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6235em; left:6.4282em;"><span class="stl_58 stl_59 stl_63">/</span><span class="stl_58 stl_59 stl_63" style="word-spacing:0.3084em;">&nbsp;</span><span class="stl_17 stl_18 stl_63" style="word-spacing:0.3084em;">保</span><span class="stl_17 stl_18 stl_63" style="word-spacing:-0.2524em;">&nbsp;存</span><span class="stl_17 stl_18 stl_63" style="word-spacing:-0.2514em;">&nbsp;在</span><span class="stl_17 stl_18 stl_63" style="word-spacing:0.3873em;">&nbsp;</span><span class="stl_58 stl_59 stl_63" style="word-spacing:0.3873em;">server</span><span class="stl_58 stl_59 stl_63" style="word-spacing:-0.1664em;">&nbsp;.</span><span class="stl_58 stl_59 stl_63" style="word-spacing:-0.2204em;">&nbsp;cached_master &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:6.4282em;"><span class="stl_58 stl_59 stl_1176">/</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.0339em;">&nbsp;</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.0339em;">会 在</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.0144em;">&nbsp;</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.0144em;">f r</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.3573em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.3573em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.3563em;">&nbsp;C</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.3573em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.3573em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.3573em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.3573em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.3563em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:-0.2303em;">&nbsp;()</span><span class="stl_58 stl_59 stl_1176" style="word-spacing:0.3143em;">&nbsp;</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:0.3143em;">中</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;调</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.2803em;">&nbsp;用，</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.2803em;">&nbsp;保</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;存</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;与</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;主</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;连</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;接</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;状</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;态</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;信</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.2803em;">&nbsp;息，</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.2803em;">&nbsp;以</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;便</span><span class="stl_17 stl_18 stl_1176" style="word-spacing:-0.3133em;">&nbsp;进 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:7.6492em;"><span class="stl_17 stl_18 stl_1343" style="word-spacing:0.523em;">行 </span><span class="stl_58 stl_59 stl_1343" style="word-spacing:0.523em;">PSYNC &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:5.9483em;"><span class="stl_15 stl_16 stl_83">void</span><span class="stl_15 stl_16 stl_83" style="word-spacing:0.2941em;">&nbsp;</span><span class="stl_10 stl_11 stl_83" style="word-spacing:0.2941em;">replicationCacheMaster</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2523em;">&nbsp;(</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2223em;">&nbsp;r</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3273em;">&nbsp;e</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3273em;">&nbsp;d</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3273em;">&nbsp;i</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3283em;">&nbsp;s</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3273em;">&nbsp;C</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3273em;">&nbsp;l</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3273em;">&nbsp;i</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3283em;">&nbsp;e</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3273em;">&nbsp;n</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3273em;">&nbsp;t</span><span class="stl_10 stl_11 stl_83" style="word-spacing:0.3227em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3003em;">&nbsp;)</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3003em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:8.01em;"><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">listNode * ln</span><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:8.0208em;"><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.1917em;">redisAssert (</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.1957em;">&nbsp;server</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.1397em;">&nbsp;.</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.1917em;">&nbsp;master</span><span class="stl_10 stl_11 stl_550" style="word-spacing:0.2963em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_550" style="word-spacing:0.1333em;">&nbsp;NULL</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.0347em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_550" style="word-spacing:0.1793em;">&nbsp;server</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.1397em;">&nbsp;.</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2017em;">&nbsp;cached_master &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:9.9583em;"><span class="stl_10 stl_11 stl_1272" style="word-spacing:0.2772em;">== NULL)</span><span class="stl_10 stl_11 stl_1272" style="word-spacing:0.2772em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:8.0008em;"><span class="stl_10 stl_11 stl_610" style="word-spacing:-0.2133em;">redisLog (REDIS_NOTICE, ”Caching␣ the ␣ disconnected ␣master␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:9.6808em;"><span class="stl_10 stl_11 stl_1344" style="word-spacing:-0.3022em;">state . ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;客</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;户</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;端</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;删</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;除</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;信</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;息 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:8.4207em;"><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.3152em;">* Remove from</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.4207em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.5717em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.1513em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.1523em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.1523em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.5747em;">&nbsp;of</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.5127em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.2143em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.2133em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.2143em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.2143em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.2143em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.2143em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.0897em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.4007em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.3077em;">&nbsp;don</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.1213em;">&nbsp;’</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.1403em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.4462em;">&nbsp;want t</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.2033em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.2033em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:-0.2033em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:9.7033em;"><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.289em;">c l</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.288em;">&nbsp;i</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.288em;">&nbsp;e</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.288em;">&nbsp;n</span><span class="stl_58 stl_59 stl_101" style="word-spacing:-0.289em;">&nbsp;t</span><span class="stl_58 stl_59 stl_101" style="word-spacing:0.431em;">&nbsp;to</span><span class="stl_58 stl_59 stl_101" style="word-spacing:0.349em;">&nbsp;be &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 45.5718em; left:9.5492em;"><span class="stl_58 stl_59 stl_396" style="word-spacing:-0.1978em;">l i</span><span class="stl_58 stl_59 stl_396" style="word-spacing:-0.1968em;">&nbsp;s</span><span class="stl_58 stl_59 stl_396" style="word-spacing:-0.1978em;">&nbsp;t</span><span class="stl_58 stl_59 stl_396" style="word-spacing:-0.1978em;">&nbsp;e</span><span class="stl_58 stl_59 stl_396" style="word-spacing:-0.1968em;">&nbsp;d</span><span class="stl_58 stl_59 stl_396" style="word-spacing:0.4872em;">&nbsp;by</span><span class="stl_58 stl_59 stl_396" style="word-spacing:0.2602em;">&nbsp;CLIENT</span><span class="stl_58 stl_59 stl_396" style="word-spacing:0.1962em;">&nbsp;LIST</span><span class="stl_58 stl_59 stl_396" style="word-spacing:0.3242em;">&nbsp;or</span><span class="stl_58 stl_59 stl_396" style="word-spacing:0.4377em;">&nbsp;processed in</span><span class="stl_58 stl_59 stl_396" style="word-spacing:0.3832em;">&nbsp;any</span><span class="stl_58 stl_59 stl_396" style="word-spacing:0.3207em;">&nbsp;way by</span><span class="stl_58 stl_59 stl_396" style="word-spacing:0.4192em;">&nbsp;batch &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:10.665em;"><span class="stl_58 stl_59 stl_908" style="word-spacing:-0.2226em;">operations .</span><span class="stl_58 stl_59 stl_908" style="word-spacing:0.3044em;">&nbsp;*/ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">156 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 14.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">主从复制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.9992em;"><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.0407em;">ln = listSearchKey (</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.2666em;">&nbsp;server</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.2116em;">&nbsp;.</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.1986em;">&nbsp;c</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.3586em;">&nbsp;l</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.3596em;">&nbsp;i</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.3586em;">&nbsp;e</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.3596em;">&nbsp;n</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.3586em;">&nbsp;t</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.3596em;">&nbsp;s</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.0406em;">&nbsp;,</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.2776em;">&nbsp;c</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.3336em;">&nbsp;)</span><span class="stl_10 stl_11 stl_216" style="word-spacing:-0.3336em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:8.0208em;"><span class="stl_10 stl_11 stl_1043" style="word-spacing:-0.181em;">redisAssert (</span><span class="stl_10 stl_11 stl_1043" style="word-spacing:-0.206em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_1043" style="word-spacing:0.336em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_1043" style="word-spacing:-0.0115em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_1043" style="word-spacing:-0.0115em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:8.0033em;"><span class="stl_10 stl_11 stl_796" style="word-spacing:-0.2779em;">listDelNode ( server . c l i e n t s , ln ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">保</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;状</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;态</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;信</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;息 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4207em;"><span class="stl_58 stl_59 stl_674" style="word-spacing:0.2805em;">* Save</span><span class="stl_58 stl_59 stl_674" style="word-spacing:0.3515em;">&nbsp;the master</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.2205em;">&nbsp;.</span><span class="stl_58 stl_59 stl_674" style="word-spacing:0.4025em;">&nbsp;Server</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.1965em;">&nbsp;.</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.2205em;">&nbsp;master</span><span class="stl_58 stl_59 stl_674" style="word-spacing:0.4165em;">&nbsp;w</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.2765em;">&nbsp;i</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.2765em;">&nbsp;l</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.2755em;">&nbsp;l</span><span class="stl_58 stl_59 stl_674" style="word-spacing:0.4067em;">&nbsp;be set to n</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.3015em;">&nbsp;u</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.3015em;">&nbsp;l</span><span class="stl_58 stl_59 stl_674" style="word-spacing:-0.3015em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:9.6992em;"><span class="stl_58 stl_59 stl_373" style="word-spacing:-0.248em;">l a</span><span class="stl_58 stl_59 stl_373" style="word-spacing:-0.248em;">&nbsp;t</span><span class="stl_58 stl_59 stl_373" style="word-spacing:-0.249em;">&nbsp;e</span><span class="stl_58 stl_59 stl_373" style="word-spacing:-0.248em;">&nbsp;r</span><span class="stl_58 stl_59 stl_373" style="word-spacing:0.437em;">&nbsp;by &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.4977em;"><span class="stl_58 stl_59 stl_1065" style="word-spacing:-0.2459em;">replicationHandleMasterDisconnection ()</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:-0.2259em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1065" style="word-spacing:0.3051em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:8.0175em;"><span class="stl_10 stl_11 stl_989" style="word-spacing:-0.1589em;">server .</span><span class="stl_10 stl_11 stl_989" style="word-spacing:-0.2209em;">&nbsp;cached_master</span><span class="stl_10 stl_11 stl_989" style="word-spacing:0.1301em;">&nbsp;=</span><span class="stl_10 stl_11 stl_989" style="word-spacing:0.1911em;">&nbsp;server</span><span class="stl_10 stl_11 stl_989" style="word-spacing:-0.1589em;">&nbsp;.</span><span class="stl_10 stl_11 stl_989" style="word-spacing:-0.2109em;">&nbsp;master</span><span class="stl_10 stl_11 stl_989" style="word-spacing:-0.2109em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">注 销</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;事</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;件，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;关</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;闭</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;连</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;接 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4207em;"><span class="stl_58 stl_59 stl_1346" style="word-spacing:0.2375em;">* Remove</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:0.3025em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:0.403em;">&nbsp;event handlers</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:0.3495em;">&nbsp;and c</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:-0.2935em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:-0.2945em;">&nbsp;o</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:-0.2935em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:-0.2935em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:0.424em;">&nbsp;the socket</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:-0.1595em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:0.2155em;">&nbsp;We’</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:-0.1175em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1346" style="word-spacing:-0.1175em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.6992em;"><span class="stl_58 stl_59 stl_844" style="word-spacing:-0.317em;">l a</span><span class="stl_58 stl_59 stl_844" style="word-spacing:-0.317em;">&nbsp;t</span><span class="stl_58 stl_59 stl_844" style="word-spacing:-0.318em;">&nbsp;e</span><span class="stl_58 stl_59 stl_844" style="word-spacing:-0.317em;">&nbsp;r</span><span class="stl_58 stl_59 stl_844" style="word-spacing:0.402em;">&nbsp;reuse &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.4952em;"><span class="stl_58 stl_59 stl_679" style="word-spacing:0.3848em;">the socket of the</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.274em;">&nbsp;new connection</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.3558em;">&nbsp;with the</span><span class="stl_58 stl_59 stl_679" style="word-spacing:0.3558em;">&nbsp;master &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:10.1517em;"><span class="stl_58 stl_59 stl_1347" style="word-spacing:0.3153em;">during PSYNC.</span><span class="stl_58 stl_59 stl_1347" style="word-spacing:0.4803em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:8.0017em;z-index:397; "><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.1115em;">aeDeleteFileEvent (</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.0915em;">&nbsp;server</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.0365em;">&nbsp;.</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.0615em;">&nbsp;el</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.07em;">&nbsp;, c</span><span class="stl_107 stl_108 stl_440" style="word-spacing:-0.07em;">−</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.07em;">&gt;fd</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.0115em;">&nbsp;,AE_READABLE)</span><span class="stl_10 stl_11 stl_440" style="word-spacing:-0.0115em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:8.0017em;z-index:444; "><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.1159em;">aeDeleteFileEvent (</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.0959em;">&nbsp;server</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.0409em;">&nbsp;.</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.0659em;">&nbsp;el</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.0788em;">&nbsp;, c</span><span class="stl_107 stl_108 stl_609" style="word-spacing:-0.0788em;">−</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.0788em;">&gt;fd</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.0159em;">&nbsp;,AE_WRITABLE)</span><span class="stl_10 stl_11 stl_609" style="word-spacing:-0.0159em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:8.0283em;z-index:469; "><span class="stl_10 stl_11 stl_1348" style="word-spacing:-0.0809em;">c l</span><span class="stl_10 stl_11 stl_1348" style="word-spacing:-0.0799em;">&nbsp;o</span><span class="stl_10 stl_11 stl_1348" style="word-spacing:-0.0809em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1348" style="word-spacing:-0.0799em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1348" style="word-spacing:-0.0539em;">&nbsp;( c</span><span class="stl_107 stl_108 stl_1348" style="word-spacing:-0.0539em;">−</span><span class="stl_10 stl_11 stl_1348" style="word-spacing:-0.0539em;">&gt;fd</span><span class="stl_10 stl_11 stl_1348" style="word-spacing:-0.0189em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1348" style="word-spacing:-0.0189em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_935" style="word-spacing:0.3317em;">* Set</span><span class="stl_58 stl_59 stl_935" style="word-spacing:0.4042em;">&nbsp;fd to</span><span class="stl_58 stl_59 stl_935" style="word-spacing:0.2344em;">&nbsp;</span><span class="stl_107 stl_108 stl_935" style="word-spacing:0.4042em;">−</span><span class="stl_58 stl_59 stl_935" style="word-spacing:0.2344em;">1 so</span><span class="stl_58 stl_59 stl_935" style="word-spacing:0.3977em;">&nbsp;that</span><span class="stl_58 stl_59 stl_935" style="word-spacing:0.3297em;">&nbsp;we</span><span class="stl_58 stl_59 stl_935" style="word-spacing:0.2537em;">&nbsp;can</span><span class="stl_58 stl_59 stl_935" style="word-spacing:0.3957em;">&nbsp;s</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2713em;">&nbsp;a</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2713em;">&nbsp;f</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2703em;">&nbsp;e</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2713em;">&nbsp;l</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2713em;">&nbsp;y</span><span class="stl_58 stl_59 stl_935" style="word-spacing:0.5127em;">&nbsp;c</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2553em;">&nbsp;a</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2543em;">&nbsp;l</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2553em;">&nbsp;l</span><span class="stl_58 stl_59 stl_935" style="word-spacing:0.5017em;">&nbsp;f</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2823em;">&nbsp;r</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2823em;">&nbsp;e</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2823em;">&nbsp;e</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2813em;">&nbsp;C</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2823em;">&nbsp;l</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2823em;">&nbsp;i</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2823em;">&nbsp;e</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2823em;">&nbsp;n</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2813em;">&nbsp;t</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.1873em;">&nbsp;(</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2723em;">&nbsp;c</span><span class="stl_58 stl_59 stl_935" style="word-spacing:-0.2723em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:9.6992em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.2em;">l a</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.2em;">&nbsp;t</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.201em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.2em;">&nbsp;r</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.053em;">&nbsp;.</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.435em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:7.9408em;z-index:529; "><span class="stl_10 stl_11 stl_984" style="word-spacing:0.3425em;">c</span><span class="stl_107 stl_108 stl_984" style="word-spacing:0.3425em;">−</span><span class="stl_10 stl_11 stl_984" style="word-spacing:0.3425em;">&gt;fd = </span><span class="stl_107 stl_108 stl_984" style="word-spacing:0.3425em;">−</span><span class="stl_10 stl_11 stl_984" style="word-spacing:0.3425em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_291">/</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.3551em;">&nbsp;</span><span class="stl_17 stl_18 stl_291" style="word-spacing:0.3551em;">修</span><span class="stl_17 stl_18 stl_291" style="word-spacing:-0.2057em;">&nbsp;改</span><span class="stl_17 stl_18 stl_291" style="word-spacing:-0.2047em;">&nbsp;连</span><span class="stl_17 stl_18 stl_291" style="word-spacing:-0.2047em;">&nbsp;接</span><span class="stl_17 stl_18 stl_291" style="word-spacing:-0.2047em;">&nbsp;的</span><span class="stl_17 stl_18 stl_291" style="word-spacing:-0.2047em;">&nbsp;状</span><span class="stl_17 stl_18 stl_291" style="word-spacing:-0.1707em;">&nbsp;态，</span><span class="stl_17 stl_18 stl_291" style="word-spacing:-0.1717em;">&nbsp;设</span><span class="stl_17 stl_18 stl_291" style="word-spacing:-0.2047em;">&nbsp;置</span><span class="stl_17 stl_18 stl_291" style="word-spacing:0.434em;">&nbsp;</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.434em;">server</span><span class="stl_58 stl_59 stl_291" style="word-spacing:-0.1197em;">&nbsp;.</span><span class="stl_58 stl_59 stl_291" style="word-spacing:-0.1657em;">&nbsp;master</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.2043em;">&nbsp;=</span><span class="stl_58 stl_59 stl_291" style="word-spacing:0.0433em;">&nbsp;NULL &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_1334" style="word-spacing:0.2702em;">* Caching</span><span class="stl_58 stl_59 stl_1334" style="word-spacing:0.3397em;">&nbsp;the master</span><span class="stl_58 stl_59 stl_1334" style="word-spacing:0.3102em;">&nbsp;happens</span><span class="stl_58 stl_59 stl_1334" style="word-spacing:0.3805em;">&nbsp;instead of the</span><span class="stl_58 stl_59 stl_1334" style="word-spacing:0.3805em;">&nbsp;actual &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:9.6883em;"><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.349em;">f r</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.347em;">&nbsp;e</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.348em;">&nbsp;e</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.348em;">&nbsp;C</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.348em;">&nbsp;l</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.348em;">&nbsp;i</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.347em;">&nbsp;e</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.348em;">&nbsp;n</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.348em;">&nbsp;t</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.22em;">&nbsp;()</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.376em;">&nbsp;c</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.351em;">&nbsp;a</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.351em;">&nbsp;l</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.351em;">&nbsp;l</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.351em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 31.6235em; left:9.4695em;"><span class="stl_58 stl_59 stl_998" style="word-spacing:0.2753em;">so make sure</span><span class="stl_58 stl_59 stl_998" style="word-spacing:0.395em;">&nbsp;to adjust the</span><span class="stl_58 stl_59 stl_998" style="word-spacing:0.4283em;">&nbsp;r</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2947em;">&nbsp;e</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2957em;">&nbsp;p</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2947em;">&nbsp;l</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2957em;">&nbsp;i</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2947em;">&nbsp;c</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2957em;">&nbsp;a</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2957em;">&nbsp;t</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2947em;">&nbsp;i</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2957em;">&nbsp;o</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2947em;">&nbsp;n</span><span class="stl_58 stl_59 stl_998" style="word-spacing:0.4633em;">&nbsp;s</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2987em;">&nbsp;t</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2997em;">&nbsp;a</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2997em;">&nbsp;t</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.2987em;">&nbsp;e</span><span class="stl_58 stl_59 stl_998" style="word-spacing:-0.1527em;">&nbsp;.</span><span class="stl_58 stl_59 stl_998" style="word-spacing:0.3793em;">&nbsp;This &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:10.1692em;"><span class="stl_58 stl_59 stl_993" style="word-spacing:0.3976em;">function w</span><span class="stl_58 stl_59 stl_993" style="word-spacing:-0.3374em;">&nbsp;i</span><span class="stl_58 stl_59 stl_993" style="word-spacing:-0.3384em;">&nbsp;l</span><span class="stl_58 stl_59 stl_993" style="word-spacing:-0.3384em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 33.616em; left:9.5102em;"><span class="stl_58 stl_59 stl_1349" style="word-spacing:0.4562em;">also set server</span><span class="stl_58 stl_59 stl_1349" style="word-spacing:-0.1503em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1349" style="word-spacing:-0.1953em;">&nbsp;master</span><span class="stl_58 stl_59 stl_1349" style="word-spacing:0.3777em;">&nbsp;to</span><span class="stl_58 stl_59 stl_1349" style="word-spacing:0.2167em;">&nbsp;NULL.</span><span class="stl_58 stl_59 stl_1349" style="word-spacing:0.3707em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:8.005em;"><span class="stl_10 stl_11 stl_893" style="word-spacing:-0.222em;">replicationHandleMasterDisconnection () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.4282em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 38.4282em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">4.5 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">总结 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.671em; left:7.5658em;"><span class="stl_17 stl_18 stl_191" style="word-spacing:0.0835em;">简单来说，主从同步就是 </span><span class="stl_10 stl_11 stl_191" style="word-spacing:0.0835em;">RDB </span><span class="stl_17 stl_18 stl_191" style="word-spacing:0.0835em;">文件的上传下载；主机有小部分的数据修改，就 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.6676em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0836em;">把修改记录传播给每个从机。这篇文章详述了 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0836em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0836em;">主从复制的内部协议和机制。接 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.6635em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">下来的几篇关于 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">的文章，主要是其内部数据结构。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9339em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 15 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.7048em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1247em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1247em;">事务机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5199em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 20.5199em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">5.1 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1259em;">事务简述 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.7818em; left:7.5658em;"><span class="stl_10 stl_11 stl_857" style="word-spacing:0.0972em;">MULTI</span><span class="stl_17 stl_18 stl_857" style="word-spacing:0.0972em;">，</span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.0972em;">EXEC</span><span class="stl_17 stl_18 stl_857" style="word-spacing:0.0972em;">，</span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.0972em;">DISCARD</span><span class="stl_17 stl_18 stl_857" style="word-spacing:0.0972em;">，</span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.0972em;">WATCH </span><span class="stl_17 stl_18 stl_857" style="word-spacing:0.0972em;">四个命令是 </span><span class="stl_10 stl_11 stl_857" style="word-spacing:0.0972em;">redis </span><span class="stl_17 stl_18 stl_857" style="word-spacing:0.0972em;">事务的四个基础命令。 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.7776em; left:5.9058em;z-index:78; "><span class="stl_17 stl_18 stl_1350" style="word-spacing:0.1025em;">其中：</span><span class="stl_10 stl_11 stl_1350" style="word-spacing:0.1025em;">MULTI</span><span class="stl_17 stl_18 stl_1350" style="word-spacing:0.1025em;">，告诉 </span><span class="stl_10 stl_11 stl_1350" style="word-spacing:0.1025em;">redis </span><span class="stl_17 stl_18 stl_1350" style="word-spacing:0.1025em;">服务器开启一个事务。注意，只是开启，而不是执行 </span><span class="stl_10 stl_11 stl_1350" style="word-spacing:0.1025em;">EXEC</span><span class="stl_17 stl_18 stl_1350" style="word-spacing:0.1025em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 24.7743em; left:5.9058em;"><span class="stl_17 stl_18 stl_24" style="word-spacing:0.1066em;">告诉 </span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.1066em;">redis </span><span class="stl_17 stl_18 stl_24" style="word-spacing:0.1066em;">开始执行事务 </span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.1066em;">DISCARD</span><span class="stl_17 stl_18 stl_24" style="word-spacing:0.1066em;">，告诉 </span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.1066em;">redis </span><span class="stl_17 stl_18 stl_24" style="word-spacing:0.1066em;">取消事务 </span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.1066em;">WATCH</span><span class="stl_17 stl_18 stl_24" style="word-spacing:0.1066em;">，监视某一个键 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.9923em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">值对，它的作用是在事务执行之前如果监视的键值被修改，事务会被取消。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.7735em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">在介绍 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">事务之前，先来展开 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">命令队列的内部实现。 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.1516em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 30.1516em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">5.2 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1259em;">命令队列 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4135em; left:7.5658em;"><span class="stl_10 stl_11 stl_444" style="word-spacing:0.0944em;">redis </span><span class="stl_17 stl_18 stl_444" style="word-spacing:0.0944em;">允许一个客户端不间断执行多条命令：发送 </span><span class="stl_10 stl_11 stl_444" style="word-spacing:0.0944em;">MULTI </span><span class="stl_17 stl_18 stl_444" style="word-spacing:0.0944em;">后，用户键入多条命 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4093em; left:5.9058em;"><span class="stl_17 stl_18 stl_428" style="word-spacing:0.084em;">令；再发送 </span><span class="stl_10 stl_11 stl_428" style="word-spacing:0.084em;">EXEC </span><span class="stl_17 stl_18 stl_428" style="word-spacing:0.084em;">即可不间断执行之前输入的多条命令。因为，</span><span class="stl_10 stl_11 stl_428" style="word-spacing:0.084em;">redis </span><span class="stl_17 stl_18 stl_428" style="word-spacing:0.084em;">是单进程单线 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6282em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">的工作模式，因此多条命令的执行是不会被中断的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.9168em; left:5.8067em;"><span class="stl_10 stl_11 stl_07">&gt;</span></div>
					<div class="stl_01" style="top: 36.9168em; left:6.8495em;"><span class="stl_10 stl_11 stl_1351">MULTI &nbsp;</span></div>
					<div class="stl_01" style="top: 37.9135em; left:5.8067em;"><span class="stl_10 stl_11 stl_567">OK &nbsp;</span></div>
					<div class="stl_01" style="top: 38.9093em; left:5.8067em;"><span class="stl_10 stl_11 stl_07">&gt;</span></div>
					<div class="stl_01" style="top: 38.9093em; left:6.8735em;"><span class="stl_10 stl_11 stl_1352" style="word-spacing:0.3806em;">INCR foo &nbsp;</span></div>
					<div class="stl_01" style="top: 39.906em; left:5.81em;"><span class="stl_10 stl_11 stl_1353">QUEUED &nbsp;</span></div>
					<div class="stl_01" style="top: 40.9018em; left:5.8067em;"><span class="stl_10 stl_11 stl_07">&gt;</span></div>
					<div class="stl_01" style="top: 40.9018em; left:6.8735em;"><span class="stl_10 stl_11 stl_458" style="word-spacing:0.374em;">INCR bar &nbsp;</span></div>
					<div class="stl_01" style="top: 41.8985em; left:5.81em;"><span class="stl_10 stl_11 stl_1353">QUEUED &nbsp;</span></div>
					<div class="stl_01" style="top: 42.8943em; left:5.8067em;"><span class="stl_10 stl_11 stl_07">&gt;</span></div>
					<div class="stl_01" style="top: 43.891em; left:5.9917em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 44.8868em; left:5.9917em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 42.8943em; left:6.8295em;"><span class="stl_10 stl_11 stl_1354">EXEC &nbsp;</span></div>
					<div class="stl_01" style="top: 43.891em; left:6.4923em;"><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.0344em;">) ( i</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.3992em;">&nbsp;nteger</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.2942em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.2942em;">&nbsp;1 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.8868em; left:6.4923em;"><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.0344em;">) ( i</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.3992em;">&nbsp;nteger</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.2942em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.2942em;">&nbsp;1 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.5658em;z-index:414; "><span class="stl_17 stl_18 stl_1356" style="word-spacing:0.077em;">内部实现不难：</span><span class="stl_10 stl_11 stl_1356" style="word-spacing:0.077em;">redis </span><span class="stl_17 stl_18 stl_1356" style="word-spacing:0.077em;">服务器收到来自客户端的 </span><span class="stl_10 stl_11 stl_1356" style="word-spacing:0.077em;">MULTI </span><span class="stl_17 stl_18 stl_1356" style="word-spacing:0.077em;">命令后，为客户端保存一 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">个命令队列结构体，直到收到 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">EXEC </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">后才开始执行命令队列中的命令。 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">57 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">158 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 15.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">事务机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.9807em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">下面是命令队列的数据结构： &nbsp;</span></div>
					<div class="stl_01" style="top: 9.3368em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.3335em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.3368em; left:6.4282em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">命 令</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;结</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;构</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;体，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;命</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;令</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;队</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;列</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;专</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.3335em; left:6.4282em;"><span class="stl_58 stl_59 stl_544" style="word-spacing:0.5201em;">* Client</span><span class="stl_58 stl_59 stl_544" style="word-spacing:0.3986em;">&nbsp;MULTI/EXEC s</span><span class="stl_58 stl_59 stl_544" style="word-spacing:-0.1169em;">&nbsp;t</span><span class="stl_58 stl_59 stl_544" style="word-spacing:-0.1179em;">&nbsp;a</span><span class="stl_58 stl_59 stl_544" style="word-spacing:-0.1179em;">&nbsp;t</span><span class="stl_58 stl_59 stl_544" style="word-spacing:-0.1169em;">&nbsp;e</span><span class="stl_58 stl_59 stl_544" style="word-spacing:0.5411em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.3227em; left:5.9533em;"><span class="stl_15 stl_16 stl_1357" style="word-spacing:0.379em;">typedef struct</span><span class="stl_15 stl_16 stl_1357" style="word-spacing:0.3602em;">&nbsp;</span><span class="stl_10 stl_11 stl_1357" style="word-spacing:0.3602em;">multiCmd</span><span class="stl_10 stl_11 stl_1357" style="word-spacing:0.3602em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.326em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.326em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.3201em; left:8.005em;"><span class="stl_10 stl_11 stl_277" style="word-spacing:0.3327em;">robj **</span><span class="stl_10 stl_11 stl_277" style="word-spacing:-0.2993em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_277" style="word-spacing:-0.2993em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.3143em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.3143em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.3043em; left:7.98em;"><span class="stl_15 stl_16 stl_989">int</span><span class="stl_15 stl_16 stl_989" style="word-spacing:0.3479em;">&nbsp;</span><span class="stl_10 stl_11 stl_989" style="word-spacing:0.3479em;">argc</span><span class="stl_10 stl_11 stl_989" style="word-spacing:0.3479em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.3035em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.2993em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.3035em; left:8.4207em;"><span class="stl_58 stl_59 stl_581">/</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.0752em;">&nbsp;</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.0752em;">命 令</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;结</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;构</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;体，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;包</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;含</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;了</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;与</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;命</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;令</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;相</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;关</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;的</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;参</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.283em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;譬</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;如</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;命</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;令</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;执</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;行</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;函</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.2993em; left:8.4207em;"><span class="stl_58 stl_59 stl_707">/</span><span class="stl_58 stl_59 stl_707" style="word-spacing:0.3357em;">&nbsp;</span><span class="stl_17 stl_18 stl_707" style="word-spacing:0.3357em;">如</span><span class="stl_17 stl_18 stl_707" style="word-spacing:-0.2251em;">&nbsp;需</span><span class="stl_17 stl_18 stl_707" style="word-spacing:-0.2241em;">&nbsp;更</span><span class="stl_17 stl_18 stl_707" style="word-spacing:-0.2241em;">&nbsp;详</span><span class="stl_17 stl_18 stl_707" style="word-spacing:-0.2241em;">&nbsp;细</span><span class="stl_17 stl_18 stl_707" style="word-spacing:-0.2241em;">&nbsp;了</span><span class="stl_17 stl_18 stl_707" style="word-spacing:-0.1901em;">&nbsp;解，</span><span class="stl_17 stl_18 stl_707" style="word-spacing:-0.1911em;">&nbsp;参</span><span class="stl_17 stl_18 stl_707" style="word-spacing:-0.2241em;">&nbsp;看</span><span class="stl_17 stl_18 stl_707" style="word-spacing:0.4247em;">&nbsp;</span><span class="stl_58 stl_59 stl_707" style="word-spacing:0.4247em;">redis</span><span class="stl_58 stl_59 stl_707" style="word-spacing:-0.1281em;">&nbsp;.</span><span class="stl_58 stl_59 stl_707" style="word-spacing:-0.2081em;">&nbsp;c</span><span class="stl_58 stl_59 stl_707" style="word-spacing:0.3465em;">&nbsp;</span><span class="stl_17 stl_18 stl_707" style="word-spacing:0.3465em;">中</span><span class="stl_17 stl_18 stl_707" style="word-spacing:-0.2251em;">&nbsp;的</span><span class="stl_17 stl_18 stl_707" style="word-spacing:0.3459em;">&nbsp;</span><span class="stl_58 stl_59 stl_707" style="word-spacing:0.3459em;">redisCommandTable</span><span class="stl_58 stl_59 stl_707" style="word-spacing:0.345em;">&nbsp;</span><span class="stl_17 stl_18 stl_707" style="word-spacing:0.3459em;">全 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5165em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">局 参 数 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.2852em; left:7.9725em;"><span class="stl_15 stl_16 stl_1089">struct</span><span class="stl_15 stl_16 stl_1089" style="word-spacing:0.3828em;">&nbsp;</span><span class="stl_10 stl_11 stl_1089" style="word-spacing:0.3828em;">redisCommand</span><span class="stl_10 stl_11 stl_1089" style="word-spacing:0.3414em;">&nbsp;*cmd</span><span class="stl_10 stl_11 stl_1089" style="word-spacing:0.3414em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2868em; left:6.9338em;"><span class="stl_10 stl_11 stl_1202" style="word-spacing:-0.1291em;">multiCmd ; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2868em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.281em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.281em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;结</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;构</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;体 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.2702em; left:5.9533em;"><span class="stl_15 stl_16 stl_1358" style="word-spacing:0.305em;">typedef struct</span><span class="stl_15 stl_16 stl_1358" style="word-spacing:0.3736em;">&nbsp;</span><span class="stl_10 stl_11 stl_1358" style="word-spacing:0.3736em;">multiState</span><span class="stl_10 stl_11 stl_1358" style="word-spacing:0.3736em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.2735em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.2735em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.2685em; left:7.9308em;"><span class="stl_10 stl_11 stl_1293" style="word-spacing:0.3737em;">multiCmd *commands</span><span class="stl_10 stl_11 stl_1293" style="word-spacing:0.3737em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.2701em; left:19.9025em;"><span class="stl_58 stl_59 stl_318" style="word-spacing:0.431em;">/* Array</span><span class="stl_58 stl_59 stl_318" style="word-spacing:0.499em;">&nbsp;of</span><span class="stl_58 stl_59 stl_318" style="word-spacing:0.368em;">&nbsp;MULTI</span><span class="stl_58 stl_59 stl_318" style="word-spacing:0.262em;">&nbsp;commands</span><span class="stl_58 stl_59 stl_318" style="word-spacing:0.384em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.2626em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.2626em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.2518em; left:7.98em;"><span class="stl_15 stl_16 stl_471">int</span><span class="stl_15 stl_16 stl_471" style="word-spacing:0.3532em;">&nbsp;</span><span class="stl_10 stl_11 stl_471" style="word-spacing:0.3532em;">count</span><span class="stl_10 stl_11 stl_471" style="word-spacing:0.3532em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.2585em; left:19.9025em;"><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.4479em;">/* Total number of</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.3443em;">&nbsp;MULTI</span><span class="stl_58 stl_59 stl_1021" style="word-spacing:0.2383em;">&nbsp;commands &nbsp;</span></div>
					<div class="stl_01" style="top: 31.2551em; left:10.1058em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 31.2551em; left:10.5791em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.2476em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.2476em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">以 下</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;两</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;参</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;暂</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;没</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;到，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;和</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;复</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;制</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;有</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;关 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.2435em; left:19.9025em;"><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.2855em;">/* MINREPLICAS</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.3645em;">&nbsp;for</span><span class="stl_58 stl_59 stl_1040" style="word-spacing:0.5135em;">&nbsp;synchronous &nbsp;</span></div>
					<div class="stl_01" style="top: 34.2368em; left:7.98em;"><span class="stl_15 stl_16 stl_569">int</span><span class="stl_15 stl_16 stl_569" style="word-spacing:0.3244em;">&nbsp;</span><span class="stl_10 stl_11 stl_569" style="word-spacing:0.3244em;">minreplicas</span><span class="stl_10 stl_11 stl_569" style="word-spacing:0.3244em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.2401em; left:9.6942em;"><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.205em;">r e</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.205em;">&nbsp;p</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.204em;">&nbsp;l</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.205em;">&nbsp;i</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.204em;">&nbsp;c</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.205em;">&nbsp;a</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.205em;">&nbsp;t</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.204em;">&nbsp;i</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.205em;">&nbsp;o</span><span class="stl_58 stl_59 stl_71" style="word-spacing:-0.204em;">&nbsp;n</span><span class="stl_58 stl_59 stl_71" style="word-spacing:0.455em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.2343em; left:7.9592em;"><span class="stl_10 stl_11 stl_612" style="word-spacing:0.4012em;">time_t minreplicas_timeout</span><span class="stl_10 stl_11 stl_612" style="word-spacing:-0.1118em;">&nbsp;;</span><span class="stl_10 stl_11 stl_612" style="word-spacing:0.4323em;">&nbsp;</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.4323em;">/*</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.2262em;">&nbsp;MINREPLICAS</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.2782em;">&nbsp;timeout</span><span class="stl_58 stl_59 stl_612" style="word-spacing:0.4182em;">&nbsp;as &nbsp;</span></div>
					<div class="stl_01" style="top: 37.2326em; left:9.6517em;"><span class="stl_58 stl_59 stl_943" style="word-spacing:-0.2027em;">unixtime .</span><span class="stl_58 stl_59 stl_943" style="word-spacing:0.3442em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.2268em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.2268em; left:7.0061em;"><span class="stl_10 stl_11 stl_1359" style="word-spacing:-0.2154em;">multiState ; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.851em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">通由上面给出的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">客户端操作，来看看 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">服务器的状态变化： &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:5.8067em;"><span class="stl_10 stl_11 stl_07">&gt;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:6.8495em;"><span class="stl_10 stl_11 stl_1351">MULTI &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:5.8067em;"><span class="stl_10 stl_11 stl_567">OK &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:5.8067em;"><span class="stl_10 stl_11 stl_07">&gt;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:6.8735em;"><span class="stl_10 stl_11 stl_1352" style="word-spacing:0.3806em;">INCR foo &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.81em;"><span class="stl_10 stl_11 stl_1353">QUEUED &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.8067em;"><span class="stl_10 stl_11 stl_07">&gt;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:6.8735em;"><span class="stl_10 stl_11 stl_458" style="word-spacing:0.374em;">INCR bar &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.81em;"><span class="stl_10 stl_11 stl_1353">QUEUED &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">15.2. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">命令队列 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">159 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:5.8067em;"><span class="stl_10 stl_11 stl_07">&gt;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:5.9917em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 7.7118em; left:5.9917em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 5.7193em; left:6.8295em;"><span class="stl_10 stl_11 stl_1354">EXEC &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:6.4923em;"><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.0344em;">) ( integ</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.3992em;">&nbsp;er</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.2942em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.2942em;">&nbsp;1 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:6.4923em;"><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.0344em;">) ( integ</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.3992em;">&nbsp;er</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.2942em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1355" style="word-spacing:-0.2942em;">&nbsp;1 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_35.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_35.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">160 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 15.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">事务机制 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">15.3. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">键值的监视 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">161 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.5658em;"><span class="stl_10 stl_11 stl_716" style="word-spacing:0.0808em;">processCommand() </span><span class="stl_17 stl_18 stl_716" style="word-spacing:0.0808em;">函数中的一段代码可以窥探命令入队的操作： &nbsp;</span></div>
					<div class="stl_01" style="top: 8.5535em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.5535em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.5435em; left:5.9875em;"><span class="stl_15 stl_16 stl_193">int</span><span class="stl_15 stl_16 stl_193" style="word-spacing:0.3761em;">&nbsp;</span><span class="stl_10 stl_11 stl_193" style="word-spacing:0.3761em;">processCommand</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2166em;">&nbsp;(</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.1136em;">&nbsp;r</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;e</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2196em;">&nbsp;d</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;i</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;s</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;C</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2196em;">&nbsp;l</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;i</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;e</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2186em;">&nbsp;n</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.2196em;">&nbsp;t</span><span class="stl_10 stl_11 stl_193" style="word-spacing:0.4314em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.1906em;">&nbsp;)</span><span class="stl_10 stl_11 stl_193" style="word-spacing:-0.1906em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.5443em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 10.5443em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 12.5385em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.5351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.5385em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">加</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;情</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;况 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.5351em; left:8.4207em;"><span class="stl_58 stl_59 stl_210" style="word-spacing:0.3907em;">* Exec</span><span class="stl_58 stl_59 stl_210" style="word-spacing:0.4557em;">&nbsp;the</span><span class="stl_58 stl_59 stl_210" style="word-spacing:0.3887em;">&nbsp;command</span><span class="stl_58 stl_59 stl_210" style="word-spacing:0.3237em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.5243em; left:8.045em;z-index:128; "><span class="stl_15 stl_16 stl_207" style="word-spacing:0.0284em;">i f</span><span class="stl_15 stl_16 stl_207" style="word-spacing:0.7348em;">&nbsp;</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.7348em;">(</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.7348em;">&nbsp;c</span><span class="stl_107 stl_108 stl_207" style="word-spacing:0.7348em;">−</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.0094em;">&gt;f</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.0229em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.5334em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.3114em;">&nbsp;REDIS_MULTI</span><span class="stl_10 stl_11 stl_207" style="word-spacing:0.2814em;">&nbsp;&amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.526em; left:9.9342em;z-index:182; "><span class="stl_10 stl_11 stl_208" style="word-spacing:0.5165em;">c</span><span class="stl_107 stl_108 stl_208" style="word-spacing:0.5165em;">−</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.5165em;">&gt;cmd</span><span class="stl_107 stl_108 stl_208" style="word-spacing:0.5165em;">−</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.5165em;">&gt;proc !=</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.4345em;">&nbsp;execCommand</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.2675em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.2675em;">&nbsp;c</span><span class="stl_107 stl_108 stl_208" style="word-spacing:0.2675em;">−</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.2985em;">&gt;cmd</span><span class="stl_107 stl_108 stl_208" style="word-spacing:0.2985em;">−</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.2985em;">&gt;proc</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.5165em;">&nbsp;!= &nbsp;</span></div>
					<div class="stl_01" style="top: 16.5226em; left:11.5942em;"><span class="stl_10 stl_11 stl_209" style="word-spacing:0.2033em;">discardCommand &amp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.5185em; left:9.9342em;z-index:240; "><span class="stl_10 stl_11 stl_211" style="word-spacing:0.5099em;">c</span><span class="stl_107 stl_108 stl_211" style="word-spacing:0.5099em;">−</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.5099em;">&gt;cmd</span><span class="stl_107 stl_108 stl_211" style="word-spacing:0.5099em;">−</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.5099em;">&gt;proc !=</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.4359em;">&nbsp;multiCommand</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.2804em;">&nbsp;&amp;&amp; c</span><span class="stl_107 stl_108 stl_211" style="word-spacing:0.2804em;">−</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.2804em;">&gt;cmd</span><span class="stl_107 stl_108 stl_211" style="word-spacing:0.2804em;">−</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.2804em;">&gt;proc</span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.5089em;">&nbsp;!= &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5151em; left:11.5567em;"><span class="stl_10 stl_11 stl_212">watchCommand) &nbsp;</span></div>
					<div class="stl_01" style="top: 19.511em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 20.5093em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.5093em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.5035em; left:9.925em;"><span class="stl_10 stl_11 stl_213" style="word-spacing:-0.1352em;">queueMultiCommand( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.5001em; left:9.95em;"><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1887em;">addReply ( c , shared . queued ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.4943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.4901em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.4943em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">真 正</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;执</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;行</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;命</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;令。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.4901em; left:8.4207em;"><span class="stl_58 stl_59 stl_216">/</span><span class="stl_58 stl_59 stl_216" style="word-spacing:-0.0415em;">&nbsp;</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.0415em;">注 意，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2837em;">&nbsp;如</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;果</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;是</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;设</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;置</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;了</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;多</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;命</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;令</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;模</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2827em;">&nbsp;式，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2837em;">&nbsp;那</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;么</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;不</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;是</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;直</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;接</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;执</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;行</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;命</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2827em;">&nbsp;令，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2827em;">&nbsp;而 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.7073em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">是 让 命 令 入 队 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.481em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 27.476em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4777em; left:10.04em;"><span class="stl_10 stl_11 stl_218" style="word-spacing:0.0184em;">c a l l</span><span class="stl_10 stl_11 stl_218" style="word-spacing:0.1234em;">&nbsp;(</span><span class="stl_10 stl_11 stl_218" style="word-spacing:-0.0036em;">&nbsp;c</span><span class="stl_10 stl_11 stl_218" style="word-spacing:0.1044em;">&nbsp;,REDIS_CALL_FULL)</span><span class="stl_10 stl_11 stl_218" style="word-spacing:0.1044em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4685em; left:10.0375em;"><span class="stl_15 stl_16 stl_219" style="word-spacing:-0.3163em;">i f</span><span class="stl_15 stl_16 stl_219" style="word-spacing:0.39em;">&nbsp;</span><span class="stl_10 stl_11 stl_219" style="word-spacing:0.39em;">(</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.2423em;">&nbsp;listLength</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.2423em;">&nbsp;(</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.2433em;">&nbsp;server</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.1883em;">&nbsp;.</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.2463em;">&nbsp;ready_keys</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3013em;">&nbsp;)</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3013em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4702em; left:11.9833em;"><span class="stl_10 stl_11 stl_220" style="word-spacing:-0.2106em;">handleClientsBlockedOnLists () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.466em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 32.4577em; left:7.9458em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4585em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.5307em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 37.5307em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">5.3 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">键值的监视 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.3148em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">稍后再展开事务执行和取消的部分。 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.256em; left:7.5658em;"><span class="stl_10 stl_11 stl_575" style="word-spacing:0.1373em;">redis </span><span class="stl_17 stl_18 stl_575" style="word-spacing:0.1373em;">的官方文档上说，</span><span class="stl_10 stl_11 stl_575" style="word-spacing:0.1373em;">WATCH </span><span class="stl_17 stl_18 stl_575" style="word-spacing:0.1373em;">命令是为了让 </span><span class="stl_10 stl_11 stl_575" style="word-spacing:0.1373em;">redis </span><span class="stl_17 stl_18 stl_575" style="word-spacing:0.1373em;">拥有 </span><span class="stl_10 stl_11 stl_575" style="word-spacing:0.1373em;">check-and-set(CAS) &nbsp;</span></div>
					<div class="stl_01" style="top: 43.2526em; left:5.9058em;"><span class="stl_17 stl_18 stl_1360" style="word-spacing:0.0854em;">的特性。</span><span class="stl_10 stl_11 stl_1360" style="word-spacing:0.0854em;">CAS </span><span class="stl_17 stl_18 stl_1360" style="word-spacing:0.0854em;">的意思是，一个客户端在修改某个值之前，要检测它是否更改；如果没 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4707em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">有更改，修改操作才能成功。 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">一个不含 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">CAS </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">特性的例子： &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_36.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_36.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">162 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 15.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">事务机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.8851em; left:23.0442em;"><span class="stl_10 stl_11 stl_994" style="word-spacing:0.0928em;">client B &nbsp;</span></div>
					<div class="stl_01" style="top: 8.2951em; left:20.8992em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">get score(score=10) &nbsp;</span></div>
					<div class="stl_01" style="top: 5.8851em; left:12.7075em;"><span class="stl_10 stl_11 stl_994" style="word-spacing:0.0928em;">client A &nbsp;</span></div>
					<div class="stl_01" style="top: 7.2985em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 8.2951em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 9.291em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 10.2877em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 11.2843em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 12.2801em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 7.2985em; left:10.579em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">get score(score=10) &nbsp;</span></div>
					<div class="stl_01" style="top: 9.291em; left:9.4748em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.95em;">temp=score+1(temp=11) temp=score+1(temp=11) &nbsp;</span></div>
					<div class="stl_01" style="top: 10.2877em; left:19.8825em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">set score temp(score=11) &nbsp;</span></div>
					<div class="stl_01" style="top: 11.2843em; left:9.5628em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">set score temp(score=11) &nbsp;</span></div>
					<div class="stl_01" style="top: 12.2801em; left:11.4125em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.193em;">ﬁnal: score=11 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.2801em; left:21.7317em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.194em;">ﬁnal: score=11 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.3218em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">含有 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0832em;">CAS </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">特性的例子： &nbsp;</span></div>
					<div class="stl_01" style="top: 23.856em; left:14.4075em;"><span class="stl_10 stl_11 stl_994" style="word-spacing:0.0928em;">client A &nbsp;</span></div>
					<div class="stl_01" style="top: 23.856em; left:26.445em;"><span class="stl_10 stl_11 stl_994" style="word-spacing:0.0928em;">client B &nbsp;</span></div>
					<div class="stl_01" style="top: 25.2693em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">0</span></div>
					<div class="stl_01" style="top: 26.2651em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 27.2618em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 28.2585em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 29.2543em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 30.251em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 31.2468em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">6</span></div>
					<div class="stl_01" style="top: 32.2435em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">7</span></div>
					<div class="stl_01" style="top: 33.2393em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">8</span></div>
					<div class="stl_01" style="top: 34.236em; left:8.0642em;"><span class="stl_10 stl_11 stl_07">9</span></div>
					<div class="stl_01" style="top: 25.2693em; left:12.28em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.082em;">get score(score=10) &nbsp;</span></div>
					<div class="stl_01" style="top: 26.2651em; left:24.3em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.082em;">get score(score=10) &nbsp;</span></div>
					<div class="stl_01" style="top: 27.2618em; left:23.1958em;"><span class="stl_10 stl_11 stl_07">temp=score+1(temp=11) &nbsp;</span></div>
					<div class="stl_01" style="top: 28.2585em; left:23.2833em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">set score temp(score=11) &nbsp;</span></div>
					<div class="stl_01" style="top: 27.2618em; left:11.1758em;"><span class="stl_10 stl_11 stl_07">temp=score+1(temp=11) &nbsp;</span></div>
					<div class="stl_01" style="top: 28.2585em; left:9.6775em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">（服务器标记 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">score </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">已经被修改） &nbsp;</span></div>
					<div class="stl_01" style="top: 29.2543em; left:9.4748em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">set score temp(score=11) (failed!!!) &nbsp;</span></div>
					<div class="stl_01" style="top: 30.251em; left:13.1125em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.194em;">ﬁnal: score=11 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.251em; left:25.1325em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.194em;">ﬁnal: score=11 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.2468em; left:12.28em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.082em;">get score(score=11) &nbsp;</span></div>
					<div class="stl_01" style="top: 32.2435em; left:11.1758em;"><span class="stl_10 stl_11 stl_07">temp=score+1(temp=12) &nbsp;</span></div>
					<div class="stl_01" style="top: 33.2393em; left:11.2633em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">set score temp(score=12) &nbsp;</span></div>
					<div class="stl_01" style="top: 34.236em; left:13.1125em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.194em;">ﬁnal: score=12 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.9693em; left:7.5658em;z-index:489; "><span class="stl_17 stl_18 stl_78" style="word-spacing:0.0581em;">在后一个例子中，</span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.0581em;">client A </span><span class="stl_17 stl_18 stl_78" style="word-spacing:0.0581em;">第一次尝试修改失败，因为 </span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.0581em;">client B </span><span class="stl_17 stl_18 stl_78" style="word-spacing:0.0581em;">修改了 </span><span class="stl_10 stl_11 stl_78" style="word-spacing:0.0581em;">score.client &nbsp;</span></div>
					<div class="stl_01" style="top: 39.966em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">A </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">失败过后，再次尝试修改才成功。</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">事务的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">CAS </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">特性借助了键值的监视。 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:7.5658em;"><span class="stl_10 stl_11 stl_1130" style="word-spacing:0.0848em;">redis </span><span class="stl_17 stl_18 stl_1130" style="word-spacing:0.0848em;">数据集结构体 </span><span class="stl_10 stl_11 stl_1130" style="word-spacing:0.0848em;">redisDB </span><span class="stl_17 stl_18 stl_1130" style="word-spacing:0.0848em;">和客户端结构体 </span><span class="stl_10 stl_11 stl_1130" style="word-spacing:0.0848em;">redisClient </span><span class="stl_17 stl_18 stl_1130" style="word-spacing:0.0848em;">都会保存键值监视的相 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">关数据。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_38.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_38.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">15.3. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">键值的监视 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">163 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.1115em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">监视键值的过程： &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:6.4282em;z-index:29; "><span class="stl_58 stl_59 stl_1361" style="word-spacing:0.561em;">/ WATCH</span><span class="stl_58 stl_59 stl_1361" style="word-spacing:0.6011em;">&nbsp;</span><span class="stl_17 stl_18 stl_1361" style="word-spacing:0.6011em;">命</span><span class="stl_17 stl_18 stl_1361" style="word-spacing:0.255em;">&nbsp;令 执 行 函</span><span class="stl_17 stl_18 stl_1361" style="word-spacing:0.255em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:5.9483em;"><span class="stl_15 stl_16 stl_900">void</span><span class="stl_15 stl_16 stl_900" style="word-spacing:0.3499em;">&nbsp;</span><span class="stl_10 stl_11 stl_900" style="word-spacing:0.3499em;">watchCommand(</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.048em;">&nbsp;r</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.153em;">&nbsp;e</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.154em;">&nbsp;d</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.153em;">&nbsp;i</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.153em;">&nbsp;s</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.153em;">&nbsp;C</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.154em;">&nbsp;l</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.153em;">&nbsp;i</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.153em;">&nbsp;e</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.153em;">&nbsp;n</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.154em;">&nbsp;t</span><span class="stl_10 stl_11 stl_900" style="word-spacing:0.497em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.125em;">&nbsp;)</span><span class="stl_10 stl_11 stl_900" style="word-spacing:-0.125em;">&nbsp;{ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">164 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 15.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">事务机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.3991em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">j</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4207em;z-index:34; "><span class="stl_58 stl_59 stl_1362" style="word-spacing:0.4567em;">/ WATCH</span><span class="stl_58 stl_59 stl_1362" style="word-spacing:0.4969em;">&nbsp;</span><span class="stl_17 stl_18 stl_1362" style="word-spacing:0.4969em;">命</span><span class="stl_17 stl_18 stl_1362" style="word-spacing:0.1507em;">&nbsp;令 不 能 在</span><span class="stl_17 stl_18 stl_1362" style="word-spacing:0.5896em;">&nbsp;</span><span class="stl_58 stl_59 stl_1362" style="word-spacing:0.5896em;">MULTI</span><span class="stl_58 stl_59 stl_1362" style="word-spacing:0.5886em;">&nbsp;</span><span class="stl_17 stl_18 stl_1362" style="word-spacing:0.5886em;">和</span><span class="stl_17 stl_18 stl_1362" style="word-spacing:0.5677em;">&nbsp;</span><span class="stl_58 stl_59 stl_1362" style="word-spacing:0.5677em;">EXEC</span><span class="stl_58 stl_59 stl_1362" style="word-spacing:0.5665em;">&nbsp;</span><span class="stl_17 stl_18 stl_1362" style="word-spacing:0.5665em;">之</span><span class="stl_17 stl_18 stl_1362" style="word-spacing:0.1507em;">&nbsp;间 调</span><span class="stl_17 stl_18 stl_1362" style="word-spacing:0.1507em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7027em; left:8.045em;z-index:58; "><span class="stl_15 stl_16 stl_1164" style="word-spacing:0.004em;">i f</span><span class="stl_15 stl_16 stl_1164" style="word-spacing:0.7104em;">&nbsp;</span><span class="stl_10 stl_11 stl_1164" style="word-spacing:0.7104em;">(</span><span class="stl_10 stl_11 stl_1164" style="word-spacing:0.7104em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1164" style="word-spacing:0.7104em;">−</span><span class="stl_10 stl_11 stl_1164" style="word-spacing:-0.015em;">&gt;f</span><span class="stl_10 stl_11 stl_1164" style="word-spacing:-0.001em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1164" style="word-spacing:-0.002em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1164" style="word-spacing:-0.002em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1164" style="word-spacing:-0.001em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1164" style="word-spacing:0.509em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1164" style="word-spacing:0.287em;">&nbsp;REDIS_MULTI)</span><span class="stl_10 stl_11 stl_1164" style="word-spacing:0.287em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:9.9667em;"><span class="stl_10 stl_11 stl_1363" style="word-spacing:-0.1246em;">addReplyError ( c , ”WATCH␣ i n s i d e ␣MULTI␣ i s ␣not␣ allowed ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:9.9383em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">监</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;视</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;所</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;给</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;出</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;键 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:7.9808em;z-index:160; "><span class="stl_15 stl_16 stl_1042">for</span><span class="stl_15 stl_16 stl_1042" style="word-spacing:0.4593em;">&nbsp;</span><span class="stl_10 stl_11 stl_1042" style="word-spacing:0.4593em;">(</span><span class="stl_10 stl_11 stl_1042" style="word-spacing:-0.0946em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1042" style="word-spacing:0.3084em;">&nbsp;= 1;</span><span class="stl_10 stl_11 stl_1042" style="word-spacing:0.5414em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1042" style="word-spacing:0.2814em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_1042" style="word-spacing:0.2814em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1042" style="word-spacing:0.2814em;">−</span><span class="stl_10 stl_11 stl_1042" style="word-spacing:0.2464em;">&gt;argc</span><span class="stl_10 stl_11 stl_1042" style="word-spacing:-0.0726em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1042" style="word-spacing:0.5614em;">&nbsp;j++) &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:9.9383em;z-index:186; "><span class="stl_10 stl_11 stl_1364" style="word-spacing:-0.0939em;">watchForKey ( c , c</span><span class="stl_107 stl_108 stl_1364" style="word-spacing:-0.0939em;">−</span><span class="stl_10 stl_11 stl_1364" style="word-spacing:-0.0939em;">&gt;argv [ j ] ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:7.9575em;"><span class="stl_10 stl_11 stl_173" style="word-spacing:-0.1964em;">addReply ( c , shared . ok ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 19.6685em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">监</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;视</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;键</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;值</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:6.4282em;"><span class="stl_58 stl_59 stl_1365" style="word-spacing:0.2744em;">* Watch</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:0.3554em;">&nbsp;for</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:0.4619em;">&nbsp;the s</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:-0.2486em;">&nbsp;p</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:-0.2496em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:-0.2486em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:-0.2486em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:-0.2486em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:-0.2486em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:-0.2496em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:-0.2486em;">&nbsp;d</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:0.4504em;">&nbsp;key</span><span class="stl_58 stl_59 stl_1365" style="word-spacing:0.3414em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:5.9483em;"><span class="stl_15 stl_16 stl_468">void</span><span class="stl_15 stl_16 stl_468" style="word-spacing:0.3102em;">&nbsp;</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.3102em;">watchForKey</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2369em;">&nbsp;(</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.1379em;">&nbsp;r</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2449em;">&nbsp;e</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2439em;">&nbsp;d</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2439em;">&nbsp;i</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2439em;">&nbsp;s</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2449em;">&nbsp;C</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2439em;">&nbsp;l</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2439em;">&nbsp;i</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2439em;">&nbsp;e</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2449em;">&nbsp;n</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2439em;">&nbsp;t</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.4061em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.1349em;">&nbsp;,</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.4901em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_468" style="word-spacing:0.3791em;">&nbsp;*key</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2199em;">&nbsp;)</span><span class="stl_10 stl_11 stl_468" style="word-spacing:-0.2199em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:8.0742em;"><span class="stl_10 stl_11 stl_1366" style="word-spacing:0.021em;">l i s t</span><span class="stl_10 stl_11 stl_1366" style="word-spacing:0.671em;">&nbsp;*</span><span class="stl_10 stl_11 stl_1366" style="word-spacing:0.037em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1366" style="word-spacing:-0.014em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1366" style="word-spacing:-0.014em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1366" style="word-spacing:-0.014em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1366" style="word-spacing:-0.014em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1366" style="word-spacing:-0.014em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1366" style="word-spacing:-0.014em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1366" style="word-spacing:0.497em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1366" style="word-spacing:0.25em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:8.0708em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">l i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;I</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;r</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.773em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:8.01em;"><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">listNode * ln</span><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9467em;"><span class="stl_10 stl_11 stl_493" style="word-spacing:0.3442em;">watchedKey *wk; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6385em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">是</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;否</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;已</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;经</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;监</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;视</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;该</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;键</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_805" style="word-spacing:0.2673em;">* Check</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.4033em;">&nbsp;i</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.2607em;">&nbsp;f</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3633em;">&nbsp;we</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.2703em;">&nbsp;are</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3839em;">&nbsp;already watching for</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.4513em;">&nbsp;t</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.2877em;">&nbsp;h</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.2887em;">&nbsp;i</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.2887em;">&nbsp;s</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.4103em;">&nbsp;key</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3013em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:8.0017em;z-index:414; "><span class="stl_10 stl_11 stl_1367" style="word-spacing:-0.1603em;">listRewind ( c</span><span class="stl_107 stl_108 stl_1367" style="word-spacing:-0.1603em;">−</span><span class="stl_10 stl_11 stl_1367" style="word-spacing:-0.1603em;">&gt;watched_keys ,&amp; l i ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:7.9483em;"><span class="stl_15 stl_16 stl_759">while</span><span class="stl_15 stl_16 stl_759" style="word-spacing:-0.2586em;">&nbsp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.2586em;">((</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.199em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_759" style="word-spacing:0.173em;">&nbsp;=</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.111em;">&nbsp;listN e</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.311em;">&nbsp;xt</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.3em;">&nbsp;(&amp;</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.236em;">&nbsp;l</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.246em;">&nbsp;i</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.141em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;)</span><span class="stl_10 stl_11 stl_759" style="word-spacing:-0.25em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:9.8767em;"><span class="stl_10 stl_11 stl_826" style="word-spacing:0.0219em;">wk =</span><span class="stl_10 stl_11 stl_826" style="word-spacing:-0.0843em;">&nbsp;listNodeValue (</span><span class="stl_10 stl_11 stl_826" style="word-spacing:-0.2441em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_826" style="word-spacing:-0.2431em;">&nbsp;)</span><span class="stl_10 stl_11 stl_826" style="word-spacing:-0.2431em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6135em; left:10.0375em;z-index:524; "><span class="stl_15 stl_16 stl_1368" style="word-spacing:-0.1567em;">i f</span><span class="stl_15 stl_16 stl_1368" style="word-spacing:0.5497em;">&nbsp;</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:0.5497em;">(wk</span><span class="stl_107 stl_108 stl_1368" style="word-spacing:0.5497em;">−</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:0.5497em;">&gt;db</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:0.1773em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:0.1773em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1368" style="word-spacing:0.1773em;">−</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:0.1993em;">&gt;db</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:0.1783em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:0.2803em;">&nbsp;equalStringObjects</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:-0.0957em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:-0.1667em;">&nbsp;key</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:-0.0517em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:-0.1837em;">&nbsp;wk</span><span class="stl_107 stl_108 stl_1368" style="word-spacing:-0.1837em;">−</span><span class="stl_10 stl_11 stl_1368" style="word-spacing:-0.1837em;">&gt;key &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:11.6383em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 33.6143em; left:12.1365em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 34.606em; left:11.9308em;"><span class="stl_15 stl_16 stl_257">return</span><span class="stl_15 stl_16 stl_257" style="word-spacing:-0.2019em;">&nbsp;</span><span class="stl_10 stl_11 stl_257" style="word-spacing:-0.2019em;">;</span><span class="stl_10 stl_11 stl_257" style="word-spacing:0.3995em;">&nbsp;</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.3995em;">/*</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.2594em;">&nbsp;Key</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.3314em;">&nbsp;already</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.4034em;">&nbsp;watched</span><span class="stl_58 stl_59 stl_257" style="word-spacing:0.3334em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.601em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.5976em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">获</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;监</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;视</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;该</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;键</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;值</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;客</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;户</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;端</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;链</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5976em; left:8.4207em;"><span class="stl_58 stl_59 stl_363" style="word-spacing:0.3136em;">* This</span><span class="stl_58 stl_59 stl_363" style="word-spacing:0.3536em;">&nbsp;key</span><span class="stl_58 stl_59 stl_363" style="word-spacing:0.4226em;">&nbsp;i</span><span class="stl_58 stl_59 stl_363" style="word-spacing:-0.2744em;">&nbsp;s</span><span class="stl_58 stl_59 stl_363" style="word-spacing:0.4013em;">&nbsp;not already watched</span><span class="stl_58 stl_59 stl_363" style="word-spacing:0.3686em;">&nbsp;in</span><span class="stl_58 stl_59 stl_363" style="word-spacing:0.4416em;">&nbsp;t</span><span class="stl_58 stl_59 stl_363" style="word-spacing:-0.2674em;">&nbsp;h</span><span class="stl_58 stl_59 stl_363" style="word-spacing:-0.2684em;">&nbsp;i</span><span class="stl_58 stl_59 stl_363" style="word-spacing:-0.2684em;">&nbsp;s</span><span class="stl_58 stl_59 stl_363" style="word-spacing:0.2456em;">&nbsp;DB.</span><span class="stl_58 stl_59 stl_363" style="word-spacing:0.4056em;">&nbsp;Let</span><span class="stl_58 stl_59 stl_363" style="word-spacing:-0.1454em;">&nbsp;’</span><span class="stl_58 stl_59 stl_363" style="word-spacing:-0.2434em;">&nbsp;s</span><span class="stl_58 stl_59 stl_363" style="word-spacing:0.3256em;">&nbsp;add &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.7142em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.184em;">i t</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.476em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:8.045em;z-index:652; "><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.19em;">c l</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.19em;">&nbsp;i</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.19em;">&nbsp;e</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.19em;">&nbsp;n</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.19em;">&nbsp;t</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.19em;">&nbsp;s</span><span class="stl_10 stl_11 stl_235" style="word-spacing:0.322em;">&nbsp;=</span><span class="stl_10 stl_11 stl_235" style="word-spacing:0.258em;">&nbsp;dictFetchValue</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.147em;">&nbsp;(</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.147em;">&nbsp;c</span><span class="stl_107 stl_108 stl_235" style="word-spacing:-0.147em;">−</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.209em;">&gt;db</span><span class="stl_107 stl_108 stl_235" style="word-spacing:-0.209em;">−</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.209em;">&gt;watched_keys</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.071em;">&nbsp;,</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.131em;">&nbsp;key</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.186em;">&nbsp;)</span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.186em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.576em; left:8.045em;"><span class="stl_15 stl_16 stl_07" style="word-spacing:-0.074em;">i f</span><span class="stl_15 stl_16 stl_07" style="word-spacing:0.7047em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.7047em;">(</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;!</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.105em;">&nbsp;c</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;n</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.072em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.032em;">&nbsp;)</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.032em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:8.4207em;z-index:687; "><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">如 果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;不</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;在</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;链</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;表，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;需</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;要</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;建</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:10.0375em;"><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.355em;">c l</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.355em;">&nbsp;i</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.355em;">&nbsp;e</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.355em;">&nbsp;n</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.355em;">&nbsp;t</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.355em;">&nbsp;s</span><span class="stl_10 stl_11 stl_62" style="word-spacing:0.157em;">&nbsp;=</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.232em;">&nbsp;l i</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.371em;">&nbsp;s</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.371em;">&nbsp;t</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.371em;">&nbsp;C</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.371em;">&nbsp;r</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.371em;">&nbsp;e</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.371em;">&nbsp;a</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.371em;">&nbsp;t</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.371em;">&nbsp;e</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.231em;">&nbsp;()</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.231em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:9.96em;z-index:735; "><span class="stl_10 stl_11 stl_1369" style="word-spacing:-0.0993em;">dictAdd ( c</span><span class="stl_107 stl_108 stl_1369" style="word-spacing:-0.0993em;">−</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:-0.0993em;">&gt;db</span><span class="stl_107 stl_108 stl_1369" style="word-spacing:-0.0993em;">−</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:-0.0993em;">&gt;watched_keys , key , c l i e n t s ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5702em; left:9.975em;"><span class="stl_10 stl_11 stl_141" style="word-spacing:-0.2362em;">incrRefCount ( key ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">15.3. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">键值的监视 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">165 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">尾 插</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;法。</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;将</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;客</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;户</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;端</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;添</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;加</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;到</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;链</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;表</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;尾</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;部 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:7.99em;"><span class="stl_10 stl_11 stl_826" style="word-spacing:-0.2555em;">listAddNodeTail ( c l i e n t s , c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4207em;"><span class="stl_58 stl_59 stl_459">/</span><span class="stl_58 stl_59 stl_459" style="word-spacing:0.3262em;">&nbsp;</span><span class="stl_17 stl_18 stl_459" style="word-spacing:0.3262em;">将</span><span class="stl_17 stl_18 stl_459" style="word-spacing:-0.2346em;">&nbsp;监</span><span class="stl_17 stl_18 stl_459" style="word-spacing:-0.2336em;">&nbsp;视</span><span class="stl_17 stl_18 stl_459" style="word-spacing:-0.2336em;">&nbsp;键</span><span class="stl_17 stl_18 stl_459" style="word-spacing:-0.2336em;">&nbsp;添</span><span class="stl_17 stl_18 stl_459" style="word-spacing:-0.2336em;">&nbsp;加</span><span class="stl_17 stl_18 stl_459" style="word-spacing:-0.2336em;">&nbsp;到</span><span class="stl_17 stl_18 stl_459" style="word-spacing:0.4219em;">&nbsp;</span><span class="stl_58 stl_59 stl_459" style="word-spacing:0.4219em;">r</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.2796em;">&nbsp;e</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.2786em;">&nbsp;d</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.2786em;">&nbsp;i</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.2786em;">&nbsp;s</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.2796em;">&nbsp;C</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.2786em;">&nbsp;l</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.2786em;">&nbsp;i</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.2786em;">&nbsp;e</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.2786em;">&nbsp;n</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.2786em;">&nbsp;t</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.1326em;">&nbsp;.</span><span class="stl_58 stl_59 stl_459" style="word-spacing:-0.1956em;">&nbsp;watched_keys</span><span class="stl_58 stl_59 stl_459" style="word-spacing:0.3577em;">&nbsp;</span><span class="stl_17 stl_18 stl_459" style="word-spacing:0.3577em;">的</span><span class="stl_17 stl_18 stl_459" style="word-spacing:-0.2336em;">&nbsp;尾</span><span class="stl_17 stl_18 stl_459" style="word-spacing:-0.2336em;">&nbsp;部 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4207em;"><span class="stl_58 stl_59 stl_368" style="word-spacing:0.2349em;">* Add</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.3046em;">&nbsp;the new key</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.3969em;">&nbsp;to the</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.5099em;">&nbsp;l</span><span class="stl_58 stl_59 stl_368" style="word-spacing:-0.2131em;">&nbsp;i</span><span class="stl_58 stl_59 stl_368" style="word-spacing:-0.2141em;">&nbsp;s</span><span class="stl_58 stl_59 stl_368" style="word-spacing:-0.2141em;">&nbsp;t</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.5139em;">&nbsp;of</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.3944em;">&nbsp;keys watched</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.3459em;">&nbsp;by</span><span class="stl_58 stl_59 stl_368" style="word-spacing:0.4199em;">&nbsp;t</span><span class="stl_58 stl_59 stl_368" style="word-spacing:-0.2651em;">&nbsp;h</span><span class="stl_58 stl_59 stl_368" style="word-spacing:-0.2651em;">&nbsp;i</span><span class="stl_58 stl_59 stl_368" style="word-spacing:-0.2651em;">&nbsp;s &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:9.7033em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.196em;">c l</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.195em;">&nbsp;i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.195em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.195em;">&nbsp;n</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.196em;">&nbsp;t</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.464em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:7.8842em;"><span class="stl_10 stl_11 stl_1346" style="word-spacing:0.0486em;">wk =</span><span class="stl_10 stl_11 stl_1346" style="word-spacing:-0.0407em;">&nbsp;zmalloc (</span><span class="stl_10 stl_11 stl_1346" style="word-spacing:-0.216em;">&nbsp;</span><span class="stl_15 stl_16 stl_1346" style="word-spacing:-0.216em;">sizeof</span><span class="stl_15 stl_16 stl_1346" style="word-spacing:-0.2171em;">&nbsp;</span><span class="stl_10 stl_11 stl_1346" style="word-spacing:-0.2171em;">(*wk)</span><span class="stl_10 stl_11 stl_1346" style="word-spacing:-0.2334em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1346" style="word-spacing:-0.2334em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:7.8875em;z-index:170; "><span class="stl_10 stl_11 stl_906" style="word-spacing:0.3404em;">wk</span><span class="stl_107 stl_108 stl_906" style="word-spacing:0.3404em;">−</span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.3404em;">&gt;key = key</span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.3404em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:7.8875em;z-index:188; "><span class="stl_10 stl_11 stl_1370" style="word-spacing:0.4191em;">wk</span><span class="stl_107 stl_108 stl_1370" style="word-spacing:0.4191em;">−</span><span class="stl_10 stl_11 stl_1370" style="word-spacing:0.4191em;">&gt;db = c</span><span class="stl_107 stl_108 stl_1370" style="word-spacing:0.4191em;">−</span><span class="stl_10 stl_11 stl_1370" style="word-spacing:0.4191em;">&gt;db</span><span class="stl_10 stl_11 stl_1370" style="word-spacing:0.4191em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:7.9825em;"><span class="stl_10 stl_11 stl_141" style="word-spacing:-0.2362em;">incrRefCount ( key ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:7.99em;z-index:228; "><span class="stl_10 stl_11 stl_269" style="word-spacing:-0.1791em;">listAddNodeTail ( c</span><span class="stl_107 stl_108 stl_269" style="word-spacing:-0.1791em;">−</span><span class="stl_10 stl_11 stl_269" style="word-spacing:-0.1791em;">&gt;watched_keys , wk) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 19.314em; left:7.5658em;"><span class="stl_17 stl_18 stl_930">当客户端键值的键值被修改的时候，监视该键值的所有客户端都会被标记为 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.0885em; left:5.9058em;"><span class="stl_10 stl_11 stl_1309">REDIS_DIRTY_CAS</span><span class="stl_17 stl_18 stl_1309">，表示此该键值对被修改过。 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.081em; left:7.5658em;"><span class="stl_10 stl_11 stl_1371" style="word-spacing:0.0382em;">touchWatchedKey() </span><span class="stl_17 stl_18 stl_1371" style="word-spacing:0.0382em;">是标记某键值被修改的函数，它一般不被 </span><span class="stl_10 stl_11 stl_1371" style="word-spacing:0.0382em;">signalModifyKey() &nbsp;</span></div>
					<div class="stl_01" style="top: 23.0768em; left:5.9058em;"><span class="stl_17 stl_18 stl_1025" style="word-spacing:0.0991em;">函数包装。下面是 </span><span class="stl_10 stl_11 stl_1025" style="word-spacing:0.0991em;">touchWatchedKey() </span><span class="stl_17 stl_18 stl_1025" style="word-spacing:0.0991em;">的实现。 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4885em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.481em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.4735em; left:5.9425em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 26.4885em; left:6.4282em;"><span class="stl_58 stl_59 stl_1372">/</span><span class="stl_58 stl_59 stl_1372" style="word-spacing:0.6148em;">&nbsp;</span><span class="stl_17 stl_18 stl_1372" style="word-spacing:0.6148em;">标</span><span class="stl_17 stl_18 stl_1372" style="word-spacing:0.0549em;">&nbsp;记 键 值 键 值 对 的 客 户 端 为</span><span class="stl_17 stl_18 stl_1372" style="word-spacing:0.4959em;">&nbsp;</span><span class="stl_58 stl_59 stl_1372" style="word-spacing:0.4959em;">REDIS_DIRTY_CAS</span><span class="stl_17 stl_18 stl_1372" style="word-spacing:0.4959em;">，</span><span class="stl_17 stl_18 stl_1372" style="word-spacing:0.0549em;">&nbsp;表 示 其 所 监 视 的</span><span class="stl_17 stl_18 stl_1372" style="word-spacing:0.0549em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.7057em; left:7.6492em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">据 已 经 被 修 改 过 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.481em; left:6.4282em;"><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.3566em;">* ”Touch” a key</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.0508em;">&nbsp;,</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.4817em;">&nbsp;so that</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.5822em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.1598em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.6072em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.1868em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.1878em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.1878em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.5077em;">&nbsp;key i</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.1948em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.5302em;">&nbsp;being</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.2832em;">&nbsp;WATCHed</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.2422em;">&nbsp;by &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4776em; left:7.5992em;"><span class="stl_58 stl_59 stl_611" style="word-spacing:0.4174em;">some c</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2226em;">&nbsp;l</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2226em;">&nbsp;i</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2236em;">&nbsp;e</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2226em;">&nbsp;n</span><span class="stl_58 stl_59 stl_611" style="word-spacing:-0.2226em;">&nbsp;t</span><span class="stl_58 stl_59 stl_611" style="word-spacing:0.5014em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4735em; left:6.9978em;"><span class="stl_58 stl_59 stl_1373" style="word-spacing:0.3367em;">next EXEC</span><span class="stl_58 stl_59 stl_1373" style="word-spacing:0.4027em;">&nbsp;w</span><span class="stl_58 stl_59 stl_1373" style="word-spacing:-0.1123em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1373" style="word-spacing:-0.1133em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1373" style="word-spacing:-0.1123em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1373" style="word-spacing:0.6907em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1373" style="word-spacing:-0.0923em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1373" style="word-spacing:-0.0933em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1373" style="word-spacing:-0.0923em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1373" style="word-spacing:0.0547em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1373" style="word-spacing:0.5087em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4635em; left:5.9483em;"><span class="stl_15 stl_16 stl_66">void</span><span class="stl_15 stl_16 stl_66" style="word-spacing:0.3097em;">&nbsp;</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.3097em;">touchWatchedKey</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2375em;">&nbsp;(</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1905em;">&nbsp;redisDb</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.3535em;">&nbsp;*db</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1935em;">&nbsp;,</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.4915em;">&nbsp;robj</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.3805em;">&nbsp;*key</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2175em;">&nbsp;)</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2175em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4643em; left:8.0742em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.038em;">l i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.038em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.038em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.612em;">&nbsp;*</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.022em;">&nbsp;c</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;n</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.073em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.461em; left:8.0708em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">l i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;I</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.041em;">&nbsp;e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.042em;">&nbsp;r</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.773em;">&nbsp;l</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.035em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4577em; left:8.01em;"><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">listNode * ln</span><span class="stl_10 stl_11 stl_745" style="word-spacing:-0.0745em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4518em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.4518em; left:8.4207em;"><span class="stl_58 stl_59 stl_293">/</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.3138em;">&nbsp;</span><span class="stl_17 stl_18 stl_293" style="word-spacing:0.3138em;">获</span><span class="stl_17 stl_18 stl_293" style="word-spacing:-0.247em;">&nbsp;取</span><span class="stl_17 stl_18 stl_293" style="word-spacing:-0.246em;">&nbsp;监</span><span class="stl_17 stl_18 stl_293" style="word-spacing:-0.246em;">&nbsp;视</span><span class="stl_17 stl_18 stl_293" style="word-spacing:0.353em;">&nbsp;</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.353em;">key</span><span class="stl_58 stl_59 stl_293" style="word-spacing:0.3539em;">&nbsp;</span><span class="stl_17 stl_18 stl_293" style="word-spacing:0.3539em;">的</span><span class="stl_17 stl_18 stl_293" style="word-spacing:-0.247em;">&nbsp;所</span><span class="stl_17 stl_18 stl_293" style="word-spacing:-0.246em;">&nbsp;有</span><span class="stl_17 stl_18 stl_293" style="word-spacing:-0.246em;">&nbsp;客</span><span class="stl_17 stl_18 stl_293" style="word-spacing:-0.246em;">&nbsp;户</span><span class="stl_17 stl_18 stl_293" style="word-spacing:-0.246em;">&nbsp;端 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.441em; left:8.045em;z-index:619; "><span class="stl_15 stl_16 stl_1374" style="word-spacing:-0.1593em;">i f</span><span class="stl_15 stl_16 stl_1374" style="word-spacing:0.5471em;">&nbsp;</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:0.5471em;">(</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.0733em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.1783em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.1793em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.1783em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.1783em;">&nbsp;S</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.1783em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.1783em;">&nbsp;z</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.1793em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.0723em;">&nbsp;(db</span><span class="stl_107 stl_108 stl_1374" style="word-spacing:-0.0723em;">−</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.0723em;">&gt;watched_keys</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:-0.1573em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:0.2502em;">&nbsp;== 0)</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:0.4258em;">&nbsp;</span><span class="stl_15 stl_16 stl_1374" style="word-spacing:0.4258em;">return</span><span class="stl_15 stl_16 stl_1374" style="word-spacing:-0.1166em;">&nbsp;</span><span class="stl_10 stl_11 stl_1374" style="word-spacing:0.4258em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4427em; left:8.045em;z-index:670; "><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2206em;">c l</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2206em;">&nbsp;i</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2206em;">&nbsp;e</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2206em;">&nbsp;n</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2206em;">&nbsp;t</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2206em;">&nbsp;s</span><span class="stl_10 stl_11 stl_611" style="word-spacing:0.2914em;">&nbsp;=</span><span class="stl_10 stl_11 stl_611" style="word-spacing:0.2274em;">&nbsp;dictFetchValue</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1776em;">&nbsp;(db</span><span class="stl_107 stl_108 stl_611" style="word-spacing:-0.1776em;">−</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1776em;">&gt;watched_keys</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1016em;">&nbsp;,</span><span class="stl_10 stl_11 stl_611" style="word-spacing:0.4384em;">&nbsp;key</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2166em;">&nbsp;)</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.2166em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4335em; left:8.045em;"><span class="stl_15 stl_16 stl_127" style="word-spacing:-0.1884em;">i f</span><span class="stl_15 stl_16 stl_127" style="word-spacing:0.5903em;">&nbsp;</span><span class="stl_10 stl_11 stl_127" style="word-spacing:0.5903em;">(</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.1874em;">&nbsp;!</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.0094em;">&nbsp;c</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.1874em;">&nbsp;l</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.1874em;">&nbsp;i</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.1874em;">&nbsp;e</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.1874em;">&nbsp;n</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.1864em;">&nbsp;t</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.1874em;">&nbsp;s</span><span class="stl_10 stl_11 stl_127" style="word-spacing:-0.0824em;">&nbsp;)</span><span class="stl_10 stl_11 stl_127" style="word-spacing:0.3986em;">&nbsp;</span><span class="stl_15 stl_16 stl_127" style="word-spacing:0.3986em;">return</span><span class="stl_15 stl_16 stl_127" style="word-spacing:-0.1467em;">&nbsp;</span><span class="stl_10 stl_11 stl_127" style="word-spacing:0.3986em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4293em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.4326em; left:8.4207em;"><span class="stl_58 stl_59 stl_1239">/</span><span class="stl_58 stl_59 stl_1239" style="word-spacing:0.5887em;">&nbsp;</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.5887em;">标</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.0285em;">&nbsp;记 监 视</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.6278em;">&nbsp;</span><span class="stl_58 stl_59 stl_1239" style="word-spacing:0.6278em;">key</span><span class="stl_58 stl_59 stl_1239" style="word-spacing:0.6288em;">&nbsp;</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.6288em;">的</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.0287em;">&nbsp;所 有 客 户 端</span><span class="stl_17 stl_18 stl_1239" style="word-spacing:0.4701em;">&nbsp;</span><span class="stl_58 stl_59 stl_1239" style="word-spacing:0.4701em;">REDIS_DIRTY_CAS &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:8.4207em;"><span class="stl_58 stl_59 stl_294" style="word-spacing:0.2473em;">* Mark</span><span class="stl_58 stl_59 stl_294" style="word-spacing:0.3823em;">&nbsp;a</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2387em;">&nbsp;l</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2397em;">&nbsp;l</span><span class="stl_58 stl_59 stl_294" style="word-spacing:0.4758em;">&nbsp;the c</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2567em;">&nbsp;l</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2577em;">&nbsp;i</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2567em;">&nbsp;e</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2567em;">&nbsp;n</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2567em;">&nbsp;t</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2577em;">&nbsp;s</span><span class="stl_58 stl_59 stl_294" style="word-spacing:0.4488em;">&nbsp;watching t</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2647em;">&nbsp;h</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2657em;">&nbsp;i</span><span class="stl_58 stl_59 stl_294" style="word-spacing:-0.2657em;">&nbsp;s</span><span class="stl_58 stl_59 stl_294" style="word-spacing:0.4333em;">&nbsp;key</span><span class="stl_58 stl_59 stl_294" style="word-spacing:0.3583em;">&nbsp;as &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:9.5092em;"><span class="stl_58 stl_59 stl_1375" style="word-spacing:0.4513em;">REDIS_DIRTY_CAS */ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.416em; left:8.0017em;"><span class="stl_10 stl_11 stl_983" style="word-spacing:-0.263em;">listRewind ( c l i e n t s ,&amp; l i ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:8.4207em;"><span class="stl_58 stl_59 stl_805" style="word-spacing:0.2673em;">* Check</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.4033em;">&nbsp;i</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.2607em;">&nbsp;f</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3633em;">&nbsp;we</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.2703em;">&nbsp;are</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3839em;">&nbsp;already watching for</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.4513em;">&nbsp;t</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.2877em;">&nbsp;h</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.2887em;">&nbsp;i</span><span class="stl_58 stl_59 stl_805" style="word-spacing:-0.2887em;">&nbsp;s</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.4103em;">&nbsp;key</span><span class="stl_58 stl_59 stl_805" style="word-spacing:0.3013em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4077em; left:7.9483em;"><span class="stl_15 stl_16 stl_895">while</span><span class="stl_15 stl_16 stl_895" style="word-spacing:-0.2654em;">&nbsp;</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2654em;">((</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2058em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_895" style="word-spacing:0.1662em;">&nbsp;=</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.1247em;">&nbsp;lis tNext</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.3068em;">&nbsp;(&amp;</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2428em;">&nbsp;l</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2528em;">&nbsp;i</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.1478em;">&nbsp;)</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2568em;">&nbsp;)</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2568em;">&nbsp;)</span><span class="stl_10 stl_11 stl_895" style="word-spacing:-0.2568em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:10.02em;"><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.3369em;">r e</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.3359em;">&nbsp;d</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.3359em;">&nbsp;i</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.3369em;">&nbsp;s</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.3359em;">&nbsp;C</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.3359em;">&nbsp;l</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.3359em;">&nbsp;i</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.3369em;">&nbsp;e</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.3359em;">&nbsp;n</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.3359em;">&nbsp;t</span><span class="stl_10 stl_11 stl_799" style="word-spacing:0.3141em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_799" style="word-spacing:0.0971em;">&nbsp;=</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.1277em;">&nbsp;listNodeValue (</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.2639em;">&nbsp;ln</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.2649em;">&nbsp;)</span><span class="stl_10 stl_11 stl_799" style="word-spacing:-0.2649em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">166 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 15.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">事务机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:10.4132em;"><span class="stl_58 stl_59 stl_1376" style="word-spacing:0.4681em;">/ REDIS_DIRTY_CAS</span><span class="stl_58 stl_59 stl_1376" style="word-spacing:0.5085em;">&nbsp;</span><span class="stl_17 stl_18 stl_1376" style="word-spacing:0.5085em;">更</span><span class="stl_17 stl_18 stl_1376" style="word-spacing:0.0681em;">&nbsp;改 的 时 候 会 设 置 此 标</span><span class="stl_17 stl_18 stl_1376" style="word-spacing:0.0681em;">&nbsp;记 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9342em;z-index:52; "><span class="stl_10 stl_11 stl_1377" style="word-spacing:0.0023em;">c</span><span class="stl_107 stl_108 stl_1377" style="word-spacing:0.0023em;">−</span><span class="stl_10 stl_11 stl_1377" style="word-spacing:0.0023em;">&gt;f l</span><span class="stl_10 stl_11 stl_1377" style="word-spacing:0.0013em;">&nbsp;a g</span><span class="stl_10 stl_11 stl_1377" style="word-spacing:0.0023em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1377" style="word-spacing:0.6493em;">&nbsp;|=</span><span class="stl_10 stl_11 stl_1377" style="word-spacing:0.4193em;">&nbsp;REDIS_DIRTY_CAS; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.7043em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 12.6607em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 12.6607em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">5.4 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1259em;">事务的执行与取消 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.9376em; left:7.5658em;z-index:133; "><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0222em;">当用户发出 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0222em;">EXEC </span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0222em;">的时候</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_1378">，在</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.322em;">&nbsp;</span><span class="stl_17 stl_18 stl_1379" style="word-spacing:0.0301em;">它 </span><span class="stl_10 stl_11 stl_1379" style="word-spacing:0.0301em;">MULTI </span><span class="stl_17 stl_18 stl_1379" style="word-spacing:0.0301em;">命令之后提交的所有命令都会被执行。从 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.9343em; left:5.9058em;"><span class="stl_17 stl_18 stl_1380" style="word-spacing:0.0659em;">代码的实现来看，如果客户端监视的数据被修改，它会被标记 </span><span class="stl_10 stl_11 stl_1380" style="word-spacing:0.0659em;">REDIS_DIRTY_CAS</span><span class="stl_17 stl_18 stl_1380" style="word-spacing:0.0659em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 16.9301em; left:5.9058em;"><span class="stl_17 stl_18 stl_1381" style="word-spacing:0.1227em;">会调用 </span><span class="stl_10 stl_11 stl_1381" style="word-spacing:0.1227em;">discardTransaction() </span><span class="stl_17 stl_18 stl_1381" style="word-spacing:0.1227em;">从而取消该事务。特别的，用户开启一个事务后会提 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.149em; left:5.9058em;"><span class="stl_17 stl_18 stl_1079">交多个命令，如果命令在入队过程中出现错误，譬如提交的命令本身不存在，参数 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.9227em; left:5.9058em;"><span class="stl_17 stl_18 stl_1382" style="word-spacing:0.1149em;">错误和内存超额等，都会导致客户端被标记 </span><span class="stl_10 stl_11 stl_1382" style="word-spacing:0.1149em;">REDIS_DIRTY_EXEC</span><span class="stl_17 stl_18 stl_1382" style="word-spacing:0.1149em;">，被标记 </span><span class="stl_10 stl_11 stl_1382" style="word-spacing:0.1149em;">RE- &nbsp;</span></div>
					<div class="stl_01" style="top: 19.9193em; left:5.9058em;"><span class="stl_10 stl_11 stl_33" style="word-spacing:0.0904em;">DIS_DIRTY_EXEC </span><span class="stl_17 stl_18 stl_33" style="word-spacing:0.0904em;">会导致事务被取消。 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.1523em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">因此总结一下： &nbsp;</span></div>
					<div class="stl_01" style="top: 23.941em; left:7.5658em;"><span class="stl_10 stl_11 stl_248" style="word-spacing:0.1219em;">REDIS_DIRTY_CAS </span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.1219em;">更改的时候会设置此标记 </span><span class="stl_10 stl_11 stl_248" style="word-spacing:0.1219em;">REDIS_DIRTY_EXEC </span><span class="stl_17 stl_18 stl_248" style="word-spacing:0.1219em;">命令 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.9376em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">入队时出现错误，此标记会导致 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">EXEC </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">命令执行失败 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.1707em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">下面是执行事务的过程： &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4735em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.4735em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;务</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;内</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;所</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4635em; left:5.9483em;"><span class="stl_15 stl_16 stl_1383">void</span><span class="stl_15 stl_16 stl_1383" style="word-spacing:0.3408em;">&nbsp;</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:0.3408em;">execCommand(</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.0692em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1762em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1752em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1752em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1752em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1762em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1752em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1752em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1752em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1752em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1762em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:0.4748em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1472em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1383" style="word-spacing:-0.1472em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4593em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.3991em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">j</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.461em; left:8.005em;"><span class="stl_10 stl_11 stl_1123" style="word-spacing:0.3278em;">robj **</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:-0.2942em;">&nbsp;orig_argv</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:-0.2942em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4527em; left:7.98em;"><span class="stl_15 stl_16 stl_1299">int</span><span class="stl_15 stl_16 stl_1299" style="word-spacing:0.3417em;">&nbsp;</span><span class="stl_10 stl_11 stl_1299" style="word-spacing:0.3417em;">orig_argc</span><span class="stl_10 stl_11 stl_1299" style="word-spacing:0.3417em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4485em; left:7.9725em;"><span class="stl_15 stl_16 stl_388">struct</span><span class="stl_15 stl_16 stl_388" style="word-spacing:0.3626em;">&nbsp;</span><span class="stl_10 stl_11 stl_388" style="word-spacing:0.3626em;">redisCommand</span><span class="stl_10 stl_11 stl_388" style="word-spacing:0.3222em;">&nbsp;*orig_cmd</span><span class="stl_10 stl_11 stl_388" style="word-spacing:0.3222em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4452em; left:7.98em;"><span class="stl_15 stl_16 stl_1089">int</span><span class="stl_15 stl_16 stl_1089" style="word-spacing:0.4192em;">&nbsp;</span><span class="stl_10 stl_11 stl_1089" style="word-spacing:0.4192em;">must_propagate</span><span class="stl_10 stl_11 stl_1089" style="word-spacing:0.2304em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1089" style="word-spacing:0.2954em;">&nbsp;0;</span><span class="stl_10 stl_11 stl_1089" style="word-spacing:0.4437em;">&nbsp;</span><span class="stl_58 stl_59 stl_1089" style="word-spacing:0.4437em;">/*</span><span class="stl_58 stl_59 stl_1089" style="word-spacing:0.3484em;">&nbsp;Need</span><span class="stl_58 stl_59 stl_1089" style="word-spacing:0.4074em;">&nbsp;to</span><span class="stl_58 stl_59 stl_1089" style="word-spacing:0.4794em;">&nbsp;propagate</span><span class="stl_58 stl_59 stl_1089" style="word-spacing:0.2994em;">&nbsp;MULTI/EXEC &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:9.6575em;"><span class="stl_58 stl_59 stl_287" style="word-spacing:0.381em;">to AOF</span><span class="stl_58 stl_59 stl_287" style="word-spacing:0.305em;">&nbsp;/</span><span class="stl_58 stl_59 stl_287" style="word-spacing:0.553em;">&nbsp;s</span><span class="stl_58 stl_59 stl_287" style="word-spacing:-0.092em;">&nbsp;l</span><span class="stl_58 stl_59 stl_287" style="word-spacing:-0.091em;">&nbsp;a</span><span class="stl_58 stl_59 stl_287" style="word-spacing:-0.092em;">&nbsp;v</span><span class="stl_58 stl_59 stl_287" style="word-spacing:-0.092em;">&nbsp;e</span><span class="stl_58 stl_59 stl_287" style="word-spacing:-0.091em;">&nbsp;s</span><span class="stl_58 stl_59 stl_287" style="word-spacing:-0.047em;">&nbsp;?</span><span class="stl_58 stl_59 stl_287" style="word-spacing:0.456em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.4401em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">必</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;须</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;设</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;多</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;标</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;记 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4302em; left:8.045em;z-index:594; "><span class="stl_15 stl_16 stl_1384" style="word-spacing:0.0041em;">i f</span><span class="stl_15 stl_16 stl_1384" style="word-spacing:0.7908em;">&nbsp;</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:0.7908em;">(</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:0.0141em;">&nbsp;! (</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:0.0141em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1384" style="word-spacing:0.0141em;">−</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:0.0661em;">&gt;f</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:-0.0019em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:-0.0009em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:-0.0019em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:-0.0019em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:0.5101em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:0.2871em;">&nbsp;REDIS_MULTI)</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:0.0391em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1384" style="word-spacing:0.0391em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.431em; left:9.9667em;"><span class="stl_10 stl_11 stl_1044" style="word-spacing:-0.1304em;">addReplyError ( c , ”EXEC␣ without ␣MULTI” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:9.9383em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 45.4176em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 47.4101em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">停 止</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;执</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;事</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;务</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;命</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;令</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;情</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;况： &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:8.4207em;"><span class="stl_58 stl_59 stl_974" style="word-spacing:0.28em;">/ 1.</span><span class="stl_58 stl_59 stl_974" style="word-spacing:0.3215em;">&nbsp;</span><span class="stl_17 stl_18 stl_974" style="word-spacing:0.3215em;">被</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.307em;">&nbsp;监</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;视</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;的</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;数</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;据</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;被</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;修</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;改 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:8.4207em;"><span class="stl_58 stl_59 stl_974" style="word-spacing:0.28em;">/ 2.</span><span class="stl_58 stl_59 stl_974" style="word-spacing:0.3215em;">&nbsp;</span><span class="stl_17 stl_18 stl_974" style="word-spacing:0.3215em;">命</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.307em;">&nbsp;令</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;队</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;列</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;中</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;的</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;命</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;令</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;执</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.305em;">&nbsp;行</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;失</span><span class="stl_17 stl_18 stl_974" style="word-spacing:-0.306em;">&nbsp;败 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">15.4. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">事务的执行与取消 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">167 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_1385" style="word-spacing:0.3206em;">* Check</span><span class="stl_58 stl_59 stl_1385" style="word-spacing:0.4566em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1385" style="word-spacing:-0.2074em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1385" style="word-spacing:0.4166em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1385" style="word-spacing:0.3026em;">&nbsp;need</span><span class="stl_58 stl_59 stl_1385" style="word-spacing:0.3966em;">&nbsp;to</span><span class="stl_58 stl_59 stl_1385" style="word-spacing:0.4451em;">&nbsp;abort the</span><span class="stl_58 stl_59 stl_1385" style="word-spacing:0.2316em;">&nbsp;EXEC because</span><span class="stl_58 stl_59 stl_1385" style="word-spacing:0.2316em;">&nbsp;: &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 6.7168em; left:9.4695em;"><span class="stl_58 stl_59 stl_1386" style="word-spacing:0.397em;">1) Some</span><span class="stl_58 stl_59 stl_1386" style="word-spacing:0.217em;">&nbsp;WATCHed</span><span class="stl_58 stl_59 stl_1386" style="word-spacing:0.304em;">&nbsp;key</span><span class="stl_58 stl_59 stl_1386" style="word-spacing:0.4515em;">&nbsp;was touched</span><span class="stl_58 stl_59 stl_1386" style="word-spacing:0.4515em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.4695em;"><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.3272em;">2) There</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.2872em;">&nbsp;was</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.2592em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.3372em;">&nbsp;previous</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.4165em;">&nbsp;error while queueing</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.2962em;">&nbsp;commands</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.2962em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.3325em;"><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.0063em;">A f a</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2666em;">&nbsp;i</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2676em;">&nbsp;l</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2676em;">&nbsp;e</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2666em;">&nbsp;d</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.2494em;">&nbsp;EXEC</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.1804em;">&nbsp;in</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.3884em;">&nbsp;the</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.4824em;">&nbsp;f</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2416em;">&nbsp;i</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2426em;">&nbsp;r</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2416em;">&nbsp;s</span><span class="stl_58 stl_59 stl_364" style="word-spacing:-0.2416em;">&nbsp;t</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.4704em;">&nbsp;case</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.3984em;">&nbsp;returns</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.3274em;">&nbsp;a multi</span><span class="stl_58 stl_59 stl_364" style="word-spacing:0.4174em;">&nbsp;bulk &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.1967em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.082em;">n i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.081em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.672em;">&nbsp;o</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.097em;">&nbsp;b</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.098em;">&nbsp;j</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.097em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.097em;">&nbsp;c</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.097em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 10.7018em; left:9.4711em;"><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.2236em;">( t</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3186em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3186em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3196em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3186em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3196em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3186em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3186em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3196em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3186em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3196em;">&nbsp;y</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:0.4684em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.2986em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:0.4624em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3236em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:0.3744em;">&nbsp;not</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:0.2694em;">&nbsp;an error</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:0.3594em;">&nbsp;but</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:0.2774em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.0052em;">&nbsp;s p</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3256em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3246em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3246em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3246em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:-0.3256em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1053" style="word-spacing:0.4044em;">&nbsp;behavior &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:10.1358em;"><span class="stl_58 stl_59 stl_07">)</span></div>
					<div class="stl_01" style="top: 11.6985em; left:10.7162em;"><span class="stl_58 stl_59 stl_581" style="word-spacing:0.315em;">, while &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:9.4836em;"><span class="stl_58 stl_59 stl_739" style="word-spacing:0.4782em;">in the second</span><span class="stl_58 stl_59 stl_739" style="word-spacing:0.3897em;">&nbsp;an</span><span class="stl_58 stl_59 stl_739" style="word-spacing:0.1847em;">&nbsp;EXECABORT</span><span class="stl_58 stl_59 stl_739" style="word-spacing:0.2687em;">&nbsp;error</span><span class="stl_58 stl_59 stl_739" style="word-spacing:0.5377em;">&nbsp;i</span><span class="stl_58 stl_59 stl_739" style="word-spacing:-0.1883em;">&nbsp;s</span><span class="stl_58 stl_59 stl_739" style="word-spacing:0.5327em;">&nbsp;returned</span><span class="stl_58 stl_59 stl_739" style="word-spacing:-0.0823em;">&nbsp;.</span><span class="stl_58 stl_59 stl_739" style="word-spacing:0.4547em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:8.045em;z-index:284; "><span class="stl_15 stl_16 stl_1387" style="word-spacing:0.0189em;">i f</span><span class="stl_15 stl_16 stl_1387" style="word-spacing:0.7253em;">&nbsp;</span><span class="stl_10 stl_11 stl_1387" style="word-spacing:0.7253em;">(</span><span class="stl_10 stl_11 stl_1387" style="word-spacing:0.7253em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1387" style="word-spacing:0.7253em;">−</span><span class="stl_10 stl_11 stl_1387" style="word-spacing:-0.0001em;">&gt;f</span><span class="stl_10 stl_11 stl_1387" style="word-spacing:0.0134em;">&nbsp;l a g s</span><span class="stl_10 stl_11 stl_1387" style="word-spacing:0.5239em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1387" style="word-spacing:0.4599em;">&nbsp;(REDIS_DIRTY_CAS|REDIS_DIRTY_EXEC)</span><span class="stl_10 stl_11 stl_1387" style="word-spacing:0.0539em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1387" style="word-spacing:0.0539em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:9.95em;z-index:340; "><span class="stl_10 stl_11 stl_906" style="word-spacing:-0.0677em;">addReply (</span><span class="stl_10 stl_11 stl_906" style="word-spacing:-0.0887em;">&nbsp;c</span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.0193em;">&nbsp;,</span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.0193em;">&nbsp;c</span><span class="stl_107 stl_108 stl_906" style="word-spacing:0.0193em;">−</span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.5673em;">&gt;f</span><span class="stl_10 stl_11 stl_906" style="word-spacing:-0.0757em;">&nbsp;l</span><span class="stl_10 stl_11 stl_906" style="word-spacing:-0.0757em;">&nbsp;a</span><span class="stl_10 stl_11 stl_906" style="word-spacing:-0.0747em;">&nbsp;g</span><span class="stl_10 stl_11 stl_906" style="word-spacing:-0.0757em;">&nbsp;s</span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.4353em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.1973em;">&nbsp;REDIS_DIRTY_EXEC</span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.3483em;">&nbsp;?</span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.5273em;">&nbsp;shared</span><span class="stl_10 stl_11 stl_906" style="word-spacing:0.5273em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.6642em;"><span class="stl_10 stl_11 stl_198" style="word-spacing:0.3739em;">execaborterr : &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:30.9025em;"><span class="stl_10 stl_11 stl_301" style="word-spacing:-0.1974em;">shared . &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:32.5842em;"><span class="stl_10 stl_11 stl_990">nullmultibulk &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:32.56em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 18.671em; left:33.1038em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:9.9975em;"><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.2908em;">discardTransaction ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:9.9283em;"><span class="stl_15 stl_16 stl_1323">goto</span><span class="stl_15 stl_16 stl_1323" style="word-spacing:0.3253em;">&nbsp;</span><span class="stl_10 stl_11 stl_1323" style="word-spacing:0.3253em;">handle_monitor</span><span class="stl_10 stl_11 stl_1323" style="word-spacing:0.3253em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;所</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_1388" style="word-spacing:0.3527em;">* Exec</span><span class="stl_58 stl_59 stl_1388" style="word-spacing:0.4877em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1388" style="word-spacing:-0.1793em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1388" style="word-spacing:-0.1803em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1388" style="word-spacing:0.5437em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1388" style="word-spacing:0.4407em;">&nbsp;queued</span><span class="stl_58 stl_59 stl_1388" style="word-spacing:0.3232em;">&nbsp;commands</span><span class="stl_58 stl_59 stl_1388" style="word-spacing:0.3232em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9658em;"><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.2152em;">unwatchAllKeys (</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.2182em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.2192em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.1352em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:0.4179em;">&nbsp;</span><span class="stl_58 stl_59 stl_1389" style="word-spacing:0.4179em;">/*</span><span class="stl_58 stl_59 stl_1389" style="word-spacing:0.3098em;">&nbsp;Unwatch</span><span class="stl_58 stl_59 stl_1389" style="word-spacing:0.1848em;">&nbsp;ASAP</span><span class="stl_58 stl_59 stl_1389" style="word-spacing:0.2638em;">&nbsp;otherwise</span><span class="stl_58 stl_59 stl_1389" style="word-spacing:0.3558em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1389" style="word-spacing:-0.1812em;">&nbsp;’</span><span class="stl_58 stl_59 stl_1389" style="word-spacing:-0.0752em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1389" style="word-spacing:-0.1732em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1389" style="word-spacing:0.5318em;">&nbsp;waste &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:9.4883em;"><span class="stl_58 stl_59 stl_393" style="word-spacing:0.49em;">CPU c</span><span class="stl_58 stl_59 stl_393" style="word-spacing:-0.026em;">&nbsp;y</span><span class="stl_58 stl_59 stl_393" style="word-spacing:-0.025em;">&nbsp;c</span><span class="stl_58 stl_59 stl_393" style="word-spacing:-0.025em;">&nbsp;l</span><span class="stl_58 stl_59 stl_393" style="word-spacing:-0.025em;">&nbsp;e</span><span class="stl_58 stl_59 stl_393" style="word-spacing:-0.026em;">&nbsp;s</span><span class="stl_58 stl_59 stl_393" style="word-spacing:0.634em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_1390">/</span><span class="stl_58 stl_59 stl_1390" style="word-spacing:0.5346em;">&nbsp;</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:0.5346em;">保</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0262em;">&nbsp;存</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;当</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;前</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;命</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:0.0088em;">&nbsp;令，</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0175em;">&nbsp;一 般</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;为</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:0.4132em;">&nbsp;</span><span class="stl_58 stl_59 stl_1390" style="word-spacing:0.4132em;">MULTI</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:0.4132em;">，</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;在</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;执</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;行</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;完</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;所</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;有</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;命</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;令</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;后</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;会</span><span class="stl_17 stl_18 stl_1390" style="word-spacing:-0.0252em;">&nbsp;恢 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.8515em; left:9.6692em;"><span class="stl_17 stl_18 stl_79">复。 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:7.9858em;z-index:594; "><span class="stl_10 stl_11 stl_1391" style="word-spacing:0.2269em;">orig_argv =</span><span class="stl_10 stl_11 stl_1391" style="word-spacing:0.2269em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1391" style="word-spacing:0.2269em;">−</span><span class="stl_10 stl_11 stl_1391" style="word-spacing:0.1729em;">&gt;argv</span><span class="stl_10 stl_11 stl_1391" style="word-spacing:0.1729em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:7.9933em;z-index:612; "><span class="stl_10 stl_11 stl_1323" style="word-spacing:0.217em;">orig_argc =</span><span class="stl_10 stl_11 stl_1323" style="word-spacing:0.217em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1323" style="word-spacing:0.217em;">−</span><span class="stl_10 stl_11 stl_1323" style="word-spacing:0.154em;">&gt;argc</span><span class="stl_10 stl_11 stl_1323" style="word-spacing:0.154em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:7.9483em;z-index:629; "><span class="stl_10 stl_11 stl_1392" style="word-spacing:0.2924em;">orig_cmd = c</span><span class="stl_107 stl_108 stl_1392" style="word-spacing:0.2924em;">−</span><span class="stl_10 stl_11 stl_1392" style="word-spacing:0.2924em;">&gt;cmd</span><span class="stl_10 stl_11 stl_1392" style="word-spacing:0.2924em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:7.9667em;z-index:659; "><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.1703em;">addReplyMultiBulkLen ( c , c</span><span class="stl_107 stl_108 stl_1393" style="word-spacing:-0.1703em;">−</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.1703em;">&gt;mstate . count ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:7.9808em;z-index:686; "><span class="stl_15 stl_16 stl_634">for</span><span class="stl_15 stl_16 stl_634" style="word-spacing:0.4385em;">&nbsp;</span><span class="stl_10 stl_11 stl_634" style="word-spacing:0.4385em;">(</span><span class="stl_10 stl_11 stl_634" style="word-spacing:-0.1154em;">&nbsp;j</span><span class="stl_10 stl_11 stl_634" style="word-spacing:0.2876em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_634" style="word-spacing:0.5206em;">&nbsp;j</span><span class="stl_10 stl_11 stl_634" style="word-spacing:0.2606em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_634" style="word-spacing:0.2606em;">&nbsp;c</span><span class="stl_107 stl_108 stl_634" style="word-spacing:0.2606em;">−</span><span class="stl_10 stl_11 stl_634" style="word-spacing:0.2256em;">&gt;mstate</span><span class="stl_10 stl_11 stl_634" style="word-spacing:-0.1134em;">&nbsp;.</span><span class="stl_10 stl_11 stl_634" style="word-spacing:-0.1134em;">&nbsp;count</span><span class="stl_10 stl_11 stl_634" style="word-spacing:-0.1144em;">&nbsp;;</span><span class="stl_10 stl_11 stl_634" style="word-spacing:0.5406em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_634" style="word-spacing:0.5406em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.601em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.601em; left:10.4132em;z-index:713; "><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;被</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;赋</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;值</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;给</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;当</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;前</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:9.9342em;z-index:734; "><span class="stl_10 stl_11 stl_1394" style="word-spacing:0.2917em;">c</span><span class="stl_107 stl_108 stl_1394" style="word-spacing:0.2917em;">−</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:0.2917em;">&gt;argc =</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:0.2917em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1394" style="word-spacing:0.2917em;">−</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:0.2307em;">&gt;mstate</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.0783em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.1513em;">&nbsp;commands</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.1503em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.0243em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.0885em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.0043em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.0043em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:9.9342em;z-index:769; "><span class="stl_10 stl_11 stl_1267" style="word-spacing:0.2845em;">c</span><span class="stl_107 stl_108 stl_1267" style="word-spacing:0.2845em;">−</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:0.2845em;">&gt;argv =</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:0.2845em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1267" style="word-spacing:0.2845em;">−</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:0.2405em;">&gt;mstate</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:-0.0685em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:-0.1415em;">&nbsp;commands</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:-0.1405em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:-0.0145em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:-0.069em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:-0.0115em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_1267" style="word-spacing:-0.0115em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:9.9342em;z-index:803; "><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.2376em;">c</span><span class="stl_107 stl_108 stl_1395" style="word-spacing:0.2376em;">−</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.2376em;">&gt;cmd =</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.2376em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1395" style="word-spacing:0.2376em;">−</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.2986em;">&gt;mstate</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0104em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0834em;">&nbsp;commands</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0834em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.0436em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.0976em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0504em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0574em;">&nbsp;cmd</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0574em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:10.4132em;"><span class="stl_58 stl_59 stl_1396">/</span><span class="stl_58 stl_59 stl_1396" style="word-spacing:0.6518em;">&nbsp;</span><span class="stl_17 stl_18 stl_1396" style="word-spacing:0.6518em;">遇</span><span class="stl_17 stl_18 stl_1396" style="word-spacing:0.0919em;">&nbsp;到 包 含 写 操 作 的 命 令 需 要 将</span><span class="stl_17 stl_18 stl_1396" style="word-spacing:0.5303em;">&nbsp;</span><span class="stl_58 stl_59 stl_1396" style="word-spacing:0.5303em;">MULTI</span><span class="stl_58 stl_59 stl_1396" style="word-spacing:0.5299em;">&nbsp;</span><span class="stl_17 stl_18 stl_1396" style="word-spacing:0.5299em;">命</span><span class="stl_17 stl_18 stl_1396" style="word-spacing:0.0917em;">&nbsp;令 写 入</span><span class="stl_17 stl_18 stl_1396" style="word-spacing:0.5023em;">&nbsp;</span><span class="stl_58 stl_59 stl_1396" style="word-spacing:0.5023em;">AOF</span><span class="stl_58 stl_59 stl_1396" style="word-spacing:0.5006em;">&nbsp;</span><span class="stl_17 stl_18 stl_1396" style="word-spacing:0.5006em;">文</span><span class="stl_17 stl_18 stl_1396" style="word-spacing:0.5006em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:10.4132em;"><span class="stl_58 stl_59 stl_1149" style="word-spacing:0.3276em;">* Propagate a</span><span class="stl_58 stl_59 stl_1149" style="word-spacing:0.1586em;">&nbsp;MULTI</span><span class="stl_58 stl_59 stl_1149" style="word-spacing:0.2526em;">&nbsp;request</span><span class="stl_58 stl_59 stl_1149" style="word-spacing:0.3976em;">&nbsp;once</span><span class="stl_58 stl_59 stl_1149" style="word-spacing:0.2966em;">&nbsp;we encounter</span><span class="stl_58 stl_59 stl_1149" style="word-spacing:0.4096em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:11.72em;"><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.2872em;">f i</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.2872em;">&nbsp;r</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.2882em;">&nbsp;s</span><span class="stl_58 stl_59 stl_791" style="word-spacing:-0.2872em;">&nbsp;t</span><span class="stl_58 stl_59 stl_791" style="word-spacing:0.4488em;">&nbsp;write</span><span class="stl_58 stl_59 stl_791" style="word-spacing:0.3038em;">&nbsp;op</span><span class="stl_58 stl_59 stl_791" style="word-spacing:0.3038em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 45.5718em; left:11.4603em;"><span class="stl_58 stl_59 stl_1397" style="word-spacing:0.388em;">This way</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:0.321em;">&nbsp;we</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.119em;">&nbsp;’</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.012em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.109em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:0.655em;">&nbsp;d</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.173em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.174em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.173em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.174em;">&nbsp;v</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.173em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.173em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:0.55em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:0.3241em;">&nbsp;MULTI/</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.146em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.146em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.146em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.147em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.146em;">&nbsp;/EXEC</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:0.319em;">&nbsp;block &nbsp;</span></div>
					<div class="stl_01" style="top: 46.5676em; left:12.1267em;"><span class="stl_58 stl_59 stl_578" style="word-spacing:0.3236em;">as a whole and &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">168 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 15.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">事务机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:11.4819em;"><span class="stl_58 stl_59 stl_1398" style="word-spacing:0.4406em;">both the</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:0.2326em;">&nbsp;AOF</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:0.1616em;">&nbsp;and</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:0.3776em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:0.4866em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2364em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2374em;">&nbsp;p</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2364em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2374em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2364em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2374em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2374em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2364em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2374em;">&nbsp;o</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2364em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:0.5256em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2374em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2374em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2374em;">&nbsp;k</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:0.5466em;">&nbsp;w</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2174em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2174em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:-0.2164em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1398" style="word-spacing:0.4746em;">&nbsp;have &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:12.1525em;"><span class="stl_58 stl_59 stl_451" style="word-spacing:0.2888em;">the same consistency &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:11.4296em;"><span class="stl_58 stl_59 stl_1287" style="word-spacing:0.3039em;">and atomicity</span><span class="stl_58 stl_59 stl_1287" style="word-spacing:0.3719em;">&nbsp;guarantees</span><span class="stl_58 stl_59 stl_1287" style="word-spacing:-0.2151em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1287" style="word-spacing:0.3219em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:10.0375em;z-index:135; "><span class="stl_15 stl_16 stl_1399" style="word-spacing:-0.1106em;">i f</span><span class="stl_15 stl_16 stl_1399" style="word-spacing:0.6681em;">&nbsp;</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:0.6681em;">(</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.1096em;">&nbsp;!</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.0326em;">&nbsp;must_propagate</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:0.2704em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:0.3714em;">&nbsp;!</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.1096em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.1096em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1399" style="word-spacing:-0.1096em;">−</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.0566em;">&gt;cmd</span><span class="stl_107 stl_108 stl_1399" style="word-spacing:-0.0566em;">−</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.0566em;">&gt;f</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.1156em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.1166em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.1166em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.1156em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1399" style="word-spacing:-0.1156em;">&nbsp;&amp; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:11.4625em;"><span class="stl_10 stl_11 stl_1400" style="word-spacing:0.1624em;">REDIS_CMD_READONLY) )</span><span class="stl_10 stl_11 stl_1400" style="word-spacing:0.1624em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:11.9392em;"><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.1839em;">execCommandPropagateMulti ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:11.9467em;"><span class="stl_10 stl_11 stl_1285" style="word-spacing:0.1759em;">must_propagate =</span><span class="stl_10 stl_11 stl_1285" style="word-spacing:0.2409em;">&nbsp;1; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 14.6876em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:10.4132em;"><span class="stl_58 stl_59 stl_272">/</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.0246em;">&nbsp;</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.0246em;">调 用</span><span class="stl_17 stl_18 stl_272" style="word-spacing:0.3804em;">&nbsp;</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.3804em;">c</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.322em;">&nbsp;a</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.32em;">&nbsp;l</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.321em;">&nbsp;l</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.193em;">&nbsp;()</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.3242em;">&nbsp;</span><span class="stl_17 stl_18 stl_272" style="word-spacing:0.3242em;">执</span><span class="stl_17 stl_18 stl_272" style="word-spacing:0.3242em;">&nbsp;行 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:10.04em;"><span class="stl_10 stl_11 stl_218" style="word-spacing:0.0184em;">c a l l</span><span class="stl_10 stl_11 stl_218" style="word-spacing:0.1234em;">&nbsp;(</span><span class="stl_10 stl_11 stl_218" style="word-spacing:-0.0036em;">&nbsp;c</span><span class="stl_10 stl_11 stl_218" style="word-spacing:0.1044em;">&nbsp;,REDIS_CALL_FULL)</span><span class="stl_10 stl_11 stl_218" style="word-spacing:0.1044em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">这</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;几</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;句</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;是</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;多</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;余</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:10.4132em;"><span class="stl_58 stl_59 stl_832" style="word-spacing:0.2486em;">* Commands</span><span class="stl_58 stl_59 stl_832" style="word-spacing:0.1846em;">&nbsp;may</span><span class="stl_58 stl_59 stl_832" style="word-spacing:0.3606em;">&nbsp;a</span><span class="stl_58 stl_59 stl_832" style="word-spacing:-0.2344em;">&nbsp;l</span><span class="stl_58 stl_59 stl_832" style="word-spacing:-0.2344em;">&nbsp;t</span><span class="stl_58 stl_59 stl_832" style="word-spacing:-0.2354em;">&nbsp;e</span><span class="stl_58 stl_59 stl_832" style="word-spacing:-0.2344em;">&nbsp;r</span><span class="stl_58 stl_59 stl_832" style="word-spacing:0.4756em;">&nbsp;argc</span><span class="stl_58 stl_59 stl_832" style="word-spacing:-0.2504em;">&nbsp;/argv</span><span class="stl_58 stl_59 stl_832" style="word-spacing:-0.0754em;">&nbsp;,</span><span class="stl_58 stl_59 stl_832" style="word-spacing:0.4696em;">&nbsp;restore mstate</span><span class="stl_58 stl_59 stl_832" style="word-spacing:-0.1524em;">&nbsp;.</span><span class="stl_58 stl_59 stl_832" style="word-spacing:0.4016em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:9.9342em;z-index:328; "><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.0782em;">c</span><span class="stl_107 stl_108 stl_1394" style="word-spacing:-0.0782em;">−</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.0782em;">&gt;mstate .</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.1502em;">&nbsp;commands</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.1512em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.0242em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.0874em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:-0.0052em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:0.2918em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:0.2918em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1394" style="word-spacing:0.2918em;">−</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:0.2308em;">&gt;argc</span><span class="stl_10 stl_11 stl_1394" style="word-spacing:0.2308em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:9.9342em;z-index:363; "><span class="stl_10 stl_11 stl_1401" style="word-spacing:-0.0684em;">c</span><span class="stl_107 stl_108 stl_1401" style="word-spacing:-0.0684em;">−</span><span class="stl_10 stl_11 stl_1401" style="word-spacing:-0.0684em;">&gt;mstate .</span><span class="stl_10 stl_11 stl_1401" style="word-spacing:-0.1404em;">&nbsp;commands</span><span class="stl_10 stl_11 stl_1401" style="word-spacing:-0.1414em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1401" style="word-spacing:-0.0144em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1401" style="word-spacing:-0.0679em;">&nbsp;] .</span><span class="stl_10 stl_11 stl_1401" style="word-spacing:-0.0124em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_1401" style="word-spacing:0.2846em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1401" style="word-spacing:0.2846em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1401" style="word-spacing:0.2846em;">−</span><span class="stl_10 stl_11 stl_1401" style="word-spacing:0.2406em;">&gt;argv</span><span class="stl_10 stl_11 stl_1401" style="word-spacing:0.2406em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:9.9342em;z-index:397; "><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0105em;">c</span><span class="stl_107 stl_108 stl_1395" style="word-spacing:-0.0105em;">−</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0105em;">&gt;mstate .</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0825em;">&nbsp;commands</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0835em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.0435em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.0975em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0495em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:-0.0585em;">&nbsp;cmd</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.2365em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.2365em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1395" style="word-spacing:0.2365em;">−</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.2985em;">&gt;cmd</span><span class="stl_10 stl_11 stl_1395" style="word-spacing:0.2985em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_1402">/</span><span class="stl_58 stl_59 stl_1402" style="word-spacing:0.5546em;">&nbsp;</span><span class="stl_17 stl_18 stl_1402" style="word-spacing:0.5546em;">恢</span><span class="stl_17 stl_18 stl_1402" style="word-spacing:-0.0062em;">&nbsp;复</span><span class="stl_17 stl_18 stl_1402" style="word-spacing:-0.0052em;">&nbsp;当</span><span class="stl_17 stl_18 stl_1402" style="word-spacing:-0.0052em;">&nbsp;前</span><span class="stl_17 stl_18 stl_1402" style="word-spacing:-0.0052em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1402" style="word-spacing:-0.0052em;">&nbsp;命</span><span class="stl_17 stl_18 stl_1402" style="word-spacing:0.0283em;">&nbsp;令， 一</span><span class="stl_17 stl_18 stl_1402" style="word-spacing:-0.0052em;">&nbsp;般</span><span class="stl_17 stl_18 stl_1402" style="word-spacing:-0.0052em;">&nbsp;为</span><span class="stl_17 stl_18 stl_1402" style="word-spacing:0.4333em;">&nbsp;</span><span class="stl_58 stl_59 stl_1402" style="word-spacing:0.4333em;">MULTI &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9408em;z-index:423; "><span class="stl_10 stl_11 stl_514" style="word-spacing:0.2219em;">c</span><span class="stl_107 stl_108 stl_514" style="word-spacing:0.2219em;">−</span><span class="stl_10 stl_11 stl_514" style="word-spacing:0.2219em;">&gt;argv = orig_argv</span><span class="stl_10 stl_11 stl_514" style="word-spacing:0.2219em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:7.9408em;z-index:441; "><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2151em;">c</span><span class="stl_107 stl_108 stl_1096" style="word-spacing:0.2151em;">−</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2151em;">&gt;argc = orig_argc</span><span class="stl_10 stl_11 stl_1096" style="word-spacing:0.2151em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:7.9408em;z-index:459; "><span class="stl_10 stl_11 stl_1392" style="word-spacing:0.227em;">c</span><span class="stl_107 stl_108 stl_1392" style="word-spacing:0.227em;">−</span><span class="stl_10 stl_11 stl_1392" style="word-spacing:0.227em;">&gt;cmd =</span><span class="stl_10 stl_11 stl_1392" style="word-spacing:0.297em;">&nbsp;orig_cmd</span><span class="stl_10 stl_11 stl_1392" style="word-spacing:0.297em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">事 务</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;已</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;经</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;执</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;完</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;毕，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;清</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;理</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;与</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;此</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;事</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;务</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;相</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;关</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;信</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;息，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;如</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;命</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;令</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;队</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;列</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;和 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.8482em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0503em;">客 户 端 标 记 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:8.005em;"><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.2908em;">discardTransaction ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.6201em; left:8.4207em;"><span class="stl_58 stl_59 stl_1403" style="word-spacing:0.3078em;">* Make</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:0.3628em;">&nbsp;sure</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:0.4728em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:0.2758em;">&nbsp;EXEC</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:0.1518em;">&nbsp;command</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:0.4198em;">&nbsp;w</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:-0.1822em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:-0.1822em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:-0.1812em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:0.5118em;">&nbsp;be</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:0.4428em;">&nbsp;propagated as</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:0.4808em;">&nbsp;w</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:-0.2122em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:-0.2122em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1403" style="word-spacing:-0.2122em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:9.7208em;"><span class="stl_58 stl_59 stl_891" style="word-spacing:0.067em;">i f</span><span class="stl_58 stl_59 stl_891" style="word-spacing:0.605em;">&nbsp;MULTI &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 34.6126em; left:9.4371em;"><span class="stl_58 stl_59 stl_157" style="word-spacing:0.3139em;">was already</span><span class="stl_58 stl_59 stl_157" style="word-spacing:0.3749em;">&nbsp;propagated</span><span class="stl_58 stl_59 stl_157" style="word-spacing:-0.2091em;">&nbsp;.</span><span class="stl_58 stl_59 stl_157" style="word-spacing:0.3359em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6018em; left:8.045em;"><span class="stl_15 stl_16 stl_987" style="word-spacing:-0.2658em;">i f</span><span class="stl_15 stl_16 stl_987" style="word-spacing:0.4406em;">&nbsp;</span><span class="stl_10 stl_11 stl_987" style="word-spacing:0.4406em;">(</span><span class="stl_10 stl_11 stl_987" style="word-spacing:-0.2608em;">&nbsp;must_propagate</span><span class="stl_10 stl_11 stl_987" style="word-spacing:-0.2598em;">&nbsp;)</span><span class="stl_10 stl_11 stl_987" style="word-spacing:0.4072em;">&nbsp;server</span><span class="stl_10 stl_11 stl_987" style="word-spacing:-0.1378em;">&nbsp;.</span><span class="stl_10 stl_11 stl_987" style="word-spacing:-0.1378em;">&nbsp;dirty++; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 37.5993em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 40.8107em; left:5.9883em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3136em;">如 上 所 说， 被 监 视 的 键 值 被 修 改 或 者 命 令 入 队 出 错 都 会 导 致 事 务 被 取 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.8065em; left:7.6767em;"><span class="stl_17 stl_18 stl_79">消： &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;消</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;务 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5685em; left:5.9483em;"><span class="stl_15 stl_16 stl_921">void</span><span class="stl_15 stl_16 stl_921" style="word-spacing:0.2957em;">&nbsp;</span><span class="stl_10 stl_11 stl_921" style="word-spacing:0.2957em;">discardTransaction</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.2517em;">&nbsp;(</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.2247em;">&nbsp;r</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3297em;">&nbsp;e</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3297em;">&nbsp;d</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3297em;">&nbsp;i</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3307em;">&nbsp;s</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3297em;">&nbsp;C</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3297em;">&nbsp;l</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3297em;">&nbsp;i</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3307em;">&nbsp;e</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3297em;">&nbsp;n</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3297em;">&nbsp;t</span><span class="stl_10 stl_11 stl_921" style="word-spacing:0.3203em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3027em;">&nbsp;)</span><span class="stl_10 stl_11 stl_921" style="word-spacing:-0.3027em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">清</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:8.0183em;"><span class="stl_10 stl_11 stl_1404" style="word-spacing:-0.3193em;">freeClientMultiState ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">15.5. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">事务番外篇 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">169 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">初</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;始</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;化</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:8.0217em;"><span class="stl_10 stl_11 stl_1405" style="word-spacing:-0.3571em;">in itC lientM ultiState ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">取</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;消</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;标</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;记</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6232em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6232em;">f</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.077em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.077em;">&nbsp;a</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.077em;">&nbsp;g &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:7.9408em;z-index:63; "><span class="stl_10 stl_11 stl_1406" style="word-spacing:-0.0107em;">c</span><span class="stl_107 stl_108 stl_1406" style="word-spacing:-0.0107em;">−</span><span class="stl_10 stl_11 stl_1406" style="word-spacing:-0.0107em;">&gt;f l</span><span class="stl_10 stl_11 stl_1406" style="word-spacing:-0.0117em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1406" style="word-spacing:-0.0117em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1406" style="word-spacing:-0.0107em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1406" style="word-spacing:0.4693em;">&nbsp;&amp;=</span><span class="stl_10 stl_11 stl_1406" style="word-spacing:0.3833em;">&nbsp;~(REDIS_MULTI|REDIS_DIRTY_CAS| &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:9.5017em;"><span class="stl_10 stl_11 stl_1407" style="word-spacing:0.1939em;">REDIS_DIRTY_EXEC) ;</span><span class="stl_10 stl_11 stl_1407" style="word-spacing:0.1939em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.9658em;"><span class="stl_10 stl_11 stl_270" style="word-spacing:-0.2083em;">unwatchAllKeys ( c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 16.2741em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 16.2741em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">5.5 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1259em;">事务番外篇 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.739em; left:7.5658em;"><span class="stl_17 stl_18 stl_46">你可能已经注意到「事务」这个词。在学习数据库原理的时候有提到过事务的 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.5135em; left:5.9058em;"><span class="stl_10 stl_11 stl_1408" style="word-spacing:0.1091em;">ACID</span><span class="stl_17 stl_18 stl_1408" style="word-spacing:0.1091em;">，即原子性、一致性、隔离性、持久性。接下来，看看 </span><span class="stl_10 stl_11 stl_1408" style="word-spacing:0.1091em;">redis </span><span class="stl_17 stl_18 stl_1408" style="word-spacing:0.1091em;">事务是否支持 </span><span class="stl_10 stl_11 stl_1408" style="word-spacing:0.1091em;">ACID</span><span class="stl_17 stl_18 stl_1408" style="word-spacing:0.1091em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.7282em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">原子性，即一个事务中的所有操作，要么全部完成，要么全部不完成，不会结束 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.5018em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">在中间某个环节。</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">事务不支持原子性，最明显的是 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">不支持回滚操作。 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.7165em; left:7.5658em;"><span class="stl_17 stl_18 stl_1025">一致性，在事务开始之前和事务结束以后，数据库的完整性没有被破坏。这一点， &nbsp;</span></div>
					<div class="stl_01" style="top: 25.491em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">事务能够保证。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.7057em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">隔离性，当两个或者多个事务并发访问（此处访问指查询和修改的操作）数据库 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4793em; left:5.9058em;"><span class="stl_17 stl_18 stl_35" style="word-spacing:0.0775em;">的同一数据时所表现出的相互关系。</span><span class="stl_10 stl_11 stl_35" style="word-spacing:0.0775em;">redis </span><span class="stl_17 stl_18 stl_35" style="word-spacing:0.0775em;">不存在多个事务的问题，因为 </span><span class="stl_10 stl_11 stl_35" style="word-spacing:0.0775em;">redis </span><span class="stl_17 stl_18 stl_35" style="word-spacing:0.0775em;">是单进 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6982em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">程单线程的工作模式。 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6907em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">持久性，在事务完成以后，该事务对数据库所作的更改便持久地保存在数据库之 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4643em; left:5.9058em;"><span class="stl_17 stl_18 stl_1034" style="word-spacing:0.0861em;">中，并且是完全的。</span><span class="stl_10 stl_11 stl_1034" style="word-spacing:0.0861em;">redis </span><span class="stl_17 stl_18 stl_1034" style="word-spacing:0.0861em;">提供两种持久化的方式，即 </span><span class="stl_10 stl_11 stl_1034" style="word-spacing:0.0861em;">RDB </span><span class="stl_17 stl_18 stl_1034" style="word-spacing:0.0861em;">和 </span><span class="stl_10 stl_11 stl_1034" style="word-spacing:0.0861em;">AOF</span><span class="stl_17 stl_18 stl_1034" style="word-spacing:0.0861em;">。</span><span class="stl_10 stl_11 stl_1034" style="word-spacing:0.0861em;">RDB </span><span class="stl_17 stl_18 stl_1034" style="word-spacing:0.0861em;">持久化只 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6832em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">备份当前内存中的数据集，事务执行完毕时，其数据还在内存中，并未立即写入到磁 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4577em; left:5.9058em;"><span class="stl_17 stl_18 stl_1409" style="word-spacing:0.0927em;">盘，所以 </span><span class="stl_10 stl_11 stl_1409" style="word-spacing:0.0927em;">RDB </span><span class="stl_17 stl_18 stl_1409" style="word-spacing:0.0927em;">持久化不能保证 </span><span class="stl_10 stl_11 stl_1409" style="word-spacing:0.0927em;">redis </span><span class="stl_17 stl_18 stl_1409" style="word-spacing:0.0927em;">事务的持久性。再来讨论 </span><span class="stl_10 stl_11 stl_1409" style="word-spacing:0.0927em;">AOF </span><span class="stl_17 stl_18 stl_1409" style="word-spacing:0.0927em;">持久化，我在 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6757em; left:5.455em;"><span class="stl_17 stl_18 stl_07">《</span></div>
					<div class="stl_01" style="top: 35.4535em; left:6.2852em;"><span class="stl_17 stl_18 stl_1410" style="word-spacing:0.094em;">深入剖析 </span><span class="stl_10 stl_11 stl_1410" style="word-spacing:0.094em;">redis AOF </span><span class="stl_17 stl_18 stl_1410" style="word-spacing:0.094em;">持久化策略》中讨论过：</span><span class="stl_10 stl_11 stl_1410" style="word-spacing:0.094em;">redis AOF </span><span class="stl_17 stl_18 stl_1410" style="word-spacing:0.094em;">有后台执行和边服务边备 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4502em; left:5.9058em;"><span class="stl_17 stl_18 stl_23" style="word-spacing:0.0833em;">份两种方式。后台执行和 </span><span class="stl_10 stl_11 stl_23" style="word-spacing:0.0833em;">RDB </span><span class="stl_17 stl_18 stl_23" style="word-spacing:0.0833em;">持久化类似，只能保存当前内存中的数据集；边备份 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.446em; left:5.9058em;"><span class="stl_17 stl_18 stl_949" style="word-spacing:0.075em;">边服务的方式中，因为 </span><span class="stl_10 stl_11 stl_949" style="word-spacing:0.075em;">redis </span><span class="stl_17 stl_18 stl_949" style="word-spacing:0.075em;">只是每间隔 </span><span class="stl_10 stl_11 stl_949" style="word-spacing:0.075em;">2s </span><span class="stl_17 stl_18 stl_949" style="word-spacing:0.075em;">才进行一次备份，因此它的持久性也是不 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.6648em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">完整的！ &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4352em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">当然，我们可以自己修改源码保证 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">事务的持久性，这不难。 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:7.5658em;"><span class="stl_17 stl_18 stl_1411" style="word-spacing:0.1098em;">还有一个亮点，就是 </span><span class="stl_10 stl_11 stl_1411" style="word-spacing:0.1098em;">check-and-set CAS</span><span class="stl_17 stl_18 stl_1411" style="word-spacing:0.1098em;">。一个修改操作不断的判断 </span><span class="stl_10 stl_11 stl_1411" style="word-spacing:0.1098em;">X </span><span class="stl_17 stl_18 stl_1411" style="word-spacing:0.1098em;">值是否 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:5.9058em;"><span class="stl_17 stl_18 stl_509" style="word-spacing:0.1035em;">已经被修改，直到 </span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.1035em;">X </span><span class="stl_17 stl_18 stl_509" style="word-spacing:0.1035em;">值没有被其他操作修改，才设置新的值。</span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.1035em;">redis </span><span class="stl_17 stl_18 stl_509" style="word-spacing:0.1035em;">借助 </span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.1035em;">WATCH/ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:5.9058em;"><span class="stl_10 stl_11 stl_1030" style="word-spacing:0.0954em;">MULTI </span><span class="stl_17 stl_18 stl_1030" style="word-spacing:0.0954em;">命令来实现 </span><span class="stl_10 stl_11 stl_1030" style="word-spacing:0.0954em;">CAS </span><span class="stl_17 stl_18 stl_1030" style="word-spacing:0.0954em;">操作的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">实际操作中，多个线程尝试修改一个全局变量，通常我们会用锁，从读取这个变 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">量的时候就开始锁住这个资源从而阻挡其他线程的修改，修改完毕后才释放锁，这是 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">170 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 15.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">事务机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.9415em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">悲观锁的做法。相对应的有一种乐观锁，乐观锁假定其他用户企图修改你正在修改的 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.9373em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">对象的概率很小，直到提交变更的时候才加锁，读取和修改的情况都不加锁。一般情 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:5.9058em;"><span class="stl_17 stl_18 stl_416" style="word-spacing:0.0869em;">况下，不同客户端会访问修改不同的键值对，因此一般 </span><span class="stl_10 stl_11 stl_416" style="word-spacing:0.0869em;">check </span><span class="stl_17 stl_18 stl_416" style="word-spacing:0.0869em;">一次就可以 </span><span class="stl_10 stl_11 stl_416" style="word-spacing:0.0869em;">set </span><span class="stl_17 stl_18 stl_416" style="word-spacing:0.0869em;">了，而 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:5.9058em;"><span class="stl_17 stl_18 stl_1412" style="word-spacing:0.094em;">不需要重复 </span><span class="stl_10 stl_11 stl_1412" style="word-spacing:0.094em;">check </span><span class="stl_17 stl_18 stl_1412" style="word-spacing:0.094em;">多次。 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:7.5658em;"><span class="stl_10 stl_11 stl_1413" style="word-spacing:0.0998em;">redis </span><span class="stl_17 stl_18 stl_1413" style="word-spacing:0.0998em;">借助 </span><span class="stl_10 stl_11 stl_1413" style="word-spacing:0.0998em;">WATCH/MULTI </span><span class="stl_17 stl_18 stl_1413" style="word-spacing:0.0998em;">命令实现的就是乐观锁，来看一个例子： &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.5658em;"><span class="stl_10 stl_11 stl_331">http://stackoverﬂow.com/questions/10750626/transactions-and-watch-statement- &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">in-redis &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9247em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 16 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6856em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1249em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1249em;">与 </span><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1249em;">lua </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1249em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.4168em; left:7.5658em;"><span class="stl_17 stl_18 stl_1414" style="word-spacing:0.092em;">这篇文章，主要是讲 </span><span class="stl_10 stl_11 stl_1414" style="word-spacing:0.092em;">redis </span><span class="stl_17 stl_18 stl_1414" style="word-spacing:0.092em;">和 </span><span class="stl_10 stl_11 stl_1414" style="word-spacing:0.092em;">lua </span><span class="stl_17 stl_18 stl_1414" style="word-spacing:0.092em;">是如何协同工作的以及 </span><span class="stl_10 stl_11 stl_1414" style="word-spacing:0.092em;">redis </span><span class="stl_17 stl_18 stl_1414" style="word-spacing:0.092em;">如何管理 </span><span class="stl_10 stl_11 stl_1414" style="word-spacing:0.092em;">lua </span><span class="stl_17 stl_18 stl_1414" style="word-spacing:0.092em;">脚 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6357em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">本。 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.7416em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 23.7416em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">6.1 lua &nbsp;</span></div>
					<div class="stl_01" style="top: 25.986em; left:7.5658em;"><span class="stl_10 stl_11 stl_485" style="word-spacing:0.0889em;">lua </span><span class="stl_17 stl_18 stl_485" style="word-spacing:0.0889em;">以可嵌入，轻量，高效，提升静态语言的灵活性，有了 </span><span class="stl_10 stl_11 stl_485" style="word-spacing:0.0889em;">lua</span><span class="stl_17 stl_18 stl_485" style="word-spacing:0.0889em;">，方便对程序进行 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.2048em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">改动或拓展，减少编译的次数，这在游戏开发中特别常见。 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.976em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">举一个在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">c </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">语言中调用 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">脚本的例子： &nbsp;</span></div>
					<div class="stl_01" style="top: 32.466em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.4626em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.466em; left:6.4282em;"><span class="stl_58 stl_59 stl_454" style="word-spacing:-0.2963em;">/ </span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.2963em;">这 是 </span><span class="stl_58 stl_59 stl_454" style="word-spacing:-0.2963em;">lua </span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.2963em;">所 需 的 三 个 头 文 件 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.4626em; left:6.4282em;"><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.3083em;">/ </span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3083em;">当 然， 你 需 要 链 接 到 正 确 的 </span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.3083em;">l i b &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4527em; left:5.9508em;"><span class="stl_15 stl_16 stl_1040" style="word-spacing:0.39em;">extern </span><span class="stl_10 stl_11 stl_1040" style="word-spacing:0.39em;">”C” &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4535em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 36.4502em; left:7.8017em;"><span class="stl_10 stl_11 stl_07">#</span></div>
					<div class="stl_01" style="top: 37.446em; left:7.8017em;"><span class="stl_10 stl_11 stl_07">#</span></div>
					<div class="stl_01" style="top: 38.4427em; left:7.8017em;"><span class="stl_10 stl_11 stl_07">#</span></div>
					<div class="stl_01" style="top: 36.4502em; left:8.509em;"><span class="stl_10 stl_11 stl_1014" style="word-spacing:-0.0244em;">include ” lua</span><span class="stl_10 stl_11 stl_1014" style="word-spacing:-0.2242em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1014" style="word-spacing:-0.3192em;">&nbsp;h” &nbsp;</span></div>
					<div class="stl_01" style="top: 37.446em; left:8.509em;"><span class="stl_10 stl_11 stl_74" style="word-spacing:0.2923em;">include ”</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.2907em;">&nbsp;l</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3547em;">&nbsp;a</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3547em;">&nbsp;u</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3537em;">&nbsp;x</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3547em;">&nbsp;l</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3547em;">&nbsp;i</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3547em;">&nbsp;b</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.1927em;">&nbsp;.</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3247em;">&nbsp;h” &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4427em; left:8.509em;"><span class="stl_10 stl_11 stl_74" style="word-spacing:0.2923em;">include ”</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.2787em;">&nbsp;l</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3437em;">&nbsp;u</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3427em;">&nbsp;a</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3427em;">&nbsp;l</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3427em;">&nbsp;i</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3427em;">&nbsp;b</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.1817em;">&nbsp;.</span><span class="stl_10 stl_11 stl_74" style="word-spacing:-0.3247em;">&nbsp;h” &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4385em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 41.426em; left:5.9875em;"><span class="stl_15 stl_16 stl_1196">int</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.3336em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.3336em;">main</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2591em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2078em;">&nbsp;</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:-0.2078em;">int</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.3807em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.3807em;">argc</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.0631em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.392em;">&nbsp;</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.392em;">char</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.282em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.282em;">*argv</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1021em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1981em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1981em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 43.4235em; left:7.9842em;"><span class="stl_10 stl_11 stl_956" style="word-spacing:0.3251em;">lua_State *L</span><span class="stl_10 stl_11 stl_956" style="word-spacing:0.0701em;">&nbsp;=</span><span class="stl_10 stl_11 stl_956" style="word-spacing:-0.0599em;">&nbsp;lua_open ()</span><span class="stl_10 stl_11 stl_956" style="word-spacing:-0.0599em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4207em;"><span class="stl_58 stl_59 stl_806">/</span><span class="stl_58 stl_59 stl_806" style="word-spacing:0.3218em;">&nbsp;</span><span class="stl_17 stl_18 stl_806" style="word-spacing:0.3218em;">此</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2391em;">&nbsp;处</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;记</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2711em;">&nbsp;住</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.1581em;">&nbsp;</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.1581em;">,</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.192em;">&nbsp;</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.192em;">当</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;你</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;使</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;用</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;的</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;是</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.2381em;">5</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.2661em;">&nbsp;.1</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.2102em;">&nbsp;</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2102em;">版</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2391em;">&nbsp;本</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;以</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;上</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;的</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.2381em;">Lua</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">时</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.1583em;">&nbsp;</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.1583em;">,</span><span class="stl_58 stl_59 stl_806" style="word-spacing:-0.192em;">&nbsp;</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.192em;">请</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;修</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;改</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;以</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;下</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;两</span><span class="stl_17 stl_18 stl_806" style="word-spacing:-0.2381em;">&nbsp;句 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:19.1208em;"><span class="stl_58 stl_59 stl_126" style="word-spacing:-0.2479em;">luaL_openlibs (L) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:9.6417em;"><span class="stl_17 stl_18 stl_07">为</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.9725em;"><span class="stl_10 stl_11 stl_1415" style="word-spacing:-0.1993em;">luaopen_base (L) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">71 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">172 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.7892em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 16.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0829em;">LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0821em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.98em;"><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2097em;">luaopen_io (L) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4207em;"><span class="stl_58 stl_59 stl_1006">/</span><span class="stl_58 stl_59 stl_1006" style="word-spacing:-0.0138em;">&nbsp;</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.0138em;">记 住</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.1898em;">&nbsp;</span><span class="stl_58 stl_59 stl_1006" style="word-spacing:-0.1898em;">,</span><span class="stl_58 stl_59 stl_1006" style="word-spacing:-0.2238em;">&nbsp;</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2238em;">当</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">&nbsp;你</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">&nbsp;使</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">&nbsp;用</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">&nbsp;是</span><span class="stl_58 stl_59 stl_1006" style="word-spacing:-0.2698em;">5</span><span class="stl_58 stl_59 stl_1006" style="word-spacing:-0.2978em;">&nbsp;.1</span><span class="stl_58 stl_59 stl_1006" style="word-spacing:-0.2419em;">&nbsp;</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2419em;">版</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2708em;">&nbsp;本</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">&nbsp;以</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">&nbsp;上</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">&nbsp;的</span><span class="stl_58 stl_59 stl_1006" style="word-spacing:-0.2698em;">Lua</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">时</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2708em;">&nbsp;请</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">&nbsp;使</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.2698em;">&nbsp;用</span><span class="stl_17 stl_18 stl_1006" style="word-spacing:-0.254em;">&nbsp;</span><span class="stl_58 stl_59 stl_1006" style="word-spacing:-0.254em;">luaL_dostring &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.6375em;"><span class="stl_58 stl_59 stl_07">(</span></div>
					<div class="stl_01" style="top: 8.7093em; left:10.0485em;"><span class="stl_58 stl_59 stl_420" style="word-spacing:-0.2573em;">L, buf ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:8.015em;"><span class="stl_10 stl_11 stl_1416" style="word-spacing:-0.3171em;">lua_dofile ( ” s c r i p t . lua ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:8.0025em;"><span class="stl_10 stl_11 stl_110" style="word-spacing:-0.239em;">lua_close (L) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:7.9458em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.4235em; left:7.5658em;"><span class="stl_10 stl_11 stl_1063" style="word-spacing:0.2456em;">lua_doﬁle(”script.lua”); </span><span class="stl_17 stl_18 stl_1063" style="word-spacing:0.2456em;">这一句能为我们提供无限的遐想，开发人员可以在 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:5.9058em;"><span class="stl_10 stl_11 stl_1417" style="word-spacing:0.1275em;">script.lua </span><span class="stl_17 stl_18 stl_1417" style="word-spacing:0.1275em;">脚本文件中实现程序逻辑，而不需要重新编译 </span><span class="stl_10 stl_11 stl_1417" style="word-spacing:0.1275em;">main.cpp </span><span class="stl_17 stl_18 stl_1417" style="word-spacing:0.1275em;">文件。在上面 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_445" style="word-spacing:0.0861em;">给出的例子中，</span><span class="stl_10 stl_11 stl_445" style="word-spacing:0.0861em;">c </span><span class="stl_17 stl_18 stl_445" style="word-spacing:0.0861em;">语言执行了 </span><span class="stl_10 stl_11 stl_445" style="word-spacing:0.0861em;">lua </span><span class="stl_17 stl_18 stl_445" style="word-spacing:0.0861em;">脚本。不仅如此，我们也可以将 </span><span class="stl_10 stl_11 stl_445" style="word-spacing:0.0861em;">c </span><span class="stl_17 stl_18 stl_445" style="word-spacing:0.0861em;">函数注册到 </span><span class="stl_10 stl_11 stl_445" style="word-spacing:0.0861em;">lua &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">解释器中，从而在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">脚本中，调用 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">c </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">函数。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">16.2. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">为什么添加</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0827em;">LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0831em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">支持 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">173 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.9932em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 43.9932em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">6.2 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1259em;">为什么添加</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.125em;">&nbsp;</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.125em;">lua</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1248em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1248em;">支持 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.5658em;"><span class="stl_17 stl_18 stl_355" style="word-spacing:0.0945em;">从上所说，</span><span class="stl_10 stl_11 stl_355" style="word-spacing:0.0945em;">lua </span><span class="stl_17 stl_18 stl_355" style="word-spacing:0.0945em;">为静态语言提供更多的灵活性，</span><span class="stl_10 stl_11 stl_355" style="word-spacing:0.0945em;">redis lua </span><span class="stl_17 stl_18 stl_355" style="word-spacing:0.0945em;">脚本出现之前 </span><span class="stl_10 stl_11 stl_355" style="word-spacing:0.0945em;">redis </span><span class="stl_17 stl_18 stl_355" style="word-spacing:0.0945em;">是 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">没有服务器端运算能力的，主要是用来存储，用做缓存，运算是在客户端进行，这里 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">174 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.7892em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 16.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0829em;">LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0821em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:5.9058em;"><span class="stl_17 stl_18 stl_1418">有两个缺点：一、如此会破坏数据的一致性，试想如果两个客户端先后获取（</span><span class="stl_10 stl_11 stl_1418">get</span><span class="stl_17 stl_18 stl_1418">）一 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.084em;">个值，它们分别对键值做不同的修改，然后先后提交结果，最终 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.084em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.084em;">服务器中的结 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.934em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">果肯定不是某一方客户端所预期的。二、浪费了数据传输的网络带宽。 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.5658em;"><span class="stl_10 stl_11 stl_1419" style="word-spacing:0.0847em;">lua </span><span class="stl_17 stl_18 stl_1419" style="word-spacing:0.0847em;">出现之后这一问题得到了充分的解决，非常棒！有了 </span><span class="stl_10 stl_11 stl_1419" style="word-spacing:0.0847em;">lua </span><span class="stl_17 stl_18 stl_1419" style="word-spacing:0.0847em;">的支持，客户端可 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.9223em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">以定义对键值的运算。 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">TODO &nbsp;</span></div>
					<div class="stl_01" style="top: 15.9732em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 15.9732em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">6.3 lua</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.126em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.126em;">环境的初始化 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.216em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">服务器初始化函数 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">scriptingInit() </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">中，初始化了 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">的环境。 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.8118em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 22.381em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 20.8118em; left:7.3351em;"><span class="stl_10 stl_11 stl_07">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">加载了常用的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0834em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0834em;">lua</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">库，方便在</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">lua</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">脚本中调用 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.381em; left:7.3351em;"><span class="stl_10 stl_11 stl_07">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">创建</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0836em;">SHA1-&gt;lua_script</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">哈希表，可见</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">会保存客户端执行过的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0822em;">lua</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6601em; left:7.9808em;"><span class="stl_10 stl_11 stl_1420" style="word-spacing:0.0826em;">SHA1 </span><span class="stl_17 stl_18 stl_1420" style="word-spacing:0.0826em;">是安全散列算法产生的一个固定长度的序列，你可以把它理解为一个键 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6568em; left:7.9808em;"><span class="stl_17 stl_18 stl_56" style="word-spacing:0.0756em;">值。可见 </span><span class="stl_10 stl_11 stl_56" style="word-spacing:0.0756em;">redis </span><span class="stl_17 stl_18 stl_56" style="word-spacing:0.0756em;">服务器会保存客户端执行过的 </span><span class="stl_10 stl_11 stl_56" style="word-spacing:0.0756em;">lua </span><span class="stl_17 stl_18 stl_56" style="word-spacing:0.0756em;">脚本。这在一个 </span><span class="stl_10 stl_11 stl_56" style="word-spacing:0.0756em;">lua </span><span class="stl_17 stl_18 stl_56" style="word-spacing:0.0756em;">脚本需要 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6527em; left:7.9808em;"><span class="stl_17 stl_18 stl_1421" style="word-spacing:0.083em;">被经常执行的时候是非常有用的。试想，客户端只需要给定一个 </span><span class="stl_10 stl_11 stl_1421" style="word-spacing:0.083em;">SHA1 </span><span class="stl_17 stl_18 stl_1421" style="word-spacing:0.083em;">序列就 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6493em; left:7.9808em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">可以执行相应的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">脚本了。事实上，</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">EVLASHA </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">命令就是这么工作的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:6.92em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.3351em;"><span class="stl_10 stl_11 stl_1348">.</span><span class="stl_10 stl_11 stl_1348" style="word-spacing:0.2627em;">&nbsp;</span><span class="stl_17 stl_18 stl_1348" style="word-spacing:0.2627em;">注册</span><span class="stl_17 stl_18 stl_1348" style="word-spacing:0.0855em;">&nbsp;</span><span class="stl_10 stl_11 stl_1348" style="word-spacing:0.0855em;">redis</span><span class="stl_10 stl_11 stl_1348" style="word-spacing:0.0858em;">&nbsp;</span><span class="stl_17 stl_18 stl_1348" style="word-spacing:0.0858em;">的一些处理函数，譬如命令处理函数，日志函数。注册过的函数，可 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.9808em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">以在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">脚本中调用 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">16.3. LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">环境的初始化 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">175 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:6.92em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 7.5035em; left:6.92em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">替换已经加载的某些库的函数 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.5035em; left:7.3351em;"><span class="stl_10 stl_11 stl_1269">.</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.3024em;">&nbsp;</span><span class="stl_17 stl_18 stl_1269" style="word-spacing:0.3024em;">创建虚拟客户端（</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.3024em;">fake</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.1126em;">&nbsp;client</span><span class="stl_17 stl_18 stl_1269" style="word-spacing:0.1126em;">）。和</span><span class="stl_17 stl_18 stl_1269" style="word-spacing:0.1137em;">&nbsp;</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.1137em;">AOF</span><span class="stl_17 stl_18 stl_1269" style="word-spacing:0.1137em;">，</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.1137em;">RDB</span><span class="stl_10 stl_11 stl_1269" style="word-spacing:0.114em;">&nbsp;</span><span class="stl_17 stl_18 stl_1269" style="word-spacing:0.114em;">数据恢复的做法一样，是为了复 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7215em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">用命令处理函数。 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6715em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">重点展开第三、五点。 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.4768em; left:7.5658em;z-index:123; "><span class="stl_10 stl_11 stl_1422" style="word-spacing:0.0373em;">redis </span><span class="stl_17 stl_18 stl_1422" style="word-spacing:0.0373em;">初始化 </span><span class="stl_10 stl_11 stl_1422" style="word-spacing:0.0373em;">lua </span><span class="stl_17 stl_18 stl_1422" style="word-spacing:0.0373em;">环境的时候，注册了两个命令处理函数：</span><span class="stl_10 stl_11 stl_1422" style="word-spacing:0.0373em;">luaRedisCallCommand() &nbsp;</span></div>
					<div class="stl_01" style="top: 12.4735em; left:5.9058em;"><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0786em;">和 </span><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0786em;">luaRedisPCallCommand()</span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0786em;">，经注册后，开发人员可在 </span><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0786em;">lua </span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0786em;">脚本中调用这两个函数， &nbsp;</span></div>
					<div class="stl_01" style="top: 13.4693em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">从而在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">脚本也可以执行 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">命令。 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.0135em; left:5.9483em;"><span class="stl_15 stl_16 stl_504">void</span><span class="stl_15 stl_16 stl_504" style="word-spacing:0.4719em;">&nbsp;</span><span class="stl_10 stl_11 stl_504" style="word-spacing:0.4719em;">s</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1807em;">&nbsp;c</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1797em;">&nbsp;r</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1807em;">&nbsp;i</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1797em;">&nbsp;p</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1807em;">&nbsp;t</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1797em;">&nbsp;i</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1807em;">&nbsp;n</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1797em;">&nbsp;g</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1807em;">&nbsp;I</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1797em;">&nbsp;n</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1807em;">&nbsp;i</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1797em;">&nbsp;t</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.0747em;">&nbsp;(</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.196em;">&nbsp;</span><span class="stl_15 stl_16 stl_504" style="word-spacing:-0.196em;">void</span><span class="stl_15 stl_16 stl_504" style="word-spacing:-0.1956em;">&nbsp;</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1956em;">)</span><span class="stl_10 stl_11 stl_504" style="word-spacing:-0.1956em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.0143em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 19.0126em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.0085em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.0143em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 19.0126em; left:8.4207em;"><span class="stl_58 stl_59 stl_271">/</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.2298em;">&nbsp;</span><span class="stl_17 stl_18 stl_271" style="word-spacing:0.2298em;">向</span><span class="stl_17 stl_18 stl_271" style="word-spacing:0.2937em;">&nbsp;</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.2937em;">lua</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.0362em;">&nbsp;</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.0362em;">解 释</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;器</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;注</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.329em;">&nbsp;册</span><span class="stl_17 stl_18 stl_271" style="word-spacing:0.3186em;">&nbsp;</span><span class="stl_58 stl_59 stl_271" style="word-spacing:0.3186em;">redis</span><span class="stl_58 stl_59 stl_271" style="word-spacing:-0.0119em;">&nbsp;</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.0119em;">的 数</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;据</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;或</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.33em;">&nbsp;者</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.329em;">&nbsp;变</span><span class="stl_17 stl_18 stl_271" style="word-spacing:-0.329em;">&nbsp;量 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.0085em; left:8.4207em;"><span class="stl_58 stl_59 stl_1043" style="word-spacing:0.3611em;">* Register</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:0.4326em;">&nbsp;the redis</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:0.3441em;">&nbsp;commands t</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:-0.2709em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:-0.2699em;">&nbsp;b</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:-0.2709em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:-0.2699em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:0.3981em;">&nbsp;and f</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:-0.2409em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:-0.2409em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:-0.2409em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:-0.2409em;">&nbsp;d</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:-0.2419em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1043" style="word-spacing:0.4191em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.0035em; left:7.9767em;"><span class="stl_10 stl_11 stl_364" style="word-spacing:-0.218em;">lua_newtable ( lua ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9976em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.9935em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.9976em; left:8.4207em;"><span class="stl_58 stl_59 stl_1157">/</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.061em;">&nbsp;</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.061em;">注 册</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:0.3089em;">&nbsp;</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:0.3089em;">redis</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.2454em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.2104em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.3564em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.3574em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.3574em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:0.3438em;">&nbsp;</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:0.3438em;">函</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3074em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3074em;">&nbsp;命</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;令</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;处</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;理</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;函</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.9935em; left:8.4207em;"><span class="stl_58 stl_59 stl_1329" style="word-spacing:0.295em;">* redis</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.217em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.183em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.328em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.329em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.328em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:0.33em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.9885em; left:7.995em;"><span class="stl_10 stl_11 stl_606" style="word-spacing:-0.253em;">lua_pushstring ( lua , ” c a l l ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.9843em; left:7.9917em;"><span class="stl_10 stl_11 stl_585" style="word-spacing:-0.1899em;">lua_pushcfunction ( lua , luaRedisCallCommand ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.981em; left:8.0083em;"><span class="stl_10 stl_11 stl_1423" style="word-spacing:-0.2713em;">lua_settable ( lua , </span><span class="stl_107 stl_108 stl_1423" style="word-spacing:-0.2713em;">−</span><span class="stl_10 stl_11 stl_1423" style="word-spacing:-0.2713em;">3) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.9751em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.971em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.9751em; left:8.4207em;"><span class="stl_58 stl_59 stl_1157">/</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.061em;">&nbsp;</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.061em;">注 册</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:0.3089em;">&nbsp;</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:0.3089em;">redis</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.2454em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.2204em;">&nbsp;p</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.3674em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.3674em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.3664em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:0.3328em;">&nbsp;</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:0.3328em;">函</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3074em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3074em;">&nbsp;命</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;令</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;处</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;理</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;函</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.971em; left:8.4207em;"><span class="stl_58 stl_59 stl_1329" style="word-spacing:0.295em;">* redis</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.217em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.198em;">&nbsp;p</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.345em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.344em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.344em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:-0.345em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1329" style="word-spacing:0.315em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.966em; left:7.995em;"><span class="stl_10 stl_11 stl_606" style="word-spacing:-0.268em;">lua_pushstring ( lua , ” p c a l l ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.9618em; left:7.9917em;"><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.1838em;">lua_pushcfunction ( lua , luaRedisPCallCommand ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.9585em; left:8.0083em;"><span class="stl_10 stl_11 stl_1423" style="word-spacing:-0.2713em;">lua_settable ( lua , </span><span class="stl_107 stl_108 stl_1423" style="word-spacing:-0.2713em;">−</span><span class="stl_10 stl_11 stl_1423" style="word-spacing:-0.2713em;">3) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.9543em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 33.9543em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 34.951em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 36.5376em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">以 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0831em;">luaRedisCallCommand() </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">为例，当它被回调的时候会完成： &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4885em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 40.2726em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 42.056em; left:6.92em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 43.8402em; left:6.92em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 45.6243em; left:6.92em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 47.4085em; left:6.92em;"><span class="stl_10 stl_11 stl_07">6</span></div>
					<div class="stl_01" style="top: 38.4885em; left:7.3351em;"><span class="stl_10 stl_11 stl_07">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">检测参数的有效性，并通过</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">lua api</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">提取参数 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.2726em; left:7.3351em;"><span class="stl_10 stl_11 stl_49">.</span><span class="stl_10 stl_11 stl_49" style="word-spacing:0.2544em;">&nbsp;</span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.2544em;">向虚拟客户端</span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0881em;">&nbsp;</span><span class="stl_10 stl_11 stl_49" style="word-spacing:0.0881em;">server.lua_client</span><span class="stl_10 stl_11 stl_49" style="word-spacing:0.0869em;">&nbsp;</span><span class="stl_17 stl_18 stl_49" style="word-spacing:0.0869em;">填充参数 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.056em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">查找命令 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.8402em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">脏命令检测（在下面详细展开） &nbsp;</span></div>
					<div class="stl_01" style="top: 45.6243em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">执行命令 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">处理命令处理结果 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">176 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.7892em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 16.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0829em;">LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0821em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.9393em; left:7.5658em;"><span class="stl_10 stl_11 stl_1424" style="word-spacing:0.0793em;">fake client </span><span class="stl_17 stl_18 stl_1424" style="word-spacing:0.0793em;">的好处又一次体现出来了。在 </span><span class="stl_10 stl_11 stl_1424" style="word-spacing:0.0793em;">lua </span><span class="stl_17 stl_18 stl_1424" style="word-spacing:0.0793em;">脚本处理期间，</span><span class="stl_10 stl_11 stl_1424" style="word-spacing:0.0793em;">redis </span><span class="stl_17 stl_18 stl_1424" style="word-spacing:0.0793em;">服务器只服务 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.9351em; left:5.9058em;"><span class="stl_17 stl_18 stl_537" style="word-spacing:0.0947em;">于 </span><span class="stl_10 stl_11 stl_537" style="word-spacing:0.0947em;">fake client. &nbsp;</span></div>
					<div class="stl_01" style="top: 15.1949em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 15.1949em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">6.4 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.125em;">&nbsp;lua</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1257em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1257em;">脚本的执行过程 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.4376em; left:7.5658em;"><span class="stl_17 stl_18 stl_516" style="word-spacing:0.0348em;">我们依旧从客户端发送一个 </span><span class="stl_10 stl_11 stl_516" style="word-spacing:0.0348em;">lua </span><span class="stl_17 stl_18 stl_516" style="word-spacing:0.0348em;">相关命令开始。假定用户发送了 </span><span class="stl_10 stl_11 stl_516" style="word-spacing:0.0348em;">EVAL </span><span class="stl_17 stl_18 stl_516" style="word-spacing:0.0348em;">命令如下： &nbsp;</span></div>
					<div class="stl_01" style="top: 19.7901em; left:6.0133em;"><span class="stl_10 stl_11 stl_819" style="word-spacing:0.4908em;">eval 1</span><span class="stl_10 stl_11 stl_819" style="word-spacing:0.4248em;">&nbsp;”</span><span class="stl_10 stl_11 stl_819" style="word-spacing:-0.0822em;">&nbsp;set</span><span class="stl_10 stl_11 stl_819" style="word-spacing:-0.0952em;">&nbsp;␣KEY[</span><span class="stl_10 stl_11 stl_819" style="word-spacing:-0.1032em;">&nbsp;1</span><span class="stl_10 stl_11 stl_819" style="word-spacing:-0.1032em;">&nbsp;]</span><span class="stl_10 stl_11 stl_819" style="word-spacing:-0.0532em;">&nbsp;␣ARGV[</span><span class="stl_10 stl_11 stl_819" style="word-spacing:-0.1032em;">&nbsp;1</span><span class="stl_10 stl_11 stl_819" style="word-spacing:-0.1032em;">&nbsp;]</span><span class="stl_10 stl_11 stl_819" style="word-spacing:-0.0392em;">&nbsp;”</span><span class="stl_10 stl_11 stl_819" style="word-spacing:0.4898em;">&nbsp;views 18000</span><span class="stl_10 stl_11 stl_819" style="word-spacing:0.2658em;">&nbsp;TODO</span><span class="stl_10 stl_11 stl_819" style="word-spacing:0.2816em;">&nbsp;</span><span class="stl_17 stl_18 stl_819" style="word-spacing:0.2816em;">参</span><span class="stl_17 stl_18 stl_819" style="word-spacing:-0.0902em;">&nbsp;数</span><span class="stl_17 stl_18 stl_819" style="word-spacing:-0.0892em;">&nbsp;讲</span><span class="stl_17 stl_18 stl_819" style="word-spacing:-0.0892em;">&nbsp;解 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.146em; left:7.5658em;"><span class="stl_17 stl_18 stl_981" style="word-spacing:0.0803em;">此命令的意图是，将 </span><span class="stl_10 stl_11 stl_981" style="word-spacing:0.0803em;">views </span><span class="stl_17 stl_18 stl_981" style="word-spacing:0.0803em;">的值设置为 </span><span class="stl_10 stl_11 stl_981" style="word-spacing:0.0803em;">18000</span><span class="stl_17 stl_18 stl_981" style="word-spacing:0.0803em;">。</span><span class="stl_10 stl_11 stl_981" style="word-spacing:0.0803em;">redis </span><span class="stl_17 stl_18 stl_981" style="word-spacing:0.0803em;">服务器收到此命令后，会调 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.1426em; left:5.9058em;"><span class="stl_17 stl_18 stl_903" style="word-spacing:0.0869em;">用对应的命令处理函数 </span><span class="stl_10 stl_11 stl_903" style="word-spacing:0.0869em;">evalCommand() </span><span class="stl_17 stl_18 stl_903" style="word-spacing:0.0869em;">如下： &nbsp;</span></div>
					<div class="stl_01" style="top: 24.4893em; left:5.9483em;"><span class="stl_15 stl_16 stl_1425">void</span><span class="stl_15 stl_16 stl_1425" style="word-spacing:0.3375em;">&nbsp;</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:0.3375em;">evalCommand(</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.0825em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1895em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1885em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1885em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1885em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1895em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1885em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1885em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1885em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1895em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1885em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:0.4615em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1605em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1425" style="word-spacing:-0.1605em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.491em; left:7.9508em;"><span class="stl_10 stl_11 stl_187" style="word-spacing:-0.1731em;">evalGenericCommand ( c , 0 ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4868em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.4743em; left:5.9483em;"><span class="stl_15 stl_16 stl_1426">void</span><span class="stl_15 stl_16 stl_1426" style="word-spacing:0.3087em;">&nbsp;</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:0.3087em;">evalGenericCommand</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2384em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.1454em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2524em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2524em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2515em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2524em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:0.3985em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.1424em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:0.4524em;">&nbsp;</span><span class="stl_15 stl_16 stl_1426" style="word-spacing:0.4524em;">int</span><span class="stl_15 stl_16 stl_1426" style="word-spacing:0.4165em;">&nbsp;</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:0.4165em;">evalsha</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.1764em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.1764em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.476em; left:7.9842em;"><span class="stl_10 stl_11 stl_844" style="word-spacing:-0.0269em;">lua_State * lua</span><span class="stl_10 stl_11 stl_844" style="word-spacing:0.1411em;">&nbsp;=</span><span class="stl_10 stl_11 stl_844" style="word-spacing:-0.0139em;">&nbsp;server .</span><span class="stl_10 stl_11 stl_844" style="word-spacing:-0.2099em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_844" style="word-spacing:-0.2099em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4668em; left:7.9342em;"><span class="stl_15 stl_16 stl_166">char</span><span class="stl_15 stl_16 stl_166" style="word-spacing:0.34em;">&nbsp;</span><span class="stl_10 stl_11 stl_166" style="word-spacing:0.34em;">funcname</span><span class="stl_10 stl_11 stl_166" style="word-spacing:-0.1092em;">&nbsp;[</span><span class="stl_10 stl_11 stl_166" style="word-spacing:-0.1762em;">&nbsp;4</span><span class="stl_10 stl_11 stl_166" style="word-spacing:-0.1752em;">&nbsp;3</span><span class="stl_10 stl_11 stl_166" style="word-spacing:-0.1762em;">&nbsp;]</span><span class="stl_10 stl_11 stl_166" style="word-spacing:-0.1762em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4635em; left:7.9467em;"><span class="stl_15 stl_16 stl_504" style="word-spacing:0.3623em;">long long</span><span class="stl_15 stl_16 stl_504" style="word-spacing:0.3495em;">&nbsp;</span><span class="stl_10 stl_11 stl_504" style="word-spacing:0.3495em;">numkeys</span><span class="stl_10 stl_11 stl_504" style="word-spacing:0.3495em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4593em; left:7.98em;"><span class="stl_15 stl_16 stl_1299">int</span><span class="stl_15 stl_16 stl_1299" style="word-spacing:0.3317em;">&nbsp;</span><span class="stl_10 stl_11 stl_1299" style="word-spacing:0.3317em;">delhook</span><span class="stl_10 stl_11 stl_1299" style="word-spacing:0.1438em;">&nbsp;= 0</span><span class="stl_10 stl_11 stl_1299" style="word-spacing:-0.2612em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1299" style="word-spacing:0.3768em;">&nbsp;err</span><span class="stl_10 stl_11 stl_1299" style="word-spacing:0.3768em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4593em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.4593em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">随 机</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;数</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;的</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;种</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;子，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;在</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;产</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;生</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;希</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;值</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;的</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;时</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;候</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;会</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;用</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;到 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4535em; left:7.9983em;"><span class="stl_10 stl_11 stl_1288" style="word-spacing:-0.2239em;">redisSrand48 (0) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.4476em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.4476em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">关</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;于</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;脏</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;标</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;记 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4427em; left:8.0175em;"><span class="stl_10 stl_11 stl_932" style="word-spacing:-0.1349em;">server .</span><span class="stl_10 stl_11 stl_932" style="word-spacing:-0.2039em;">&nbsp;lua_random_dirty</span><span class="stl_10 stl_11 stl_932" style="word-spacing:0.1471em;">&nbsp;=</span><span class="stl_10 stl_11 stl_932" style="word-spacing:0.2111em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4385em; left:8.0175em;"><span class="stl_10 stl_11 stl_308" style="word-spacing:-0.1882em;">server .</span><span class="stl_10 stl_11 stl_308" style="word-spacing:-0.2202em;">&nbsp;lua_write_dirty</span><span class="stl_10 stl_11 stl_308" style="word-spacing:0.1308em;">&nbsp;=</span><span class="stl_10 stl_11 stl_308" style="word-spacing:0.1578em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.4326em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">检</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;查</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;效</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;性 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:8.045em;z-index:572; "><span class="stl_15 stl_16 stl_596" style="word-spacing:-0.2029em;">i f</span><span class="stl_15 stl_16 stl_596" style="word-spacing:0.5035em;">&nbsp;</span><span class="stl_10 stl_11 stl_596" style="word-spacing:0.5035em;">(</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.2019em;">&nbsp;getLongLongFromObjectOrReply</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.2009em;">&nbsp;(</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.2219em;">&nbsp;c</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.1139em;">&nbsp;,</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.1139em;">&nbsp;c</span><span class="stl_107 stl_108 stl_596" style="word-spacing:-0.1139em;">−</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.1659em;">&gt;argv</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.1559em;">&nbsp;[2]</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.1249em;">&nbsp;,&amp;</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.2119em;">&nbsp;numkeys</span><span class="stl_10 stl_11 stl_596" style="word-spacing:-0.2119em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:9.5em;"><span class="stl_10 stl_11 stl_1177" style="word-spacing:0.5898em;">NULL) !=</span><span class="stl_10 stl_11 stl_1177" style="word-spacing:0.4168em;">&nbsp;REDIS_OK) &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4152em; left:9.9383em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:8.045em;z-index:633; "><span class="stl_15 stl_16 stl_1273" style="word-spacing:-0.1775em;">i f</span><span class="stl_15 stl_16 stl_1273" style="word-spacing:0.5289em;">&nbsp;</span><span class="stl_10 stl_11 stl_1273" style="word-spacing:0.5289em;">(numkeys</span><span class="stl_10 stl_11 stl_1273" style="word-spacing:0.1725em;">&nbsp;&gt;</span><span class="stl_10 stl_11 stl_1273" style="word-spacing:0.2935em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1273" style="word-spacing:0.2935em;">&nbsp;c</span><span class="stl_107 stl_108 stl_1273" style="word-spacing:0.2935em;">−</span><span class="stl_10 stl_11 stl_1273" style="word-spacing:-0.1965em;">&gt;argc</span><span class="stl_10 stl_11 stl_1273" style="word-spacing:0.2407em;">&nbsp;</span><span class="stl_107 stl_108 stl_1273" style="word-spacing:0.2407em;">−</span><span class="stl_107 stl_108 stl_1273" style="word-spacing:0.2918em;">&nbsp;</span><span class="stl_10 stl_11 stl_1273" style="word-spacing:0.2918em;">3)</span><span class="stl_10 stl_11 stl_1273" style="word-spacing:-0.1445em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1273" style="word-spacing:-0.1445em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:9.9667em;"><span class="stl_10 stl_11 stl_1427" style="word-spacing:-0.2343em;">addReplyError ( c , ”Number␣ of ␣ keys ␣can ’ t ␣be␣ greater ␣than &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:11.5925em;"><span class="stl_10 stl_11 stl_07">␣</span></div>
					<div class="stl_01" style="top: 47.4085em; left:12.0799em;"><span class="stl_10 stl_11 stl_1051" style="word-spacing:-0.2122em;">number␣ of ␣ args ” ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">16.4. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">&nbsp;LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">脚本的执行过程 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">177 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:9.9383em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7093em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4207em;"><span class="stl_58 stl_59 stl_1428">/</span><span class="stl_58 stl_59 stl_1428" style="word-spacing:0.4118em;">&nbsp;</span><span class="stl_17 stl_18 stl_1428" style="word-spacing:0.4118em;">函</span><span class="stl_17 stl_18 stl_1428" style="word-spacing:-0.149em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1428" style="word-spacing:-0.148em;">&nbsp;名</span><span class="stl_17 stl_18 stl_1428" style="word-spacing:-0.148em;">&nbsp;以</span><span class="stl_17 stl_18 stl_1428" style="word-spacing:0.4028em;">&nbsp;</span><span class="stl_58 stl_59 stl_1428" style="word-spacing:0.4028em;">f_</span><span class="stl_58 stl_59 stl_1428" style="word-spacing:0.4028em;">&nbsp;</span><span class="stl_17 stl_18 stl_1428" style="word-spacing:0.4028em;">开</span><span class="stl_17 stl_18 stl_1428" style="word-spacing:0.4028em;">&nbsp;头 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.9542em;"><span class="stl_10 stl_11 stl_120" style="word-spacing:-0.1313em;">funcname [</span><span class="stl_10 stl_11 stl_120" style="word-spacing:-0.1983em;">&nbsp;0</span><span class="stl_10 stl_11 stl_120" style="word-spacing:-0.1983em;">&nbsp;]</span><span class="stl_10 stl_11 stl_120" style="word-spacing:0.3272em;">&nbsp;= ’</span><span class="stl_10 stl_11 stl_120" style="word-spacing:-0.1303em;">&nbsp;f</span><span class="stl_10 stl_11 stl_120" style="word-spacing:-0.0223em;">&nbsp;’</span><span class="stl_10 stl_11 stl_120" style="word-spacing:-0.0223em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:7.9542em;"><span class="stl_10 stl_11 stl_1429" style="word-spacing:-0.1397em;">funcname [</span><span class="stl_10 stl_11 stl_1429" style="word-spacing:-0.2067em;">&nbsp;1</span><span class="stl_10 stl_11 stl_1429" style="word-spacing:-0.2067em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1429" style="word-spacing:0.3188em;">&nbsp;= ’_’</span><span class="stl_10 stl_11 stl_1429" style="word-spacing:0.3188em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4207em;"><span class="stl_58 stl_59 stl_403">/</span><span class="stl_58 stl_59 stl_403" style="word-spacing:-0.0479em;">&nbsp;</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.0479em;">如 果</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;没</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;有</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;希</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.2693em;">&nbsp;值，</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.2703em;">&nbsp;需</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;要</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;计</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;算</span><span class="stl_17 stl_18 stl_403" style="word-spacing:0.3213em;">&nbsp;</span><span class="stl_58 stl_59 stl_403" style="word-spacing:0.3213em;">lua</span><span class="stl_58 stl_59 stl_403" style="word-spacing:0.3215em;">&nbsp;</span><span class="stl_17 stl_18 stl_403" style="word-spacing:0.3215em;">脚</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3043em;">&nbsp;本</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;的</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;希</span><span class="stl_17 stl_18 stl_403" style="word-spacing:-0.3033em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:8.045em;"><span class="stl_15 stl_16 stl_787" style="word-spacing:-0.324em;">i f</span><span class="stl_15 stl_16 stl_787" style="word-spacing:0.4547em;">&nbsp;</span><span class="stl_10 stl_11 stl_787" style="word-spacing:0.4547em;">(</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.323em;">&nbsp;!</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.197em;">&nbsp;evalsha</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.27em;">&nbsp;)</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.27em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:10.4132em;z-index:126; "><span class="stl_58 stl_59 stl_204">/</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.3478em;">&nbsp;</span><span class="stl_17 stl_18 stl_204" style="word-spacing:0.3478em;">计</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.2131em;">&nbsp;算</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.2121em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.2121em;">&nbsp;希</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.178em;">&nbsp;值，</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.1791em;">&nbsp;会</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.2121em;">&nbsp;放</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.2121em;">&nbsp;入</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.2121em;">&nbsp;到</span><span class="stl_17 stl_18 stl_204" style="word-spacing:0.2561em;">&nbsp;</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.2561em;">SHA1</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.0126em;">&nbsp;</span><span class="stl_107 stl_108 stl_204" style="word-spacing:0.2561em;">−</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.0126em;">&gt;</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.254em;">&nbsp;lua_script</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.4256em;">&nbsp;</span><span class="stl_17 stl_18 stl_204" style="word-spacing:0.4256em;">哈</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.2121em;">&nbsp;希</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.2121em;">&nbsp;表</span><span class="stl_17 stl_18 stl_204" style="word-spacing:-0.2121em;">&nbsp;中 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:10.4133em;z-index:164; "><span class="stl_58 stl_59 stl_1367" style="word-spacing:0.3121em;">/ c</span><span class="stl_107 stl_108 stl_1367" style="word-spacing:0.3121em;">−</span><span class="stl_58 stl_59 stl_1367" style="word-spacing:0.3121em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_1367" style="word-spacing:0.3121em;">−</span><span class="stl_58 stl_59 stl_1367" style="word-spacing:0.3121em;">&gt;</span><span class="stl_58 stl_59 stl_1367" style="word-spacing:-0.2199em;">&nbsp;ptr</span><span class="stl_58 stl_59 stl_1367" style="word-spacing:0.4404em;">&nbsp;</span><span class="stl_17 stl_18 stl_1367" style="word-spacing:0.4404em;">是</span><span class="stl_17 stl_18 stl_1367" style="word-spacing:-0.1949em;">&nbsp;用</span><span class="stl_17 stl_18 stl_1367" style="word-spacing:-0.1939em;">&nbsp;户</span><span class="stl_17 stl_18 stl_1367" style="word-spacing:-0.1939em;">&nbsp;指</span><span class="stl_17 stl_18 stl_1367" style="word-spacing:-0.1939em;">&nbsp;定</span><span class="stl_17 stl_18 stl_1367" style="word-spacing:-0.1939em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1367" style="word-spacing:0.4311em;">&nbsp;</span><span class="stl_58 stl_59 stl_1367" style="word-spacing:0.4311em;">lua</span><span class="stl_58 stl_59 stl_1367" style="word-spacing:0.4309em;">&nbsp;</span><span class="stl_17 stl_18 stl_1367" style="word-spacing:0.4309em;">脚</span><span class="stl_17 stl_18 stl_1367" style="word-spacing:0.4309em;">&nbsp;本 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:10.4133em;z-index:181; "><span class="stl_58 stl_59 stl_1430" style="word-spacing:0.3409em;">/ sha1hex</span><span class="stl_58 stl_59 stl_1430" style="word-spacing:-0.1911em;">&nbsp;()</span><span class="stl_58 stl_59 stl_1430" style="word-spacing:0.4059em;">&nbsp;</span><span class="stl_17 stl_18 stl_1430" style="word-spacing:0.4059em;">产</span><span class="stl_17 stl_18 stl_1430" style="word-spacing:-0.2211em;">&nbsp;生</span><span class="stl_17 stl_18 stl_1430" style="word-spacing:-0.2211em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1430" style="word-spacing:-0.2211em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_1430" style="word-spacing:-0.2211em;">&nbsp;希</span><span class="stl_17 stl_18 stl_1430" style="word-spacing:-0.2211em;">&nbsp;值</span><span class="stl_17 stl_18 stl_1430" style="word-spacing:-0.2211em;">&nbsp;存</span><span class="stl_17 stl_18 stl_1430" style="word-spacing:-0.2211em;">&nbsp;在</span><span class="stl_17 stl_18 stl_1430" style="word-spacing:0.3435em;">&nbsp;</span><span class="stl_58 stl_59 stl_1430" style="word-spacing:0.3435em;">funcname</span><span class="stl_58 stl_59 stl_1430" style="word-spacing:0.344em;">&nbsp;</span><span class="stl_17 stl_18 stl_1430" style="word-spacing:0.3435em;">中 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:9.9658em;z-index:241; "><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1613em;">sha1hex ( funcname+2,c</span><span class="stl_107 stl_108 stl_611" style="word-spacing:-0.1613em;">−</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1613em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_611" style="word-spacing:-0.1613em;">−</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1613em;">&gt;ptr , sdslen ( c</span><span class="stl_107 stl_108 stl_611" style="word-spacing:-0.1613em;">−</span><span class="stl_10 stl_11 stl_611" style="word-spacing:-0.1613em;">&gt;argv &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:11.5917em;"><span class="stl_10 stl_11 stl_07">[</span></div>
					<div class="stl_01" style="top: 18.671em; left:11.8623em;"><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.2248em;">1]</span><span class="stl_107 stl_108 stl_789" style="word-spacing:-0.2248em;">−</span><span class="stl_10 stl_11 stl_789" style="word-spacing:-0.2248em;">&gt; ptr ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 19.6618em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:10.4133em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;户</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;自</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;己</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;指</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;定</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;了</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;希</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:9.9725em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.3991em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">j</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.651em; left:9.9267em;z-index:291; "><span class="stl_15 stl_16 stl_309">char</span><span class="stl_15 stl_16 stl_309" style="word-spacing:0.3122em;">&nbsp;</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.3122em;">*sha</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.2181em;">&nbsp;=</span><span class="stl_10 stl_11 stl_309" style="word-spacing:0.2181em;">&nbsp;c</span><span class="stl_107 stl_108 stl_309" style="word-spacing:0.2181em;">−</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.0359em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_309" style="word-spacing:-0.0359em;">−</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.0359em;">&gt; ptr</span><span class="stl_10 stl_11 stl_309" style="word-spacing:-0.0359em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:9.9733em;"><span class="stl_15 stl_16 stl_1431">for</span><span class="stl_15 stl_16 stl_1431" style="word-spacing:0.3959em;">&nbsp;</span><span class="stl_10 stl_11 stl_1431" style="word-spacing:0.3959em;">(</span><span class="stl_10 stl_11 stl_1431" style="word-spacing:-0.158em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1431" style="word-spacing:0.245em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_1431" style="word-spacing:0.478em;">&nbsp;j</span><span class="stl_10 stl_11 stl_1431" style="word-spacing:0.218em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_1431" style="word-spacing:0.261em;">&nbsp;40;</span><span class="stl_10 stl_11 stl_1431" style="word-spacing:0.468em;">&nbsp;j++) &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:11.9392em;"><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1982em;">funcname [</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1182em;">&nbsp;j</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.2182em;">&nbsp;+2]</span><span class="stl_10 stl_11 stl_80" style="word-spacing:0.1458em;">&nbsp;=</span><span class="stl_10 stl_11 stl_80" style="word-spacing:0.2068em;">&nbsp;tolower</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1982em;">&nbsp;(</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.2332em;">&nbsp;sha</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1782em;">&nbsp;[</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1182em;">&nbsp;j</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.1012em;">&nbsp;]</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.2482em;">&nbsp;)</span><span class="stl_10 stl_11 stl_80" style="word-spacing:-0.2482em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.9467em;"><span class="stl_10 stl_11 stl_743" style="word-spacing:-0.148em;">funcname [</span><span class="stl_10 stl_11 stl_743" style="word-spacing:-0.215em;">&nbsp;4</span><span class="stl_10 stl_11 stl_743" style="word-spacing:-0.216em;">&nbsp;2</span><span class="stl_10 stl_11 stl_743" style="word-spacing:-0.215em;">&nbsp;]</span><span class="stl_10 stl_11 stl_743" style="word-spacing:0.296em;">&nbsp;=</span><span class="stl_10 stl_11 stl_743" style="word-spacing:0.342em;">&nbsp;’</span><span class="stl_10 stl_11 stl_743" style="word-spacing:-0.21em;">&nbsp;\0</span><span class="stl_10 stl_11 stl_743" style="word-spacing:-0.102em;">&nbsp;’</span><span class="stl_10 stl_11 stl_743" style="word-spacing:-0.102em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6368em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.6276em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">将</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;错</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;误</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;处</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;理</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;栈 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:8.4207em;"><span class="stl_58 stl_59 stl_865" style="word-spacing:0.267em;">/ lua_getglobal</span><span class="stl_58 stl_59 stl_865" style="word-spacing:-0.265em;">&nbsp;()</span><span class="stl_58 stl_59 stl_865" style="word-spacing:-0.0497em;">&nbsp;</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.0497em;">会 将</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;读</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;取</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;指</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;定</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;的</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;全</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;局</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;变</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.304em;">&nbsp;量，</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.305em;">&nbsp;且</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;将</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.337em;">&nbsp;其</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;入</span><span class="stl_17 stl_18 stl_865" style="word-spacing:-0.338em;">&nbsp;栈 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:8.0033em;"><span class="stl_10 stl_11 stl_363" style="word-spacing:-0.2045em;">lua_getglobal (</span><span class="stl_10 stl_11 stl_363" style="word-spacing:-0.2375em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_363" style="word-spacing:-0.0885em;">&nbsp;,</span><span class="stl_10 stl_11 stl_363" style="word-spacing:0.3885em;">&nbsp;”__redis__err__handler”</span><span class="stl_10 stl_11 stl_363" style="word-spacing:-0.2665em;">&nbsp;)</span><span class="stl_10 stl_11 stl_363" style="word-spacing:-0.2665em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:8.4207em;"><span class="stl_58 stl_59 stl_759" style="word-spacing:0.242em;">* Try</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.302em;">&nbsp;to</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.3765em;">&nbsp;lookup the</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.3em;">&nbsp;Lua function</span><span class="stl_58 stl_59 stl_759" style="word-spacing:0.335em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:8.4207em;"><span class="stl_58 stl_59 stl_827">/</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.3432em;">&nbsp;</span><span class="stl_17 stl_18 stl_827" style="word-spacing:0.3432em;">在</span><span class="stl_17 stl_18 stl_827" style="word-spacing:0.4071em;">&nbsp;</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.4071em;">lua</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.4082em;">&nbsp;</span><span class="stl_17 stl_18 stl_827" style="word-spacing:0.4082em;">中</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2176em;">&nbsp;查</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;找</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;是</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2156em;">&nbsp;否</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;注</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;册</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;了</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;此</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;函</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.1836em;">&nbsp;数。</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.1826em;">&nbsp;这</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;一</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;句</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;尝</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;试</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;将</span><span class="stl_17 stl_18 stl_827" style="word-spacing:0.3474em;">&nbsp;</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.3474em;">funcname &nbsp;</span></div>
					<div class="stl_01" style="top: 35.829em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">入 栈 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:8.0033em;"><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.225em;">lua_getglobal (</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.258em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.109em;">&nbsp;,</span><span class="stl_10 stl_11 stl_722" style="word-spacing:0.371em;">&nbsp;funcname</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.285em;">&nbsp;)</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.285em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5943em; left:8.045em;"><span class="stl_15 stl_16 stl_682" style="word-spacing:-0.2309em;">i f</span><span class="stl_15 stl_16 stl_682" style="word-spacing:0.4755em;">&nbsp;</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.4755em;">(</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1489em;">&nbsp;l</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2539em;">&nbsp;u</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2529em;">&nbsp;a</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2539em;">&nbsp;_</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2539em;">&nbsp;i</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2539em;">&nbsp;s</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2529em;">&nbsp;n</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2539em;">&nbsp;i</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2539em;">&nbsp;l</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1479em;">&nbsp;(</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2089em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.1449em;">&nbsp;,</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2553em;">&nbsp;</span><span class="stl_107 stl_108 stl_682" style="word-spacing:-0.1449em;">−</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2553em;">1)</span><span class="stl_10 stl_11 stl_682" style="word-spacing:-0.2249em;">&nbsp;)</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.3481em;">&nbsp;{</span><span class="stl_10 stl_11 stl_682" style="word-spacing:0.3101em;">&nbsp;</span><span class="stl_58 stl_59 stl_682" style="word-spacing:0.3101em;">// funcname</span><span class="stl_58 stl_59 stl_682" style="word-spacing:0.3589em;">&nbsp;</span><span class="stl_17 stl_18 stl_682" style="word-spacing:0.3589em;">在</span><span class="stl_17 stl_18 stl_682" style="word-spacing:0.4169em;">&nbsp;</span><span class="stl_58 stl_59 stl_682" style="word-spacing:0.4169em;">lua</span><span class="stl_58 stl_59 stl_682" style="word-spacing:0.4179em;">&nbsp;</span><span class="stl_17 stl_18 stl_682" style="word-spacing:0.4179em;">中</span><span class="stl_17 stl_18 stl_682" style="word-spacing:-0.2079em;">&nbsp;不</span><span class="stl_17 stl_18 stl_682" style="word-spacing:-0.2069em;">&nbsp;存</span><span class="stl_17 stl_18 stl_682" style="word-spacing:-0.2069em;">&nbsp;在 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.5935em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">将</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6179em;">&nbsp;</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6179em;">n</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.081em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.082em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6196em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6196em;">出</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6196em;">&nbsp;栈 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5885em; left:9.9433em;"><span class="stl_10 stl_11 stl_1432" style="word-spacing:-0.2556em;">lua_pop (</span><span class="stl_10 stl_11 stl_1432" style="word-spacing:-0.2266em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_1432" style="word-spacing:-0.0806em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1432" style="word-spacing:-0.2656em;">&nbsp;1</span><span class="stl_10 stl_11 stl_1432" style="word-spacing:-0.2666em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1432" style="word-spacing:-0.1056em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1432" style="word-spacing:0.3959em;">&nbsp;</span><span class="stl_58 stl_59 stl_1432" style="word-spacing:0.3959em;">/*</span><span class="stl_58 stl_59 stl_1432" style="word-spacing:0.3014em;">&nbsp;remove</span><span class="stl_58 stl_59 stl_1432" style="word-spacing:0.3674em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1432" style="word-spacing:0.4684em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1432" style="word-spacing:-0.2556em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1432" style="word-spacing:-0.2556em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1432" style="word-spacing:0.4124em;">&nbsp;from</span><span class="stl_58 stl_59 stl_1432" style="word-spacing:0.3684em;">&nbsp;the</span><span class="stl_58 stl_59 stl_1432" style="word-spacing:0.4374em;">&nbsp;stack</span><span class="stl_58 stl_59 stl_1432" style="word-spacing:0.3734em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5826em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.5826em; left:10.4132em;"><span class="stl_58 stl_59 stl_827">/</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.3432em;">&nbsp;</span><span class="stl_17 stl_18 stl_827" style="word-spacing:0.3432em;">已</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2176em;">&nbsp;经</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;确</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;定</span><span class="stl_17 stl_18 stl_827" style="word-spacing:0.3482em;">&nbsp;</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.3482em;">funcname</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.3485em;">&nbsp;</span><span class="stl_17 stl_18 stl_827" style="word-spacing:0.3485em;">在</span><span class="stl_17 stl_18 stl_827" style="word-spacing:0.4082em;">&nbsp;</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.4082em;">lua</span><span class="stl_58 stl_59 stl_827" style="word-spacing:0.4082em;">&nbsp;</span><span class="stl_17 stl_18 stl_827" style="word-spacing:0.4082em;">中</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2176em;">&nbsp;没</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;有</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;定</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.1826em;">&nbsp;义，</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.1836em;">&nbsp;需</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;要</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;创</span><span class="stl_17 stl_18 stl_827" style="word-spacing:-0.2166em;">&nbsp;建 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5727em; left:10.0375em;"><span class="stl_15 stl_16 stl_787" style="word-spacing:-0.324em;">i f</span><span class="stl_15 stl_16 stl_787" style="word-spacing:0.3824em;">&nbsp;</span><span class="stl_10 stl_11 stl_787" style="word-spacing:0.3824em;">(</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.27em;">&nbsp;evalsha</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.269em;">&nbsp;)</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.269em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:11.9358em;"><span class="stl_10 stl_11 stl_840" style="word-spacing:-0.2634em;">lua_pop (</span><span class="stl_10 stl_11 stl_840" style="word-spacing:-0.2344em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_840" style="word-spacing:-0.0884em;">&nbsp;,</span><span class="stl_10 stl_11 stl_840" style="word-spacing:-0.2734em;">&nbsp;1</span><span class="stl_10 stl_11 stl_840" style="word-spacing:-0.2744em;">&nbsp;)</span><span class="stl_10 stl_11 stl_840" style="word-spacing:-0.1134em;">&nbsp;;</span><span class="stl_10 stl_11 stl_840" style="word-spacing:0.3881em;">&nbsp;</span><span class="stl_58 stl_59 stl_840" style="word-spacing:0.3881em;">/*</span><span class="stl_58 stl_59 stl_840" style="word-spacing:0.2936em;">&nbsp;remove</span><span class="stl_58 stl_59 stl_840" style="word-spacing:0.3596em;">&nbsp;the</span><span class="stl_58 stl_59 stl_840" style="word-spacing:0.4176em;">&nbsp;error handler</span><span class="stl_58 stl_59 stl_840" style="word-spacing:0.3566em;">&nbsp;from &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:13.6467em;"><span class="stl_58 stl_59 stl_1288" style="word-spacing:0.3666em;">the stack</span><span class="stl_58 stl_59 stl_1288" style="word-spacing:-0.2104em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1288" style="word-spacing:0.3106em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:11.9425em;"><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.246em;">addReply (</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.267em;">&nbsp;c</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.159em;">&nbsp;,</span><span class="stl_10 stl_11 stl_707" style="word-spacing:0.445em;">&nbsp;shared</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.155em;">&nbsp;.</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.108em;">&nbsp;n</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.268em;">&nbsp;o</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.269em;">&nbsp;s</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.269em;">&nbsp;c</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.269em;">&nbsp;r</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.268em;">&nbsp;i</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.269em;">&nbsp;p</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.269em;">&nbsp;t</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.269em;">&nbsp;e</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.268em;">&nbsp;r</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.269em;">&nbsp;r</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.163em;">&nbsp;)</span><span class="stl_10 stl_11 stl_707" style="word-spacing:-0.163em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">178 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.7892em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 16.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0829em;">LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0821em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:11.9308em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 8.7093em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:10.4132em;"><span class="stl_58 stl_59 stl_305">/</span><span class="stl_58 stl_59 stl_305" style="word-spacing:0.354em;">&nbsp;</span><span class="stl_17 stl_18 stl_305" style="word-spacing:0.354em;">创</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2068em;">&nbsp;建</span><span class="stl_17 stl_18 stl_305" style="word-spacing:0.4184em;">&nbsp;</span><span class="stl_58 stl_59 stl_305" style="word-spacing:0.4184em;">lua</span><span class="stl_58 stl_59 stl_305" style="word-spacing:0.419em;">&nbsp;</span><span class="stl_17 stl_18 stl_305" style="word-spacing:0.419em;">函</span><span class="stl_17 stl_18 stl_305" style="word-spacing:-0.2068em;">&nbsp;数</span><span class="stl_17 stl_18 stl_305" style="word-spacing:0.3592em;">&nbsp;</span><span class="stl_58 stl_59 stl_305" style="word-spacing:0.3592em;">funcname &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.4132em;z-index:53; "><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.3501em;">/ c</span><span class="stl_107 stl_108 stl_1321" style="word-spacing:0.3501em;">−</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.3501em;">&gt;argv</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.0779em;">&nbsp;[</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.1869em;">&nbsp;1</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:-0.1869em;">&nbsp;]</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.5128em;">&nbsp;</span><span class="stl_17 stl_18 stl_1321" style="word-spacing:0.5128em;">指</span><span class="stl_17 stl_18 stl_1321" style="word-spacing:-0.1559em;">&nbsp;向</span><span class="stl_17 stl_18 stl_1321" style="word-spacing:-0.1559em;">&nbsp;用</span><span class="stl_17 stl_18 stl_1321" style="word-spacing:-0.1559em;">&nbsp;户</span><span class="stl_17 stl_18 stl_1321" style="word-spacing:-0.1559em;">&nbsp;指</span><span class="stl_17 stl_18 stl_1321" style="word-spacing:-0.1559em;">&nbsp;定</span><span class="stl_17 stl_18 stl_1321" style="word-spacing:-0.1559em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1321" style="word-spacing:0.4675em;">&nbsp;</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.4675em;">lua</span><span class="stl_58 stl_59 stl_1321" style="word-spacing:0.4689em;">&nbsp;</span><span class="stl_17 stl_18 stl_1321" style="word-spacing:0.4689em;">脚</span><span class="stl_17 stl_18 stl_1321" style="word-spacing:0.4689em;">&nbsp;本 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:10.0375em;z-index:111; "><span class="stl_15 stl_16 stl_323" style="word-spacing:-0.2265em;">i f</span><span class="stl_15 stl_16 stl_323" style="word-spacing:0.4799em;">&nbsp;</span><span class="stl_10 stl_11 stl_323" style="word-spacing:0.4799em;">(</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1835em;">&nbsp;luaCreateFunction</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1835em;">&nbsp;(</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.2455em;">&nbsp;c</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1375em;">&nbsp;,</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1485em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.0555em;">&nbsp;,</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1805em;">&nbsp;funcname</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1205em;">&nbsp;,</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1205em;">&nbsp;c</span><span class="stl_107 stl_108 stl_323" style="word-spacing:-0.1205em;">−</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1895em;">&gt;argv</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.1155em;">&nbsp;[</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.2115em;">&nbsp;1</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.2115em;">&nbsp;]</span><span class="stl_10 stl_11 stl_323" style="word-spacing:-0.2115em;">&nbsp;)</span><span class="stl_10 stl_11 stl_323" style="word-spacing:0.2705em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:11.5008em;"><span class="stl_10 stl_11 stl_336" style="word-spacing:0.6017em;">REDIS_ERR) { &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:11.9358em;"><span class="stl_10 stl_11 stl_1433" style="word-spacing:-0.1665em;">lua_pop ( lua , 1 ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:11.9308em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 16.6801em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:10.4132em;"><span class="stl_58 stl_59 stl_259">/</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.3428em;">&nbsp;</span><span class="stl_17 stl_18 stl_259" style="word-spacing:0.3428em;">现</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.218em;">&nbsp;在</span><span class="stl_17 stl_18 stl_259" style="word-spacing:0.4072em;">&nbsp;</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.4072em;">lua</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.4078em;">&nbsp;</span><span class="stl_17 stl_18 stl_259" style="word-spacing:0.4078em;">中</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.218em;">&nbsp;已</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.217em;">&nbsp;经</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.217em;">&nbsp;有</span><span class="stl_17 stl_18 stl_259" style="word-spacing:0.3478em;">&nbsp;</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.3478em;">funcname</span><span class="stl_58 stl_59 stl_259" style="word-spacing:0.3481em;">&nbsp;</span><span class="stl_17 stl_18 stl_259" style="word-spacing:0.3481em;">这</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.217em;">&nbsp;个</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.217em;">&nbsp;全</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.217em;">&nbsp;局</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.217em;">&nbsp;变</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.217em;">&nbsp;量</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.184em;">&nbsp;了，</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.184em;">&nbsp;将</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.217em;">&nbsp;其</span><span class="stl_17 stl_18 stl_259" style="word-spacing:-0.217em;">&nbsp;读 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.8965em; left:11.6342em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.305em;">取 并 入 栈， &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">准</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;备</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:9.9958em;"><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.225em;">lua_getglobal (</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.258em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.109em;">&nbsp;,</span><span class="stl_10 stl_11 stl_722" style="word-spacing:0.371em;">&nbsp;funcname</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.285em;">&nbsp;)</span><span class="stl_10 stl_11 stl_722" style="word-spacing:-0.285em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:10.0133em;"><span class="stl_10 stl_11 stl_684" style="word-spacing:-0.3105em;">redisAssert ( ! l u a _ i s n i l ( lua , </span><span class="stl_107 stl_108 stl_684" style="word-spacing:-0.3105em;">−</span><span class="stl_10 stl_11 stl_684" style="word-spacing:-0.3105em;">1) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6535em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.6535em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">设 置</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;参</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;包</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;括</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;键</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;和</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:7.9908em;z-index:301; "><span class="stl_10 stl_11 stl_240" style="word-spacing:-0.1495em;">luaSetGlobalArray ( lua , ”KEYS” , c</span><span class="stl_107 stl_108 stl_240" style="word-spacing:-0.1495em;">−</span><span class="stl_10 stl_11 stl_240" style="word-spacing:-0.1495em;">&gt;argv+3,numkeys ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:7.9908em;z-index:375; "><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.0921em;">luaSetGlobalArray ( lua , ”ARGV” , c</span><span class="stl_107 stl_108 stl_221" style="word-spacing:-0.0921em;">−</span><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.0921em;">&gt;argv+3+numkeys , c</span><span class="stl_107 stl_108 stl_221" style="word-spacing:-0.0921em;">−</span><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.0921em;">&gt;argc</span><span class="stl_107 stl_108 stl_221" style="word-spacing:-0.0921em;">−</span><span class="stl_10 stl_11 stl_221" style="word-spacing:-0.0921em;">3</span><span class="stl_107 stl_108 stl_221" style="word-spacing:-0.0921em;">− &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:9.5958em;"><span class="stl_10 stl_11 stl_1434" style="word-spacing:-0.131em;">numkeys ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_1274">/</span><span class="stl_58 stl_59 stl_1274" style="word-spacing:-0.1104em;">&nbsp;</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.1104em;">选 择</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3346em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3346em;">&nbsp;据</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3016em;">&nbsp;集，</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.2578em;">&nbsp;</span><span class="stl_58 stl_59 stl_1274" style="word-spacing:-0.2578em;">lua_client</span><span class="stl_58 stl_59 stl_1274" style="word-spacing:-0.0259em;">&nbsp;</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.0259em;">有 专</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3346em;">&nbsp;用</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3346em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3346em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3346em;">&nbsp;据</span><span class="stl_17 stl_18 stl_1274" style="word-spacing:-0.3346em;">&nbsp;集 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.3539em;">* S</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.3051em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.3051em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.3061em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.3051em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.3051em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.4229em;">&nbsp;the r</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.2961em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.2971em;">&nbsp;g</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.2971em;">&nbsp;h</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.2961em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.2169em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.1649em;">&nbsp;in</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.3939em;">&nbsp;the context of the</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.2979em;">&nbsp;Lua</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:0.3479em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.2831em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.2841em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.2831em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.2831em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1326" style="word-spacing:-0.2831em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6276em; left:9.6075em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 30.6276em; left:10.0807em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.6218em; left:7.9983em;z-index:488; "><span class="stl_10 stl_11 stl_1435" style="word-spacing:-0.1438em;">selectDb ( server . lua_client , c</span><span class="stl_107 stl_108 stl_1435" style="word-spacing:-0.1438em;">−</span><span class="stl_10 stl_11 stl_1435" style="word-spacing:-0.1438em;">&gt;db</span><span class="stl_107 stl_108 stl_1435" style="word-spacing:-0.1438em;">−</span><span class="stl_10 stl_11 stl_1435" style="word-spacing:-0.1438em;">&gt;id ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.616em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:8.4207em;"><span class="stl_58 stl_59 stl_272">/</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.0492em;">&nbsp;</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.0492em;">设 置</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;超</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;时</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;回</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;调</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;函</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.27em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.271em;">&nbsp;以</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;在</span><span class="stl_17 stl_18 stl_272" style="word-spacing:0.3201em;">&nbsp;</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.3201em;">lua</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.3198em;">&nbsp;</span><span class="stl_17 stl_18 stl_272" style="word-spacing:0.3198em;">脚</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;本</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;执</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;行</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;过</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;长</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;时</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;间</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;的</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;时</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;候</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;停</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;止 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.8332em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0503em;">脚 本 的 运 行 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:8.0175em;"><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.2323em;">server .</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.2333em;">&nbsp;lua_caller</span><span class="stl_10 stl_11 stl_587" style="word-spacing:0.1177em;">&nbsp;=</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.1233em;">&nbsp;c</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.1233em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:8.0175em;"><span class="stl_10 stl_11 stl_496" style="word-spacing:-0.1725em;">server .</span><span class="stl_10 stl_11 stl_496" style="word-spacing:-0.2125em;">&nbsp;lua_time_start</span><span class="stl_10 stl_11 stl_496" style="word-spacing:0.136em;">&nbsp;= ustime</span><span class="stl_10 stl_11 stl_496" style="word-spacing:-0.2355em;">&nbsp;()</span><span class="stl_10 stl_11 stl_496" style="word-spacing:-0.2195em;">&nbsp;/1000; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:8.0175em;"><span class="stl_10 stl_11 stl_519" style="word-spacing:-0.2359em;">server .</span><span class="stl_10 stl_11 stl_519" style="word-spacing:-0.2299em;">&nbsp;l</span><span class="stl_10 stl_11 stl_519" style="word-spacing:-0.3899em;">&nbsp;ua</span><span class="stl_10 stl_11 stl_519" style="word-spacing:-0.3909em;">&nbsp;_</span><span class="stl_10 stl_11 stl_519" style="word-spacing:-0.3899em;">&nbsp;ki</span><span class="stl_10 stl_11 stl_519" style="word-spacing:-0.3899em;">&nbsp;ll</span><span class="stl_10 stl_11 stl_519" style="word-spacing:0.1156em;">&nbsp;=</span><span class="stl_10 stl_11 stl_519" style="word-spacing:0.1156em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.591em; left:8.045em;"><span class="stl_15 stl_16 stl_69" style="word-spacing:-0.2827em;">i f</span><span class="stl_15 stl_16 stl_69" style="word-spacing:0.4237em;">&nbsp;</span><span class="stl_10 stl_11 stl_69" style="word-spacing:0.4237em;">(</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.2097em;">&nbsp;server</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.1537em;">&nbsp;.</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.1927em;">&nbsp;lua_time_limit</span><span class="stl_10 stl_11 stl_69" style="word-spacing:0.1293em;">&nbsp;&gt; 0</span><span class="stl_10 stl_11 stl_69" style="word-spacing:0.0733em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_69" style="word-spacing:0.1653em;">&nbsp;server</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.1547em;">&nbsp;.</span><span class="stl_10 stl_11 stl_69" style="word-spacing:-0.1877em;">&nbsp;masterhost</span><span class="stl_10 stl_11 stl_69" style="word-spacing:0.1323em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:9.5em;"><span class="stl_10 stl_11 stl_82" style="word-spacing:0.5935em;">NULL) { &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5901em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.5901em; left:10.4132em;"><span class="stl_58 stl_59 stl_522">/</span><span class="stl_58 stl_59 stl_522" style="word-spacing:0.357em;">&nbsp;</span><span class="stl_17 stl_18 stl_522" style="word-spacing:0.357em;">当</span><span class="stl_17 stl_18 stl_522" style="word-spacing:0.421em;">&nbsp;</span><span class="stl_58 stl_59 stl_522" style="word-spacing:0.421em;">lua</span><span class="stl_58 stl_59 stl_522" style="word-spacing:0.422em;">&nbsp;</span><span class="stl_17 stl_18 stl_522" style="word-spacing:0.422em;">解</span><span class="stl_17 stl_18 stl_522" style="word-spacing:-0.2028em;">&nbsp;释</span><span class="stl_17 stl_18 stl_522" style="word-spacing:-0.2028em;">&nbsp;器</span><span class="stl_17 stl_18 stl_522" style="word-spacing:-0.2028em;">&nbsp;执</span><span class="stl_17 stl_18 stl_522" style="word-spacing:-0.2028em;">&nbsp;行</span><span class="stl_17 stl_18 stl_522" style="word-spacing:-0.2028em;">&nbsp;了</span><span class="stl_17 stl_18 stl_522" style="word-spacing:0.373em;">&nbsp;</span><span class="stl_58 stl_59 stl_522" style="word-spacing:0.373em;">100000</span><span class="stl_58 stl_59 stl_522" style="word-spacing:-0.2254em;">&nbsp;</span><span class="stl_17 stl_18 stl_522" style="word-spacing:-0.2254em;">，</span><span class="stl_17 stl_18 stl_522" style="word-spacing:-0.2365em;">&nbsp;</span><span class="stl_58 stl_59 stl_522" style="word-spacing:-0.2365em;">luaMaskCountHook</span><span class="stl_58 stl_59 stl_522" style="word-spacing:-0.2088em;">&nbsp;()</span><span class="stl_58 stl_59 stl_522" style="word-spacing:0.4255em;">&nbsp;</span><span class="stl_17 stl_18 stl_522" style="word-spacing:-0.2088em;">会 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.8065em; left:11.6342em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">被 调 用 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:9.9742em;"><span class="stl_10 stl_11 stl_1436" style="word-spacing:-0.0734em;">lua_sethook (</span><span class="stl_10 stl_11 stl_1436" style="word-spacing:-0.0794em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_1436" style="word-spacing:0.0686em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1436" style="word-spacing:-0.0664em;">&nbsp;luaMaskCountHook</span><span class="stl_10 stl_11 stl_1436" style="word-spacing:-0.0144em;">&nbsp;,LUA_MASKCOUNT &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:11.9904em;"><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2147em;">100000) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:9.9775em;"><span class="stl_10 stl_11 stl_725" style="word-spacing:0.1466em;">delhook =</span><span class="stl_10 stl_11 stl_725" style="word-spacing:0.1826em;">&nbsp;1; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:11.6558em;"><span class="stl_10 stl_11 stl_07">,</span></div>
					<div class="stl_01" style="top: 45.5702em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">16.4. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">&nbsp;LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">脚本的执行过程 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">179 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4207em;"><span class="stl_58 stl_59 stl_272">/</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.0162em;">&nbsp;</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.0162em;">现 在，</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.271em;">&nbsp;我</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;们</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;确</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;定</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;函</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;数</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;已</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;经</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;注</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;册</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;成</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;功</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;了</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.2578em;">&nbsp;</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.2578em;">.</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.2569em;">&nbsp;</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.2569em;">可</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.305em;">&nbsp;以</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;直</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;接</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;调</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;用</span><span class="stl_17 stl_18 stl_272" style="word-spacing:0.321em;">&nbsp;</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.321em;">lua</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.3208em;">&nbsp;</span><span class="stl_17 stl_18 stl_272" style="word-spacing:0.3208em;">脚</span><span class="stl_17 stl_18 stl_272" style="word-spacing:0.3208em;">&nbsp;本 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:8.0167em;"><span class="stl_10 stl_11 stl_1437" style="word-spacing:0.1648em;">err =</span><span class="stl_10 stl_11 stl_1437" style="word-spacing:-0.1103em;">&nbsp;lua_pcall (</span><span class="stl_10 stl_11 stl_1437" style="word-spacing:-0.2902em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_1437" style="word-spacing:-0.1942em;">&nbsp;,0</span><span class="stl_10 stl_11 stl_1437" style="word-spacing:-0.2722em;">&nbsp;,1</span><span class="stl_10 stl_11 stl_1437" style="word-spacing:-0.2722em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1437" style="word-spacing:-0.2731em;">&nbsp;</span><span class="stl_107 stl_108 stl_1437" style="word-spacing:-0.2722em;">−</span><span class="stl_10 stl_11 stl_1437" style="word-spacing:-0.2731em;">2)</span><span class="stl_10 stl_11 stl_1437" style="word-spacing:-0.2731em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">删</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;除</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;超</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;回</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;调</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:8.045em;"><span class="stl_15 stl_16 stl_305" style="word-spacing:-0.2298em;">i f</span><span class="stl_15 stl_16 stl_305" style="word-spacing:0.4766em;">&nbsp;</span><span class="stl_10 stl_11 stl_305" style="word-spacing:0.4766em;">(</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.1958em;">&nbsp;delhook</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.1948em;">&nbsp;)</span><span class="stl_10 stl_11 stl_305" style="word-spacing:0.4002em;">&nbsp;lua_sethook</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.1998em;">&nbsp;(</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.2078em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.0588em;">&nbsp;,</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.1928em;">&nbsp;luaMaskCountHook</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.1518em;">&nbsp;,</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.2548em;">&nbsp;0</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.1048em;">&nbsp;,</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.2548em;">&nbsp;0</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.2548em;">&nbsp;)</span><span class="stl_10 stl_11 stl_305" style="word-spacing:-0.0948em;">&nbsp;;</span><span class="stl_10 stl_11 stl_305" style="word-spacing:0.4148em;">&nbsp;</span><span class="stl_58 stl_59 stl_305" style="word-spacing:0.4148em;">/* &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:9.6667em;"><span class="stl_58 stl_59 stl_455" style="word-spacing:0.3452em;">Disable hook</span><span class="stl_58 stl_59 stl_455" style="word-spacing:0.2742em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.6876em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4207em;"><span class="stl_58 stl_59 stl_310">/</span><span class="stl_58 stl_59 stl_310" style="word-spacing:0.4656em;">&nbsp;</span><span class="stl_17 stl_18 stl_310" style="word-spacing:0.4656em;">如</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0952em;">&nbsp;果</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;已</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;经</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;超</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;时</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0602em;">&nbsp;了，</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0612em;">&nbsp;说</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;明</span><span class="stl_17 stl_18 stl_310" style="word-spacing:0.5305em;">&nbsp;</span><span class="stl_58 stl_59 stl_310" style="word-spacing:0.5305em;">lua</span><span class="stl_58 stl_59 stl_310" style="word-spacing:0.5306em;">&nbsp;</span><span class="stl_17 stl_18 stl_310" style="word-spacing:0.5306em;">脚</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0952em;">&nbsp;本</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;已</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;在</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;超</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;时</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;后</span><span class="stl_17 stl_18 stl_310" style="word-spacing:-0.0942em;">&nbsp;背</span><span class="stl_17 stl_18 stl_310" style="word-spacing:0.3791em;">&nbsp;</span><span class="stl_58 stl_59 stl_310" style="word-spacing:0.3791em;">SCRPIT</span><span class="stl_58 stl_59 stl_310" style="word-spacing:0.2768em;">&nbsp;KILL &nbsp;</span></div>
					<div class="stl_01" style="top: 13.9115em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">终 结 了 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:8.4207em;"><span class="stl_58 stl_59 stl_939">/</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.0372em;">&nbsp;</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.0372em;">恢 复</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;监</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;听</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;发</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;送</span><span class="stl_17 stl_18 stl_939" style="word-spacing:0.3259em;">&nbsp;</span><span class="stl_58 stl_59 stl_939" style="word-spacing:0.3259em;">lua</span><span class="stl_58 stl_59 stl_939" style="word-spacing:0.3268em;">&nbsp;</span><span class="stl_17 stl_18 stl_939" style="word-spacing:0.3268em;">脚</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.299em;">&nbsp;本</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;命</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;令</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;的</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;客</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;户</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;端 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:8.045em;"><span class="stl_15 stl_16 stl_1438" style="word-spacing:-0.2876em;">i f</span><span class="stl_15 stl_16 stl_1438" style="word-spacing:0.4188em;">&nbsp;</span><span class="stl_10 stl_11 stl_1438" style="word-spacing:0.4188em;">(</span><span class="stl_10 stl_11 stl_1438" style="word-spacing:-0.2146em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1438" style="word-spacing:-0.1586em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1438" style="word-spacing:-0.2126em;">&nbsp;lua_timedout</span><span class="stl_10 stl_11 stl_1438" style="word-spacing:-0.2676em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1438" style="word-spacing:-0.2676em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:10.01em;"><span class="stl_10 stl_11 stl_263" style="word-spacing:-0.1625em;">server .</span><span class="stl_10 stl_11 stl_263" style="word-spacing:-0.2165em;">&nbsp;lua_timedout</span><span class="stl_10 stl_11 stl_263" style="word-spacing:0.1335em;">&nbsp;=</span><span class="stl_10 stl_11 stl_263" style="word-spacing:0.1845em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:9.9883em;z-index:284; "><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.1155em;">aeCreateFileEvent (</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.0885em;">&nbsp;server</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.0335em;">&nbsp;.</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.0585em;">&nbsp;el</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.0639em;">&nbsp;, c</span><span class="stl_107 stl_108 stl_856" style="word-spacing:-0.0639em;">−</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.0639em;">&gt;fd</span><span class="stl_10 stl_11 stl_856" style="word-spacing:-0.0085em;">&nbsp;,AE_READABLE, &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:18.9267em;"><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.1636em;">readQueryFromClient , c ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 21.661em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.661em; left:8.4207em;"><span class="stl_58 stl_59 stl_870" style="word-spacing:0.2641em;">/ lua_caller</span><span class="stl_58 stl_59 stl_870" style="word-spacing:-0.0168em;">&nbsp;</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.0168em;">置</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.0168em;">&nbsp;空 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:8.0175em;"><span class="stl_10 stl_11 stl_566" style="word-spacing:-0.1552em;">server .</span><span class="stl_10 stl_11 stl_566" style="word-spacing:-0.1562em;">&nbsp;lua_caller</span><span class="stl_10 stl_11 stl_566" style="word-spacing:0.1948em;">&nbsp;=</span><span class="stl_10 stl_11 stl_566" style="word-spacing:-0.0192em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_747">/</span><span class="stl_58 stl_59 stl_747" style="word-spacing:-0.0218em;">&nbsp;</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.0218em;">执 行</span><span class="stl_17 stl_18 stl_747" style="word-spacing:0.323em;">&nbsp;</span><span class="stl_58 stl_59 stl_747" style="word-spacing:0.323em;">lua</span><span class="stl_58 stl_59 stl_747" style="word-spacing:0.3226em;">&nbsp;</span><span class="stl_17 stl_18 stl_747" style="word-spacing:0.3226em;">脚</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;本</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;用</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;的</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;是</span><span class="stl_17 stl_18 stl_747" style="word-spacing:0.3233em;">&nbsp;</span><span class="stl_58 stl_59 stl_747" style="word-spacing:0.3233em;">lua</span><span class="stl_58 stl_59 stl_747" style="word-spacing:0.3236em;">&nbsp;</span><span class="stl_17 stl_18 stl_747" style="word-spacing:0.3236em;">脚</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3022em;">&nbsp;本</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;执</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;行</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3002em;">&nbsp;专</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;用</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;的</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;数</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;据</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.2682em;">&nbsp;集。</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.2672em;">&nbsp;现</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;在</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;恢</span><span class="stl_17 stl_18 stl_747" style="word-spacing:-0.3012em;">&nbsp;复 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.8665em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">原 有 的 数 据 集 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:7.9983em;z-index:430; "><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.1859em;">selectDb (</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.2539em;">&nbsp;c</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.147em;">&nbsp;,</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.1069em;">&nbsp;server</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.1069em;">&nbsp;.</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.1239em;">&nbsp;lua_client</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.2466em;">&nbsp;</span><span class="stl_107 stl_108 stl_204" style="word-spacing:-0.1239em;">−</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.2466em;">&gt;db</span><span class="stl_107 stl_108 stl_204" style="word-spacing:-0.2466em;">−</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.2466em;">&gt;id</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.185em;">&nbsp;)</span><span class="stl_10 stl_11 stl_204" style="word-spacing:-0.145em;">&nbsp;;</span><span class="stl_10 stl_11 stl_204" style="word-spacing:0.4035em;">&nbsp;</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.4035em;">/* set</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.251em;">&nbsp;DB</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.121em;">&nbsp;ID</span><span class="stl_58 stl_59 stl_204" style="word-spacing:0.2761em;">&nbsp;from &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6385em; left:9.5842em;"><span class="stl_58 stl_59 stl_1439" style="word-spacing:0.4753em;">Lua c</span><span class="stl_58 stl_59 stl_1439" style="word-spacing:-0.1557em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1439" style="word-spacing:-0.1557em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1439" style="word-spacing:-0.1567em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1439" style="word-spacing:-0.1557em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1439" style="word-spacing:-0.1557em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1439" style="word-spacing:0.5033em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.631em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.631em; left:8.4207em;"><span class="stl_58 stl_59 stl_467" style="word-spacing:0.3333em;">/ Garbage</span><span class="stl_58 stl_59 stl_467" style="word-spacing:0.4453em;">&nbsp;c</span><span class="stl_58 stl_59 stl_467" style="word-spacing:-0.2287em;">&nbsp;o</span><span class="stl_58 stl_59 stl_467" style="word-spacing:-0.2297em;">&nbsp;l</span><span class="stl_58 stl_59 stl_467" style="word-spacing:-0.2287em;">&nbsp;l</span><span class="stl_58 stl_59 stl_467" style="word-spacing:-0.2297em;">&nbsp;e</span><span class="stl_58 stl_59 stl_467" style="word-spacing:-0.2297em;">&nbsp;c</span><span class="stl_58 stl_59 stl_467" style="word-spacing:-0.2287em;">&nbsp;t</span><span class="stl_58 stl_59 stl_467" style="word-spacing:-0.2297em;">&nbsp;i</span><span class="stl_58 stl_59 stl_467" style="word-spacing:-0.2297em;">&nbsp;o</span><span class="stl_58 stl_59 stl_467" style="word-spacing:-0.2287em;">&nbsp;n</span><span class="stl_58 stl_59 stl_467" style="word-spacing:0.4703em;">&nbsp;</span><span class="stl_17 stl_18 stl_467" style="word-spacing:0.4703em;">垃</span><span class="stl_17 stl_18 stl_467" style="word-spacing:-0.2007em;">&nbsp;圾</span><span class="stl_17 stl_18 stl_467" style="word-spacing:-0.2007em;">&nbsp;回</span><span class="stl_17 stl_18 stl_467" style="word-spacing:-0.2007em;">&nbsp;收 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:7.9658em;"><span class="stl_10 stl_11 stl_237" style="word-spacing:-0.0511em;">lua_gc (</span><span class="stl_10 stl_11 stl_237" style="word-spacing:-0.0391em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_237" style="word-spacing:0.1089em;">&nbsp;,LUA_GCSTEP,</span><span class="stl_10 stl_11 stl_237" style="word-spacing:-0.0801em;">&nbsp;1</span><span class="stl_10 stl_11 stl_237" style="word-spacing:-0.0801em;">&nbsp;)</span><span class="stl_10 stl_11 stl_237" style="word-spacing:-0.0801em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.6093em; left:8.045em;"><span class="stl_15 stl_16 stl_312" style="word-spacing:-0.36em;">i f</span><span class="stl_15 stl_16 stl_312" style="word-spacing:0.3464em;">&nbsp;</span><span class="stl_10 stl_11 stl_312" style="word-spacing:0.3464em;">(</span><span class="stl_10 stl_11 stl_312" style="word-spacing:-0.288em;">&nbsp;err</span><span class="stl_10 stl_11 stl_312" style="word-spacing:-0.287em;">&nbsp;)</span><span class="stl_10 stl_11 stl_312" style="word-spacing:-0.287em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6201em; left:8.4207em;"><span class="stl_58 stl_59 stl_939">/</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.0372em;">&nbsp;</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.0372em;">处 理</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;执</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;行</span><span class="stl_17 stl_18 stl_939" style="word-spacing:0.3261em;">&nbsp;</span><span class="stl_58 stl_59 stl_939" style="word-spacing:0.3261em;">lua</span><span class="stl_58 stl_59 stl_939" style="word-spacing:0.3268em;">&nbsp;</span><span class="stl_17 stl_18 stl_939" style="word-spacing:0.3268em;">脚</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.299em;">&nbsp;本</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;的</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;错</span><span class="stl_17 stl_18 stl_939" style="word-spacing:-0.298em;">&nbsp;误 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6126em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.6126em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">告</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;知</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;客</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;户</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;端 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:9.9583em;"><span class="stl_10 stl_11 stl_956" style="word-spacing:-0.2452em;">addReplyErrorFormat ( c , ” Error ␣ running ␣ s c r i p t ␣ ( c a l l ␣ to ␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6035em; left:11.4542em;"><span class="stl_10 stl_11 stl_1440" style="word-spacing:-0.0532em;">%s ) : ␣%s \n” , &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:11.9333em;z-index:627; "><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.1695em;">funcname ,</span><span class="stl_10 stl_11 stl_63" style="word-spacing:0.4415em;">&nbsp;lua_tostring</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2135em;">&nbsp;(</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2535em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.1895em;">&nbsp;,</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.3001em;">&nbsp;</span><span class="stl_107 stl_108 stl_63" style="word-spacing:-0.1895em;">−</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.3001em;">1)</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2695em;">&nbsp;)</span><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2695em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:9.9433em;"><span class="stl_10 stl_11 stl_1441" style="word-spacing:-0.2205em;">lua_pop (</span><span class="stl_10 stl_11 stl_1441" style="word-spacing:-0.1915em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_1441" style="word-spacing:-0.0455em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1441" style="word-spacing:-0.2305em;">&nbsp;2</span><span class="stl_10 stl_11 stl_1441" style="word-spacing:-0.2315em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1441" style="word-spacing:-0.0705em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1441" style="word-spacing:0.431em;">&nbsp;</span><span class="stl_58 stl_59 stl_1441" style="word-spacing:0.431em;">/*</span><span class="stl_58 stl_59 stl_1441" style="word-spacing:0.2935em;">&nbsp;Consume</span><span class="stl_58 stl_59 stl_1441" style="word-spacing:0.3705em;">&nbsp;the Lua reply</span><span class="stl_58 stl_59 stl_1441" style="word-spacing:0.4085em;">&nbsp;and</span><span class="stl_58 stl_59 stl_1441" style="word-spacing:0.3315em;">&nbsp;remove &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5935em; left:11.6567em;"><span class="stl_58 stl_59 stl_1093" style="word-spacing:0.3629em;">error handler</span><span class="stl_58 stl_59 stl_1093" style="word-spacing:-0.2181em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1093" style="word-spacing:0.3209em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.586em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.581em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 41.586em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">成</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;功</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;了 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.576em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.5793em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.5793em; left:10.4132em;"><span class="stl_58 stl_59 stl_1442" style="word-spacing:0.1391em;">* On</span><span class="stl_58 stl_59 stl_1442" style="word-spacing:0.2111em;">&nbsp;success</span><span class="stl_58 stl_59 stl_1442" style="word-spacing:0.3751em;">&nbsp;convert the</span><span class="stl_58 stl_59 stl_1442" style="word-spacing:0.2781em;">&nbsp;Lua return</span><span class="stl_58 stl_59 stl_1442" style="word-spacing:0.3748em;">&nbsp;value into</span><span class="stl_58 stl_59 stl_1442" style="word-spacing:0.3748em;">&nbsp;Redis &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5752em; left:12.1558em;"><span class="stl_58 stl_59 stl_1109" style="word-spacing:-0.07em;">protocol ,</span><span class="stl_58 stl_59 stl_1109" style="word-spacing:0.326em;">&nbsp;and &nbsp;</span></div>
					<div class="stl_01" style="top: 45.5718em; left:10.4258em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 45.5718em; left:11.4603em;"><span class="stl_58 stl_59 stl_555" style="word-spacing:0.4281em;">send i</span><span class="stl_58 stl_59 stl_555" style="word-spacing:-0.2639em;">&nbsp;t</span><span class="stl_58 stl_59 stl_555" style="word-spacing:0.4551em;">&nbsp;to</span><span class="stl_58 stl_59 stl_555" style="word-spacing:0.3151em;">&nbsp;* the</span><span class="stl_58 stl_59 stl_555" style="word-spacing:0.4481em;">&nbsp;c</span><span class="stl_58 stl_59 stl_555" style="word-spacing:-0.2769em;">&nbsp;l</span><span class="stl_58 stl_59 stl_555" style="word-spacing:-0.2759em;">&nbsp;i</span><span class="stl_58 stl_59 stl_555" style="word-spacing:-0.2759em;">&nbsp;e</span><span class="stl_58 stl_59 stl_555" style="word-spacing:-0.2759em;">&nbsp;n</span><span class="stl_58 stl_59 stl_555" style="word-spacing:-0.2769em;">&nbsp;t</span><span class="stl_58 stl_59 stl_555" style="word-spacing:-0.1289em;">&nbsp;.</span><span class="stl_58 stl_59 stl_555" style="word-spacing:0.3541em;">&nbsp;*/ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">180 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.7892em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 16.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0829em;">LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0821em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:9.9675em;"><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.2205em;">luaReplyToRedisReply (</span><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.2625em;">&nbsp;c</span><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.1545em;">&nbsp;,</span><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.1415em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.1975em;">&nbsp;)</span><span class="stl_10 stl_11 stl_616" style="word-spacing:-0.1535em;">&nbsp;;</span><span class="stl_10 stl_11 stl_616" style="word-spacing:0.4008em;">&nbsp;</span><span class="stl_58 stl_59 stl_616" style="word-spacing:0.4008em;">/*</span><span class="stl_58 stl_59 stl_616" style="word-spacing:0.329em;">&nbsp;Convert and</span><span class="stl_58 stl_59 stl_616" style="word-spacing:0.2905em;">&nbsp;consume &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:11.6542em;"><span class="stl_58 stl_59 stl_1126" style="word-spacing:0.3654em;">the reply</span><span class="stl_58 stl_59 stl_1126" style="word-spacing:-0.2116em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1126" style="word-spacing:0.3034em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9425em;"><span class="stl_10 stl_11 stl_925" style="word-spacing:-0.25em;">lua_pop (</span><span class="stl_10 stl_11 stl_925" style="word-spacing:-0.221em;">&nbsp;lua</span><span class="stl_10 stl_11 stl_925" style="word-spacing:-0.075em;">&nbsp;,</span><span class="stl_10 stl_11 stl_925" style="word-spacing:-0.26em;">&nbsp;1</span><span class="stl_10 stl_11 stl_925" style="word-spacing:-0.261em;">&nbsp;)</span><span class="stl_10 stl_11 stl_925" style="word-spacing:-0.1em;">&nbsp;;</span><span class="stl_10 stl_11 stl_925" style="word-spacing:0.4015em;">&nbsp;</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.4015em;">/*</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.263em;">&nbsp;Remove</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.329em;">&nbsp;the</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.431em;">&nbsp;error handler</span><span class="stl_58 stl_59 stl_925" style="word-spacing:-0.152em;">&nbsp;.</span><span class="stl_58 stl_59 stl_925" style="word-spacing:0.387em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 10.7018em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6968em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 10.7018em; left:8.4207em;"><span class="stl_58 stl_59 stl_945">/</span><span class="stl_58 stl_59 stl_945" style="word-spacing:0.4302em;">&nbsp;</span><span class="stl_17 stl_18 stl_945" style="word-spacing:0.4302em;">将</span><span class="stl_17 stl_18 stl_945" style="word-spacing:0.4941em;">&nbsp;</span><span class="stl_58 stl_59 stl_945" style="word-spacing:0.4941em;">lua</span><span class="stl_58 stl_59 stl_945" style="word-spacing:0.4952em;">&nbsp;</span><span class="stl_17 stl_18 stl_945" style="word-spacing:0.4952em;">脚</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.1306em;">&nbsp;本</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.1296em;">&nbsp;发</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.1296em;">&nbsp;布</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.1296em;">&nbsp;到</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.1286em;">&nbsp;主</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.1296em;">&nbsp;从</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.1296em;">&nbsp;复</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.1296em;">&nbsp;制</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.0966em;">&nbsp;上，</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.0956em;">&nbsp;并</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.1296em;">&nbsp;写</span><span class="stl_17 stl_18 stl_945" style="word-spacing:-0.1296em;">&nbsp;入</span><span class="stl_17 stl_18 stl_945" style="word-spacing:0.2791em;">&nbsp;</span><span class="stl_58 stl_59 stl_945" style="word-spacing:0.2791em;">AOF</span><span class="stl_58 stl_59 stl_945" style="word-spacing:0.279em;">&nbsp;</span><span class="stl_17 stl_18 stl_945" style="word-spacing:0.279em;">文</span><span class="stl_17 stl_18 stl_945" style="word-spacing:0.279em;">&nbsp;件 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:8.5866em;"><span class="stl_10 stl_11 stl_1443" style="word-spacing:0.1515em;">. . . . .</span><span class="stl_10 stl_11 stl_1443" style="word-spacing:0.0235em;">&nbsp;TODO</span><span class="stl_10 stl_11 stl_1443" style="word-spacing:0.4463em;">&nbsp;</span><span class="stl_17 stl_18 stl_1443" style="word-spacing:0.4463em;">补</span><span class="stl_17 stl_18 stl_1443" style="word-spacing:0.1085em;">&nbsp;充， 问</span><span class="stl_17 stl_18 stl_1443" style="word-spacing:0.0755em;">&nbsp;题 已 经 搞 清 楚</span><span class="stl_17 stl_18 stl_1443" style="word-spacing:0.0755em;">&nbsp;了 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">16.4. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">&nbsp;LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">脚本的执行过程 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">181 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">182 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.7892em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 16.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0829em;">LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0821em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4507em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.4507em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">6.5 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">脏命令 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.9157em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">在解释脏命令之前，我先交代一点。 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.686em; left:7.5658em;"><span class="stl_10 stl_11 stl_749" style="word-spacing:0.0918em;">redis </span><span class="stl_17 stl_18 stl_749" style="word-spacing:0.0918em;">服务器执行的 </span><span class="stl_10 stl_11 stl_749" style="word-spacing:0.0918em;">lua </span><span class="stl_17 stl_18 stl_749" style="word-spacing:0.0918em;">脚本和普通的命令一样，都是会写入 </span><span class="stl_10 stl_11 stl_749" style="word-spacing:0.0918em;">AOF </span><span class="stl_17 stl_18 stl_749" style="word-spacing:0.0918em;">文件和发布 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6826em; left:5.9058em;"><span class="stl_17 stl_18 stl_1333" style="word-spacing:0.0819em;">至主从复制连接上的。以主从复制为例，将 </span><span class="stl_10 stl_11 stl_1333" style="word-spacing:0.0819em;">lua </span><span class="stl_17 stl_18 stl_1333" style="word-spacing:0.0819em;">脚本中发生的数据变更发布到从机 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.9007em; left:5.9058em;"><span class="stl_17 stl_18 stl_1360">上，有两种方法。一，和普通的命令一样，只要涉及写的操作，都发布到从机上；二、 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6751em; left:5.9058em;"><span class="stl_17 stl_18 stl_1116" style="word-spacing:0.0852em;">直接将 </span><span class="stl_10 stl_11 stl_1116" style="word-spacing:0.0852em;">lua </span><span class="stl_17 stl_18 stl_1116" style="word-spacing:0.0852em;">脚本发送给从机。实际上，两种方法都可以的，数据变更都能得到传播， &nbsp;</span></div>
					<div class="stl_01" style="top: 13.671em; left:5.9058em;"><span class="stl_17 stl_18 stl_1444" style="word-spacing:0.0843em;">但首先，第一种方法中普通命令会被转化为 </span><span class="stl_10 stl_11 stl_1444" style="word-spacing:0.0843em;">redis </span><span class="stl_17 stl_18 stl_1444" style="word-spacing:0.0843em;">通信协议的格式，和 </span><span class="stl_10 stl_11 stl_1444" style="word-spacing:0.0843em;">lua </span><span class="stl_17 stl_18 stl_1444" style="word-spacing:0.0843em;">脚本文本 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6676em; left:5.9058em;"><span class="stl_17 stl_18 stl_460" style="word-spacing:0.0836em;">大小比较起来，会浪费更多的带宽；其次，第一种方法也会浪费较多的 </span><span class="stl_10 stl_11 stl_460" style="word-spacing:0.0836em;">CPU </span><span class="stl_17 stl_18 stl_460" style="word-spacing:0.0836em;">的资 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6635em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0841em;">源，因为从机收到了 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0841em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0841em;">通信协议的格式的命令后，还需要转换为普通的命令，然 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6601em; left:5.9058em;"><span class="stl_17 stl_18 stl_1386" style="word-spacing:0.0896em;">后才是执行，这比纯粹的执行 </span><span class="stl_10 stl_11 stl_1386" style="word-spacing:0.0896em;">lua </span><span class="stl_17 stl_18 stl_1386" style="word-spacing:0.0896em;">脚本，会浪费更多的 </span><span class="stl_10 stl_11 stl_1386" style="word-spacing:0.0896em;">CPU </span><span class="stl_17 stl_18 stl_1386" style="word-spacing:0.0896em;">资源。作者真是煞费 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.656em; left:5.9058em;z-index:394; "><span class="stl_17 stl_18 stl_1445">苦心</span><span class="stl_10 stl_11 stl_1445">;)</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.2495em;">&nbsp;</span><span class="stl_17 stl_18 stl_1446">，开</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.268em;">&nbsp;</span><span class="stl_17 stl_18 stl_07">源软件做到这么细致的地方</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_1447">，很</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.269em;">&nbsp;</span><span class="stl_17 stl_18 stl_1448" style="word-spacing:0.106em;">令人敬佩，</span><span class="stl_10 stl_11 stl_1448" style="word-spacing:0.106em;">redis </span><span class="stl_17 stl_18 stl_1448" style="word-spacing:0.106em;">确实是“麻雀虽小五脏俱全”。 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6485em; left:7.5658em;"><span class="stl_17 stl_18 stl_41" style="word-spacing:0.0822em;">上面的结果是，直接将 </span><span class="stl_10 stl_11 stl_41" style="word-spacing:0.0822em;">lua </span><span class="stl_17 stl_18 stl_41" style="word-spacing:0.0822em;">脚本发送给从机。但这又会产生一个问题。举例一个 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6451em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0822em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">脚本： &nbsp;</span></div>
					<div class="stl_01" style="top: 23.3941em; left:5.7875em;z-index:437; "><span class="stl_107 stl_108 stl_07">−</span></div>
					<div class="stl_01" style="top: 23.1018em; left:6.3154em;z-index:438; "><span class="stl_107 stl_108 stl_828">−</span><span class="stl_107 stl_108 stl_828" style="word-spacing:0.1638em;">&nbsp;</span><span class="stl_10 stl_11 stl_828" style="word-spacing:0.1638em;">lua</span><span class="stl_10 stl_11 stl_828" style="word-spacing:0.399em;">&nbsp;s</span><span class="stl_10 stl_11 stl_828" style="word-spacing:-0.318em;">&nbsp;c</span><span class="stl_10 stl_11 stl_828" style="word-spacing:-0.318em;">&nbsp;r</span><span class="stl_10 stl_11 stl_828" style="word-spacing:-0.319em;">&nbsp;p</span><span class="stl_10 stl_11 stl_828" style="word-spacing:-0.318em;">&nbsp;i</span><span class="stl_10 stl_11 stl_828" style="word-spacing:-0.318em;">&nbsp;t &nbsp;</span></div>
					<div class="stl_01" style="top: 24.0985em; left:6.0442em;z-index:449; "><span class="stl_10 stl_11 stl_1449" style="word-spacing:-0.168em;">l o</span><span class="stl_10 stl_11 stl_1449" style="word-spacing:-0.167em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1449" style="word-spacing:-0.168em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1449" style="word-spacing:-0.167em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1449" style="word-spacing:0.475em;">&nbsp;some_key &nbsp;</span></div>
					<div class="stl_01" style="top: 25.0943em; left:5.9408em;z-index:498; "><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.4602em;">some_key =</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.5742em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.0632em;">&nbsp;e d i s</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.2362em;">&nbsp;. c</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.0872em;">&nbsp;a l l</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.1932em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.2272em;">&nbsp;’RANDOMKEY’</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.1202em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.4702em;">&nbsp;</span><span class="stl_107 stl_108 stl_1247" style="word-spacing:0.4702em;">−−</span><span class="stl_107 stl_108 stl_1247" style="word-spacing:0.278em;">&nbsp;</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.4702em;">&lt;</span><span class="stl_107 stl_108 stl_1247" style="word-spacing:0.278em;">−−−</span><span class="stl_107 stl_108 stl_1247" style="word-spacing:0.3005em;">&nbsp;</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.3005em;">TODO</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.5492em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.0797em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1247" style="word-spacing:0.0797em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 26.091em; left:6.035em;"><span class="stl_10 stl_11 stl_1450" style="word-spacing:-0.1374em;">r e d i s . c a l l ( ’ set ’ , some_key , ’ 123 ’ ) &nbsp;</span></div>
					<div class="stl_01" style="top: 27.551em; left:7.5658em;"><span class="stl_17 stl_18 stl_516" style="word-spacing:0.0788em;">上面脚本想要做的是，从 </span><span class="stl_10 stl_11 stl_516" style="word-spacing:0.0788em;">redis </span><span class="stl_17 stl_18 stl_516" style="word-spacing:0.0788em;">服务器中随机选取一个键，将其值设置为 </span><span class="stl_10 stl_11 stl_516" style="word-spacing:0.0788em;">123</span><span class="stl_17 stl_18 stl_516" style="word-spacing:0.0788em;">。从 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.5476em; left:5.9058em;"><span class="stl_10 stl_11 stl_1451" style="word-spacing:0.0814em;">RANDOMKEY </span><span class="stl_17 stl_18 stl_1451" style="word-spacing:0.0814em;">命令的命令处理函数来看，其调用了 </span><span class="stl_10 stl_11 stl_1451" style="word-spacing:0.0814em;">random() </span><span class="stl_17 stl_18 stl_1451" style="word-spacing:0.0814em;">函数，如此一来问题 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.5435em; left:5.9058em;"><span class="stl_17 stl_18 stl_427" style="word-spacing:0.0869em;">就来了：当 </span><span class="stl_10 stl_11 stl_427" style="word-spacing:0.0869em;">lua </span><span class="stl_17 stl_18 stl_427" style="word-spacing:0.0869em;">脚本被发布到不同的从机上时，</span><span class="stl_10 stl_11 stl_427" style="word-spacing:0.0869em;">random() </span><span class="stl_17 stl_18 stl_427" style="word-spacing:0.0869em;">调用返回的结果是不同的， &nbsp;</span></div>
					<div class="stl_01" style="top: 30.7623em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">因此主从机的数据就不一致了。 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.5326em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">因此在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0831em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">服务器配置选项目设置了两个变量来解决这个问题： &nbsp;</span></div>
					<div class="stl_01" style="top: 34.991em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.991em; left:8.4207em;"><span class="stl_58 stl_59 stl_454">/</span><span class="stl_58 stl_59 stl_454" style="word-spacing:0.2628em;">&nbsp;</span><span class="stl_17 stl_18 stl_454" style="word-spacing:0.2628em;">在</span><span class="stl_17 stl_18 stl_454" style="word-spacing:0.3267em;">&nbsp;</span><span class="stl_58 stl_59 stl_454" style="word-spacing:0.3267em;">lua</span><span class="stl_58 stl_59 stl_454" style="word-spacing:0.3278em;">&nbsp;</span><span class="stl_17 stl_18 stl_454" style="word-spacing:0.3278em;">脚</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.298em;">&nbsp;本</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;中</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;发</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.296em;">&nbsp;生</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;了</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;写</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;操</span><span class="stl_17 stl_18 stl_454" style="word-spacing:-0.297em;">&nbsp;作 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.9802em; left:7.98em;"><span class="stl_15 stl_16 stl_1316">int</span><span class="stl_15 stl_16 stl_1316" style="word-spacing:0.3966em;">&nbsp;</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:0.3966em;">lua_write_dirty</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:-0.1423em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1316" style="word-spacing:1.0055em;">&nbsp;</span><span class="stl_58 stl_59 stl_1316" style="word-spacing:1.0055em;">/*</span><span class="stl_58 stl_59 stl_1316" style="word-spacing:0.2977em;">&nbsp;True</span><span class="stl_58 stl_59 stl_1316" style="word-spacing:0.4327em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1316" style="word-spacing:-0.2193em;">&nbsp;f</span><span class="stl_58 stl_59 stl_1316" style="word-spacing:0.4237em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1316" style="word-spacing:0.3657em;">&nbsp;write</span><span class="stl_58 stl_59 stl_1316" style="word-spacing:0.3217em;">&nbsp;command</span><span class="stl_58 stl_59 stl_1316" style="word-spacing:0.2397em;">&nbsp;was &nbsp;</span></div>
					<div class="stl_01" style="top: 36.9835em; left:9.6942em;"><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3206em;">c a</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3216em;">&nbsp;l</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3206em;">&nbsp;l</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3206em;">&nbsp;e</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3216em;">&nbsp;d</span><span class="stl_58 stl_59 stl_721" style="word-spacing:0.3944em;">&nbsp;during</span><span class="stl_58 stl_59 stl_721" style="word-spacing:0.3534em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 37.9793em; left:20.46em;"><span class="stl_58 stl_59 stl_1452" style="word-spacing:0.3471em;">execution of the current</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:0.3861em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3409em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3399em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3409em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3399em;">&nbsp;p</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3409em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3409em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 38.976em; left:22.5592em;"><span class="stl_58 stl_59 stl_71">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 39.9726em; left:8.4207em;z-index:836; "><span class="stl_58 stl_59 stl_656">/</span><span class="stl_58 stl_59 stl_656" style="word-spacing:0.6478em;">&nbsp;</span><span class="stl_17 stl_18 stl_656" style="word-spacing:0.6478em;">在</span><span class="stl_17 stl_18 stl_656" style="word-spacing:0.7117em;">&nbsp;</span><span class="stl_58 stl_59 stl_656" style="word-spacing:0.7117em;">lua</span><span class="stl_58 stl_59 stl_656" style="word-spacing:0.7128em;">&nbsp;</span><span class="stl_17 stl_18 stl_656" style="word-spacing:0.7128em;">脚</span><span class="stl_17 stl_18 stl_656" style="word-spacing:0.088em;">&nbsp;本 发 生 了 未 决 的 操</span><span class="stl_17 stl_18 stl_656" style="word-spacing:0.1215em;">&nbsp;作， 譬</span><span class="stl_17 stl_18 stl_656" style="word-spacing:0.088em;">&nbsp;如</span><span class="stl_17 stl_18 stl_656" style="word-spacing:0.445em;">&nbsp;</span><span class="stl_58 stl_59 stl_656" style="word-spacing:0.445em;">RANDOMKEY</span><span class="stl_58 stl_59 stl_656" style="word-spacing:0.4451em;">&nbsp;</span><span class="stl_17 stl_18 stl_656" style="word-spacing:0.4451em;">命</span><span class="stl_17 stl_18 stl_656" style="word-spacing:0.088em;">&nbsp;令 操</span><span class="stl_17 stl_18 stl_656" style="word-spacing:0.088em;">&nbsp;作 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.9726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.9618em; left:7.98em;"><span class="stl_15 stl_16 stl_736">int</span><span class="stl_15 stl_16 stl_736" style="word-spacing:0.4159em;">&nbsp;</span><span class="stl_10 stl_11 stl_736" style="word-spacing:0.4159em;">lua_random_dirty</span><span class="stl_10 stl_11 stl_736" style="word-spacing:-0.1219em;">&nbsp;;</span><span class="stl_10 stl_11 stl_736" style="word-spacing:0.462em;">&nbsp;</span><span class="stl_58 stl_59 stl_736" style="word-spacing:0.462em;">/*</span><span class="stl_58 stl_59 stl_736" style="word-spacing:0.3541em;">&nbsp;True</span><span class="stl_58 stl_59 stl_736" style="word-spacing:0.4891em;">&nbsp;i</span><span class="stl_58 stl_59 stl_736" style="word-spacing:-0.1629em;">&nbsp;f</span><span class="stl_58 stl_59 stl_736" style="word-spacing:0.4801em;">&nbsp;a</span><span class="stl_58 stl_59 stl_736" style="word-spacing:0.3241em;">&nbsp;random</span><span class="stl_58 stl_59 stl_736" style="word-spacing:0.2881em;">&nbsp;command</span><span class="stl_58 stl_59 stl_736" style="word-spacing:0.2881em;">&nbsp;was &nbsp;</span></div>
					<div class="stl_01" style="top: 41.9651em; left:9.6942em;"><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3206em;">c a</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3216em;">&nbsp;l</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3206em;">&nbsp;l</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3206em;">&nbsp;e</span><span class="stl_58 stl_59 stl_721" style="word-spacing:-0.3216em;">&nbsp;d</span><span class="stl_58 stl_59 stl_721" style="word-spacing:0.3944em;">&nbsp;during</span><span class="stl_58 stl_59 stl_721" style="word-spacing:0.3534em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 42.961em; left:20.46em;"><span class="stl_58 stl_59 stl_1452" style="word-spacing:0.3471em;">execution of the current</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:0.3861em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3409em;">&nbsp;c</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3399em;">&nbsp;r</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3409em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3399em;">&nbsp;p</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3409em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1452" style="word-spacing:-0.3409em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 43.9576em; left:22.5592em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 43.9576em; left:23.0324em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.416em; left:7.5658em;"><span class="stl_17 stl_18 stl_1445" style="word-spacing:0.0826em;">在执行 </span><span class="stl_10 stl_11 stl_1445" style="word-spacing:0.0826em;">lua </span><span class="stl_17 stl_18 stl_1445" style="word-spacing:0.0826em;">脚本之前，这两个参数会被置零。在执行 </span><span class="stl_10 stl_11 stl_1445" style="word-spacing:0.0826em;">lua </span><span class="stl_17 stl_18 stl_1445" style="word-spacing:0.0826em;">脚本中，但在执行命令 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;z-index:972; "><span class="stl_17 stl_18 stl_510" style="word-spacing:0.08em;">操作之前，</span><span class="stl_10 stl_11 stl_510" style="word-spacing:0.08em;">redis </span><span class="stl_17 stl_18 stl_510" style="word-spacing:0.08em;">会检测写操作之前是否发生了写操作，是则会禁止接下来的操作；否 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;"><span class="stl_17 stl_18 stl_1453" style="word-spacing:0.0891em;">则会更新上面两个变量，如果发现写操作 </span><span class="stl_10 stl_11 stl_1453" style="word-spacing:0.0891em;">lua_write_dirty = 1</span><span class="stl_17 stl_18 stl_1453" style="word-spacing:0.0891em;">；如果发现未决操作， &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">16.5. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">脏命令 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">183 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:5.9058em;"><span class="stl_10 stl_11 stl_286" style="word-spacing:0.0799em;">lua_random_dirty = 1</span><span class="stl_17 stl_18 stl_286" style="word-spacing:0.0799em;">。对于这段话的表述，有下面的流程图，大家也可以回看上一 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.9373em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">段代码： &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">184 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.7892em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 16.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0829em;">LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0821em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">脚本 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">16.6. LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0836em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0836em;">脚本的传播 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">185 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4457em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.4457em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">6.6 lua</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.126em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.126em;">脚本的传播 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.8235em; left:7.5658em;z-index:49; "><span class="stl_17 stl_18 stl_208" style="word-spacing:0.0734em;">如上所说，需要传播 </span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.0734em;">lua </span><span class="stl_17 stl_18 stl_208" style="word-spacing:0.0734em;">脚本中的数据变更，</span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.0734em;">redis </span><span class="stl_17 stl_18 stl_208" style="word-spacing:0.0734em;">的做法是直接将 </span><span class="stl_10 stl_11 stl_208" style="word-spacing:0.0734em;">lua </span><span class="stl_17 stl_18 stl_208" style="word-spacing:0.0734em;">脚本发送 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.8193em; left:5.9058em;"><span class="stl_17 stl_18 stl_35" style="word-spacing:0.0884em;">给从机和写入 </span><span class="stl_10 stl_11 stl_35" style="word-spacing:0.0884em;">AOF </span><span class="stl_17 stl_18 stl_35" style="word-spacing:0.0884em;">文件的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.8843em; left:7.5658em;"><span class="stl_10 stl_11 stl_30" style="word-spacing:0.0866em;">redis </span><span class="stl_17 stl_18 stl_30" style="word-spacing:0.0866em;">的做法是，修改执行 </span><span class="stl_10 stl_11 stl_30" style="word-spacing:0.0866em;">lua </span><span class="stl_17 stl_18 stl_30" style="word-spacing:0.0866em;">脚本客户端的参数为“</span><span class="stl_10 stl_11 stl_30" style="word-spacing:0.0866em;">EVAL</span><span class="stl_17 stl_18 stl_30" style="word-spacing:0.0866em;">”和相应的 </span><span class="stl_10 stl_11 stl_30" style="word-spacing:0.0866em;">lua </span><span class="stl_17 stl_18 stl_30" style="word-spacing:0.0866em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.8802em; left:5.9058em;"><span class="stl_17 stl_18 stl_1410" style="word-spacing:0.0874em;">文本，至于发送到从机和写入 </span><span class="stl_10 stl_11 stl_1410" style="word-spacing:0.0874em;">AOF </span><span class="stl_17 stl_18 stl_1410" style="word-spacing:0.0874em;">文件，交由主从复制机制和 </span><span class="stl_10 stl_11 stl_1410" style="word-spacing:0.0874em;">AOF </span><span class="stl_17 stl_18 stl_1410" style="word-spacing:0.0874em;">持久化机制来 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.099em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">完成。下面摘一段代码： &nbsp;</span></div>
					<div class="stl_01" style="top: 13.9451em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">TODO </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">在什么时候设置了 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">aof repl </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">标记。 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.571em; left:5.9483em;"><span class="stl_15 stl_16 stl_1426">void</span><span class="stl_15 stl_16 stl_1426" style="word-spacing:0.3087em;">&nbsp;</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:0.3087em;">evalGenericCommand</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2384em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.1454em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2524em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2524em;">&nbsp;C</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2524em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.2514em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:0.3986em;">&nbsp;*c</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.1424em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:0.4524em;">&nbsp;</span><span class="stl_15 stl_16 stl_1426" style="word-spacing:0.4524em;">int</span><span class="stl_15 stl_16 stl_1426" style="word-spacing:0.4165em;">&nbsp;</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:0.4165em;">evalsha</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.1764em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1426" style="word-spacing:-0.1764em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5718em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 18.5718em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 19.5635em; left:8.045em;"><span class="stl_15 stl_16 stl_787" style="word-spacing:-0.324em;">i f</span><span class="stl_15 stl_16 stl_787" style="word-spacing:0.3824em;">&nbsp;</span><span class="stl_10 stl_11 stl_787" style="word-spacing:0.3824em;">(</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.27em;">&nbsp;evalsha</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.269em;">&nbsp;)</span><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.269em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5593em; left:10.0375em;z-index:303; "><span class="stl_15 stl_16 stl_365" style="word-spacing:-0.3114em;">i f</span><span class="stl_15 stl_16 stl_365" style="word-spacing:0.4672em;">&nbsp;</span><span class="stl_10 stl_11 stl_365" style="word-spacing:0.4672em;">(</span><span class="stl_10 stl_11 stl_365" style="word-spacing:-0.3104em;">&nbsp;!</span><span class="stl_10 stl_11 stl_365" style="word-spacing:-0.1634em;">&nbsp;replicationScriptCacheExists</span><span class="stl_10 stl_11 stl_365" style="word-spacing:-0.2354em;">&nbsp;(</span><span class="stl_10 stl_11 stl_365" style="word-spacing:-0.2354em;">&nbsp;c</span><span class="stl_107 stl_108 stl_365" style="word-spacing:-0.2354em;">−</span><span class="stl_10 stl_11 stl_365" style="word-spacing:-0.3304em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_365" style="word-spacing:-0.3304em;">−</span><span class="stl_10 stl_11 stl_365" style="word-spacing:-0.3304em;">&gt;</span><span class="stl_10 stl_11 stl_365" style="word-spacing:-0.3234em;">&nbsp;ptr</span><span class="stl_10 stl_11 stl_365" style="word-spacing:-0.2664em;">&nbsp;)</span><span class="stl_10 stl_11 stl_365" style="word-spacing:-0.2764em;">&nbsp;)</span><span class="stl_10 stl_11 stl_365" style="word-spacing:-0.2764em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.5626em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 21.5626em; left:12.4057em;z-index:343; "><span class="stl_58 stl_59 stl_742" style="word-spacing:0.3185em;">* This</span><span class="stl_58 stl_59 stl_742" style="word-spacing:0.4255em;">&nbsp;s</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2665em;">&nbsp;c</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2655em;">&nbsp;r</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2665em;">&nbsp;i</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2655em;">&nbsp;p</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2655em;">&nbsp;t</span><span class="stl_58 stl_59 stl_742" style="word-spacing:0.4955em;">&nbsp;i</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2705em;">&nbsp;s</span><span class="stl_58 stl_59 stl_742" style="word-spacing:0.4285em;">&nbsp;not</span><span class="stl_58 stl_59 stl_742" style="word-spacing:0.37em;">&nbsp;in our</span><span class="stl_58 stl_59 stl_742" style="word-spacing:0.4165em;">&nbsp;s</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2665em;">&nbsp;c</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2655em;">&nbsp;r</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2655em;">&nbsp;i</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2665em;">&nbsp;p</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2655em;">&nbsp;t</span><span class="stl_58 stl_59 stl_742" style="word-spacing:0.4195em;">&nbsp;cache</span><span class="stl_58 stl_59 stl_742" style="word-spacing:0.4195em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 22.5585em; left:13.6833em;"><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.269em;">r e</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.267em;">&nbsp;p</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.268em;">&nbsp;l</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.268em;">&nbsp;i</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.268em;">&nbsp;c</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.268em;">&nbsp;a</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.268em;">&nbsp;t</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.268em;">&nbsp;e</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.519em;">&nbsp;i</span><span class="stl_58 stl_59 stl_671" style="word-spacing:-0.249em;">&nbsp;t</span><span class="stl_58 stl_59 stl_671" style="word-spacing:0.445em;">&nbsp;as &nbsp;</span></div>
					<div class="stl_01" style="top: 23.5551em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 23.5551em; left:13.3233em;"><span class="stl_58 stl_59 stl_70" style="word-spacing:0.4599em;">EVAL, then</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.3799em;">&nbsp;add</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.4599em;">&nbsp;i</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2071em;">&nbsp;t</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.5309em;">&nbsp;into</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.4819em;">&nbsp;the s</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2291em;">&nbsp;c</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2281em;">&nbsp;r</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2291em;">&nbsp;i</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2281em;">&nbsp;p</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.2281em;">&nbsp;t</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.4569em;">&nbsp;cache</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.0761em;">&nbsp;,</span><span class="stl_58 stl_59 stl_70" style="word-spacing:0.4459em;">&nbsp;as &nbsp;</span></div>
					<div class="stl_01" style="top: 24.5518em; left:14.0983em;"><span class="stl_58 stl_59 stl_231" style="word-spacing:0.328em;">from now on &nbsp;</span></div>
					<div class="stl_01" style="top: 25.5476em; left:12.4183em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 25.5476em; left:13.5068em;"><span class="stl_58 stl_59 stl_1454" style="word-spacing:-0.1833em;">s l</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:-0.1843em;">&nbsp;a</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:-0.1833em;">&nbsp;v</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:-0.1843em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:-0.1833em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:0.4697em;">&nbsp;and</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:0.2157em;">&nbsp;AOF know</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:0.4087em;">&nbsp;about</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:0.5547em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:-0.1533em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:-0.0063em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1454" style="word-spacing:0.4647em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 27.5401em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.5368em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.5401em; left:12.4057em;"><span class="stl_58 stl_59 stl_1169">/</span><span class="stl_58 stl_59 stl_1169" style="word-spacing:0.2324em;">&nbsp;</span><span class="stl_17 stl_18 stl_1169" style="word-spacing:0.2324em;">从</span><span class="stl_17 stl_18 stl_1169" style="word-spacing:0.3104em;">&nbsp;</span><span class="stl_58 stl_59 stl_1169" style="word-spacing:0.3104em;">server</span><span class="stl_58 stl_59 stl_1169" style="word-spacing:-0.2424em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1169" style="word-spacing:-0.2394em;">&nbsp;lua_scripts</span><span class="stl_58 stl_59 stl_1169" style="word-spacing:-0.0069em;">&nbsp;</span><span class="stl_17 stl_18 stl_1169" style="word-spacing:-0.0069em;">获 取</span><span class="stl_17 stl_18 stl_1169" style="word-spacing:0.2968em;">&nbsp;</span><span class="stl_58 stl_59 stl_1169" style="word-spacing:0.2968em;">lua</span><span class="stl_58 stl_59 stl_1169" style="word-spacing:-0.0155em;">&nbsp;</span><span class="stl_17 stl_18 stl_1169" style="word-spacing:-0.0155em;">脚</span><span class="stl_17 stl_18 stl_1169" style="word-spacing:-0.0155em;">&nbsp;本 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.5368em; left:12.4057em;z-index:470; "><span class="stl_58 stl_59 stl_1005" style="word-spacing:0.3639em;">/ c</span><span class="stl_107 stl_108 stl_1005" style="word-spacing:0.3639em;">−</span><span class="stl_58 stl_59 stl_1005" style="word-spacing:0.3639em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_1005" style="word-spacing:0.3639em;">−</span><span class="stl_58 stl_59 stl_1005" style="word-spacing:0.3639em;">&gt;</span><span class="stl_58 stl_59 stl_1005" style="word-spacing:-0.1681em;">&nbsp;ptr</span><span class="stl_58 stl_59 stl_1005" style="word-spacing:0.4921em;">&nbsp;</span><span class="stl_17 stl_18 stl_1005" style="word-spacing:0.4921em;">是</span><span class="stl_17 stl_18 stl_1005" style="word-spacing:0.326em;">&nbsp;</span><span class="stl_58 stl_59 stl_1005" style="word-spacing:0.326em;">SHA1 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.531em; left:11.9908em;z-index:491; "><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.0074em;">robj * s</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.3362em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.3372em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.3362em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.3362em;">&nbsp;p</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.3362em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:0.1748em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.1534em;">&nbsp;dictFetchValue (</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.2512em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.1952em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.2112em;">&nbsp;lua_scripts</span><span class="stl_10 stl_11 stl_1286" style="word-spacing:-0.2112em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 30.5276em; left:13.5867em;z-index:527; "><span class="stl_10 stl_11 stl_500" style="word-spacing:-0.1558em;">c</span><span class="stl_107 stl_108 stl_500" style="word-spacing:-0.1558em;">−</span><span class="stl_10 stl_11 stl_500" style="word-spacing:-0.1558em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_500" style="word-spacing:-0.1558em;">−</span><span class="stl_10 stl_11 stl_500" style="word-spacing:-0.1558em;">&gt; ptr ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.5218em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.5218em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">添</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;加</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;到</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;复</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;制</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;专</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;脚</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;本</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;缓</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;中 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.516em; left:11.9867em;z-index:596; "><span class="stl_10 stl_11 stl_561" style="word-spacing:-0.2472em;">replicationScriptCacheAdd ( c</span><span class="stl_107 stl_108 stl_561" style="word-spacing:-0.2472em;">−</span><span class="stl_10 stl_11 stl_561" style="word-spacing:-0.2472em;">&gt;argv[1]</span><span class="stl_107 stl_108 stl_561" style="word-spacing:-0.2472em;">−</span><span class="stl_10 stl_11 stl_561" style="word-spacing:-0.2472em;">&gt; ptr ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.5127em; left:11.9908em;z-index:637; "><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.1711em;">redisAssertWithInfo (</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.2481em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.1411em;">&nbsp;,NULL,</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.0811em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.2421em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.2421em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.2431em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.2421em;">&nbsp;p</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.2421em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:0.4059em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:0.1719em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:0.1719em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5068em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 37.5026em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.4993em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.4951em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.5068em; left:12.4057em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">重</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;写</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5026em; left:12.4057em;"><span class="stl_58 stl_59 stl_1456">/</span><span class="stl_58 stl_59 stl_1456" style="word-spacing:0.5278em;">&nbsp;</span><span class="stl_17 stl_18 stl_1456" style="word-spacing:0.5278em;">参</span><span class="stl_17 stl_18 stl_1456" style="word-spacing:-0.033em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1456" style="word-spacing:0.5129em;">&nbsp;</span><span class="stl_58 stl_59 stl_1456" style="word-spacing:0.5129em;">1</span><span class="stl_58 stl_59 stl_1456" style="word-spacing:0.5457em;">&nbsp;</span><span class="stl_17 stl_18 stl_1456" style="word-spacing:0.5457em;">为：</span><span class="stl_58 stl_59 stl_1456" style="word-spacing:0.5457em;">EVAL &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4993em; left:12.4057em;"><span class="stl_58 stl_59 stl_1055">/</span><span class="stl_58 stl_59 stl_1055" style="word-spacing:-0.0446em;">&nbsp;</span><span class="stl_17 stl_18 stl_1055" style="word-spacing:-0.0446em;">参 数</span><span class="stl_17 stl_18 stl_1055" style="word-spacing:0.2209em;">&nbsp;</span><span class="stl_58 stl_59 stl_1055" style="word-spacing:0.2209em;">2</span><span class="stl_58 stl_59 stl_1055" style="word-spacing:0.2538em;">&nbsp;</span><span class="stl_17 stl_18 stl_1055" style="word-spacing:0.2538em;">为：</span><span class="stl_17 stl_18 stl_1055" style="word-spacing:-0.2531em;">&nbsp;</span><span class="stl_58 stl_59 stl_1055" style="word-spacing:-0.2531em;">lua_script &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4951em; left:12.4057em;"><span class="stl_58 stl_59 stl_1457">/</span><span class="stl_58 stl_59 stl_1457" style="word-spacing:0.4294em;">&nbsp;</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:0.4294em;">如</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1314em;">&nbsp;此</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;一</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;来</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;在</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;执</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;行</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:0.2792em;">&nbsp;</span><span class="stl_58 stl_59 stl_1457" style="word-spacing:0.2792em;">AOF</span><span class="stl_58 stl_59 stl_1457" style="word-spacing:0.2782em;">&nbsp;</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:0.2782em;">持</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;久</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;化</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;和</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;主</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;从</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;复</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;制</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.1304em;">&nbsp;时</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.0974em;">&nbsp;候，</span><span class="stl_17 stl_18 stl_1457" style="word-spacing:-0.074em;">&nbsp;</span><span class="stl_58 stl_59 stl_1457" style="word-spacing:-0.074em;">lua &nbsp;</span></div>
					<div class="stl_01" style="top: 40.7123em; left:14.125em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0501em;">脚 本 就 能 得 到 传 播 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.486em; left:11.945em;"><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1912em;">rewriteClientCommandArgument ( c , 0 , &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4826em; left:13.9667em;"><span class="stl_10 stl_11 stl_383" style="word-spacing:-0.2139em;">resetRefCount ( createStringObject ( ”EVAL” ,4) ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4785em; left:11.945em;"><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1904em;">rewriteClientCommandArgument ( c , 1 , s c r i p t ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4752em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 45.471em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.4677em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">186 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:22.7892em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 16.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0829em;">LUA</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0821em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">脚本 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4457em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.4457em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">6.7 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">总结 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.6893em; left:7.5658em;"><span class="stl_10 stl_11 stl_1458" style="word-spacing:0.0855em;">redis </span><span class="stl_17 stl_18 stl_1458" style="word-spacing:0.0855em;">服务器的工作模式是单进程单线程，因为开发人员在写 </span><span class="stl_10 stl_11 stl_1458" style="word-spacing:0.0855em;">lua </span><span class="stl_17 stl_18 stl_1458" style="word-spacing:0.0855em;">脚本的时候应 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.6851em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">该特别注意时间复杂度的问题，不要让 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">脚本影响整个 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0826em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0826em;">服务器的性能。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.958em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 17 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.7523em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1247em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1247em;">监视机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5916em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 20.5916em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">7.1 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1259em;">哨兵的服务框架 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.8976em; left:7.5658em;"><span class="stl_17 stl_18 stl_984" style="word-spacing:0.0884em;">哨兵也是 </span><span class="stl_10 stl_11 stl_984" style="word-spacing:0.0884em;">redis </span><span class="stl_17 stl_18 stl_984" style="word-spacing:0.0884em;">服务器，只是它与我们平时提到的 </span><span class="stl_10 stl_11 stl_984" style="word-spacing:0.0884em;">redis </span><span class="stl_17 stl_18 stl_984" style="word-spacing:0.0884em;">服务器职能不同，哨兵 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.8943em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0839em;">负责监视普通的 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0839em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0839em;">服务器，提高一个服务器集群的健壮和可靠性。哨兵和普通的 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.8901em; left:5.9058em;"><span class="stl_10 stl_11 stl_1459" style="word-spacing:0.0853em;">redis </span><span class="stl_17 stl_18 stl_1459" style="word-spacing:0.0853em;">服务器所用的是同一套服务器框架，这包括：网络框架，底层数据结构，订阅发 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.109em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">布机制等。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.9135em; left:7.5658em;"><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0833em;">从主函数开始，来看看哨兵服务器是怎么诞生，它在什么时候和普通的 </span><span class="stl_10 stl_11 stl_28" style="word-spacing:0.0833em;">redis </span><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0833em;">服 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.1315em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">务器分道扬镳： &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4593em; left:5.9875em;"><span class="stl_15 stl_16 stl_57">int</span><span class="stl_15 stl_16 stl_57" style="word-spacing:0.3427em;">&nbsp;</span><span class="stl_10 stl_11 stl_57" style="word-spacing:0.3427em;">main</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.2499em;">&nbsp;(</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.1986em;">&nbsp;</span><span class="stl_15 stl_16 stl_57" style="word-spacing:-0.1986em;">int</span><span class="stl_15 stl_16 stl_57" style="word-spacing:0.3899em;">&nbsp;</span><span class="stl_10 stl_11 stl_57" style="word-spacing:0.3899em;">argc</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.0539em;">&nbsp;,</span><span class="stl_10 stl_11 stl_57" style="word-spacing:0.4012em;">&nbsp;</span><span class="stl_15 stl_16 stl_57" style="word-spacing:0.4012em;">char</span><span class="stl_15 stl_16 stl_57" style="word-spacing:0.3072em;">&nbsp;</span><span class="stl_10 stl_11 stl_57" style="word-spacing:0.3072em;">**</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.2409em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.2009em;">&nbsp;)</span><span class="stl_10 stl_11 stl_57" style="word-spacing:-0.2009em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4593em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.4593em; left:8.4207em;"><span class="stl_58 stl_59 stl_1460">/</span><span class="stl_58 stl_59 stl_1460" style="word-spacing:0.311em;">&nbsp;</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:0.311em;">随</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2498em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;种</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2158em;">&nbsp;子，</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2158em;">&nbsp;一</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;般</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:0.3304em;">&nbsp;</span><span class="stl_58 stl_59 stl_1460" style="word-spacing:0.3304em;">rand</span><span class="stl_58 stl_59 stl_1460" style="word-spacing:-0.2428em;">&nbsp;()</span><span class="stl_58 stl_59 stl_1460" style="word-spacing:0.3788em;">&nbsp;</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:0.3788em;">产</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;生</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;随</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;机</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;函</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;会</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;用</span><span class="stl_17 stl_18 stl_1460" style="word-spacing:-0.2488em;">&nbsp;到 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4535em; left:7.9817em;"><span class="stl_10 stl_11 stl_1461" style="word-spacing:-0.178em;">srand ( time (NULL)^getpid () ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4502em; left:7.9958em;"><span class="stl_10 stl_11 stl_1398" style="word-spacing:-0.1155em;">gettimeofday(&amp;tv ,NULL) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.446em; left:7.9883em;"><span class="stl_10 stl_11 stl_685" style="word-spacing:-0.2194em;">dictSetHashFunctionSeed ( tv . tv_sec^tv . tv_usec^getpid () ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.4401em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">通</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;过</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;命</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;令</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;参</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;确</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;认</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;是</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;否</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;启</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;动</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;模</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;式 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4352em; left:8.0175em;"><span class="stl_10 stl_11 stl_1318" style="word-spacing:-0.154em;">server .</span><span class="stl_10 stl_11 stl_1318" style="word-spacing:-0.2em;">&nbsp;sentinel_mode</span><span class="stl_10 stl_11 stl_1318" style="word-spacing:0.152em;">&nbsp;= checkForSentinelMode</span><span class="stl_10 stl_11 stl_1318" style="word-spacing:-0.253em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1318" style="word-spacing:-0.259em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_1318" style="word-spacing:-0.11em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1318" style="word-spacing:-0.202em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_1318" style="word-spacing:-0.257em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1318" style="word-spacing:-0.257em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:7.4492em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.4326em; left:7.9224em;"><span class="stl_58 stl_59 stl_60">/</span><span class="stl_58 stl_59 stl_60" style="word-spacing:-0.1059em;">&nbsp;</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.1059em;">初 始</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;化</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;服</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;务</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;器</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;配</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.2984em;">&nbsp;置，</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.2994em;">&nbsp;主</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;要</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;是</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;填</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;充</span><span class="stl_17 stl_18 stl_60" style="word-spacing:0.3102em;">&nbsp;</span><span class="stl_58 stl_59 stl_60" style="word-spacing:0.3102em;">redisServer</span><span class="stl_58 stl_59 stl_60" style="word-spacing:-0.0222em;">&nbsp;</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.0222em;">结 构</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;体</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;中</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;的</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;各</span><span class="stl_17 stl_18 stl_60" style="word-spacing:-0.3324em;">&nbsp;种 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.6499em; left:9.1433em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">参 数 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:8.0192em;"><span class="stl_10 stl_11 stl_61" style="word-spacing:-0.2472em;">initServerConfig () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4207em;"><span class="stl_58 stl_59 stl_519">/</span><span class="stl_58 stl_59 stl_519" style="word-spacing:-0.1228em;">&nbsp;</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.1228em;">将 服</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;务</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;器</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;配</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;置</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;为</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;模</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3068em;">&nbsp;式，</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3078em;">&nbsp;与</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;普</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;通</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;的</span><span class="stl_17 stl_18 stl_519" style="word-spacing:0.3076em;">&nbsp;</span><span class="stl_58 stl_59 stl_519" style="word-spacing:0.3076em;">redis</span><span class="stl_58 stl_59 stl_519" style="word-spacing:-0.0335em;">&nbsp;</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.0335em;">服 务</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;器</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;不</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;同 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:8.4207em;"><span class="stl_58 stl_59 stl_701" style="word-spacing:0.1464em;">* We</span><span class="stl_58 stl_59 stl_701" style="word-spacing:0.1674em;">&nbsp;need</span><span class="stl_58 stl_59 stl_701" style="word-spacing:0.3734em;">&nbsp;to</span><span class="stl_58 stl_59 stl_701" style="word-spacing:0.4704em;">&nbsp;i</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2476em;">&nbsp;n</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2486em;">&nbsp;i</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2476em;">&nbsp;t</span><span class="stl_58 stl_59 stl_701" style="word-spacing:0.5124em;">&nbsp;s</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2646em;">&nbsp;e</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2656em;">&nbsp;n</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2656em;">&nbsp;t</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2646em;">&nbsp;i</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2656em;">&nbsp;n</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2656em;">&nbsp;e</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2646em;">&nbsp;l</span><span class="stl_58 stl_59 stl_701" style="word-spacing:0.4954em;">&nbsp;r</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2646em;">&nbsp;i</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2656em;">&nbsp;g</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2646em;">&nbsp;h</span><span class="stl_58 stl_59 stl_701" style="word-spacing:-0.2656em;">&nbsp;t</span><span class="stl_58 stl_59 stl_701" style="word-spacing:0.3504em;">&nbsp;now</span><span class="stl_58 stl_59 stl_701" style="word-spacing:0.2834em;">&nbsp;as</span><span class="stl_58 stl_59 stl_701" style="word-spacing:0.4099em;">&nbsp;parsing</span><span class="stl_58 stl_59 stl_701" style="word-spacing:0.4099em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:9.6775em;"><span class="stl_58 stl_59 stl_398" style="word-spacing:0.4197em;">configuration f</span><span class="stl_58 stl_59 stl_398" style="word-spacing:-0.3233em;">&nbsp;i</span><span class="stl_58 stl_59 stl_398" style="word-spacing:-0.3233em;">&nbsp;l</span><span class="stl_58 stl_59 stl_398" style="word-spacing:-0.3233em;">&nbsp;e &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">87 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">188 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 17.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">监视机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 7.7135em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.4836em;"><span class="stl_58 stl_59 stl_464" style="word-spacing:0.4062em;">in s</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3048em;">&nbsp;e</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3038em;">&nbsp;n</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3048em;">&nbsp;t</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3038em;">&nbsp;i</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3048em;">&nbsp;n</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3048em;">&nbsp;e</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.3038em;">&nbsp;l</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.3262em;">&nbsp;mode w</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2818em;">&nbsp;i</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2828em;">&nbsp;l</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2818em;">&nbsp;l</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.4092em;">&nbsp;have</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.3502em;">&nbsp;the</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.4402em;">&nbsp;e</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2838em;">&nbsp;f</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2838em;">&nbsp;f</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2838em;">&nbsp;e</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2838em;">&nbsp;c</span><span class="stl_58 stl_59 stl_464" style="word-spacing:-0.2838em;">&nbsp;t</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.4432em;">&nbsp;of</span><span class="stl_58 stl_59 stl_464" style="word-spacing:0.3982em;">&nbsp;populating &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:10.16em;"><span class="stl_58 stl_59 stl_939" style="word-spacing:0.387em;">the s</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.336em;">&nbsp;e</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;n</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;t</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.336em;">&nbsp;i</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;n</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;e</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.337em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:9.4811em;"><span class="stl_58 stl_59 stl_361" style="word-spacing:0.4159em;">data s</span><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.2921em;">&nbsp;t</span><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.2911em;">&nbsp;r</span><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.2911em;">&nbsp;u</span><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.2921em;">&nbsp;c</span><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.2911em;">&nbsp;t</span><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.2911em;">&nbsp;u</span><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.2911em;">&nbsp;r</span><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.2921em;">&nbsp;e</span><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.2911em;">&nbsp;s</span><span class="stl_58 stl_59 stl_361" style="word-spacing:0.4259em;">&nbsp;with</span><span class="stl_58 stl_59 stl_361" style="word-spacing:0.3597em;">&nbsp;master nodes to monitor</span><span class="stl_58 stl_59 stl_361" style="word-spacing:-0.2051em;">&nbsp;.</span><span class="stl_58 stl_59 stl_361" style="word-spacing:0.3609em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:8.045em;"><span class="stl_15 stl_16 stl_664" style="word-spacing:-0.2974em;">i f</span><span class="stl_15 stl_16 stl_664" style="word-spacing:0.409em;">&nbsp;</span><span class="stl_10 stl_11 stl_664" style="word-spacing:0.409em;">(</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.2244em;">&nbsp;server</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.1684em;">&nbsp;.</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.2134em;">&nbsp;sentinel_mode</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.2694em;">&nbsp;)</span><span class="stl_10 stl_11 stl_664" style="word-spacing:-0.2694em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:10.4132em;"><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.041em;">/ i n</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;i</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;t</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.349em;">&nbsp;S</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;e</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;n</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;t</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;i</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;n</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;e</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;l</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;C</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.349em;">&nbsp;o</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;n</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;f</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;i</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.35em;">&nbsp;g</span><span class="stl_58 stl_59 stl_272" style="word-spacing:-0.222em;">&nbsp;()</span><span class="stl_58 stl_59 stl_272" style="word-spacing:0.3234em;">&nbsp;</span><span class="stl_17 stl_18 stl_272" style="word-spacing:0.3234em;">只</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.305em;">&nbsp;指</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;定</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;服</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;务</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;器</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;的</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;端</span><span class="stl_17 stl_18 stl_272" style="word-spacing:-0.304em;">&nbsp;口 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:10.0192em;"><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.3624em;">i n i t S e n t i n e l C o n f i g () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:10.0308em;"><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.3419em;">i n i t S e n t i n e l () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 13.6893em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 13.6893em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:8.4207em;"><span class="stl_58 stl_59 stl_430">/</span><span class="stl_58 stl_59 stl_430" style="word-spacing:-0.0671em;">&nbsp;</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.0671em;">普 通</span><span class="stl_17 stl_18 stl_430" style="word-spacing:0.3028em;">&nbsp;</span><span class="stl_58 stl_59 stl_430" style="word-spacing:0.3028em;">redis</span><span class="stl_58 stl_59 stl_430" style="word-spacing:-0.0439em;">&nbsp;</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.0439em;">服 务</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;器</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;模</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;式 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6735em; left:8.045em;"><span class="stl_15 stl_16 stl_1462" style="word-spacing:-0.2975em;">i f</span><span class="stl_15 stl_16 stl_1462" style="word-spacing:0.4811em;">&nbsp;</span><span class="stl_10 stl_11 stl_1462" style="word-spacing:0.4811em;">(</span><span class="stl_10 stl_11 stl_1462" style="word-spacing:-0.2965em;">&nbsp;!</span><span class="stl_10 stl_11 stl_1462" style="word-spacing:-0.1515em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1462" style="word-spacing:-0.1685em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1462" style="word-spacing:-0.2145em;">&nbsp;sentinel_mode</span><span class="stl_10 stl_11 stl_1462" style="word-spacing:-0.2705em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1462" style="word-spacing:-0.2705em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6668em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 17.6743em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">哨</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;服</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;务</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;器</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;模</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;式 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:8.9892em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:10.4132em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">检</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;测</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;模</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;式</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;是</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;否</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;正</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;常</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;配</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;置 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:10em;"><span class="stl_10 stl_11 stl_1463" style="word-spacing:-0.2265em;">sentinelIsRunning () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 23.6518em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 23.6518em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;入</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;循</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;环 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.646em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.641em; left:7.9458em;"><span class="stl_10 stl_11 stl_63" style="word-spacing:-0.2044em;">aeMain ( server . e l ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">去</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;除</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;事</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;循</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;环</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;系</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;统 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:7.9775em;"><span class="stl_10 stl_11 stl_152" style="word-spacing:-0.2111em;">aeDeleteEventLoop ( server . e l ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:7.9458em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 33.0393em; left:7.5658em;"><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0834em;">在上面，通过判断命令行参数来判断 </span><span class="stl_10 stl_11 stl_28" style="word-spacing:0.0834em;">redis </span><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0834em;">服务器是否启用哨兵模式，会设置服 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.036em; left:5.9058em;"><span class="stl_17 stl_18 stl_1309" style="word-spacing:0.0633em;">务器参数结构体中的 </span><span class="stl_10 stl_11 stl_1309" style="word-spacing:0.0633em;">redisServer.sentinel_mode </span><span class="stl_17 stl_18 stl_1309" style="word-spacing:0.0633em;">的值。在上面的主函数调用了一个很 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.0318em; left:5.9058em;"><span class="stl_17 stl_18 stl_1464">关键的函数：</span><span class="stl_10 stl_11 stl_1464">initSentinel()</span><span class="stl_17 stl_18 stl_1464">，它完成了哨兵服务器特有的初始化程序，包括填充哨兵 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.0285em; left:5.9058em;"><span class="stl_17 stl_18 stl_576" style="word-spacing:0.0848em;">服务器特有的命令表，</span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.0848em;">struct sentinel </span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.0848em;">结构体。 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 40.4368em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 39.4401em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">哨</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;服</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;务</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;器</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;特</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;有</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;初</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;始</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;化</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;程</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;序 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:6.4282em;"><span class="stl_58 stl_59 stl_700" style="word-spacing:0.2909em;">* Perform</span><span class="stl_58 stl_59 stl_700" style="word-spacing:0.3559em;">&nbsp;the</span><span class="stl_58 stl_59 stl_700" style="word-spacing:0.4269em;">&nbsp;Sentinel</span><span class="stl_58 stl_59 stl_700" style="word-spacing:0.3229em;">&nbsp;mode</span><span class="stl_58 stl_59 stl_700" style="word-spacing:0.3709em;">&nbsp;i</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;n</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;i</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;t</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;i</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;a</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;l</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;i</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;z</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;a</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2501em;">&nbsp;t</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;i</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;o</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.2491em;">&nbsp;n</span><span class="stl_58 stl_59 stl_700" style="word-spacing:-0.1021em;">&nbsp;.</span><span class="stl_58 stl_59 stl_700" style="word-spacing:0.3649em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:5.9483em;"><span class="stl_15 stl_16 stl_1094">void</span><span class="stl_15 stl_16 stl_1094" style="word-spacing:0.4675em;">&nbsp;</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:0.4675em;">i</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.186em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.184em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.185em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.185em;">&nbsp;S</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.185em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.185em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.185em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.185em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.185em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.185em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.185em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.079em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.1966em;">&nbsp;</span><span class="stl_15 stl_16 stl_1094" style="word-spacing:-0.1966em;">void</span><span class="stl_15 stl_16 stl_1094" style="word-spacing:-0.1959em;">&nbsp;</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.1959em;">)</span><span class="stl_10 stl_11 stl_1094" style="word-spacing:-0.1959em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.3991em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">j</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.3991em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4218em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.4218em; left:8.4207em;"><span class="stl_58 stl_59 stl_394">/</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.0569em;">&nbsp;</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.0569em;">如 果</span><span class="stl_17 stl_18 stl_394" style="word-spacing:0.3129em;">&nbsp;</span><span class="stl_58 stl_59 stl_394" style="word-spacing:0.3129em;">redis</span><span class="stl_58 stl_59 stl_394" style="word-spacing:-0.0235em;">&nbsp;</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.0235em;">服 务</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;器</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;是</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;模</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3033em;">&nbsp;式，</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3023em;">&nbsp;则</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;清</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;空</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;命</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;令</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;列</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3033em;">&nbsp;表。</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3023em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;会</span><span class="stl_17 stl_18 stl_394" style="word-spacing:-0.3363em;">&nbsp;有 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:9.6417em;"><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3414em;">一 套</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;专</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;门</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;命</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;令</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;列</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3064em;">&nbsp;表，</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3074em;">&nbsp;这</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;与</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;普</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;通</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3394em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:0.3076em;">&nbsp;</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:0.3076em;">redis</span><span class="stl_58 stl_59 stl_1157" style="word-spacing:-0.0317em;">&nbsp;</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.0317em;">服 务</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;器</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;不</span><span class="stl_17 stl_18 stl_1157" style="word-spacing:-0.3404em;">&nbsp;同 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:8.4207em;"><span class="stl_58 stl_59 stl_437" style="word-spacing:0.3072em;">* Remove</span><span class="stl_58 stl_59 stl_437" style="word-spacing:0.3732em;">&nbsp;usual</span><span class="stl_58 stl_59 stl_437" style="word-spacing:0.4472em;">&nbsp;Redis</span><span class="stl_58 stl_59 stl_437" style="word-spacing:0.3302em;">&nbsp;commands from</span><span class="stl_58 stl_59 stl_437" style="word-spacing:0.4172em;">&nbsp;the</span><span class="stl_58 stl_59 stl_437" style="word-spacing:0.3582em;">&nbsp;command table</span><span class="stl_58 stl_59 stl_437" style="word-spacing:0.3582em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:9.6475em;"><span class="stl_58 stl_59 stl_742" style="word-spacing:0.4384em;">then j</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2686em;">&nbsp;u</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2686em;">&nbsp;s</span><span class="stl_58 stl_59 stl_742" style="word-spacing:-0.2686em;">&nbsp;t</span><span class="stl_58 stl_59 stl_742" style="word-spacing:0.3984em;">&nbsp;add &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">17.1. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">哨兵的服务框架 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">189 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.721em; left:8.4333em;"><span class="stl_58 stl_59 stl_07">*</span></div>
					<div class="stl_01" style="top: 5.721em; left:9.4952em;"><span class="stl_58 stl_59 stl_1465" style="word-spacing:0.4129em;">the SENTINEL</span><span class="stl_58 stl_59 stl_1465" style="word-spacing:0.2889em;">&nbsp;command.</span><span class="stl_58 stl_59 stl_1465" style="word-spacing:0.5319em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:7.96em;"><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1291em;">dictEmpty ( server . commands ,NULL) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4207em;"><span class="stl_58 stl_59 stl_1466">/</span><span class="stl_58 stl_59 stl_1466" style="word-spacing:0.3145em;">&nbsp;</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:0.3145em;">将</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:0.3815em;">&nbsp;</span><span class="stl_58 stl_59 stl_1466" style="word-spacing:0.3815em;">sentinelcmds</span><span class="stl_58 stl_59 stl_1466" style="word-spacing:0.3825em;">&nbsp;</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:0.3825em;">命</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:-0.2463em;">&nbsp;令</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:-0.2453em;">&nbsp;列</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:-0.2453em;">&nbsp;表</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:-0.2453em;">&nbsp;中</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:-0.2453em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:-0.2453em;">&nbsp;命</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:-0.2453em;">&nbsp;令</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:-0.2453em;">&nbsp;填</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:-0.2453em;">&nbsp;充</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:-0.2453em;">&nbsp;到</span><span class="stl_17 stl_18 stl_1466" style="word-spacing:0.3929em;">&nbsp;</span><span class="stl_58 stl_59 stl_1466" style="word-spacing:0.3929em;">server</span><span class="stl_58 stl_59 stl_1466" style="word-spacing:-0.1613em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1466" style="word-spacing:-0.2763em;">&nbsp;commands &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:7.9808em;"><span class="stl_15 stl_16 stl_692">for</span><span class="stl_15 stl_16 stl_692" style="word-spacing:0.308em;">&nbsp;</span><span class="stl_10 stl_11 stl_692" style="word-spacing:0.308em;">(</span><span class="stl_10 stl_11 stl_692" style="word-spacing:-0.2459em;">&nbsp;j</span><span class="stl_10 stl_11 stl_692" style="word-spacing:0.1571em;">&nbsp;= 0;</span><span class="stl_10 stl_11 stl_692" style="word-spacing:0.3901em;">&nbsp;j</span><span class="stl_10 stl_11 stl_692" style="word-spacing:0.1301em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_692" style="word-spacing:0.1668em;">&nbsp;</span><span class="stl_15 stl_16 stl_692" style="word-spacing:0.1668em;">sizeof</span><span class="stl_15 stl_16 stl_692" style="word-spacing:-0.2686em;">&nbsp;</span><span class="stl_10 stl_11 stl_692" style="word-spacing:-0.2686em;">(</span><span class="stl_10 stl_11 stl_692" style="word-spacing:-0.2679em;">&nbsp;sentinelcmds</span><span class="stl_10 stl_11 stl_692" style="word-spacing:-0.2669em;">&nbsp;)</span><span class="stl_10 stl_11 stl_692" style="word-spacing:-0.3419em;">&nbsp;/</span><span class="stl_10 stl_11 stl_692" style="word-spacing:-0.3245em;">&nbsp;</span><span class="stl_15 stl_16 stl_692" style="word-spacing:-0.3245em;">sizeof</span><span class="stl_15 stl_16 stl_692" style="word-spacing:-0.2686em;">&nbsp;</span><span class="stl_10 stl_11 stl_692" style="word-spacing:-0.2686em;">(</span><span class="stl_10 stl_11 stl_692" style="word-spacing:-0.2679em;">&nbsp;sentinelcmds &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:9.7167em;"><span class="stl_10 stl_11 stl_07">[</span></div>
					<div class="stl_01" style="top: 10.7001em; left:10.1061em;"><span class="stl_10 stl_11 stl_1131" style="word-spacing:-0.085em;">0 ]</span><span class="stl_10 stl_11 stl_1131" style="word-spacing:-0.085em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1131" style="word-spacing:0.076em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1131" style="word-spacing:0.632em;">&nbsp;j++)</span><span class="stl_10 stl_11 stl_1131" style="word-spacing:0.632em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:9.9725em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.4051em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4051em;">r</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.295em;">&nbsp;e</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;t</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;v</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.295em;">&nbsp;a</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;l</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:9.965em;"><span class="stl_15 stl_16 stl_526">struct</span><span class="stl_15 stl_16 stl_526" style="word-spacing:0.3338em;">&nbsp;</span><span class="stl_10 stl_11 stl_526" style="word-spacing:0.3338em;">redisCommand</span><span class="stl_10 stl_11 stl_526" style="word-spacing:0.2934em;">&nbsp;*cmd</span><span class="stl_10 stl_11 stl_526" style="word-spacing:0.0964em;">&nbsp;=</span><span class="stl_10 stl_11 stl_526" style="word-spacing:0.2304em;">&nbsp;sentinelcmds+j</span><span class="stl_10 stl_11 stl_526" style="word-spacing:0.2304em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:10.0175em;z-index:265; "><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1964em;">r e</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1954em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1954em;">&nbsp;v</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1964em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1954em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:0.3156em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:0.2466em;">&nbsp;dictAdd</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1594em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.0994em;">&nbsp;server</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.0434em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1694em;">&nbsp;commands</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1504em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:0.4886em;">&nbsp;sdsnew</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1674em;">&nbsp;(cmd</span><span class="stl_107 stl_108 stl_1467" style="word-spacing:-0.1674em;">−</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1674em;">&gt;name)</span><span class="stl_10 stl_11 stl_1467" style="word-spacing:-0.1674em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:11.5442em;"><span class="stl_10 stl_11 stl_962" style="word-spacing:-0.0363em;">cmd) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:10.0133em;"><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.0941em;">redisAssert (</span><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.0891em;">&nbsp;r</span><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.1941em;">&nbsp;e</span><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.1941em;">&nbsp;t</span><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.1941em;">&nbsp;v</span><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.1951em;">&nbsp;a</span><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.1941em;">&nbsp;l</span><span class="stl_10 stl_11 stl_160" style="word-spacing:0.2869em;">&nbsp;==</span><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.0156em;">&nbsp;DICT_OK)</span><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.0156em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4207em;"><span class="stl_58 stl_59 stl_367" style="word-spacing:0.3734em;">* I</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.2866em;">&nbsp;n</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.2856em;">&nbsp;i</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.2856em;">&nbsp;t</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.2866em;">&nbsp;i</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.2856em;">&nbsp;a</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.2866em;">&nbsp;l</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.2856em;">&nbsp;i</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.2856em;">&nbsp;z</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.2866em;">&nbsp;e</span><span class="stl_58 stl_59 stl_367" style="word-spacing:0.4444em;">&nbsp;various</span><span class="stl_58 stl_59 stl_367" style="word-spacing:0.3659em;">&nbsp;data s</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3296em;">&nbsp;t</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3306em;">&nbsp;r</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3296em;">&nbsp;u</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3296em;">&nbsp;c</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3296em;">&nbsp;t</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3306em;">&nbsp;u</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3296em;">&nbsp;r</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3296em;">&nbsp;e</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.3296em;">&nbsp;s</span><span class="stl_58 stl_59 stl_367" style="word-spacing:-0.1836em;">&nbsp;.</span><span class="stl_58 stl_59 stl_367" style="word-spacing:0.3234em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:8.4207em;"><span class="stl_58 stl_59 stl_702" style="word-spacing:0.3688em;">/ s</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2892em;">&nbsp;e</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2902em;">&nbsp;n</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2902em;">&nbsp;t</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2892em;">&nbsp;i</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2902em;">&nbsp;n</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2902em;">&nbsp;e</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2892em;">&nbsp;l</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.1432em;">&nbsp;.</span><span class="stl_58 stl_59 stl_702" style="word-spacing:-0.2042em;">&nbsp;current_epoch</span><span class="stl_58 stl_59 stl_702" style="word-spacing:0.3497em;">&nbsp;</span><span class="stl_17 stl_18 stl_702" style="word-spacing:0.3497em;">用</span><span class="stl_17 stl_18 stl_702" style="word-spacing:-0.2512em;">&nbsp;以</span><span class="stl_17 stl_18 stl_702" style="word-spacing:-0.2512em;">&nbsp;指</span><span class="stl_17 stl_18 stl_702" style="word-spacing:-0.2512em;">&nbsp;定</span><span class="stl_17 stl_18 stl_702" style="word-spacing:-0.2512em;">&nbsp;版</span><span class="stl_17 stl_18 stl_702" style="word-spacing:-0.2512em;">&nbsp;本 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:8.0325em;"><span class="stl_10 stl_11 stl_553" style="word-spacing:-0.2912em;">s e</span><span class="stl_10 stl_11 stl_553" style="word-spacing:-0.2902em;">&nbsp;n</span><span class="stl_10 stl_11 stl_553" style="word-spacing:-0.2912em;">&nbsp;t</span><span class="stl_10 stl_11 stl_553" style="word-spacing:-0.2912em;">&nbsp;i</span><span class="stl_10 stl_11 stl_553" style="word-spacing:-0.2902em;">&nbsp;n</span><span class="stl_10 stl_11 stl_553" style="word-spacing:-0.2912em;">&nbsp;e</span><span class="stl_10 stl_11 stl_553" style="word-spacing:-0.2912em;">&nbsp;l</span><span class="stl_10 stl_11 stl_553" style="word-spacing:-0.1292em;">&nbsp;.</span><span class="stl_10 stl_11 stl_553" style="word-spacing:-0.1942em;">&nbsp;current_epoch</span><span class="stl_10 stl_11 stl_553" style="word-spacing:0.1568em;">&nbsp;=</span><span class="stl_10 stl_11 stl_553" style="word-spacing:0.1978em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6576em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.6576em; left:8.4207em;"><span class="stl_58 stl_59 stl_76">/</span><span class="stl_58 stl_59 stl_76" style="word-spacing:-0.1352em;">&nbsp;</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.1352em;">哨 兵</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.347em;">&nbsp;监</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.347em;">&nbsp;视</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.347em;">&nbsp;的</span><span class="stl_17 stl_18 stl_76" style="word-spacing:0.3016em;">&nbsp;</span><span class="stl_58 stl_59 stl_76" style="word-spacing:0.3016em;">redis</span><span class="stl_58 stl_59 stl_76" style="word-spacing:-0.0459em;">&nbsp;</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.0459em;">服 务</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.347em;">&nbsp;器</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.347em;">&nbsp;哈</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.347em;">&nbsp;希</span><span class="stl_17 stl_18 stl_76" style="word-spacing:-0.347em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:8.0325em;"><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2828em;">s e</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2818em;">&nbsp;n</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2828em;">&nbsp;t</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2828em;">&nbsp;i</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2818em;">&nbsp;n</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2828em;">&nbsp;e</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.2828em;">&nbsp;l</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.1208em;">&nbsp;.</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.1778em;">&nbsp;masters</span><span class="stl_10 stl_11 stl_550" style="word-spacing:0.1732em;">&nbsp;=</span><span class="stl_10 stl_11 stl_550" style="word-spacing:0.1972em;">&nbsp;dictCreate(&amp;instancesDictType</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.0608em;">&nbsp;,NULL)</span><span class="stl_10 stl_11 stl_550" style="word-spacing:-0.0608em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:8.4207em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:0.57em;">/ s</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.088em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.089em;">&nbsp;n</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.089em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.088em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.089em;">&nbsp;n</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.089em;">&nbsp;e</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.088em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.058em;">&nbsp;.</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.131em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.016em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.015em;">&nbsp;l</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.016em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6849em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6849em;">用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;以</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;处</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;理</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;系</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;统</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;出</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;错</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;情</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;况 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:8.0325em;"><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.37em;">s e</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.369em;">&nbsp;n</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.37em;">&nbsp;t</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.37em;">&nbsp;i</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.369em;">&nbsp;n</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.37em;">&nbsp;e</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.37em;">&nbsp;l</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.208em;">&nbsp;.</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.158em;">&nbsp;t</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.319em;">&nbsp;i</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.319em;">&nbsp;l</span><span class="stl_10 stl_11 stl_62" style="word-spacing:-0.319em;">&nbsp;t</span><span class="stl_10 stl_11 stl_62" style="word-spacing:0.193em;">&nbsp;=</span><span class="stl_10 stl_11 stl_62" style="word-spacing:0.119em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:8.4207em;"><span class="stl_58 stl_59 stl_346" style="word-spacing:0.4173em;">/ TILT</span><span class="stl_58 stl_59 stl_346" style="word-spacing:0.4572em;">&nbsp;</span><span class="stl_17 stl_18 stl_346" style="word-spacing:0.4572em;">模</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;式</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;开</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;始</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;的</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;时</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6501em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.6426em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6368em; left:8.0325em;"><span class="stl_10 stl_11 stl_1468" style="word-spacing:-0.3585em;">s e</span><span class="stl_10 stl_11 stl_1468" style="word-spacing:-0.3575em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1468" style="word-spacing:-0.3585em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1468" style="word-spacing:-0.3585em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1468" style="word-spacing:-0.3575em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1468" style="word-spacing:-0.3585em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1468" style="word-spacing:-0.3585em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1468" style="word-spacing:-0.1965em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1468" style="word-spacing:-0.2245em;">&nbsp;tilt_start_time</span><span class="stl_10 stl_11 stl_1468" style="word-spacing:0.128em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1468" style="word-spacing:0.128em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.6351em; left:8.4207em;"><span class="stl_58 stl_59 stl_1469" style="word-spacing:0.3525em;">/ s</span><span class="stl_58 stl_59 stl_1469" style="word-spacing:-0.3055em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1469" style="word-spacing:-0.3065em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1469" style="word-spacing:-0.3065em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1469" style="word-spacing:-0.3055em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1469" style="word-spacing:-0.3065em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1469" style="word-spacing:-0.3065em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1469" style="word-spacing:-0.3055em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1469" style="word-spacing:-0.1595em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1469" style="word-spacing:-0.2125em;">&nbsp;previous_time</span><span class="stl_58 stl_59 stl_1469" style="word-spacing:0.3414em;">&nbsp;</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:0.3414em;">是</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;服</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;务</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;器</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;上</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;一</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;次</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;执</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;行</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;定</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;时</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;程</span><span class="stl_17 stl_18 stl_1469" style="word-spacing:-0.2675em;">&nbsp;序 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.8515em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">的 时 间 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:8.0325em;"><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2767em;">s e</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2757em;">&nbsp;n</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2767em;">&nbsp;t</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2767em;">&nbsp;i</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2757em;">&nbsp;n</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2767em;">&nbsp;e</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.2767em;">&nbsp;l</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.1147em;">&nbsp;.</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.1737em;">&nbsp;previous_time</span><span class="stl_10 stl_11 stl_471" style="word-spacing:0.1763em;">&nbsp;=</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.1043em;">&nbsp;mstime ()</span><span class="stl_10 stl_11 stl_471" style="word-spacing:-0.1043em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">哨</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;服</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;务</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;器</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;当</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;前</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;正</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;在</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;脚</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;本</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;量 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:8.0325em;"><span class="stl_10 stl_11 stl_1470" style="word-spacing:-0.3412em;">s e</span><span class="stl_10 stl_11 stl_1470" style="word-spacing:-0.3402em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1470" style="word-spacing:-0.3412em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1470" style="word-spacing:-0.3412em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1470" style="word-spacing:-0.3402em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1470" style="word-spacing:-0.3412em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1470" style="word-spacing:-0.3412em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1470" style="word-spacing:-0.1792em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1470" style="word-spacing:-0.2172em;">&nbsp;running_scripts</span><span class="stl_10 stl_11 stl_1470" style="word-spacing:0.1408em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1470" style="word-spacing:0.1408em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6235em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.616em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">脚</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;本</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;队</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:8.0325em;"><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3305em;">s e</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3295em;">&nbsp;n</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3305em;">&nbsp;t</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3305em;">&nbsp;i</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3295em;">&nbsp;n</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3305em;">&nbsp;e</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3305em;">&nbsp;l</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.1685em;">&nbsp;.</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.2125em;">&nbsp;scripts_queue</span><span class="stl_10 stl_11 stl_219" style="word-spacing:0.1385em;">&nbsp;=</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.1519em;">&nbsp;l i</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3325em;">&nbsp;s</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3315em;">&nbsp;t</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3315em;">&nbsp;C</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3315em;">&nbsp;r</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3315em;">&nbsp;e</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3315em;">&nbsp;a</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3315em;">&nbsp;t</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.3315em;">&nbsp;e</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.1905em;">&nbsp;()</span><span class="stl_10 stl_11 stl_219" style="word-spacing:-0.1905em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.0243em; left:7.5658em;"><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0829em;">我们查看 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0829em;">struct redisCommand sentinelcmds </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0829em;">这个全局变量就会发现，它里面只 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.021em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0832em;">有七个命令，难道哨兵仅仅提供了这种服务？为了能让哨兵自动管理普通的 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0832em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0832em;">服 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.0176em; left:5.9058em;"><span class="stl_17 stl_18 stl_211" style="word-spacing:0.0817em;">务器，哨兵还添加了一个定时程序，我们从 </span><span class="stl_10 stl_11 stl_211" style="word-spacing:0.0817em;">serverCron() </span><span class="stl_17 stl_18 stl_211" style="word-spacing:0.0817em;">定时程序中就会发现，哨兵 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.2357em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">的定时程序被调用执行了，这里包含了哨兵的主要工作。 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4185em; left:5.9875em;"><span class="stl_15 stl_16 stl_724">int</span><span class="stl_15 stl_16 stl_724" style="word-spacing:0.3915em;">&nbsp;</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.3915em;">serverCron</span><span class="stl_10 stl_11 stl_724" style="word-spacing:-0.2025em;">&nbsp;(</span><span class="stl_10 stl_11 stl_724" style="word-spacing:-0.2251em;">&nbsp;</span><span class="stl_15 stl_16 stl_724" style="word-spacing:-0.2251em;">struct</span><span class="stl_15 stl_16 stl_724" style="word-spacing:0.342em;">&nbsp;</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.342em;">aeEventLoop</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.3025em;">&nbsp;*eventLoop</span><span class="stl_10 stl_11 stl_724" style="word-spacing:-0.1035em;">&nbsp;,</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.3988em;">&nbsp;</span><span class="stl_15 stl_16 stl_724" style="word-spacing:0.3988em;">long</span><span class="stl_15 stl_16 stl_724" style="word-spacing:0.2965em;">&nbsp;long</span><span class="stl_15 stl_16 stl_724" style="word-spacing:0.3299em;">&nbsp;</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.3299em;">id</span><span class="stl_10 stl_11 stl_724" style="word-spacing:0.3299em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4152em; left:7.6092em;"><span class="stl_15 stl_16 stl_679">void</span><span class="stl_15 stl_16 stl_679" style="word-spacing:-0.0642em;">&nbsp;</span><span class="stl_10 stl_11 stl_679" style="word-spacing:-0.0642em;">* clientData</span><span class="stl_10 stl_11 stl_679" style="word-spacing:-0.2367em;">&nbsp;)</span><span class="stl_10 stl_11 stl_679" style="word-spacing:-0.2367em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 45.416em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4126em; left:7.9667em;"><span class="stl_10 stl_11 stl_840" style="word-spacing:-0.2293em;">run_with_period (100)</span><span class="stl_10 stl_11 stl_840" style="word-spacing:-0.2293em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:10.0375em;"><span class="stl_15 stl_16 stl_693" style="word-spacing:-0.3124em;">i f</span><span class="stl_15 stl_16 stl_693" style="word-spacing:0.394em;">&nbsp;</span><span class="stl_10 stl_11 stl_693" style="word-spacing:0.394em;">(</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2394em;">&nbsp;server</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.1834em;">&nbsp;.</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2284em;">&nbsp;sentinel_mode</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2844em;">&nbsp;)</span><span class="stl_10 stl_11 stl_693" style="word-spacing:0.3446em;">&nbsp;sentinelTimer</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2194em;">&nbsp;()</span><span class="stl_10 stl_11 stl_693" style="word-spacing:-0.2194em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">190 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 17.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">监视机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 6.7151em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.5982em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 9.5982em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">7.2 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">定时程序 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.8568em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">关于定时程序是如何被调用的，可以参看之前的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0824em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0824em;">事件驱动那篇文章。 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.8576em; left:7.5658em;"><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0833em;">定时程序是哨兵服务器的重要角色，所做的工作主要包括：监视普通的 </span><span class="stl_10 stl_11 stl_28" style="word-spacing:0.0833em;">redis </span><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0833em;">服 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.8535em; left:5.9058em;z-index:126; "><span class="stl_17 stl_18 stl_07">务器（包括主机（</span><span class="stl_10 stl_11 stl_07">master</span><span class="stl_17 stl_18 stl_07">）和（从机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_573">））</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_07">，执行故障修复，执行脚本命令。 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.3593em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.3593em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">哨</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;定</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;程</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;序 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.3485em; left:5.9483em;"><span class="stl_15 stl_16 stl_267">void</span><span class="stl_15 stl_16 stl_267" style="word-spacing:0.3252em;">&nbsp;</span><span class="stl_10 stl_11 stl_267" style="word-spacing:0.3252em;">sentinelTimer</span><span class="stl_10 stl_11 stl_267" style="word-spacing:-0.2222em;">&nbsp;(</span><span class="stl_10 stl_11 stl_267" style="word-spacing:-0.2974em;">&nbsp;</span><span class="stl_15 stl_16 stl_267" style="word-spacing:-0.2974em;">void</span><span class="stl_15 stl_16 stl_267" style="word-spacing:-0.2971em;">&nbsp;</span><span class="stl_10 stl_11 stl_267" style="word-spacing:-0.2971em;">)</span><span class="stl_10 stl_11 stl_267" style="word-spacing:-0.2971em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.3518em; left:8.4207em;"><span class="stl_58 stl_59 stl_346">/</span><span class="stl_58 stl_59 stl_346" style="word-spacing:0.5271em;">&nbsp;</span><span class="stl_17 stl_18 stl_346" style="word-spacing:0.5271em;">检</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0337em;">&nbsp;测</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;是</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;否</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;需</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;要</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;启</span><span class="stl_17 stl_18 stl_346" style="word-spacing:-0.0327em;">&nbsp;动</span><span class="stl_17 stl_18 stl_346" style="word-spacing:0.6293em;">&nbsp;</span><span class="stl_58 stl_59 stl_346" style="word-spacing:0.6293em;">s</span><span class="stl_58 stl_59 stl_346" style="word-spacing:-0.0717em;">&nbsp;e</span><span class="stl_58 stl_59 stl_346" style="word-spacing:-0.0717em;">&nbsp;n</span><span class="stl_58 stl_59 stl_346" style="word-spacing:-0.0717em;">&nbsp;t</span><span class="stl_58 stl_59 stl_346" style="word-spacing:-0.0707em;">&nbsp;i</span><span class="stl_58 stl_59 stl_346" style="word-spacing:-0.0717em;">&nbsp;n</span><span class="stl_58 stl_59 stl_346" style="word-spacing:-0.0717em;">&nbsp;e</span><span class="stl_58 stl_59 stl_346" style="word-spacing:-0.0707em;">&nbsp;l</span><span class="stl_58 stl_59 stl_346" style="word-spacing:0.5193em;">&nbsp;TILT</span><span class="stl_58 stl_59 stl_346" style="word-spacing:0.4572em;">&nbsp;</span><span class="stl_17 stl_18 stl_346" style="word-spacing:0.4572em;">模</span><span class="stl_17 stl_18 stl_346" style="word-spacing:0.4572em;">&nbsp;式 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.346em; left:8.0075em;"><span class="stl_10 stl_11 stl_1121" style="word-spacing:-0.2272em;">sentinelCheckTiltCondition () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.3518em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.3401em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.3401em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">对 哈</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;希</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;表</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;中</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;每</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;服</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;务</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;器</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;实</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;例</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;执</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;调</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;度</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;任</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;务，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;这</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;函</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;很</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;重</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;要 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.3351em; left:8.0067em;"><span class="stl_10 stl_11 stl_1018" style="word-spacing:-0.2953em;">sentinelHandleDictOfRedisInstances ( s e n t i n e l . masters ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.3293em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 26.3293em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">执 行</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;脚</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;本</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;命</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;令，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;如</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;果</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;正</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;在</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;执</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;行</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;脚</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;本</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;的</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;数</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;量</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;没</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;有</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;超</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;出</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;限</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;定 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.3235em; left:8.0017em;"><span class="stl_10 stl_11 stl_787" style="word-spacing:-0.2164em;">sentinelRunPendingScripts () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.3176em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.3176em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">清 理</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;已</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;经</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;执</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;完</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;脚</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;本</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;进</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;程，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;如</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;执</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;成</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;功</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;脚</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;本</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;队</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;列</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;中</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;删</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;除 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.5348em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">脚 本 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.3085em; left:8.0158em;"><span class="stl_10 stl_11 stl_1191" style="word-spacing:-0.2412em;">sentinelCollectTerminatedScripts () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.3026em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 33.3026em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">停</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;止</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;执</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;行</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;超</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;脚</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;本</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;进</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;程 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.2977em; left:8.0158em;"><span class="stl_10 stl_11 stl_1471" style="word-spacing:-0.2403em;">sentinelKillTimedoutScripts () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.2918em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.2918em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">为 了</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;防</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;止</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;多</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;同</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;选</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;举，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;故</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;意</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;错</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;开</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;定</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;程</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;序</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;执</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;行</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;时</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;间。 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5082em; left:9.6417em;"><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.3132em;">通 过 调 整 周 期 可 以 调 整 哨 兵 定 时 程 序 执 行 的 时 间， 即 默 认 值 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.2843em; left:9.4967em;"><span class="stl_58 stl_59 stl_1472">REDIS_DEFAULT_HZ</span><span class="stl_58 stl_59 stl_1472" style="word-spacing:0.5233em;">&nbsp;</span><span class="stl_17 stl_18 stl_1472" style="word-spacing:0.5233em;">加</span><span class="stl_17 stl_18 stl_1472" style="word-spacing:0.0988em;">&nbsp;上 一 个 任 意</span><span class="stl_17 stl_18 stl_1472" style="word-spacing:0.0988em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.2785em; left:8.0175em;"><span class="stl_10 stl_11 stl_1473" style="word-spacing:0.1063em;">server .</span><span class="stl_10 stl_11 stl_1473" style="word-spacing:0.0283em;">&nbsp;hz</span><span class="stl_10 stl_11 stl_1473" style="word-spacing:0.3793em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1473" style="word-spacing:0.2348em;">&nbsp;REDIS_DEFAULT_HZ +</span><span class="stl_10 stl_11 stl_1473" style="word-spacing:0.3913em;">&nbsp;rand</span><span class="stl_10 stl_11 stl_1473" style="word-spacing:0.0213em;">&nbsp;()</span><span class="stl_10 stl_11 stl_1473" style="word-spacing:0.4253em;">&nbsp;%</span><span class="stl_10 stl_11 stl_1473" style="word-spacing:0.2083em;">&nbsp;REDIS_DEFAULT_HZ; &nbsp;</span></div>
					<div class="stl_01" style="top: 40.2752em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.1574em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 43.1574em; left:6.5789em;"><span class="stl_38 stl_13 stl_07">7.3</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">哨兵与</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1252em;">&nbsp;</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1252em;">redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1254em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1254em;">服务器的互联 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:7.5658em;"><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0859em;">每个哨兵都有一个 </span><span class="stl_10 stl_11 stl_47" style="word-spacing:0.0859em;">struct sentinel </span><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0859em;">结构体，里面维护了多个主机的连接，与每个 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0982em;">主机连接的相关信息都存储在 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0982em;">struct sentinelRedisInstance</span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0982em;">。透过这两个结构体，很 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">快就可以描绘出，一个哨兵服务器所维护的机器的信息： &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_40.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_40.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07">17.3.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">哨兵与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0827em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">服务器的互联 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">191 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:5.9533em;"><span class="stl_15 stl_16 stl_170" style="word-spacing:0.2585em;">typedef struct</span><span class="stl_15 stl_16 stl_170" style="word-spacing:0.3461em;">&nbsp;</span><span class="stl_10 stl_11 stl_170" style="word-spacing:0.3461em;">sentinelRedisInstance</span><span class="stl_10 stl_11 stl_170" style="word-spacing:0.3461em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 8.7093em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.706em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7118em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:8.4207em;"><span class="stl_58 stl_59 stl_526" style="word-spacing:0.3343em;">* Master</span><span class="stl_58 stl_59 stl_526" style="word-spacing:0.4503em;">&nbsp;s</span><span class="stl_58 stl_59 stl_526" style="word-spacing:-0.2297em;">&nbsp;p</span><span class="stl_58 stl_59 stl_526" style="word-spacing:-0.2307em;">&nbsp;e</span><span class="stl_58 stl_59 stl_526" style="word-spacing:-0.2297em;">&nbsp;c</span><span class="stl_58 stl_59 stl_526" style="word-spacing:-0.2307em;">&nbsp;i</span><span class="stl_58 stl_59 stl_526" style="word-spacing:-0.2297em;">&nbsp;f</span><span class="stl_58 stl_59 stl_526" style="word-spacing:-0.2307em;">&nbsp;i</span><span class="stl_58 stl_59 stl_526" style="word-spacing:-0.2297em;">&nbsp;c</span><span class="stl_58 stl_59 stl_526" style="word-spacing:-0.0837em;">&nbsp;.</span><span class="stl_58 stl_59 stl_526" style="word-spacing:0.3993em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 9.706em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">其</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;他</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;正</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;在</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;监</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;视</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;此</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;兵 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7018em; left:17.91em;"><span class="stl_58 stl_59 stl_1474" style="word-spacing:0.2896em;">/* Other</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:0.3946em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:-0.2904em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:-0.2904em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:-0.2894em;">&nbsp;t</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:-0.2904em;">&nbsp;i</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:-0.2904em;">&nbsp;n</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:-0.2904em;">&nbsp;e</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:-0.2894em;">&nbsp;l</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:-0.2904em;">&nbsp;s</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:0.4196em;">&nbsp;monitoring</span><span class="stl_58 stl_59 stl_1474" style="word-spacing:0.3796em;">&nbsp;the &nbsp;</span></div>
					<div class="stl_01" style="top: 14.6876em; left:17.91em;"><span class="stl_58 stl_59 stl_283" style="word-spacing:0.3034em;">/* Slaves</span><span class="stl_58 stl_59 stl_283" style="word-spacing:0.4009em;">&nbsp;for t</span><span class="stl_58 stl_59 stl_283" style="word-spacing:-0.3226em;">&nbsp;h</span><span class="stl_58 stl_59 stl_283" style="word-spacing:-0.3226em;">&nbsp;i</span><span class="stl_58 stl_59 stl_283" style="word-spacing:-0.3226em;">&nbsp;s</span><span class="stl_58 stl_59 stl_283" style="word-spacing:0.3704em;">&nbsp;master</span><span class="stl_58 stl_59 stl_283" style="word-spacing:0.3344em;">&nbsp;instance</span><span class="stl_58 stl_59 stl_283" style="word-spacing:0.3344em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:8.02em;"><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.0723em;">dict * s</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3757em;">&nbsp;e</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3757em;">&nbsp;n</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3767em;">&nbsp;t</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3757em;">&nbsp;i</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3757em;">&nbsp;n</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3757em;">&nbsp;e</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3767em;">&nbsp;l</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3757em;">&nbsp;s</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3757em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:9.5917em;"><span class="stl_58 stl_59 stl_776" style="word-spacing:0.3401em;">same master</span><span class="stl_58 stl_59 stl_776" style="word-spacing:-0.1539em;">&nbsp;.</span><span class="stl_58 stl_59 stl_776" style="word-spacing:0.4131em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.02em;"><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.0873em;">dict * s</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3907em;">&nbsp;l</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3907em;">&nbsp;a</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3907em;">&nbsp;v</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3917em;">&nbsp;e</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3907em;">&nbsp;s</span><span class="stl_10 stl_11 stl_482" style="word-spacing:-0.3907em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">次</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;主</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;从</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;机</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;列</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;表 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6835em; left:9.6075em;"><span class="stl_58 stl_59 stl_71">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.4207em;"><span class="stl_58 stl_59 stl_1004">/</span><span class="stl_58 stl_59 stl_1004" style="word-spacing:0.3108em;">&nbsp;</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:0.3108em;">如</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.25em;">&nbsp;果</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.249em;">&nbsp;是</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.249em;">&nbsp;从</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.216em;">&nbsp;机，</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.2234em;">&nbsp;</span><span class="stl_58 stl_59 stl_1004" style="word-spacing:-0.2234em;">master</span><span class="stl_58 stl_59 stl_1004" style="word-spacing:0.3436em;">&nbsp;</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:0.3436em;">则</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.249em;">&nbsp;指</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.249em;">&nbsp;向</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.249em;">&nbsp;它</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.249em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.249em;">&nbsp;主</span><span class="stl_17 stl_18 stl_1004" style="word-spacing:-0.249em;">&nbsp;机 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 17.676em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.666em; left:7.9725em;"><span class="stl_15 stl_16 stl_625">struct</span><span class="stl_15 stl_16 stl_625" style="word-spacing:0.3417em;">&nbsp;</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.3417em;">sentinelRedisInstance</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.302em;">&nbsp;*master</span><span class="stl_10 stl_11 stl_625" style="word-spacing:-0.241em;">&nbsp;;</span><span class="stl_10 stl_11 stl_625" style="word-spacing:0.3265em;">&nbsp;</span><span class="stl_58 stl_59 stl_625" style="word-spacing:0.3265em;">/*</span><span class="stl_58 stl_59 stl_625" style="word-spacing:0.246em;">&nbsp;Master</span><span class="stl_58 stl_59 stl_625" style="word-spacing:0.32em;">&nbsp;instance &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:9.7208em;"><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.175em;">i f</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.612em;">&nbsp;i</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.183em;">&nbsp;t</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.082em;">&nbsp;’ s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.476em;">&nbsp;s</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.22em;">&nbsp;l</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.219em;">&nbsp;a</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.219em;">&nbsp;v</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.22em;">&nbsp;e</span><span class="stl_58 stl_59 stl_132" style="word-spacing:-0.072em;">&nbsp;.</span><span class="stl_58 stl_59 stl_132" style="word-spacing:0.435em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 21.6593em; left:7.0227em;"><span class="stl_10 stl_11 stl_1475" style="word-spacing:-0.2347em;">sentinelRedisInstance ; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.9057em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">可见，哨兵服务器连接（监视）了多台主机，多台从机和多台哨兵服务器。有这 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.9015em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">样大概的脉络，我们继续往下看就会更有线索。 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.706em; left:7.5658em;"><span class="stl_17 stl_18 stl_984" style="word-spacing:0.0888em;">哨兵要监视 </span><span class="stl_10 stl_11 stl_984" style="word-spacing:0.0888em;">redis </span><span class="stl_17 stl_18 stl_984" style="word-spacing:0.0888em;">服务器，就必须连接 </span><span class="stl_10 stl_11 stl_984" style="word-spacing:0.0888em;">redis </span><span class="stl_17 stl_18 stl_984" style="word-spacing:0.0888em;">服务器。启动哨兵的时候需要指定 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.7026em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0831em;">一个配置文件，程序初始化的时候会读取这个配置文件，获取被监视 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0831em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0831em;">服务器的 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.6985em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0821em;">IP </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0821em;">地址和端口等信息。 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.2535em; left:6.0167em;"><span class="stl_10 stl_11 stl_603">redis</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2819em;">&nbsp;</span><span class="stl_107 stl_108 stl_603">−</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2819em;">server</span><span class="stl_10 stl_11 stl_603" style="word-spacing:0.3328em;">&nbsp;/path/</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.3072em;">&nbsp;to</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.3082em;">&nbsp;/</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2482em;">&nbsp;s</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2992em;">&nbsp;e</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2992em;">&nbsp;n</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2982em;">&nbsp;t</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2992em;">&nbsp;i</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2992em;">&nbsp;n</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2982em;">&nbsp;e</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2992em;">&nbsp;l</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.1382em;">&nbsp;.</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.1812em;">&nbsp;conf</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.1849em;">&nbsp;</span><span class="stl_107 stl_108 stl_603" style="word-spacing:-0.1849em;">−−</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.1849em;">s e</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2982em;">&nbsp;n</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2992em;">&nbsp;t</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2992em;">&nbsp;i</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2982em;">&nbsp;n</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2992em;">&nbsp;e</span><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.2992em;">&nbsp;l &nbsp;</span></div>
					<div class="stl_01" style="top: 45.0723em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">或者 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:6.0167em;"><span class="stl_10 stl_11 stl_1109">redis</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.2947em;">&nbsp;</span><span class="stl_107 stl_108 stl_1109">−</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.2947em;">s</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.312em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.312em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.312em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.311em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.312em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.312em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.311em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:0.338em;">&nbsp;/path/</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.32em;">&nbsp;to</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.321em;">&nbsp;/</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.261em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.312em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.312em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.311em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.312em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.312em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.311em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.312em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.151em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1109" style="word-spacing:-0.194em;">&nbsp;conf &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">192 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 17.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">监视机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">如果想要监视一个 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">服务器，可以在配置文件中写入： &nbsp;</span></div>
					<div class="stl_01" style="top: 8.1718em; left:6.04em;"><span class="stl_10 stl_11 stl_1476" style="word-spacing:-0.2066em;">s e</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:-0.2056em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:-0.2066em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:-0.2066em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:-0.2056em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:-0.2066em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:-0.2066em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:0.4884em;">&nbsp;monitor</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:0.2064em;">&nbsp;&lt;master</span><span class="stl_107 stl_108 stl_1476" style="word-spacing:0.2064em;">−</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:0.2064em;">name&gt;</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:0.0239em;">&nbsp;&lt;ip&gt; &lt;redis</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:-0.1903em;">&nbsp;</span><span class="stl_107 stl_108 stl_1476" style="word-spacing:0.0239em;">−</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:-0.1903em;">port&gt;</span><span class="stl_10 stl_11 stl_1476" style="word-spacing:0.0234em;">&nbsp;&lt;quorum&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6276em; left:7.5658em;"><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0803em;">其中，</span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0803em;">master-name </span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0803em;">是主机名，</span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0803em;">ip redis-port </span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0803em;">分别是 </span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0803em;">IP </span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0803em;">地址和端口，</span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0803em;">quorum </span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0803em;">是 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6235em; left:5.9058em;"><span class="stl_17 stl_18 stl_1477" style="word-spacing:0.0757em;">哨兵用来判断某个 </span><span class="stl_10 stl_11 stl_1477" style="word-spacing:0.0757em;">redis </span><span class="stl_17 stl_18 stl_1477" style="word-spacing:0.0757em;">服务器是否下线的参数，之后会讲到。讲到上面的配置，心里 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6201em; left:5.9058em;"><span class="stl_17 stl_18 stl_1413">一定会有疑惑，这个配置的处理过程发生在哪里，在源码中很容易就能找到“</span><span class="stl_10 stl_11 stl_1413">sentinel &nbsp;</span></div>
					<div class="stl_01" style="top: 12.616em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.084em;">monitor</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.084em;">”关键词：</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.084em;">sentinelHandleConﬁguration() </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.084em;">函数中，完成了对配置文件的解析 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.8348em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">和处理过程。顺藤摸瓜，就可以找到： &nbsp;</span></div>
					<div class="stl_01" style="top: 17.0626em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.0626em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">哨</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;配</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;置</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;文</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;件</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;解</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;析</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;和</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;处</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;理 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.0527em; left:5.9417em;"><span class="stl_15 stl_16 stl_922">char</span><span class="stl_15 stl_16 stl_922" style="word-spacing:-0.0773em;">&nbsp;</span><span class="stl_10 stl_11 stl_922" style="word-spacing:-0.0773em;">* sentinelHandleConfiguration</span><span class="stl_10 stl_11 stl_922" style="word-spacing:-0.0773em;">&nbsp;(</span><span class="stl_15 stl_16 stl_922" style="word-spacing:-0.2377em;">char</span><span class="stl_15 stl_16 stl_922" style="word-spacing:0.2335em;">&nbsp;</span><span class="stl_10 stl_11 stl_922" style="word-spacing:0.2335em;">**argv</span><span class="stl_10 stl_11 stl_922" style="word-spacing:-0.1557em;">&nbsp;,</span><span class="stl_10 stl_11 stl_922" style="word-spacing:0.3832em;">&nbsp;</span><span class="stl_15 stl_16 stl_922" style="word-spacing:0.3832em;">int</span><span class="stl_15 stl_16 stl_922" style="word-spacing:0.3352em;">&nbsp;</span><span class="stl_10 stl_11 stl_922" style="word-spacing:0.3352em;">argc</span><span class="stl_10 stl_11 stl_922" style="word-spacing:-0.2587em;">&nbsp;)</span><span class="stl_10 stl_11 stl_922" style="word-spacing:-0.2587em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 19.0535em; left:8.0192em;"><span class="stl_10 stl_11 stl_1475" style="word-spacing:-0.0614em;">sentinelRedisInstance * r</span><span class="stl_10 stl_11 stl_1475" style="word-spacing:-0.3647em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1475" style="word-spacing:-0.3647em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 21.041em; left:8.045em;"><span class="stl_15 stl_16 stl_288" style="word-spacing:-0.2448em;">i f</span><span class="stl_15 stl_16 stl_288" style="word-spacing:0.5339em;">&nbsp;</span><span class="stl_10 stl_11 stl_288" style="word-spacing:0.5339em;">(</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2438em;">&nbsp;!</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.1328em;">&nbsp;strcasecmp</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2058em;">&nbsp;(</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2187em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.1468em;">&nbsp;[</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2437em;">&nbsp;0</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2428em;">&nbsp;]</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.0658em;">&nbsp;,</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.1788em;">&nbsp;”</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2628em;">&nbsp;monitor</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2628em;">&nbsp;”</span><span class="stl_10 stl_11 stl_288" style="word-spacing:-0.2508em;">&nbsp;)</span><span class="stl_10 stl_11 stl_288" style="word-spacing:0.1685em;">&nbsp;&amp;&amp; argc == 5)</span><span class="stl_10 stl_11 stl_288" style="word-spacing:0.1685em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 22.0443em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 22.0443em; left:10.4132em;"><span class="stl_58 stl_59 stl_1478" style="word-spacing:0.3876em;">* monitor</span><span class="stl_58 stl_59 stl_1478" style="word-spacing:0.2096em;">&nbsp;&lt;name&gt;</span><span class="stl_58 stl_59 stl_1478" style="word-spacing:0.0289em;">&nbsp;&lt;host&gt; &lt;port&gt; &lt;quorum&gt;</span><span class="stl_58 stl_59 stl_1478" style="word-spacing:0.2066em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.0335em; left:9.9725em;"><span class="stl_15 stl_16 stl_399">int</span><span class="stl_15 stl_16 stl_399" style="word-spacing:0.3145em;">&nbsp;</span><span class="stl_10 stl_11 stl_399" style="word-spacing:0.3145em;">quorum</span><span class="stl_10 stl_11 stl_399" style="word-spacing:0.1258em;">&nbsp;=</span><span class="stl_10 stl_11 stl_399" style="word-spacing:0.2398em;">&nbsp;atoi</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.1662em;">&nbsp;(</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2172em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.1312em;">&nbsp;[</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2272em;">&nbsp;4</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2272em;">&nbsp;]</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2272em;">&nbsp;)</span><span class="stl_10 stl_11 stl_399" style="word-spacing:-0.2272em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.0326em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 25.0326em; left:10.4132em;"><span class="stl_58 stl_59 stl_1479" style="word-spacing:0.4077em;">/ quorum</span><span class="stl_58 stl_59 stl_1479" style="word-spacing:0.1767em;">&nbsp;&gt;=</span><span class="stl_58 stl_59 stl_1479" style="word-spacing:0.1767em;">&nbsp;0 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.0227em; left:10.0375em;"><span class="stl_15 stl_16 stl_911" style="word-spacing:-0.2086em;">i f</span><span class="stl_15 stl_16 stl_911" style="word-spacing:0.4977em;">&nbsp;</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.4977em;">(quorum</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.0704em;">&nbsp;&lt;=</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.2294em;">&nbsp;0)</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.3763em;">&nbsp;</span><span class="stl_15 stl_16 stl_911" style="word-spacing:0.3763em;">return</span><span class="stl_15 stl_16 stl_911" style="word-spacing:0.3369em;">&nbsp;</span><span class="stl_10 stl_11 stl_911" style="word-spacing:0.3369em;">”Quorum␣must␣be␣1␣</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.2316em;">&nbsp;or</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.2326em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.1916em;">&nbsp;greater</span><span class="stl_10 stl_11 stl_911" style="word-spacing:-0.1916em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 27.0235em; left:11.6042em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 27.0235em; left:12.1829em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 28.0152em; left:10.0375em;"><span class="stl_15 stl_16 stl_1415" style="word-spacing:-0.2543em;">i f</span><span class="stl_15 stl_16 stl_1415" style="word-spacing:0.452em;">&nbsp;</span><span class="stl_10 stl_11 stl_1415" style="word-spacing:0.452em;">(</span><span class="stl_10 stl_11 stl_1415" style="word-spacing:-0.1814em;">&nbsp;createSentinelRedisInstance</span><span class="stl_10 stl_11 stl_1415" style="word-spacing:-0.1804em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1415" style="word-spacing:-0.2293em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_1415" style="word-spacing:-0.1564em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1415" style="word-spacing:-0.2524em;">&nbsp;1</span><span class="stl_10 stl_11 stl_1415" style="word-spacing:-0.2533em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1415" style="word-spacing:-0.0744em;">&nbsp;,SRI_MASTER, &nbsp;</span></div>
					<div class="stl_01" style="top: 29.016em; left:11.6308em;"><span class="stl_10 stl_11 stl_686" style="word-spacing:-0.1951em;">argv [ 2 ] , &nbsp;</span></div>
					<div class="stl_01" style="top: 30.0126em; left:25.9525em;"><span class="stl_10 stl_11 stl_175" style="word-spacing:-0.1764em;">atoi ( argv [ 3 ] ) ,quorum , &nbsp;</span></div>
					<div class="stl_01" style="top: 31.0085em; left:27.4333em;"><span class="stl_10 stl_11 stl_1480" style="word-spacing:0.441em;">NULL) ==</span><span class="stl_10 stl_11 stl_1480" style="word-spacing:0.265em;">&nbsp;NULL) &nbsp;</span></div>
					<div class="stl_01" style="top: 32.0052em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 32.996em; left:11.9308em;"><span class="stl_15 stl_16 stl_783">switch</span><span class="stl_15 stl_16 stl_783" style="word-spacing:-0.2566em;">&nbsp;</span><span class="stl_10 stl_11 stl_783" style="word-spacing:-0.2566em;">(</span><span class="stl_10 stl_11 stl_783" style="word-spacing:-0.1941em;">&nbsp;errno</span><span class="stl_10 stl_11 stl_783" style="word-spacing:-0.1941em;">&nbsp;)</span><span class="stl_10 stl_11 stl_783" style="word-spacing:-0.1941em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.9927em; left:11.9408em;"><span class="stl_15 stl_16 stl_1481">case</span><span class="stl_15 stl_16 stl_1481" style="word-spacing:0.2166em;">&nbsp;</span><span class="stl_10 stl_11 stl_1481" style="word-spacing:0.2166em;">EBUSY:</span><span class="stl_10 stl_11 stl_1481" style="word-spacing:0.4391em;">&nbsp;</span><span class="stl_15 stl_16 stl_1481" style="word-spacing:0.4391em;">return</span><span class="stl_15 stl_16 stl_1481" style="word-spacing:0.3416em;">&nbsp;</span><span class="stl_10 stl_11 stl_1481" style="word-spacing:0.3416em;">”</span><span class="stl_10 stl_11 stl_1481" style="word-spacing:-0.2039em;">&nbsp;Duplicated</span><span class="stl_10 stl_11 stl_1481" style="word-spacing:-0.2169em;">&nbsp;␣master␣name</span><span class="stl_10 stl_11 stl_1481" style="word-spacing:-0.2049em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1481" style="word-spacing:-0.1549em;">&nbsp;”</span><span class="stl_10 stl_11 stl_1481" style="word-spacing:-0.1549em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.9885em; left:11.9408em;"><span class="stl_15 stl_16 stl_666">case</span><span class="stl_15 stl_16 stl_666" style="word-spacing:0.2423em;">&nbsp;</span><span class="stl_10 stl_11 stl_666" style="word-spacing:0.2423em;">ENOENT:</span><span class="stl_10 stl_11 stl_666" style="word-spacing:0.4992em;">&nbsp;</span><span class="stl_15 stl_16 stl_666" style="word-spacing:0.4992em;">return</span><span class="stl_15 stl_16 stl_666" style="word-spacing:0.4024em;">&nbsp;</span><span class="stl_10 stl_11 stl_666" style="word-spacing:0.4024em;">”Can</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.0992em;">&nbsp;’</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1062em;">&nbsp;t</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1642em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1162em;">&nbsp;r</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1672em;">&nbsp;e</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1662em;">&nbsp;s</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1672em;">&nbsp;o</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1662em;">&nbsp;l</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1672em;">&nbsp;v</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1662em;">&nbsp;e</span><span class="stl_10 stl_11 stl_666" style="word-spacing:-0.1172em;">&nbsp;␣master␣ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.9902em; left:13.6575em;"><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.243em;">instance ␣hostname . ” ; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.981em; left:11.9408em;"><span class="stl_15 stl_16 stl_494">case</span><span class="stl_15 stl_16 stl_494" style="word-spacing:0.2443em;">&nbsp;</span><span class="stl_10 stl_11 stl_494" style="word-spacing:0.2443em;">EINVAL:</span><span class="stl_10 stl_11 stl_494" style="word-spacing:0.4387em;">&nbsp;</span><span class="stl_15 stl_16 stl_494" style="word-spacing:0.4387em;">return</span><span class="stl_15 stl_16 stl_494" style="word-spacing:0.3412em;">&nbsp;</span><span class="stl_10 stl_11 stl_494" style="word-spacing:0.3412em;">”</span><span class="stl_10 stl_11 stl_494" style="word-spacing:-0.1744em;">&nbsp;Invalid</span><span class="stl_10 stl_11 stl_494" style="word-spacing:-0.1884em;">&nbsp;␣</span><span class="stl_10 stl_11 stl_494" style="word-spacing:-0.2174em;">&nbsp;port</span><span class="stl_10 stl_11 stl_494" style="word-spacing:-0.2184em;">&nbsp;␣number”</span><span class="stl_10 stl_11 stl_494" style="word-spacing:-0.2184em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.9827em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.9785em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 39.9752em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 39.9752em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 41.431em; left:7.5658em;z-index:859; "><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0595em;">可以看到里面主要调用了 </span><span class="stl_10 stl_11 stl_331" style="word-spacing:0.0595em;">createSentinelRedisInstance() </span><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0595em;">函数。</span><span class="stl_10 stl_11 stl_331" style="word-spacing:0.0595em;">createSentinelRe- &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4276em; left:5.9058em;"><span class="stl_10 stl_11 stl_32" style="word-spacing:0.082em;">disInstance() </span><span class="stl_17 stl_18 stl_32" style="word-spacing:0.082em;">函数的主要工作是初始化 </span><span class="stl_10 stl_11 stl_32" style="word-spacing:0.082em;">sentinelRedisInstance </span><span class="stl_17 stl_18 stl_32" style="word-spacing:0.082em;">结构体。在这里，哨兵 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:5.9058em;"><span class="stl_17 stl_18 stl_427" style="word-spacing:0.0994em;">并没有选择立即去连接这指定的 </span><span class="stl_10 stl_11 stl_427" style="word-spacing:0.0994em;">redis </span><span class="stl_17 stl_18 stl_427" style="word-spacing:0.0994em;">服务器，而是将 </span><span class="stl_10 stl_11 stl_427" style="word-spacing:0.0994em;">sentinelRedisInstance.ﬂag </span><span class="stl_17 stl_18 stl_427" style="word-spacing:0.0994em;">标 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:5.9058em;"><span class="stl_17 stl_18 stl_1482" style="word-spacing:0.0928em;">记 </span><span class="stl_10 stl_11 stl_1482" style="word-spacing:0.0928em;">SRI_DISCONNECT</span><span class="stl_17 stl_18 stl_1482" style="word-spacing:0.0928em;">，而将连接的工作丢到定时程序中去，可以联想到，定时程 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0883em;">序中肯定有一个检测 </span><span class="stl_10 stl_11 stl_47" style="word-spacing:0.0883em;">sentinelRedisInstance.ﬂag </span><span class="stl_17 stl_18 stl_47" style="word-spacing:0.0883em;">的函数，如果发现连接是断开的，会 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0825em;">发起连接。这个策略和我们之前的讲到的客户端连接 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0825em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0825em;">服务器时候的策略是一样 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;"><span class="stl_17 stl_18 stl_510" style="word-spacing:0.0782em;">的，是 </span><span class="stl_10 stl_11 stl_510" style="word-spacing:0.0782em;">redis </span><span class="stl_17 stl_18 stl_510" style="word-spacing:0.0782em;">的惯用手法。因为哨兵要和 </span><span class="stl_10 stl_11 stl_510" style="word-spacing:0.0782em;">redis </span><span class="stl_17 stl_18 stl_510" style="word-spacing:0.0782em;">服务器保持连接，所以必然会定时检测 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07">17.3.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">哨兵与</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0833em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0833em;">REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0827em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">服务器的互联 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">193 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:5.9058em;"><span class="stl_17 stl_18 stl_1483" style="word-spacing:0.0873em;">和 </span><span class="stl_10 stl_11 stl_1483" style="word-spacing:0.0873em;">redis </span><span class="stl_17 stl_18 stl_1483" style="word-spacing:0.0873em;">服务器的连接状态，如果在配置的时候就直接连接 </span><span class="stl_10 stl_11 stl_1483" style="word-spacing:0.0873em;">redis </span><span class="stl_17 stl_18 stl_1483" style="word-spacing:0.0873em;">服务器，也不是不 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.9373em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">可以，只是用这种方法能让代码更清爽！ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7943em; left:7.5658em;z-index:115; "><span class="stl_17 stl_18 stl_07">在定时程序的调用链中</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_1027">，确</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.355em;">&nbsp;</span><span class="stl_17 stl_18 stl_919" style="word-spacing:0.0074em;">实发现了哨兵主动连接 </span><span class="stl_10 stl_11 stl_919" style="word-spacing:0.0074em;">redis </span><span class="stl_17 stl_18 stl_919" style="word-spacing:0.0074em;">服务器的过程：</span><span class="stl_10 stl_11 stl_919" style="word-spacing:0.0074em;">sentinelTimer()- &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7901em; left:6.5518em;"><span class="stl_10 stl_11 stl_287">sentinelHandleRedisInstance()-&gt;sentinelReconnectInstance()</span><span class="stl_17 stl_18 stl_287">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7901em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">&gt;</span></div>
					<div class="stl_01" style="top: 11.8693em; left:7.5658em;"><span class="stl_10 stl_11 stl_1484" style="word-spacing:0.2024em;">sentinelReconnectInstance() </span><span class="stl_17 stl_18 stl_1484" style="word-spacing:0.2024em;">负责连接被标记为 </span><span class="stl_10 stl_11 stl_1484" style="word-spacing:0.2024em;">SRI_DISCONNECT </span><span class="stl_17 stl_18 stl_1484" style="word-spacing:0.2024em;">的 </span><span class="stl_10 stl_11 stl_1484" style="word-spacing:0.2024em;">redis &nbsp;</span></div>
					<div class="stl_01" style="top: 12.8652em; left:5.9058em;"><span class="stl_17 stl_18 stl_1485" style="word-spacing:0.1472em;">服务器。它对一个 </span><span class="stl_10 stl_11 stl_1485" style="word-spacing:0.1472em;">redis </span><span class="stl_17 stl_18 stl_1485" style="word-spacing:0.1472em;">服务器发起了两个连接：</span><span class="stl_10 stl_11 stl_1485" style="word-spacing:0.1472em;">1</span><span class="stl_17 stl_18 stl_1485" style="word-spacing:0.1472em;">、普通连接（</span><span class="stl_10 stl_11 stl_1485" style="word-spacing:0.1472em;">sentinelRedisIn- &nbsp;</span></div>
					<div class="stl_01" style="top: 13.8618em; left:5.9058em;z-index:333; "><span class="stl_10 stl_11 stl_1486" style="word-spacing:0.0012em;">stance.cc,Commands connection</span><span class="stl_17 stl_18 stl_1486" style="word-spacing:0.0012em;">）</span><span class="stl_10 stl_11 stl_1486" style="word-spacing:0.0012em;">2</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.2491em;">&nbsp;</span><span class="stl_17 stl_18 stl_1487">、订</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.285em;">&nbsp;</span><span class="stl_17 stl_18 stl_429">阅发布专用连接（</span><span class="stl_10 stl_11 stl_429">sentinelRedisInstance.pc,publish &nbsp;</span></div>
					<div class="stl_01" style="top: 14.8576em; left:5.9058em;"><span class="stl_10 stl_11 stl_903" style="word-spacing:0.1158em;">connection</span><span class="stl_17 stl_18 stl_903" style="word-spacing:0.1158em;">）。为什么需要分这两个连接呢？因为对于一个客户端连接来说，</span><span class="stl_10 stl_11 stl_903" style="word-spacing:0.1158em;">redis </span><span class="stl_17 stl_18 stl_903" style="word-spacing:0.1158em;">服 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.0765em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">务器要么专门处理普通的命令，要么专门处理订阅发布命令，这在之前订阅发布篇幅 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.0723em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">中专门有提及这个细节。 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5043em; left:5.9483em;"><span class="stl_15 stl_16 stl_99">void</span><span class="stl_15 stl_16 stl_99" style="word-spacing:-0.0094em;">&nbsp;</span><span class="stl_10 stl_11 stl_99" style="word-spacing:-0.0094em;">sentinelReconnectInstance (</span><span class="stl_10 stl_11 stl_99" style="word-spacing:-0.2664em;">&nbsp;sentinelRedisInstance</span><span class="stl_10 stl_11 stl_99" style="word-spacing:-0.0148em;">&nbsp;* r</span><span class="stl_10 stl_11 stl_99" style="word-spacing:-0.3414em;">&nbsp;i</span><span class="stl_10 stl_11 stl_99" style="word-spacing:-0.2364em;">&nbsp;)</span><span class="stl_10 stl_11 stl_99" style="word-spacing:-0.2364em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.501em; left:8.045em;z-index:522; "><span class="stl_15 stl_16 stl_1488" style="word-spacing:-0.027em;">i f</span><span class="stl_15 stl_16 stl_1488" style="word-spacing:0.7597em;">&nbsp;</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:0.7597em;">(</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:-0.017em;">&nbsp;!</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:-0.017em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:0.115em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:-0.0269em;">&nbsp;</span><span class="stl_107 stl_108 stl_1488" style="word-spacing:0.115em;">−</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:-0.0269em;">&gt;f</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:-0.033em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:-0.033em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:-0.032em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:-0.033em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:0.478em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:0.246em;">&nbsp;SRI_DISCONNECTED)</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:0.008em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:0.5597em;">&nbsp;</span><span class="stl_15 stl_16 stl_1488" style="word-spacing:0.5597em;">return</span><span class="stl_15 stl_16 stl_1488" style="word-spacing:0.0157em;">&nbsp;</span><span class="stl_10 stl_11 stl_1488" style="word-spacing:0.5597em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.5001em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 23.5001em; left:8.4207em;"><span class="stl_58 stl_59 stl_1388" style="word-spacing:0.2785em;">* Commands</span><span class="stl_58 stl_59 stl_1388" style="word-spacing:0.3345em;">&nbsp;connection</span><span class="stl_58 stl_59 stl_1388" style="word-spacing:-0.1115em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1388" style="word-spacing:0.4305em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.4893em; left:8.045em;z-index:583; "><span class="stl_15 stl_16 stl_1489" style="word-spacing:-0.0254em;">i f</span><span class="stl_15 stl_16 stl_1489" style="word-spacing:0.681em;">&nbsp;</span><span class="stl_10 stl_11 stl_1489" style="word-spacing:0.681em;">(</span><span class="stl_10 stl_11 stl_1489" style="word-spacing:0.0366em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1489" style="word-spacing:-0.0244em;">&nbsp;</span><span class="stl_107 stl_108 stl_1489" style="word-spacing:0.0366em;">−</span><span class="stl_10 stl_11 stl_1489" style="word-spacing:-0.0244em;">&gt;cc</span><span class="stl_10 stl_11 stl_1489" style="word-spacing:0.3836em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1489" style="word-spacing:0.2086em;">&nbsp;NULL)</span><span class="stl_10 stl_11 stl_1489" style="word-spacing:0.2086em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.491em; left:10.0008em;z-index:642; "><span class="stl_10 stl_11 stl_1490">ri</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.1684em;">&nbsp;</span><span class="stl_107 stl_108 stl_1490">−</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.1684em;">&gt;cc</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:0.2695em;">&nbsp;= redisAsyncConnect</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.136em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.107em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.1693em;">&nbsp;</span><span class="stl_107 stl_108 stl_1490" style="word-spacing:-0.107em;">−</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.1693em;">&gt;addr</span><span class="stl_107 stl_108 stl_1490" style="word-spacing:-0.1693em;">−</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.1693em;">&gt;ip</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.001em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.051em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.1687em;">&nbsp;</span><span class="stl_107 stl_108 stl_1490" style="word-spacing:-0.051em;">−</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.1687em;">&gt;addr</span><span class="stl_107 stl_108 stl_1490" style="word-spacing:-0.1687em;">−</span><span class="stl_10 stl_11 stl_1490" style="word-spacing:-0.1687em;">&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.4868em; left:11.6442em;"><span class="stl_10 stl_11 stl_126" style="word-spacing:-0.2333em;">port ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4851em; left:10.4133em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">连</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;出</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;错 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.4851em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 28.4743em; left:10.0375em;z-index:664; "><span class="stl_15 stl_16 stl_1491" style="word-spacing:-0.1298em;">i f</span><span class="stl_15 stl_16 stl_1491" style="word-spacing:0.5766em;">&nbsp;</span><span class="stl_10 stl_11 stl_1491" style="word-spacing:0.5766em;">(</span><span class="stl_10 stl_11 stl_1491" style="word-spacing:-0.0678em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1491" style="word-spacing:-0.1289em;">&nbsp;</span><span class="stl_107 stl_108 stl_1491" style="word-spacing:-0.0678em;">−</span><span class="stl_10 stl_11 stl_1491" style="word-spacing:-0.1289em;">&gt;cc</span><span class="stl_107 stl_108 stl_1491" style="word-spacing:-0.1289em;">−</span><span class="stl_10 stl_11 stl_1491" style="word-spacing:-0.1289em;">&gt;err</span><span class="stl_10 stl_11 stl_1491" style="word-spacing:-0.0568em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1491" style="word-spacing:-0.0568em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4776em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.4776em; left:12.4058em;z-index:674; "><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">错</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;误</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;处</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;理 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4718em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 33.461em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 30.4668em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4701em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 31.4701em; left:12.4058em;"><span class="stl_58 stl_59 stl_430">/</span><span class="stl_58 stl_59 stl_430" style="word-spacing:-0.1342em;">&nbsp;</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.1342em;">此 连</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;接</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;被</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;绑</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;定</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;到</span><span class="stl_17 stl_18 stl_430" style="word-spacing:0.303em;">&nbsp;</span><span class="stl_58 stl_59 stl_430" style="word-spacing:0.303em;">redis</span><span class="stl_58 stl_59 stl_430" style="word-spacing:-0.0449em;">&nbsp;</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.0449em;">服 务</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;器</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;的</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;事</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;件</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;中</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;心 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4643em; left:12.5716em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 32.4643em; left:12.1125em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 34.4577em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 36.4518em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.4518em; left:8.4207em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">此 哨</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;会</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;订</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;阅</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;所</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;有</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;主</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;从</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;机</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;的</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0012em;">&nbsp;</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0012em;">h e</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.35em;">&nbsp;l</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.35em;">&nbsp;l</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.351em;">&nbsp;o</span><span class="stl_58 stl_59 stl_215" style="word-spacing:0.3501em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:0.3501em;">订</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;阅</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;频</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;道，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;每</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;个</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;都</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;会 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.6682em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">定 期 将 自 己 监 视 的 服 务 器 和 自 己 的 信 息 发 送 到 主 从 服 务 器 的 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4443em; left:9.6975em;"><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.351em;">h e</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.35em;">&nbsp;l</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.35em;">&nbsp;l</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.351em;">&nbsp;o</span><span class="stl_58 stl_59 stl_215" style="word-spacing:0.3501em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:0.3501em;">频</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;道，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;从</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;而</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;此</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;就</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;能</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;发</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;现</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;其</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;他</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;服</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;务</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;器，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;并</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;且</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;也</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;能</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;将</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;自 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4401em; left:9.6417em;"><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3418em;">己 的</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;监</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;测</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;的</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;数</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;据</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;散</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;播</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;到</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;其</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;他</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;服</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;务</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3068em;">&nbsp;器。</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3068em;">&nbsp;这</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;就</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.3408em;">&nbsp;是</span><span class="stl_17 stl_18 stl_519" style="word-spacing:0.307em;">&nbsp;</span><span class="stl_58 stl_59 stl_519" style="word-spacing:0.307em;">redis</span><span class="stl_58 stl_59 stl_519" style="word-spacing:-0.0335em;">&nbsp;</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.0335em;">所 谓</span><span class="stl_17 stl_18 stl_519" style="word-spacing:-0.0335em;">&nbsp;的 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:9.6433em;"><span class="stl_58 stl_59 stl_1492" style="word-spacing:0.334em;">auto discover</span><span class="stl_58 stl_59 stl_1492" style="word-spacing:0.334em;">&nbsp;. &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4293em; left:8.4207em;"><span class="stl_58 stl_59 stl_551" style="word-spacing:0.3424em;">* Pub / Sub</span><span class="stl_58 stl_59 stl_551" style="word-spacing:0.3714em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4185em; left:8.045em;z-index:890; "><span class="stl_15 stl_16 stl_1493" style="word-spacing:-0.0318em;">i f</span><span class="stl_15 stl_16 stl_1493" style="word-spacing:0.7098em;">&nbsp;</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:0.7098em;">((</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:0.0652em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:-0.0317em;">&nbsp;</span><span class="stl_107 stl_108 stl_1493" style="word-spacing:0.0652em;">−</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:-0.0317em;">&gt;f</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:-0.0378em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:-0.0368em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:-0.0378em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:-0.0378em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:0.4742em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:0.4082em;">&nbsp;(SRI_MASTER|SRI_SLAVE)</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:0.0032em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:0.3917em;">&nbsp;&amp;&amp; ri</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:-0.0324em;">&nbsp;</span><span class="stl_107 stl_108 stl_1493" style="word-spacing:0.3917em;">−</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:-0.0324em;">&gt;pc</span><span class="stl_10 stl_11 stl_1493" style="word-spacing:0.3402em;">&nbsp;== &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:9.5em;"><span class="stl_10 stl_11 stl_82" style="word-spacing:0.5935em;">NULL) { &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:10.0008em;z-index:949; "><span class="stl_10 stl_11 stl_227">ri</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.1644em;">&nbsp;</span><span class="stl_107 stl_108 stl_227">−</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.1644em;">&gt;pc</span><span class="stl_10 stl_11 stl_227" style="word-spacing:0.2369em;">&nbsp;=</span><span class="stl_10 stl_11 stl_227" style="word-spacing:0.2729em;">&nbsp;redisAsyncConnect</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.1321em;">&nbsp;(</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.1031em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.1654em;">&nbsp;</span><span class="stl_107 stl_108 stl_227" style="word-spacing:-0.1031em;">−</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.1654em;">&gt;addr</span><span class="stl_107 stl_108 stl_227" style="word-spacing:-0.1654em;">−</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.1654em;">&gt;ip</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.0441em;">&nbsp;, ri</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.1648em;">&nbsp;</span><span class="stl_107 stl_108 stl_227" style="word-spacing:-0.0441em;">−</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.1648em;">&gt;addr</span><span class="stl_107 stl_108 stl_227" style="word-spacing:-0.1648em;">−</span><span class="stl_10 stl_11 stl_227" style="word-spacing:-0.1648em;">&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:11.6442em;"><span class="stl_10 stl_11 stl_126" style="word-spacing:-0.2333em;">port ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:10.4133em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">连</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;接</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;出</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;错 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">194 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 17.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">监视机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:10.0375em;z-index:32; "><span class="stl_15 stl_16 stl_1494" style="word-spacing:-0.1049em;">i f</span><span class="stl_15 stl_16 stl_1494" style="word-spacing:0.6015em;">&nbsp;</span><span class="stl_10 stl_11 stl_1494" style="word-spacing:0.6015em;">(</span><span class="stl_10 stl_11 stl_1494" style="word-spacing:-0.0429em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1494" style="word-spacing:-0.104em;">&nbsp;</span><span class="stl_107 stl_108 stl_1494" style="word-spacing:-0.0429em;">−</span><span class="stl_10 stl_11 stl_1494" style="word-spacing:-0.104em;">&gt;pc</span><span class="stl_107 stl_108 stl_1494" style="word-spacing:-0.104em;">−</span><span class="stl_10 stl_11 stl_1494" style="word-spacing:-0.104em;">&gt;err</span><span class="stl_10 stl_11 stl_1494" style="word-spacing:-0.0319em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1494" style="word-spacing:-0.0319em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:12.4057em;z-index:42; "><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">错</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;误</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;处</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;理 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 7.7118em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 7.7068em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.7043em; left:12.1125em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 8.7093em; left:12.4057em;"><span class="stl_58 stl_59 stl_430">/</span><span class="stl_58 stl_59 stl_430" style="word-spacing:-0.1342em;">&nbsp;</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.1342em;">此 连</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;接</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;被</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;绑</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;定</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;到</span><span class="stl_17 stl_18 stl_430" style="word-spacing:0.303em;">&nbsp;</span><span class="stl_58 stl_59 stl_430" style="word-spacing:0.303em;">redis</span><span class="stl_58 stl_59 stl_430" style="word-spacing:-0.0449em;">&nbsp;</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.0449em;">服 务</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;器</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;的</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;事</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;件</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;中</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;心 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:12.5716em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:11.9325em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:12.4057em;"><span class="stl_58 stl_59 stl_106">/</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.3745em;">&nbsp;</span><span class="stl_17 stl_18 stl_106" style="word-spacing:0.3745em;">订</span><span class="stl_17 stl_18 stl_106" style="word-spacing:-0.1863em;">&nbsp;阅</span><span class="stl_17 stl_18 stl_106" style="word-spacing:-0.1853em;">&nbsp;了</span><span class="stl_17 stl_18 stl_106" style="word-spacing:0.4725em;">&nbsp;</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.4725em;">r</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2293em;">&nbsp;i</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.4722em;">&nbsp;</span><span class="stl_17 stl_18 stl_106" style="word-spacing:0.4722em;">上</span><span class="stl_17 stl_18 stl_106" style="word-spacing:-0.1853em;">&nbsp;的</span><span class="stl_17 stl_18 stl_106" style="word-spacing:0.3827em;">&nbsp;</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.3827em;">__sentinel__</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.1713em;">&nbsp;:</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.0703em;">&nbsp;h</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2183em;">&nbsp;e</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2173em;">&nbsp;l</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2173em;">&nbsp;l</span><span class="stl_58 stl_59 stl_106" style="word-spacing:-0.2183em;">&nbsp;o</span><span class="stl_58 stl_59 stl_106" style="word-spacing:0.483em;">&nbsp;</span><span class="stl_17 stl_18 stl_106" style="word-spacing:0.483em;">频</span><span class="stl_17 stl_18 stl_106" style="word-spacing:0.483em;">&nbsp;道 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:12.4057em;"><span class="stl_58 stl_59 stl_939" style="word-spacing:0.1319em;">* Now</span><span class="stl_58 stl_59 stl_939" style="word-spacing:0.0959em;">&nbsp;we</span><span class="stl_58 stl_59 stl_939" style="word-spacing:0.2749em;">&nbsp;subscribe</span><span class="stl_58 stl_59 stl_939" style="word-spacing:0.3626em;">&nbsp;to the Sentinels</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.0082em;">&nbsp;” Hello</span><span class="stl_58 stl_59 stl_939" style="word-spacing:-0.0082em;">&nbsp;” &nbsp;</span></div>
					<div class="stl_01" style="top: 13.691em; left:13.635em;"><span class="stl_58 stl_59 stl_490" style="word-spacing:-0.1989em;">channel .</span><span class="stl_58 stl_59 stl_490" style="word-spacing:0.3511em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:12.01em;z-index:182; "><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1804em;">r e</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1794em;">&nbsp;t</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1794em;">&nbsp;v</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1804em;">&nbsp;a</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1794em;">&nbsp;l</span><span class="stl_10 stl_11 stl_622" style="word-spacing:0.3316em;">&nbsp;=</span><span class="stl_10 stl_11 stl_622" style="word-spacing:0.2316em;">&nbsp;redisAsyncCommand</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1734em;">&nbsp;(</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.0944em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1569em;">&nbsp;</span><span class="stl_107 stl_108 stl_622" style="word-spacing:-0.0944em;">−</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1569em;">&gt;pc</span><span class="stl_10 stl_11 stl_622" style="word-spacing:-0.1569em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:13.9842em;"><span class="stl_10 stl_11 stl_447" style="word-spacing:-0.0473em;">sentinelReceiveHelloMessages ,</span><span class="stl_10 stl_11 stl_447" style="word-spacing:0.2347em;">&nbsp;NULL,</span><span class="stl_10 stl_11 stl_447" style="word-spacing:0.2347em;">&nbsp;” &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:15.505em;"><span class="stl_10 stl_11 stl_1495" style="word-spacing:-0.0167em;">SUBSCRIBE␣%s ”</span><span class="stl_10 stl_11 stl_1495" style="word-spacing:-0.0167em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6743em; left:15.7992em;"><span class="stl_10 stl_11 stl_1496" style="word-spacing:0.1738em;">SENTINEL_HELLO_CHANNEL) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:12.1125em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 18.671em; left:12.5716em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 20.6635em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 26.201em; left:7.5658em;"><span class="stl_10 stl_11 stl_1451" style="word-spacing:0.0819em;">redis </span><span class="stl_17 stl_18 stl_1451" style="word-spacing:0.0819em;">在定时程序中会尝试对所有的 </span><span class="stl_10 stl_11 stl_1451" style="word-spacing:0.0819em;">master </span><span class="stl_17 stl_18 stl_1451" style="word-spacing:0.0819em;">作重连接。这里会有一个疑问，之前 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.1977em; left:5.9058em;"><span class="stl_17 stl_18 stl_1497">有提到从机（</span><span class="stl_10 stl_11 stl_1497">slave</span><span class="stl_17 stl_18 stl_1497">），哨兵又是在什么时候连接了从机和哨兵呢？ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.6749em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 37.6749em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">7.4 HELLO</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1256em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1256em;">命令 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:7.5658em;"><span class="stl_17 stl_18 stl_505" style="word-spacing:0.156em;">我们从上面 </span><span class="stl_10 stl_11 stl_505" style="word-spacing:0.156em;">sentinelReconnectInstance() </span><span class="stl_17 stl_18 stl_505" style="word-spacing:0.156em;">的源码得知，哨兵对于一个 </span><span class="stl_10 stl_11 stl_505" style="word-spacing:0.156em;">redis </span><span class="stl_17 stl_18 stl_505" style="word-spacing:0.156em;">服 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.6457em; left:5.9058em;"><span class="stl_17 stl_18 stl_235">务器管理了两个连接：普通命令连接和订阅发布专用连接。其中，哨兵在初始化 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:5.9058em;"><span class="stl_17 stl_18 stl_1498" style="word-spacing:0.1061em;">订阅发布连接的时候，做了两个工作：一是，有向 </span><span class="stl_10 stl_11 stl_1498" style="word-spacing:0.1061em;">redis </span><span class="stl_17 stl_18 stl_1498" style="word-spacing:0.1061em;">服务器发送 </span><span class="stl_10 stl_11 stl_1498" style="word-spacing:0.1061em;">SUBSCRIBE &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_10 stl_11 stl_712" style="word-spacing:0.0755em;">SENTINEL_HELLO_CHANNEL </span><span class="stl_17 stl_18 stl_712" style="word-spacing:0.0755em;">命令；二是，注册了回调函数 </span><span class="stl_10 stl_11 stl_712" style="word-spacing:0.0755em;">sentinelReceiveHel- &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">loMessages()</span><span class="stl_17 stl_18 stl_07">。稍稍理解大概可以画出下面的数据流向图： &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">17.4. HELLO</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0835em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0835em;">命令 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">195 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">196 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 17.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">监视机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6902em; left:7.5658em;"><span class="stl_17 stl_18 stl_1499" style="word-spacing:0.0869em;">从源码来看，哨兵 </span><span class="stl_10 stl_11 stl_1499" style="word-spacing:0.0869em;">A </span><span class="stl_17 stl_18 stl_1499" style="word-spacing:0.0869em;">向 </span><span class="stl_10 stl_11 stl_1499" style="word-spacing:0.0869em;">master 1 </span><span class="stl_17 stl_18 stl_1499" style="word-spacing:0.0869em;">的 </span><span class="stl_10 stl_11 stl_1499" style="word-spacing:0.0869em;">HELLO </span><span class="stl_17 stl_18 stl_1499" style="word-spacing:0.0869em;">频道发布的数据有：哨兵 </span><span class="stl_10 stl_11 stl_1499" style="word-spacing:0.0869em;">A </span><span class="stl_17 stl_18 stl_1499" style="word-spacing:0.0869em;">的 </span><span class="stl_10 stl_11 stl_1499" style="word-spacing:0.0869em;">IP &nbsp;</span></div>
					<div class="stl_01" style="top: 31.686em; left:5.9058em;"><span class="stl_17 stl_18 stl_590" style="word-spacing:0.0851em;">地址，端口，</span><span class="stl_10 stl_11 stl_590" style="word-spacing:0.0851em;">runid</span><span class="stl_17 stl_18 stl_590" style="word-spacing:0.0851em;">，当前配置版本，以及主机 </span><span class="stl_10 stl_11 stl_590" style="word-spacing:0.0851em;">1 </span><span class="stl_17 stl_18 stl_590" style="word-spacing:0.0851em;">的 </span><span class="stl_10 stl_11 stl_590" style="word-spacing:0.0851em;">IP</span><span class="stl_17 stl_18 stl_590" style="word-spacing:0.0851em;">，端口，当前配置版本。从上 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6826em; left:5.9058em;"><span class="stl_17 stl_18 stl_1500" style="word-spacing:0.0847em;">图可以看出，其他所有监视同一 </span><span class="stl_10 stl_11 stl_1500" style="word-spacing:0.0847em;">redis </span><span class="stl_17 stl_18 stl_1500" style="word-spacing:0.0847em;">服务器的哨兵都能都到一份 </span><span class="stl_10 stl_11 stl_1500" style="word-spacing:0.0847em;">HELLO </span><span class="stl_17 stl_18 stl_1500" style="word-spacing:0.0847em;">数据，这 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.9007em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">是订阅发布相关的技术，在之前的篇章中详细讲过。 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.7652em; left:7.5658em;z-index:173; "><span class="stl_17 stl_18 stl_346">在定时程序的调用链：</span><span class="stl_10 stl_11 stl_346">sentinelTimer()-&gt;sentinelHandleRedisInstance()-&gt;sentinelPingInstance() &nbsp;</span></div>
					<div class="stl_01" style="top: 36.761em; left:5.9058em;"><span class="stl_17 stl_18 stl_342" style="word-spacing:0.0878em;">中，哨兵会向 </span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.0878em;">redis </span><span class="stl_17 stl_18 stl_342" style="word-spacing:0.0878em;">服务器的 </span><span class="stl_10 stl_11 stl_342" style="word-spacing:0.0878em;">hello </span><span class="stl_17 stl_18 stl_342" style="word-spacing:0.0878em;">频道发布数据，这些或许能为我们上面提到的问 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.7577em; left:5.9058em;"><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0842em;">题提供答案。很容易就能在 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0842em;">sentinel.c </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0842em;">文件中找到向 </span><span class="stl_10 stl_11 stl_156" style="word-spacing:0.0842em;">hello </span><span class="stl_17 stl_18 stl_156" style="word-spacing:0.0842em;">频道发布数据的函数： &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:5.9875em;"><span class="stl_15 stl_16 stl_344">int</span><span class="stl_15 stl_16 stl_344" style="word-spacing:0.3072em;">&nbsp;</span><span class="stl_10 stl_11 stl_344" style="word-spacing:0.3072em;">sentinelSendHello</span><span class="stl_10 stl_11 stl_344" style="word-spacing:-0.2868em;">&nbsp;(</span><span class="stl_10 stl_11 stl_344" style="word-spacing:-0.2788em;">&nbsp;sentinelRedisInstance</span><span class="stl_10 stl_11 stl_344" style="word-spacing:-0.0386em;">&nbsp;* r</span><span class="stl_10 stl_11 stl_344" style="word-spacing:-0.3548em;">&nbsp;i</span><span class="stl_10 stl_11 stl_344" style="word-spacing:-0.2488em;">&nbsp;)</span><span class="stl_10 stl_11 stl_344" style="word-spacing:-0.2488em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.4251em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 42.4293em; left:8.4207em;"><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0295em;">/ r i</span><span class="stl_58 stl_59 stl_79" style="word-spacing:0.3415em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:0.3415em;">可</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.317em;">&nbsp;以</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;机，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;机。 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">只 是</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;和</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;作</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;为</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;一</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;个</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;中</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;转，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;主</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;从</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;机</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;收</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;到</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0298em;">&nbsp;</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0298em;">p u</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.365em;">&nbsp;b</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.365em;">&nbsp;l</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.365em;">&nbsp;i</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.365em;">&nbsp;s</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.365em;">&nbsp;h</span><span class="stl_58 stl_59 stl_79" style="word-spacing:0.3356em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:0.3356em;">命</span><span class="stl_17 stl_18 stl_79" style="word-spacing:0.3356em;">&nbsp;令 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.6424em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0501em;">后 会 将 数 据 传 输 给 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.4176em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 45.4176em; left:8.4207em;"><span class="stl_58 stl_59 stl_581">/</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.0752em;">&nbsp;</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.0752em;">订 阅</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;了</span><span class="stl_17 stl_18 stl_581" style="word-spacing:0.3508em;">&nbsp;</span><span class="stl_58 stl_59 stl_581" style="word-spacing:0.3508em;">h</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.349em;">&nbsp;e</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.35em;">&nbsp;l</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.349em;">&nbsp;l</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.349em;">&nbsp;o</span><span class="stl_58 stl_59 stl_581" style="word-spacing:0.3511em;">&nbsp;</span><span class="stl_17 stl_18 stl_581" style="word-spacing:0.3511em;">频</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.318em;">&nbsp;道</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;的</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;哨</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;兵。</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;这</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;里</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;可</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;能</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;会</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;有</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;疑</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.283em;">&nbsp;问，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;为</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;什</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;么</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;不</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;直 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0587em;">接 发 给 哨 兵 ？ ？ ？ &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:7.9342em;"><span class="stl_15 stl_16 stl_559">char</span><span class="stl_15 stl_16 stl_559" style="word-spacing:0.555em;">&nbsp;</span><span class="stl_10 stl_11 stl_559" style="word-spacing:0.555em;">ip</span><span class="stl_10 stl_11 stl_559" style="word-spacing:0.0726em;">&nbsp;[REDIS_IP_STR_LEN</span><span class="stl_10 stl_11 stl_559" style="word-spacing:-0.0474em;">&nbsp;]</span><span class="stl_10 stl_11 stl_559" style="word-spacing:-0.0474em;">&nbsp;; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">17.4. HELLO</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0835em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0835em;">命令 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">197 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:7.9342em;"><span class="stl_15 stl_16 stl_205">char</span><span class="stl_15 stl_16 stl_205" style="word-spacing:0.4429em;">&nbsp;</span><span class="stl_10 stl_11 stl_205" style="word-spacing:0.4429em;">payload</span><span class="stl_10 stl_11 stl_205" style="word-spacing:-0.0394em;">&nbsp;[REDIS_IP_STR_LEN+1024]; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:7.98em;"><span class="stl_15 stl_16 stl_290">int</span><span class="stl_15 stl_16 stl_290" style="word-spacing:0.4051em;">&nbsp;</span><span class="stl_10 stl_11 stl_290" style="word-spacing:0.4051em;">r</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.295em;">&nbsp;e</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;t</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;v</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.295em;">&nbsp;a</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;l</span><span class="stl_10 stl_11 stl_290" style="word-spacing:-0.294em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:8.0192em;z-index:93; "><span class="stl_10 stl_11 stl_1389" style="word-spacing:0.3938em;">sentinelRedisInstance *master</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:0.2078em;">&nbsp;= (</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.1642em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.2264em;">&nbsp;</span><span class="stl_107 stl_108 stl_1389" style="word-spacing:-0.1642em;">−</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.2264em;">&gt;f</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.2312em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.2322em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.2322em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:-0.2312em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:0.2788em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1389" style="word-spacing:0.0398em;">&nbsp;SRI_MASTER) &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:9.6117em;"><span class="stl_10 stl_11 stl_07">?</span></div>
					<div class="stl_01" style="top: 8.7076em; left:10.701em;z-index:118; "><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.1786em;">r i</span><span class="stl_10 stl_11 stl_184" style="word-spacing:0.5599em;">&nbsp;: ri</span><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.1801em;">&nbsp;</span><span class="stl_107 stl_108 stl_184" style="word-spacing:0.5599em;">−</span><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.1801em;">&gt;master</span><span class="stl_10 stl_11 stl_184" style="word-spacing:-0.1801em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:8.0008em;"><span class="stl_10 stl_11 stl_479" style="word-spacing:0.3215em;">sentinelAddr *master_addr</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.3215em;">&nbsp;= &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:9.6533em;"><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.2523em;">sentinelGetCurrentMasterAddress ( master ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 12.6943em; left:8.4207em;"><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.2642em;">* Try</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.3242em;">&nbsp;to</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.3932em;">&nbsp;obtain our</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.2592em;">&nbsp;own</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.2222em;">&nbsp;IP</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.3272em;">&nbsp;address</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:-0.1708em;">&nbsp;.</span><span class="stl_58 stl_59 stl_1002" style="word-spacing:0.3672em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:8.045em;z-index:245; "><span class="stl_15 stl_16 stl_1501" style="word-spacing:-0.1478em;">i f</span><span class="stl_15 stl_16 stl_1501" style="word-spacing:0.5586em;">&nbsp;</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:0.5586em;">(</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.1608em;">&nbsp;anetSockName</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.1598em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.0858em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.147em;">&nbsp;</span><span class="stl_107 stl_108 stl_1501" style="word-spacing:-0.0858em;">−</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.147em;">&gt;cc</span><span class="stl_107 stl_108 stl_1501" style="word-spacing:-0.147em;">−</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.147em;">&gt;c</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.0858em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.0788em;">&nbsp;fd</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.0328em;">&nbsp;, ip</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:0.0202em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.0391em;">&nbsp;</span><span class="stl_15 stl_16 stl_1501" style="word-spacing:-0.0391em;">sizeof</span><span class="stl_15 stl_16 stl_1501" style="word-spacing:-0.0946em;">&nbsp;</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.0946em;">(</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.0968em;">&nbsp;ip</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.0968em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:-0.0038em;">&nbsp;,NULL)</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:0.2632em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:0.2101em;">&nbsp;</span><span class="stl_107 stl_108 stl_1501" style="word-spacing:0.2632em;">−</span><span class="stl_10 stl_11 stl_1501" style="word-spacing:0.2101em;">1) &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:9.6058em;z-index:291; "><span class="stl_15 stl_16 stl_1502" style="word-spacing:0.3618em;">return </span><span class="stl_10 stl_11 stl_1502" style="word-spacing:0.3618em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:8.045em;z-index:297; "><span class="stl_15 stl_16 stl_1258" style="word-spacing:-0.0167em;">i f</span><span class="stl_15 stl_16 stl_1258" style="word-spacing:0.6897em;">&nbsp;</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:0.6897em;">(</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:0.0453em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0157em;">&nbsp;</span><span class="stl_107 stl_108 stl_1258" style="word-spacing:0.0453em;">−</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0157em;">&gt;f</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0217em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0227em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0227em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:-0.0217em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:0.4883em;">&nbsp;&amp;</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:0.2563em;">&nbsp;SRI_DISCONNECTED)</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:0.5698em;">&nbsp;</span><span class="stl_15 stl_16 stl_1258" style="word-spacing:0.5698em;">return</span><span class="stl_15 stl_16 stl_1258" style="word-spacing:0.4044em;">&nbsp;</span><span class="stl_10 stl_11 stl_1258" style="word-spacing:0.4044em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6685em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 20.6651em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.676em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">格 式</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;化</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;需</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;要</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;发</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;送</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;据，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;包</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;括： &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4207em;"><span class="stl_58 stl_59 stl_95">/</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.3em;">&nbsp;</span><span class="stl_17 stl_18 stl_95" style="word-spacing:0.3em;">哨</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2608em;">&nbsp;兵</span><span class="stl_17 stl_18 stl_95" style="word-spacing:0.2861em;">&nbsp;</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.2861em;">IP</span><span class="stl_58 stl_59 stl_95" style="word-spacing:0.2861em;">&nbsp;</span><span class="stl_17 stl_18 stl_95" style="word-spacing:0.2861em;">地</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2268em;">&nbsp;址，</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2268em;">&nbsp;端</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2258em;">&nbsp;口，</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2261em;">&nbsp;</span><span class="stl_58 stl_59 stl_95" style="word-spacing:-0.2261em;">runnid</span><span class="stl_58 stl_59 stl_95" style="word-spacing:-0.2605em;">&nbsp;</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2605em;">，</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2598em;">&nbsp;当</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2598em;">&nbsp;前</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2598em;">&nbsp;配</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2598em;">&nbsp;置</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2598em;">&nbsp;版</span><span class="stl_17 stl_18 stl_95" style="word-spacing:-0.2268em;">&nbsp;本， &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6685em; left:8.4207em;"><span class="stl_58 stl_59 stl_556">/</span><span class="stl_58 stl_59 stl_556" style="word-spacing:0.3025em;">&nbsp;</span><span class="stl_17 stl_18 stl_556" style="word-spacing:0.3025em;">主</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2583em;">&nbsp;机</span><span class="stl_17 stl_18 stl_556" style="word-spacing:0.2886em;">&nbsp;</span><span class="stl_58 stl_59 stl_556" style="word-spacing:0.2886em;">IP</span><span class="stl_58 stl_59 stl_556" style="word-spacing:0.2885em;">&nbsp;</span><span class="stl_17 stl_18 stl_556" style="word-spacing:0.2885em;">地</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2243em;">&nbsp;址，</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2243em;">&nbsp;端</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2233em;">&nbsp;口，</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2243em;">&nbsp;当</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2573em;">&nbsp;前</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2573em;">&nbsp;配</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2573em;">&nbsp;置</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2573em;">&nbsp;的</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2573em;">&nbsp;版</span><span class="stl_17 stl_18 stl_556" style="word-spacing:-0.2573em;">&nbsp;本 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6651em; left:8.4207em;"><span class="stl_58 stl_59 stl_288" style="word-spacing:0.2857em;">* Format and</span><span class="stl_58 stl_59 stl_288" style="word-spacing:0.3252em;">&nbsp;send</span><span class="stl_58 stl_59 stl_288" style="word-spacing:0.4066em;">&nbsp;the Hello message</span><span class="stl_58 stl_59 stl_288" style="word-spacing:-0.1898em;">&nbsp;.</span><span class="stl_58 stl_59 stl_288" style="word-spacing:0.3852em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6543em; left:8.025em;"><span class="stl_10 stl_11 stl_869" style="word-spacing:-0.2467em;">s n p r i n t f ( payload , </span><span class="stl_15 stl_16 stl_869" style="word-spacing:-0.2467em;">sizeof </span><span class="stl_10 stl_11 stl_869" style="word-spacing:-0.2467em;">( payload ) , &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:9.9433em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 22.656em; left:10.2929em;"><span class="stl_10 stl_11 stl_461" style="word-spacing:-0.2449em;">%s ,%d,%s</span><span class="stl_10 stl_11 stl_461" style="word-spacing:-0.2439em;">&nbsp;,%</span><span class="stl_10 stl_11 stl_461" style="word-spacing:-0.2429em;">&nbsp;llu</span><span class="stl_10 stl_11 stl_461" style="word-spacing:-0.0804em;">&nbsp;, ”</span><span class="stl_10 stl_11 stl_461" style="word-spacing:0.3128em;">&nbsp;</span><span class="stl_58 stl_59 stl_461" style="word-spacing:0.3128em;">/*</span><span class="stl_58 stl_59 stl_461" style="word-spacing:0.3751em;">&nbsp;Info</span><span class="stl_58 stl_59 stl_461" style="word-spacing:0.4446em;">&nbsp;about t</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.2419em;">&nbsp;h</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.2429em;">&nbsp;i</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.2429em;">&nbsp;s</span><span class="stl_58 stl_59 stl_461" style="word-spacing:0.5181em;">&nbsp;s</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.2489em;">&nbsp;e</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.2499em;">&nbsp;n</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.2489em;">&nbsp;t</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.2499em;">&nbsp;i</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.2499em;">&nbsp;n</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.2489em;">&nbsp;e</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.2499em;">&nbsp;l</span><span class="stl_58 stl_59 stl_461" style="word-spacing:-0.1029em;">&nbsp;.</span><span class="stl_58 stl_59 stl_461" style="word-spacing:0.3951em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6518em; left:9.9433em;"><span class="stl_10 stl_11 stl_07">”</span></div>
					<div class="stl_01" style="top: 23.6518em; left:10.2929em;"><span class="stl_10 stl_11 stl_947" style="word-spacing:-0.261em;">%s ,%s</span><span class="stl_10 stl_11 stl_947" style="word-spacing:-0.26em;">&nbsp;,%d,%</span><span class="stl_10 stl_11 stl_947" style="word-spacing:-0.225em;">&nbsp;l</span><span class="stl_10 stl_11 stl_947" style="word-spacing:-0.255em;">&nbsp;l</span><span class="stl_10 stl_11 stl_947" style="word-spacing:-0.255em;">&nbsp;u</span><span class="stl_10 stl_11 stl_947" style="word-spacing:-0.191em;">&nbsp;”</span><span class="stl_10 stl_11 stl_947" style="word-spacing:-0.148em;">&nbsp;,</span><span class="stl_10 stl_11 stl_947" style="word-spacing:0.3493em;">&nbsp;</span><span class="stl_58 stl_59 stl_947" style="word-spacing:0.3493em;">/* Info</span><span class="stl_58 stl_59 stl_947" style="word-spacing:0.402em;">&nbsp;about current master</span><span class="stl_58 stl_59 stl_947" style="word-spacing:-0.188em;">&nbsp;.</span><span class="stl_58 stl_59 stl_947" style="word-spacing:0.379em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:9.9667em;"><span class="stl_10 stl_11 stl_580" style="word-spacing:-0.1489em;">ip ,</span><span class="stl_10 stl_11 stl_580" style="word-spacing:0.4121em;">&nbsp;server</span><span class="stl_10 stl_11 stl_580" style="word-spacing:-0.1879em;">&nbsp;.</span><span class="stl_10 stl_11 stl_580" style="word-spacing:-0.2379em;">&nbsp;port</span><span class="stl_10 stl_11 stl_580" style="word-spacing:-0.1439em;">&nbsp;,</span><span class="stl_10 stl_11 stl_580" style="word-spacing:0.4121em;">&nbsp;server</span><span class="stl_10 stl_11 stl_580" style="word-spacing:-0.1879em;">&nbsp;.</span><span class="stl_10 stl_11 stl_580" style="word-spacing:-0.2369em;">&nbsp;runid</span><span class="stl_10 stl_11 stl_580" style="word-spacing:-0.2369em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6443em; left:9.9783em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 25.6393em; left:10.4225em;"><span class="stl_15 stl_16 stl_1503" style="word-spacing:0.3182em;">unsigned long long</span><span class="stl_15 stl_16 stl_1503" style="word-spacing:-0.2261em;">&nbsp;</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.2261em;">)</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:0.4787em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.2273em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.2273em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.2263em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.2273em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.2273em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.2263em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.2273em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.0663em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.1363em;">&nbsp;current_epoch</span><span class="stl_10 stl_11 stl_1503" style="word-spacing:-0.1363em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:10.4133em;z-index:623; "><span class="stl_58 stl_59 stl_1160">*</span><span class="stl_58 stl_59 stl_1160" style="word-spacing:0.4191em;">&nbsp;</span><span class="stl_107 stl_108 stl_1160" style="word-spacing:0.4191em;">−−−</span><span class="stl_107 stl_108 stl_1160" style="word-spacing:0.4953em;">&nbsp;</span><span class="stl_58 stl_59 stl_1160" style="word-spacing:0.4953em;">*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6426em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.6368em; left:9.9575em;z-index:666; "><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.0686em;">master</span><span class="stl_107 stl_108 stl_1062" style="word-spacing:-0.0686em;">−</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.0686em;">&gt;name , master_addr</span><span class="stl_107 stl_108 stl_1062" style="word-spacing:-0.0686em;">−</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.0686em;">&gt;ip , master_addr</span><span class="stl_107 stl_108 stl_1062" style="word-spacing:-0.0686em;">−</span><span class="stl_10 stl_11 stl_1062" style="word-spacing:-0.0686em;">&gt;port , &nbsp;</span></div>
					<div class="stl_01" style="top: 28.6335em; left:9.9783em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 28.6285em; left:10.4225em;z-index:710; "><span class="stl_15 stl_16 stl_1135" style="word-spacing:0.3255em;">unsigned long long</span><span class="stl_15 stl_16 stl_1135" style="word-spacing:-0.2188em;">&nbsp;</span><span class="stl_10 stl_11 stl_1135" style="word-spacing:-0.2188em;">)</span><span class="stl_10 stl_11 stl_1135" style="word-spacing:0.404em;">&nbsp;master</span><span class="stl_107 stl_108 stl_1135" style="word-spacing:0.404em;">−</span><span class="stl_10 stl_11 stl_1135" style="word-spacing:0.404em;">&gt;config_epoch</span><span class="stl_10 stl_11 stl_1135" style="word-spacing:-0.171em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1135" style="word-spacing:-0.171em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:8.025em;z-index:740; "><span class="stl_10 stl_11 stl_1504" style="word-spacing:-0.1859em;">r e</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:-0.1849em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:-0.1859em;">&nbsp;v</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:-0.1849em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:-0.1849em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:0.3261em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:0.2261em;">&nbsp;redisAsyncCommand</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:-0.1789em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:-0.0999em;">&nbsp;ri</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:-0.1624em;">&nbsp;</span><span class="stl_107 stl_108 stl_1504" style="word-spacing:-0.0999em;">−</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:-0.1624em;">&gt;cc</span><span class="stl_10 stl_11 stl_1504" style="word-spacing:-0.1624em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:9.9958em;"><span class="stl_10 stl_11 stl_1007" style="word-spacing:0.0242em;">sentinelPublishReplyCallback ,</span><span class="stl_10 stl_11 stl_1007" style="word-spacing:0.3122em;">&nbsp;NULL,</span><span class="stl_10 stl_11 stl_1007" style="word-spacing:0.4342em;">&nbsp;”PUBLISH␣%s</span><span class="stl_10 stl_11 stl_1007" style="word-spacing:-0.2388em;">&nbsp;␣%s</span><span class="stl_10 stl_11 stl_1007" style="word-spacing:-0.2248em;">&nbsp;”</span><span class="stl_10 stl_11 stl_1007" style="word-spacing:-0.2248em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:11.8167em;"><span class="stl_10 stl_11 stl_1505" style="word-spacing:0.0855em;">SENTINEL_HELLO_CHANNEL, payload</span><span class="stl_10 stl_11 stl_1505" style="word-spacing:0.0305em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1505" style="word-spacing:0.0305em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6135em; left:8.045em;"><span class="stl_15 stl_16 stl_1506" style="word-spacing:-0.0324em;">i f</span><span class="stl_15 stl_16 stl_1506" style="word-spacing:0.674em;">&nbsp;</span><span class="stl_10 stl_11 stl_1506" style="word-spacing:0.674em;">(</span><span class="stl_10 stl_11 stl_1506" style="word-spacing:-0.0059em;">&nbsp;r e</span><span class="stl_10 stl_11 stl_1506" style="word-spacing:-0.0564em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1506" style="word-spacing:-0.0554em;">&nbsp;v</span><span class="stl_10 stl_11 stl_1506" style="word-spacing:-0.0554em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1506" style="word-spacing:-0.0564em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1506" style="word-spacing:0.5926em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_1506" style="word-spacing:0.3726em;">&nbsp;REDIS_OK)</span><span class="stl_10 stl_11 stl_1506" style="word-spacing:0.554em;">&nbsp;</span><span class="stl_15 stl_16 stl_1506" style="word-spacing:0.554em;">return</span><span class="stl_15 stl_16 stl_1506" style="word-spacing:0.3887em;">&nbsp;</span><span class="stl_10 stl_11 stl_1506" style="word-spacing:0.3887em;">REDIS_ERR; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:8.0083em;z-index:865; "><span class="stl_10 stl_11 stl_46" style="word-spacing:-0.1332em;">ri </span><span class="stl_107 stl_108 stl_46" style="word-spacing:-0.1332em;">−</span><span class="stl_10 stl_11 stl_46" style="word-spacing:-0.1332em;">&gt;pending_commands++; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:7.9458em;"><span class="stl_15 stl_16 stl_201" style="word-spacing:0.3541em;">return </span><span class="stl_10 stl_11 stl_201" style="word-spacing:0.3541em;">REDIS_OK; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.2898em; left:7.1575em;"><span class="stl_17 stl_18 stl_07">【</span></div>
					<div class="stl_01" style="top: 38.2857em; left:5.9058em;z-index:995; "><span class="stl_17 stl_18 stl_1507">的，顾名思义就好了。这里不是说浅尝辄止，而是能加快我们了解哨兵模块工作原理。】 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.0677em; left:7.9878em;z-index:932; "><span class="stl_17 stl_18 stl_07">在这里</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_1508">，我</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.309em;">&nbsp;</span><span class="stl_17 stl_18 stl_1509" style="word-spacing:0.004em;">们无需知道 </span><span class="stl_10 stl_11 stl_1509" style="word-spacing:0.004em;">redisAsyncConnect()</span><span class="stl_17 stl_18 stl_1509" style="word-spacing:0.004em;">，</span><span class="stl_10 stl_11 stl_1509" style="word-spacing:0.004em;">redisAsyncCommand() </span><span class="stl_17 stl_18 stl_1509" style="word-spacing:0.004em;">是做什么用 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.056em; left:7.5658em;"><span class="stl_17 stl_18 stl_953" style="word-spacing:0.0874em;">当 </span><span class="stl_10 stl_11 stl_953" style="word-spacing:0.0874em;">redis </span><span class="stl_17 stl_18 stl_953" style="word-spacing:0.0874em;">服务器收到来自哨兵的数据时候，会向所有订阅 </span><span class="stl_10 stl_11 stl_953" style="word-spacing:0.0874em;">hello </span><span class="stl_17 stl_18 stl_953" style="word-spacing:0.0874em;">频道的哨兵发布 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.0527em; left:5.9058em;"><span class="stl_17 stl_18 stl_532" style="word-spacing:0.0694em;">数据，由此刚才注册的回调函数 </span><span class="stl_10 stl_11 stl_532" style="word-spacing:0.0694em;">sentinelReceiveHelloMessages() </span><span class="stl_17 stl_18 stl_532" style="word-spacing:0.0694em;">就被调用了。回调函 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.0485em; left:5.9058em;"><span class="stl_17 stl_18 stl_55" style="word-spacing:0.086em;">数 </span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.086em;">sentinelReceiveHelloMessages() </span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.086em;">做了两件事情： &nbsp;</span></div>
					<div class="stl_01" style="top: 44.786em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 46.4127em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 44.786em; left:7.3351em;"><span class="stl_10 stl_11 stl_07">.</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">发现其他监视同一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">服务器的哨兵 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.3351em;"><span class="stl_10 stl_11 stl_532">.</span><span class="stl_10 stl_11 stl_532" style="word-spacing:0.2617em;">&nbsp;</span><span class="stl_17 stl_18 stl_532" style="word-spacing:0.2617em;">更新配置版本，当其他哨兵传递的配置版本更高的时候，会更新</span><span class="stl_17 stl_18 stl_532" style="word-spacing:0.0749em;">&nbsp;</span><span class="stl_10 stl_11 stl_532" style="word-spacing:0.0749em;">redis</span><span class="stl_10 stl_11 stl_532" style="word-spacing:0.0757em;">&nbsp;</span><span class="stl_17 stl_18 stl_532" style="word-spacing:0.0757em;">主服务器 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.9808em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">配置（</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0831em;">IP </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">地址和端口） &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">198 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:24.2767em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 17.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">监视机制 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.5658em;"><span class="stl_17 stl_18 stl_1510" style="word-spacing:0.086em;">总结一下这里的工作原理，哨兵会向 </span><span class="stl_10 stl_11 stl_1510" style="word-spacing:0.086em;">hello </span><span class="stl_17 stl_18 stl_1510" style="word-spacing:0.086em;">频道发送包括：哨兵自己的 </span><span class="stl_10 stl_11 stl_1510" style="word-spacing:0.086em;">IP </span><span class="stl_17 stl_18 stl_1510" style="word-spacing:0.086em;">地址 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:5.9058em;"><span class="stl_17 stl_18 stl_1511" style="word-spacing:0.0945em;">和端口，</span><span class="stl_10 stl_11 stl_1511" style="word-spacing:0.0945em;">runid</span><span class="stl_17 stl_18 stl_1511" style="word-spacing:0.0945em;">，当前的配置版本；其所监视主机的 </span><span class="stl_10 stl_11 stl_1511" style="word-spacing:0.0945em;">IP </span><span class="stl_17 stl_18 stl_1511" style="word-spacing:0.0945em;">地址，端口，当前的配置版 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:5.9058em;"><span class="stl_17 stl_18 stl_1473" style="word-spacing:0.1021em;">本。【这里要说清楚，什么是 </span><span class="stl_10 stl_11 stl_1473" style="word-spacing:0.1021em;">runid </span><span class="stl_17 stl_18 stl_1473" style="word-spacing:0.1021em;">和配置版本】虽然未知的信息很多，但我们可以得 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:5.9058em;"><span class="stl_17 stl_18 stl_510" style="word-spacing:0.0799em;">知，当一个哨兵新加入到一个 </span><span class="stl_10 stl_11 stl_510" style="word-spacing:0.0799em;">redis </span><span class="stl_17 stl_18 stl_510" style="word-spacing:0.0799em;">集群中时，就能通过 </span><span class="stl_10 stl_11 stl_510" style="word-spacing:0.0799em;">hello </span><span class="stl_17 stl_18 stl_510" style="word-spacing:0.0799em;">频道，发现其他更多的 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:5.9058em;"><span class="stl_17 stl_18 stl_22" style="word-spacing:0.0852em;">哨兵，而它自己也能够被其他的哨兵发现。这是 </span><span class="stl_10 stl_11 stl_22" style="word-spacing:0.0852em;">redis </span><span class="stl_17 stl_18 stl_22" style="word-spacing:0.0852em;">所谓 </span><span class="stl_10 stl_11 stl_22" style="word-spacing:0.0852em;">auto discover </span><span class="stl_17 stl_18 stl_22" style="word-spacing:0.0852em;">的一部分。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 11.1055em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 18 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.0464em; left:5.9058em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1247em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1247em;">集群 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.0324em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 21.0324em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">8.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">前奏 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6135em; left:7.5658em;"><span class="stl_10 stl_11 stl_1512" style="word-spacing:0.0866em;">redis cluster </span><span class="stl_17 stl_18 stl_1512" style="word-spacing:0.0866em;">的内容暂时不会在本章节中详细讨论，待稳定版本出来过后再作打 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6093em; left:5.9058em;"><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0837em;">算。集群的概念早在 </span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0837em;">redis 3.0 </span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0837em;">之前讨论了，</span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0837em;">3.0 </span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0837em;">才在源码中出现，但此还处于开发版 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.8282em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">本，不建议应用于正式的产品，问题会比较多，不建议使用。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.7802em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">集群要考虑的问题， &nbsp;</span></div>
					<div class="stl_01" style="top: 30.3318em; left:6.92em;"><span class="stl_10 stl_11 stl_590">1.</span><span class="stl_10 stl_11 stl_590" style="word-spacing:0.245em;">&nbsp;</span><span class="stl_17 stl_18 stl_590" style="word-spacing:0.245em;">节点之间怎么据的同步，如何做到数据一致性。一主一备的模式，可以用</span><span class="stl_17 stl_18 stl_590" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_10 stl_11 stl_590" style="word-spacing:0.0832em;">redis &nbsp;</span></div>
					<div class="stl_01" style="top: 31.3276em; left:7.9808em;"><span class="stl_17 stl_18 stl_1360" style="word-spacing:0.0674em;">内部实现的主从备份实现数据同步。但节点不断增多，存在多个 </span><span class="stl_10 stl_11 stl_1360" style="word-spacing:0.0674em;">master </span><span class="stl_17 stl_18 stl_1360" style="word-spacing:0.0674em;">的时候， &nbsp;</span></div>
					<div class="stl_01" style="top: 32.5465em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">同步的难度会越大。 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.7101em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 38.0926em; left:6.92em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 34.7101em; left:7.3351em;"><span class="stl_10 stl_11 stl_410" style="word-spacing:0.2378em;">. </span><span class="stl_17 stl_18 stl_410" style="word-spacing:0.2378em;">如何做到负载均衡？请求量大的时候，如何将请求尽量均分到各个服务器节点， &nbsp;</span></div>
					<div class="stl_01" style="top: 35.929em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">负载均衡算法做的不好会导致雪崩。 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.0926em; left:7.3351em;"><span class="stl_10 stl_11 stl_226">.</span><span class="stl_10 stl_11 stl_226" style="word-spacing:0.2448em;">&nbsp;</span><span class="stl_17 stl_18 stl_226" style="word-spacing:0.2448em;">如何做到平滑拓展？当业务量增加的时候，能否通过简单的配置即让新的</span><span class="stl_17 stl_18 stl_226" style="word-spacing:0.0831em;">&nbsp;</span><span class="stl_10 stl_11 stl_226" style="word-spacing:0.0831em;">redis &nbsp;</span></div>
					<div class="stl_01" style="top: 39.3107em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">节点变为可用。 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4743em; left:6.92em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 43.8602em; left:6.92em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 41.4743em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">可用性如何？当某些节点鼓掌，能否快速恢复服务器集群的工作能力。 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.8602em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. ...... &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:7.5658em;"><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0852em;">一个稳健的后台系统需要太多的考虑。</span><span class="stl_10 stl_11 stl_115" style="word-spacing:0.0852em;">redis </span><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0852em;">尚未具备集群的能力，但作为内存 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">数据库效率性能远比传统的数据库要高，这里是趋势。 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">99 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">200 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:25.9367em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 18.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">集群 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4507em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.4507em; left:6.5789em;"><span class="stl_38 stl_13 stl_576">8.2</span><span class="stl_38 stl_13 stl_576" style="word-spacing:0.7517em;">&nbsp;</span><span class="stl_39 stl_18 stl_576" style="word-spacing:0.7517em;">也谈一致性哈希算法（</span><span class="stl_38 stl_13 stl_576" style="word-spacing:0.7517em;">consistent</span><span class="stl_38 stl_13 stl_576" style="word-spacing:0.1261em;">&nbsp;hashing</span><span class="stl_39 stl_18 stl_576" style="word-spacing:0.1261em;">） &nbsp;</span></div>
					<div class="stl_01" style="top: 9.4406em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 9.4406em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">8.2.1 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">背景 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.1715em; left:7.5658em;"><span class="stl_17 stl_18 stl_1513">通常，业务量较大的时候，考虑到性能的问题（索引速度慢和访问量过大），不会 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.9451em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0838em;">把所有的数据存放在一个 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0838em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0838em;">服务器上，甚至不能放在一个物理机上。这里需要将 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.9418em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">一堆的键值均分存储到多个 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">服务器，可以通过： &nbsp;</span></div>
					<div class="stl_01" style="top: 19.3426em; left:6.0225em;"><span class="stl_10 stl_11 stl_885" style="word-spacing:0.2193em;">target =</span><span class="stl_10 stl_11 stl_885" style="word-spacing:-0.0924em;">&nbsp;hash (</span><span class="stl_10 stl_11 stl_885" style="word-spacing:-0.2517em;">&nbsp;key</span><span class="stl_10 stl_11 stl_885" style="word-spacing:-0.2527em;">&nbsp;)\%N</span><span class="stl_17 stl_18 stl_885" style="word-spacing:-0.2527em;">，</span><span class="stl_17 stl_18 stl_885" style="word-spacing:-0.2327em;">&nbsp;其</span><span class="stl_17 stl_18 stl_885" style="word-spacing:-0.2327em;">&nbsp;中</span><span class="stl_17 stl_18 stl_885" style="word-spacing:0.408em;">&nbsp;</span><span class="stl_10 stl_11 stl_885" style="word-spacing:0.408em;">target</span><span class="stl_10 stl_11 stl_885" style="word-spacing:0.4087em;">&nbsp;</span><span class="stl_17 stl_18 stl_885" style="word-spacing:0.4087em;">为</span><span class="stl_17 stl_18 stl_885" style="word-spacing:-0.2327em;">&nbsp;目</span><span class="stl_17 stl_18 stl_885" style="word-spacing:-0.2327em;">&nbsp;标</span><span class="stl_17 stl_18 stl_885" style="word-spacing:-0.2327em;">&nbsp;节</span><span class="stl_17 stl_18 stl_885" style="word-spacing:-0.1997em;">&nbsp;点，</span><span class="stl_17 stl_18 stl_885" style="word-spacing:-0.2241em;">&nbsp;</span><span class="stl_10 stl_11 stl_885" style="word-spacing:-0.2241em;">key</span><span class="stl_10 stl_11 stl_885" style="word-spacing:0.3423em;">&nbsp;</span><span class="stl_17 stl_18 stl_885" style="word-spacing:0.3423em;">为</span><span class="stl_17 stl_18 stl_885" style="word-spacing:-0.1997em;">&nbsp;键，</span><span class="stl_10 stl_11 stl_885" style="word-spacing:-0.1997em;">N</span><span class="stl_10 stl_11 stl_885" style="word-spacing:0.1924em;">&nbsp;</span><span class="stl_17 stl_18 stl_885" style="word-spacing:-0.1997em;">为 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.3385em; left:8.1933em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.094em;">r e</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.094em;">&nbsp;d</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.094em;">&nbsp;i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.094em;">&nbsp;s</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.6061em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6061em;">节</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;点</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;的</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;个</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6985em; left:7.5658em;"><span class="stl_17 stl_18 stl_426" style="word-spacing:0.0845em;">哈希取余的方式会将不同的 </span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.0845em;">key </span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.0845em;">分发到不同的服务器上。 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.8715em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">但考虑如下场景： &nbsp;</span></div>
					<div class="stl_01" style="top: 32.296em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 39.7693em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 32.296em; left:7.3351em;"><span class="stl_10 stl_11 stl_577" style="word-spacing:0.2202em;">. </span><span class="stl_17 stl_18 stl_577" style="word-spacing:0.2202em;">业务量突然增加，现有服务器不够用。增加服务器节点后，依然通过上面的计 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.2926em; left:7.9808em;"><span class="stl_17 stl_18 stl_1514" style="word-spacing:0.0879em;">算方式：</span><span class="stl_10 stl_11 stl_1514" style="word-spacing:0.0879em;">hash(key)%(N+1) </span><span class="stl_17 stl_18 stl_1514" style="word-spacing:0.0879em;">做数据分片和分发，但之前的 </span><span class="stl_10 stl_11 stl_1514" style="word-spacing:0.0879em;">key </span><span class="stl_17 stl_18 stl_1514" style="word-spacing:0.0879em;">会被分发到与之 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.2885em; left:7.9808em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">前不同的服务器上，导致大量的数据失效，需要重新写入（</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">set</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">）</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">服务器。 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.7693em; left:7.3351em;"><span class="stl_10 stl_11 stl_577" style="word-spacing:0.2202em;">. </span><span class="stl_17 stl_18 stl_577" style="word-spacing:0.2202em;">其中的一个服务器挂了。如果不做及时的修复，大量被分发到此服务器请求都 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.9882em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">会失效。 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">这也是两个问题。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07">18.2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">也谈一致性哈希算法（</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">CONSISTENT</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">&nbsp;HASHING</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.082em;">） &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">201 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.5223em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.5223em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">8.2.2 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">一致性哈希算法 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:7.5658em;z-index:61; "><span class="stl_17 stl_18 stl_1515" style="word-spacing:0.0828em;">设定一个圆环上 </span><span class="stl_10 stl_11 stl_1515" style="word-spacing:0.0828em;">0 23</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_10 stl_11 stl_07">̂2</span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_10 stl_11 stl_1453" style="word-spacing:0.0835em;">-1 </span><span class="stl_17 stl_18 stl_1453" style="word-spacing:0.0835em;">的点，每个点对应一个缓存区，每个键值对存储的位置 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.6382em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">也经哈希计算后对应到环上节点。但现实中不可能有如此多的节点，所以倘若键值对 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">经哈希计算后对应的位置没有节点，那么顺时针找一个节点存储它。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">202 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:25.9367em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 18.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">集群 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.8048em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">考虑增加服务器节点的情况，该节点顺时针方向的数据仍然被存储到顺时针方向 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.8007em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">的节点上，但它逆时针方向的数据被存储到它自己。这时候只有部分数据会失效，被 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.7973em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">映射到新的缓存区。 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.6423em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">考虑节点减少的情况。该缺失节点顺时针方向上的数据仍然被存储到其顺时针方 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_1516" style="word-spacing:0.0819em;">向上的节点，设为 </span><span class="stl_10 stl_11 stl_1516" style="word-spacing:0.0819em;">beta</span><span class="stl_17 stl_18 stl_1516" style="word-spacing:0.0819em;">，其逆时针方向上的数据会被存储到 </span><span class="stl_10 stl_11 stl_1516" style="word-spacing:0.0819em;">beta </span><span class="stl_17 stl_18 stl_1516" style="word-spacing:0.0819em;">上。同样，只有有 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">部分数据失效，被重新映射到新的服务器节点。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07">18.2.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">也谈一致性哈希算法（</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">CONSISTENT</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">&nbsp;HASHING</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.082em;">） &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">203 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.7776em; left:7.5658em;"><span class="stl_17 stl_18 stl_1517" style="word-spacing:0.0876em;">这种情况比较麻烦，上面图中 </span><span class="stl_10 stl_11 stl_1517" style="word-spacing:0.0876em;">gamma </span><span class="stl_17 stl_18 stl_1517" style="word-spacing:0.0876em;">节点失效后，会有大量数据映射到 </span><span class="stl_10 stl_11 stl_1517" style="word-spacing:0.0876em;">alpha &nbsp;</span></div>
					<div class="stl_01" style="top: 17.7735em; left:5.9058em;"><span class="stl_17 stl_18 stl_1030" style="word-spacing:0.0825em;">节点，最怕 </span><span class="stl_10 stl_11 stl_1030" style="word-spacing:0.0825em;">alpha </span><span class="stl_17 stl_18 stl_1030" style="word-spacing:0.0825em;">扛不住，接下去 </span><span class="stl_10 stl_11 stl_1030" style="word-spacing:0.0825em;">beta </span><span class="stl_17 stl_18 stl_1030" style="word-spacing:0.0825em;">也扛不住，这就是多米诺骨牌效应</span><span class="stl_10 stl_11 stl_1030" style="word-spacing:0.0825em;">;)</span><span class="stl_17 stl_18 stl_1030" style="word-spacing:0.0825em;">。这里涉 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.9923em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">及到数据平衡性和负载均衡的话题。数据平衡性是说，数据尽可能均分到每个节点上 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.9882em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">去，存储达到均衡。 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9206em; left:5.9058em;"><span class="stl_19 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 22.9206em; left:6.4667em;"><span class="stl_19 stl_13 stl_07" style="word-spacing:0.7499em;">8.2.3 </span><span class="stl_20 stl_18 stl_07" style="word-spacing:0.7499em;">虚拟节点 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.6157em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">将多个虚拟节点对应到一个真实的节点，存储可以达到均衡的效果。之前的映射 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.6115em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">方案为： &nbsp;</span></div>
					<div class="stl_01" style="top: 40.8877em; left:5.9675em;"><span class="stl_10 stl_11 stl_1021">key</span><span class="stl_10 stl_11 stl_1021" style="word-spacing:0.2113em;">&nbsp;</span><span class="stl_107 stl_108 stl_1021">−</span><span class="stl_10 stl_11 stl_1021" style="word-spacing:0.2113em;">&gt;</span><span class="stl_10 stl_11 stl_1021" style="word-spacing:0.2752em;">&nbsp;node &nbsp;</span></div>
					<div class="stl_01" style="top: 42.6215em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">中间多了一个层虚拟节点后，多了一层映射关系： &nbsp;</span></div>
					<div class="stl_01" style="top: 44.896em; left:5.9675em;"><span class="stl_10 stl_11 stl_615">key</span><span class="stl_10 stl_11 stl_615" style="word-spacing:0.1785em;">&nbsp;</span><span class="stl_107 stl_108 stl_615">−</span><span class="stl_10 stl_11 stl_615" style="word-spacing:0.1785em;">&gt;</span><span class="stl_10 stl_11 stl_615" style="word-spacing:0.1785em;">&nbsp;&lt;</span><span class="stl_15 stl_16 stl_615" style="word-spacing:0.0554em;">virtual</span><span class="stl_15 stl_16 stl_615" style="word-spacing:0.408em;">&nbsp;</span><span class="stl_10 stl_11 stl_615" style="word-spacing:0.408em;">node&gt;</span><span class="stl_10 stl_11 stl_615" style="word-spacing:0.015em;">&nbsp;</span><span class="stl_107 stl_108 stl_615" style="word-spacing:0.408em;">−</span><span class="stl_10 stl_11 stl_615" style="word-spacing:0.015em;">&gt;</span><span class="stl_10 stl_11 stl_615" style="word-spacing:0.2424em;">&nbsp;node &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">多一个层的好处就是能做到一层的改动对另一层无感知。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">204 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:25.9367em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 18.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">集群 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.9415em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">例如当需要增加物理存储节点的时候，只需要按需增加虚拟节点即可，同时更新 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.9373em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">映射关系表。 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.0673em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">当节点不幸失效的时候，只需要调整虚拟节点和真实节点之间的映射关系即可。 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.5565em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">当发现数据分布已经不均衡了，可以调整虚拟节点和真实节点之间的映射，达到 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.5532em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">新的平衡。 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6057em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">而这对用户来说完全是透明的。同时，负载均衡的目的也达到了。 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.0257em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 36.0257em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">8.3 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">一致性哈希解决的问题 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.604em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">在一致性哈希算法中，数据经哈希后存储在不同的节点中，因此在没有增加或减 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5998em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">少机器的情况下，避开了一致性的话题。在增加或者减少节点的时候，只有一部分的 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5965em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">数据被映射到新的节点，这也说明此时数据会出现不一致的情况，但只有少部分的数 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5923em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">据做变更，可以看出一致性哈希算法尽量弱化了一致性问题。 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:7.5658em;"><span class="stl_17 stl_18 stl_1518" style="word-spacing:0.0849em;">一致性哈细算法的前提是，有一个好的哈希算法，即假设 </span><span class="stl_10 stl_11 stl_1518" style="word-spacing:0.0849em;">hash() </span><span class="stl_17 stl_18 stl_1518" style="word-spacing:0.0849em;">算法计算所得 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:5.9058em;"><span class="stl_17 stl_18 stl_774" style="word-spacing:0.0777em;">哈希结果区间是 </span><span class="stl_10 stl_11 stl_774" style="word-spacing:0.0777em;">[0,N-1]</span><span class="stl_17 stl_18 stl_774" style="word-spacing:0.0777em;">，那么对于一个 </span><span class="stl_10 stl_11 stl_774" style="word-spacing:0.0777em;">key</span><span class="stl_17 stl_18 stl_774" style="word-spacing:0.0777em;">，</span><span class="stl_10 stl_11 stl_774" style="word-spacing:0.0777em;">hash(key) </span><span class="stl_17 stl_18 stl_774" style="word-spacing:0.0777em;">结果落在 </span><span class="stl_10 stl_11 stl_774" style="word-spacing:0.0777em;">[0,N-1] </span><span class="stl_17 stl_18 stl_774" style="word-spacing:0.0777em;">每个点的概 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">率应为 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0823em;">1 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">N</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">。现在较为流行的哈希算法，有如 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">md5</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">，</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">SHA</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">18.4. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">怎么实现？ &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">205 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4507em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.4507em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">8.4 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">怎么实现？ &nbsp;</span></div>
					<div class="stl_01" style="top: 7.8276em; left:7.5658em;"><span class="stl_17 stl_18 stl_1519" style="word-spacing:0.1115em;">一致性哈希算法，既可以在客户端实现，也可以在中间件上实现（如 </span><span class="stl_10 stl_11 stl_1519" style="word-spacing:0.1115em;">proxy</span><span class="stl_17 stl_18 stl_1519" style="word-spacing:0.1115em;">）。在 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.8235em; left:5.9058em;"><span class="stl_17 stl_18 stl_1445" style="word-spacing:0.0818em;">客户端实现中，当客户端初始化的时候，需要初始化一张预备的 </span><span class="stl_10 stl_11 stl_1445" style="word-spacing:0.0818em;">redis </span><span class="stl_17 stl_18 stl_1445" style="word-spacing:0.0818em;">节点的映射表： &nbsp;</span></div>
					<div class="stl_01" style="top: 9.8201em; left:5.9058em;"><span class="stl_10 stl_11 stl_56" style="word-spacing:0.0744em;">hash(key) =&gt; &lt;redis node&gt;.</span><span class="stl_10 stl_11 stl_56" style="word-spacing:0.1968em;">&nbsp;</span><span class="stl_17 stl_18 stl_56" style="word-spacing:0.1968em;">这有一个缺点，假设有多个客户端，当映射表发生变化 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.0382em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">的时候，多个客户端需要同时拉取新的映射表。 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.881em; left:7.5658em;"><span class="stl_17 stl_18 stl_237" style="word-spacing:0.08em;">另一个种是中间件（</span><span class="stl_10 stl_11 stl_237" style="word-spacing:0.08em;">proxy</span><span class="stl_17 stl_18 stl_237" style="word-spacing:0.08em;">）的实现方法，即在客户端和 </span><span class="stl_10 stl_11 stl_237" style="word-spacing:0.08em;">redis </span><span class="stl_17 stl_18 stl_237" style="word-spacing:0.08em;">节点之间加多一个 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.8768em; left:5.9058em;"><span class="stl_17 stl_18 stl_712" style="word-spacing:0.0789em;">代理，代理经过哈希计算后将对应某个 </span><span class="stl_10 stl_11 stl_712" style="word-spacing:0.0789em;">key </span><span class="stl_17 stl_18 stl_712" style="word-spacing:0.0789em;">的请求分发到对应的节点，一致性哈希算 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.8735em; left:5.9058em;"><span class="stl_17 stl_18 stl_35" style="word-spacing:0.0887em;">法就在中间件里面实现。可以发现，</span><span class="stl_10 stl_11 stl_35" style="word-spacing:0.0887em;">twemproxy </span><span class="stl_17 stl_18 stl_35" style="word-spacing:0.0887em;">就是这么做的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5749em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 18.5749em; left:6.5789em;"><span class="stl_38 stl_13 stl_907" style="word-spacing:0.7587em;">8.5 twemproxy</span><span class="stl_38 stl_13 stl_907" style="word-spacing:0.1342em;">&nbsp;- redis</span><span class="stl_38 stl_13 stl_907" style="word-spacing:0.1354em;">&nbsp;</span><span class="stl_39 stl_18 stl_907" style="word-spacing:0.1354em;">集群管理方案 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.9518em; left:7.5658em;"><span class="stl_10 stl_11 stl_360" style="word-spacing:0.1108em;">twemproxy </span><span class="stl_17 stl_18 stl_360" style="word-spacing:0.1108em;">是 </span><span class="stl_10 stl_11 stl_360" style="word-spacing:0.1108em;">twitter </span><span class="stl_17 stl_18 stl_360" style="word-spacing:0.1108em;">开源的一个轻量级的后端代理，兼容 </span><span class="stl_10 stl_11 stl_360" style="word-spacing:0.1108em;">redis/memcache </span><span class="stl_17 stl_18 stl_360" style="word-spacing:0.1108em;">协 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.9477em; left:5.9058em;"><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0848em;">议，可用以管理 </span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.0848em;">redis/memcache </span><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0848em;">集群。 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.3668em; left:7.5658em;z-index:405; "><span class="stl_10 stl_11 stl_1520" style="word-spacing:0.0802em;">twemproxy </span><span class="stl_17 stl_18 stl_1520" style="word-spacing:0.0802em;">内部有实现一致性哈希算法，对于客户端而言，</span><span class="stl_10 stl_11 stl_1520" style="word-spacing:0.0802em;">twemproxy </span><span class="stl_17 stl_18 stl_1520" style="word-spacing:0.0802em;">相当于是 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.3626em; left:5.9058em;"><span class="stl_17 stl_18 stl_286" style="word-spacing:0.0804em;">缓存数据库的入口，它无需知道后端的部署是怎样的。</span><span class="stl_10 stl_11 stl_286" style="word-spacing:0.0804em;">twemproxy </span><span class="stl_17 stl_18 stl_286" style="word-spacing:0.0804em;">会检测与每个节点 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.3593em; left:5.9058em;"><span class="stl_17 stl_18 stl_237" style="word-spacing:0.0857em;">的连接是否健康，出现异常的节点会被剔除；待一段时间后，</span><span class="stl_10 stl_11 stl_237" style="word-spacing:0.0857em;">twemproxy </span><span class="stl_17 stl_18 stl_237" style="word-spacing:0.0857em;">会再次尝试 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5773em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">连接被剔除的节点。 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:7.5658em;"><span class="stl_17 stl_18 stl_116" style="word-spacing:0.1034em;">通常，一个 </span><span class="stl_10 stl_11 stl_116" style="word-spacing:0.1034em;">redis </span><span class="stl_17 stl_18 stl_116" style="word-spacing:0.1034em;">节点池可以分由多个 </span><span class="stl_10 stl_11 stl_116" style="word-spacing:0.1034em;">twemproxy </span><span class="stl_17 stl_18 stl_116" style="word-spacing:0.1034em;">管理，少数 </span><span class="stl_10 stl_11 stl_116" style="word-spacing:0.1034em;">twemproxy </span><span class="stl_17 stl_18 stl_116" style="word-spacing:0.1034em;">负责 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_1521" style="word-spacing:0.0893em;">写，多数负责读。</span><span class="stl_10 stl_11 stl_1521" style="word-spacing:0.0893em;">twemproxy </span><span class="stl_17 stl_18 stl_1521" style="word-spacing:0.0893em;">可以实时获取节电池内的所有 </span><span class="stl_10 stl_11 stl_1521" style="word-spacing:0.0893em;">redis </span><span class="stl_17 stl_18 stl_1521" style="word-spacing:0.0893em;">节点的状态，但其 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_17 stl_18 stl_1392" style="word-spacing:0.0905em;">对故障修复的支持还有待提高。解决的方法是可以借助 </span><span class="stl_10 stl_11 stl_1392" style="word-spacing:0.0905em;">redis sentinel </span><span class="stl_17 stl_18 stl_1392" style="word-spacing:0.0905em;">来实现自动的 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;"><span class="stl_17 stl_18 stl_994" style="word-spacing:0.0884em;">主从切换，当主机 </span><span class="stl_10 stl_11 stl_994" style="word-spacing:0.0884em;">down </span><span class="stl_17 stl_18 stl_994" style="word-spacing:0.0884em;">掉后，</span><span class="stl_10 stl_11 stl_994" style="word-spacing:0.0884em;">sentinel </span><span class="stl_17 stl_18 stl_994" style="word-spacing:0.0884em;">会自动将从机配置为主机。而 </span><span class="stl_10 stl_11 stl_994" style="word-spacing:0.0884em;">twemproxy </span><span class="stl_17 stl_18 stl_994" style="word-spacing:0.0884em;">可 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">206</span><span class="stl_10 stl_11 stl_07" style="word-spacing:22.3763em;">&nbsp;</span><span class="stl_21 stl_11 stl_07" style="word-spacing:22.3763em;">CHAPTER</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">&nbsp;18.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.527em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">集群 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:5.9058em;"><span class="stl_17 stl_18 stl_32" style="word-spacing:0.0843em;">以定时向 </span><span class="stl_10 stl_11 stl_32" style="word-spacing:0.0843em;">redis sentinel </span><span class="stl_17 stl_18 stl_32" style="word-spacing:0.0843em;">拉取信息，从而替换出现异常的节点。 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.1043em; left:7.5658em;"><span class="stl_10 stl_11 stl_846" style="word-spacing:0.0889em;">twemproxy </span><span class="stl_17 stl_18 stl_846" style="word-spacing:0.0889em;">的更多细节，这里不再做深入的讨论。 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.4241em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 23.4241em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">8.6 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1259em;">官方版本支持的集群 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6668em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">最新版本的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">也开始支持集群特性了，再也不用靠着外援过日子了。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6593em; left:7.5658em;"><span class="stl_17 stl_18 stl_509" style="word-spacing:0.085em;">基本的思想是，集群里的每个 </span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.085em;">redis </span><span class="stl_17 stl_18 stl_509" style="word-spacing:0.085em;">都只存储一定的键值对，这个“一定”可以 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.656em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0836em;">通过默认或自定义的哈希函数来决定，当一个 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0836em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0836em;">收到请求后，会首先查看此键值 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6518em; left:5.9058em;"><span class="stl_17 stl_18 stl_457" style="word-spacing:0.0846em;">对是否该由自己来处理，是则继续往下执行；否则会产生一个类似于 </span><span class="stl_10 stl_11 stl_457" style="word-spacing:0.0846em;">http 3XX </span><span class="stl_17 stl_18 stl_457" style="word-spacing:0.0846em;">的重 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.6485em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0819em;">定向，要求客户端去请求集群中的另一个 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0819em;">redis</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0819em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.641em; left:7.5658em;"><span class="stl_10 stl_11 stl_1459" style="word-spacing:0.0663em;">redis </span><span class="stl_17 stl_18 stl_1459" style="word-spacing:0.0663em;">每一个实例都会通过遵守一定的协议来维护这个集群的可用性，稳定性。有 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6368em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">兴趣可前往官网了解 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">集群的实现细则。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 18.5239em; left:17.965em;"><span class="stl_36 stl_13 stl_711" style="word-spacing:0.139em;">Part IV &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2839em; left:16.375em;"><span class="stl_12 stl_13 stl_07" style="word-spacing:0.1251em;">redis </span><span class="stl_37 stl_18 stl_07" style="word-spacing:0.1251em;">操练 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">07 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02" />
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9647em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 19 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.3391em; left:5.9058em;"><span class="stl_37 stl_18 stl_07">积分排行榜 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6107em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 20.6107em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">9.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">需求 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9285em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">积分排行榜是 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0832em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">的经典应用。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.184em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">倘若数据都存在数据库中，每次访问网页都需要对所有的数据做排序，对于日访 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.9585em; left:5.9058em;"><span class="stl_17 stl_18 stl_427" style="word-spacing:0.0857em;">问量大的网站来说，不仅服务器吃不消，用户体验也不佳。在 </span><span class="stl_10 stl_11 stl_427" style="word-spacing:0.0857em;">redis </span><span class="stl_17 stl_18 stl_427" style="word-spacing:0.0857em;">中提供了 </span><span class="stl_10 stl_11 stl_427" style="word-spacing:0.0857em;">sorted &nbsp;</span></div>
					<div class="stl_01" style="top: 26.9543em; left:5.9058em;"><span class="stl_10 stl_11 stl_1522" style="word-spacing:0.0865em;">set </span><span class="stl_17 stl_18 stl_1522" style="word-spacing:0.0865em;">数据结构——有序集合，其底层实现是跳表，因此插入和删除的效率都很高，适 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.1732em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">用于需实时排序的场景，游戏中的积分排行榜就是一个例子。 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4857em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 31.4857em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">9.2 ZSET</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1261em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1261em;">命令简介 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.8043em; left:7.5658em;"><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0862em;">针对有序集合，</span><span class="stl_10 stl_11 stl_115" style="word-spacing:0.0862em;">redis </span><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0862em;">准备了一系列的命令，实现排行榜需要了解相关命令的使 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.0223em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">用。 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.7893em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 40.6043em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 36.7893em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2498em;">. ZADD</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2498em;">：添加新的元素，用法如下： &nbsp;</span></div>
					<div class="stl_01" style="top: 37.7851em; left:7.9808em;"><span class="stl_10 stl_11 stl_907" style="word-spacing:0.0639em;">ZADD key score member [score member ...]</span><span class="stl_10 stl_11 stl_907" style="word-spacing:0.1945em;">&nbsp;key</span><span class="stl_10 stl_11 stl_907" style="word-spacing:0.0628em;">&nbsp;</span><span class="stl_17 stl_18 stl_907" style="word-spacing:0.0628em;">表示有序集合的键名；</span><span class="stl_10 stl_11 stl_907" style="word-spacing:0.0628em;">member &nbsp;</span></div>
					<div class="stl_01" style="top: 38.7818em; left:7.9808em;z-index:309; "><span class="stl_17 stl_18 stl_1523" style="word-spacing:0.0715em;">即是元素数据，</span><span class="stl_10 stl_11 stl_1523" style="word-spacing:0.0715em;">score </span><span class="stl_17 stl_18 stl_1523" style="word-spacing:0.0715em;">表示元素的积分。内部主要是按 </span><span class="stl_10 stl_11 stl_1523" style="word-spacing:0.0715em;">member </span><span class="stl_17 stl_18 stl_1523" style="word-spacing:0.0715em;">和 </span><span class="stl_10 stl_11 stl_1523" style="word-spacing:0.0715em;">score </span><span class="stl_17 stl_18 stl_1523" style="word-spacing:0.0715em;">来排序。 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.6043em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. ZRANGE</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">：按分数从低到高返回给定排名区间的元素，用法如下： &nbsp;</span></div>
					<div class="stl_01" style="top: 41.6002em; left:7.9808em;"><span class="stl_10 stl_11 stl_104" style="word-spacing:0.0921em;">ZRANGE key start stop [WITHSCORES] start </span><span class="stl_17 stl_18 stl_104" style="word-spacing:0.0921em;">表示起始排名，</span><span class="stl_10 stl_11 stl_104" style="word-spacing:0.0921em;">stop </span><span class="stl_17 stl_18 stl_104" style="word-spacing:0.0921em;">为终止排 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.5968em; left:7.9808em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">名。</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0822em;">ZRANGE </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0822em;">的实现也不难，类二分搜索即可。</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0822em;">TODO &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4193em; left:6.92em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 46.2418em; left:6.92em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 44.4193em; left:7.3351em;"><span class="stl_10 stl_11 stl_1524" style="word-spacing:0.2686em;">. ZREVRANGE</span><span class="stl_17 stl_18 stl_1524" style="word-spacing:0.2686em;">：按分数从高到低返回给定排名区间的元素，用法和上面的一样。 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.2418em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. ZRANK</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.2497em;">：返回某个元素的排名，用法如下： &nbsp;</span></div>
					<div class="stl_01" style="top: 47.2385em; left:7.9808em;"><span class="stl_10 stl_11 stl_426" style="word-spacing:0.085em;">ZRANK key member </span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.085em;">原理类似，类二分搜索 </span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.085em;">TODO &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">09 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">210 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.2942em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 19.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">积分排行榜 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4507em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 5.4507em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">9.3 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">实现 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.9157em; left:7.5658em;"><span class="stl_17 stl_18 stl_1513">拿论坛距离，需要在论坛首页展示最热的几个帖子，这些热帖会经常更新的。当某 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.6901em; left:5.9058em;z-index:97; "><span class="stl_17 stl_18 stl_07">个帖子被访问时</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_1525">，对</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.271em;">&nbsp;</span><span class="stl_17 stl_18 stl_07">于帖子的访问次数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_1525">，除</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.271em;">&nbsp;</span><span class="stl_17 stl_18 stl_07">了写数据库之外</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_1525">，还</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.271em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0139em;">要写 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0139em;">redis</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.2504em;">&nbsp;</span><span class="stl_17 stl_18 stl_1526">，即</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.27em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0133em;">更新 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:-0.0133em;">score</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0133em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6826em; left:7.5658em;"><span class="stl_17 stl_18 stl_820" style="word-spacing:0.0825em;">用 </span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.0825em;">python </span><span class="stl_17 stl_18 stl_820" style="word-spacing:0.0825em;">写一个 </span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.0825em;">leaderboard</span><span class="stl_17 stl_18 stl_820" style="word-spacing:0.0825em;">： &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6785em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">»</span></div>
					<div class="stl_01" style="top: 11.6785em; left:8.0275em;"><span class="stl_10 stl_11 stl_07">»»»»»»»» &nbsp;</span></div>
					<div class="stl_01" style="top: 14.0016em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">1</span></div>
					<div class="stl_01" style="top: 14.0016em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">9.4 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">性能 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.2443em; left:7.5658em;"><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0834em;">访问论坛首页的时候，就可以直接从 </span><span class="stl_10 stl_11 stl_28" style="word-spacing:0.0834em;">redis </span><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0834em;">直接获取最热的帖子，返回某个帖子 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.241em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">的排名复杂度为 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">O(logN * m)</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">，其中 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">N </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">为跳表的长度，</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">m </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">为匹配长度。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.933em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 20 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.2766em; left:5.9058em;"><span class="stl_37 stl_18 stl_07">分布式锁 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.4426em; left:7.5658em;"><span class="stl_17 stl_18 stl_1527" style="word-spacing:0.0838em;">在 </span><span class="stl_10 stl_11 stl_1527" style="word-spacing:0.0838em;">*nix </span><span class="stl_17 stl_18 stl_1527" style="word-spacing:0.0838em;">系统编程中，遇到多个进程或者线程共享一块资源的时候，通常会使用 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6615em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">系统自身提供的锁，譬如一个进程里的多线程，会用互斥锁；多个进程之间，会用信 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.6573em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">号量等。这个场景中所谓的共享资源仅仅限于本地，倘若共享资源存在于网络上，本 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.654em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">地的“锁”就不起作用了。互斥访问某个网络上的资源，需要有一个存在于网络上的 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.4276em; left:5.9058em;"><span class="stl_17 stl_18 stl_1453" style="word-spacing:0.0863em;">锁服务器，负责锁的申请与回收。</span><span class="stl_10 stl_11 stl_1453" style="word-spacing:0.0863em;">redis </span><span class="stl_17 stl_18 stl_1453" style="word-spacing:0.0863em;">可以充当锁服务器的角色。首先，</span><span class="stl_10 stl_11 stl_1453" style="word-spacing:0.0863em;">redis </span><span class="stl_17 stl_18 stl_1453" style="word-spacing:0.0863em;">是单 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6465em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">进程单线程的工作模式，所有前来申请锁资源的请求都被排队处理，能保证锁资源的 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.6423em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">同步访问。 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4227em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">可以借助 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">管理锁资源，来实现网络资源的互斥。 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4243em; left:7.5658em;"><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0834em;">我们可以在 </span><span class="stl_10 stl_11 stl_28" style="word-spacing:0.0834em;">redis </span><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0834em;">服务器设置一个键值对，用以表示一把互斥锁，当申请锁的时 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.421em; left:5.9058em;"><span class="stl_17 stl_18 stl_1509">候，要求申请方设置（</span><span class="stl_10 stl_11 stl_1509">SET</span><span class="stl_17 stl_18 stl_1509">）这个键值对，当释放锁的时候，要求释放方删除（</span><span class="stl_10 stl_11 stl_1509">DEL</span><span class="stl_17 stl_18 stl_1509">） &nbsp;</span></div>
					<div class="stl_01" style="top: 32.639em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">这个键值对。譬如申请锁的过程，可以用下面的伪代码表示： &nbsp;</span></div>
					<div class="stl_01" style="top: 35.9227em; left:6.0133em;"><span class="stl_10 stl_11 stl_752" style="word-spacing:0.2032em;">lock =</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.0525em;">&nbsp;r e</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.2818em;">&nbsp;d</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.2818em;">&nbsp;i</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.2817em;">&nbsp;s</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.1207em;">&nbsp;.</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.1608em;">&nbsp;get</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.2157em;">&nbsp;(</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.2678em;">&nbsp;”mutex_lock”</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.2688em;">&nbsp;)</span><span class="stl_10 stl_11 stl_752" style="word-spacing:-0.2688em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.9143em; left:6.0525em;"><span class="stl_15 stl_16 stl_892" style="word-spacing:-0.2597em;">i f </span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.2597em;">( ! lock ) &nbsp;</span></div>
					<div class="stl_01" style="top: 37.9152em; left:8.02em;"><span class="stl_10 stl_11 stl_974" style="word-spacing:-0.3049em;">error ( ” apply␣ the ␣ lock ␣ error . ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.9068em; left:6.0008em;"><span class="stl_15 stl_16 stl_443">else &nbsp;</span></div>
					<div class="stl_01" style="top: 40.2007em; left:7.78em;z-index:448; "><span class="stl_107 stl_108 stl_07">−</span></div>
					<div class="stl_01" style="top: 40.1298em; left:8.3079em;z-index:449; "><span class="stl_107 stl_108 stl_07">−</span><span class="stl_107 stl_108 stl_07" style="word-spacing:0.3798em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3798em;">确</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;定</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;可</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;以</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;申</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;请</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;锁 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.9043em; left:8.0275em;"><span class="stl_10 stl_11 stl_1528" style="word-spacing:-0.2494em;">r e d i s . set ( ”mutex_lock” , ” locking ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.901em; left:7.9583em;"><span class="stl_10 stl_11 stl_122" style="word-spacing:-0.1483em;">do_something () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:7.5658em;"><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0834em;">这种申请锁的方法，涉及到客户端和 </span><span class="stl_10 stl_11 stl_28" style="word-spacing:0.0834em;">redis </span><span class="stl_17 stl_18 stl_28" style="word-spacing:0.0834em;">服务器的多次交互，当客户端确定可 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.6423em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">以加锁的时候，可能这时候锁已经被其他客户端申请了，最终导致两个客户端同时持 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0834em;">有锁，互斥的语意非常容易被打破。在 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0834em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0834em;">官方文档描述了一些方法并且参看了网 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">上的文章，好些方法都提及了这个问题。我们会发现，这些方法的共同特点就是申请 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.6307em; left:5.9058em;"><span class="stl_17 stl_18 stl_43">锁资源的整个过程分散在客户端和服务端，如此很容易出现数据一致性的问题。因此， &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">11 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">212 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 20.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">分布式锁 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:5.9058em;z-index:45; "><span class="stl_17 stl_18 stl_1529" style="word-spacing:0.0537em;">最好的办法是将“申请</span><span class="stl_10 stl_11 stl_1529" style="word-spacing:0.0537em;">/</span><span class="stl_17 stl_18 stl_1529" style="word-spacing:0.0537em;">释放锁”的逻辑操作都放在服务器上，</span><span class="stl_10 stl_11 stl_1529" style="word-spacing:0.0537em;">redis lua </span><span class="stl_17 stl_18 stl_1529" style="word-spacing:0.0537em;">脚本可以胜任。 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">下面给出申请互斥锁的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">脚本： &nbsp;</span></div>
					<div class="stl_01" style="top: 11.3249em; left:5.7875em;z-index:77; "><span class="stl_107 stl_108 stl_07">−</span></div>
					<div class="stl_01" style="top: 11.0277em; left:6.3154em;z-index:78; "><span class="stl_107 stl_108 stl_1123">−</span><span class="stl_107 stl_108 stl_1123" style="word-spacing:0.1596em;">&nbsp;</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:0.1596em;">apply</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:0.3302em;">&nbsp;</span><span class="stl_15 stl_16 stl_1123" style="word-spacing:0.3302em;">for</span><span class="stl_15 stl_16 stl_1123" style="word-spacing:0.3629em;">&nbsp;</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:0.3629em;">lock &nbsp;</span></div>
					<div class="stl_01" style="top: 12.0293em; left:6.0442em;z-index:92; "><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0987em;">l o</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0977em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0987em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0977em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:0.5773em;">&nbsp;key</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:0.3213em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:0.1733em;">&nbsp;KEYS[</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0787em;">&nbsp;1</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0787em;">&nbsp;] &nbsp;</span></div>
					<div class="stl_01" style="top: 13.0251em; left:6.0442em;"><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.307em;">l o</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.306em;">&nbsp;c</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.307em;">&nbsp;a</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.306em;">&nbsp;l</span><span class="stl_10 stl_11 stl_999" style="word-spacing:0.436em;">&nbsp;res</span><span class="stl_10 stl_11 stl_999" style="word-spacing:0.1875em;">&nbsp;= r</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.317em;">&nbsp;e</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.317em;">&nbsp;d</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.317em;">&nbsp;i</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.317em;">&nbsp;s</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.156em;">&nbsp;.</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.132em;">&nbsp;c</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.293em;">&nbsp;a</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.293em;">&nbsp;l</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.293em;">&nbsp;l</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.188em;">&nbsp;(</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.153em;">&nbsp;’</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.249em;">&nbsp;get</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.142em;">&nbsp;’</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.151em;">&nbsp;,</span><span class="stl_10 stl_11 stl_999" style="word-spacing:0.31em;">&nbsp;key</span><span class="stl_10 stl_11 stl_999" style="word-spacing:0.31em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 15.2398em; left:5.7875em;z-index:138; "><span class="stl_107 stl_108 stl_65">−−</span><span class="stl_107 stl_108 stl_65" style="word-spacing:0.387em;">&nbsp;</span><span class="stl_17 stl_18 stl_65" style="word-spacing:0.387em;">锁</span><span class="stl_17 stl_18 stl_65" style="word-spacing:-0.0438em;">&nbsp;被</span><span class="stl_17 stl_18 stl_65" style="word-spacing:-0.0428em;">&nbsp;占</span><span class="stl_17 stl_18 stl_65" style="word-spacing:-0.0098em;">&nbsp;用，</span><span class="stl_17 stl_18 stl_65" style="word-spacing:-0.0098em;">&nbsp;申</span><span class="stl_17 stl_18 stl_65" style="word-spacing:-0.0428em;">&nbsp;请</span><span class="stl_17 stl_18 stl_65" style="word-spacing:-0.0428em;">&nbsp;失</span><span class="stl_17 stl_18 stl_65" style="word-spacing:-0.0428em;">&nbsp;败 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.0093em; left:6.0525em;z-index:149; "><span class="stl_15 stl_16 stl_299" style="word-spacing:-0.2207em;">i f</span><span class="stl_15 stl_16 stl_299" style="word-spacing:0.5229em;">&nbsp;</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.5229em;">res</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2273em;">&nbsp;==</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2983em;">&nbsp;’</span><span class="stl_10 stl_11 stl_299" style="word-spacing:-0.2397em;">&nbsp;0</span><span class="stl_10 stl_11 stl_299" style="word-spacing:-0.1317em;">&nbsp;’</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.4013em;">&nbsp;then &nbsp;</span></div>
					<div class="stl_01" style="top: 17.0052em; left:7.9458em;"><span class="stl_15 stl_16 stl_1397" style="word-spacing:0.2792em;">return </span><span class="stl_107 stl_108 stl_1397" style="word-spacing:0.2792em;">−</span><span class="stl_10 stl_11 stl_1397" style="word-spacing:0.2792em;">1 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.2248em; left:5.7875em;z-index:179; "><span class="stl_107 stl_108 stl_1526">−</span><sub><span class="stl_15 stl_16 stl_1526">e</span></sub><span class="stl_107 stl_108 stl_07" style="word-spacing:0.1219em;">&nbsp;</span><span class="stl_107 stl_108 stl_1530">−</span><sub><span class="stl_15 stl_16 stl_1530">l</span></sub><sub><span class="stl_15 stl_16 stl_07" style="word-spacing:0.3798em;">&nbsp;</span></sub><sub><span class="stl_15 stl_16 stl_1531" style="word-spacing:0.2202em;">s</span></sub><sub><span class="stl_15 stl_16 stl_1531" style="word-spacing:0.2202em;">e</span></sub><span class="stl_17 stl_18 stl_1531" style="word-spacing:0.2202em;">锁 可 以 被 申 请 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.9952em; left:8.0367em;"><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2884em;">l o</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2874em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2884em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2874em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:0.4756em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2914em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2914em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2904em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2914em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2914em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:0.2166em;">&nbsp;= r</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2984em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2984em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2984em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2984em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1374em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1134em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2744em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2744em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2744em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1694em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1344em;">&nbsp;’</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2034em;">&nbsp;set</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.0974em;">&nbsp;’</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1324em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:0.3136em;">&nbsp;key</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1734em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:0.4096em;">&nbsp;0) &nbsp;</span></div>
					<div class="stl_01" style="top: 21.9868em; left:8.045em;"><span class="stl_15 stl_16 stl_1532" style="word-spacing:-0.119em;">i f</span><span class="stl_15 stl_16 stl_1532" style="word-spacing:0.6456em;">&nbsp;</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:0.6456em;">s</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.133em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.131em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.132em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.132em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.131em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:0.029em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.05em;">&nbsp;’ ok</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.023em;">&nbsp;’</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.027em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:0.347em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:0.4em;">&nbsp;’OK’</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:0.503em;">&nbsp;then &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9827em; left:9.9383em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:0.3435em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3435em;">0 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.9843em; left:7.9483em;"><span class="stl_10 stl_11 stl_851">end &nbsp;</span></div>
					<div class="stl_01" style="top: 24.981em; left:5.9558em;"><span class="stl_10 stl_11 stl_851">end &nbsp;</span></div>
					<div class="stl_01" style="top: 25.9718em; left:5.9533em;"><span class="stl_15 stl_16 stl_1397" style="word-spacing:0.2792em;">return </span><span class="stl_107 stl_108 stl_1397" style="word-spacing:0.2792em;">−</span><span class="stl_10 stl_11 stl_1397" style="word-spacing:0.2792em;">1 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.3051em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0831em;">get </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">命令不成功返回 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0831em;">(nil) &nbsp;</span></div>
					<div class="stl_01" style="top: 29.2976em; left:7.5658em;"><span class="stl_17 stl_18 stl_1451" style="word-spacing:0.084em;">实验命令：保存 </span><span class="stl_10 stl_11 stl_1451" style="word-spacing:0.084em;">lua </span><span class="stl_17 stl_18 stl_1451" style="word-spacing:0.084em;">脚本 </span><span class="stl_10 stl_11 stl_1451" style="word-spacing:0.084em;">redis-cli script load ”$(cat mutex_lock.lua)” &nbsp;</span></div>
					<div class="stl_01" style="top: 30.2943em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">同样，释放锁的操作也可以在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">脚本中实现。 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.9074em; left:5.7875em;z-index:352; "><span class="stl_107 stl_108 stl_07">−</span></div>
					<div class="stl_01" style="top: 33.6151em; left:6.3154em;z-index:353; "><span class="stl_107 stl_108 stl_892">−</span><span class="stl_107 stl_108 stl_892" style="word-spacing:-0.177em;">&nbsp;</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.177em;">r e</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.354em;">&nbsp;l</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.353em;">&nbsp;e</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.353em;">&nbsp;a</span><span class="stl_10 stl_11 stl_892" style="word-spacing:-0.353em;">&nbsp;e</span><span class="stl_10 stl_11 stl_892" style="word-spacing:0.377em;">&nbsp;lock &nbsp;</span></div>
					<div class="stl_01" style="top: 34.6118em; left:6.0442em;z-index:365; "><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0987em;">l o</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0977em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0987em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0977em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:0.5773em;">&nbsp;key</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:0.3213em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:0.1733em;">&nbsp;KEYS[</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0787em;">&nbsp;1</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0787em;">&nbsp;] &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6076em; left:6.0442em;"><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.288em;">l o</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.287em;">&nbsp;c</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.288em;">&nbsp;a</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.287em;">&nbsp;l</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.476em;">&nbsp;s</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.291em;">&nbsp;e</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.291em;">&nbsp;t</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.29em;">&nbsp;r</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.291em;">&nbsp;e</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.291em;">&nbsp;s</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.217em;">&nbsp;= r</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.298em;">&nbsp;e</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.298em;">&nbsp;d</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.298em;">&nbsp;i</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.298em;">&nbsp;s</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.137em;">&nbsp;.</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.113em;">&nbsp;c</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.274em;">&nbsp;a</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.274em;">&nbsp;l</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.274em;">&nbsp;l</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.169em;">&nbsp;(</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.134em;">&nbsp;’</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.203em;">&nbsp;set</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.096em;">&nbsp;’</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.132em;">&nbsp;,</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.314em;">&nbsp;key</span><span class="stl_10 stl_11 stl_433" style="word-spacing:-0.173em;">&nbsp;,</span><span class="stl_10 stl_11 stl_433" style="word-spacing:0.41em;">&nbsp;1) &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5993em; left:6.0525em;"><span class="stl_15 stl_16 stl_1532" style="word-spacing:-0.119em;">i f</span><span class="stl_15 stl_16 stl_1532" style="word-spacing:0.6456em;">&nbsp;</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:0.6456em;">s</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.133em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.131em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.132em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.132em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.131em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:0.029em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.05em;">&nbsp;’ ok</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.023em;">&nbsp;’</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:-0.027em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:0.347em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:0.4em;">&nbsp;’OK’</span><span class="stl_10 stl_11 stl_1532" style="word-spacing:0.503em;">&nbsp;then &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5952em; left:7.9458em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:0.3435em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3435em;">0 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5918em; left:5.9533em;z-index:452; "><span class="stl_15 stl_16 stl_1397" style="word-spacing:0.2792em;">return </span><span class="stl_107 stl_108 stl_1397" style="word-spacing:0.2792em;">−</span><span class="stl_10 stl_11 stl_1397" style="word-spacing:0.2792em;">1 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.9251em; left:7.5658em;"><span class="stl_17 stl_18 stl_1445" style="word-spacing:0.0824em;">如上 </span><span class="stl_10 stl_11 stl_1445" style="word-spacing:0.0824em;">lua </span><span class="stl_17 stl_18 stl_1445" style="word-spacing:0.0824em;">脚本基本的锁管理的问题，将锁的管理逻辑放在服务器端，可见 </span><span class="stl_10 stl_11 stl_1445" style="word-spacing:0.0824em;">lua </span><span class="stl_17 stl_18 stl_1445" style="word-spacing:0.0824em;">能 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.9218em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">拓展 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">服务器的功能。但上面的锁管理方案是有问题的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.1732em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 43.1732em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">0.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">死锁的问题 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.6382em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">首先是客户端崩溃导致的死锁。按照上面的方法，当某个客户端申请锁后因崩溃 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">等原因无法释放锁，那么其他客户端无法申请锁，会导致死锁。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">20.1. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">死锁的问题 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">213 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.9415em; left:7.5658em;"><span class="stl_17 stl_18 stl_1130">一般，申请锁是为了让多个访问方对某块数据作互斥访问（修改），而我们应该 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.9373em; left:5.9058em;"><span class="stl_17 stl_18 stl_1079">将访问的时间控制在足够短，如果持有锁的时间过长，系统整体的性能肯定是下降 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.934em; left:5.9058em;"><span class="stl_17 stl_18 stl_54">的。可以给定一个足够长的超时时间，当访问方超时后尚未释放锁，可以自动把锁释放。 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.5658em;"><span class="stl_10 stl_11 stl_818" style="word-spacing:0.0847em;">redis </span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.0847em;">提供了 </span><span class="stl_10 stl_11 stl_818" style="word-spacing:0.0847em;">TTL </span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.0847em;">功能，键值对在超时后会自动被剔除，在 </span><span class="stl_10 stl_11 stl_818" style="word-spacing:0.0847em;">redis </span><span class="stl_17 stl_18 stl_818" style="word-spacing:0.0847em;">的数据集中有 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">一个哈希表专门用作键值对的超时。所以，我们有下面的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">lua </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">代码： &nbsp;</span></div>
					<div class="stl_01" style="top: 14.4799em; left:5.7875em;z-index:195; "><span class="stl_107 stl_108 stl_07">−</span></div>
					<div class="stl_01" style="top: 14.1827em; left:6.3154em;z-index:196; "><span class="stl_107 stl_108 stl_1123">−</span><span class="stl_107 stl_108 stl_1123" style="word-spacing:0.1596em;">&nbsp;</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:0.1596em;">apply</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:0.3302em;">&nbsp;</span><span class="stl_15 stl_16 stl_1123" style="word-spacing:0.3302em;">for</span><span class="stl_15 stl_16 stl_1123" style="word-spacing:0.3629em;">&nbsp;</span><span class="stl_10 stl_11 stl_1123" style="word-spacing:0.3629em;">lock &nbsp;</span></div>
					<div class="stl_01" style="top: 15.1835em; left:6.0442em;z-index:210; "><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0987em;">l o</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0977em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0987em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0977em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:0.5773em;">&nbsp;key</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:0.3213em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:0.1733em;">&nbsp;KEYS[</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0787em;">&nbsp;1</span><span class="stl_10 stl_11 stl_1029" style="word-spacing:-0.0787em;">&nbsp;] &nbsp;</span></div>
					<div class="stl_01" style="top: 16.1801em; left:6.0442em;"><span class="stl_10 stl_11 stl_1533" style="word-spacing:-0.1844em;">l o</span><span class="stl_10 stl_11 stl_1533" style="word-spacing:-0.1834em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1533" style="word-spacing:-0.1844em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1533" style="word-spacing:-0.1834em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1533" style="word-spacing:0.5176em;">&nbsp;timeout</span><span class="stl_10 stl_11 stl_1533" style="word-spacing:0.2626em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1533" style="word-spacing:-0.0768em;">&nbsp;KEYS[ 2</span><span class="stl_10 stl_11 stl_1533" style="word-spacing:-0.0768em;">&nbsp;] &nbsp;</span></div>
					<div class="stl_01" style="top: 17.176em; left:6.0442em;"><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.307em;">l o</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.306em;">&nbsp;c</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.307em;">&nbsp;a</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.306em;">&nbsp;l</span><span class="stl_10 stl_11 stl_999" style="word-spacing:0.436em;">&nbsp;res</span><span class="stl_10 stl_11 stl_999" style="word-spacing:0.1875em;">&nbsp;= r</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.317em;">&nbsp;e</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.317em;">&nbsp;d</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.317em;">&nbsp;i</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.317em;">&nbsp;s</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.156em;">&nbsp;.</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.132em;">&nbsp;c</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.293em;">&nbsp;a</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.293em;">&nbsp;l</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.293em;">&nbsp;l</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.188em;">&nbsp;(</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.153em;">&nbsp;’</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.249em;">&nbsp;get</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.142em;">&nbsp;’</span><span class="stl_10 stl_11 stl_999" style="word-spacing:-0.151em;">&nbsp;,</span><span class="stl_10 stl_11 stl_999" style="word-spacing:0.31em;">&nbsp;key</span><span class="stl_10 stl_11 stl_999" style="word-spacing:0.31em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 19.4607em; left:5.7875em;z-index:275; "><span class="stl_107 stl_108 stl_07">−</span></div>
					<div class="stl_01" style="top: 19.3907em; left:6.3154em;z-index:276; "><span class="stl_107 stl_108 stl_215">−</span><span class="stl_107 stl_108 stl_215" style="word-spacing:-0.2072em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.2072em;">锁 被</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;占</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;用，</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;申</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;请</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;失</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;败 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.1602em; left:6.0525em;z-index:287; "><span class="stl_15 stl_16 stl_299" style="word-spacing:-0.2207em;">i f</span><span class="stl_15 stl_16 stl_299" style="word-spacing:0.5229em;">&nbsp;</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.5229em;">res</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2273em;">&nbsp;==</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.2983em;">&nbsp;’</span><span class="stl_10 stl_11 stl_299" style="word-spacing:-0.2397em;">&nbsp;0</span><span class="stl_10 stl_11 stl_299" style="word-spacing:-0.1317em;">&nbsp;’</span><span class="stl_10 stl_11 stl_299" style="word-spacing:0.4013em;">&nbsp;then &nbsp;</span></div>
					<div class="stl_01" style="top: 21.156em; left:7.9458em;z-index:306; "><span class="stl_15 stl_16 stl_1397" style="word-spacing:0.2792em;">return </span><span class="stl_107 stl_108 stl_1397" style="word-spacing:0.2792em;">−</span><span class="stl_10 stl_11 stl_1397" style="word-spacing:0.2792em;">1 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.4499em; left:5.7875em;z-index:308; "><span class="stl_107 stl_108 stl_07">−</span></div>
					<div class="stl_01" style="top: 22.3798em; left:6.3154em;z-index:314; "><span class="stl_107 stl_108 stl_07">−</span><span class="stl_107 stl_108 stl_07" style="word-spacing:0.3798em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.3798em;">锁</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;可</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;以</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;被</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;申</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;请 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.1485em; left:6.0008em;"><span class="stl_15 stl_16 stl_443">else &nbsp;</span></div>
					<div class="stl_01" style="top: 24.1501em; left:8.0367em;"><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2884em;">l o</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2874em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2884em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2874em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:0.4756em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2914em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2914em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2904em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2914em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2914em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:0.2166em;">&nbsp;= r</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2984em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2984em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2984em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2984em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1374em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1134em;">&nbsp;c</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2744em;">&nbsp;a</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2744em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2744em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1694em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1344em;">&nbsp;’</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.2034em;">&nbsp;set</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.0974em;">&nbsp;’</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1324em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:0.3136em;">&nbsp;key</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:-0.1734em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1474" style="word-spacing:0.4096em;">&nbsp;0) &nbsp;</span></div>
					<div class="stl_01" style="top: 25.146em; left:8.0367em;"><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.284em;">l o</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.283em;">&nbsp;c</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.284em;">&nbsp;a</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.283em;">&nbsp;l</span><span class="stl_10 stl_11 stl_726" style="word-spacing:0.403em;">&nbsp;exp_res</span><span class="stl_10 stl_11 stl_726" style="word-spacing:0.148em;">&nbsp;=</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.077em;">&nbsp;r e</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.294em;">&nbsp;d</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.294em;">&nbsp;i</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.294em;">&nbsp;s</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.133em;">&nbsp;.</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.109em;">&nbsp;c</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.27em;">&nbsp;a</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.27em;">&nbsp;l</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.27em;">&nbsp;l</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.165em;">&nbsp;(</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.13em;">&nbsp;’</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.217em;">&nbsp;pexpire</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.111em;">&nbsp;’</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.128em;">&nbsp;,</span><span class="stl_10 stl_11 stl_726" style="word-spacing:0.318em;">&nbsp;key</span><span class="stl_10 stl_11 stl_726" style="word-spacing:-0.169em;">&nbsp;,</span><span class="stl_10 stl_11 stl_726" style="word-spacing:0.412em;">&nbsp;timeout</span><span class="stl_10 stl_11 stl_726" style="word-spacing:0.412em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 26.1377em; left:8.045em;"><span class="stl_15 stl_16 stl_1534" style="word-spacing:-0.2088em;">i f</span><span class="stl_15 stl_16 stl_1534" style="word-spacing:0.4785em;">&nbsp;</span><span class="stl_10 stl_11 stl_1534" style="word-spacing:0.4785em;">exp_res</span><span class="stl_10 stl_11 stl_1534" style="word-spacing:0.1832em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1534" style="word-spacing:0.1452em;">&nbsp;1</span><span class="stl_10 stl_11 stl_1534" style="word-spacing:0.3562em;">&nbsp;then &nbsp;</span></div>
					<div class="stl_01" style="top: 27.1335em; left:9.9383em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:0.3435em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:0.3435em;">0 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.1352em; left:7.9483em;"><span class="stl_10 stl_11 stl_851">end &nbsp;</span></div>
					<div class="stl_01" style="top: 29.1318em; left:5.9558em;"><span class="stl_10 stl_11 stl_851">end &nbsp;</span></div>
					<div class="stl_01" style="top: 30.1227em; left:5.9533em;"><span class="stl_15 stl_16 stl_1397" style="word-spacing:0.2792em;">return </span><span class="stl_107 stl_108 stl_1397" style="word-spacing:0.2792em;">−</span><span class="stl_10 stl_11 stl_1397" style="word-spacing:0.2792em;">1 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.844em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">如此能够解决锁持有者崩溃而锁资源无法释放带来的死锁问题。 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6143em; left:7.5658em;"><span class="stl_17 stl_18 stl_984" style="word-spacing:0.0886em;">再者是 </span><span class="stl_10 stl_11 stl_984" style="word-spacing:0.0886em;">redis </span><span class="stl_17 stl_18 stl_984" style="word-spacing:0.0886em;">服务器崩溃导致的死锁。当管理锁资源的 </span><span class="stl_10 stl_11 stl_984" style="word-spacing:0.0886em;">redis </span><span class="stl_17 stl_18 stl_984" style="word-spacing:0.0886em;">服务器宕机了，客 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.611em; left:5.9058em;"><span class="stl_17 stl_18 stl_483" style="word-spacing:0.084em;">户端既无法申请也无法释放锁，死锁形成了。一种解决的方法是设置一个备份 </span><span class="stl_10 stl_11 stl_483" style="word-spacing:0.084em;">redis &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:5.9058em;"><span class="stl_17 stl_18 stl_1451" style="word-spacing:0.0825em;">服务器，当 </span><span class="stl_10 stl_11 stl_1451" style="word-spacing:0.0825em;">redis </span><span class="stl_17 stl_18 stl_1451" style="word-spacing:0.0825em;">主机宕机后，可以使用备份机，但这需要保证主备的数据是同步的， &nbsp;</span></div>
					<div class="stl_01" style="top: 36.8257em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">不允许有延迟。 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.8182em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">在同步有延迟的情况下，依旧会出现两个客户端同时持有锁的问题。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">214 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:27.125em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.082em;">CHAPTER 20.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">分布式锁 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 15.4305em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 21 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.2716em; left:5.9058em;"><span class="stl_37 stl_18 stl_07">消息中间件 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.9351em; left:7.5658em;"><span class="stl_17 stl_18 stl_1502" style="word-spacing:0.0775em;">接触 </span><span class="stl_10 stl_11 stl_1502" style="word-spacing:0.0775em;">linux </span><span class="stl_17 stl_18 stl_1502" style="word-spacing:0.0775em;">系统编程的时候，曾经学到消息队列是 </span><span class="stl_10 stl_11 stl_1502" style="word-spacing:0.0775em;">IPC </span><span class="stl_17 stl_18 stl_1502" style="word-spacing:0.0775em;">的一种方式，这种通讯方 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.154em; left:5.9058em;"><span class="stl_17 stl_18 stl_43">式通常只用于本地的进程，基于共享内存的《无锁消息队列》即是一个很好的中间件， &nbsp;</span></div>
					<div class="stl_01" style="top: 36.1498em; left:5.9058em;"><span class="stl_17 stl_18 stl_40">详见这里。但这篇提到的消息队列，也被称为消息中间件，通常在分布式系统中用到。 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.6498em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">提及消息中间件的时候，还会涉及生产者和消费者两个概念。消息中间件是负责 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4235em; left:5.9058em;"><span class="stl_17 stl_18 stl_1031" style="word-spacing:0.0832em;">接收来自生产者的消息，并存储并转发给对应的消费者，生产者可以按 </span><span class="stl_10 stl_11 stl_1031" style="word-spacing:0.0832em;">topic </span><span class="stl_17 stl_18 stl_1031" style="word-spacing:0.0832em;">发布各 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:5.9058em;"><span class="stl_17 stl_18 stl_1535" style="word-spacing:0.0866em;">样消息，消费者也可以按 </span><span class="stl_10 stl_11 stl_1535" style="word-spacing:0.0866em;">topic </span><span class="stl_17 stl_18 stl_1535" style="word-spacing:0.0866em;">订阅各样消息。生产者只管往消息队列里推送消息， &nbsp;</span></div>
					<div class="stl_01" style="top: 45.6382em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">不用等待消费者的回应；消费者只管从消息队列中取出数据并处理，可用可靠性等问 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">题都交由消息中间件来负责。 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">15 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_42.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_42.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">216 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.2942em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 21.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">消息中间件 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.5498em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">说白了，这种分布式的消息中间件即是网络上一个服务器，我们可以往里面扔数 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.5457em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">据，里面的数据会被消息中间件推送或者被别人拉取，消息中间件取到一个数据中转 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.5423em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">的作用。生产者和消费者通常有两种对应关系，一个生产者对应一个消费者，以及一 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.5382em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">个生产者对应多个消费者。在这篇文章中，介绍了消息中间件的三个特点：解耦，异 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.5348em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">步和并行。读者可以自行理解。一些不需要及时可靠响应的业务场景，消息中间件可 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.5307em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">以大大提高业务上层的吞吐量。 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.3718em; left:7.5658em;"><span class="stl_17 stl_18 stl_65" style="word-spacing:0.0741em;">目前消息中间件一族里边有一些优秀的作品，</span><span class="stl_10 stl_11 stl_65" style="word-spacing:0.0741em;">RabbitMQ, Jafka/Kafka</span><span class="stl_17 stl_18 stl_65" style="word-spacing:0.0741em;">。</span><span class="stl_10 stl_11 stl_65" style="word-spacing:0.0741em;">redis </span><span class="stl_17 stl_18 stl_65" style="word-spacing:0.0741em;">也 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.3677em; left:5.9058em;"><span class="stl_17 stl_18 stl_483" style="word-spacing:0.0859em;">可以作为一个入门级的消息队列。上面提到的一个生产者对应一个消费者，</span><span class="stl_10 stl_11 stl_483" style="word-spacing:0.0859em;">redis </span><span class="stl_17 stl_18 stl_483" style="word-spacing:0.0859em;">的 &nbsp;</span></div>
					<div class="stl_01" style="top: 35.3643em; left:5.9058em;"><span class="stl_10 stl_11 stl_116" style="word-spacing:0.0837em;">blist </span><span class="stl_17 stl_18 stl_116" style="word-spacing:0.0837em;">可以实现；一个生产者对应多个消费者，</span><span class="stl_10 stl_11 stl_116" style="word-spacing:0.0837em;">redis </span><span class="stl_17 stl_18 stl_116" style="word-spacing:0.0837em;">的 </span><span class="stl_10 stl_11 stl_116" style="word-spacing:0.0837em;">pub/sub </span><span class="stl_17 stl_18 stl_116" style="word-spacing:0.0837em;">模式可以实现。值得 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.3602em; left:5.9058em;"><span class="stl_17 stl_18 stl_1536" style="word-spacing:0.0878em;">注意的是，使用 </span><span class="stl_10 stl_11 stl_1536" style="word-spacing:0.0878em;">redis </span><span class="stl_17 stl_18 stl_1536" style="word-spacing:0.0878em;">作为消息中间件，假如消费者有一段时间断开了与 </span><span class="stl_10 stl_11 stl_1536" style="word-spacing:0.0878em;">redis </span><span class="stl_17 stl_18 stl_1536" style="word-spacing:0.0878em;">的连 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.3568em; left:5.9058em;"><span class="stl_17 stl_18 stl_1537" style="word-spacing:0.09em;">接，它将不会收到这段时间内 </span><span class="stl_10 stl_11 stl_1537" style="word-spacing:0.09em;">redis </span><span class="stl_17 stl_18 stl_1537" style="word-spacing:0.09em;">内的数据，这一点从 </span><span class="stl_10 stl_11 stl_1537" style="word-spacing:0.09em;">pub/sub </span><span class="stl_17 stl_18 stl_1537" style="word-spacing:0.09em;">的实现可以知道。 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.5748em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">严格意义上的消息中间件，需要保证数据的可靠性。 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.0457em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 42.0457em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">1.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">以分布式的消息队列 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.6424em; left:7.5658em;"><span class="stl_17 stl_18 stl_1513">在平时的开发当中，消息队列算是最常见的应用了。在本机的时候，可以使用系统 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.6382em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">提供的消息队列，或者基于共享内存的循环消息队列，来实现本机进程以及进程之间 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_1298">的通信。对于异机部署的多个进程，就需要用到分布式的消息队列了，来看看这个场景： &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_44">
				<object data="main.pdf_files/img_44.svg" type="image/svg+xml" class="stl_45" style="position:absolute; width:42.5em; height:54.25em;">
					<embed src="main.pdf_files/img_44.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">21.1. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">以分布式的消息队列 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">217 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.0185em; left:7.5658em;"><span class="stl_17 stl_18 stl_1538" style="word-spacing:0.0855em;">生产者，基于 </span><span class="stl_10 stl_11 stl_1538" style="word-spacing:0.0855em;">redis </span><span class="stl_17 stl_18 stl_1538" style="word-spacing:0.0855em;">的消息队列，</span><span class="stl_10 stl_11 stl_1538" style="word-spacing:0.0855em;">3 </span><span class="stl_17 stl_18 stl_1538" style="word-spacing:0.0855em;">个 </span><span class="stl_10 stl_11 stl_1538" style="word-spacing:0.0855em;">worker </span><span class="stl_17 stl_18 stl_1538" style="word-spacing:0.0855em;">组都分别部署在不同的机器上，生 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.2373em; left:5.9058em;"><span class="stl_17 stl_18 stl_245">产者会快速将产出内容（如需要存储的数据或者日志等）推送到消息队列服务器上， &nbsp;</span></div>
					<div class="stl_01" style="top: 24.011em; left:5.9058em;"><span class="stl_17 stl_18 stl_34" style="word-spacing:0.0902em;">这是 </span><span class="stl_10 stl_11 stl_34" style="word-spacing:0.0902em;">worker group </span><span class="stl_17 stl_18 stl_34" style="word-spacing:0.0902em;">就能消费了。 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.0043em; left:7.5658em;"><span class="stl_17 stl_18 stl_1418" style="word-spacing:0.0433em;">这种实现可以借助 </span><span class="stl_10 stl_11 stl_1418" style="word-spacing:0.0433em;">redis </span><span class="stl_17 stl_18 stl_1418" style="word-spacing:0.0433em;">中的 </span><span class="stl_10 stl_11 stl_1418" style="word-spacing:0.0433em;">blist </span><span class="stl_17 stl_18 stl_1418" style="word-spacing:0.0433em;">实现。在这里用 </span><span class="stl_10 stl_11 stl_1418" style="word-spacing:0.0433em;">c </span><span class="stl_17 stl_18 stl_1418" style="word-spacing:0.0433em;">实现了一个生产者和 </span><span class="stl_10 stl_11 stl_1418" style="word-spacing:0.0433em;">worker &nbsp;</span></div>
					<div class="stl_01" style="top: 27.0001em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">group </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">的示例代码： &nbsp;</span></div>
					<div class="stl_01" style="top: 29.4776em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 29.4776em; left:6.4282em;"><span class="stl_58 stl_59 stl_774" style="word-spacing:0.378em;">/ comm.</span><span class="stl_58 stl_59 stl_774" style="word-spacing:0.378em;">&nbsp;h &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4668em; left:6.4956em;z-index:191; "><span class="stl_15 stl_16 stl_1539" style="word-spacing:0.3976em;">ifndef </span><span class="stl_10 stl_11 stl_1539" style="word-spacing:0.3976em;">COMM_H__ &nbsp;</span></div>
					<div class="stl_01" style="top: 31.4635em; left:6.4748em;z-index:206; "><span class="stl_15 stl_16 stl_1281" style="word-spacing:0.3936em;">define </span><span class="stl_10 stl_11 stl_1281" style="word-spacing:0.3936em;">COMM_H__ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4668em; left:5.7567em;z-index:177; "><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 31.4635em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 33.456em; left:5.7567em;"><span class="stl_15 stl_16 stl_676">#include</span><span class="stl_15 stl_16 stl_676" style="word-spacing:0.1372em;">&nbsp;</span><span class="stl_10 stl_11 stl_676" style="word-spacing:0.1372em;">&lt;inttypes</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.118em;">&nbsp;.</span><span class="stl_10 stl_11 stl_676" style="word-spacing:-0.245em;">&nbsp;h&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4485em; left:5.9533em;"><span class="stl_15 stl_16 stl_588" style="word-spacing:0.3496em;">typedef struct </span><span class="stl_10 stl_11 stl_588" style="word-spacing:0.3496em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.4452em; left:7.4358em;"><span class="stl_15 stl_16 stl_1540">char</span><span class="stl_15 stl_16 stl_1540" style="word-spacing:0.3894em;">&nbsp;</span><span class="stl_10 stl_11 stl_1540" style="word-spacing:0.3894em;">ip</span><span class="stl_10 stl_11 stl_1540" style="word-spacing:-0.06em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1540" style="word-spacing:-0.182em;">&nbsp;3</span><span class="stl_10 stl_11 stl_1540" style="word-spacing:-0.181em;">&nbsp;2</span><span class="stl_10 stl_11 stl_1540" style="word-spacing:-0.182em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1540" style="word-spacing:-0.182em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 37.446em; left:7.4817em;"><span class="stl_10 stl_11 stl_1163" style="word-spacing:0.3564em;">uint16_t port</span><span class="stl_10 stl_11 stl_1163" style="word-spacing:0.3564em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4377em; left:7.4358em;"><span class="stl_15 stl_16 stl_306">char</span><span class="stl_15 stl_16 stl_306" style="word-spacing:0.3544em;">&nbsp;</span><span class="stl_10 stl_11 stl_306" style="word-spacing:0.3544em;">queue_name</span><span class="stl_10 stl_11 stl_306" style="word-spacing:-0.1087em;">&nbsp;[</span><span class="stl_10 stl_11 stl_306" style="word-spacing:-0.1437em;">&nbsp;2</span><span class="stl_10 stl_11 stl_306" style="word-spacing:-0.1437em;">&nbsp;5</span><span class="stl_10 stl_11 stl_306" style="word-spacing:-0.1437em;">&nbsp;6</span><span class="stl_10 stl_11 stl_306" style="word-spacing:-0.1447em;">&nbsp;]</span><span class="stl_10 stl_11 stl_306" style="word-spacing:-0.1447em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4385em; left:7.0011em;"><span class="stl_10 stl_11 stl_1437" style="word-spacing:0.3919em;">config_t ; &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4385em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 41.426em; left:5.9483em;"><span class="stl_15 stl_16 stl_770">void</span><span class="stl_15 stl_16 stl_770" style="word-spacing:0.3357em;">&nbsp;</span><span class="stl_10 stl_11 stl_770" style="word-spacing:0.3357em;">Usage</span><span class="stl_10 stl_11 stl_770" style="word-spacing:0.3357em;">&nbsp;(</span><span class="stl_15 stl_16 stl_770" style="word-spacing:-0.2115em;">char</span><span class="stl_15 stl_16 stl_770" style="word-spacing:0.3087em;">&nbsp;</span><span class="stl_10 stl_11 stl_770" style="word-spacing:0.3087em;">*program</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.2135em;">&nbsp;)</span><span class="stl_10 stl_11 stl_770" style="word-spacing:-0.2135em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4277em; left:7.99em;"><sub><span class="stl_10 stl_11 stl_1541">a</span></sub><span class="stl_10 stl_11 stl_1541">p</span><sub><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2036em;">&nbsp;</span></sub><sub><span class="stl_10 stl_11 stl_1542">b</span></sub><span class="stl_10 stl_11 stl_1542">r</span><sub><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2696em;">&nbsp;</span></sub><sub><span class="stl_10 stl_11 stl_1543">o</span></sub><span class="stl_10 stl_11 stl_1543">i</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3678em;">&nbsp;</span><span class="stl_10 stl_11 stl_1544">n</span><sub><span class="stl_10 stl_11 stl_1544">r</span></sub><sub><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2852em;">&nbsp;</span></sub><sub><span class="stl_10 stl_11 stl_1545">t</span></sub><span class="stl_10 stl_11 stl_1545">t</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2148em;">&nbsp;</span><span class="stl_10 stl_11 stl_1546">f</span><sub><span class="stl_10 stl_11 stl_1546">(</span></sub><sub><span class="stl_10 stl_11 stl_07" style="word-spacing:0.1902em;">&nbsp;</span></sub><sub><span class="stl_10 stl_11 stl_1547">)</span></sub><span class="stl_10 stl_11 stl_1547">(</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2738em;">&nbsp;</span><span class="stl_10 stl_11 stl_1548">”</span><sub><span class="stl_10 stl_11 stl_1548">;</span></sub><span class="stl_10 stl_11 stl_07" style="word-spacing:0.3544em;">&nbsp;</span><span class="stl_10 stl_11 stl_1454" style="word-spacing:-0.1495em;">Usage : ␣%s ␣</span><span class="stl_107 stl_108 stl_1454" style="word-spacing:-0.1495em;">−</span><span class="stl_10 stl_11 stl_1454" style="word-spacing:-0.1495em;">h␣ ip ␣</span><span class="stl_107 stl_108 stl_1454" style="word-spacing:-0.1495em;">−</span><span class="stl_10 stl_11 stl_1454" style="word-spacing:-0.1495em;">p␣ port ␣</span><span class="stl_107 stl_108 stl_1454" style="word-spacing:-0.1495em;">−</span><span class="stl_10 stl_11 stl_1454" style="word-spacing:-0.1495em;">l ␣ t e s t \n” , program ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.4077em; left:5.9575em;"><span class="stl_15 stl_16 stl_437">const</span><span class="stl_15 stl_16 stl_437" style="word-spacing:0.4157em;">&nbsp;</span><span class="stl_10 stl_11 stl_437" style="word-spacing:0.4157em;">size_t</span><span class="stl_10 stl_11 stl_437" style="word-spacing:0.3642em;">&nbsp;max_cmd_len</span><span class="stl_10 stl_11 stl_437" style="word-spacing:0.1462em;">&nbsp;=</span><span class="stl_10 stl_11 stl_437" style="word-spacing:0.2612em;">&nbsp;512; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:5.7567em;"><span class="stl_15 stl_16 stl_1549">#endif &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">218 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.2942em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 21.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">消息中间件 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.9415em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">生产者的代码： &nbsp;</span></div>
					<div class="stl_01" style="top: 9.5526em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.5526em; left:6.4282em;"><span class="stl_58 stl_59 stl_85" style="word-spacing:0.3045em;">/ producer</span><span class="stl_58 stl_59 stl_85" style="word-spacing:-0.2085em;">&nbsp;.</span><span class="stl_58 stl_59 stl_85" style="word-spacing:-0.2215em;">&nbsp;cc &nbsp;</span></div>
					<div class="stl_01" style="top: 10.5418em; left:6.4674em;"><span class="stl_15 stl_16 stl_804">include</span><span class="stl_15 stl_16 stl_804" style="word-spacing:0.1285em;">&nbsp;</span><span class="stl_10 stl_11 stl_804" style="word-spacing:0.1285em;">&lt;stdio</span><span class="stl_10 stl_11 stl_804" style="word-spacing:-0.1207em;">&nbsp;.</span><span class="stl_10 stl_11 stl_804" style="word-spacing:-0.2527em;">&nbsp;h&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.5385em; left:6.4674em;"><span class="stl_15 stl_16 stl_1104">include</span><span class="stl_15 stl_16 stl_1104" style="word-spacing:-0.0293em;">&nbsp;</span><span class="stl_10 stl_11 stl_1104" style="word-spacing:-0.0293em;">&lt;s t</span><span class="stl_10 stl_11 stl_1104" style="word-spacing:-0.2112em;">&nbsp;d</span><span class="stl_10 stl_11 stl_1104" style="word-spacing:-0.2112em;">&nbsp;l</span><span class="stl_10 stl_11 stl_1104" style="word-spacing:-0.2113em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1104" style="word-spacing:-0.2113em;">&nbsp;b</span><span class="stl_10 stl_11 stl_1104" style="word-spacing:-0.0502em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1104" style="word-spacing:-0.1992em;">&nbsp;h&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.5343em; left:6.4674em;"><span class="stl_15 stl_16 stl_827">include</span><span class="stl_15 stl_16 stl_827" style="word-spacing:0.1406em;">&nbsp;</span><span class="stl_10 stl_11 stl_827" style="word-spacing:0.1406em;">&lt;unistd</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.1316em;">&nbsp;.</span><span class="stl_10 stl_11 stl_827" style="word-spacing:-0.2406em;">&nbsp;h&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.531em; left:6.4674em;"><span class="stl_15 stl_16 stl_1304">include</span><span class="stl_15 stl_16 stl_1304" style="word-spacing:-0.0328em;">&nbsp;</span><span class="stl_10 stl_11 stl_1304" style="word-spacing:-0.0328em;">&lt;s t</span><span class="stl_10 stl_11 stl_1304" style="word-spacing:-0.217em;">&nbsp;r</span><span class="stl_10 stl_11 stl_1304" style="word-spacing:-0.217em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1304" style="word-spacing:-0.217em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1304" style="word-spacing:-0.217em;">&nbsp;g</span><span class="stl_10 stl_11 stl_1304" style="word-spacing:-0.057em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1304" style="word-spacing:-0.197em;">&nbsp;h&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.5418em; left:5.7567em;z-index:39; "><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 11.5385em; left:5.7567em;z-index:56; "><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 12.5343em; left:5.7567em;z-index:74; "><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 13.531em; left:5.7567em;z-index:92; "><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 15.5235em; left:5.7567em;"><span class="stl_15 stl_16 stl_489">#include</span><span class="stl_15 stl_16 stl_489" style="word-spacing:0.4202em;">&nbsp;</span><span class="stl_10 stl_11 stl_489" style="word-spacing:0.4202em;">”comm.</span><span class="stl_10 stl_11 stl_489" style="word-spacing:-0.1367em;">&nbsp;h” &nbsp;</span></div>
					<div class="stl_01" style="top: 17.516em; left:5.7567em;"><span class="stl_15 stl_16 stl_296">#include</span><span class="stl_15 stl_16 stl_296" style="word-spacing:0.3804em;">&nbsp;</span><span class="stl_10 stl_11 stl_296" style="word-spacing:0.3804em;">”</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1325em;">&nbsp;h</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1975em;">&nbsp;i</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;r</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;e</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;d</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1975em;">&nbsp;i</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;s</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1465em;">&nbsp;/</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1465em;">&nbsp;h</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1975em;">&nbsp;i</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;r</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;e</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;d</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1975em;">&nbsp;i</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;s</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.0355em;">&nbsp;.</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1765em;">&nbsp;h” &nbsp;</span></div>
					<div class="stl_01" style="top: 19.5085em; left:5.9483em;"><span class="stl_15 stl_16 stl_100">void</span><span class="stl_15 stl_16 stl_100" style="word-spacing:0.2849em;">&nbsp;</span><span class="stl_10 stl_11 stl_100" style="word-spacing:0.2849em;">test_redis_client</span><span class="stl_10 stl_11 stl_100" style="word-spacing:-0.2265em;">&nbsp;() &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5093em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 21.506em; left:9.9933em;"><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.0172em;">redisContext * rc</span><span class="stl_10 stl_11 stl_797" style="word-spacing:0.1403em;">&nbsp;= redisConnect</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.2677em;">&nbsp;(</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.3197em;">&nbsp;”</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.2687em;">&nbsp;1</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.3337em;">&nbsp;2</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.3327em;">&nbsp;7</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.3337em;">&nbsp;.</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.3327em;">&nbsp;0</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.3327em;">&nbsp;.</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.3337em;">&nbsp;0</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.3327em;">&nbsp;.</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.3337em;">&nbsp;1</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.2687em;">&nbsp;”</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.1927em;">&nbsp;,6379)</span><span class="stl_10 stl_11 stl_797" style="word-spacing:-0.1927em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.4968em; left:10.0375em;z-index:249; "><span class="stl_15 stl_16 stl_1550" style="word-spacing:-0.0759em;">i f</span><span class="stl_15 stl_16 stl_1550" style="word-spacing:0.0303em;">&nbsp;</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:0.0303em;">(NULL</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:0.1591em;">&nbsp;==</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:0.3501em;">&nbsp;rc</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:0.6841em;">&nbsp;|</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:-0.0369em;">&nbsp;|</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:0.6841em;">&nbsp;rc</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:0.5171em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:0.3271em;">&nbsp;NULL</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:0.1581em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:0.3201em;">&nbsp;rc</span><span class="stl_107 stl_108 stl_1550" style="word-spacing:0.3201em;">−</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:0.3201em;">&gt;err</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:-0.0039em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1550" style="word-spacing:-0.0039em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 23.4985em; left:14.0225em;z-index:287; "><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.1982em;">f p r i n t f ( stderr , ” error : ␣%s \n” , rc</span><span class="stl_107 stl_108 stl_137" style="word-spacing:-0.1982em;">−</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.1982em;">&gt;e r r s t r ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.4893em; left:13.9233em;"><span class="stl_15 stl_16 stl_162" style="word-spacing:-0.1453em;">return </span><span class="stl_10 stl_11 stl_162" style="word-spacing:-0.1453em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.491em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 27.4851em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 27.4851em; left:10.4132em;"><span class="stl_58 stl_59 stl_1397" style="word-spacing:0.47em;">/ s</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:-0.189em;">&nbsp;et</span><span class="stl_58 stl_59 stl_1397" style="word-spacing:0.421em;">&nbsp;name &nbsp;</span></div>
					<div class="stl_01" style="top: 28.4793em; left:9.9958em;"><span class="stl_10 stl_11 stl_479" style="word-spacing:0.3244em;">redisReply *</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.2686em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.1924em;">&nbsp;=</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.0281em;">&nbsp;( redisReply</span><span class="stl_10 stl_11 stl_479" style="word-spacing:0.3784em;">&nbsp;*)</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.2996em;">&nbsp;redisCommand</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.2976em;">&nbsp;(</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.2566em;">&nbsp;rc</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.1096em;">&nbsp;,</span><span class="stl_10 stl_11 stl_479" style="word-spacing:-0.1096em;">&nbsp;” &nbsp;</span></div>
					<div class="stl_01" style="top: 29.476em; left:11.67em;"><span class="stl_10 stl_11 stl_466" style="word-spacing:-0.2172em;">set ␣name␣dylan ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.4718em; left:8.0317em;z-index:397; "><span class="stl_10 stl_11 stl_1321" style="word-spacing:-0.1607em;">p r i n t f ( ”%s \n” , reply</span><span class="stl_107 stl_108 stl_1321" style="word-spacing:-0.1607em;">−</span><span class="stl_10 stl_11 stl_1321" style="word-spacing:-0.1607em;">&gt;s t r ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.466em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 32.466em; left:10.4132em;"><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.4248em;">/ get</span><span class="stl_58 stl_59 stl_1345" style="word-spacing:0.3758em;">&nbsp;name &nbsp;</span></div>
					<div class="stl_01" style="top: 33.461em; left:10.0017em;"><span class="stl_10 stl_11 stl_570" style="word-spacing:0.2241em;">reply =</span><span class="stl_10 stl_11 stl_570" style="word-spacing:0.1951em;">&nbsp;(</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.1879em;">&nbsp;redisReply</span><span class="stl_10 stl_11 stl_570" style="word-spacing:0.4101em;">&nbsp;*)</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.2679em;">&nbsp;redisCommand</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.2669em;">&nbsp;(</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.2239em;">&nbsp;rc</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.0779em;">&nbsp;,</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.1959em;">&nbsp;”</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.2399em;">&nbsp;get</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.2539em;">&nbsp;␣name”</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.2509em;">&nbsp;)</span><span class="stl_10 stl_11 stl_570" style="word-spacing:-0.2509em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.4577em; left:8.0317em;z-index:479; "><span class="stl_10 stl_11 stl_1321" style="word-spacing:-0.1607em;">p r i n t f ( ”%s \n” , reply</span><span class="stl_107 stl_108 stl_1321" style="word-spacing:-0.1607em;">−</span><span class="stl_10 stl_11 stl_1321" style="word-spacing:-0.1607em;">&gt;s t r ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.4535em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.441em; left:5.9875em;"><span class="stl_15 stl_16 stl_1196">int</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.3336em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.3336em;">main</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2591em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2078em;">&nbsp;</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:-0.2078em;">int</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.3807em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.3807em;">argc</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.0631em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.392em;">&nbsp;</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.392em;">char</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.282em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.282em;">*argv</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1021em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1981em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1981em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1981em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.4377em; left:8.045em;"><span class="stl_15 stl_16 stl_1217" style="word-spacing:-0.2945em;">i f</span><span class="stl_15 stl_16 stl_1217" style="word-spacing:0.4119em;">&nbsp;</span><span class="stl_10 stl_11 stl_1217" style="word-spacing:0.4119em;">(</span><span class="stl_10 stl_11 stl_1217" style="word-spacing:-0.2525em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_1217" style="word-spacing:0.1235em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_1217" style="word-spacing:0.1745em;">&nbsp;7) &nbsp;</span></div>
					<div class="stl_01" style="top: 39.4385em; left:9.9475em;"><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1837em;">Usage ( argv [ 0 ] ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.431em; left:7.9975em;"><span class="stl_10 stl_11 stl_1551" style="word-spacing:0.3545em;">config_t config</span><span class="stl_10 stl_11 stl_1551" style="word-spacing:0.3545em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4185em; left:7.9808em;"><span class="stl_15 stl_16 stl_453">for</span><span class="stl_15 stl_16 stl_453" style="word-spacing:0.4633em;">&nbsp;</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.4633em;">(</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.1384em;">&nbsp;</span><span class="stl_15 stl_16 stl_453" style="word-spacing:-0.1384em;">int</span><span class="stl_15 stl_16 stl_453" style="word-spacing:0.5175em;">&nbsp;</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.5175em;">i</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.3284em;">&nbsp;=</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.0904em;">&nbsp;EOF; &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:11.9708em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 44.4202em; left:12.5147em;"><span class="stl_10 stl_11 stl_66" style="word-spacing:0.2735em;">i =</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.2295em;">&nbsp;getopt</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1765em;">&nbsp;(</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1985em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0495em;">&nbsp;,</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.4425em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0775em;">&nbsp;,</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.4265em;">&nbsp;”h</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2155em;">&nbsp;:</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2155em;">&nbsp;p</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2155em;">&nbsp;:</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0765em;">&nbsp;l</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0765em;">&nbsp;:</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1735em;">&nbsp;”</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2285em;">&nbsp;)</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1875em;">&nbsp;)</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.3545em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0245em;">&nbsp;EOF; )</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0245em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:9.9383em;"><span class="stl_15 stl_16 stl_670">switch</span><span class="stl_15 stl_16 stl_670" style="word-spacing:0.3991em;">&nbsp;</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.3991em;">(</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.0976em;">&nbsp;i</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.0966em;">&nbsp;)</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.0966em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4077em; left:11.9408em;"><span class="stl_15 stl_16 stl_83">case</span><span class="stl_15 stl_16 stl_83" style="word-spacing:0.4014em;">&nbsp;</span><span class="stl_10 stl_11 stl_83" style="word-spacing:0.4014em;">’h</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2463em;">&nbsp;’</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2153em;">&nbsp;:</span><span class="stl_10 stl_11 stl_83" style="word-spacing:0.4307em;">&nbsp;s</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3313em;">&nbsp;n</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3303em;">&nbsp;p</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3303em;">&nbsp;r</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3313em;">&nbsp;i</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3303em;">&nbsp;n</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3313em;">&nbsp;t</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3303em;">&nbsp;f</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2253em;">&nbsp;(</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2323em;">&nbsp;config</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1773em;">&nbsp;.</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2303em;">&nbsp;ip</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1393em;">&nbsp;,</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1983em;">&nbsp;</span><span class="stl_15 stl_16 stl_83" style="word-spacing:-0.1983em;">sizeof</span><span class="stl_15 stl_16 stl_83" style="word-spacing:-0.254em;">&nbsp;</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.254em;">(</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2333em;">&nbsp;config</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1773em;">&nbsp;.</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2003em;">&nbsp;ip</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2563em;">&nbsp;)</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1633em;">&nbsp;,</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3113em;">&nbsp;”% &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:13.6292em;"><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.2338em;">s ”</span><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.1208em;">&nbsp;,</span><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.1838em;">&nbsp;optarg</span><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.1848em;">&nbsp;)</span><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.1338em;">&nbsp;;</span><span class="stl_10 stl_11 stl_470" style="word-spacing:0.3946em;">&nbsp;</span><span class="stl_15 stl_16 stl_470" style="word-spacing:0.3946em;">break</span><span class="stl_15 stl_16 stl_470" style="word-spacing:-0.2062em;">&nbsp;</span><span class="stl_10 stl_11 stl_470" style="word-spacing:0.3946em;">; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">21.1. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">以分布式的消息队列 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">219 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:11.9408em;"><span class="stl_15 stl_16 stl_95">case</span><span class="stl_15 stl_16 stl_95" style="word-spacing:0.4249em;">&nbsp;</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.4249em;">’p</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.2228em;">&nbsp;’</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.1917em;">&nbsp;:</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.4462em;">&nbsp;config</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.1537em;">&nbsp;.</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.1858em;">&nbsp;port</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.1633em;">&nbsp;=</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.0095em;">&nbsp;atoi (</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.2457em;">&nbsp;optarg</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.2457em;">&nbsp;)</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.1927em;">&nbsp;;</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.3328em;">&nbsp;</span><span class="stl_15 stl_16 stl_95" style="word-spacing:0.3328em;">break</span><span class="stl_15 stl_16 stl_95" style="word-spacing:-0.2662em;">&nbsp;</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.3328em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7102em; left:11.9408em;"><span class="stl_15 stl_16 stl_882">case</span><span class="stl_15 stl_16 stl_882" style="word-spacing:0.4672em;">&nbsp;</span><span class="stl_10 stl_11 stl_882" style="word-spacing:0.4672em;">’</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1495em;">&nbsp;l</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.0415em;">&nbsp;’</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1495em;">&nbsp;:</span><span class="stl_10 stl_11 stl_882" style="word-spacing:0.4965em;">&nbsp;s</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2655em;">&nbsp;n</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2645em;">&nbsp;p</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2645em;">&nbsp;r</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2655em;">&nbsp;i</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2645em;">&nbsp;n</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2655em;">&nbsp;t</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2645em;">&nbsp;f</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1595em;">&nbsp;(</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1665em;">&nbsp;config</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1115em;">&nbsp;.</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2235em;">&nbsp;queue_name</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1915em;">&nbsp;,</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1338em;">&nbsp;</span><span class="stl_15 stl_16 stl_882" style="word-spacing:-0.1338em;">sizeof</span><span class="stl_15 stl_16 stl_882" style="word-spacing:-0.1882em;">&nbsp;</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1338em;">( &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7068em; left:13.6642em;"><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0819em;">config .</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1909em;">&nbsp;queue_name)</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0679em;">&nbsp;,</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2169em;">&nbsp;”%s</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2219em;">&nbsp;”</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1089em;">&nbsp;,</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1719em;">&nbsp;optarg</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1729em;">&nbsp;)</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1219em;">&nbsp;;</span><span class="stl_10 stl_11 stl_629" style="word-spacing:0.4059em;">&nbsp;</span><span class="stl_15 stl_16 stl_629" style="word-spacing:0.4059em;">break</span><span class="stl_15 stl_16 stl_629" style="word-spacing:-0.1943em;">&nbsp;</span><span class="stl_10 stl_11 stl_629" style="word-spacing:0.4059em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:11.9575em;"><span class="stl_15 stl_16 stl_1393">default</span><span class="stl_15 stl_16 stl_1393" style="word-spacing:-0.1429em;">&nbsp;</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.1429em;">:</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:0.4343em;">&nbsp;Usage</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.2197em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.1937em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.1077em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.2037em;">&nbsp;0</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.2037em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.2037em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.0427em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:0.3988em;">&nbsp;</span><span class="stl_15 stl_16 stl_1393" style="word-spacing:0.3988em;">break</span><span class="stl_15 stl_16 stl_1393" style="word-spacing:-0.2011em;">&nbsp;</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:0.3988em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 10.7001em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 12.6927em; left:8.0008em;"><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.029em;">redisContext * rc</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.0215em;">&nbsp;= redisConnect (</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2505em;">&nbsp;config</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.1955em;">&nbsp;.</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2495em;">&nbsp;ip</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.1575em;">&nbsp;,</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.1955em;">&nbsp;config</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.1955em;">&nbsp;.</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2275em;">&nbsp;port</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2825em;">&nbsp;)</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2825em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:8.045em;z-index:245; "><span class="stl_15 stl_16 stl_663" style="word-spacing:-0.0761em;">i f</span><span class="stl_15 stl_16 stl_663" style="word-spacing:0.6302em;">&nbsp;</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.6302em;">(NULL</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.1579em;">&nbsp;==</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.3489em;">&nbsp;rc</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.6839em;">&nbsp;|</span><span class="stl_10 stl_11 stl_663" style="word-spacing:-0.0381em;">&nbsp;|</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.6849em;">&nbsp;rc</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.5169em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.3259em;">&nbsp;NULL</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.1589em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.3189em;">&nbsp;rc</span><span class="stl_107 stl_108 stl_663" style="word-spacing:0.3189em;">−</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.3189em;">&gt;err</span><span class="stl_10 stl_11 stl_663" style="word-spacing:-0.0031em;">&nbsp;)</span><span class="stl_10 stl_11 stl_663" style="word-spacing:-0.0031em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:14.0225em;z-index:283; "><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.1982em;">f p r i n t f ( stderr , ” error : ␣%s \n” , rc</span><span class="stl_107 stl_108 stl_137" style="word-spacing:-0.1982em;">−</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.1982em;">&gt;e r r s t r ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:13.9233em;"><span class="stl_15 stl_16 stl_975" style="word-spacing:0.3965em;">return </span><span class="stl_107 stl_108 stl_975" style="word-spacing:0.3965em;">−</span><span class="stl_10 stl_11 stl_975" style="word-spacing:0.3965em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6785em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 18.671em; left:8.0033em;"><span class="stl_10 stl_11 stl_368" style="word-spacing:0.3439em;">redisReply *</span><span class="stl_10 stl_11 stl_368" style="word-spacing:-0.2501em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_368" style="word-spacing:0.2119em;">&nbsp;=</span><span class="stl_10 stl_11 stl_368" style="word-spacing:0.0079em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:7.9342em;"><span class="stl_15 stl_16 stl_538">char</span><span class="stl_15 stl_16 stl_538" style="word-spacing:0.3556em;">&nbsp;</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.3556em;">cmd</span><span class="stl_10 stl_11 stl_538" style="word-spacing:-0.1273em;">&nbsp;[</span><span class="stl_10 stl_11 stl_538" style="word-spacing:-0.1073em;">&nbsp;max_cmd_len</span><span class="stl_10 stl_11 stl_538" style="word-spacing:-0.0533em;">&nbsp;]</span><span class="stl_10 stl_11 stl_538" style="word-spacing:-0.0533em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6585em; left:8.025em;"><span class="stl_10 stl_11 stl_1552" style="word-spacing:-0.169em;">s n p r i n t f (cmd, </span><span class="stl_15 stl_16 stl_1552" style="word-spacing:-0.169em;">sizeof </span><span class="stl_10 stl_11 stl_1552" style="word-spacing:-0.169em;">(cmd) , ”LPUSH␣%s ␣ task ” , config . &nbsp;</span></div>
					<div class="stl_01" style="top: 21.6593em; left:9.5875em;"><span class="stl_10 stl_11 stl_377" style="word-spacing:-0.0748em;">queue_name) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 22.656em; left:8.0317em;"><span class="stl_10 stl_11 stl_1118" style="word-spacing:-0.0669em;">p r i n t f ( ”cmd=%s \n” ,cmd) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6435em; left:7.98em;"><span class="stl_15 stl_16 stl_69">int</span><span class="stl_15 stl_16 stl_69" style="word-spacing:0.333em;">&nbsp;</span><span class="stl_10 stl_11 stl_69" style="word-spacing:0.333em;">count</span><span class="stl_10 stl_11 stl_69" style="word-spacing:0.1451em;">&nbsp;=</span><span class="stl_10 stl_11 stl_69" style="word-spacing:0.1761em;">&nbsp;100; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6393em; left:7.9483em;z-index:454; "><span class="stl_15 stl_16 stl_349">while</span><span class="stl_15 stl_16 stl_349" style="word-spacing:0.4066em;">&nbsp;</span><span class="stl_10 stl_11 stl_349" style="word-spacing:0.4066em;">(</span><span class="stl_10 stl_11 stl_349" style="word-spacing:-0.1749em;">&nbsp;count</span><span class="stl_107 stl_108 stl_349" style="word-spacing:-0.1749em;">−−</span><span class="stl_10 stl_11 stl_349" style="word-spacing:-0.1749em;">)</span><span class="stl_10 stl_11 stl_349" style="word-spacing:-0.1749em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:10.0017em;z-index:463; "><span class="stl_10 stl_11 stl_313" style="word-spacing:0.2235em;">reply =</span><span class="stl_10 stl_11 stl_313" style="word-spacing:0.1945em;">&nbsp;(</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.1885em;">&nbsp;redisReply</span><span class="stl_10 stl_11 stl_313" style="word-spacing:0.4095em;">&nbsp;*)</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2685em;">&nbsp;redisCommand</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2675em;">&nbsp;(</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2245em;">&nbsp;rc</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.0785em;">&nbsp;,</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2685em;">&nbsp;cmd)</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2685em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 27.6318em; left:10.0375em;z-index:512; "><span class="stl_15 stl_16 stl_405" style="word-spacing:-0.063em;">i f</span><span class="stl_15 stl_16 stl_405" style="word-spacing:0.6434em;">&nbsp;</span><span class="stl_10 stl_11 stl_405" style="word-spacing:0.6434em;">(</span><span class="stl_10 stl_11 stl_405" style="word-spacing:0em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_405" style="word-spacing:0.366em;">&nbsp;&amp;&amp; reply</span><span class="stl_107 stl_108 stl_405" style="word-spacing:0.366em;">−</span><span class="stl_10 stl_11 stl_405" style="word-spacing:0.366em;">&gt;type</span><span class="stl_10 stl_11 stl_405" style="word-spacing:0.338em;">&nbsp;==</span><span class="stl_10 stl_11 stl_405" style="word-spacing:0.172em;">&nbsp;REDIS_REPLY_INTEGER)</span><span class="stl_10 stl_11 stl_405" style="word-spacing:0.172em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6293em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 31.6218em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 29.6243em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 30.626em; left:12.0167em;"><span class="stl_10 stl_11 stl_1553" style="word-spacing:-0.1223em;">p r i n t f ( ”BLPUSH␣ error \n” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 32.6185em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 34.606em; left:9.9383em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 37.2465em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">消费者的代码： &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4368em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.426em; left:5.7567em;z-index:603; "><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 40.4368em; left:6.4282em;"><span class="stl_58 stl_59 stl_70" style="word-spacing:0.3338em;">/ consumer</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.1793em;">&nbsp;.</span><span class="stl_58 stl_59 stl_70" style="word-spacing:-0.1543em;">&nbsp;cc &nbsp;</span></div>
					<div class="stl_01" style="top: 41.426em; left:6.4674em;"><span class="stl_15 stl_16 stl_453">include</span><span class="stl_15 stl_16 stl_453" style="word-spacing:0.3974em;">&nbsp;</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.3974em;">”comm.</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.1595em;">&nbsp;h” &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4185em; left:5.7567em;"><span class="stl_15 stl_16 stl_296">#include</span><span class="stl_15 stl_16 stl_296" style="word-spacing:0.3804em;">&nbsp;</span><span class="stl_10 stl_11 stl_296" style="word-spacing:0.3804em;">”</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1325em;">&nbsp;h</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1975em;">&nbsp;i</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;r</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;e</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;d</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1975em;">&nbsp;i</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;s</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1465em;">&nbsp;/</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1465em;">&nbsp;h</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1975em;">&nbsp;i</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;r</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;e</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;d</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1975em;">&nbsp;i</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1965em;">&nbsp;s</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.0355em;">&nbsp;.</span><span class="stl_10 stl_11 stl_296" style="word-spacing:-0.1765em;">&nbsp;h” &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:5.9875em;"><span class="stl_15 stl_16 stl_520">int</span><span class="stl_15 stl_16 stl_520" style="word-spacing:0.3337em;">&nbsp;</span><span class="stl_10 stl_11 stl_520" style="word-spacing:0.3337em;">DoLogic</span><span class="stl_10 stl_11 stl_520" style="word-spacing:0.3337em;">&nbsp;(</span><span class="stl_15 stl_16 stl_520" style="word-spacing:-0.2601em;">char</span><span class="stl_15 stl_16 stl_520" style="word-spacing:0.254em;">&nbsp;</span><span class="stl_10 stl_11 stl_520" style="word-spacing:0.254em;">*data</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.1261em;">&nbsp;,</span><span class="stl_10 stl_11 stl_520" style="word-spacing:0.4359em;">&nbsp;size_t len</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.2031em;">&nbsp;)</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.2031em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4035em; left:5.9875em;"><span class="stl_15 stl_16 stl_1196">int</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.3336em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.3336em;">main</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2591em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.2078em;">&nbsp;</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:-0.2078em;">int</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.3807em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.3807em;">argc</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.0631em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.392em;">&nbsp;</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.392em;">char</span><span class="stl_15 stl_16 stl_1196" style="word-spacing:0.282em;">&nbsp;</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:0.282em;">*argv</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1021em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1981em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1981em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1196" style="word-spacing:-0.1981em;">&nbsp;{ &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">220 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.2942em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 21.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">消息中间件 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:8.045em;"><span class="stl_15 stl_16 stl_1217" style="word-spacing:-0.2945em;">i f</span><span class="stl_15 stl_16 stl_1217" style="word-spacing:0.4119em;">&nbsp;</span><span class="stl_10 stl_11 stl_1217" style="word-spacing:0.4119em;">(</span><span class="stl_10 stl_11 stl_1217" style="word-spacing:-0.2525em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_1217" style="word-spacing:0.1235em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_1217" style="word-spacing:0.1745em;">&nbsp;7) &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.9475em;"><span class="stl_10 stl_11 stl_338" style="word-spacing:-0.1837em;">Usage ( argv [ 0 ] ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:7.9975em;"><span class="stl_10 stl_11 stl_1551" style="word-spacing:0.3545em;">config_t config</span><span class="stl_10 stl_11 stl_1551" style="word-spacing:0.3545em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.6952em; left:7.9808em;"><span class="stl_15 stl_16 stl_453">for</span><span class="stl_15 stl_16 stl_453" style="word-spacing:0.4633em;">&nbsp;</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.4633em;">(</span><span class="stl_10 stl_11 stl_453" style="word-spacing:-0.1384em;">&nbsp;</span><span class="stl_15 stl_16 stl_453" style="word-spacing:-0.1384em;">int</span><span class="stl_15 stl_16 stl_453" style="word-spacing:0.5175em;">&nbsp;</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.5175em;">i</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.3284em;">&nbsp;=</span><span class="stl_10 stl_11 stl_453" style="word-spacing:0.0904em;">&nbsp;EOF; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:11.9708em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 11.6968em; left:12.5147em;"><span class="stl_10 stl_11 stl_66" style="word-spacing:0.2735em;">i =</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.2295em;">&nbsp;getopt</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1765em;">&nbsp;(</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1985em;">&nbsp;argc</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0495em;">&nbsp;,</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.4425em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0775em;">&nbsp;,</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.4265em;">&nbsp;”h</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2155em;">&nbsp;:</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2155em;">&nbsp;p</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2155em;">&nbsp;:</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0765em;">&nbsp;l</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0765em;">&nbsp;:</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1735em;">&nbsp;”</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.2285em;">&nbsp;)</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.1875em;">&nbsp;)</span><span class="stl_10 stl_11 stl_66" style="word-spacing:0.3545em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0245em;">&nbsp;EOF; )</span><span class="stl_10 stl_11 stl_66" style="word-spacing:-0.0245em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6877em; left:9.9383em;"><span class="stl_15 stl_16 stl_670">switch</span><span class="stl_15 stl_16 stl_670" style="word-spacing:0.3991em;">&nbsp;</span><span class="stl_10 stl_11 stl_670" style="word-spacing:0.3991em;">(</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.0976em;">&nbsp;i</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.0966em;">&nbsp;)</span><span class="stl_10 stl_11 stl_670" style="word-spacing:-0.0966em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:11.9408em;"><span class="stl_15 stl_16 stl_83">case</span><span class="stl_15 stl_16 stl_83" style="word-spacing:0.4014em;">&nbsp;</span><span class="stl_10 stl_11 stl_83" style="word-spacing:0.4014em;">’h</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2463em;">&nbsp;’</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2153em;">&nbsp;:</span><span class="stl_10 stl_11 stl_83" style="word-spacing:0.4307em;">&nbsp;s</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3313em;">&nbsp;n</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3303em;">&nbsp;p</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3303em;">&nbsp;r</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3313em;">&nbsp;i</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3303em;">&nbsp;n</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3313em;">&nbsp;t</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3303em;">&nbsp;f</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2253em;">&nbsp;(</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2323em;">&nbsp;config</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1773em;">&nbsp;.</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2303em;">&nbsp;ip</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1393em;">&nbsp;,</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1983em;">&nbsp;</span><span class="stl_15 stl_16 stl_83" style="word-spacing:-0.1983em;">sizeof</span><span class="stl_15 stl_16 stl_83" style="word-spacing:-0.254em;">&nbsp;</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.254em;">(</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2333em;">&nbsp;config</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1773em;">&nbsp;.</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2003em;">&nbsp;ip</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.2563em;">&nbsp;)</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.1633em;">&nbsp;,</span><span class="stl_10 stl_11 stl_83" style="word-spacing:-0.3113em;">&nbsp;”% &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:13.6292em;"><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.2338em;">s ”</span><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.1208em;">&nbsp;,</span><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.1838em;">&nbsp;optarg</span><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.1848em;">&nbsp;)</span><span class="stl_10 stl_11 stl_470" style="word-spacing:-0.1328em;">&nbsp;;</span><span class="stl_10 stl_11 stl_470" style="word-spacing:0.3936em;">&nbsp;</span><span class="stl_15 stl_16 stl_470" style="word-spacing:0.3936em;">break</span><span class="stl_15 stl_16 stl_470" style="word-spacing:-0.2062em;">&nbsp;</span><span class="stl_10 stl_11 stl_470" style="word-spacing:0.3936em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6768em; left:11.9408em;"><span class="stl_15 stl_16 stl_95">case</span><span class="stl_15 stl_16 stl_95" style="word-spacing:0.4249em;">&nbsp;</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.4249em;">’p</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.2227em;">&nbsp;’</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.1918em;">&nbsp;:</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.4462em;">&nbsp;config</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.1537em;">&nbsp;.</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.1858em;">&nbsp;port</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.1632em;">&nbsp;=</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.0095em;">&nbsp;atoi (</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.2458em;">&nbsp;optarg</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.2457em;">&nbsp;)</span><span class="stl_10 stl_11 stl_95" style="word-spacing:-0.1927em;">&nbsp;;</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.3328em;">&nbsp;</span><span class="stl_15 stl_16 stl_95" style="word-spacing:0.3328em;">break</span><span class="stl_15 stl_16 stl_95" style="word-spacing:-0.2662em;">&nbsp;</span><span class="stl_10 stl_11 stl_95" style="word-spacing:0.3328em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:11.9408em;"><span class="stl_15 stl_16 stl_882">case</span><span class="stl_15 stl_16 stl_882" style="word-spacing:0.4672em;">&nbsp;</span><span class="stl_10 stl_11 stl_882" style="word-spacing:0.4672em;">’</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1495em;">&nbsp;l</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.0415em;">&nbsp;’</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1495em;">&nbsp;:</span><span class="stl_10 stl_11 stl_882" style="word-spacing:0.4965em;">&nbsp;s</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2655em;">&nbsp;n</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2645em;">&nbsp;p</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2645em;">&nbsp;r</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2655em;">&nbsp;i</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2645em;">&nbsp;n</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2655em;">&nbsp;t</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2645em;">&nbsp;f</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1595em;">&nbsp;(</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1665em;">&nbsp;config</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1115em;">&nbsp;.</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.2235em;">&nbsp;queue_name</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1915em;">&nbsp;,</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1338em;">&nbsp;</span><span class="stl_15 stl_16 stl_882" style="word-spacing:-0.1338em;">sizeof</span><span class="stl_15 stl_16 stl_882" style="word-spacing:-0.1882em;">&nbsp;</span><span class="stl_10 stl_11 stl_882" style="word-spacing:-0.1338em;">( &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:13.6642em;"><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0819em;">config .</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1909em;">&nbsp;queue_name)</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.0679em;">&nbsp;,</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2169em;">&nbsp;”%s</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.2219em;">&nbsp;”</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1089em;">&nbsp;,</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1719em;">&nbsp;optarg</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1729em;">&nbsp;)</span><span class="stl_10 stl_11 stl_629" style="word-spacing:-0.1219em;">&nbsp;;</span><span class="stl_10 stl_11 stl_629" style="word-spacing:0.4059em;">&nbsp;</span><span class="stl_15 stl_16 stl_629" style="word-spacing:0.4059em;">break</span><span class="stl_15 stl_16 stl_629" style="word-spacing:-0.1943em;">&nbsp;</span><span class="stl_10 stl_11 stl_629" style="word-spacing:0.4059em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 18.666em; left:11.9575em;"><span class="stl_15 stl_16 stl_1393">default</span><span class="stl_15 stl_16 stl_1393" style="word-spacing:-0.1429em;">&nbsp;</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.1429em;">:</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:0.4343em;">&nbsp;Usage</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.2197em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.1937em;">&nbsp;argv</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.1077em;">&nbsp;[</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.2037em;">&nbsp;0</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.2037em;">&nbsp;]</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.2037em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:-0.0427em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:0.3988em;">&nbsp;</span><span class="stl_15 stl_16 stl_1393" style="word-spacing:0.3988em;">break</span><span class="stl_15 stl_16 stl_1393" style="word-spacing:-0.2011em;">&nbsp;</span><span class="stl_10 stl_11 stl_1393" style="word-spacing:0.3988em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6668em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 20.6635em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 22.656em; left:8.0008em;"><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.029em;">redisContext * rc</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.0215em;">&nbsp;= redisConnect (</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2505em;">&nbsp;config</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.1955em;">&nbsp;.</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2495em;">&nbsp;ip</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.1575em;">&nbsp;,</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.1955em;">&nbsp;config</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.1955em;">&nbsp;.</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2275em;">&nbsp;port</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2825em;">&nbsp;)</span><span class="stl_10 stl_11 stl_908" style="word-spacing:-0.2825em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 23.6468em; left:8.045em;z-index:411; "><span class="stl_15 stl_16 stl_663" style="word-spacing:-0.0761em;">i f</span><span class="stl_15 stl_16 stl_663" style="word-spacing:0.6302em;">&nbsp;</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.6302em;">(NULL</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.1579em;">&nbsp;==</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.3489em;">&nbsp;rc</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.6839em;">&nbsp;|</span><span class="stl_10 stl_11 stl_663" style="word-spacing:-0.0381em;">&nbsp;|</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.6849em;">&nbsp;rc</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.5169em;">&nbsp;!=</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.3259em;">&nbsp;NULL</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.1589em;">&nbsp;&amp;&amp;</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.3189em;">&nbsp;rc</span><span class="stl_107 stl_108 stl_663" style="word-spacing:0.3189em;">−</span><span class="stl_10 stl_11 stl_663" style="word-spacing:0.3189em;">&gt;err</span><span class="stl_10 stl_11 stl_663" style="word-spacing:-0.0031em;">&nbsp;)</span><span class="stl_10 stl_11 stl_663" style="word-spacing:-0.0031em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 24.6485em; left:14.0225em;z-index:449; "><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.1982em;">f p r i n t f ( stderr , ” error : ␣%s \n” , rc</span><span class="stl_107 stl_108 stl_137" style="word-spacing:-0.1982em;">−</span><span class="stl_10 stl_11 stl_137" style="word-spacing:-0.1982em;">&gt;e r r s t r ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 25.6393em; left:13.9233em;"><span class="stl_15 stl_16 stl_975" style="word-spacing:0.3965em;">return </span><span class="stl_107 stl_108 stl_975" style="word-spacing:0.3965em;">−</span><span class="stl_10 stl_11 stl_975" style="word-spacing:0.3965em;">1; &nbsp;</span></div>
					<div class="stl_01" style="top: 26.641em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 28.6335em; left:8.0033em;"><span class="stl_10 stl_11 stl_368" style="word-spacing:0.3439em;">redisReply *</span><span class="stl_10 stl_11 stl_368" style="word-spacing:-0.2501em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_368" style="word-spacing:0.2119em;">&nbsp;=</span><span class="stl_10 stl_11 stl_368" style="word-spacing:0.0079em;">&nbsp;NULL; &nbsp;</span></div>
					<div class="stl_01" style="top: 29.6243em; left:7.9342em;"><span class="stl_15 stl_16 stl_538">char</span><span class="stl_15 stl_16 stl_538" style="word-spacing:0.3556em;">&nbsp;</span><span class="stl_10 stl_11 stl_538" style="word-spacing:0.3556em;">cmd</span><span class="stl_10 stl_11 stl_538" style="word-spacing:-0.1273em;">&nbsp;[</span><span class="stl_10 stl_11 stl_538" style="word-spacing:-0.1073em;">&nbsp;max_cmd_len</span><span class="stl_10 stl_11 stl_538" style="word-spacing:-0.0533em;">&nbsp;]</span><span class="stl_10 stl_11 stl_538" style="word-spacing:-0.0533em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 30.621em; left:8.025em;"><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.1639em;">s n p r i n t f (cmd, </span><span class="stl_15 stl_16 stl_235" style="word-spacing:-0.1639em;">sizeof </span><span class="stl_10 stl_11 stl_235" style="word-spacing:-0.1639em;">(cmd) , ”BRPOP␣%s ␣ task ␣30” , config . &nbsp;</span></div>
					<div class="stl_01" style="top: 31.6218em; left:9.5875em;"><span class="stl_10 stl_11 stl_377" style="word-spacing:-0.0748em;">queue_name) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 33.6093em; left:7.98em;"><span class="stl_15 stl_16 stl_826">int</span><span class="stl_15 stl_16 stl_826" style="word-spacing:0.3367em;">&nbsp;</span><span class="stl_10 stl_11 stl_826" style="word-spacing:0.3367em;">seq</span><span class="stl_10 stl_11 stl_826" style="word-spacing:0.1488em;">&nbsp;=</span><span class="stl_10 stl_11 stl_826" style="word-spacing:0.1808em;">&nbsp;0; &nbsp;</span></div>
					<div class="stl_01" style="top: 34.606em; left:7.9483em;"><span class="stl_15 stl_16 stl_960">while</span><span class="stl_15 stl_16 stl_960" style="word-spacing:0.3408em;">&nbsp;</span><span class="stl_10 stl_11 stl_960" style="word-spacing:0.3408em;">(</span><span class="stl_10 stl_11 stl_960" style="word-spacing:-0.1967em;">&nbsp;true</span><span class="stl_10 stl_11 stl_960" style="word-spacing:-0.1967em;">&nbsp;)</span><span class="stl_10 stl_11 stl_960" style="word-spacing:-0.1967em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 35.6068em; left:10.0017em;"><span class="stl_10 stl_11 stl_313" style="word-spacing:0.2235em;">reply =</span><span class="stl_10 stl_11 stl_313" style="word-spacing:0.1945em;">&nbsp;(</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.1885em;">&nbsp;redisReply</span><span class="stl_10 stl_11 stl_313" style="word-spacing:0.4095em;">&nbsp;*)</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2685em;">&nbsp;redisCommand</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2675em;">&nbsp;(</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2245em;">&nbsp;rc</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.0785em;">&nbsp;,</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2685em;">&nbsp;cmd)</span><span class="stl_10 stl_11 stl_313" style="word-spacing:-0.2685em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 36.5985em; left:10.0375em;z-index:651; "><span class="stl_15 stl_16 stl_820" style="word-spacing:-0.0743em;">i f</span><span class="stl_15 stl_16 stl_820" style="word-spacing:0.6321em;">&nbsp;</span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.6321em;">(</span><span class="stl_10 stl_11 stl_820" style="word-spacing:-0.0113em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.3552em;">&nbsp;&amp;&amp; reply</span><span class="stl_107 stl_108 stl_820" style="word-spacing:0.3552em;">−</span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.3552em;">&gt;type</span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.3267em;">&nbsp;==</span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.1677em;">&nbsp;REDIS_REPLY_STRING)</span><span class="stl_10 stl_11 stl_820" style="word-spacing:0.1677em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 37.5993em; left:11.9442em;z-index:703; "><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.1409em;">DoLogic ( reply</span><span class="stl_107 stl_108 stl_1455" style="word-spacing:-0.1409em;">−</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.1409em;">&gt;str , reply</span><span class="stl_107 stl_108 stl_1455" style="word-spacing:-0.1409em;">−</span><span class="stl_10 stl_11 stl_1455" style="word-spacing:-0.1409em;">&gt;len ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 38.596em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 38.591em; left:10.9817em;z-index:730; "><span class="stl_15 stl_16 stl_287" style="word-spacing:0.6431em;">else i</span><span class="stl_15 stl_16 stl_287" style="word-spacing:-0.0709em;">&nbsp;f</span><span class="stl_15 stl_16 stl_287" style="word-spacing:0.6338em;">&nbsp;</span><span class="stl_10 stl_11 stl_287" style="word-spacing:0.6338em;">(</span><span class="stl_10 stl_11 stl_287" style="word-spacing:-0.0089em;">&nbsp;reply</span><span class="stl_10 stl_11 stl_287" style="word-spacing:0.3571em;">&nbsp;&amp;&amp; reply</span><span class="stl_107 stl_108 stl_287" style="word-spacing:0.3571em;">−</span><span class="stl_10 stl_11 stl_287" style="word-spacing:0.3571em;">&gt;type</span><span class="stl_10 stl_11 stl_287" style="word-spacing:0.3301em;">&nbsp;==</span><span class="stl_10 stl_11 stl_287" style="word-spacing:0.1441em;">&nbsp;REDIS_REPLY_ARRAY) &nbsp;</span></div>
					<div class="stl_01" style="top: 39.5918em; left:12.0908em;"><span class="stl_10 stl_11 stl_07">{</span></div>
					<div class="stl_01" style="top: 40.5835em; left:11.9658em;z-index:778; "><span class="stl_15 stl_16 stl_214">for</span><span class="stl_15 stl_16 stl_214" style="word-spacing:0.3896em;">&nbsp;</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.3896em;">(</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1823em;">&nbsp;size_t</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.4737em;">&nbsp;i</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1943em;">&nbsp;=0;</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.3517em;">&nbsp;i&lt;reply</span><span class="stl_107 stl_108 stl_214" style="word-spacing:0.3517em;">−</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.3517em;">&gt;elements</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.1423em;">&nbsp;;</span><span class="stl_10 stl_11 stl_214" style="word-spacing:0.5057em;">&nbsp;i</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2643em;">&nbsp;+=2)</span><span class="stl_10 stl_11 stl_214" style="word-spacing:-0.2643em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.5843em; left:13.5108em;z-index:824; "><span class="stl_10 stl_11 stl_1086" style="word-spacing:-0.1244em;">p r i n t f ( ”%d</span><span class="stl_107 stl_108 stl_1086" style="word-spacing:-0.1244em;">−</span><span class="stl_10 stl_11 stl_1086" style="word-spacing:-0.1244em;">&gt;%s \n” , seq++,reply</span><span class="stl_107 stl_108 stl_1086" style="word-spacing:-0.1244em;">−</span><span class="stl_10 stl_11 stl_1086" style="word-spacing:-0.1244em;">&gt;element [ i ]</span><span class="stl_107 stl_108 stl_1086" style="word-spacing:-0.1244em;">−</span><span class="stl_10 stl_11 stl_1086" style="word-spacing:-0.1244em;">&gt; s t r &nbsp;</span></div>
					<div class="stl_01" style="top: 42.581em; left:15.1258em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 42.581em; left:15.6696em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 43.5777em; left:11.925em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 44.5685em; left:10.9817em;"><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">else </span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.5735em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 45.5702em; left:12.0167em;z-index:895; "><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.1594em;">p r</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.1594em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.1594em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.1584em;">&nbsp;t</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.1594em;">&nbsp;f</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.0534em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.1494em;">&nbsp;”BRPOP␣</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.1454em;">&nbsp;error</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.0149em;">&nbsp;, ␣</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.1554em;">&nbsp;reply</span><span class="stl_107 stl_108 stl_1230" style="word-spacing:-0.1554em;">−</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.1554em;">&gt;type=%d\n”</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.0404em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.0974em;">&nbsp;reply</span><span class="stl_107 stl_108 stl_1230" style="word-spacing:-0.0974em;">−</span><span class="stl_10 stl_11 stl_1230" style="word-spacing:-0.0974em;">&gt; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.566em; left:13.6242em;"><span class="stl_10 stl_11 stl_527" style="word-spacing:-0.2087em;">type ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">21.1. </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">以分布式的消息队列 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">221 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:11.91em;"><span class="stl_15 stl_16 stl_681" style="word-spacing:-0.1209em;">break </span><span class="stl_10 stl_11 stl_681" style="word-spacing:-0.1209em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:9.9325em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 7.7118em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 9.6993em; left:9.9383em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 12.6877em; left:5.9875em;"><span class="stl_15 stl_16 stl_520">int</span><span class="stl_15 stl_16 stl_520" style="word-spacing:0.3337em;">&nbsp;</span><span class="stl_10 stl_11 stl_520" style="word-spacing:0.3337em;">DoLogic</span><span class="stl_10 stl_11 stl_520" style="word-spacing:0.3337em;">&nbsp;(</span><span class="stl_15 stl_16 stl_520" style="word-spacing:-0.2601em;">char</span><span class="stl_15 stl_16 stl_520" style="word-spacing:0.254em;">&nbsp;</span><span class="stl_10 stl_11 stl_520" style="word-spacing:0.254em;">*data</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.1261em;">&nbsp;,</span><span class="stl_10 stl_11 stl_520" style="word-spacing:0.4359em;">&nbsp;size_t len</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.2031em;">&nbsp;)</span><span class="stl_10 stl_11 stl_520" style="word-spacing:-0.2031em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:8.0317em;"><span class="stl_10 stl_11 stl_753" style="word-spacing:-0.1879em;">p r i n t f ( ” reply=%s \n” , data ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:7.9458em;"><span class="stl_15 stl_16 stl_495" style="word-spacing:0.4062em;">return </span><span class="stl_10 stl_11 stl_495" style="word-spacing:0.4062em;">0; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">222 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:26.2942em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 21.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5275em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5275em;">消息中间件 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 18.5155em; left:18.3258em;"><span class="stl_36 stl_13 stl_1459" style="word-spacing:0.1447em;">Part V &nbsp;</span></div>
					<div class="stl_01" style="top: 22.8491em; left:19.1942em;"><span class="stl_37 stl_18 stl_07">其他 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">23 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02" />
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9339em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 22 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.2782em; left:5.9058em;"><span class="stl_37 stl_18 stl_07">内存数据管理 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5199em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 20.5199em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">2.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">共享对象 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.7818em; left:7.5658em;"><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0786em;">在 </span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.0786em;">redis </span><span class="stl_17 stl_18 stl_27" style="word-spacing:0.0786em;">服务器初始化的时候，便将一些常用的字符串变量创建好了，免去 </span><span class="stl_10 stl_11 stl_27" style="word-spacing:0.0786em;">redis &nbsp;</span></div>
					<div class="stl_01" style="top: 23.7776em; left:5.9058em;"><span class="stl_17 stl_18 stl_1554" style="word-spacing:0.0995em;">在线服务时不必要的字符串创建。共享对象的结构体为 </span><span class="stl_10 stl_11 stl_1554" style="word-spacing:0.0995em;">struct sharedObjectsStruct</span><span class="stl_17 stl_18 stl_1554" style="word-spacing:0.0995em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 24.9965em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">摘抄它的内容如下： &nbsp;</span></div>
					<div class="stl_01" style="top: 28.2768em; left:5.98em;"><span class="stl_15 stl_16 stl_698">struct</span><span class="stl_15 stl_16 stl_698" style="word-spacing:0.3305em;">&nbsp;</span><span class="stl_10 stl_11 stl_698" style="word-spacing:0.3305em;">sharedObjectsStruct</span><span class="stl_10 stl_11 stl_698" style="word-spacing:0.3305em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 29.2777em; left:8.005em;"><span class="stl_10 stl_11 stl_541" style="word-spacing:0.3457em;">robj *</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.2203em;">&nbsp;c</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.2702em;">&nbsp;r</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.2693em;">&nbsp;l</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.2703em;">&nbsp;f</span><span class="stl_10 stl_11 stl_541" style="word-spacing:0.0548em;">&nbsp;,</span><span class="stl_10 stl_11 stl_541" style="word-spacing:0.3778em;">&nbsp;*ok</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.1862em;">&nbsp;,</span><span class="stl_10 stl_11 stl_541" style="word-spacing:0.3778em;">&nbsp;*</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.2693em;">&nbsp;err</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.0433em;">&nbsp;,</span><span class="stl_10 stl_11 stl_541" style="word-spacing:0.3777em;">&nbsp;*emptybulk</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.1392em;">&nbsp;,</span><span class="stl_10 stl_11 stl_541" style="word-spacing:0.3777em;">&nbsp;*</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.2722em;">&nbsp;czero</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.0502em;">&nbsp;,</span><span class="stl_10 stl_11 stl_541" style="word-spacing:0.3777em;">&nbsp;*cone</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.1202em;">&nbsp;,</span><span class="stl_10 stl_11 stl_541" style="word-spacing:-0.1202em;">&nbsp;* &nbsp;</span></div>
					<div class="stl_01" style="top: 30.2743em; left:9.6283em;"><span class="stl_10 stl_11 stl_925" style="word-spacing:-0.0901em;">cnegone ,</span><span class="stl_10 stl_11 stl_925" style="word-spacing:0.3919em;">&nbsp;*pong</span><span class="stl_10 stl_11 stl_925" style="word-spacing:-0.1621em;">&nbsp;,</span><span class="stl_10 stl_11 stl_925" style="word-spacing:0.3919em;">&nbsp;*space</span><span class="stl_10 stl_11 stl_925" style="word-spacing:0.3919em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 31.2702em; left:8.1275em;"><span class="stl_10 stl_11 stl_07">.</span></div>
					<div class="stl_01" style="top: 31.2702em; left:8.5866em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.026em;">. . . . . &nbsp;</span></div>
					<div class="stl_01" style="top: 32.2668em; left:6.0225em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 32.2668em; left:6.5539em;"><span class="stl_10 stl_11 stl_07">;</span></div>
					<div class="stl_01" style="top: 33.7918em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">譬如在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0832em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">通信协议里面，会较多使用的</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0832em;">” &nbsp;</span></div>
					<div class="stl_01" style="top: 34.7885em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">r</span></div>
					<div class="stl_01" style="top: 35.7843em; left:5.9058em;"><span class="stl_10 stl_11 stl_576" style="word-spacing:0.085em;">n”</span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.085em;">。这些字符串都在 </span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.085em;">initServer() </span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.085em;">函数被初始化。 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.1591em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 39.1591em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">2.2 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">两种内存分配策略 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.421em; left:7.5658em;"><span class="stl_17 stl_18 stl_1031" style="word-spacing:0.0858em;">在 </span><span class="stl_10 stl_11 stl_1031" style="word-spacing:0.0858em;">zmalloc.c </span><span class="stl_17 stl_18 stl_1031" style="word-spacing:0.0858em;">中 </span><span class="stl_10 stl_11 stl_1031" style="word-spacing:0.0858em;">redis </span><span class="stl_17 stl_18 stl_1031" style="word-spacing:0.0858em;">对内存分配策略做了包装。</span><span class="stl_10 stl_11 stl_1031" style="word-spacing:0.0858em;">redis </span><span class="stl_17 stl_18 stl_1031" style="word-spacing:0.0858em;">允许使用四种内存管理策 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4168em; left:5.9058em;"><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0681em;">略，分别是 </span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.0681em;">jemalloc,tcmalloc, </span><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0681em;">苹果系统自带的 </span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.0681em;">malloc </span><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0681em;">和其他系统自带的 </span><span class="stl_10 stl_11 stl_446" style="word-spacing:0.0681em;">malloc</span><span class="stl_17 stl_18 stl_446" style="word-spacing:0.0681em;">。当 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.6357em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">有前面三种分配策略的时候，就使用前面三种，最后一个种分配策略是不选之选。 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:7.5658em;"><span class="stl_10 stl_11 stl_1410" style="word-spacing:0.0867em;">jemalloc </span><span class="stl_17 stl_18 stl_1410" style="word-spacing:0.0867em;">是 </span><span class="stl_10 stl_11 stl_1410" style="word-spacing:0.0867em;">freebsd </span><span class="stl_17 stl_18 stl_1410" style="word-spacing:0.0867em;">操作系统自带的内存分配策略，它具有速度快，多线程优化 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:5.9058em;"><span class="stl_17 stl_18 stl_1555" style="word-spacing:0.1009em;">的特点 </span><span class="stl_10 stl_11 stl_1555" style="word-spacing:0.1009em;">TODO</span><span class="stl_17 stl_18 stl_1555" style="word-spacing:0.1009em;">，</span><span class="stl_10 stl_11 stl_1555" style="word-spacing:0.1009em;">ﬁrefox </span><span class="stl_17 stl_18 stl_1555" style="word-spacing:0.1009em;">以及 </span><span class="stl_10 stl_11 stl_1555" style="word-spacing:0.1009em;">facebook </span><span class="stl_17 stl_18 stl_1555" style="word-spacing:0.1009em;">都在使用 </span><span class="stl_10 stl_11 stl_1555" style="word-spacing:0.1009em;">jemalloc</span><span class="stl_17 stl_18 stl_1555" style="word-spacing:0.1009em;">。而 </span><span class="stl_10 stl_11 stl_1555" style="word-spacing:0.1009em;">tcmalloc </span><span class="stl_17 stl_18 stl_1555" style="word-spacing:0.1009em;">是 </span><span class="stl_10 stl_11 stl_1555" style="word-spacing:0.1009em;">google </span><span class="stl_17 stl_18 stl_1555" style="word-spacing:0.1009em;">开 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:5.9058em;z-index:533; "><span class="stl_17 stl_18 stl_532" style="word-spacing:0.0758em;">发的，内部集成了很多内存分配的测试工具，</span><span class="stl_10 stl_11 stl_532" style="word-spacing:0.0758em;">chrome </span><span class="stl_17 stl_18 stl_532" style="word-spacing:0.0758em;">浏览器和 </span><span class="stl_10 stl_11 stl_532" style="word-spacing:0.0758em;">protobuf TODO </span><span class="stl_17 stl_18 stl_532" style="word-spacing:0.0758em;">用的 &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">25 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">226 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:25.4642em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 22.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">内存数据管理 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:5.9058em;z-index:48; "><span class="stl_17 stl_18 stl_1456" style="word-spacing:0.0806em;">都是 </span><span class="stl_10 stl_11 stl_1456" style="word-spacing:0.0806em;">tcmalloc</span><span class="stl_17 stl_18 stl_1456" style="word-spacing:0.0806em;">。两者在业界都很出名，性能也不分伯仲。</span><span class="stl_10 stl_11 stl_1456" style="word-spacing:0.0806em;">redis </span><span class="stl_17 stl_18 stl_1456" style="word-spacing:0.0806em;">是一个内存数据库，对 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">存取的速度要求非常高，因此一个好的内存分配策略能帮助提升 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0823em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0823em;">的性能。 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.984em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">本篇不会对这两种内存分配策略做深入的讲解。 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.3657em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 12.3657em; left:6.5789em;"><span class="stl_38 stl_13 stl_821" style="word-spacing:0.7592em;">2.3 memory</span><span class="stl_38 stl_13 stl_821" style="word-spacing:0.1352em;">&nbsp;aware</span><span class="stl_38 stl_13 stl_821" style="word-spacing:0.1349em;">&nbsp;</span><span class="stl_39 stl_18 stl_821" style="word-spacing:0.1349em;">支持 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.7085em; left:7.5658em;"><span class="stl_10 stl_11 stl_50" style="word-spacing:0.0959em;">redis </span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.0959em;">所说的 </span><span class="stl_10 stl_11 stl_50" style="word-spacing:0.0959em;">memory aware </span><span class="stl_17 stl_18 stl_50" style="word-spacing:0.0959em;">即为能感知所使用内存总量的特性，能够实时获取 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.7051em; left:5.9058em;"><span class="stl_10 stl_11 stl_1556" style="word-spacing:0.0906em;">redis </span><span class="stl_17 stl_18 stl_1556" style="word-spacing:0.0906em;">所使用内存的大小，从而监控内存。所使用的思路较为简单，每次分配</span><span class="stl_10 stl_11 stl_1556" style="word-spacing:0.0906em;">/</span><span class="stl_17 stl_18 stl_1556" style="word-spacing:0.0906em;">释放 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.701em; left:5.9058em;"><span class="stl_17 stl_18 stl_51" style="word-spacing:0.0843em;">内存的时候都更新一个全局的内存使用值。我们先来看 </span><span class="stl_10 stl_11 stl_51" style="word-spacing:0.0843em;">malloc_size(void *ptr) </span><span class="stl_17 stl_18 stl_51" style="word-spacing:0.0843em;">函数， &nbsp;</span></div>
					<div class="stl_01" style="top: 17.9198em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">这种类似的函数的存在只是为了方便开发人员监控内存。 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.7435em; left:7.5658em;"><span class="stl_17 stl_18 stl_1557" style="word-spacing:0.0944em;">上述的内存分配策略 </span><span class="stl_10 stl_11 stl_1557" style="word-spacing:0.0944em;">jemalloc,tcmalloc </span><span class="stl_17 stl_18 stl_1557" style="word-spacing:0.0944em;">和苹果系统自带的内存分配策略可以实 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.7401em; left:5.9058em;"><span class="stl_17 stl_18 stl_483" style="word-spacing:0.0848em;">时获取指针所指内存的大小，如果上述三种内存分配策略都不支持，</span><span class="stl_10 stl_11 stl_483" style="word-spacing:0.0848em;">redis </span><span class="stl_17 stl_18 stl_483" style="word-spacing:0.0848em;">有一个种 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.736em; left:5.9058em;"><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0844em;">近似的方法来记录指针所指内存的大小，这个 </span><span class="stl_10 stl_11 stl_659" style="word-spacing:0.0844em;">trick </span><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0844em;">和 </span><span class="stl_10 stl_11 stl_659" style="word-spacing:0.0844em;">sds </span><span class="stl_17 stl_18 stl_659" style="word-spacing:0.0844em;">字符串的做法是类似的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.7818em; left:7.5658em;"><span class="stl_10 stl_11 stl_229" style="word-spacing:0.0869em;">zmalloc() </span><span class="stl_17 stl_18 stl_229" style="word-spacing:0.0869em;">函数会在所需分配内存大小的基础上，预留一个整型的空间，来存储 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.0007em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">指针所指内存的大小。这种办法是备选的，其所统计的所谓“指针所指内存大小”不 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.7752em; left:5.9058em;"><span class="stl_17 stl_18 stl_1558" style="word-spacing:0.0781em;">够准确。因为，平时我们所使用的 </span><span class="stl_10 stl_11 stl_1558" style="word-spacing:0.0781em;">malloc() </span><span class="stl_17 stl_18 stl_1558" style="word-spacing:0.0781em;">申请内存空间的时候，可能实际申请的内 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.771em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0832em;">存大小会比所需大，也就是说有一部分内存被浪费了，所以 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0832em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0832em;">提供的这种方法不 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.9898em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">能统计浪费的内存空间。 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.8335em; left:7.5658em;"><span class="stl_17 stl_18 stl_330" style="word-spacing:0.079em;">摘抄 </span><span class="stl_10 stl_11 stl_330" style="word-spacing:0.079em;">zmalloc() </span><span class="stl_17 stl_18 stl_330" style="word-spacing:0.079em;">函数的实现： &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4227em; left:5.9483em;"><span class="stl_15 stl_16 stl_101">void</span><span class="stl_15 stl_16 stl_101" style="word-spacing:-0.0589em;">&nbsp;</span><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.0589em;">* zmalloc</span><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.242em;">&nbsp;(</span><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.228em;">&nbsp;size_t</span><span class="stl_10 stl_11 stl_101" style="word-spacing:0.434em;">&nbsp;s</span><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.295em;">&nbsp;i</span><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.295em;">&nbsp;z</span><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.295em;">&nbsp;e</span><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.19em;">&nbsp;)</span><span class="stl_10 stl_11 stl_101" style="word-spacing:-0.19em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4251em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 43.4251em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">预</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;留</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;了</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;一</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;段</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;空</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;间 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4152em; left:7.9408em;"><span class="stl_15 stl_16 stl_1369">void</span><span class="stl_15 stl_16 stl_1369" style="word-spacing:0.3817em;">&nbsp;</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:0.3817em;">*</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:-0.1544em;">&nbsp;ptr</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:0.3031em;">&nbsp;= malloc</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:-0.1054em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:-0.0464em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:-0.1524em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:-0.1524em;">&nbsp;z</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:-0.1524em;">&nbsp;e+PREFIX_SIZE)</span><span class="stl_10 stl_11 stl_1369" style="word-spacing:-0.1524em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4143em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 47.4101em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 46.4143em; left:8.4207em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">内</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;溢</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;出 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:8.4207em;"><span class="stl_58 stl_59 stl_874" style="word-spacing:0.3847em;">/ error</span><span class="stl_58 stl_59 stl_874" style="word-spacing:-0.1273em;">&nbsp;.</span><span class="stl_58 stl_59 stl_874" style="word-spacing:0.4402em;">&nbsp;out of</span><span class="stl_58 stl_59 stl_874" style="word-spacing:0.3377em;">&nbsp;memory</span><span class="stl_58 stl_59 stl_874" style="word-spacing:0.3377em;">&nbsp;. &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_1028" style="word-spacing:0.5693em;">22.3. MEMORY</span><span class="stl_21 stl_11 stl_1028" style="word-spacing:0.1253em;">&nbsp;AWARE</span><span class="stl_21 stl_11 stl_1028" style="word-spacing:0.1254em;">&nbsp;</span><span class="stl_17 stl_18 stl_1028" style="word-spacing:0.1254em;">支持 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">227 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:8.045em;"><span class="stl_15 stl_16 stl_1559" style="word-spacing:-0.2329em;">i f</span><span class="stl_15 stl_16 stl_1559" style="word-spacing:0.5458em;">&nbsp;</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:0.5458em;">(</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:-0.2319em;">&nbsp;!</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:-0.1149em;">&nbsp;ptr</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:-0.1879em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:0.3721em;">&nbsp;zmalloc_oom_handler</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:-0.2289em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:-0.1349em;">&nbsp;s</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:-0.2409em;">&nbsp;i</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:-0.2409em;">&nbsp;z</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:-0.2409em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:-0.1349em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1559" style="word-spacing:-0.1349em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 8.7093em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 9.6993em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 7.7135em; left:6.4282em;"><span class="stl_58 stl_59 stl_215">/</span><span class="stl_58 stl_59 stl_215" style="word-spacing:-0.0772em;">&nbsp;</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.0772em;">更 新</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;已</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;用</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;内</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;存</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.318em;">&nbsp;大</span><span class="stl_17 stl_18 stl_215" style="word-spacing:-0.285em;">&nbsp;小。 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7093em; left:6.4282em;"><span class="stl_58 stl_59 stl_729" style="word-spacing:0.276em;">/ jemalloc</span><span class="stl_58 stl_59 stl_729" style="word-spacing:-0.115em;">&nbsp;,</span><span class="stl_58 stl_59 stl_729" style="word-spacing:-0.225em;">&nbsp;tcmalloc</span><span class="stl_58 stl_59 stl_729" style="word-spacing:0.3278em;">&nbsp;</span><span class="stl_17 stl_18 stl_729" style="word-spacing:0.3278em;">或</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;者</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;苹</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;果</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;系</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;统</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;支</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;持</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;实</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;时</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;获</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;取</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;指</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;针</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;所</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;指</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;内</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;存</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;大</span><span class="stl_17 stl_18 stl_729" style="word-spacing:-0.305em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.6993em; left:6.5163em;"><span class="stl_15 stl_16 stl_909" style="word-spacing:0.4792em;">ifdef </span><span class="stl_10 stl_11 stl_909" style="word-spacing:0.4792em;">HAVE_MALLOC_SIZE &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:7.9875em;"><span class="stl_10 stl_11 stl_123" style="word-spacing:-0.2484em;">update_zmalloc_stat_alloc ( zmalloc_size ( ptr ) ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6918em; left:7.9458em;"><span class="stl_15 stl_16 stl_1061">return</span><span class="stl_15 stl_16 stl_1061" style="word-spacing:0.3753em;">&nbsp;</span><span class="stl_10 stl_11 stl_1061" style="word-spacing:0.3753em;">ptr</span><span class="stl_10 stl_11 stl_1061" style="word-spacing:0.3753em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:6.4282em;"><span class="stl_58 stl_59 stl_430">/</span><span class="stl_58 stl_59 stl_430" style="word-spacing:-0.1342em;">&nbsp;</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.1342em;">其 他</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;情</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;况</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;使</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;用</span><span class="stl_17 stl_18 stl_430" style="word-spacing:0.3025em;">&nbsp;</span><span class="stl_58 stl_59 stl_430" style="word-spacing:0.3025em;">redis</span><span class="stl_58 stl_59 stl_430" style="word-spacing:-0.0439em;">&nbsp;</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.0439em;">自 己</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;的</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;策</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;略</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;获</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;知</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;指</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;针</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;所</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;指</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;内</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;存</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;大</span><span class="stl_17 stl_18 stl_430" style="word-spacing:-0.3465em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6843em; left:6.4989em;"><span class="stl_15 stl_16 stl_443">else &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6943em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 13.6843em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.0067em;"><span class="stl_10 stl_11 stl_07">*</span></div>
					<div class="stl_01" style="top: 14.686em; left:8.5297em;"><span class="stl_10 stl_11 stl_1560" style="word-spacing:-0.2374em;">(( size_t</span><span class="stl_10 stl_11 stl_1560" style="word-spacing:-0.2644em;">&nbsp;*)</span><span class="stl_10 stl_11 stl_1560" style="word-spacing:-0.2764em;">&nbsp;ptr</span><span class="stl_10 stl_11 stl_1560" style="word-spacing:-0.2754em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1560" style="word-spacing:0.1206em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1560" style="word-spacing:-0.1459em;">&nbsp;s i</span><span class="stl_10 stl_11 stl_1560" style="word-spacing:-0.3284em;">&nbsp;z</span><span class="stl_10 stl_11 stl_1560" style="word-spacing:-0.3284em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1560" style="word-spacing:-0.3284em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 15.6818em; left:7.9875em;"><span class="stl_10 stl_11 stl_1561" style="word-spacing:-0.1734em;">update_zmalloc_stat_alloc ( s i z e+PREFIX_SIZE) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6735em; left:7.9458em;"><span class="stl_15 stl_16 stl_1248">return</span><span class="stl_15 stl_16 stl_1248" style="word-spacing:0.4417em;">&nbsp;</span><span class="stl_10 stl_11 stl_1248">(</span><span class="stl_15 stl_16 stl_1248" style="word-spacing:0.4417em;">char</span><span class="stl_10 stl_11 stl_1248" style="word-spacing:0.4417em;">*)</span><span class="stl_10 stl_11 stl_1248" style="word-spacing:-0.101em;">&nbsp;ptr+PREFIX_SIZE; &nbsp;</span></div>
					<div class="stl_01" style="top: 17.6693em; left:5.7567em;"><span class="stl_15 stl_16 stl_1549">#endif &nbsp;</span></div>
					<div class="stl_01" style="top: 18.671em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 20.2801em; left:7.5658em;"><span class="stl_10 stl_11 stl_1510" style="word-spacing:0.1055em;">update_zmalloc_stat_alloc() </span><span class="stl_17 stl_18 stl_1510" style="word-spacing:0.1055em;">宏所要做的即为更新内存占用数值大小，因为这 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.276em; left:5.9058em;"><span class="stl_17 stl_18 stl_1309" style="word-spacing:0.0814em;">个数值是全局的，所以 </span><span class="stl_10 stl_11 stl_1309" style="word-spacing:0.0814em;">redis </span><span class="stl_17 stl_18 stl_1309" style="word-spacing:0.0814em;">做了互斥的保护。有同学可能会有疑问，</span><span class="stl_10 stl_11 stl_1309" style="word-spacing:0.0814em;">redis </span><span class="stl_17 stl_18 stl_1309" style="word-spacing:0.0814em;">服务器的 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2726em; left:5.9058em;"><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0835em;">工作模式不是单进程单线程的么，这里不需要做互斥的保护。在 </span><span class="stl_10 stl_11 stl_486" style="word-spacing:0.0835em;">redis </span><span class="stl_17 stl_18 stl_486" style="word-spacing:0.0835em;">关闭一些客户 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.2685em; left:5.9058em;"><span class="stl_17 stl_18 stl_1562" style="word-spacing:0.0943em;">端连接的时候，有时 </span><span class="stl_10 stl_11 stl_1562" style="word-spacing:0.0943em;">TODO </span><span class="stl_17 stl_18 stl_1562" style="word-spacing:0.0943em;">交给后台线程来做。因此，严格意义上来讲，互斥是要做的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.2993em; left:7.5658em;"><span class="stl_10 stl_11 stl_1421" style="word-spacing:0.1294em;">update_zmalloc_stat_alloc() </span><span class="stl_17 stl_18 stl_1421" style="word-spacing:0.1294em;">宏首先会检测 </span><span class="stl_10 stl_11 stl_1421" style="word-spacing:0.1294em;">zmalloc_thread_safe </span><span class="stl_17 stl_18 stl_1421" style="word-spacing:0.1294em;">值是否为 </span><span class="stl_10 stl_11 stl_1421" style="word-spacing:0.1294em;">1</span><span class="stl_17 stl_18 stl_1421" style="word-spacing:0.1294em;">， &nbsp;</span></div>
					<div class="stl_01" style="top: 26.296em; left:5.9058em;"><span class="stl_10 stl_11 stl_24" style="word-spacing:0.0849em;">zmalloc_thread_safe </span><span class="stl_17 stl_18 stl_24" style="word-spacing:0.0849em;">默认为 </span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.0849em;">0</span><span class="stl_17 stl_18 stl_24" style="word-spacing:0.0849em;">，也就是说 </span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.0849em;">redis </span><span class="stl_17 stl_18 stl_24" style="word-spacing:0.0849em;">默认不考虑互斥的情况；倘若 </span><span class="stl_10 stl_11 stl_24" style="word-spacing:0.0849em;">zmal- &nbsp;</span></div>
					<div class="stl_01" style="top: 27.2918em; left:5.9058em;"><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0815em;">loc_thread_safe </span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0815em;">为 </span><span class="stl_10 stl_11 stl_357" style="word-spacing:0.0815em;">1</span><span class="stl_17 stl_18 stl_357" style="word-spacing:0.0815em;">，会使用原子操作函数或加锁的方式更新内存占用数值。 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.8568em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 30.8568em; left:6.4282em;"><span class="stl_58 stl_59 stl_07">/</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.5098em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5098em;">更</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.051em;">&nbsp;新</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;已</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;使</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;内</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;存</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;大</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;小 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.8468em; left:6.4748em;"><span class="stl_15 stl_16 stl_1563">define</span><span class="stl_15 stl_16 stl_1563" style="word-spacing:0.3696em;">&nbsp;</span><span class="stl_10 stl_11 stl_1563" style="word-spacing:0.3696em;">update_zmalloc_stat_alloc</span><span class="stl_10 stl_11 stl_1563" style="word-spacing:-0.2102em;">&nbsp;(__n)</span><span class="stl_10 stl_11 stl_1563" style="word-spacing:0.2762em;">&nbsp;</span><span class="stl_15 stl_16 stl_1563" style="word-spacing:0.2762em;">do</span><span class="stl_15 stl_16 stl_1563" style="word-spacing:0.2207em;">&nbsp;</span><span class="stl_10 stl_11 stl_1563" style="word-spacing:0.2207em;">{</span><span class="stl_10 stl_11 stl_1563" style="word-spacing:0.2207em;">&nbsp;\ &nbsp;</span></div>
					<div class="stl_01" style="top: 32.8476em; left:8.005em;"><span class="stl_10 stl_11 stl_1324" style="word-spacing:0.3302em;">size_t _n</span><span class="stl_10 stl_11 stl_1324" style="word-spacing:0.1122em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1324" style="word-spacing:0.2532em;">&nbsp;(__n)</span><span class="stl_10 stl_11 stl_1324" style="word-spacing:-0.0958em;">&nbsp;;</span><span class="stl_10 stl_11 stl_1324" style="word-spacing:-0.0958em;">&nbsp;\ &nbsp;</span></div>
					<div class="stl_01" style="top: 33.846em; left:8.4207em;"><span class="stl_58 stl_59 stl_870">/</span><span class="stl_58 stl_59 stl_870" style="word-spacing:0.221em;">&nbsp;</span><span class="stl_17 stl_18 stl_870" style="word-spacing:0.221em;">按</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.1342em;">&nbsp;</span><span class="stl_58 stl_59 stl_870" style="word-spacing:0.221em;">4</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.1342em;">字 节</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.3389em;">&nbsp;向</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.3389em;">&nbsp;上</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.3389em;">&nbsp;取</span><span class="stl_17 stl_18 stl_870" style="word-spacing:-0.3389em;">&nbsp;整 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.8468em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 33.846em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 34.8352em; left:8.045em;"><span class="stl_15 stl_16 stl_125" style="word-spacing:-0.2097em;">i f</span><span class="stl_15 stl_16 stl_125" style="word-spacing:0.4967em;">&nbsp;</span><span class="stl_10 stl_11 stl_125" style="word-spacing:0.4967em;">(_n&amp;(</span><span class="stl_15 stl_16 stl_125" style="word-spacing:0.4967em;">sizeof</span><span class="stl_15 stl_16 stl_125" style="word-spacing:-0.1574em;">&nbsp;</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.1574em;">(</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2216em;">&nbsp;</span><span class="stl_15 stl_16 stl_125" style="word-spacing:-0.2216em;">long</span><span class="stl_15 stl_16 stl_125" style="word-spacing:-0.2216em;">&nbsp;</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2216em;">)</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2266em;">&nbsp;</span><span class="stl_107 stl_108 stl_125" style="word-spacing:-0.2216em;">−</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2266em;">1))</span><span class="stl_10 stl_11 stl_125" style="word-spacing:0.2843em;">&nbsp;_n</span><span class="stl_10 stl_11 stl_125" style="word-spacing:0.0593em;">&nbsp;+=</span><span class="stl_10 stl_11 stl_125" style="word-spacing:0.218em;">&nbsp;</span><span class="stl_15 stl_16 stl_125" style="word-spacing:0.218em;">sizeof</span><span class="stl_15 stl_16 stl_125" style="word-spacing:-0.1564em;">&nbsp;</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.1564em;">(</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2216em;">&nbsp;</span><span class="stl_15 stl_16 stl_125" style="word-spacing:-0.2216em;">long</span><span class="stl_15 stl_16 stl_125" style="word-spacing:-0.2216em;">&nbsp;</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2216em;">)</span><span class="stl_107 stl_108 stl_125" style="word-spacing:-0.2216em;">−</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2216em;">(_n&amp;(</span><span class="stl_15 stl_16 stl_125" style="word-spacing:-0.2216em;">sizeof</span><span class="stl_15 stl_16 stl_125" style="word-spacing:-0.1564em;">&nbsp;</span><span class="stl_10 stl_11 stl_125" style="word-spacing:-0.2216em;">( &nbsp;</span></div>
					<div class="stl_01" style="top: 35.8318em; left:9.6067em;z-index:772; "><span class="stl_15 stl_16 stl_824">long</span><span class="stl_15 stl_16 stl_824" style="word-spacing:-0.2063em;">&nbsp;</span><span class="stl_10 stl_11 stl_824" style="word-spacing:-0.2063em;">)</span><span class="stl_10 stl_11 stl_824" style="word-spacing:-0.2113em;">&nbsp;</span><span class="stl_107 stl_108 stl_824" style="word-spacing:-0.2063em;">−</span><span class="stl_10 stl_11 stl_824" style="word-spacing:-0.2113em;">1))</span><span class="stl_10 stl_11 stl_824" style="word-spacing:-0.1043em;">&nbsp;;</span><span class="stl_10 stl_11 stl_824" style="word-spacing:-0.1043em;">&nbsp;\ &nbsp;</span></div>
					<div class="stl_01" style="top: 36.8351em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 36.8351em; left:8.4207em;z-index:783; "><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">如 果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;设</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;置</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;了</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;线</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;程</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;安</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;全，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;调</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;专</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;门</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;线</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;程</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;安</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;全</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;函</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.8243em; left:8.045em;"><span class="stl_15 stl_16 stl_1022" style="word-spacing:-0.2882em;">i f</span><span class="stl_15 stl_16 stl_1022" style="word-spacing:0.4182em;">&nbsp;</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:0.4182em;">(</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:-0.2522em;">&nbsp;zmalloc_thread_safe</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:-0.2512em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:0.2908em;">&nbsp;{</span><span class="stl_10 stl_11 stl_1022" style="word-spacing:0.2908em;">&nbsp;\ &nbsp;</span></div>
					<div class="stl_01" style="top: 38.8276em; left:9.94em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 38.8276em; left:10.4132em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">使 用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;院</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;子</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;操</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;作</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;或</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;者</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;互</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;斥</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;锁，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;更</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;新</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;内</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;存</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;占</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;用</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;数</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;值 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.8235em; left:11.5808em;"><span class="stl_58 stl_59 stl_1564">used_memory &nbsp;</span></div>
					<div class="stl_01" style="top: 40.8185em; left:9.9592em;"><span class="stl_10 stl_11 stl_438" style="word-spacing:-0.2152em;">update_zmalloc_stat_add (_n)</span><span class="stl_10 stl_11 stl_438" style="word-spacing:-0.1382em;">&nbsp;;</span><span class="stl_10 stl_11 stl_438" style="word-spacing:-0.1382em;">&nbsp;\ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.8093em; left:8.9892em;"><span class="stl_15 stl_16 stl_217">else</span><span class="stl_15 stl_16 stl_217" style="word-spacing:0.2855em;">&nbsp;</span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">{</span><span class="stl_10 stl_11 stl_217" style="word-spacing:0.2855em;">&nbsp;\ &nbsp;</span></div>
					<div class="stl_01" style="top: 42.811em; left:9.9158em;"><span class="stl_10 stl_11 stl_1295" style="word-spacing:0.2199em;">used_memory +=</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:0.1519em;">&nbsp;_n;</span><span class="stl_10 stl_11 stl_1295" style="word-spacing:0.1519em;">&nbsp;\ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.8143em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.8068em; left:7.9392em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 43.8068em; left:8.9355em;"><span class="stl_10 stl_11 stl_07">\</span></div>
					<div class="stl_01" style="top: 44.7985em; left:6.9525em;"><span class="stl_15 stl_16 stl_84" style="word-spacing:-0.2263em;">while </span><span class="stl_10 stl_11 stl_84" style="word-spacing:-0.2263em;">(0) &nbsp;</span></div>
					<div class="stl_01" style="top: 44.8035em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 46.6348em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">上述是分配内存的情况，释放内存的情况则反过来。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">228 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:25.4642em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 22.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">内存数据管理 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4457em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 5.4457em; left:6.5789em;"><span class="stl_38 stl_13 stl_1565" style="word-spacing:0.7533em;">2.4 zmalloc_get_private_dirty()</span><span class="stl_38 stl_13 stl_1565" style="word-spacing:0.1295em;">&nbsp;</span><span class="stl_39 stl_18 stl_1565" style="word-spacing:0.1295em;">函数 &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:7.5658em;"><span class="stl_17 stl_18 stl_1566" style="word-spacing:0.0766em;">在 </span><span class="stl_10 stl_11 stl_1566" style="word-spacing:0.0766em;">RDB </span><span class="stl_17 stl_18 stl_1566" style="word-spacing:0.0766em;">持久化的篇章中，曾经提到这函数，我打算在这一节中稍微详细展开讲。 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.6382em; left:5.9058em;"><span class="stl_17 stl_18 stl_1079">操作系统为每一个进程维护了一个虚拟地址空间，虚拟地址空间对应着物理地址空 &nbsp;</span></div>
					<div class="stl_01" style="top: 46.6348em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">间，在虚拟地址空间上的连续并不代表物理地址空间上的连续。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_14" style="word-spacing:0.5438em;">22.4. ZMALLOC_GET_PRIVATE_DIRTY()</span><span class="stl_21 stl_11 stl_14" style="word-spacing:0.1em;">&nbsp;</span><span class="stl_17 stl_18 stl_14" style="word-spacing:0.1em;">函数 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">229 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.5658em;"><span class="stl_17 stl_18 stl_576" style="word-spacing:0.0841em;">在 </span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.0841em;">linux </span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.0841em;">编程中，进程调用 </span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.0841em;">fork() </span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.0841em;">函数后会产生子进程。之前的做法是，将父进 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">230 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:25.4642em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 22.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">内存数据管理 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.9415em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">程的物理空间为子进程拷贝一份。出于效率的考虑，可以只在父子进程出现写内存操 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7151em; left:5.9058em;"><span class="stl_17 stl_18 stl_1567" style="word-spacing:0.0764em;">作的时候，才为子进程拷贝一份。如此不仅节省了内存空间，且提高了 </span><span class="stl_10 stl_11 stl_1567" style="word-spacing:0.0764em;">fork() </span><span class="stl_17 stl_18 stl_1567" style="word-spacing:0.0764em;">的效率。 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:5.9058em;"><span class="stl_17 stl_18 stl_1444" style="word-spacing:0.084em;">在 </span><span class="stl_10 stl_11 stl_1444" style="word-spacing:0.084em;">RDB </span><span class="stl_17 stl_18 stl_1444" style="word-spacing:0.084em;">持久化过程中，父进程继续提供服务，子进程进行 </span><span class="stl_10 stl_11 stl_1444" style="word-spacing:0.084em;">RDB </span><span class="stl_17 stl_18 stl_1444" style="word-spacing:0.084em;">持久化。持久化完 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7076em; left:5.9058em;"><span class="stl_17 stl_18 stl_1568" style="word-spacing:0.1064em;">毕后，会调用 </span><span class="stl_10 stl_11 stl_1568" style="word-spacing:0.1064em;">zmalloc_get_private_dirty() </span><span class="stl_17 stl_18 stl_1568" style="word-spacing:0.1064em;">获取写时拷贝的内存大小，此值即为子 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">进程在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">RDB </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">持久化操作过程中所消耗的内存。 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.0241em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 13.0241em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">2.5 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">总结 &nbsp;</span></div>
					<div class="stl_01" style="top: 15.2668em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">是内存数据库，对内存的使用较为谨慎。 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.2593em; left:7.5658em;z-index:247; "><span class="stl_17 stl_18 stl_52" style="word-spacing:0.0801em;">有一点建议。我们前面讲过，</span><span class="stl_10 stl_11 stl_52" style="word-spacing:0.0801em;">redis </span><span class="stl_17 stl_18 stl_52" style="word-spacing:0.0801em;">服务器中有多个数据集，在平时的数据集的选 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.4773em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">择上，可以按业务来讲不同来将数据存储在不同的数据集中。将数据集中在一两个数 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.474em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">据集，查询的效率会降低。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">22.6. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">日志和断言 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">231 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.4457em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 5.4457em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">2.6 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1259em;">日志和断言 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7418em; left:7.5658em;"><span class="stl_10 stl_11 stl_29" style="word-spacing:0.0863em;">linux </span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0863em;">的世界里，最好用的调试工具不是 </span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.0863em;">gdb</span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0863em;">，而是日志和 </span><span class="stl_10 stl_11 stl_29" style="word-spacing:0.0863em;">printf</span><span class="stl_17 stl_18 stl_29" style="word-spacing:0.0863em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.9857em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">日志在一个软件系统中是非常常见的，一个关键的作用即定位错误，当系统出问 &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7593em; left:5.9058em;z-index:125; "><span class="stl_17 stl_18 stl_40" style="word-spacing:0.0758em;">题首先想到就是日志，查看日志能快速定位问题。</span><span class="stl_10 stl_11 stl_40" style="word-spacing:0.0758em;">redis </span><span class="stl_17 stl_18 stl_40" style="word-spacing:0.0758em;">中的日志模块较为简单。我们 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.756em; left:5.9058em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">源码中，到处都可以见到 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0825em;">redisLog()</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0825em;">。 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.7768em; left:7.5658em;"><span class="stl_17 stl_18 stl_1569" style="word-spacing:0.0787em;">通常，日志会分为几个级别。在 </span><span class="stl_10 stl_11 stl_1569" style="word-spacing:0.0787em;">redis </span><span class="stl_17 stl_18 stl_1569" style="word-spacing:0.0787em;">中 </span><span class="stl_10 stl_11 stl_1569" style="word-spacing:0.0787em;">5 </span><span class="stl_17 stl_18 stl_1569" style="word-spacing:0.0787em;">个日志级别，在 </span><span class="stl_10 stl_11 stl_1569" style="word-spacing:0.0787em;">redis.h </span><span class="stl_17 stl_18 stl_1569" style="word-spacing:0.0787em;">文件中有定义： &nbsp;</span></div>
					<div class="stl_01" style="top: 17.3226em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 17.3226em; left:6.4282em;"><span class="stl_58 stl_59 stl_180" style="word-spacing:0.3517em;">* Log</span><span class="stl_58 stl_59 stl_180" style="word-spacing:0.4797em;">&nbsp;l</span><span class="stl_58 stl_59 stl_180" style="word-spacing:-0.1723em;">&nbsp;e</span><span class="stl_58 stl_59 stl_180" style="word-spacing:-0.1713em;">&nbsp;v</span><span class="stl_58 stl_59 stl_180" style="word-spacing:-0.1723em;">&nbsp;e</span><span class="stl_58 stl_59 stl_180" style="word-spacing:-0.1713em;">&nbsp;l</span><span class="stl_58 stl_59 stl_180" style="word-spacing:-0.1723em;">&nbsp;s</span><span class="stl_58 stl_59 stl_180" style="word-spacing:0.4877em;">&nbsp;*/ &nbsp;</span></div>
					<div class="stl_01" style="top: 18.3118em; left:6.4748em;"><span class="stl_15 stl_16 stl_1488" style="word-spacing:0.3866em;">define </span><span class="stl_10 stl_11 stl_1488" style="word-spacing:0.3866em;">REDIS_DEBUG 0 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.5357em; left:7.6492em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0505em;">志 信 息 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.3043em; left:6.4748em;"><span class="stl_15 stl_16 stl_1570" style="word-spacing:0.3949em;">define </span><span class="stl_10 stl_11 stl_1570" style="word-spacing:0.3949em;">REDIS_VERBOSE 1 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.301em; left:6.4748em;"><span class="stl_15 stl_16 stl_316" style="word-spacing:0.3839em;">define </span><span class="stl_10 stl_11 stl_316" style="word-spacing:0.3839em;">REDIS_NOTICE 2 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.2968em; left:6.4748em;"><span class="stl_15 stl_16 stl_1571" style="word-spacing:0.4032em;">define </span><span class="stl_10 stl_11 stl_1571" style="word-spacing:0.4032em;">REDIS_WARNING 3 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.2935em; left:6.4748em;"><span class="stl_15 stl_16 stl_306">define</span><span class="stl_15 stl_16 stl_306" style="word-spacing:0.2545em;">&nbsp;</span><span class="stl_10 stl_11 stl_306" style="word-spacing:0.2545em;">REDIS_LOG_RAW</span><span class="stl_10 stl_11 stl_306" style="word-spacing:0.2034em;">&nbsp;(1&lt;&lt;10)</span><span class="stl_10 stl_11 stl_306" style="word-spacing:0.3719em;">&nbsp;</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.3719em;">/*</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.4544em;">&nbsp;Modifier</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.5321em;">&nbsp;to log</span><span class="stl_58 stl_59 stl_306" style="word-spacing:0.5321em;">&nbsp;without &nbsp;</span></div>
					<div class="stl_01" style="top: 18.3118em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 18.3185em; left:19.9025em;"><span class="stl_58 stl_59 stl_557">//</span><span class="stl_58 stl_59 stl_557" style="word-spacing:0.3178em;">&nbsp;</span><span class="stl_17 stl_18 stl_557" style="word-spacing:0.3178em;">调</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.243em;">&nbsp;试</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.242em;">&nbsp;级</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.208em;">&nbsp;别，</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.208em;">&nbsp;这</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.242em;">&nbsp;一</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.242em;">&nbsp;级</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.242em;">&nbsp;别</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.242em;">&nbsp;产</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.242em;">&nbsp;生</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.242em;">&nbsp;最</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.242em;">&nbsp;多</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.242em;">&nbsp;的</span><span class="stl_17 stl_18 stl_557" style="word-spacing:-0.242em;">&nbsp;日 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.3043em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 21.301em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 22.2968em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 23.2935em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 24.296em; left:7.6408em;"><span class="stl_58 stl_59 stl_119" style="word-spacing:0.3267em;">timestamp */ &nbsp;</span></div>
					<div class="stl_01" style="top: 25.286em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 25.286em; left:6.4748em;"><span class="stl_15 stl_16 stl_1572">define</span><span class="stl_15 stl_16 stl_1572" style="word-spacing:0.4553em;">&nbsp;</span><span class="stl_10 stl_11 stl_1572" style="word-spacing:0.4553em;">REDIS_DEFAULT_VERBOSITY</span><span class="stl_10 stl_11 stl_1572" style="word-spacing:0.3171em;">&nbsp;REDIS_NOTICE &nbsp;</span></div>
					<div class="stl_01" style="top: 26.871em; left:7.5658em;"><span class="stl_17 stl_18 stl_326" style="word-spacing:0.1477em;">服务器的配置结构体中，</span><span class="stl_10 stl_11 stl_326" style="word-spacing:0.1477em;">struct redisServer.verbosity </span><span class="stl_17 stl_18 stl_326" style="word-spacing:0.1477em;">是用来设定日志级别的， &nbsp;</span></div>
					<div class="stl_01" style="top: 27.8676em; left:5.9058em;"><span class="stl_17 stl_18 stl_577" style="word-spacing:0.1352em;">譬如将日志级别设定为 </span><span class="stl_10 stl_11 stl_577" style="word-spacing:0.1352em;">REDIS_NOTICE </span><span class="stl_17 stl_18 stl_577" style="word-spacing:0.1352em;">后，代码中 </span><span class="stl_10 stl_11 stl_577" style="word-spacing:0.1352em;">REDIS_VERBOSE </span><span class="stl_17 stl_18 stl_577" style="word-spacing:0.1352em;">和 </span><span class="stl_10 stl_11 stl_577" style="word-spacing:0.1352em;">RE- &nbsp;</span></div>
					<div class="stl_01" style="top: 28.8635em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">DIS_DEBUG </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">级别的日志都不会被打印。 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.1065em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">日志级别值越是低，日志级别越高，产生了日志也就越多，开发人员在产品上线 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.1032em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">之前会将日志级别调至最低，方便发现定位或发现潜在的问题。而上线之后，可以将 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.099em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">志级别降低，减少调试日志。如果日志级别过高，则日志量大，可能会对线上的服务 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.0957em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">产生影响，因为写日志就是写文件操作，系统调用是要消耗时间的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.1165em; left:7.5658em;"><span class="stl_17 stl_18 stl_1025">日志是想要记录某一个时间点，在哪里发送了什么事情，以方便出现问题的时候， &nbsp;</span></div>
					<div class="stl_01" style="top: 37.1132em; left:5.9058em;z-index:747; "><span class="stl_17 stl_18 stl_1573">恢复现场，快速定位问题所在。“某一时间点”即添加时间戳</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_573">；“</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.25em;">&nbsp;</span><span class="stl_17 stl_18 stl_1130">在哪里”即程序执行 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.109em; left:5.9058em;"><span class="stl_17 stl_18 stl_54">的位置，对应的是源码的文件，行号函数等；“发生了什么事情”即记录一些关键数据。 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 41.4326em; left:6.4282em;"><span class="stl_58 stl_59 stl_1574" style="word-spacing:0.27em;">/ redis</span><span class="stl_58 stl_59 stl_1574" style="word-spacing:-0.0249em;">&nbsp;</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.0249em;">日 志</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;函</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.304em;">&nbsp;数，</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.303em;">&nbsp;会</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;将</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;给</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;定</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;的</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;数</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;据</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;写</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;入</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;日</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;志</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;文</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.304em;">&nbsp;件，</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.304em;">&nbsp;和</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;常</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;用</span><span class="stl_17 stl_18 stl_1574" style="word-spacing:-0.337em;">&nbsp;的 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4293em; left:7.7033em;"><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.085em;">p r</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.084em;">&nbsp;i</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.085em;">&nbsp;n</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.084em;">&nbsp;t</span><span class="stl_58 stl_59 stl_07" style="word-spacing:-0.085em;">&nbsp;f</span><span class="stl_58 stl_59 stl_07" style="word-spacing:0.6163em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.6163em;">函</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;数</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;用</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;法</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;差</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;不</span><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.05em;">&nbsp;多 &nbsp;</span></div>
					<div class="stl_01" style="top: 43.4185em; left:5.9483em;"><span class="stl_15 stl_16 stl_1168">void</span><span class="stl_15 stl_16 stl_1168" style="word-spacing:0.341em;">&nbsp;</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:0.341em;">redisLog</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:-0.2054em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:-0.2295em;">&nbsp;</span><span class="stl_15 stl_16 stl_1168" style="word-spacing:-0.2295em;">int</span><span class="stl_15 stl_16 stl_1168" style="word-spacing:0.4117em;">&nbsp;</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:0.4117em;">level</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:0.0196em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:0.3898em;">&nbsp;</span><span class="stl_15 stl_16 stl_1168" style="word-spacing:0.3898em;">const</span><span class="stl_15 stl_16 stl_1168" style="word-spacing:0.2706em;">&nbsp;char</span><span class="stl_15 stl_16 stl_1168" style="word-spacing:0.259em;">&nbsp;</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:0.259em;">*fmt</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:-0.1654em;">&nbsp;,</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:0.5626em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:-0.1994em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:-0.1984em;">&nbsp;.</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:-0.1994em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1168" style="word-spacing:-0.1994em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 44.4202em; left:8.0108em;"><span class="stl_10 stl_11 stl_1288" style="word-spacing:0.2886em;">va_list ap</span><span class="stl_10 stl_11 stl_1288" style="word-spacing:0.2886em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 45.411em; left:7.9342em;"><span class="stl_15 stl_16 stl_1263">char</span><span class="stl_15 stl_16 stl_1263" style="word-spacing:0.5447em;">&nbsp;</span><span class="stl_10 stl_11 stl_1263" style="word-spacing:0.5447em;">msg</span><span class="stl_10 stl_11 stl_1263" style="word-spacing:0.0617em;">&nbsp;[REDIS_MAX_LOGMSG_LEN]</span><span class="stl_10 stl_11 stl_1263" style="word-spacing:0.0617em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4101em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 47.4101em; left:8.4207em;"><span class="stl_58 stl_59 stl_79">/</span><span class="stl_58 stl_59 stl_79" style="word-spacing:-0.0732em;">&nbsp;</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.0732em;">如 果</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;日</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;志</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;级</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;别</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;小</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;于</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;预</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;设</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;的</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;日</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;志</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;级</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.282em;">&nbsp;别，</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.283em;">&nbsp;直</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;接</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;返</span><span class="stl_17 stl_18 stl_79" style="word-spacing:-0.316em;">&nbsp;回 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">232 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:25.4642em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 22.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">内存数据管理 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7143em; left:8.045em;"><span class="stl_15 stl_16 stl_443" style="word-spacing:-0.3025em;">i f</span><span class="stl_15 stl_16 stl_443" style="word-spacing:0.439em;">&nbsp;</span><span class="stl_10 stl_11 stl_443" style="word-spacing:0.439em;">((</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.1665em;">&nbsp;l</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.3065em;">&nbsp;e</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.3075em;">&nbsp;v</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.3075em;">&nbsp;e</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.3065em;">&nbsp;l&amp;0x</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.3135em;">&nbsp;f</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.3135em;">&nbsp;f</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.2075em;">&nbsp;)</span><span class="stl_10 stl_11 stl_443" style="word-spacing:0.1075em;">&nbsp;&lt;</span><span class="stl_10 stl_11 stl_443" style="word-spacing:0.2065em;">&nbsp;server</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.1735em;">&nbsp;.</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.1785em;">&nbsp;verbosity</span><span class="stl_10 stl_11 stl_443" style="word-spacing:-0.2335em;">&nbsp;)</span><span class="stl_10 stl_11 stl_443" style="word-spacing:0.2836em;">&nbsp;</span><span class="stl_15 stl_16 stl_443" style="word-spacing:0.2836em;">return</span><span class="stl_15 stl_16 stl_443" style="word-spacing:-0.2598em;">&nbsp;</span><span class="stl_10 stl_11 stl_443" style="word-spacing:0.2836em;">; &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7118em; left:7.9867em;"><span class="stl_10 stl_11 stl_688" style="word-spacing:-0.2304em;">va_start (ap</span><span class="stl_10 stl_11 stl_688" style="word-spacing:-0.2094em;">&nbsp;,</span><span class="stl_10 stl_11 stl_688" style="word-spacing:0.3866em;">&nbsp;fmt</span><span class="stl_10 stl_11 stl_688" style="word-spacing:-0.2694em;">&nbsp;)</span><span class="stl_10 stl_11 stl_688" style="word-spacing:-0.2694em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:8.0183em;"><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.2053em;">vsnprintf (msg</span><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.2653em;">&nbsp;,</span><span class="stl_10 stl_11 stl_178" style="word-spacing:0.4289em;">&nbsp;</span><span class="stl_15 stl_16 stl_178" style="word-spacing:0.4289em;">sizeof</span><span class="stl_15 stl_16 stl_178" style="word-spacing:-0.2261em;">&nbsp;</span><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.2261em;">(msg)</span><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.1343em;">&nbsp;,</span><span class="stl_10 stl_11 stl_178" style="word-spacing:0.3057em;">&nbsp;fmt</span><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.1853em;">&nbsp;,</span><span class="stl_10 stl_11 stl_178" style="word-spacing:0.3537em;">&nbsp;ap</span><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.3023em;">&nbsp;)</span><span class="stl_10 stl_11 stl_178" style="word-spacing:-0.3023em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:7.93em;"><span class="stl_10 stl_11 stl_297" style="word-spacing:-0.1679em;">va_end( ap ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6985em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 11.6985em; left:8.4207em;"><span class="stl_58 stl_59 stl_784" style="word-spacing:0.3042em;">/ redisLogRaw</span><span class="stl_58 stl_59 stl_784" style="word-spacing:-0.2278em;">&nbsp;()</span><span class="stl_58 stl_59 stl_784" style="word-spacing:0.3901em;">&nbsp;</span><span class="stl_17 stl_18 stl_784" style="word-spacing:0.3901em;">函</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;数</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;将</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;给</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;定</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;的</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;信</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2038em;">&nbsp;息，</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2038em;">&nbsp;在</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;增</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;加</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;时</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;间</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;戳</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;和</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;进</span><span class="stl_17 stl_18 stl_784" style="word-spacing:-0.2368em;">&nbsp;程</span><span class="stl_17 stl_18 stl_784" style="word-spacing:0.3905em;">&nbsp;</span><span class="stl_58 stl_59 stl_784" style="word-spacing:0.3905em;">id &nbsp;</span></div>
					<div class="stl_01" style="top: 12.9148em; left:9.6417em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:-0.0502em;">后 写 入 日 志 文 件 &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:7.9642em;"><span class="stl_10 stl_11 stl_236" style="word-spacing:-0.164em;">redisLogRaw ( level , msg) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.686em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 17.6066em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 17.6066em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.749em;">2.7 redis</span><span class="stl_38 stl_13 stl_07" style="word-spacing:0.1259em;">&nbsp;</span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.1259em;">断言 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.8751em; left:7.5658em;"><span class="stl_17 stl_18 stl_1565" style="word-spacing:0.0656em;">为什么需要断言？</span><span class="stl_10 stl_11 stl_1565" style="word-spacing:0.0656em;">»»»»»»&gt; TODO </span><span class="stl_17 stl_18 stl_1565" style="word-spacing:0.0656em;">当你认为某些事情在正常情况下不可能出现， &nbsp;</span></div>
					<div class="stl_01" style="top: 20.871em; left:5.9058em;"><span class="stl_17 stl_18 stl_1575" style="word-spacing:0.0856em;">应尽可能结束任务，而不是捕捉错误，尝试挽救。同样在西加加里，使用 </span><span class="stl_10 stl_11 stl_1575" style="word-spacing:0.0856em;">try...catch() &nbsp;</span></div>
					<div class="stl_01" style="top: 22.0898em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">会让程序的逻辑变乱，甚至让程序的行为变得不可预测，大胆的使用断言吧。 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.8735em; left:7.5658em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">中不仅仅实现了断言，且在断言失败的时候会打印一些关键的信息。 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.8801em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">在 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis.h </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">中定义了两个断言相关的宏： &nbsp;</span></div>
					<div class="stl_01" style="top: 29.3893em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 29.3893em; left:6.4748em;"><span class="stl_15 stl_16 stl_183">define</span><span class="stl_15 stl_16 stl_183" style="word-spacing:0.3622em;">&nbsp;</span><span class="stl_10 stl_11 stl_183" style="word-spacing:0.3622em;">redisAssertWithInfo</span><span class="stl_10 stl_11 stl_183" style="word-spacing:-0.2187em;">&nbsp;(_c</span><span class="stl_10 stl_11 stl_183" style="word-spacing:-0.2897em;">&nbsp;,</span><span class="stl_10 stl_11 stl_183" style="word-spacing:-0.3057em;">&nbsp;_o,</span><span class="stl_10 stl_11 stl_183" style="word-spacing:-0.2907em;">&nbsp;_e)</span><span class="stl_10 stl_11 stl_183" style="word-spacing:0.3933em;">&nbsp;((_e)</span><span class="stl_10 stl_11 stl_183" style="word-spacing:-0.2357em;">&nbsp;?(</span><span class="stl_10 stl_11 stl_183" style="word-spacing:-0.2888em;">&nbsp;</span><span class="stl_15 stl_16 stl_183" style="word-spacing:-0.2888em;">void</span><span class="stl_15 stl_16 stl_183" style="word-spacing:-0.2956em;">&nbsp;</span><span class="stl_10 stl_11 stl_183" style="word-spacing:-0.2956em;">)</span><span class="stl_10 stl_11 stl_183" style="word-spacing:-0.2987em;">&nbsp;0</span><span class="stl_10 stl_11 stl_183" style="word-spacing:0.3573em;">&nbsp;:</span><span class="stl_10 stl_11 stl_183" style="word-spacing:0.3573em;">&nbsp;( &nbsp;</span></div>
					<div class="stl_01" style="top: 30.3901em; left:7.6625em;"><span class="stl_10 stl_11 stl_07">_</span></div>
					<div class="stl_01" style="top: 30.3901em; left:8.3815em;"><span class="stl_10 stl_11 stl_160" style="word-spacing:-0.1387em;">redisAssertWithInfo (_c , _o,#_e ,__FILE__,__LINE__) , _exit (1) &nbsp;</span></div>
					<div class="stl_01" style="top: 31.3868em; left:7.6533em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 31.3868em; left:8.1515em;"><span class="stl_10 stl_11 stl_07">)</span></div>
					<div class="stl_01" style="top: 32.3777em; left:5.7567em;"><span class="stl_15 stl_16 stl_1102">#define</span><span class="stl_15 stl_16 stl_1102" style="word-spacing:0.3854em;">&nbsp;</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:0.3854em;">redisAssert</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:-0.1955em;">&nbsp;(_e)</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:0.3975em;">&nbsp;((_e)</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:-0.2295em;">&nbsp;?(</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:-0.2838em;">&nbsp;</span><span class="stl_15 stl_16 stl_1102" style="word-spacing:-0.2838em;">void</span><span class="stl_15 stl_16 stl_1102" style="word-spacing:-0.2914em;">&nbsp;</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:-0.2914em;">)</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:-0.2935em;">&nbsp;0</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:0.3635em;">&nbsp;:</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:0.4175em;">&nbsp;(</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:-0.2185em;">&nbsp;_redisAssert(#_e</span><span class="stl_10 stl_11 stl_1102" style="word-spacing:-0.2185em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 33.3793em; left:7.5225em;"><span class="stl_10 stl_11 stl_116" style="word-spacing:0.0701em;">__FILE__,__LINE__) ,</span><span class="stl_10 stl_11 stl_116" style="word-spacing:-0.0419em;">&nbsp;_exit</span><span class="stl_10 stl_11 stl_116" style="word-spacing:-0.0189em;">&nbsp;(1)</span><span class="stl_10 stl_11 stl_116" style="word-spacing:-0.0139em;">&nbsp;)</span><span class="stl_10 stl_11 stl_116" style="word-spacing:-0.0139em;">&nbsp;) &nbsp;</span></div>
					<div class="stl_01" style="top: 35.1365em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">如果断言为真，执行一个空操作；断言为假，会打印关键的信息。 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.921em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">_</span></div>
					<div class="stl_01" style="top: 36.921em; left:8.1885em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0827em;">redisAssert() </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0827em;">函数会记录断言发生的错误信息，文件名和行号： &nbsp;</span></div>
					<div class="stl_01" style="top: 40.4302em; left:5.9483em;"><span class="stl_15 stl_16 stl_549">void</span><span class="stl_15 stl_16 stl_549" style="word-spacing:0.3332em;">&nbsp;</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.3332em;">_redisAssert</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.3332em;">&nbsp;(</span><span class="stl_15 stl_16 stl_549" style="word-spacing:-0.2142em;">char</span><span class="stl_15 stl_16 stl_549" style="word-spacing:-0.0143em;">&nbsp;</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.0143em;">* estr</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.0222em;">&nbsp;,</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.3603em;">&nbsp;</span><span class="stl_15 stl_16 stl_549" style="word-spacing:0.3603em;">char</span><span class="stl_15 stl_16 stl_549" style="word-spacing:0.2489em;">&nbsp;</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.2489em;">*</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.2122em;">&nbsp;f</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.2622em;">&nbsp;i</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.2612em;">&nbsp;l</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.2622em;">&nbsp;e</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.0818em;">&nbsp;,</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.4155em;">&nbsp;</span><span class="stl_15 stl_16 stl_549" style="word-spacing:0.4155em;">int</span><span class="stl_15 stl_16 stl_549" style="word-spacing:0.4239em;">&nbsp;</span><span class="stl_10 stl_11 stl_549" style="word-spacing:0.4239em;">l</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.2762em;">&nbsp;i</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.2752em;">&nbsp;n</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.2752em;">&nbsp;e</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.1702em;">&nbsp;)</span><span class="stl_10 stl_11 stl_549" style="word-spacing:-0.1702em;">&nbsp;{ &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:8.4207em;"><span class="stl_58 stl_59 stl_1576">/</span><span class="stl_58 stl_59 stl_1576" style="word-spacing:0.6535em;">&nbsp;</span><span class="stl_17 stl_18 stl_1576" style="word-spacing:0.6535em;">向</span><span class="stl_17 stl_18 stl_1576" style="word-spacing:0.0936em;">&nbsp;日 志 文 件 中 写 入</span><span class="stl_17 stl_18 stl_1576" style="word-spacing:0.4887em;">&nbsp;</span><span class="stl_58 stl_59 stl_1576" style="word-spacing:0.4887em;">BUG</span><span class="stl_17 stl_18 stl_1576" style="word-spacing:0.4887em;">头</span><span class="stl_17 stl_18 stl_1576" style="word-spacing:0.4887em;">&nbsp;部 &nbsp;</span></div>
					<div class="stl_01" style="top: 42.4276em; left:7.9833em;"><span class="stl_10 stl_11 stl_603" style="word-spacing:-0.1883em;">bugReportStart () ; &nbsp;</span></div>
					<div class="stl_01" style="top: 41.4326em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.4218em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 44.4218em; left:8.4207em;"><span class="stl_58 stl_59 stl_581">/</span><span class="stl_58 stl_59 stl_581" style="word-spacing:-0.0752em;">&nbsp;</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.0752em;">将 文</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;件</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;名，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;行</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.283em;">&nbsp;号，</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.284em;">&nbsp;错</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;误</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;信</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;息</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;写</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;入</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;日</span><span class="stl_17 stl_18 stl_581" style="word-spacing:-0.317em;">&nbsp;志 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.416em; left:8.0008em;"><span class="stl_10 stl_11 stl_1577" style="word-spacing:0.0416em;">redisLog (REDIS_WARNING,</span><span class="stl_10 stl_11 stl_1577" style="word-spacing:0.0366em;">&nbsp;”===␣ASSERTION␣FAILED␣===”</span><span class="stl_10 stl_11 stl_1577" style="word-spacing:-0.0184em;">&nbsp;)</span><span class="stl_10 stl_11 stl_1577" style="word-spacing:-0.0184em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 46.4127em; left:8.0008em;"><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.0589em;">redisLog (REDIS_WARNING,</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.0639em;">&nbsp;”==&gt;␣%s:%d␣’%s</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.1008em;">&nbsp;’ ␣</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.0619em;">&nbsp;i</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.1119em;">&nbsp;s</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.0619em;">&nbsp;␣not␣</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.1139em;">&nbsp;true</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.0999em;">&nbsp;”</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.0089em;">&nbsp;,</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.1038em;">&nbsp;f i</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.1059em;">&nbsp;l</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.1059em;">&nbsp;e</span><span class="stl_10 stl_11 stl_898" style="word-spacing:-0.1059em;">&nbsp;, &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:9.675em;"><span class="stl_10 stl_11 stl_1181" style="word-spacing:-0.2805em;">line , e s t r ) ; &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.526em;">22.7. REDIS</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.0832em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0832em;">断言 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:35.3692em;"><span class="stl_10 stl_11 stl_07">233 &nbsp;</span></div>
					<div class="stl_01" style="top: 6.7168em; left:5.955em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 6.7168em; left:6.4282em;"><span class="stl_58 stl_59 stl_216">/</span><span class="stl_58 stl_59 stl_216" style="word-spacing:-0.0745em;">&nbsp;</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.0745em;">如 果</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;需</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2837em;">&nbsp;要，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2837em;">&nbsp;可</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;以</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;记</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;录</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;错</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;误</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;信</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2827em;">&nbsp;息，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2837em;">&nbsp;文</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;件</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;名</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;和</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;行</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2827em;">&nbsp;号，</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.2837em;">&nbsp;以</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;便</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;在</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;进</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;程</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;崩</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;溃</span><span class="stl_17 stl_18 stl_216" style="word-spacing:-0.3167em;">&nbsp;后 &nbsp;</span></div>
					<div class="stl_01" style="top: 7.7135em; left:7.6492em;"><span class="stl_17 stl_18 stl_568" style="word-spacing:-0.2663em;">调 试</span><span class="stl_17 stl_18 stl_568" style="word-spacing:-0.2653em;">&nbsp;（</span><span class="stl_17 stl_18 stl_568" style="word-spacing:-0.272em;">&nbsp;</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.272em;">gdb</span><span class="stl_58 stl_59 stl_568" style="word-spacing:0.3357em;">&nbsp;core</span><span class="stl_58 stl_59 stl_568" style="word-spacing:-0.2224em;">&nbsp;</span><span class="stl_17 stl_18 stl_568" style="word-spacing:-0.2224em;">？） &nbsp;</span></div>
					<div class="stl_01" style="top: 8.7027em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 8.7027em; left:6.5163em;"><span class="stl_15 stl_16 stl_1578" style="word-spacing:0.4877em;">ifdef </span><span class="stl_10 stl_11 stl_1578" style="word-spacing:0.4877em;">HAVE_BACKTRACE &nbsp;</span></div>
					<div class="stl_01" style="top: 9.7043em; left:8.0175em;"><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.2322em;">server .</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.2212em;">&nbsp;a</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3822em;">&nbsp;s</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3812em;">&nbsp;s</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3822em;">&nbsp;e</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3812em;">&nbsp;r</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3822em;">&nbsp;t</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3822em;">&nbsp;_</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3812em;">&nbsp;f</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3822em;">&nbsp;a</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3822em;">&nbsp;i</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3812em;">&nbsp;l</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3822em;">&nbsp;e</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3822em;">&nbsp;d</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.1216em;">&nbsp;= e s</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3812em;">&nbsp;t</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3802em;">&nbsp;r</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3802em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 10.7001em; left:8.0175em;"><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.2322em;">server .</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.2072em;">&nbsp;a</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3682em;">&nbsp;s</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3682em;">&nbsp;s</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3672em;">&nbsp;e</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3682em;">&nbsp;r</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3682em;">&nbsp;t</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3682em;">&nbsp;_</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3672em;">&nbsp;f</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3682em;">&nbsp;i</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3682em;">&nbsp;l</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3672em;">&nbsp;e</span><span class="stl_10 stl_11 stl_587" style="word-spacing:0.1428em;">&nbsp;=</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.1264em;">&nbsp;f i</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3182em;">&nbsp;l</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3182em;">&nbsp;e</span><span class="stl_10 stl_11 stl_587" style="word-spacing:-0.3182em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 11.6968em; left:8.0175em;"><span class="stl_10 stl_11 stl_1579" style="word-spacing:-0.2386em;">server .</span><span class="stl_10 stl_11 stl_1579" style="word-spacing:-0.2346em;">&nbsp;assert_line</span><span class="stl_10 stl_11 stl_1579" style="word-spacing:0.1164em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1579" style="word-spacing:-0.2392em;">&nbsp;l i</span><span class="stl_10 stl_11 stl_1579" style="word-spacing:-0.3746em;">&nbsp;n</span><span class="stl_10 stl_11 stl_1579" style="word-spacing:-0.3746em;">&nbsp;e</span><span class="stl_10 stl_11 stl_1579" style="word-spacing:-0.3746em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:8.0008em;"><span class="stl_10 stl_11 stl_1307" style="word-spacing:-0.1151em;">redisLog (REDIS_WARNING, ” ( f o r c i n g ␣SIGSEGV␣ to ␣ print ␣ the ␣bug &nbsp;</span></div>
					<div class="stl_01" style="top: 13.6893em; left:9.6em;"><span class="stl_10 stl_11 stl_07">␣</span></div>
					<div class="stl_01" style="top: 13.6893em; left:10.1662em;"><span class="stl_10 stl_11 stl_971" style="word-spacing:-0.2816em;">report . ) ” ) ; &nbsp;</span></div>
					<div class="stl_01" style="top: 14.681em; left:5.7567em;"><span class="stl_15 stl_16 stl_07">#</span></div>
					<div class="stl_01" style="top: 14.681em; left:6.4765em;"><span class="stl_15 stl_16 stl_1149">endif &nbsp;</span></div>
					<div class="stl_01" style="top: 16.6801em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 16.6801em; left:8.4207em;"><span class="stl_58 stl_59 stl_341">/</span><span class="stl_58 stl_59 stl_341" style="word-spacing:-0.0008em;">&nbsp;</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.0008em;">强 制</span><span class="stl_17 stl_18 stl_341" style="word-spacing:0.334em;">&nbsp;</span><span class="stl_58 stl_59 stl_341" style="word-spacing:0.334em;">segmentation</span><span class="stl_58 stl_59 stl_341" style="word-spacing:0.4098em;">&nbsp;f</span><span class="stl_58 stl_59 stl_341" style="word-spacing:-0.3042em;">&nbsp;a</span><span class="stl_58 stl_59 stl_341" style="word-spacing:-0.3042em;">&nbsp;u</span><span class="stl_58 stl_59 stl_341" style="word-spacing:-0.3032em;">&nbsp;l</span><span class="stl_58 stl_59 stl_341" style="word-spacing:-0.3042em;">&nbsp;t</span><span class="stl_58 stl_59 stl_341" style="word-spacing:-0.2043em;">&nbsp;</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2043em;">。</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2802em;">&nbsp;无</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2802em;">&nbsp;效</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2802em;">&nbsp;的</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2802em;">&nbsp;内</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2802em;">&nbsp;存</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2802em;">&nbsp;访</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2472em;">&nbsp;问，</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2462em;">&nbsp;可</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2802em;">&nbsp;以</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2802em;">&nbsp;产</span><span class="stl_17 stl_18 stl_341" style="word-spacing:-0.2802em;">&nbsp;生 &nbsp;</span></div>
					<div class="stl_01" style="top: 17.676em; left:9.5292em;"><span class="stl_58 stl_59 stl_1422" style="word-spacing:-0.0089em;">SIGSEGV</span><span class="stl_17 stl_18 stl_1422" style="word-spacing:-0.0089em;">， 如 此 会 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.6726em; left:7.9475em;"><span class="stl_58 stl_59 stl_07">/</span></div>
					<div class="stl_01" style="top: 19.6668em; left:8.0067em;"><span class="stl_10 stl_11 stl_07">*</span></div>
					<div class="stl_01" style="top: 18.6726em; left:8.4207em;"><span class="stl_58 stl_59 stl_1099">/</span><span class="stl_58 stl_59 stl_1099" style="word-spacing:0.3832em;">&nbsp;</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:0.3832em;">产</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1776em;">&nbsp;生</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:0.3874em;">&nbsp;</span><span class="stl_58 stl_59 stl_1099" style="word-spacing:0.3874em;">coredump</span><span class="stl_58 stl_59 stl_1099" style="word-spacing:0.3865em;">&nbsp;</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:0.3865em;">文</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;件</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;以</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;供</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;进</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;程</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;崩</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;溃</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;后</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;调</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;试</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;使</span><span class="stl_17 stl_18 stl_1099" style="word-spacing:-0.1766em;">&nbsp;用 &nbsp;</span></div>
					<div class="stl_01" style="top: 19.6618em; left:8.5297em;"><span class="stl_10 stl_11 stl_1084">((</span><span class="stl_10 stl_11 stl_1084" style="word-spacing:-0.2326em;">&nbsp;</span><span class="stl_15 stl_16 stl_1084" style="word-spacing:-0.2326em;">char</span><span class="stl_10 stl_11 stl_1084" style="word-spacing:-0.2326em;">*)</span><span class="stl_10 stl_11 stl_1084" style="word-spacing:-0.2487em;">&nbsp;</span><span class="stl_107 stl_108 stl_1084" style="word-spacing:-0.2326em;">−</span><span class="stl_10 stl_11 stl_1084" style="word-spacing:-0.2487em;">1)</span><span class="stl_10 stl_11 stl_1084" style="word-spacing:0.1311em;">&nbsp;=</span><span class="stl_10 stl_11 stl_1084" style="word-spacing:0.3191em;">&nbsp;’x</span><span class="stl_10 stl_11 stl_1084" style="word-spacing:-0.1559em;">&nbsp;’</span><span class="stl_10 stl_11 stl_1084" style="word-spacing:-0.1559em;">&nbsp;; &nbsp;</span></div>
					<div class="stl_01" style="top: 20.6635em; left:5.9467em;"><span class="stl_10 stl_11 stl_07">}</span></div>
					<div class="stl_01" style="top: 22.1576em; left:7.5658em;"><span class="stl_17 stl_18 stl_576" style="word-spacing:0.0847em;">这有个小有意思的语句：</span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.0847em;">*((char*)-1) = ’x’; &nbsp;</span></div>
					<div class="stl_01" style="top: 24.1501em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">(</span></div>
					<div class="stl_01" style="top: 24.1501em; left:7.8888em;"><span class="stl_10 stl_11 stl_33" style="word-spacing:0.0806em;">char *)-1 </span><span class="stl_17 stl_18 stl_33" style="word-spacing:0.0806em;">表示指向地址值为 </span><span class="stl_10 stl_11 stl_33" style="word-spacing:0.0806em;">-1 </span><span class="stl_17 stl_18 stl_33" style="word-spacing:0.0806em;">的指针，它所指向的内存肯定是非法的，对非法 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.146em; left:5.9058em;"><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0797em;">内存的操作会触发 </span><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0797em;">SIGSEGV </span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0797em;">信号，进程结束后会产生 </span><span class="stl_10 stl_11 stl_189" style="word-spacing:0.0797em;">coredump </span><span class="stl_17 stl_18 stl_189" style="word-spacing:0.0797em;">文件，方便调试使 &nbsp;</span></div>
					<div class="stl_01" style="top: 26.1426em; left:5.9058em;"><span class="stl_17 stl_18 stl_428" style="word-spacing:0.0842em;">用。使用 </span><span class="stl_10 stl_11 stl_428" style="word-spacing:0.0842em;">gdb</span><span class="stl_17 stl_18 stl_428" style="word-spacing:0.0842em;">、可执行文件和 </span><span class="stl_10 stl_11 stl_428" style="word-spacing:0.0842em;">coredump </span><span class="stl_17 stl_18 stl_428" style="word-spacing:0.0842em;">文件能快速定位问题所在，即使进程已经崩 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.3607em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">溃了。 &nbsp;</span></div>
					<div class="stl_01" style="top: 29.1318em; left:7.5658em;"><span class="stl_10 stl_11 stl_07">_</span></div>
					<div class="stl_01" style="top: 29.1318em; left:8.1885em;"><span class="stl_10 stl_11 stl_1484" style="word-spacing:0.1039em;">redisAssertWithInfo() </span><span class="stl_17 stl_18 stl_1484" style="word-spacing:0.1039em;">函数会打印 </span><span class="stl_10 stl_11 stl_1484" style="word-spacing:0.1039em;">redis </span><span class="stl_17 stl_18 stl_1484" style="word-spacing:0.1039em;">服务器当前服务的客户端和某个关键 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.1277em; left:5.9058em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">对象的信息，具体请参看源码，在这不展开了。 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">234 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:25.4642em;"><span class="stl_21 stl_11 stl_07" style="word-spacing:0.083em;">CHAPTER 22.</span><span class="stl_21 stl_11 stl_07" style="word-spacing:0.5265em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.5265em;">内存数据管理 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 10.9522em; left:5.9058em;"><span class="stl_36 stl_13 stl_07" style="word-spacing:0.124em;">Chapter 23 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.7406em; left:5.9058em;"><span class="stl_12 stl_13 stl_35" style="word-spacing:0.1306em;">redis </span><span class="stl_37 stl_18 stl_35" style="word-spacing:0.1306em;">与 </span><span class="stl_12 stl_13 stl_35" style="word-spacing:0.1306em;">memcache &nbsp;</span></div>
					<div class="stl_01" style="top: 20.5741em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 20.5741em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">3.1 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">单进程单线程与单进程多线程 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.8693em; left:7.5658em;"><span class="stl_10 stl_11 stl_115" style="word-spacing:0.0841em;">redis </span><span class="stl_17 stl_18 stl_115" style="word-spacing:0.0841em;">是单进程单线程的工作模式，所有的请求都被排队处理处理，因此缓存数 &nbsp;</span></div>
					<div class="stl_01" style="top: 23.866em; left:5.9058em;"><span class="stl_17 stl_18 stl_1580" style="word-spacing:0.0876em;">据没有互斥的需求。而 </span><span class="stl_10 stl_11 stl_1580" style="word-spacing:0.0876em;">memcached </span><span class="stl_17 stl_18 stl_1580" style="word-spacing:0.0876em;">是单进程多线程的工作模式，请求到达时，主线 &nbsp;</span></div>
					<div class="stl_01" style="top: 25.084em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">程会将请求分发给多个工作线程，因此必须要做数据的互斥。 &nbsp;</span></div>
					<div class="stl_01" style="top: 27.1048em; left:7.5658em;"><span class="stl_17 stl_18 stl_1581">在处理请求的能力上，两者是不相上下的。理论上在一台支持多线程的机器上， &nbsp;</span></div>
					<div class="stl_01" style="top: 27.8793em; left:5.9058em;"><span class="stl_10 stl_11 stl_426" style="word-spacing:0.0853em;">memecached </span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.0853em;">的 </span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.0853em;">get </span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.0853em;">操作的吞吐量会较 </span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.0853em;">redis </span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.0853em;">高。 &nbsp;</span></div>
					<div class="stl_01" style="top: 30.1223em; left:7.5658em;"><span class="stl_17 stl_18 stl_41">那到底是多线程还是单线程优秀？多线程一般会增加程序逻辑的复杂度，需要考 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.1182em; left:5.9058em;"><span class="stl_17 stl_18 stl_1582">虑线程与线程之间的同步与互斥，一定程度上拉低了每个线程的吞吐量（工作量），更 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.1148em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">多的时间是花在了等待互斥锁上。一般建议在系统设计的时候多考虑系统的横向扩展 &nbsp;</span></div>
					<div class="stl_01" style="top: 32.8885em; left:5.9058em;"><span class="stl_17 stl_18 stl_847" style="word-spacing:0.0854em;">性 </span><span class="stl_10 stl_11 stl_847" style="word-spacing:0.0854em;">TODO</span><span class="stl_17 stl_18 stl_847" style="word-spacing:0.0854em;">，使用每个进程单个线程的模式。这里没有信条，不是非黑即白，就看什么 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.1073em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">样的方法解决什么样的问题了。 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.3549em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 37.3549em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">3.2 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">丰富与简单的数据结构 &nbsp;</span></div>
					<div class="stl_01" style="top: 39.6501em; left:7.5658em;"><span class="stl_10 stl_11 stl_185" style="word-spacing:0.0984em;">redis </span><span class="stl_17 stl_18 stl_185" style="word-spacing:0.0984em;">有丰富的原生数据结构，包括字符串，链表，集合，有序集合，哈希表， &nbsp;</span></div>
					<div class="stl_01" style="top: 40.6468em; left:5.9058em;"><span class="stl_17 stl_18 stl_1583" style="word-spacing:0.0909em;">二进制数组等，可见 </span><span class="stl_10 stl_11 stl_1583" style="word-spacing:0.0909em;">redis </span><span class="stl_17 stl_18 stl_1583" style="word-spacing:0.0909em;">能适用于更</span><span class="stl_10 stl_11 stl_1583" style="word-spacing:0.0909em;">. </span><span class="stl_17 stl_18 stl_1583" style="word-spacing:0.0909em;">多的场景，可以当作一个数据结构数据库。 &nbsp;</span></div>
					<div class="stl_01" style="top: 41.6426em; left:5.9058em;"><span class="stl_10 stl_11 stl_331" style="word-spacing:0.0894em;">memcached </span><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0894em;">在这方面较 </span><span class="stl_10 stl_11 stl_331" style="word-spacing:0.0894em;">redis </span><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0894em;">逊色，只能做简单的 </span><span class="stl_10 stl_11 stl_331" style="word-spacing:0.0894em;">key/value </span><span class="stl_17 stl_18 stl_331" style="word-spacing:0.0894em;">存储。 &nbsp;</span></div>
					<div class="stl_01" style="top: 45.1132em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 45.1132em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">3.3 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">其他 &nbsp;</span></div>
					<div class="stl_01" style="top: 47.4085em; left:7.5658em;"><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0855em;">除了上面所说，与 </span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0855em;">memcached </span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0855em;">比较： &nbsp;</span></div>
					<div class="stl_01" style="top: 49.5085em; left:20.6375em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 49.5085em; left:21.0526em;"><span class="stl_10 stl_11 stl_07">35 &nbsp;</span></div>
				</div>
			</div>
		</div>
		<div class="stl_02">
			<div class="stl_view">
				<div class="stl_03 stl_04">
					<div class="stl_01" style="top: 3.3893em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 3.3893em; left:6.321em;"><span class="stl_10 stl_11 stl_07">36 &nbsp;</span></div>
					<div class="stl_01" style="top: 3.3893em; left:21.4158em;"><span class="stl_21 stl_11 stl_238" style="word-spacing:0.0859em;">CHAPTER 23.</span><span class="stl_21 stl_11 stl_238" style="word-spacing:0.5299em;">&nbsp;REDIS</span><span class="stl_21 stl_11 stl_238" style="word-spacing:0.0861em;">&nbsp;</span><span class="stl_17 stl_18 stl_238" style="word-spacing:0.0861em;">与</span><span class="stl_17 stl_18 stl_238" style="word-spacing:0.0859em;">&nbsp;</span><span class="stl_21 stl_11 stl_238" style="word-spacing:0.0859em;">MEMCACHE &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">原生支持主从复制，可以实现一主多从的场景，提高了可用性 &nbsp;</span></div>
					<div class="stl_01" style="top: 5.7193em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 7.3793em; left:6.92em;"><span class="stl_10 stl_11 stl_1419" style="word-spacing:0.2336em;">2. redis</span><span class="stl_10 stl_11 stl_1419" style="word-spacing:0.0898em;">&nbsp;</span><span class="stl_17 stl_18 stl_1419" style="word-spacing:0.0898em;">原生支持</span><span class="stl_17 stl_18 stl_1419" style="word-spacing:0.0901em;">&nbsp;</span><span class="stl_10 stl_11 stl_1419" style="word-spacing:0.0901em;">RDB</span><span class="stl_10 stl_11 stl_1419" style="word-spacing:0.0894em;">&nbsp;</span><span class="stl_17 stl_18 stl_1419" style="word-spacing:0.0894em;">和</span><span class="stl_17 stl_18 stl_1419" style="word-spacing:0.0889em;">&nbsp;</span><span class="stl_10 stl_11 stl_1419" style="word-spacing:0.0889em;">AOF</span><span class="stl_10 stl_11 stl_1419" style="word-spacing:0.0882em;">&nbsp;</span><span class="stl_17 stl_18 stl_1419" style="word-spacing:0.0882em;">两种持久化方式。前者是将内存中的数据整体落 &nbsp;</span></div>
					<div class="stl_01" style="top: 8.376em; left:7.9808em;"><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0849em;">地，后者是将数据的更新落地，类似于 </span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0849em;">mysql </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0849em;">中的 </span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0849em;">binlog</span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0849em;">。</span><span class="stl_10 stl_11 stl_64" style="word-spacing:0.0849em;">memcached </span><span class="stl_17 stl_18 stl_64" style="word-spacing:0.0849em;">原生并 &nbsp;</span></div>
					<div class="stl_01" style="top: 9.594em; left:7.9808em;"><span class="stl_17 stl_18 stl_07">不支持持久化 &nbsp;</span></div>
					<div class="stl_01" style="top: 11.0326em; left:6.92em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 12.6927em; left:6.92em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 14.3535em; left:6.92em;"><span class="stl_10 stl_11 stl_07">5</span></div>
					<div class="stl_01" style="top: 11.0326em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">支持事务 &nbsp;</span></div>
					<div class="stl_01" style="top: 12.6927em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">支持键值对的过期时间设置 &nbsp;</span></div>
					<div class="stl_01" style="top: 14.3535em; left:7.3351em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.2497em;">. redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">&nbsp;3.0</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0828em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0828em;">中已经开始支持</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0831em;">&nbsp;</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0831em;">redis</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0829em;">&nbsp;</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0829em;">集群了 &nbsp;</span></div>
					<div class="stl_01" style="top: 16.1801em; left:7.5658em;"><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0839em;">对比下来，</span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.0839em;">redis </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.0839em;">好玩多了。 &nbsp;</span></div>
					<div class="stl_01" style="top: 18.5032em; left:5.9058em;"><span class="stl_38 stl_13 stl_07">2</span></div>
					<div class="stl_01" style="top: 18.5032em; left:6.5789em;"><span class="stl_38 stl_13 stl_07" style="word-spacing:0.7495em;">3.4 </span><span class="stl_39 stl_18 stl_07" style="word-spacing:0.7495em;">性能测试 &nbsp;</span></div>
					<div class="stl_01" style="top: 20.746em; left:7.5658em;"><span class="stl_17 stl_18 stl_845" style="word-spacing:0.095em;">曾经被问到 </span><span class="stl_10 stl_11 stl_845" style="word-spacing:0.095em;">redis </span><span class="stl_17 stl_18 stl_845" style="word-spacing:0.095em;">和 </span><span class="stl_10 stl_11 stl_845" style="word-spacing:0.095em;">memcached </span><span class="stl_17 stl_18 stl_845" style="word-spacing:0.095em;">哪个更快？在测试的时候，需要保证测试的客 &nbsp;</span></div>
					<div class="stl_01" style="top: 21.9648em; left:5.9058em;"><span class="stl_17 stl_18 stl_41">观环境是一样的，这包括测试机器，客户端除了在构造协议的逻辑部分不一样外，其 &nbsp;</span></div>
					<div class="stl_01" style="top: 22.9607em; left:5.9058em;"><span class="stl_17 stl_18 stl_07">他都应该是保持一致的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 24.9532em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">测试环境： &nbsp;</span></div>
					<div class="stl_01" style="top: 25.7277em; left:5.9058em;"><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0562em;">ubuntu, Intel(R)</span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0502em;">&nbsp;Core(TM) i5-3210M CPU @ 2.50GHz 4</span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0497em;">&nbsp;</span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0497em;">核心</span><span class="stl_17 stl_18 stl_55" style="word-spacing:0.0497em;">&nbsp;</span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0497em;">memcache 1.4.14</span><span class="stl_10 stl_11 stl_55" style="word-spacing:0.0497em;">&nbsp;redis &nbsp;</span></div>
					<div class="stl_01" style="top: 26.7235em; left:5.9058em;"><span class="stl_10 stl_11 stl_07">3.1.99 &nbsp;</span></div>
					<div class="stl_01" style="top: 28.5501em; left:6.92em;"><span class="stl_10 stl_11 stl_07">1</span></div>
					<div class="stl_01" style="top: 30.2101em; left:6.92em;"><span class="stl_10 stl_11 stl_07">2</span></div>
					<div class="stl_01" style="top: 31.871em; left:6.92em;"><span class="stl_10 stl_11 stl_07">3</span></div>
					<div class="stl_01" style="top: 33.5318em; left:6.92em;"><span class="stl_10 stl_11 stl_07">4</span></div>
					<div class="stl_01" style="top: 28.5501em; left:7.3351em;"><span class="stl_10 stl_11 stl_576">.</span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.252em;">&nbsp;</span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.252em;">随着</span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.0859em;">&nbsp;</span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.0859em;">payload</span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.085em;">&nbsp;</span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.085em;">增大，会越影响读写性能，尤其是</span><span class="stl_17 stl_18 stl_576" style="word-spacing:0.084em;">&nbsp;</span><span class="stl_10 stl_11 stl_576" style="word-spacing:0.084em;">redis &nbsp;</span></div>
					<div class="stl_01" style="top: 30.2101em; left:7.3351em;"><span class="stl_10 stl_11 stl_1584" style="word-spacing:0.2775em;">. redis</span><span class="stl_17 stl_18 stl_1584" style="word-spacing:0.2775em;">，</span><span class="stl_10 stl_11 stl_1584" style="word-spacing:0.2775em;">memcache</span><span class="stl_17 stl_18 stl_1584" style="word-spacing:0.2775em;">（</span><span class="stl_10 stl_11 stl_1584" style="word-spacing:0.2775em;">worker</span><span class="stl_10 stl_11 stl_1584" style="word-spacing:0.1098em;">&nbsp;</span><span class="stl_17 stl_18 stl_1584" style="word-spacing:0.1098em;">线程数为</span><span class="stl_17 stl_18 stl_1584" style="word-spacing:0.1108em;">&nbsp;</span><span class="stl_10 stl_11 stl_1584" style="word-spacing:0.1098em;">1</span><span class="stl_17 stl_18 stl_1584" style="word-spacing:0.1108em;">），读写性能不分上下，</span><span class="stl_10 stl_11 stl_1584" style="word-spacing:0.1108em;">redis</span><span class="stl_10 stl_11 stl_1584" style="word-spacing:0.1107em;">&nbsp;</span><span class="stl_17 stl_18 stl_1584" style="word-spacing:0.1107em;">更优一点 &nbsp;</span></div>
					<div class="stl_01" style="top: 31.871em; left:7.3351em;"><span class="stl_10 stl_11 stl_26" style="word-spacing:0.2552em;">. memcache</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0872em;">&nbsp;</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0872em;">的</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0884em;">&nbsp;</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0884em;">worker</span><span class="stl_10 stl_11 stl_26" style="word-spacing:0.0875em;">&nbsp;</span><span class="stl_17 stl_18 stl_26" style="word-spacing:0.0875em;">线程达到一定个数，会导致读写的性能下降 &nbsp;</span></div>
					<div class="stl_01" style="top: 33.5318em; left:7.3351em;"><span class="stl_10 stl_11 stl_1421">.</span><span class="stl_10 stl_11 stl_1421" style="word-spacing:0.2349em;">&nbsp;</span><span class="stl_17 stl_18 stl_1421" style="word-spacing:0.2349em;">在机器上测试的时候发现，无论如何都不能把</span><span class="stl_17 stl_18 stl_1421" style="word-spacing:0.083em;">&nbsp;</span><span class="stl_10 stl_11 stl_1421" style="word-spacing:0.083em;">cpu</span><span class="stl_10 stl_11 stl_1421" style="word-spacing:0.0822em;">&nbsp;</span><span class="stl_17 stl_18 stl_1421" style="word-spacing:0.0822em;">撑满，这时候瓶颈往往不在 &nbsp;</span></div>
					<div class="stl_01" style="top: 34.5277em; left:7.9808em;"><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">cpu</span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">，而在网络的 </span><span class="stl_10 stl_11 stl_07" style="word-spacing:0.083em;">IO </span><span class="stl_17 stl_18 stl_07" style="word-spacing:0.083em;">上 &nbsp;</span></div>
					<div class="stl_01" style="top: 36.3543em; left:7.5658em;"><span class="stl_17 stl_18 stl_509" style="word-spacing:0.0924em;">默认情况下，</span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.0924em;">memcached </span><span class="stl_17 stl_18 stl_509" style="word-spacing:0.0924em;">默认键长设置为 </span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.0924em;">256B</span><span class="stl_17 stl_18 stl_509" style="word-spacing:0.0924em;">，存储数据长度限制为 </span><span class="stl_10 stl_11 stl_509" style="word-spacing:0.0924em;">1M</span><span class="stl_17 stl_18 stl_509" style="word-spacing:0.0924em;">。可 &nbsp;</span></div>
					<div class="stl_01" style="top: 37.3502em; left:5.9058em;"><span class="stl_17 stl_18 stl_924" style="word-spacing:0.0922em;">以通过 </span><span class="stl_10 stl_11 stl_924" style="word-spacing:0.0922em;">memcached </span><span class="stl_17 stl_18 stl_924" style="word-spacing:0.0922em;">的 </span><span class="stl_10 stl_11 stl_924" style="word-spacing:0.0922em;">-I </span><span class="stl_17 stl_18 stl_924" style="word-spacing:0.0922em;">选项调整默认 </span><span class="stl_10 stl_11 stl_924" style="word-spacing:0.0922em;">slab </span><span class="stl_17 stl_18 stl_924" style="word-spacing:0.0922em;">页面大小，从而可以调整存储数据长度 &nbsp;</span></div>
					<div class="stl_01" style="top: 38.3468em; left:5.9058em;"><span class="stl_17 stl_18 stl_426" style="word-spacing:0.0852em;">的限制，但 </span><span class="stl_10 stl_11 stl_426" style="word-spacing:0.0852em;">memcached </span><span class="stl_17 stl_18 stl_426" style="word-spacing:0.0852em;">官方是不建议这种做法的。 &nbsp;</span></div>
					<div class="stl_01" style="top: 40.5615em; left:7.5658em;"><span class="stl_17 stl_18 stl_07">没有非黑即白的答案，只有哪个工具在哪种场景下更为适用。 &nbsp;</span></div>
				</div>
			</div>
		</div>
	</body>
</html>